/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={798:function(Mn,Tt,ct){var f=ct(352),It=ct.n(f)()(function(ht){return ht[1]});It.push([Mn.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),Tt.Z=It},898:function(Mn,Tt,ct){var f=ct(352),It=ct.n(f)()(function(ht){return ht[1]});It.push([Mn.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),Tt.Z=It},513:function(Mn,Tt,ct){var f=ct(352),It=ct.n(f)()(function(ht){return ht[1]});It.push([Mn.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),Tt.Z=It},476:function(Mn){var Tt;Tt=function(){return function(ct){var f={};function It(ht){if(f[ht])return f[ht].exports;var Ge=f[ht]={i:ht,l:!1,exports:{}};return ct[ht].call(Ge.exports,Ge,Ge.exports,It),Ge.l=!0,Ge.exports}return It.m=ct,It.c=f,It.i=function(ht){return ht},It.d=function(ht,Ge,rt){It.o(ht,Ge)||Object.defineProperty(ht,Ge,{configurable:!1,enumerable:!0,get:rt})},It.n=function(ht){var Ge=ht&&ht.__esModule?function(){return ht.default}:function(){return ht};return It.d(Ge,"a",Ge),Ge},It.o=function(ht,Ge){return Object.prototype.hasOwnProperty.call(ht,Ge)},It.p="",It(It.s=5)}([function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0});var ht={convertToObject:function(Ge){var rt=Ge.substring(Ge.indexOf("{")+1).trim().slice(0,-1),Ue={};return rt.split(";").map(function(vt){if(vt=vt.trim()){var wt=vt.split(":");Ue[wt[0].trim()]=wt[1].trim()}}),Ue},getFromSheets:function(Ge){var rt=document.styleSheets;for(var Ue in rt){var vt=null;try{vt=rt[Ue].rules||rt[Ue].cssRules}catch{}if(vt){for(var wt in vt)if(vt[wt].selectorText&&vt[wt].selectorText.split(",").indexOf(Ge)!=-1)return vt[wt].cssText?ht.convertToObject(vt[wt].cssText):ht.convertToObject(vt[wt].style.cssText)}}return{}},getPropertyDefault:function(Ge){return Ge=="timing-function"?"ease":Ge=="iteration-count"?1:Ge=="direction"?"normal":Ge=="fill-mode"?"none":null}};f.default=ht},function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0});var ht={generateId:function(){for(var Ge="",rt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Ue=0;Ue<8;++Ue)Ge+=rt.charAt(Math.floor(Math.random()*rt.length));return Ge},frameToString:function(Ge){var rt="";for(var Ue in Ge)rt+=Ue+":"+Ge[Ue]+";";return rt},convertTimeToMs:function(Ge){if(!Ge)return 0;if(typeof Ge=="number")return Ge;var rt=parseFloat(Ge);return Ge.indexOf("ms")!=-1?rt:1e3*rt},prefixes:["","-webkit-","-moz-","-o-"]};f.default=ht},function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0});var ht,Ge=(ht=It(0))&&ht.__esModule?ht:{default:ht};f.default=function rt(Ue,vt){if(function(Ye,Qe){if(!(Ye instanceof Qe))throw new TypeError("Cannot call a class as a function")}(this,rt),this.styles=typeof Ue=="string"?Ge.default.getFromSheets(Ue):Ue,typeof vt=="string"){var wt=Ge.default.getFromSheets(vt);for(var Je in this.options={},wt)this.options[Je.replace("animation-","")]=wt[Je]}else this.options=typeof vt=="number"?{duration:vt}:vt}},function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0});var ht=function(){function Je(Ye,Qe){for(var je=0;je<Qe.length;je++){var me=Qe[je];me.enumerable=me.enumerable||!1,me.configurable=!0,"value"in me&&(me.writable=!0),Object.defineProperty(Ye,me.key,me)}}return function(Ye,Qe,je){return Qe&&Je(Ye.prototype,Qe),je&&Je(Ye,je),Ye}}(),Ge=vt(It(4)),rt=vt(It(1)),Ue=vt(It(0));function vt(Je){return Je&&Je.__esModule?Je:{default:Je}}var wt=function(){function Je(Ye,Qe,je,me){if(function(Ae,ke){if(!(Ae instanceof ke))throw new TypeError("Cannot call a class as a function")}(this,Je),Ye.constructor===Array?this.doms=Ye:this.doms=[Ye],Qe.constructor===Array?this.frames=Qe:this.frames=[Qe],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},je!=null&&je!=null)if(typeof je=="boolean")this.options.instant=je;else if(typeof je=="number")this.options.count=je,typeof me=="boolean"&&(this.options.instant=me);else for(var Te in je)Te=="pauseAt"&&je.pauseAt.constructor!==Array?this.options[Te]=[je[Te]]:this.options[Te]=je[Te];for(var ue in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=rt.default.prefixes:this.prefixes=[""],Ye)this.countRemainder[ue]=this.options.count-1;this.options.instant&&this.play()}return ht(Je,[{key:"play",value:function(){var Ye=this;for(var Qe in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(me){Ye.promiseResolve=me})),this.doms){var je=this.makeAnimation(this.doms[Qe]);this.animations[Qe]=je.names,this.styleDoms[Qe]=je.styleDom,this.superSets[Qe]=this.makeSuperSet(this.doms[Qe],this.animations[Qe]),this.playAnimation(this.doms[Qe],this.superSets[Qe]),this.eventHandler[Qe]=this.handleAnimationEnd.bind(this,Qe),this.doms[Qe].addEventListener("animationend",this.eventHandler[Qe])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(Ye){if(!Ye){for(var Qe in this.doms)this.clear(Qe);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var je=this.styleDoms[Ye];for(var me in je&&je.parentNode&&je.parentNode.removeChild(je),this.superSets[Ye])for(var Te in this.prefixes)this.doms[Ye].style[this.prefixes[Te]+"animation-"+me]=null;for(var ue in this.prefixes)this.doms[Ye].style[this.prefixes[ue]+"animation-play-state"]=null;this.doms[Ye].removeEventListener("animationend",this.eventHandler[Ye]),this.countRemainder[Ye]=this.options.count-1}},{key:"replay",value:function(Ye){var Qe=this.doms[Ye],je=Qe.cloneNode(!0);Qe.parentNode.replaceChild(je,Qe),this.doms[Ye].removeEventListener("animationend",this.eventHandler[Ye]),this.doms[Ye]=je,this.doms[Ye].addEventListener("animationend",this.eventHandler[Ye])}},{key:"pause",value:function(){for(var Ye in this.doms)this.pauseDom(this.doms[Ye])}},{key:"resume",value:function(){for(var Ye in this.doms)this.resumeDom(this.doms[Ye])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(Ye,Qe){var je=Qe.animationName,me=je.substring(je.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(me))&&this.pauseDom(this.doms[Ye]),me==this.frames.length&&(this.countRemainder[Ye]==-1?this.replay(Ye):this.countRemainder[Ye]>0?(this.countRemainder[Ye]--,this.replay(Ye)):(this.options.applyOnEnd&&this.applyOnEnd(Ye),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(Ye){for(var Qe in this.prefixes)Ye.style[this.prefixes[Qe]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(Ye){for(var Qe in this.prefixes)Ye.style[this.prefixes[Qe]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(Ye){var Qe=this.newFrames[this.frames.length];for(var je in Qe)this.doms[Ye].style[je]=Qe[je]}},{key:"makeAnimation",value:function(Ye){var Qe={},je=[],me={};for(var Te in this.frames)for(var ue in je.push(this.frames[Te].styles),je[Te])me[ue]=!0;var Ae=window.getComputedStyle(Ye);for(var ke in me)Qe[ke]=Ae[ke];je.unshift(Qe);for(var mt=[je[0]],Ee=1;Ee<je.length;++Ee){var Ve=JSON.parse(JSON.stringify(mt[Ee-1]));for(var K in je[Ee])Ve[K]=je[Ee][K];mt.push(Ve)}return this.newFrames=mt,Ge.default.make(mt,this.prefixes)}},{key:"makeSuperSet",value:function(Ye,Qe){var je=0,me={};for(var Te in this.frames)for(var ue in this.frames[Te].options)me[ue]="";me.name="",me.duration="",me.delay="";for(var Ae=0;Ae<this.frames.length;++Ae){if(Ae)for(var ke in me)me[ke]+=",";var mt=rt.default.convertTimeToMs(this.frames[Ae].options.duration),Ee=rt.default.convertTimeToMs(this.frames[Ae].options.delay);for(var Ve in Ae<this.options.startFrom&&(mt=0,Ee=0),me.name+=Qe[Ae],me.duration+=mt+"ms",me.delay+=je+Ee+"ms",me)Ve!="name"&&Ve!="duration"&&Ve!="delay"&&(me[Ve]+=this.frames[Ae].options[Ve]?this.frames[Ae].options[Ve]:Ue.default.getPropertyDefault(Ve));var K=this.frames[Ae].options["iteration-count"];je+=mt*parseInt(K||1)+Ee}return me}},{key:"playAnimation",value:function(Ye,Qe){for(var je in Qe)for(var me in this.prefixes)Ye.style[this.prefixes[me]+"animation-"+je]=Qe[je];this.options.pauseAt.includes(0)&&this.pauseDom(Ye)}}]),Je}();f.default=wt},function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0});var ht,Ge=(ht=It(1))&&ht.__esModule?ht:{default:ht},rt={make:function(Ue,vt){for(var wt=[],Je="",Ye="atr-"+Ge.default.generateId(),Qe=document.createElement("style"),je=0;je<Ue.length-1;++je)wt.push(Ye+"-"+(je+1)),Je+=rt.makeFromTwoFrames(Ue[je],Ue[je+1],wt[je],vt);return Qe.innerHTML=Je,Qe.class="foo",document.getElementsByTagName("head")[0].appendChild(Qe),{names:wt,styleDom:Qe}},makeFromTwoFrames:function(Ue,vt,wt,Je){var Ye="";for(var Qe in Je)Ye+="@"+Je[Qe]+"keyframes "+wt+" {",Ye+="0%",Ye+="{"+Ge.default.frameToString(Ue)+"}",Ye+="100%",Ye+="{"+Ge.default.frameToString(vt)+"}",Ye+="}";return Ye}};f.default=rt},function(ct,f,It){Object.defineProperty(f,"__esModule",{value:!0}),f.Queue=f.Frame=void 0;var ht=rt(It(2)),Ge=rt(It(3));function rt(Ue){return Ue&&Ue.__esModule?Ue:{default:Ue}}f.Frame=ht.default,f.Queue=Ge.default}])},Mn.exports=Tt()},352:function(Mn){Mn.exports=function(Tt){var ct=[];return ct.toString=function(){return this.map(function(f){var It=Tt(f);return f[2]?"@media ".concat(f[2]," {").concat(It,"}"):It}).join("")},ct.i=function(f,It,ht){typeof f=="string"&&(f=[[null,f,""]]);var Ge={};if(ht)for(var rt=0;rt<this.length;rt++){var Ue=this[rt][0];Ue!=null&&(Ge[Ue]=!0)}for(var vt=0;vt<f.length;vt++){var wt=[].concat(f[vt]);ht&&Ge[wt[0]]||(It&&(wt[2]?wt[2]="".concat(It," and ").concat(wt[2]):wt[2]=It),ct.push(wt))}},ct}},388:function(Mn){Mn.exports=function Tt(ct,f,It){function ht(Ue,vt){if(!f[Ue]){if(!ct[Ue]){if(Ge)return Ge(Ue,!0);throw new Error("Cannot find module '"+Ue+"'")}var wt=f[Ue]={exports:{}};ct[Ue][0].call(wt.exports,function(Je){return ht(ct[Ue][1][Je]||Je)},wt,wt.exports,Tt,ct,f,It)}return f[Ue].exports}for(var Ge=void 0,rt=0;rt<It.length;rt++)ht(It[rt]);return ht}({1:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){var Qe=Tt("crypto");function je(Ee,Ve){return function(K,Z){var te;if((te=Z.algorithm!=="passthrough"?Qe.createHash(Z.algorithm):new mt).write===void 0&&(te.write=te.update,te.end=te.update),ke(Z,te).dispatch(K),te.update||te.end(""),te.digest)return te.digest(Z.encoding==="buffer"?void 0:Z.encoding);var Oe=te.read();return Z.encoding!=="buffer"?Oe.toString(Z.encoding):Oe}(Ee,Ve=ue(Ee,Ve))}(f=ct.exports=je).sha1=function(Ee){return je(Ee)},f.keys=function(Ee){return je(Ee,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},f.MD5=function(Ee){return je(Ee,{algorithm:"md5",encoding:"hex"})},f.keysMD5=function(Ee){return je(Ee,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var me=Qe.getHashes?Qe.getHashes().slice():["sha1","md5"];me.push("passthrough");var Te=["buffer","hex","binary","base64"];function ue(Ee,Ve){Ve=Ve||{};var K={};if(K.algorithm=Ve.algorithm||"sha1",K.encoding=Ve.encoding||"hex",K.excludeValues=!!Ve.excludeValues,K.algorithm=K.algorithm.toLowerCase(),K.encoding=K.encoding.toLowerCase(),K.ignoreUnknown=Ve.ignoreUnknown===!0,K.respectType=Ve.respectType!==!1,K.respectFunctionNames=Ve.respectFunctionNames!==!1,K.respectFunctionProperties=Ve.respectFunctionProperties!==!1,K.unorderedArrays=Ve.unorderedArrays===!0,K.unorderedSets=Ve.unorderedSets!==!1,K.unorderedObjects=Ve.unorderedObjects!==!1,K.replacer=Ve.replacer||void 0,K.excludeKeys=Ve.excludeKeys||void 0,Ee===void 0)throw new Error("Object argument required.");for(var Z=0;Z<me.length;++Z)me[Z].toLowerCase()===K.algorithm.toLowerCase()&&(K.algorithm=me[Z]);if(me.indexOf(K.algorithm)===-1)throw new Error('Algorithm "'+K.algorithm+'"  not supported. supported values: '+me.join(", "));if(Te.indexOf(K.encoding)===-1&&K.algorithm!=="passthrough")throw new Error('Encoding "'+K.encoding+'"  not supported. supported values: '+Te.join(", "));return K}function Ae(Ee){if(typeof Ee=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(Ee))!=null}function ke(Ee,Ve,K){function Z(te){return Ve.update?Ve.update(te,"utf8"):Ve.write(te,"utf8")}return K=K||[],{dispatch:function(te){return Ee.replacer&&(te=Ee.replacer(te)),this["_"+(te===null?"null":typeof te)](te)},_object:function(te){var Oe,ve=Object.prototype.toString.call(te),st=/\[object (.*)\]/i.exec(ve);if(st=(st=st?st[1]:"unknown:["+ve+"]").toLowerCase(),0<=(Oe=K.indexOf(te)))return this.dispatch("[CIRCULAR:"+Oe+"]");if(K.push(te),Ge!==void 0&&Ge.isBuffer&&Ge.isBuffer(te))return Z("buffer:"),Z(te);if(st==="object"||st==="function"||st==="asyncfunction"){var qt=Object.keys(te);Ee.unorderedObjects&&(qt=qt.sort()),Ee.respectType===!1||Ae(te)||qt.splice(0,0,"prototype","__proto__","constructor"),Ee.excludeKeys&&(qt=qt.filter(function(tn){return!Ee.excludeKeys(tn)})),Z("object:"+qt.length+":");var Vt=this;return qt.forEach(function(tn){Vt.dispatch(tn),Z(":"),Ee.excludeValues||Vt.dispatch(te[tn]),Z(",")})}if(!this["_"+st]){if(Ee.ignoreUnknown)return Z("["+st+"]");throw new Error('Unknown object type "'+st+'"')}this["_"+st](te)},_array:function(te,Oe){Oe=Oe!==void 0?Oe:Ee.unorderedArrays!==!1;var ve=this;if(Z("array:"+te.length+":"),!Oe||te.length<=1)return te.forEach(function(Vt){return ve.dispatch(Vt)});var st=[],qt=te.map(function(Vt){var tn=new mt,Bt=K.slice();return ke(Ee,tn,Bt).dispatch(Vt),st=st.concat(Bt.slice(K.length)),tn.read().toString()});return K=K.concat(st),qt.sort(),this._array(qt,!1)},_date:function(te){return Z("date:"+te.toJSON())},_symbol:function(te){return Z("symbol:"+te.toString())},_error:function(te){return Z("error:"+te.toString())},_boolean:function(te){return Z("bool:"+te.toString())},_string:function(te){Z("string:"+te.length+":"),Z(te.toString())},_function:function(te){Z("fn:"),Ae(te)?this.dispatch("[native]"):this.dispatch(te.toString()),Ee.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(te.name)),Ee.respectFunctionProperties&&this._object(te)},_number:function(te){return Z("number:"+te.toString())},_xml:function(te){return Z("xml:"+te.toString())},_null:function(){return Z("Null")},_undefined:function(){return Z("Undefined")},_regexp:function(te){return Z("regex:"+te.toString())},_uint8array:function(te){return Z("uint8array:"),this.dispatch(Array.prototype.slice.call(te))},_uint8clampedarray:function(te){return Z("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(te))},_int8array:function(te){return Z("uint8array:"),this.dispatch(Array.prototype.slice.call(te))},_uint16array:function(te){return Z("uint16array:"),this.dispatch(Array.prototype.slice.call(te))},_int16array:function(te){return Z("uint16array:"),this.dispatch(Array.prototype.slice.call(te))},_uint32array:function(te){return Z("uint32array:"),this.dispatch(Array.prototype.slice.call(te))},_int32array:function(te){return Z("uint32array:"),this.dispatch(Array.prototype.slice.call(te))},_float32array:function(te){return Z("float32array:"),this.dispatch(Array.prototype.slice.call(te))},_float64array:function(te){return Z("float64array:"),this.dispatch(Array.prototype.slice.call(te))},_arraybuffer:function(te){return Z("arraybuffer:"),this.dispatch(new Uint8Array(te))},_url:function(te){return Z("url:"+te.toString())},_map:function(te){Z("map:");var Oe=Array.from(te);return this._array(Oe,Ee.unorderedSets!==!1)},_set:function(te){Z("set:");var Oe=Array.from(te);return this._array(Oe,Ee.unorderedSets!==!1)},_file:function(te){return Z("file:"),this.dispatch([te.name,te.size,te.type,te.lastModfied])},_blob:function(){if(Ee.ignoreUnknown)return Z("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Z("domwindow")},_bigint:function(te){return Z("bigint:"+te.toString())},_process:function(){return Z("process")},_timer:function(){return Z("timer")},_pipe:function(){return Z("pipe")},_tcp:function(){return Z("tcp")},_udp:function(){return Z("udp")},_tty:function(){return Z("tty")},_statwatcher:function(){return Z("statwatcher")},_securecontext:function(){return Z("securecontext")},_connection:function(){return Z("connection")},_zlib:function(){return Z("zlib")},_context:function(){return Z("context")},_nodescript:function(){return Z("nodescript")},_httpparser:function(){return Z("httpparser")},_dataview:function(){return Z("dataview")},_signal:function(){return Z("signal")},_fsevent:function(){return Z("fsevent")},_tlswrap:function(){return Z("tlswrap")}}}function mt(){return{buf:"",write:function(Ee){this.buf+=Ee},end:function(Ee){this.buf+=Ee},read:function(){return this.buf}}}f.writeToStream=function(Ee,Ve,K){return K===void 0&&(K=Ve,Ve={}),ke(Ve=ue(Ee,Ve),K).dispatch(Ee)}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){(function(Qe){var je=typeof Uint8Array<"u"?Uint8Array:Array,me="+".charCodeAt(0),Te="/".charCodeAt(0),ue="0".charCodeAt(0),Ae="a".charCodeAt(0),ke="A".charCodeAt(0),mt="-".charCodeAt(0),Ee="_".charCodeAt(0);function Ve(K){var Z=K.charCodeAt(0);return Z===me||Z===mt?62:Z===Te||Z===Ee?63:Z<ue?-1:Z<ue+10?Z-ue+26+26:Z<ke+26?Z-ke:Z<Ae+26?Z-Ae+26:void 0}Qe.toByteArray=function(K){var Z,te;if(0<K.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Oe=K.length,ve=K.charAt(Oe-2)==="="?2:K.charAt(Oe-1)==="="?1:0,st=new je(3*K.length/4-ve),qt=0<ve?K.length-4:K.length,Vt=0;function tn(Bt){st[Vt++]=Bt}for(Z=0;Z<qt;Z+=4,0)tn((16711680&(te=Ve(K.charAt(Z))<<18|Ve(K.charAt(Z+1))<<12|Ve(K.charAt(Z+2))<<6|Ve(K.charAt(Z+3))))>>16),tn((65280&te)>>8),tn(255&te);return ve==2?tn(255&(te=Ve(K.charAt(Z))<<2|Ve(K.charAt(Z+1))>>4)):ve==1&&(tn((te=Ve(K.charAt(Z))<<10|Ve(K.charAt(Z+1))<<4|Ve(K.charAt(Z+2))>>2)>>8&255),tn(255&te)),st},Qe.fromByteArray=function(K){var Z,te,Oe,ve,st=K.length%3,qt="";function Vt(tn){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(tn)}for(Z=0,Oe=K.length-st;Z<Oe;Z+=3)qt+=Vt((ve=te=(K[Z]<<16)+(K[Z+1]<<8)+K[Z+2])>>18&63)+Vt(ve>>12&63)+Vt(ve>>6&63)+Vt(63&ve);switch(st){case 1:qt+=Vt((te=K[K.length-1])>>2),qt+=Vt(te<<4&63),qt+="==";break;case 2:qt+=Vt((te=(K[K.length-2]<<8)+K[K.length-1])>>10),qt+=Vt(te>>4&63),qt+=Vt(te<<2&63),qt+="="}return qt}})(f===void 0?this.base64js={}:f)}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(Tt,ct,f){(function(It,ht,me,rt,Ue,vt,wt,Je,Ye){var Qe=Tt("base64-js"),je=Tt("ieee754");function me(J,ae,Le){if(!(this instanceof me))return new me(J,ae,Le);var Kt,Qt,$t,jn,ni,Bi=typeof J;if(ae==="base64"&&Bi=="string")for(J=(Kt=J).trim?Kt.trim():Kt.replace(/^\s+|\s+$/g,"");J.length%4!=0;)J+="=";if(Bi=="number")Qt=Vt(J);else if(Bi=="string")Qt=me.byteLength(J,ae);else{if(Bi!="object")throw new Error("First argument needs to be a number, array or string.");Qt=Vt(J.length)}if(me._useTypedArrays?$t=me._augment(new Uint8Array(Qt)):(($t=this).length=Qt,$t._isBuffer=!0),me._useTypedArrays&&typeof J.byteLength=="number")$t._set(J);else if(tn(ni=J)||me.isBuffer(ni)||ni&&typeof ni=="object"&&typeof ni.length=="number")for(jn=0;jn<Qt;jn++)me.isBuffer(J)?$t[jn]=J.readUInt8(jn):$t[jn]=J[jn];else if(Bi=="string")$t.write(J,0,ae);else if(Bi=="number"&&!me._useTypedArrays&&!Le)for(jn=0;jn<Qt;jn++)$t[jn]=0;return $t}function Te(J,ae,Le,Kt){Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae!=null,"missing offset"),Ze(ae+1<J.length,"Trying to read beyond buffer length"));var Qt,$t=J.length;if(!($t<=ae))return Le?(Qt=J[ae],ae+1<$t&&(Qt|=J[ae+1]<<8)):(Qt=J[ae]<<8,ae+1<$t&&(Qt|=J[ae+1])),Qt}function ue(J,ae,Le,Kt){Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae!=null,"missing offset"),Ze(ae+3<J.length,"Trying to read beyond buffer length"));var Qt,$t=J.length;if(!($t<=ae))return Le?(ae+2<$t&&(Qt=J[ae+2]<<16),ae+1<$t&&(Qt|=J[ae+1]<<8),Qt|=J[ae],ae+3<$t&&(Qt+=J[ae+3]<<24>>>0)):(ae+1<$t&&(Qt=J[ae+1]<<16),ae+2<$t&&(Qt|=J[ae+2]<<8),ae+3<$t&&(Qt|=J[ae+3]),Qt+=J[ae]<<24>>>0),Qt}function Ae(J,ae,Le,Kt){if(Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae!=null,"missing offset"),Ze(ae+1<J.length,"Trying to read beyond buffer length")),!(J.length<=ae)){var Qt=Te(J,ae,Le,!0);return 32768&Qt?-1*(65535-Qt+1):Qt}}function ke(J,ae,Le,Kt){if(Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae!=null,"missing offset"),Ze(ae+3<J.length,"Trying to read beyond buffer length")),!(J.length<=ae)){var Qt=ue(J,ae,Le,!0);return 2147483648&Qt?-1*(4294967295-Qt+1):Qt}}function mt(J,ae,Le,Kt){return Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae+3<J.length,"Trying to read beyond buffer length")),je.read(J,ae,Le,23,4)}function Ee(J,ae,Le,Kt){return Kt||(Ze(typeof Le=="boolean","missing or invalid endian"),Ze(ae+7<J.length,"Trying to read beyond buffer length")),je.read(J,ae,Le,52,8)}function Ve(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+1<J.length,"trying to write beyond buffer length"),xt(ae,65535));var $t=J.length;if(!($t<=Le))for(var jn=0,ni=Math.min($t-Le,2);jn<ni;jn++)J[Le+jn]=(ae&255<<8*(Kt?jn:1-jn))>>>8*(Kt?jn:1-jn)}function K(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+3<J.length,"trying to write beyond buffer length"),xt(ae,4294967295));var $t=J.length;if(!($t<=Le))for(var jn=0,ni=Math.min($t-Le,4);jn<ni;jn++)J[Le+jn]=ae>>>8*(Kt?jn:3-jn)&255}function Z(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+1<J.length,"Trying to write beyond buffer length"),pt(ae,32767,-32768)),J.length<=Le||Ve(J,0<=ae?ae:65535+ae+1,Le,Kt,Qt)}function te(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+3<J.length,"Trying to write beyond buffer length"),pt(ae,2147483647,-2147483648)),J.length<=Le||K(J,0<=ae?ae:4294967295+ae+1,Le,Kt,Qt)}function Oe(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+3<J.length,"Trying to write beyond buffer length"),Gt(ae,34028234663852886e22,-34028234663852886e22)),J.length<=Le||je.write(J,ae,Le,Kt,23,4)}function ve(J,ae,Le,Kt,Qt){Qt||(Ze(ae!=null,"missing value"),Ze(typeof Kt=="boolean","missing or invalid endian"),Ze(Le!=null,"missing offset"),Ze(Le+7<J.length,"Trying to write beyond buffer length"),Gt(ae,17976931348623157e292,-17976931348623157e292)),J.length<=Le||je.write(J,ae,Le,Kt,52,8)}f.Buffer=me,f.SlowBuffer=me,f.INSPECT_MAX_BYTES=50,me.poolSize=8192,me._useTypedArrays=function(){try{var J=new ArrayBuffer(0),ae=new Uint8Array(J);return ae.foo=function(){return 42},ae.foo()===42&&typeof ae.subarray=="function"}catch{return!1}}(),me.isEncoding=function(J){switch(String(J).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},me.isBuffer=function(J){return!(J==null||!J._isBuffer)},me.byteLength=function(J,ae){var Le;switch(J+="",ae||"utf8"){case"hex":Le=J.length/2;break;case"utf8":case"utf-8":Le=on(J).length;break;case"ascii":case"binary":case"raw":Le=J.length;break;case"base64":Le=Yt(J).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Le=2*J.length;break;default:throw new Error("Unknown encoding")}return Le},me.concat=function(J,ae){if(Ze(tn(J),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),J.length===0)return new me(0);if(J.length===1)return J[0];if(typeof ae!="number")for(Qt=ae=0;Qt<J.length;Qt++)ae+=J[Qt].length;for(var Le=new me(ae),Kt=0,Qt=0;Qt<J.length;Qt++){var $t=J[Qt];$t.copy(Le,Kt),Kt+=$t.length}return Le},me.prototype.write=function(J,ae,Le,Kt){var Qt;isFinite(ae)?isFinite(Le)||(Kt=Le,Le=void 0):(Qt=Kt,Kt=ae,ae=Le,Le=Qt),ae=Number(ae)||0;var $t,jn,ni,Bi,pi,Xi,fi,ar=this.length-ae;switch((!Le||ar<(Le=Number(Le)))&&(Le=ar),Kt=String(Kt||"utf8").toLowerCase()){case"hex":$t=function(ki,Qs,fs,vr){fs=Number(fs)||0;var Wi=ki.length-fs;(!vr||Wi<(vr=Number(vr)))&&(vr=Wi);var zr=Qs.length;Ze(zr%2==0,"Invalid hex string"),zr/2<vr&&(vr=zr/2);for(var Qi=0;Qi<vr;Qi++){var Vs=parseInt(Qs.substr(2*Qi,2),16);Ze(!isNaN(Vs),"Invalid hex string"),ki[fs+Qi]=Vs}return me._charsWritten=2*Qi,Qi}(this,J,ae,Le);break;case"utf8":case"utf-8":pi=J,Xi=ae,fi=Le,$t=me._charsWritten=Xt(on(pi),this,Xi,fi);break;case"ascii":case"binary":$t=function(ki,Qs,fs,vr){return me._charsWritten=Xt(function(Wi){for(var zr=[],Qi=0;Qi<Wi.length;Qi++)zr.push(255&Wi.charCodeAt(Qi));return zr}(Qs),ki,fs,vr)}(this,J,ae,Le);break;case"base64":jn=J,ni=ae,Bi=Le,$t=me._charsWritten=Xt(Yt(jn),this,ni,Bi);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":$t=function(ki,Qs,fs,vr){return me._charsWritten=Xt(function(Wi){for(var zr,Qi,Vs,Ts=[],Ki=0;Ki<Wi.length;Ki++)Qi=(zr=Wi.charCodeAt(Ki))>>8,Vs=zr%256,Ts.push(Vs),Ts.push(Qi);return Ts}(Qs),ki,fs,vr)}(this,J,ae,Le);break;default:throw new Error("Unknown encoding")}return $t},me.prototype.toString=function(J,ae,Le){var Kt,Qt,$t,jn,ni=this;if(J=String(J||"utf8").toLowerCase(),ae=Number(ae)||0,(Le=Le!==void 0?Number(Le):Le=ni.length)===ae)return"";switch(J){case"hex":Kt=function(Bi,pi,Xi){var fi=Bi.length;(!pi||pi<0)&&(pi=0),(!Xi||Xi<0||fi<Xi)&&(Xi=fi);for(var ar="",ki=pi;ki<Xi;ki++)ar+=Bt(Bi[ki]);return ar}(ni,ae,Le);break;case"utf8":case"utf-8":Kt=function(Bi,pi,Xi){var fi="",ar="";Xi=Math.min(Bi.length,Xi);for(var ki=pi;ki<Xi;ki++)Bi[ki]<=127?(fi+=et(ar)+String.fromCharCode(Bi[ki]),ar=""):ar+="%"+Bi[ki].toString(16);return fi+et(ar)}(ni,ae,Le);break;case"ascii":case"binary":Kt=function(Bi,pi,Xi){var fi="";Xi=Math.min(Bi.length,Xi);for(var ar=pi;ar<Xi;ar++)fi+=String.fromCharCode(Bi[ar]);return fi}(ni,ae,Le);break;case"base64":Qt=ni,jn=Le,Kt=($t=ae)===0&&jn===Qt.length?Qe.fromByteArray(Qt):Qe.fromByteArray(Qt.slice($t,jn));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Kt=function(Bi,pi,Xi){for(var fi=Bi.slice(pi,Xi),ar="",ki=0;ki<fi.length;ki+=2)ar+=String.fromCharCode(fi[ki]+256*fi[ki+1]);return ar}(ni,ae,Le);break;default:throw new Error("Unknown encoding")}return Kt},me.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},me.prototype.copy=function(J,ae,Le,Kt){if(Le=Le||0,Kt||Kt===0||(Kt=this.length),ae=ae||0,Kt!==Le&&J.length!==0&&this.length!==0){Ze(Le<=Kt,"sourceEnd < sourceStart"),Ze(0<=ae&&ae<J.length,"targetStart out of bounds"),Ze(0<=Le&&Le<this.length,"sourceStart out of bounds"),Ze(0<=Kt&&Kt<=this.length,"sourceEnd out of bounds"),Kt>this.length&&(Kt=this.length),J.length-ae<Kt-Le&&(Kt=J.length-ae+Le);var Qt=Kt-Le;if(Qt<100||!me._useTypedArrays)for(var $t=0;$t<Qt;$t++)J[$t+ae]=this[$t+Le];else J._set(this.subarray(Le,Le+Qt),ae)}},me.prototype.slice=function(J,ae){var Le=this.length;if(J=qt(J,Le,0),ae=qt(ae,Le,Le),me._useTypedArrays)return me._augment(this.subarray(J,ae));for(var Kt=ae-J,Qt=new me(Kt,void 0,!0),$t=0;$t<Kt;$t++)Qt[$t]=this[$t+J];return Qt},me.prototype.get=function(J){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(J)},me.prototype.set=function(J,ae){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(J,ae)},me.prototype.readUInt8=function(J,ae){if(ae||(Ze(J!=null,"missing offset"),Ze(J<this.length,"Trying to read beyond buffer length")),!(J>=this.length))return this[J]},me.prototype.readUInt16LE=function(J,ae){return Te(this,J,!0,ae)},me.prototype.readUInt16BE=function(J,ae){return Te(this,J,!1,ae)},me.prototype.readUInt32LE=function(J,ae){return ue(this,J,!0,ae)},me.prototype.readUInt32BE=function(J,ae){return ue(this,J,!1,ae)},me.prototype.readInt8=function(J,ae){if(ae||(Ze(J!=null,"missing offset"),Ze(J<this.length,"Trying to read beyond buffer length")),!(J>=this.length))return 128&this[J]?-1*(255-this[J]+1):this[J]},me.prototype.readInt16LE=function(J,ae){return Ae(this,J,!0,ae)},me.prototype.readInt16BE=function(J,ae){return Ae(this,J,!1,ae)},me.prototype.readInt32LE=function(J,ae){return ke(this,J,!0,ae)},me.prototype.readInt32BE=function(J,ae){return ke(this,J,!1,ae)},me.prototype.readFloatLE=function(J,ae){return mt(this,J,!0,ae)},me.prototype.readFloatBE=function(J,ae){return mt(this,J,!1,ae)},me.prototype.readDoubleLE=function(J,ae){return Ee(this,J,!0,ae)},me.prototype.readDoubleBE=function(J,ae){return Ee(this,J,!1,ae)},me.prototype.writeUInt8=function(J,ae,Le){Le||(Ze(J!=null,"missing value"),Ze(ae!=null,"missing offset"),Ze(ae<this.length,"trying to write beyond buffer length"),xt(J,255)),ae>=this.length||(this[ae]=J)},me.prototype.writeUInt16LE=function(J,ae,Le){Ve(this,J,ae,!0,Le)},me.prototype.writeUInt16BE=function(J,ae,Le){Ve(this,J,ae,!1,Le)},me.prototype.writeUInt32LE=function(J,ae,Le){K(this,J,ae,!0,Le)},me.prototype.writeUInt32BE=function(J,ae,Le){K(this,J,ae,!1,Le)},me.prototype.writeInt8=function(J,ae,Le){Le||(Ze(J!=null,"missing value"),Ze(ae!=null,"missing offset"),Ze(ae<this.length,"Trying to write beyond buffer length"),pt(J,127,-128)),ae>=this.length||(0<=J?this.writeUInt8(J,ae,Le):this.writeUInt8(255+J+1,ae,Le))},me.prototype.writeInt16LE=function(J,ae,Le){Z(this,J,ae,!0,Le)},me.prototype.writeInt16BE=function(J,ae,Le){Z(this,J,ae,!1,Le)},me.prototype.writeInt32LE=function(J,ae,Le){te(this,J,ae,!0,Le)},me.prototype.writeInt32BE=function(J,ae,Le){te(this,J,ae,!1,Le)},me.prototype.writeFloatLE=function(J,ae,Le){Oe(this,J,ae,!0,Le)},me.prototype.writeFloatBE=function(J,ae,Le){Oe(this,J,ae,!1,Le)},me.prototype.writeDoubleLE=function(J,ae,Le){ve(this,J,ae,!0,Le)},me.prototype.writeDoubleBE=function(J,ae,Le){ve(this,J,ae,!1,Le)},me.prototype.fill=function(J,ae,Le){if(J=J||0,ae=ae||0,Le=Le||this.length,typeof J=="string"&&(J=J.charCodeAt(0)),Ze(typeof J=="number"&&!isNaN(J),"value is not a number"),Ze(ae<=Le,"end < start"),Le!==ae&&this.length!==0){Ze(0<=ae&&ae<this.length,"start out of bounds"),Ze(0<=Le&&Le<=this.length,"end out of bounds");for(var Kt=ae;Kt<Le;Kt++)this[Kt]=J}},me.prototype.inspect=function(){for(var J=[],ae=this.length,Le=0;Le<ae;Le++)if(J[Le]=Bt(this[Le]),Le===f.INSPECT_MAX_BYTES){J[Le+1]="...";break}return"<Buffer "+J.join(" ")+">"},me.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(me._useTypedArrays)return new me(this).buffer;for(var J=new Uint8Array(this.length),ae=0,Le=J.length;ae<Le;ae+=1)J[ae]=this[ae];return J.buffer};var st=me.prototype;function qt(J,ae,Le){return typeof J!="number"?Le:ae<=(J=~~J)?ae:0<=J||0<=(J+=ae)?J:0}function Vt(J){return(J=~~Math.ceil(+J))<0?0:J}function tn(J){return(Array.isArray||function(ae){return Object.prototype.toString.call(ae)==="[object Array]"})(J)}function Bt(J){return J<16?"0"+J.toString(16):J.toString(16)}function on(J){for(var ae=[],Le=0;Le<J.length;Le++){var Kt=J.charCodeAt(Le);if(Kt<=127)ae.push(J.charCodeAt(Le));else{var Qt=Le;55296<=Kt&&Kt<=57343&&Le++;for(var $t=encodeURIComponent(J.slice(Qt,Le+1)).substr(1).split("%"),jn=0;jn<$t.length;jn++)ae.push(parseInt($t[jn],16))}}return ae}function Yt(J){return Qe.toByteArray(J)}function Xt(J,ae,Le,Kt){for(var Qt=0;Qt<Kt&&!(Qt+Le>=ae.length||Qt>=J.length);Qt++)ae[Qt+Le]=J[Qt];return Qt}function et(J){try{return decodeURIComponent(J)}catch{return String.fromCharCode(65533)}}function xt(J,ae){Ze(typeof J=="number","cannot write a non-number as a number"),Ze(0<=J,"specified a negative value for writing an unsigned value"),Ze(J<=ae,"value is larger than maximum value for type"),Ze(Math.floor(J)===J,"value has a fractional component")}function pt(J,ae,Le){Ze(typeof J=="number","cannot write a non-number as a number"),Ze(J<=ae,"value larger than maximum allowed value"),Ze(Le<=J,"value smaller than minimum allowed value"),Ze(Math.floor(J)===J,"value has a fractional component")}function Gt(J,ae,Le){Ze(typeof J=="number","cannot write a non-number as a number"),Ze(J<=ae,"value larger than maximum allowed value"),Ze(Le<=J,"value smaller than minimum allowed value")}function Ze(J,ae){if(!J)throw new Error(ae||"Failed assertion")}me._augment=function(J){return J._isBuffer=!0,J._get=J.get,J._set=J.set,J.get=st.get,J.set=st.set,J.write=st.write,J.toString=st.toString,J.toLocaleString=st.toString,J.toJSON=st.toJSON,J.copy=st.copy,J.slice=st.slice,J.readUInt8=st.readUInt8,J.readUInt16LE=st.readUInt16LE,J.readUInt16BE=st.readUInt16BE,J.readUInt32LE=st.readUInt32LE,J.readUInt32BE=st.readUInt32BE,J.readInt8=st.readInt8,J.readInt16LE=st.readInt16LE,J.readInt16BE=st.readInt16BE,J.readInt32LE=st.readInt32LE,J.readInt32BE=st.readInt32BE,J.readFloatLE=st.readFloatLE,J.readFloatBE=st.readFloatBE,J.readDoubleLE=st.readDoubleLE,J.readDoubleBE=st.readDoubleBE,J.writeUInt8=st.writeUInt8,J.writeUInt16LE=st.writeUInt16LE,J.writeUInt16BE=st.writeUInt16BE,J.writeUInt32LE=st.writeUInt32LE,J.writeUInt32BE=st.writeUInt32BE,J.writeInt8=st.writeInt8,J.writeInt16LE=st.writeInt16LE,J.writeInt16BE=st.writeInt16BE,J.writeInt32LE=st.writeInt32LE,J.writeInt32BE=st.writeInt32BE,J.writeFloatLE=st.writeFloatLE,J.writeFloatBE=st.writeFloatBE,J.writeDoubleLE=st.writeDoubleLE,J.writeDoubleBE=st.writeDoubleBE,J.fill=st.fill,J.inspect=st.inspect,J.toArrayBuffer=st.toArrayBuffer,J}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){Ge=Tt("buffer").Buffer;var Qe=new Ge(4);Qe.fill(0),ct.exports={hash:function(je,me,Te,ue){return Ge.isBuffer(je)||(je=new Ge(je)),function(Ae,ke,mt){for(var Ee=new Ge(ke),Ve=mt?Ee.writeInt32BE:Ee.writeInt32LE,K=0;K<Ae.length;K++)Ve.call(Ee,Ae[K],4*K,!0);return Ee}(me(function(Ae,ke){var mt;Ae.length%4!=0&&(mt=Ae.length+(4-Ae.length%4),Ae=Ge.concat([Ae,Qe],mt));for(var Ee=[],Ve=ke?Ae.readInt32BE:Ae.readInt32LE,K=0;K<Ae.length;K+=4)Ee.push(Ve.call(Ae,K));return Ee}(je,ue),8*je.length),Te,ue)}}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){Ge=Tt("buffer").Buffer;var Qe=Tt("./sha"),je=Tt("./sha256"),me=Tt("./rng"),Te={sha1:Qe,sha256:je,md5:Tt("./md5")},ue=64,Ae=new Ge(ue);function ke(Ee,Ve){var K=Te[Ee=Ee||"sha1"],Z=[];return K||mt("algorithm:",Ee,"is not yet supported"),{update:function(te){return Ge.isBuffer(te)||(te=new Ge(te)),Z.push(te),te.length,this},digest:function(te){var Oe=Ge.concat(Z),ve=Ve?function(st,qt,Vt){Ge.isBuffer(qt)||(qt=new Ge(qt)),Ge.isBuffer(Vt)||(Vt=new Ge(Vt)),qt.length>ue?qt=st(qt):qt.length<ue&&(qt=Ge.concat([qt,Ae],ue));for(var tn=new Ge(ue),Bt=new Ge(ue),on=0;on<ue;on++)tn[on]=54^qt[on],Bt[on]=92^qt[on];var Yt=st(Ge.concat([tn,Vt]));return st(Ge.concat([Bt,Yt]))}(K,Ve,Oe):K(Oe);return Z=null,te?ve.toString(te):ve}}}function mt(){var Ee=[].slice.call(arguments).join(" ");throw new Error([Ee,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Ae.fill(0),f.createHash=function(Ee){return ke(Ee)},f.createHmac=ke,f.randomBytes=function(Ee,Ve){if(!Ve||!Ve.call)return new Ge(me(Ee));try{Ve.call(this,void 0,new Ge(me(Ee)))}catch(K){Ve(K)}},function(Ee,Ve){for(var K in Ee)Ve(Ee[K])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(Ee){f[Ee]=function(){mt("sorry,",Ee,"is not implemented yet")}})}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){var Qe=Tt("./helpers");function je(Ee,Ve){Ee[Ve>>5]|=128<<Ve%32,Ee[14+(Ve+64>>>9<<4)]=Ve;for(var K=1732584193,Z=-271733879,te=-1732584194,Oe=271733878,ve=0;ve<Ee.length;ve+=16){var st=K,qt=Z,Vt=te,tn=Oe;K=Te(K,Z,te,Oe,Ee[ve+0],7,-680876936),Oe=Te(Oe,K,Z,te,Ee[ve+1],12,-389564586),te=Te(te,Oe,K,Z,Ee[ve+2],17,606105819),Z=Te(Z,te,Oe,K,Ee[ve+3],22,-1044525330),K=Te(K,Z,te,Oe,Ee[ve+4],7,-176418897),Oe=Te(Oe,K,Z,te,Ee[ve+5],12,1200080426),te=Te(te,Oe,K,Z,Ee[ve+6],17,-1473231341),Z=Te(Z,te,Oe,K,Ee[ve+7],22,-45705983),K=Te(K,Z,te,Oe,Ee[ve+8],7,1770035416),Oe=Te(Oe,K,Z,te,Ee[ve+9],12,-1958414417),te=Te(te,Oe,K,Z,Ee[ve+10],17,-42063),Z=Te(Z,te,Oe,K,Ee[ve+11],22,-1990404162),K=Te(K,Z,te,Oe,Ee[ve+12],7,1804603682),Oe=Te(Oe,K,Z,te,Ee[ve+13],12,-40341101),te=Te(te,Oe,K,Z,Ee[ve+14],17,-1502002290),K=ue(K,Z=Te(Z,te,Oe,K,Ee[ve+15],22,1236535329),te,Oe,Ee[ve+1],5,-165796510),Oe=ue(Oe,K,Z,te,Ee[ve+6],9,-1069501632),te=ue(te,Oe,K,Z,Ee[ve+11],14,643717713),Z=ue(Z,te,Oe,K,Ee[ve+0],20,-373897302),K=ue(K,Z,te,Oe,Ee[ve+5],5,-701558691),Oe=ue(Oe,K,Z,te,Ee[ve+10],9,38016083),te=ue(te,Oe,K,Z,Ee[ve+15],14,-660478335),Z=ue(Z,te,Oe,K,Ee[ve+4],20,-405537848),K=ue(K,Z,te,Oe,Ee[ve+9],5,568446438),Oe=ue(Oe,K,Z,te,Ee[ve+14],9,-1019803690),te=ue(te,Oe,K,Z,Ee[ve+3],14,-187363961),Z=ue(Z,te,Oe,K,Ee[ve+8],20,1163531501),K=ue(K,Z,te,Oe,Ee[ve+13],5,-1444681467),Oe=ue(Oe,K,Z,te,Ee[ve+2],9,-51403784),te=ue(te,Oe,K,Z,Ee[ve+7],14,1735328473),K=Ae(K,Z=ue(Z,te,Oe,K,Ee[ve+12],20,-1926607734),te,Oe,Ee[ve+5],4,-378558),Oe=Ae(Oe,K,Z,te,Ee[ve+8],11,-2022574463),te=Ae(te,Oe,K,Z,Ee[ve+11],16,1839030562),Z=Ae(Z,te,Oe,K,Ee[ve+14],23,-35309556),K=Ae(K,Z,te,Oe,Ee[ve+1],4,-1530992060),Oe=Ae(Oe,K,Z,te,Ee[ve+4],11,1272893353),te=Ae(te,Oe,K,Z,Ee[ve+7],16,-155497632),Z=Ae(Z,te,Oe,K,Ee[ve+10],23,-1094730640),K=Ae(K,Z,te,Oe,Ee[ve+13],4,681279174),Oe=Ae(Oe,K,Z,te,Ee[ve+0],11,-358537222),te=Ae(te,Oe,K,Z,Ee[ve+3],16,-722521979),Z=Ae(Z,te,Oe,K,Ee[ve+6],23,76029189),K=Ae(K,Z,te,Oe,Ee[ve+9],4,-640364487),Oe=Ae(Oe,K,Z,te,Ee[ve+12],11,-421815835),te=Ae(te,Oe,K,Z,Ee[ve+15],16,530742520),K=ke(K,Z=Ae(Z,te,Oe,K,Ee[ve+2],23,-995338651),te,Oe,Ee[ve+0],6,-198630844),Oe=ke(Oe,K,Z,te,Ee[ve+7],10,1126891415),te=ke(te,Oe,K,Z,Ee[ve+14],15,-1416354905),Z=ke(Z,te,Oe,K,Ee[ve+5],21,-57434055),K=ke(K,Z,te,Oe,Ee[ve+12],6,1700485571),Oe=ke(Oe,K,Z,te,Ee[ve+3],10,-1894986606),te=ke(te,Oe,K,Z,Ee[ve+10],15,-1051523),Z=ke(Z,te,Oe,K,Ee[ve+1],21,-2054922799),K=ke(K,Z,te,Oe,Ee[ve+8],6,1873313359),Oe=ke(Oe,K,Z,te,Ee[ve+15],10,-30611744),te=ke(te,Oe,K,Z,Ee[ve+6],15,-1560198380),Z=ke(Z,te,Oe,K,Ee[ve+13],21,1309151649),K=ke(K,Z,te,Oe,Ee[ve+4],6,-145523070),Oe=ke(Oe,K,Z,te,Ee[ve+11],10,-1120210379),te=ke(te,Oe,K,Z,Ee[ve+2],15,718787259),Z=ke(Z,te,Oe,K,Ee[ve+9],21,-343485551),K=mt(K,st),Z=mt(Z,qt),te=mt(te,Vt),Oe=mt(Oe,tn)}return Array(K,Z,te,Oe)}function me(Ee,Ve,K,Z,te,Oe){return mt((ve=mt(mt(Ve,Ee),mt(Z,Oe)))<<(st=te)|ve>>>32-st,K);var ve,st}function Te(Ee,Ve,K,Z,te,Oe,ve){return me(Ve&K|~Ve&Z,Ee,Ve,te,Oe,ve)}function ue(Ee,Ve,K,Z,te,Oe,ve){return me(Ve&Z|K&~Z,Ee,Ve,te,Oe,ve)}function Ae(Ee,Ve,K,Z,te,Oe,ve){return me(Ve^K^Z,Ee,Ve,te,Oe,ve)}function ke(Ee,Ve,K,Z,te,Oe,ve){return me(K^(Ve|~Z),Ee,Ve,te,Oe,ve)}function mt(Ee,Ve){var K=(65535&Ee)+(65535&Ve);return(Ee>>16)+(Ve>>16)+(K>>16)<<16|65535&K}ct.exports=function(Ee){return Qe.hash(Ee,je,16)}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){var Qe;Qe=function(je){for(var me,Te=new Array(je),ue=0;ue<je;ue++)!(3&ue)&&(me=4294967296*Math.random()),Te[ue]=me>>>((3&ue)<<3)&255;return Te},ct.exports=Qe}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){var Qe=Tt("./helpers");function je(ue,Ae){ue[Ae>>5]|=128<<24-Ae%32,ue[15+(Ae+64>>9<<4)]=Ae;for(var ke,mt,Ee,Ve,K,Z=Array(80),te=1732584193,Oe=-271733879,ve=-1732584194,st=271733878,qt=-1009589776,Vt=0;Vt<ue.length;Vt+=16){for(var tn=te,Bt=Oe,on=ve,Yt=st,Xt=qt,et=0;et<80;et++){Z[et]=et<16?ue[Vt+et]:Te(Z[et-3]^Z[et-8]^Z[et-14]^Z[et-16],1);var xt=me(me(Te(te,5),(Ee=Oe,Ve=ve,K=st,(mt=et)<20?Ee&Ve|~Ee&K:!(mt<40)&&mt<60?Ee&Ve|Ee&K|Ve&K:Ee^Ve^K)),me(me(qt,Z[et]),(ke=et)<20?1518500249:ke<40?1859775393:ke<60?-1894007588:-899497514));qt=st,st=ve,ve=Te(Oe,30),Oe=te,te=xt}te=me(te,tn),Oe=me(Oe,Bt),ve=me(ve,on),st=me(st,Yt),qt=me(qt,Xt)}return Array(te,Oe,ve,st,qt)}function me(ue,Ae){var ke=(65535&ue)+(65535&Ae);return(ue>>16)+(Ae>>16)+(ke>>16)<<16|65535&ke}function Te(ue,Ae){return ue<<Ae|ue>>>32-Ae}ct.exports=function(ue){return Qe.hash(ue,je,20,!0)}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){function Qe(ue,Ae){var ke=(65535&ue)+(65535&Ae);return(ue>>16)+(Ae>>16)+(ke>>16)<<16|65535&ke}function je(ue,Ae){return ue>>>Ae|ue<<32-Ae}function me(ue,Ae){var ke,mt,Ee,Ve,K,Z,te,Oe,ve,st,qt=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),Vt=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),tn=new Array(64);ue[Ae>>5]|=128<<24-Ae%32,ue[15+(Ae+64>>9<<4)]=Ae;for(var Bt,on,Yt,Xt,et,xt,pt,Gt,Ze=0;Ze<ue.length;Ze+=16){ke=Vt[0],mt=Vt[1],Ee=Vt[2],Ve=Vt[3],K=Vt[4],Z=Vt[5],te=Vt[6],Oe=Vt[7];for(var J=0;J<64;J++)tn[J]=J<16?ue[J+Ze]:Qe(Qe(Qe(je(Gt=tn[J-2],17)^je(Gt,19)^Gt>>>10,tn[J-7]),je(pt=tn[J-15],7)^je(pt,18)^pt>>>3),tn[J-16]),ve=Qe(Qe(Qe(Qe(Oe,je(xt=K,6)^je(xt,11)^je(xt,25)),(et=K)&Z^~et&te),qt[J]),tn[J]),st=Qe(je(Xt=ke,2)^je(Xt,13)^je(Xt,22),(Bt=ke)&(on=mt)^Bt&(Yt=Ee)^on&Yt),Oe=te,te=Z,Z=K,K=Qe(Ve,ve),Ve=Ee,Ee=mt,mt=ke,ke=Qe(ve,st);Vt[0]=Qe(ke,Vt[0]),Vt[1]=Qe(mt,Vt[1]),Vt[2]=Qe(Ee,Vt[2]),Vt[3]=Qe(Ve,Vt[3]),Vt[4]=Qe(K,Vt[4]),Vt[5]=Qe(Z,Vt[5]),Vt[6]=Qe(te,Vt[6]),Vt[7]=Qe(Oe,Vt[7])}return Vt}var Te=Tt("./helpers");ct.exports=function(ue){return Te.hash(ue,me,32,!0)}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){function Qe(){}(It=ct.exports={}).nextTick=function(){var je=typeof window<"u"&&window.setImmediate,me=typeof window<"u"&&window.postMessage&&window.addEventListener;if(je)return function(ue){return window.setImmediate(ue)};if(me){var Te=[];return window.addEventListener("message",function(ue){var Ae=ue.source;Ae!==window&&Ae!==null||ue.data!=="process-tick"||(ue.stopPropagation(),0<Te.length&&Te.shift()())},!0),function(ue){Te.push(ue),window.postMessage("process-tick","*")}}return function(ue){setTimeout(ue,0)}}(),It.title="browser",It.browser=!0,It.env={},It.argv=[],It.on=Qe,It.addListener=Qe,It.once=Qe,It.off=Qe,It.removeListener=Qe,It.removeAllListeners=Qe,It.emit=Qe,It.binding=function(je){throw new Error("process.binding is not supported")},It.cwd=function(){return"/"},It.chdir=function(je){throw new Error("process.chdir is not supported")}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(Tt,ct,f){(function(It,ht,Ge,rt,Ue,vt,wt,Je,Ye){f.read=function(Qe,je,me,Te,ue){var Ae,ke,mt=8*ue-Te-1,Ee=(1<<mt)-1,Ve=Ee>>1,K=-7,Z=me?ue-1:0,te=me?-1:1,Oe=Qe[je+Z];for(Z+=te,Ae=Oe&(1<<-K)-1,Oe>>=-K,K+=mt;0<K;Ae=256*Ae+Qe[je+Z],Z+=te,K-=8);for(ke=Ae&(1<<-K)-1,Ae>>=-K,K+=Te;0<K;ke=256*ke+Qe[je+Z],Z+=te,K-=8);if(Ae===0)Ae=1-Ve;else{if(Ae===Ee)return ke?NaN:1/0*(Oe?-1:1);ke+=Math.pow(2,Te),Ae-=Ve}return(Oe?-1:1)*ke*Math.pow(2,Ae-Te)},f.write=function(Qe,je,me,Te,ue,Ae){var ke,mt,Ee,Ve=8*Ae-ue-1,K=(1<<Ve)-1,Z=K>>1,te=ue===23?Math.pow(2,-24)-Math.pow(2,-77):0,Oe=Te?0:Ae-1,ve=Te?1:-1,st=je<0||je===0&&1/je<0?1:0;for(je=Math.abs(je),isNaN(je)||je===1/0?(mt=isNaN(je)?1:0,ke=K):(ke=Math.floor(Math.log(je)/Math.LN2),je*(Ee=Math.pow(2,-ke))<1&&(ke--,Ee*=2),2<=(je+=1<=ke+Z?te/Ee:te*Math.pow(2,1-Z))*Ee&&(ke++,Ee/=2),K<=ke+Z?(mt=0,ke=K):1<=ke+Z?(mt=(je*Ee-1)*Math.pow(2,ue),ke+=Z):(mt=je*Math.pow(2,Z-1)*Math.pow(2,ue),ke=0));8<=ue;Qe[me+Oe]=255&mt,Oe+=ve,mt/=256,ue-=8);for(ke=ke<<ue|mt,Ve+=ue;0<Ve;Qe[me+Oe]=255&ke,Oe+=ve,ke/=256,Ve-=8);Qe[me+Oe-ve]|=128*st}}).call(this,Tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},Tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(Mn){var Tt=function(){function ct(me){return wt(me,Je(vt(Ye(me.length),me),1/me.length))}function f(me){return vt(Qe(me),me)}function It(me,Te){return Je(me,Te?1/(me.length-1):1/me.length)}function ht(me){var Te=function(Ae){var ke,mt=Math.pow(2,-52),Ee=1e-64/mt,Ve=0,K=0,Z=0,te=0,Oe=0,ve=je(Ae),st=ve.length,qt=ve[0].length;if(st<qt)throw"Need more rows than columns";var Vt=new Array(qt),tn=new Array(qt);for(K=0;K<qt;K++)Vt[K]=tn[K]=0;var Bt=function Kt(Qt,$t,jn){jn===void 0&&(jn=0);var ni,Bi=Qt[jn],pi=Array(Bi);if(jn===Qt.length-1){for(ni=Bi-2;ni>=0;ni-=2)pi[ni+1]=$t,pi[ni]=$t;return ni===-1&&(pi[0]=$t),pi}for(ni=Bi-1;ni>=0;ni--)pi[ni]=Kt(Qt,$t,jn+1);return pi}([qt,qt],0);function on(Kt,Qt){return(Kt=Math.abs(Kt))>(Qt=Math.abs(Qt))?Kt*Math.sqrt(1+Qt*Qt/Kt/Kt):Qt==0?Kt:Qt*Math.sqrt(1+Kt*Kt/Qt/Qt)}var Yt=0,Xt=0,et=0,xt=0,pt=0,Gt=0,Ze=0;for(K=0;K<qt;K++){for(Vt[K]=Xt,Ze=0,Oe=K+1,Z=K;Z<st;Z++)Ze+=ve[Z][K]*ve[Z][K];if(Ze<=Ee)Xt=0;else for(Yt=ve[K][K],Xt=Math.sqrt(Ze),Yt>=0&&(Xt=-Xt),et=Yt*Xt-Ze,ve[K][K]=Yt-Xt,Z=Oe;Z<qt;Z++){for(Ze=0,te=K;te<st;te++)Ze+=ve[te][K]*ve[te][Z];for(Yt=Ze/et,te=K;te<st;te++)ve[te][Z]+=Yt*ve[te][K]}for(tn[K]=Xt,Ze=0,Z=Oe;Z<qt;Z++)Ze+=ve[K][Z]*ve[K][Z];if(Ze<=Ee)Xt=0;else{for(Yt=ve[K][K+1],Xt=Math.sqrt(Ze),Yt>=0&&(Xt=-Xt),et=Yt*Xt-Ze,ve[K][K+1]=Yt-Xt,Z=Oe;Z<qt;Z++)Vt[Z]=ve[K][Z]/et;for(Z=Oe;Z<st;Z++){for(Ze=0,te=Oe;te<qt;te++)Ze+=ve[Z][te]*ve[K][te];for(te=Oe;te<qt;te++)ve[Z][te]+=Ze*Vt[te]}}(pt=Math.abs(tn[K])+Math.abs(Vt[K]))>xt&&(xt=pt)}for(K=qt-1;K!=-1;K+=-1){if(Xt!=0){for(et=Xt*ve[K][K+1],Z=Oe;Z<qt;Z++)Bt[Z][K]=ve[K][Z]/et;for(Z=Oe;Z<qt;Z++){for(Ze=0,te=Oe;te<qt;te++)Ze+=ve[K][te]*Bt[te][Z];for(te=Oe;te<qt;te++)Bt[te][Z]+=Ze*Bt[te][K]}}for(Z=Oe;Z<qt;Z++)Bt[K][Z]=0,Bt[Z][K]=0;Bt[K][K]=1,Xt=Vt[K],Oe=K}for(K=qt-1;K!=-1;K+=-1){for(Oe=K+1,Xt=tn[K],Z=Oe;Z<qt;Z++)ve[K][Z]=0;if(Xt!=0){for(et=ve[K][K]*Xt,Z=Oe;Z<qt;Z++){for(Ze=0,te=Oe;te<st;te++)Ze+=ve[te][K]*ve[te][Z];for(Yt=Ze/et,te=K;te<st;te++)ve[te][Z]+=Yt*ve[te][K]}for(Z=K;Z<st;Z++)ve[Z][K]=ve[Z][K]/Xt}else for(Z=K;Z<st;Z++)ve[Z][K]=0;ve[K][K]+=1}for(mt*=xt,te=qt-1;te!=-1;te+=-1)for(var J=0;J<50;J++){var ae=!1;for(Oe=te;Oe!=-1;Oe+=-1){if(Math.abs(Vt[Oe])<=mt){ae=!0;break}if(Math.abs(tn[Oe-1])<=mt)break}if(!ae){Ve=0,Ze=1;var Le=Oe-1;for(K=Oe;K<te+1&&(Yt=Ze*Vt[K],Vt[K]=Ve*Vt[K],!(Math.abs(Yt)<=mt));K++)for(et=on(Yt,Xt=tn[K]),tn[K]=et,Ve=Xt/et,Ze=-Yt/et,Z=0;Z<st;Z++)pt=ve[Z][Le],Gt=ve[Z][K],ve[Z][Le]=pt*Ve+Gt*Ze,ve[Z][K]=-pt*Ze+Gt*Ve}if(Gt=tn[te],Oe==te){if(Gt<0)for(tn[te]=-Gt,Z=0;Z<qt;Z++)Bt[Z][te]=-Bt[Z][te];break}if(J>=49)throw"Error: no convergence.";for(xt=tn[Oe],Xt=on(Yt=(((pt=tn[te-1])-Gt)*(pt+Gt)+((Xt=Vt[te-1])-(et=Vt[te]))*(Xt+et))/(2*et*pt),1),Yt=Yt<0?((xt-Gt)*(xt+Gt)+et*(pt/(Yt-Xt)-et))/xt:((xt-Gt)*(xt+Gt)+et*(pt/(Yt+Xt)-et))/xt,Ve=1,Ze=1,K=Oe+1;K<te+1;K++){for(Xt=Vt[K],pt=tn[K],et=Ze*Xt,Xt*=Ve,Gt=on(Yt,et),Vt[K-1]=Gt,Yt=xt*(Ve=Yt/Gt)+Xt*(Ze=et/Gt),Xt=-xt*Ze+Xt*Ve,et=pt*Ze,pt*=Ve,Z=0;Z<qt;Z++)xt=Bt[Z][K-1],Gt=Bt[Z][K],Bt[Z][K-1]=xt*Ve+Gt*Ze,Bt[Z][K]=-xt*Ze+Gt*Ve;for(Gt=on(Yt,et),tn[K-1]=Gt,Yt=(Ve=Yt/Gt)*Xt+(Ze=et/Gt)*pt,xt=-Ze*Xt+Ve*pt,Z=0;Z<st;Z++)pt=ve[Z][K-1],Gt=ve[Z][K],ve[Z][K-1]=pt*Ve+Gt*Ze,ve[Z][K]=-pt*Ze+Gt*Ve}Vt[Oe]=0,Vt[te]=Yt,tn[te]=xt}for(K=0;K<tn.length;K++)tn[K]<mt&&(tn[K]=0);for(K=0;K<qt;K++)for(Z=K-1;Z>=0;Z--)if(tn[Z]<tn[K]){for(Ve=tn[Z],tn[Z]=tn[K],tn[K]=Ve,te=0;te<ve.length;te++)ke=ve[te][K],ve[te][K]=ve[te][Z],ve[te][Z]=ke;for(te=0;te<Bt.length;te++)ke=Bt[te][K],Bt[te][K]=Bt[te][Z],Bt[te][Z]=ke;K=Z}return{U:ve,S:tn,V:Bt}}(me);console.log(Te);var ue=Te.U;return Te.S.map(function(Ae,ke){var mt={};return mt.eigenvalue=Ae,mt.vector=ue.map(function(Ee,Ve){return-1*Ee[ke]}),mt})}function Ge(me,...Te){var ue=Te.map(function(mt){return mt.vector}),Ae=vt(ue,Qe(ct(me))),ke=Je(vt(Ye(me.length),me),-1/me.length);return{adjustedData:Ae,formattedAdjustedData:Ue(Ae,2),avgData:ke,selectedVectors:ue}}function rt(me){return ht(It(f(ct(me)),!1))}function Ue(me,Te){var ue=Math.pow(10,Te||2);return me.map(function(Ae,ke){return Ae.map(function(mt){return Math.round(mt*ue)/ue})})}function vt(me,Te){if(!(me[0]&&Te[0]&&me.length&&Te.length))throw new Error("Both A and B should be matrices");if(Te.length!==me[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var ue=[],Ae=0;Ae<me.length;Ae++){ue[Ae]=[];for(var ke=0;ke<Te[0].length;ke++)for(var mt=0;mt<me[0].length;mt++)ue[Ae][ke]=ue[Ae][ke]?ue[Ae][ke]+me[Ae][mt]*Te[mt][ke]:me[Ae][mt]*Te[mt][ke]}return ue}function wt(me,Te){if(me.length!==Te.length||me[0].length!==Te[0].length)throw new Error("Both A and B should have the same dimensions");for(var ue=[],Ae=0;Ae<me.length;Ae++){ue[Ae]=[];for(var ke=0;ke<Te[0].length;ke++)ue[Ae][ke]=me[Ae][ke]-Te[Ae][ke]}return ue}function Je(me,Te){for(var ue=[],Ae=0;Ae<me.length;Ae++){ue[Ae]=[];for(var ke=0;ke<me[0].length;ke++)ue[Ae][ke]=me[Ae][ke]*Te}return ue}function Ye(me){for(var Te=[],ue=0;ue<me;ue++){Te[ue]=[];for(var Ae=0;Ae<me;Ae++)Te[ue][Ae]=1}return Te}function Qe(me){return je(me)[0].map(function(Te,ue){return me.map(function(Ae){return Ae[ue]})})}function je(me){var Te=JSON.stringify(me);return JSON.parse(Te)}return{computeDeviationScores:f,computeDeviationMatrix:ct,computeSVD:ht,computePercentageExplained:function(me,...Te){var ue=me.map(function(Ae){return Ae.eigenvalue}).reduce(function(Ae,ke){return Ae+ke});return Te.map(function(Ae){return Ae.eigenvalue}).reduce(function(Ae,ke){return Ae+ke})/ue},computeOriginalData:function(me,Te,ue){var Ae=wt(Qe(vt(Qe(Te),me)),ue);return{originalData:Ae,formattedOriginalData:Ue(Ae,2)}},computeVarianceCovariance:It,computeAdjustedData:Ge,getEigenVectors:rt,analyseTopResult:function(me){var Te=rt(me).sort(function(ue,Ae){return Ae.eigenvalue-ue.eigenvalue});return console.log("Sorted Vectors",Te),Ge(me,Te[0].vector)},transpose:Qe,multiply:vt,clone:je,scale:Je}}();Mn.exports=Tt},701:function(Mn){var Tt=[];function ct(ht){for(var Ge=-1,rt=0;rt<Tt.length;rt++)if(Tt[rt].identifier===ht){Ge=rt;break}return Ge}function f(ht,Ge){for(var rt={},Ue=[],vt=0;vt<ht.length;vt++){var wt=ht[vt],Je=Ge.base?wt[0]+Ge.base:wt[0],Ye=rt[Je]||0,Qe="".concat(Je," ").concat(Ye);rt[Je]=Ye+1;var je=ct(Qe),me={css:wt[1],media:wt[2],sourceMap:wt[3],supports:wt[4],layer:wt[5]};if(je!==-1)Tt[je].references++,Tt[je].updater(me);else{var Te=It(me,Ge);Ge.byIndex=vt,Tt.splice(vt,0,{identifier:Qe,updater:Te,references:1})}Ue.push(Qe)}return Ue}function It(ht,Ge){var rt=Ge.domAPI(Ge);return rt.update(ht),function(Ue){if(Ue){if(Ue.css===ht.css&&Ue.media===ht.media&&Ue.sourceMap===ht.sourceMap&&Ue.supports===ht.supports&&Ue.layer===ht.layer)return;rt.update(ht=Ue)}else rt.remove()}}Mn.exports=function(ht,Ge){var rt=f(ht=ht||[],Ge=Ge||{});return function(Ue){Ue=Ue||[];for(var vt=0;vt<rt.length;vt++){var wt=ct(rt[vt]);Tt[wt].references--}for(var Je=f(Ue,Ge),Ye=0;Ye<rt.length;Ye++){var Qe=ct(rt[Ye]);Tt[Qe].references===0&&(Tt[Qe].updater(),Tt.splice(Qe,1))}rt=Je}}},182:function(Mn){Mn.exports=function(Tt){var ct=document.createElement("style");return Tt.setAttributes(ct,Tt.attributes),Tt.insert(ct,Tt.options),ct}},850:function(Mn,Tt,ct){Mn.exports=function(f){var It=ct.nc;It&&f.setAttribute("nonce",It)}},236:function(Mn){Mn.exports=function(Tt){var ct=Tt.insertStyleElement(Tt);return{update:function(f){(function(It,ht,Ge){var rt="";Ge.supports&&(rt+="@supports (".concat(Ge.supports,") {")),Ge.media&&(rt+="@media ".concat(Ge.media," {"));var Ue=Ge.layer!==void 0;Ue&&(rt+="@layer".concat(Ge.layer.length>0?" ".concat(Ge.layer):""," {")),rt+=Ge.css,Ue&&(rt+="}"),Ge.media&&(rt+="}"),Ge.supports&&(rt+="}");var vt=Ge.sourceMap;vt&&typeof btoa<"u"&&(rt+=`
/`,rt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(vt))))," *"),rt+="/"),ht.styleTagTransform(rt,It,ht.options)})(ct,Tt,f)},remove:function(){(function(f){if(f.parentNode===null)return!1;f.parentNode.removeChild(f)})(ct)}}}},213:function(Mn){Mn.exports=function(Tt,ct){if(ct.styleSheet)ct.styleSheet.cssText=Tt;else{for(;ct.firstChild;)ct.removeChild(ct.firstChild);ct.appendChild(document.createTextNode(Tt))}}},1:function(Mn){Mn.exports=function(){var Tt={820:function(ht,Ge,rt){var Ue=rt(537),vt=rt.n(Ue),wt=rt(645),Je=rt.n(wt)()(vt());Je.push([ht.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),Ge.Z=Je},645:function(ht){ht.exports=function(Ge){var rt=[];return rt.toString=function(){return this.map(function(Ue){var vt="",wt=Ue[5]!==void 0;return Ue[4]&&(vt+="@supports (".concat(Ue[4],") {")),Ue[2]&&(vt+="@media ".concat(Ue[2]," {")),wt&&(vt+="@layer".concat(Ue[5].length>0?" ".concat(Ue[5]):""," {")),vt+=Ge(Ue),wt&&(vt+="}"),Ue[2]&&(vt+="}"),Ue[4]&&(vt+="}"),vt}).join("")},rt.i=function(Ue,vt,wt,Je,Ye){typeof Ue=="string"&&(Ue=[[null,Ue,void 0]]);var Qe={};if(wt)for(var je=0;je<this.length;je++){var me=this[je][0];me!=null&&(Qe[me]=!0)}for(var Te=0;Te<Ue.length;Te++){var ue=[].concat(Ue[Te]);wt&&Qe[ue[0]]||(Ye!==void 0&&(ue[5]===void 0||(ue[1]="@layer".concat(ue[5].length>0?" ".concat(ue[5]):""," {").concat(ue[1],"}")),ue[5]=Ye),vt&&(ue[2]&&(ue[1]="@media ".concat(ue[2]," {").concat(ue[1],"}")),ue[2]=vt),Je&&(ue[4]?(ue[1]="@supports (".concat(ue[4],") {").concat(ue[1],"}"),ue[4]=Je):ue[4]="".concat(Je)),rt.push(ue))}},rt}},537:function(ht){ht.exports=function(Ge){var rt=Ge[1],Ue=Ge[3];if(!Ue)return rt;if(typeof btoa=="function"){var vt=btoa(unescape(encodeURIComponent(JSON.stringify(Ue)))),wt="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(vt),Je="/*# ".concat(wt," */"),Ye=Ue.sources.map(function(Qe){return"/*# sourceURL=".concat(Ue.sourceRoot||"").concat(Qe," */")});return[rt].concat(Ye).concat([Je]).join(`
`)}return[rt].join(`
`)}},379:function(ht){var Ge=[];function rt(wt){for(var Je=-1,Ye=0;Ye<Ge.length;Ye++)if(Ge[Ye].identifier===wt){Je=Ye;break}return Je}function Ue(wt,Je){for(var Ye={},Qe=[],je=0;je<wt.length;je++){var me=wt[je],Te=Je.base?me[0]+Je.base:me[0],ue=Ye[Te]||0,Ae="".concat(Te," ").concat(ue);Ye[Te]=ue+1;var ke=rt(Ae),mt={css:me[1],media:me[2],sourceMap:me[3],supports:me[4],layer:me[5]};if(ke!==-1)Ge[ke].references++,Ge[ke].updater(mt);else{var Ee=vt(mt,Je);Je.byIndex=je,Ge.splice(je,0,{identifier:Ae,updater:Ee,references:1})}Qe.push(Ae)}return Qe}function vt(wt,Je){var Ye=Je.domAPI(Je);return Ye.update(wt),function(Qe){if(Qe){if(Qe.css===wt.css&&Qe.media===wt.media&&Qe.sourceMap===wt.sourceMap&&Qe.supports===wt.supports&&Qe.layer===wt.layer)return;Ye.update(wt=Qe)}else Ye.remove()}}ht.exports=function(wt,Je){var Ye=Ue(wt=wt||[],Je=Je||{});return function(Qe){Qe=Qe||[];for(var je=0;je<Ye.length;je++){var me=rt(Ye[je]);Ge[me].references--}for(var Te=Ue(Qe,Je),ue=0;ue<Ye.length;ue++){var Ae=rt(Ye[ue]);Ge[Ae].references===0&&(Ge[Ae].updater(),Ge.splice(Ae,1))}Ye=Te}}},216:function(ht){ht.exports=function(Ge){var rt=document.createElement("style");return Ge.setAttributes(rt,Ge.attributes),Ge.insert(rt,Ge.options),rt}},636:function(ht,Ge,rt){ht.exports=function(Ue){var vt=rt.nc;vt&&Ue.setAttribute("nonce",vt)}},795:function(ht){ht.exports=function(Ge){var rt=Ge.insertStyleElement(Ge);return{update:function(Ue){(function(vt,wt,Je){var Ye="";Je.supports&&(Ye+="@supports (".concat(Je.supports,") {")),Je.media&&(Ye+="@media ".concat(Je.media," {"));var Qe=Je.layer!==void 0;Qe&&(Ye+="@layer".concat(Je.layer.length>0?" ".concat(Je.layer):""," {")),Ye+=Je.css,Qe&&(Ye+="}"),Je.media&&(Ye+="}"),Je.supports&&(Ye+="}");var je=Je.sourceMap;je&&typeof btoa<"u"&&(Ye+=`
/`,Ye+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(je))))," *"),Ye+="/"),wt.styleTagTransform(Ye,vt,wt.options)})(rt,Ge,Ue)},remove:function(){(function(Ue){if(Ue.parentNode===null)return!1;Ue.parentNode.removeChild(Ue)})(rt)}}}},589:function(ht){ht.exports=function(Ge,rt){if(rt.styleSheet)rt.styleSheet.cssText=Ge;else{for(;rt.firstChild;)rt.removeChild(rt.firstChild);rt.appendChild(document.createTextNode(Ge))}}}},ct={};function f(ht){var Ge=ct[ht];if(Ge!==void 0)return Ge.exports;var rt=ct[ht]={id:ht,exports:{}};return Tt[ht](rt,rt.exports,f),rt.exports}f.n=function(ht){var Ge=ht&&ht.__esModule?function(){return ht.default}:function(){return ht};return f.d(Ge,{a:Ge}),Ge},f.d=function(ht,Ge){for(var rt in Ge)f.o(Ge,rt)&&!f.o(ht,rt)&&Object.defineProperty(ht,rt,{enumerable:!0,get:Ge[rt]})},f.o=function(ht,Ge){return Object.prototype.hasOwnProperty.call(ht,Ge)},f.nc=void 0;var It={};return function(){f.d(It,{default:function(){return tn}});var ht=f(379),Ge=f.n(ht),rt=f(795),Ue=f.n(rt),vt=f(636),wt=f.n(vt),Je=f(216),Ye=f.n(Je),Qe=f(589),je=f.n(Qe),me=f(820),Te={};me.Z&&me.Z.locals&&(Te.locals=me.Z.locals);var ue,Ae=0,ke={};ke.styleTagTransform=je(),ke.setAttributes=wt(),ke.insert=function(Bt,on){(on.target||document.head).appendChild(Bt)},ke.domAPI=Ue(),ke.insertStyleElement=Ye(),Te.use=function(Bt){return ke.options=Bt||{},Ae++||(ue=Ge()(me.Z,ke)),Te},Te.unuse=function(){Ae>0&&!--Ae&&(ue(),ue=null)};var mt=Te;function Ee(Bt,on){return function(Yt){if(Array.isArray(Yt))return Yt}(Bt)||function(Yt,Xt){var et=Yt==null?null:typeof Symbol<"u"&&Yt[Symbol.iterator]||Yt["@@iterator"];if(et!=null){var xt,pt,Gt=[],Ze=!0,J=!1;try{for(et=et.call(Yt);!(Ze=(xt=et.next()).done)&&(Gt.push(xt.value),!Xt||Gt.length!==Xt);Ze=!0);}catch(ae){J=!0,pt=ae}finally{try{Ze||et.return==null||et.return()}finally{if(J)throw pt}}return Gt}}(Bt,on)||function(Yt,Xt){if(Yt){if(typeof Yt=="string")return Ve(Yt,Xt);var et=Object.prototype.toString.call(Yt).slice(8,-1);return et==="Object"&&Yt.constructor&&(et=Yt.constructor.name),et==="Map"||et==="Set"?Array.from(Yt):et==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(et)?Ve(Yt,Xt):void 0}}(Bt,on)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ve(Bt,on){(on==null||on>Bt.length)&&(on=Bt.length);for(var Yt=0,Xt=new Array(on);Yt<on;Yt++)Xt[Yt]=Bt[Yt];return Xt}function K(Bt,on){var Yt=Object.keys(Bt);if(Object.getOwnPropertySymbols){var Xt=Object.getOwnPropertySymbols(Bt);on&&(Xt=Xt.filter(function(et){return Object.getOwnPropertyDescriptor(Bt,et).enumerable})),Yt.push.apply(Yt,Xt)}return Yt}function Z(Bt){for(var on=1;on<arguments.length;on++){var Yt=arguments[on]!=null?arguments[on]:{};on%2?K(Object(Yt),!0).forEach(function(Xt){te(Bt,Xt,Yt[Xt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Bt,Object.getOwnPropertyDescriptors(Yt)):K(Object(Yt)).forEach(function(Xt){Object.defineProperty(Bt,Xt,Object.getOwnPropertyDescriptor(Yt,Xt))})}return Bt}function te(Bt,on,Yt){return on in Bt?Object.defineProperty(Bt,on,{value:Yt,enumerable:!0,configurable:!0,writable:!0}):Bt[on]=Yt,Bt}function Oe(Bt,on){for(var Yt=0;Yt<on.length;Yt++){var Xt=on[Yt];Xt.enumerable=Xt.enumerable||!1,Xt.configurable=!0,"value"in Xt&&(Xt.writable=!0),Object.defineProperty(Bt,Xt.key,Xt)}}function ve(Bt){var on={};return Bt.reduce(function(Yt,Xt){return on[Xt]||(on[Xt]=!0,Yt.push(Xt)),Yt},[])}function st(Bt,on){requestAnimationFrame(function(){on.enter(),requestAnimationFrame(function(){on.active(),setTimeout(function(){on.leave()},Bt)})})}function qt(Bt,on){try{var Yt=Bt.liElementsById[on.parent.id];Yt.classList.contains("treejs-node__close")||Yt.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(on,"parent")&&qt(Bt,on.parent)}function Vt(Bt,on){var Yt=Bt.liElementsById[on.id];Yt.classList.contains("treejs-node__close")&&Yt.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(on,"children")&&on.children.forEach(function(Xt){return Vt(Bt,Xt)})}var tn=function(){function Bt(et,xt){(function(pt,Gt){if(!(pt instanceof Gt))throw new TypeError("Cannot call a class as a function")})(this,Bt),mt.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=et,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},xt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(pt){this.setValues(ve(pt))}},disables:{get:function(){return this.getDisables()},set:function(pt){this.setDisables(ve(pt))}},selectedNodes:{get:function(){var pt=[],Gt=this.nodesById;return Object.keys(Gt).forEach(function(Ze){if(Object.prototype.hasOwnProperty.call(Gt,Ze)&&(Gt[Ze].status===1||Gt[Ze].status===2)){var J=Z({},Gt[Ze]);delete J.parent,delete J.children,pt.push(J)}}),pt}},disabledNodes:{get:function(){var pt=[],Gt=this.nodesById;return Object.keys(Gt).forEach(function(Ze){if(Object.prototype.hasOwnProperty.call(Gt,Ze)&&Gt[Ze].disabled){var J=Z({},Gt[Ze]);delete J.parent,pt.push(J)}}),pt}}}),this.init(this.options.data)}var on,Yt,Xt;return on=Bt,Xt=[{key:"onSwitcherClick",value:function(et){var xt=et.parentNode,pt=xt.lastChild,Gt=pt.scrollHeight;xt.classList.contains("treejs-node__close")?st(150,{enter:function(){pt.style.height=0,pt.style.opacity=0},active:function(){pt.style.height="".concat(Gt,"px"),pt.style.opacity=1},leave:function(){pt.style.height="",pt.style.opacity="",xt.classList.remove("treejs-node__close")}}):st(150,{enter:function(){pt.style.height="".concat(Gt,"px"),pt.style.opacity=1},active:function(){pt.style.height=0,pt.style.opacity=0},leave:function(){pt.style.height="",pt.style.opacity="",xt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(et){var xt,pt=(xt=et,JSON.parse(JSON.stringify(xt))),Gt={},Ze={},J=[],ae=[];return function Le(Kt,Qt){Kt.forEach(function($t){Gt[$t.id]=$t,$t.checked&&J.push($t.id),$t.disabled&&ae.push($t.id),Qt&&($t.parent=Qt),$t.children&&$t.children.length?Le($t.children,$t):Ze[$t.id]=$t})}(pt),{treeNodes:pt,nodesById:Gt,leafNodesById:Ze,defaultValues:J,defaultDisables:ae}}},{key:"createRootEle",value:function(){var et=document.createElement("div");return et.classList.add("treejs"),et}},{key:"createUlEle",value:function(){var et=document.createElement("ul");return et.classList.add("treejs-nodes"),et}},{key:"createLiEle",value:function(et,xt){var pt=document.createElement("li");if(pt.classList.add("treejs-node"),xt&&pt.classList.add("treejs-node__close"),et.children&&et.children.length){var Gt=document.createElement("span");Gt.classList.add("treejs-switcher"),pt.appendChild(Gt)}else pt.classList.add("treejs-placeholder");var Ze=document.createElement("span");Ze.classList.add("treejs-checkbox"),pt.appendChild(Ze);var J=document.createElement("span");J.classList.add("treejs-label");var ae=document.createTextNode(et.text);return J.appendChild(ae),pt.appendChild(J),pt.nodeId=et.id,pt}}],(Yt=[{key:"init",value:function(et){var xt=Bt.parseTreeData(et),pt=xt.treeNodes,Gt=xt.nodesById,Ze=xt.leafNodesById,J=xt.defaultValues,ae=xt.defaultDisables;this.treeNodes=pt,this.nodesById=Gt,this.leafNodesById=Ze,this.render(this.treeNodes);var Le=this.options,Kt=Le.values,Qt=Le.disables,$t=Le.loaded;Kt&&Kt.length?this.setValues(Kt):J&&J.length&&this.setValues(J),Qt&&Qt.length?this.setDisables(Qt):ae&&ae.length&&this.setDisables(ae),typeof $t=="function"&&$t.call(this)}},{key:"render",value:function(et){var xt=Bt.createRootEle();xt.appendChild(this.buildTree(et,0)),this.bindEvent(xt);var pt=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Gt){for(;Gt.firstChild;)Gt.removeChild(Gt.firstChild)})(pt),pt.appendChild(xt)}},{key:"buildTree",value:function(et,xt){var pt=this,Gt=Bt.createUlEle();return et&&et.length&&et.forEach(function(Ze){var J=Bt.createLiEle(Ze,xt===pt.options.closeDepth-1);pt.liElementsById[Ze.id]=J;var ae=null;Ze.children&&Ze.children.length&&(ae=pt.buildTree(Ze.children,xt+1)),ae&&J.appendChild(ae),Gt.appendChild(J)}),Gt}},{key:"bindEvent",value:function(et){var xt=this;et.addEventListener("click",function(pt){var Gt=pt.target;Gt.nodeName==="SPAN"&&Gt.classList.contains("treejs-checkbox")?xt.onItemClick(Gt.parentNode.nodeId):Gt.nodeName==="SPAN"&&Gt.classList.contains("treejs-label")?xt.onItemLabelClick(Gt.parentNode.nodeId):Gt.nodeName==="LI"&&Gt.classList.contains("treejs-node")?xt.onItemClick(Gt.nodeId):Gt.nodeName==="SPAN"&&Gt.classList.contains("treejs-switcher")&&Bt.onSwitcherClick(Gt)},!1)}},{key:"onItemClick",value:function(et){var xt=this.nodesById[et],pt=this.options.onChange;xt.disabled||(this.setValue(et),this.updateLiElements()),pt&&pt.call(this)}},{key:"onItemLabelClick",value:function(et){var xt=this.options.onItemLabelClick;xt&&xt.call(this,et)}},{key:"setValue",value:function(et){var xt=this.nodesById[et];if(xt){var pt=xt.status,Gt=pt===1||pt===2?0:2;xt.status=Gt,this.markWillUpdateNode(xt),this.walkUp(xt,"status"),this.walkDown(xt,"status")}}},{key:"getValues",value:function(){var et=this,xt=[];return Object.keys(this.leafNodesById).forEach(function(pt){Object.prototype.hasOwnProperty.call(et.leafNodesById,pt)&&(et.leafNodesById[pt].status!==1&&et.leafNodesById[pt].status!==2||xt.push(pt))}),xt}},{key:"setValues",value:function(et){var xt=this;this.emptyNodesCheckStatus(),et.forEach(function(Gt){xt.setValue(Gt)}),this.updateLiElements();var pt=this.options.onChange;pt&&pt.call(this)}},{key:"setDisable",value:function(et){var xt=this.nodesById[et];xt&&(xt.disabled||(xt.disabled=!0,this.markWillUpdateNode(xt),this.walkUp(xt,"disabled"),this.walkDown(xt,"disabled")))}},{key:"getDisables",value:function(){var et=this,xt=[];return Object.keys(this.leafNodesById).forEach(function(pt){Object.prototype.hasOwnProperty.call(et.leafNodesById,pt)&&et.leafNodesById[pt].disabled&&xt.push(pt)}),xt}},{key:"setDisables",value:function(et){var xt=this;this.emptyNodesDisable(),et.forEach(function(pt){xt.setDisable(pt)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(et){et.disabled||(et.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(et){et.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(et,xt){var pt=Ee(xt,2),Gt=pt[0],Ze=pt[1];return Ze.status!==1&&Ze.status!==2||(et[Gt]=Ze),et},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(et,xt){var pt=Ee(xt,2),Gt=pt[0],Ze=pt[1];return Ze.disabled&&(et[Gt]=Ze),et},{})}},{key:"updateLiElements",value:function(){var et=this;Object.values(this.willUpdateNodesById).forEach(function(xt){et.updateLiElement(xt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(et){this.willUpdateNodesById[et.id]=et}},{key:"walkUp",value:function(et,xt){var pt=et.parent;if(pt){if(xt==="status"){var Gt,Ze=pt.children.reduce(function(ae,Le){return Number.isNaN(Le.status)?ae:ae+Le.status},0);if(Gt=Ze?Ze===2*pt.children.length?2:1:0,pt.status===Gt)return;pt.status=Gt}else{var J=pt.children.reduce(function(ae,Le){return ae&&Le.disabled},!0);if(pt.disabled===J)return;pt.disabled=J}this.markWillUpdateNode(pt),this.walkUp(pt,xt)}}},{key:"walkDown",value:function(et,xt){var pt=this;et.children&&et.children.length&&et.children.forEach(function(Gt){xt==="status"&&Gt.disabled||(Gt[xt]=et[xt],pt.markWillUpdateNode(Gt),pt.walkDown(Gt,xt))})}},{key:"updateLiElement",value:function(et){var xt=this.liElementsById[et.id].classList;switch(et.status){case 0:xt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:xt.remove("treejs-node__checked"),xt.add("treejs-node__halfchecked");break;case 2:xt.remove("treejs-node__halfchecked"),xt.add("treejs-node__checked")}switch(et.disabled){case!0:xt.contains("treejs-node__disabled")||xt.add("treejs-node__disabled");break;case!1:xt.contains("treejs-node__disabled")&&xt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var et=this;Object.keys(this.leafNodesById).forEach(function(xt){var pt=et.leafNodesById[xt];qt(et,pt)})}},{key:"expandAll",value:function(){Vt(this,this.treeNodes[0])}}])&&Oe(on.prototype,Yt),Xt&&Oe(on,Xt),Object.defineProperty(on,"prototype",{writable:!1}),Bt}()}(),It.default}()},819:function(Mn,Tt){(function(ct){const f="tp";function It(Te){return ue=>Ae=>{if(!ue&&Ae===void 0)return{succeeded:!1,value:void 0};if(ue&&Ae===void 0)return{succeeded:!0,value:void 0};const ke=Te(Ae);return ke!==void 0?{succeeded:!0,value:ke}:{succeeded:!1,value:void 0}}}function ht(Te){return{custom:ue=>It(ue)(Te),boolean:It(ue=>typeof ue=="boolean"?ue:void 0)(Te),number:It(ue=>typeof ue=="number"?ue:void 0)(Te),string:It(ue=>typeof ue=="string"?ue:void 0)(Te),function:It(ue=>typeof ue=="function"?ue:void 0)(Te),constant:ue=>It(Ae=>Ae===ue?ue:void 0)(Te),raw:It(ue=>ue)(Te),object:ue=>It(Ae=>{if((ke=Ae)!==null&&typeof ke=="object")return function(mt,Ee){return Object.keys(Ee).reduce((Ve,K)=>{if(Ve===void 0)return;const Z=(0,Ee[K])(mt[K]);return Z.succeeded?Object.assign(Object.assign({},Ve),{[K]:Z.value}):void 0},{})}(Ae,ue);var ke})(Te),array:ue=>It(Ae=>{if(Array.isArray(Ae))return ke=ue,Ae.reduce((mt,Ee)=>{if(mt===void 0)return;const Ve=ke(Ee);return Ve.succeeded&&Ve.value!==void 0?[...mt,Ve.value]:void 0},[]);var ke})(Te)}}const Ge={optional:ht(!0),required:ht(!1)};function rt(Te,ue,Ae,ke){return new(Ae||(Ae=Promise))(function(mt,Ee){function Ve(te){try{Z(ke.next(te))}catch(Oe){Ee(Oe)}}function K(te){try{Z(ke.throw(te))}catch(Oe){Ee(Oe)}}function Z(te){var Oe;te.done?mt(te.value):(Oe=te.value,Oe instanceof Ae?Oe:new Ae(function(ve){ve(Oe)})).then(Ve,K)}Z((ke=ke.apply(Te,ue||[])).next())})}function Ue(Te){return rt(this,void 0,void 0,function*(){const ue=new Image;return ue.crossOrigin="anonymous",new Promise((Ae,ke)=>{ue.src=Te,ue.onload=()=>{Ae(ue)},ue.onerror=ke})})}const vt=(wt="img",(Te,ue)=>[f,"-",wt,"v",Te?`_${Te}`:"",ue?`-${ue}`:""].join(""));var wt;class Je{constructor(ue,Ae){this.element=ue.createElement("div"),this.element.classList.add(vt()),Ae.viewProps.bindClassModifiers(this.element),this.input=ue.createElement("input"),this.input.classList.add(vt("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Ae.extensions.join(",")),this.image_=ue.createElement("img"),this.image_.classList.add(vt("image")),this.image_.classList.add(vt(`image_${Ae.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=ke=>{Ae.clickCallback?Ae.clickCallback(ke,this.input):this.input.click()},this.element.classList.add(vt("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(ue){this.image_.src=ue}changeDraggingState(ue){const Ae=this.element;ue?Ae==null||Ae.classList.add(vt("area_dragging")):Ae==null||Ae.classList.remove(vt("area_dragging"))}}let Ye=null;class Qe{constructor(ue,Ae){this.value=Ae.value,this.viewProps=Ae.viewProps,this.view=new Je(ue,{viewProps:this.viewProps,extensions:Ae.extensions,imageFit:Ae.imageFit,clickCallback:Ae.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(ue){const Ae=(ue==null?void 0:ue.target).files;if(!Ae||!Ae.length)return;const ke=Ae[0];this.setValue(ke)}onDrop(ue){return rt(this,void 0,void 0,function*(){ue.preventDefault();try{const{dataTransfer:Ae}=ue,ke=Ae==null?void 0:Ae.files[0];if(ke)this.setValue(ke);else{const mt=Ae==null?void 0:Ae.getData("url");if(!mt)throw new Error("No url");this.setValue(mt)}}catch(Ae){console.error("Could not parse the dropped image",Ae)}finally{this.view.changeDraggingState(!1)}})}onDragOver(ue){ue.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(ue){return rt(this,void 0,void 0,function*(){ue instanceof HTMLImageElement?this.updateImage(ue.src):typeof ue!="string"&&ue?yield this.setValue(ue):(ue!=="placeholder"&&ue||(ue=(yield this.handlePlaceholderImage()).src),this.updateImage(ue))})}updateImage(ue){this.view.changeImage(ue)}setValue(ue){return rt(this,void 0,void 0,function*(){if(ue instanceof HTMLImageElement)this.value.setRawValue(ue);else if(ue instanceof File){const Ae=URL.createObjectURL(ue)+"#"+ue.name;ue.src=Ae;const ke=yield Ue(Ae).catch(()=>{});this.value.setRawValue(ke||ue)}else ue?this.value.setRawValue(yield Ue(ue)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return rt(this,void 0,void 0,function*(){return Ye||(Ye=yield function(){const ue=document.createElement("canvas");ue.width=320,ue.height=50;const Ae=ue.getContext("2d");return Ae.fillStyle="#00000004",Ae.fillRect(0,0,ue.width,ue.height),Ae.fillStyle="#eee",Ae.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Ae.textAlign="center",Ae.textBaseline="middle",Ae.fillText("No image",.5*ue.width,.5*ue.height),new Promise(ke=>{ue.toBlob(mt=>{const Ee=new Image;Ee.src=URL.createObjectURL(mt),Ee.isPlaceholder=!0,Ee.onload=()=>{ke(Ee)}})})}()),Ye})}}const je=[".jpg",".png",".gif"],me={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(Te,ue){if(!(Te instanceof HTMLImageElement||typeof Te=="string"))return null;const Ae=Ge,ke=function(mt,Ee){const Ve=Ge.required.object(Ee)(mt);return Ve.succeeded?Ve.value:void 0}(ue,{view:Ae.required.constant("input-image"),acceptUrl:Ae.optional.boolean,clickCallback:Ae.optional.function,imageFit:Ae.optional.custom(mt=>mt==="contain"||mt==="cover"?mt:void 0),extensions:Ae.optional.array(Ae.required.string)});return ke?{initialValue:Te,params:ke}:null},binding:{reader:Te=>ue=>ue.src!==void 0?ue.src===""?"placeholder":ue.src:ue,writer:Te=>(ue,Ae)=>{ue.write(Ae)}},controller(Te){var ue,Ae;return new Qe(Te.document,{value:Te.value,imageFit:(ue=Te.params.imageFit)!==null&&ue!==void 0?ue:"cover",clickCallback:Te.params.clickCallback,viewProps:Te.viewProps,extensions:(Ae=Te.params.extensions)!==null&&Ae!==void 0?Ae:je})}};ct.plugin=me,Object.defineProperty(ct,"__esModule",{value:!0})})(Tt)},665:function(Mn,Tt){(function(ct){class f{constructor(v){this.controller_=v}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(v){this.controller_.viewProps.set("disabled",v)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(v){this.controller_.viewProps.set("hidden",v)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class It{constructor(v){this.target=v}}class ht extends It{constructor(v,w,N,Y){super(v),this.value=w,this.presetKey=N,this.last=Y==null||Y}}class Ge extends It{constructor(v,w,N){super(v),this.value=w,this.presetKey=N}}class rt extends It{constructor(v,w){super(v),this.expanded=w}}function Ue(D){return D==null}function vt(D,v){if(D.length!==v.length)return!1;for(let w=0;w<D.length;w++)if(D[w]!==v[w])return!1;return!0}const wt={alreadydisposed:()=>"View has been already disposed",invalidparams:D=>`Invalid parameters for '${D.name}'`,nomatchingcontroller:D=>`No matching controller for '${D.key}'`,nomatchingview:D=>`No matching view for '${JSON.stringify(D.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:D=>`Property '${D.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class Je{constructor(v){var w;this.message=(w=wt[v.type](v.context))!==null&&w!==void 0?w:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=v.type}static alreadyDisposed(){return new Je({type:"alreadydisposed"})}static notBindable(){return new Je({type:"notbindable"})}static propertyNotFound(v){return new Je({type:"propertynotfound",context:{name:v}})}static shouldNeverHappen(){return new Je({type:"shouldneverhappen"})}}class Ye{constructor(v,w,N){this.obj_=v,this.key_=w,this.presetKey_=N??w}static isBindable(v){return v!==null&&typeof v=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(v){this.obj_[this.key_]=v}writeProperty(v,w){const N=this.read();if(!Ye.isBindable(N))throw Je.notBindable();if(!(v in N))throw Je.propertyNotFound(v);N[v]=w}}class Qe extends f{get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}get title(){var v;return(v=this.controller_.valueController.props.get("title"))!==null&&v!==void 0?v:""}set title(v){this.controller_.valueController.props.set("title",v)}on(v,w){const N=w.bind(this);return this.controller_.valueController.emitter.on(v,()=>{N(new It(this))}),this}}class je{constructor(){this.observers_={}}on(v,w){let N=this.observers_[v];return N||(N=this.observers_[v]=[]),N.push({handler:w}),this}off(v,w){const N=this.observers_[v];return N&&(this.observers_[v]=N.filter(Y=>Y.handler!==w)),this}emit(v,w){const N=this.observers_[v];N&&N.forEach(Y=>{Y.handler(w)})}}const me="tp";function Te(D){return(v,w)=>[me,"-",D,"v",v?`_${v}`:"",w?`-${w}`:""].join("")}function ue(D){return D.rawValue}function Ae(D,v){var w,N;D.emitter.on("change",(w=ue,N=v,Y=>N(w(Y)))),v(D.rawValue)}function ke(D,v,w){Ae(D.value(v),w)}function mt(D,v){return w=>{(function(N,Y,fe){fe?N.classList.add(Y):N.classList.remove(Y)})(D,v,w)}}function Ee(D,v){Ae(D,w=>{v.textContent=w??""})}const Ve=Te("btn");class K{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(Ve()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("button");N.classList.add(Ve("b")),w.viewProps.bindDisabled(N),this.element.appendChild(N),this.buttonElement=N;const Y=v.createElement("div");Y.classList.add(Ve("t")),Ee(w.props.value("title"),Y),this.buttonElement.appendChild(Y)}}class Z{constructor(v,w){this.emitter=new je,this.onClick_=this.onClick_.bind(this),this.props=w.props,this.viewProps=w.viewProps,this.view=new K(v,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class te{constructor(v,w){var N;this.constraint_=w==null?void 0:w.constraint,this.equals_=(N=w==null?void 0:w.equals)!==null&&N!==void 0?N:(Y,fe)=>Y===fe,this.emitter=new je,this.rawValue_=v}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(v){this.setRawValue(v,{forceEmit:!1,last:!0})}setRawValue(v,w){const N=w??{forceEmit:!1,last:!0},Y=this.constraint_?this.constraint_.constrain(v):v;(!this.equals_(this.rawValue_,Y)||N.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Y,this.emitter.emit("change",{options:N,rawValue:Y,sender:this}))}}class Oe{constructor(v){this.emitter=new je,this.value_=v}get rawValue(){return this.value_}set rawValue(v){this.setRawValue(v,{forceEmit:!1,last:!0})}setRawValue(v,w){const N=w??{forceEmit:!1,last:!0};(this.value_!==v||N.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=v,this.emitter.emit("change",{options:N,rawValue:this.value_,sender:this}))}}function ve(D,v){const w=v==null?void 0:v.constraint,N=v==null?void 0:v.equals;return w||N?new te(D,v):new Oe(D)}class st{constructor(v){this.emitter=new je,this.valMap_=v;for(const w in this.valMap_)this.valMap_[w].emitter.on("change",()=>{this.emitter.emit("change",{key:w,sender:this})})}static createCore(v){return Object.keys(v).reduce((w,N)=>Object.assign(w,{[N]:ve(v[N])}),{})}static fromObject(v){const w=this.createCore(v);return new st(w)}get(v){return this.valMap_[v].rawValue}set(v,w){this.valMap_[v].rawValue=w}value(v){return this.valMap_[v]}}function qt(D){return v=>w=>{if(!v&&w===void 0)return{succeeded:!1,value:void 0};if(v&&w===void 0)return{succeeded:!0,value:void 0};const N=D(w);return N!==void 0?{succeeded:!0,value:N}:{succeeded:!1,value:void 0}}}function Vt(D){return{custom:v=>qt(v)(D),boolean:qt(v=>typeof v=="boolean"?v:void 0)(D),number:qt(v=>typeof v=="number"?v:void 0)(D),string:qt(v=>typeof v=="string"?v:void 0)(D),function:qt(v=>typeof v=="function"?v:void 0)(D),constant:v=>qt(w=>w===v?v:void 0)(D),raw:qt(v=>v)(D),object:v=>qt(w=>{if((N=w)!==null&&typeof N=="object")return function(Y,fe){return Object.keys(fe).reduce((Me,ut)=>{if(Me===void 0)return;const Ot=(0,fe[ut])(Y[ut]);return Ot.succeeded?Object.assign(Object.assign({},Me),{[ut]:Ot.value}):void 0},{})}(w,v);var N})(D),array:v=>qt(w=>{if(Array.isArray(w))return N=v,w.reduce((Y,fe)=>{if(Y===void 0)return;const Me=N(fe);return Me.succeeded&&Me.value!==void 0?[...Y,Me.value]:void 0},[]);var N})(D)}}const tn={optional:Vt(!0),required:Vt(!1)};function Bt(D,v){const w=tn.required.object(v)(D);return w.succeeded?w.value:void 0}const on=Te(""),Yt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Xt{constructor(v){this.parent_=null,this.blade=v.blade,this.view=v.view,this.viewProps=v.viewProps;const w=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(N=>{w.classList.remove(on(void 0,Yt[N]))}),this.blade.get("positions").forEach(N=>{w.classList.add(on(void 0,Yt[N]))})}),this.viewProps.handleDispose(()=>{(function(N){N&&N.parentElement&&N.parentElement.removeChild(N)})(w)})}get parent(){return this.parent_}}const et="http://www.w3.org/2000/svg";function xt(D){D.offsetHeight}function pt(D){return D.ontouchstart!==void 0}function Gt(){return new Function("return this")().document}const Ze={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function J(D,v){const w=D.createElementNS(et,"svg");return w.innerHTML=Ze[v],w}function ae(D,v,w){D.insertBefore(v,D.children[w])}function Le(D){D.parentElement&&D.parentElement.removeChild(D)}function Kt(D){for(;D.children.length>0;)D.removeChild(D.children[0])}function Qt(D){return D.relatedTarget?D.relatedTarget:"explicitOriginalTarget"in D?D.explicitOriginalTarget:null}const $t=Te("lbl");class jn{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add($t()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("div");N.classList.add($t("l")),ke(w.props,"label",fe=>{Ue(fe)?this.element.classList.add($t(void 0,"nol")):(this.element.classList.remove($t(void 0,"nol")),function(Me){for(;Me.childNodes.length>0;)Me.removeChild(Me.childNodes[0])}(N),N.appendChild(function(Me,ut){const Ot=Me.createDocumentFragment();return ut.split(`
`).map(Tn=>Me.createTextNode(Tn)).forEach((Tn,Ln)=>{Ln>0&&Ot.appendChild(Me.createElement("br")),Ot.appendChild(Tn)}),Ot}(v,fe)))}),this.element.appendChild(N),this.labelElement=N;const Y=v.createElement("div");Y.classList.add($t("v")),this.element.appendChild(Y),this.valueElement=Y}}class ni extends Xt{constructor(v,w){const N=w.valueController.viewProps;super(Object.assign(Object.assign({},w),{view:new jn(v,{props:w.props,viewProps:N}),viewProps:N})),this.props=w.props,this.valueController=w.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Bi={id:"button",type:"blade",accept(D){const v=tn,w=Bt(D,{title:v.required.string,view:v.required.constant("button"),label:v.optional.string});return w?{params:w}:null},controller:D=>new ni(D.document,{blade:D.blade,props:st.fromObject({label:D.params.label}),valueController:new Z(D.document,{props:st.fromObject({title:D.params.title}),viewProps:D.viewProps})}),api:D=>D.controller instanceof ni&&D.controller.valueController instanceof Z?new Qe(D.controller):null};class pi extends Xt{constructor(v){super(v),this.value=v.value}}function Xi(){return new st({positions:ve([],{equals:vt})})}class fi extends st{constructor(v){super(v)}static create(v){const w={completed:!0,expanded:v,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},N=st.createCore(w);return new fi(N)}get styleExpanded(){var v;return(v=this.get("temporaryExpanded"))!==null&&v!==void 0?v:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const v=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ue(v)?`${v}px`:"auto"}bindExpandedClass(v,w){const N=()=>{this.styleExpanded?v.classList.add(w):v.classList.remove(w)};ke(this,"expanded",N),ke(this,"temporaryExpanded",N)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ar(D,v){v.style.height=D.styleHeight}function ki(D,v){D.value("expanded").emitter.on("beforechange",()=>{D.set("completed",!1),Ue(D.get("expandedHeight"))&&D.set("expandedHeight",function(w,N){let Y=0;return function(fe,Me){const ut=fe.style.transition;fe.style.transition="none",Me(),fe.style.transition=ut}(N,()=>{w.set("expandedHeight",null),w.set("temporaryExpanded",!0),xt(N),Y=N.clientHeight,w.set("temporaryExpanded",null),xt(N)}),Y}(D,v)),D.set("shouldFixHeight",!0),xt(v)}),D.emitter.on("change",()=>{ar(D,v)}),ar(D,v),v.addEventListener("transitionend",w=>{w.propertyName==="height"&&D.cleanUpTransition()})}class Qs extends f{constructor(v,w){super(v),this.rackApi_=w}}class fs{constructor(v){this.emitter=new je,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=v}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(v){for(const w of this.allItems())if(v(w))return w;return null}includes(v){return this.cache_.has(v)}add(v,w){if(this.includes(v))throw Je.shouldNeverHappen();const N=w!==void 0?w:this.items_.length;this.items_.splice(N,0,v),this.cache_.add(v);const Y=this.extract_(v);Y&&(Y.emitter.on("add",this.onSubListAdd_),Y.emitter.on("remove",this.onSubListRemove_),Y.allItems().forEach(fe=>{this.cache_.add(fe)})),this.emitter.emit("add",{index:N,item:v,root:this,target:this})}remove(v){const w=this.items_.indexOf(v);if(w<0)return;this.items_.splice(w,1),this.cache_.delete(v);const N=this.extract_(v);N&&(N.emitter.off("add",this.onSubListAdd_),N.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:w,item:v,root:this,target:this})}onSubListAdd_(v){this.cache_.add(v.item),this.emitter.emit("add",{index:v.index,item:v.item,root:this,target:v.target})}onSubListRemove_(v){this.cache_.delete(v.item),this.emitter.emit("remove",{index:v.index,item:v.item,root:this,target:v.target})}}class vr extends f{constructor(v){super(v),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new je,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(v){const w=v.sender.target.read();this.emitter_.emit("change",{event:new ht(this,w,this.controller_.binding.target.presetKey,v.options.last)})}}class Wi extends ni{constructor(v,w){super(v,w),this.binding=w.binding}}class zr extends f{constructor(v){super(v),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new je,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(v){const w=v.sender.target.read();this.emitter_.emit("update",{event:new Ge(this,w,this.controller_.binding.target.presetKey)})}}class Qi extends ni{constructor(v,w){super(v,w),this.binding=w.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Vs(D){return D instanceof Yo?D.apiSet_:D instanceof Qs?D.rackApi_.apiSet_:null}function Ts(D,v){const w=D.find(N=>N.controller_===v);if(!w)throw Je.shouldNeverHappen();return w}function Ki(D,v,w){if(!Ye.isBindable(D))throw Je.notBindable();return new Ye(D,v,w)}class Yo extends f{constructor(v,w){super(v),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new je,this.apiSet_=new fs(Vs),this.pool_=w;const N=this.controller_.rack;N.emitter.on("add",this.onRackAdd_),N.emitter.on("remove",this.onRackRemove_),N.emitter.on("inputchange",this.onRackInputChange_),N.emitter.on("monitorupdate",this.onRackMonitorUpdate_),N.children.forEach(Y=>{this.setUpApi_(Y)})}get children(){return this.controller_.rack.children.map(v=>Ts(this.apiSet_,v))}addInput(v,w,N){const Y=N||{},fe=this.controller_.view.element.ownerDocument,Me=this.pool_.createInput(fe,Ki(v,w,Y.presetKey),Y),ut=new vr(Me);return this.add(ut,Y.index)}addMonitor(v,w,N){const Y=N||{},fe=this.controller_.view.element.ownerDocument,Me=this.pool_.createMonitor(fe,Ki(v,w),Y),ut=new zr(Me);return this.add(ut,Y.index)}addFolder(v){return function(w,N){return w.addBlade(Object.assign(Object.assign({},N),{view:"folder"}))}(this,v)}addButton(v){return function(w,N){return w.addBlade(Object.assign(Object.assign({},N),{view:"button"}))}(this,v)}addSeparator(v){return function(w,N){const Y=N||{};return w.addBlade(Object.assign(Object.assign({},Y),{view:"separator"}))}(this,v)}addTab(v){return function(w,N){return w.addBlade(Object.assign(Object.assign({},N),{view:"tab"}))}(this,v)}add(v,w){this.controller_.rack.add(v.controller_,w);const N=this.apiSet_.find(Y=>Y.controller_===v.controller_);return N&&this.apiSet_.remove(N),this.apiSet_.add(v),v}remove(v){this.controller_.rack.remove(v.controller_)}addBlade(v){const w=this.controller_.view.element.ownerDocument,N=this.pool_.createBlade(w,v),Y=this.pool_.createBladeApi(N);return this.add(Y,v.index)}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}setUpApi_(v){this.apiSet_.find(w=>w.controller_===v)||this.apiSet_.add(this.pool_.createBladeApi(v))}onRackAdd_(v){this.setUpApi_(v.bladeController)}onRackRemove_(v){if(v.isRoot){const w=Ts(this.apiSet_,v.bladeController);this.apiSet_.remove(w)}}onRackInputChange_(v){const w=v.bladeController;if(w instanceof Wi){const N=Ts(this.apiSet_,w),Y=w.binding;this.emitter_.emit("change",{event:new ht(N,Y.target.read(),Y.target.presetKey,v.options.last)})}else if(w instanceof pi){const N=Ts(this.apiSet_,w);this.emitter_.emit("change",{event:new ht(N,w.value.rawValue,void 0,v.options.last)})}}onRackMonitorUpdate_(v){if(!(v.bladeController instanceof Qi))throw Je.shouldNeverHappen();const w=Ts(this.apiSet_,v.bladeController),N=v.bladeController.binding;this.emitter_.emit("update",{event:new Ge(w,N.target.read(),N.target.presetKey)})}}class lr extends Qs{constructor(v,w){super(v,new Yo(v.rackController,w)),this.emitter_=new je,this.controller_.foldable.value("expanded").emitter.on("change",N=>{this.emitter_.emit("fold",{event:new rt(this,N.sender.rawValue)})}),this.rackApi_.on("change",N=>{this.emitter_.emit("change",{event:N})}),this.rackApi_.on("update",N=>{this.emitter_.emit("update",{event:N})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(v){this.controller_.foldable.set("expanded",v)}get title(){return this.controller_.props.get("title")}set title(v){this.controller_.props.set("title",v)}get children(){return this.rackApi_.children}addInput(v,w,N){return this.rackApi_.addInput(v,w,N)}addMonitor(v,w,N){return this.rackApi_.addMonitor(v,w,N)}addFolder(v){return this.rackApi_.addFolder(v)}addButton(v){return this.rackApi_.addButton(v)}addSeparator(v){return this.rackApi_.addSeparator(v)}addTab(v){return this.rackApi_.addTab(v)}add(v,w){return this.rackApi_.add(v,w)}remove(v){this.rackApi_.remove(v)}addBlade(v){return this.rackApi_.addBlade(v)}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}}class ms extends Xt{constructor(v){super({blade:v.blade,view:v.view,viewProps:v.rackController.viewProps}),this.rackController=v.rackController}}class bm{constructor(v,w){const N=Te(w.viewName);this.element=v.createElement("div"),this.element.classList.add(N()),w.viewProps.bindClassModifiers(this.element)}}function cr(D){return D instanceof Wa?D.rack:D instanceof ms?D.rackController.rack:null}function Xo(D){const v=cr(D);return v?v.bcSet_:null}class ur{constructor(v){var w;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new je,this.blade_=v??null,(w=this.blade_)===null||w===void 0||w.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new fs(Xo),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(v,w){v.parent&&v.parent.remove(v),v.parent_=this,this.bcSet_.add(v,w)}remove(v){v.parent_=null,this.bcSet_.remove(v)}find(v){return this.bcSet_.allItems().filter(w=>w instanceof v)}onSetAdd_(v){this.updatePositions_();const w=v.target===v.root;if(this.emitter.emit("add",{bladeController:v.item,index:v.index,isRoot:w,sender:this}),!w)return;const N=v.item;if(N.viewProps.emitter.on("change",this.onChildViewPropsChange_),N.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),N.viewProps.handleDispose(this.onChildDispose_),N instanceof Wi)N.binding.emitter.on("change",this.onChildInputChange_);else if(N instanceof Qi)N.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(N instanceof pi)N.value.emitter.on("change",this.onChildValueChange_);else{const Y=cr(N);if(Y){const fe=Y.emitter;fe.on("layout",this.onDescendantLayout_),fe.on("inputchange",this.onDescendantInputChange_),fe.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(v){this.updatePositions_();const w=v.target===v.root;if(this.emitter.emit("remove",{bladeController:v.item,isRoot:w,sender:this}),!w)return;const N=v.item;if(N instanceof Wi)N.binding.emitter.off("change",this.onChildInputChange_);else if(N instanceof Qi)N.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(N instanceof pi)N.value.emitter.off("change",this.onChildValueChange_);else{const Y=cr(N);if(Y){const fe=Y.emitter;fe.off("layout",this.onDescendantLayout_),fe.off("inputchange",this.onDescendantInputChange_),fe.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const v=this.bcSet_.items.filter(Y=>!Y.viewProps.get("hidden")),w=v[0],N=v[v.length-1];this.bcSet_.items.forEach(Y=>{const fe=[];Y===w&&(fe.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||fe.push("veryfirst")),Y===N&&(fe.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||fe.push("verylast")),Y.blade.set("positions",fe)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(v){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(v=>v.viewProps.get("disposed")).forEach(v=>{this.bcSet_.remove(v)})}onChildInputChange_(v){const w=function(N,Y){for(let fe=0;fe<N.length;fe++){const Me=N[fe];if(Me instanceof Wi&&Me.binding===Y)return Me}return null}(this.find(Wi),v.sender);if(!w)throw Je.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:w,options:v.options,sender:this})}onChildMonitorUpdate_(v){const w=function(N,Y){for(let fe=0;fe<N.length;fe++){const Me=N[fe];if(Me instanceof Qi&&Me.binding===Y)return Me}return null}(this.find(Qi),v.sender);if(!w)throw Je.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:w,sender:this})}onChildValueChange_(v){const w=function(N,Y){for(let fe=0;fe<N.length;fe++){const Me=N[fe];if(Me instanceof pi&&Me.value===Y)return Me}return null}(this.find(pi),v.sender);if(!w)throw Je.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:w,options:v.options,sender:this})}onDescendantLayout_(v){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(v){this.emitter.emit("inputchange",{bladeController:v.bladeController,options:v.options,sender:this})}onDescendantMonitorUpdate_(v){this.emitter.emit("monitorupdate",{bladeController:v.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Wa extends Xt{constructor(v,w){super(Object.assign(Object.assign({},w),{view:new bm(v,{viewName:"brk",viewProps:w.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const N=new ur(w.root?void 0:w.blade);N.emitter.on("add",this.onRackAdd_),N.emitter.on("remove",this.onRackRemove_),this.rack=N,this.viewProps.handleDispose(()=>{for(let Y=this.rack.children.length-1;Y>=0;Y--)this.rack.children[Y].viewProps.set("disposed",!0)})}onRackAdd_(v){v.isRoot&&ae(this.view.element,v.bladeController.view.element,v.index)}onRackRemove_(v){v.isRoot&&Le(v.bladeController.view.element)}}const vh=Te("cnt");class Pi{constructor(v,w){this.className_=Te(w.viewName||"fld"),this.element=v.createElement("div"),this.element.classList.add(this.className_(),vh()),w.viewProps.bindClassModifiers(this.element),this.foldable_=w.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ke(this.foldable_,"completed",mt(this.element,this.className_(void 0,"cpl")));const N=v.createElement("button");N.classList.add(this.className_("b")),ke(w.props,"title",ut=>{Ue(ut)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),w.viewProps.bindDisabled(N),this.element.appendChild(N),this.buttonElement=N;const Y=v.createElement("div");Y.classList.add(this.className_("t")),Ee(w.props.value("title"),Y),this.buttonElement.appendChild(Y),this.titleElement=Y;const fe=v.createElement("div");fe.classList.add(this.className_("m")),this.buttonElement.appendChild(fe);const Me=w.containerElement;Me.classList.add(this.className_("c")),this.element.appendChild(Me),this.containerElement=Me}}class ir extends ms{constructor(v,w){var N;const Y=fi.create((N=w.expanded)===null||N===void 0||N),fe=new Wa(v,{blade:w.blade,root:w.root,viewProps:w.viewProps});super(Object.assign(Object.assign({},w),{rackController:fe,view:new Pi(v,{containerElement:fe.view.element,foldable:Y,props:w.props,viewName:w.root?"rot":void 0,viewProps:w.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=w.props,this.foldable=Y,ki(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Aa={id:"folder",type:"blade",accept(D){const v=tn,w=Bt(D,{title:v.required.string,view:v.required.constant("folder"),expanded:v.optional.boolean});return w?{params:w}:null},controller:D=>new ir(D.document,{blade:D.blade,expanded:D.params.expanded,props:st.fromObject({title:D.params.title}),viewProps:D.viewProps}),api:D=>D.controller instanceof ir?new lr(D.controller,D.pool):null};class Gs extends pi{constructor(v,w){const N=w.valueController.viewProps;super(Object.assign(Object.assign({},w),{value:w.valueController.value,view:new jn(v,{props:w.props,viewProps:N}),viewProps:N})),this.props=w.props,this.valueController=w.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class hd extends f{}const _h=Te("spr");class du{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(_h()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("hr");N.classList.add(_h("r")),this.element.appendChild(N)}}class Ne extends Xt{constructor(v,w){super(Object.assign(Object.assign({},w),{view:new du(v,{viewProps:w.viewProps})}))}}const Qr={id:"separator",type:"blade",accept(D){const v=Bt(D,{view:tn.required.constant("separator")});return v?{params:v}:null},controller:D=>new Ne(D.document,{blade:D.blade,viewProps:D.viewProps}),api:D=>D.controller instanceof Ne?new hd(D.controller):null},ya=Te("");function qa(D,v){return mt(D,ya(void 0,v))}class yi extends st{constructor(v){super(v)}static create(v){var w,N;const Y=v??{},fe={disabled:(w=Y.disabled)!==null&&w!==void 0&&w,disposed:!1,hidden:(N=Y.hidden)!==null&&N!==void 0&&N},Me=st.createCore(fe);return new yi(Me)}bindClassModifiers(v){ke(this,"disabled",qa(v,"disabled")),ke(this,"hidden",qa(v,"hidden"))}bindDisabled(v){ke(this,"disabled",w=>{v.disabled=w})}bindTabIndex(v){ke(this,"disabled",w=>{v.tabIndex=w?-1:0})}handleDispose(v){this.value("disposed").emitter.on("change",w=>{w&&v()})}}const mi=Te("tbi");class Tp{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(mi()),w.viewProps.bindClassModifiers(this.element),ke(w.props,"selected",fe=>{fe?this.element.classList.add(mi(void 0,"sel")):this.element.classList.remove(mi(void 0,"sel"))});const N=v.createElement("button");N.classList.add(mi("b")),w.viewProps.bindDisabled(N),this.element.appendChild(N),this.buttonElement=N;const Y=v.createElement("div");Y.classList.add(mi("t")),Ee(w.props.value("title"),Y),this.buttonElement.appendChild(Y),this.titleElement=Y}}class Ip{constructor(v,w){this.emitter=new je,this.onClick_=this.onClick_.bind(this),this.props=w.props,this.viewProps=w.viewProps,this.view=new Tp(v,{props:w.props,viewProps:w.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Hs{constructor(v,w){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ip(v,{props:w.itemProps,viewProps:yi.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Wa(v,{blade:Xi(),viewProps:yi.create()}),this.props=w.props,ke(this.props,"selected",N=>{this.itemController.props.set("selected",N),this.contentController.viewProps.set("hidden",!N)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ao{constructor(v,w){this.controller_=v,this.rackApi_=w}get title(){var v;return(v=this.controller_.itemController.props.get("title"))!==null&&v!==void 0?v:""}set title(v){this.controller_.itemController.props.set("title",v)}get selected(){return this.controller_.props.get("selected")}set selected(v){this.controller_.props.set("selected",v)}get children(){return this.rackApi_.children}addButton(v){return this.rackApi_.addButton(v)}addFolder(v){return this.rackApi_.addFolder(v)}addSeparator(v){return this.rackApi_.addSeparator(v)}addTab(v){return this.rackApi_.addTab(v)}add(v,w){this.rackApi_.add(v,w)}remove(v){this.rackApi_.remove(v)}addInput(v,w,N){return this.rackApi_.addInput(v,w,N)}addMonitor(v,w,N){return this.rackApi_.addMonitor(v,w,N)}addBlade(v){return this.rackApi_.addBlade(v)}}class dd extends Qs{constructor(v,w){super(v,new Yo(v.rackController,w)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new je,this.pageApiMap_=new Map,this.rackApi_.on("change",N=>{this.emitter_.emit("change",{event:N})}),this.rackApi_.on("update",N=>{this.emitter_.emit("update",{event:N})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(N=>{this.setUpPageApi_(N)})}get pages(){return this.controller_.pageSet.items.map(v=>{const w=this.pageApiMap_.get(v);if(!w)throw Je.shouldNeverHappen();return w})}addPage(v){const w=this.controller_.view.element.ownerDocument,N=new Hs(w,{itemProps:st.fromObject({selected:!1,title:v.title}),props:st.fromObject({selected:!1})});this.controller_.add(N,v.index);const Y=this.pageApiMap_.get(N);if(!Y)throw Je.shouldNeverHappen();return Y}removePage(v){this.controller_.remove(v)}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}setUpPageApi_(v){const w=this.rackApi_.apiSet_.find(Y=>Y.controller_===v.contentController);if(!w)throw Je.shouldNeverHappen();const N=new Ao(v,w);this.pageApiMap_.set(v,N)}onPageAdd_(v){this.setUpPageApi_(v.item)}onPageRemove_(v){if(!this.pageApiMap_.get(v.item))throw Je.shouldNeverHappen();this.pageApiMap_.delete(v.item)}}const yo=Te("tab");class Sl{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(yo(),vh()),w.viewProps.bindClassModifiers(this.element),Ae(w.empty,mt(this.element,yo(void 0,"nop")));const N=v.createElement("div");N.classList.add(yo("i")),this.element.appendChild(N),this.itemsElement=N;const Y=w.contentsElement;Y.classList.add(yo("c")),this.element.appendChild(Y),this.contentsElement=Y}}class Ah extends ms{constructor(v,w){const N=new Wa(v,{blade:w.blade,viewProps:w.viewProps}),Y=ve(!0);super({blade:w.blade,rackController:N,view:new Sl(v,{contentsElement:N.view.element,empty:Y,viewProps:w.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new fs(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=Y,this.applyPages_()}get pageSet(){return this.pageSet_}add(v,w){this.pageSet_.add(v,w??this.pageSet_.items.length)}remove(v){this.pageSet_.remove(this.pageSet_.items[v])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(v){const w=v.item;ae(this.view.itemsElement,w.itemController.view.element,v.index),this.rackController.rack.add(w.contentController,v.index),w.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(v){const w=v.item;Le(w.itemController.view.element),this.rackController.rack.remove(w.contentController),w.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const v=this.pageSet_.items.findIndex(w=>w.props.get("selected"));v<0?this.pageSet_.items.forEach((w,N)=>{w.props.set("selected",N===0)}):this.pageSet_.items.forEach((w,N)=>{w.props.set("selected",N===v)})}onPageSelectedChange_(v){if(v.rawValue){const w=this.pageSet_.items.findIndex(N=>N.props.value("selected")===v.sender);this.pageSet_.items.forEach((N,Y)=>{N.props.set("selected",Y===w)})}else this.keepSelection_()}}const no={id:"tab",type:"blade",accept(D){const v=tn,w=Bt(D,{pages:v.required.array(v.required.object({title:v.required.string})),view:v.required.constant("tab")});return w&&w.pages.length!==0?{params:w}:null},controller(D){const v=new Ah(D.document,{blade:D.blade,viewProps:D.viewProps});return D.params.pages.forEach(w=>{const N=new Hs(D.document,{itemProps:st.fromObject({selected:!1,title:w.title}),props:st.fromObject({selected:!1})});v.add(N)}),v},api:D=>D.controller instanceof Ah?new dd(D.controller,D.pool):null};class pd{constructor(){this.disabled=!1,this.emitter=new je}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class wm{constructor(v,w){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=v,this.emitter=new je,this.interval_=w,this.setTimer_()}get disabled(){return this.disabled_}set disabled(v){this.disabled_=v,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const v=this.doc_.defaultView;v&&v.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const v=this.doc_.defaultView;v&&(this.timerId_=v.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ml{constructor(v){this.constraints=v}constrain(v){return this.constraints.reduce((w,N)=>N.constrain(w),v)}}function io(D,v){if(D instanceof v)return D;if(D instanceof Ml){const w=D.constraints.reduce((N,Y)=>N||(Y instanceof v?Y:null),null);if(w)return w}return null}class Tl{constructor(v){this.options=v}constrain(v){const w=this.options;return w.length===0||w.filter(N=>N.value===v).length>0?v:w[0].value}}class Oi{constructor(v){this.maxValue=v.max,this.minValue=v.min}constrain(v){let w=v;return Ue(this.minValue)||(w=Math.max(w,this.minValue)),Ue(this.maxValue)||(w=Math.min(w,this.maxValue)),w}}class bo{constructor(v){this.step=v}constrain(v){return(v<0?-Math.round(-v/this.step):Math.round(v/this.step))*this.step}}const gs=Te("lst");class pu{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),this.props_=w.props,this.element=v.createElement("div"),this.element.classList.add(gs()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("select");N.classList.add(gs("s")),ke(this.props_,"options",fe=>{Kt(N),fe.forEach((Me,ut)=>{const Ot=v.createElement("option");Ot.dataset.index=String(ut),Ot.textContent=Me.text,Ot.value=String(Me.value),N.appendChild(Ot)})}),w.viewProps.bindDisabled(N),this.element.appendChild(N),this.selectElement=N;const Y=v.createElement("div");Y.classList.add(gs("m")),Y.appendChild(J(v,"dropdown")),this.element.appendChild(Y),w.value.emitter.on("change",this.onValueChange_),this.value_=w.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Kr{constructor(v,w){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=w.props,this.value=w.value,this.viewProps=w.viewProps,this.view=new pu(v,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(v){const w=v.currentTarget.selectedOptions.item(0);if(!w)return;const N=Number(w.dataset.index);this.value.rawValue=this.props.get("options")[N].value}}const gn=Te("pop");class uc{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(gn()),w.viewProps.bindClassModifiers(this.element),Ae(w.shows,mt(this.element,gn(void 0,"v")))}}class An{constructor(v,w){this.shows=ve(!1),this.viewProps=w.viewProps,this.view=new uc(v,{shows:this.shows,viewProps:this.viewProps})}}const Ko=Te("txt");class Il{constructor(v,w){this.onChange_=this.onChange_.bind(this),this.element=v.createElement("div"),this.element.classList.add(Ko()),w.viewProps.bindClassModifiers(this.element),this.props_=w.props,this.props_.emitter.on("change",this.onChange_);const N=v.createElement("input");N.classList.add(Ko("i")),N.type="text",w.viewProps.bindDisabled(N),this.element.appendChild(N),this.inputElement=N,w.value.emitter.on("change",this.onChange_),this.value_=w.value,this.refresh()}refresh(){const v=this.props_.get("formatter");this.inputElement.value=v(this.value_.rawValue)}onChange_(){this.refresh()}}class Si{constructor(v,w){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=w.parser,this.props=w.props,this.value=w.value,this.viewProps=w.viewProps,this.view=new Il(v,{props:w.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(v){const w=v.currentTarget.value,N=this.parser_(w);Ue(N)||(this.value.rawValue=N),this.view.refresh()}}function li(D){return D!=="false"&&!!D}function Ya(D){return function(v){return String(v)}(D)}class yh{constructor(v){this.text=v}evaluate(){return Number(this.text)}toString(){return this.text}}const Dl={"**":(D,v)=>Math.pow(D,v),"*":(D,v)=>D*v,"/":(D,v)=>D/v,"%":(D,v)=>D%v,"+":(D,v)=>D+v,"-":(D,v)=>D-v,"<<":(D,v)=>D<<v,">>":(D,v)=>D>>v,">>>":(D,v)=>D>>>v,"&":(D,v)=>D&v,"^":(D,v)=>D^v,"|":(D,v)=>D|v};class hc{constructor(v,w,N){this.left=w,this.operator=v,this.right=N}evaluate(){const v=Dl[this.operator];if(!v)throw new Error(`unexpected binary operator: '${this.operator}`);return v(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ci={"+":D=>D,"-":D=>-D,"~":D=>~D};class fd{constructor(v,w){this.operator=v,this.expression=w}evaluate(){const v=ci[this.operator];if(!v)throw new Error(`unexpected unary operator: '${this.operator}`);return v(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function dc(D){return(v,w)=>{for(let N=0;N<D.length;N++){const Y=D[N](v,w);if(Y!=="")return Y}return""}}function Pl(D,v){var w;const N=D.substr(v).match(/^\s+/);return(w=N&&N[0])!==null&&w!==void 0?w:""}function Rl(D,v){var w;const N=D.substr(v).match(/^[0-9]+/);return(w=N&&N[0])!==null&&w!==void 0?w:""}function Li(D,v){const w=D.substr(v,1);if(v+=1,w.toLowerCase()!=="e")return"";const N=function(Y,fe){const Me=Rl(Y,fe);if(Me!=="")return Me;const ut=Y.substr(fe,1);if(ut!=="-"&&ut!=="+")return"";const Ot=Rl(Y,fe+=1);return Ot===""?"":ut+Ot}(D,v);return N===""?"":w+N}function Mi(D,v){const w=D.substr(v,1);if(w==="0")return w;const N=function(Y,fe){const Me=Y.substr(fe,1);return Me.match(/^[1-9]$/)?Me:""}(D,v);return v+=N.length,N===""?"":N+Rl(D,v)}const Xa=dc([function(D,v){const w=Mi(D,v);if(v+=w.length,w==="")return"";const N=D.substr(v,1);if(v+=N.length,N!==".")return"";const Y=Rl(D,v);return w+N+Y+Li(D,v+=Y.length)},function(D,v){const w=D.substr(v,1);if(v+=w.length,w!==".")return"";const N=Rl(D,v);return v+=N.length,N===""?"":w+N+Li(D,v)},function(D,v){const w=Mi(D,v);return v+=w.length,w===""?"":w+Li(D,v)}]),Ws=dc([function(D,v){const w=D.substr(v,2);if(v+=w.length,w.toLowerCase()!=="0b")return"";const N=function(Y,fe){var Me;const ut=Y.substr(fe).match(/^[01]+/);return(Me=ut&&ut[0])!==null&&Me!==void 0?Me:""}(D,v);return N===""?"":w+N},function(D,v){const w=D.substr(v,2);if(v+=w.length,w.toLowerCase()!=="0o")return"";const N=function(Y,fe){var Me;const ut=Y.substr(fe).match(/^[0-7]+/);return(Me=ut&&ut[0])!==null&&Me!==void 0?Me:""}(D,v);return N===""?"":w+N},function(D,v){const w=D.substr(v,2);if(v+=w.length,w.toLowerCase()!=="0x")return"";const N=function(Y,fe){var Me;const ut=Y.substr(fe).match(/^[0-9a-f]+/i);return(Me=ut&&ut[0])!==null&&Me!==void 0?Me:""}(D,v);return N===""?"":w+N}]),md=dc([Ws,Xa]);function pc(D,v){return function(w,N){const Y=md(w,N);return N+=Y.length,Y===""?null:{evaluable:new yh(Y),cursor:N}}(D,v)||function(w,N){const Y=w.substr(N,1);if(N+=Y.length,Y!=="(")return null;const fe=Jr(w,N);if(!fe)return null;N=fe.cursor,N+=Pl(w,N).length;const Me=w.substr(N,1);return N+=Me.length,Me!==")"?null:{evaluable:fe.evaluable,cursor:N}}(D,v)}function fc(D,v,w){w+=Pl(v,w).length;const N=D.filter(Y=>v.startsWith(Y,w))[0];return N?(w+=N.length,{cursor:w+=Pl(v,w).length,operator:N}):null}const fu=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((D,v)=>function(w,N){return(Y,fe)=>{const Me=w(Y,fe);if(!Me)return null;fe=Me.cursor;let ut=Me.evaluable;for(;;){const Ot=fc(N,Y,fe);if(!Ot)break;fe=Ot.cursor;const Tn=w(Y,fe);if(!Tn)return null;fe=Tn.cursor,ut=new hc(Ot.operator,ut,Tn.evaluable)}return ut?{cursor:fe,evaluable:ut}:null}}(D,v),function D(v,w){const N=pc(v,w);if(N)return N;const Y=v.substr(w,1);if(w+=Y.length,Y!=="+"&&Y!=="-"&&Y!=="~")return null;const fe=D(v,w);return fe?{cursor:w=fe.cursor,evaluable:new fd(Y,fe.evaluable)}:null});function Jr(D,v){return v+=Pl(D,v).length,fu(D,v)}function Nr(D){var v;const w=function(N){const Y=Jr(N,0);return Y?Y.cursor+Pl(N,Y.cursor).length!==N.length?null:Y.evaluable:null}(D);return(v=w==null?void 0:w.evaluate())!==null&&v!==void 0?v:null}function wo(D){if(typeof D=="number")return D;if(typeof D=="string"){const v=Nr(D);if(!Ue(v))return v}return 0}function mc(D){return String(D)}function Ji(D){return v=>v.toFixed(Math.max(Math.min(D,20),0))}const gd=Ji(0);function Bl(D){return gd(D)+"%"}function xm(D){return String(D)}function gc(D){return D}function Jo(D,v){for(;D.length<v;)D.push(void 0)}function ui(D){const v=[];return Jo(v,D),ve(v)}function Dp(D){const v=D.indexOf(void 0);return v<0?D:D.slice(0,v)}function vc({primary:D,secondary:v,forward:w,backward:N}){let Y=!1;function fe(Me){Y||(Y=!0,Me(),Y=!1)}D.emitter.on("change",Me=>{fe(()=>{v.setRawValue(w(D,v),Me.options)})}),v.emitter.on("change",Me=>{fe(()=>{D.setRawValue(N(D,v),Me.options)}),fe(()=>{v.setRawValue(w(D,v),Me.options)})}),fe(()=>{v.setRawValue(w(D,v),{forceEmit:!1,last:!0})})}function Is(D,v){const w=D*(v.altKey?.1:1)*(v.shiftKey?10:1);return v.upKey?+w:v.downKey?-w:0}function mu(D){return{altKey:D.altKey,downKey:D.key==="ArrowDown",shiftKey:D.shiftKey,upKey:D.key==="ArrowUp"}}function Zr(D){return{altKey:D.altKey,downKey:D.key==="ArrowLeft",shiftKey:D.shiftKey,upKey:D.key==="ArrowRight"}}function $r(D){return function(v){return v==="ArrowUp"||v==="ArrowDown"}(D)||D==="ArrowLeft"||D==="ArrowRight"}function _c(D,v){const w=v.ownerDocument.defaultView,N=v.getBoundingClientRect();return{x:D.pageX-((w&&w.scrollX||0)+N.left),y:D.pageY-((w&&w.scrollY||0)+N.top)}}class es{constructor(v){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=v,this.emitter=new je,v.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),v.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),v.addEventListener("touchend",this.onTouchEnd_),v.addEventListener("mousedown",this.onMouseDown_)}computePosition_(v){const w=this.elem_.getBoundingClientRect();return{bounds:{width:w.width,height:w.height},point:v?{x:v.x,y:v.y}:null}}onMouseDown_(v){var w;v.preventDefault(),(w=v.currentTarget)===null||w===void 0||w.focus();const N=this.elem_.ownerDocument;N.addEventListener("mousemove",this.onDocumentMouseMove_),N.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:v.altKey,data:this.computePosition_(_c(v,this.elem_)),sender:this,shiftKey:v.shiftKey})}onDocumentMouseMove_(v){this.emitter.emit("move",{altKey:v.altKey,data:this.computePosition_(_c(v,this.elem_)),sender:this,shiftKey:v.shiftKey})}onDocumentMouseUp_(v){const w=this.elem_.ownerDocument;w.removeEventListener("mousemove",this.onDocumentMouseMove_),w.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:v.altKey,data:this.computePosition_(_c(v,this.elem_)),sender:this,shiftKey:v.shiftKey})}onTouchStart_(v){v.preventDefault();const w=v.targetTouches.item(0),N=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:v.altKey,data:this.computePosition_(w?{x:w.clientX-N.left,y:w.clientY-N.top}:void 0),sender:this,shiftKey:v.shiftKey}),this.lastTouch_=w}onTouchMove_(v){const w=v.targetTouches.item(0),N=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:v.altKey,data:this.computePosition_(w?{x:w.clientX-N.left,y:w.clientY-N.top}:void 0),sender:this,shiftKey:v.shiftKey}),this.lastTouch_=w}onTouchEnd_(v){var w;const N=(w=v.targetTouches.item(0))!==null&&w!==void 0?w:this.lastTouch_,Y=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:v.altKey,data:this.computePosition_(N?{x:N.clientX-Y.left,y:N.clientY-Y.top}:void 0),sender:this,shiftKey:v.shiftKey})}}function gi(D,v,w,N,Y){return N+(D-v)/(w-v)*(Y-N)}function Vr(D){return String(D.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ri(D,v,w){return Math.min(Math.max(D,v),w)}function vd(D,v){return(D%v+v)%v}const xo=Te("txt");class kl{constructor(v,w){this.onChange_=this.onChange_.bind(this),this.props_=w.props,this.props_.emitter.on("change",this.onChange_),this.element=v.createElement("div"),this.element.classList.add(xo(),xo(void 0,"num")),w.arrayPosition&&this.element.classList.add(xo(void 0,w.arrayPosition)),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("input");N.classList.add(xo("i")),N.type="text",w.viewProps.bindDisabled(N),this.element.appendChild(N),this.inputElement=N,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=w.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(xo()),this.inputElement.classList.add(xo("i"));const Y=v.createElement("div");Y.classList.add(xo("k")),this.element.appendChild(Y),this.knobElement=Y;const fe=v.createElementNS(et,"svg");fe.classList.add(xo("g")),this.knobElement.appendChild(fe);const Me=v.createElementNS(et,"path");Me.classList.add(xo("gb")),fe.appendChild(Me),this.guideBodyElem_=Me;const ut=v.createElementNS(et,"path");ut.classList.add(xo("gh")),fe.appendChild(ut),this.guideHeadElem_=ut;const Ot=v.createElement("div");Ot.classList.add(Te("tt")()),this.knobElement.appendChild(Ot),this.tooltipElem_=Ot,w.value.emitter.on("change",this.onChange_),this.value=w.value,this.refresh()}onDraggingChange_(v){if(v.rawValue===null)return void this.element.classList.remove(xo(void 0,"drg"));this.element.classList.add(xo(void 0,"drg"));const w=v.rawValue/this.props_.get("draggingScale"),N=w+(w>0?-1:w<0?1:0),Y=Ri(-N,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${N+Y},0 L${N},4 L${N+Y},8`,`M ${w},-1 L${w},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${w},4`);const fe=this.props_.get("formatter");this.tooltipElem_.textContent=fe(this.value.rawValue),this.tooltipElem_.style.left=`${w}px`}refresh(){const v=this.props_.get("formatter");this.inputElement.value=v(this.value.rawValue)}onChange_(){this.refresh()}}class Ac{constructor(v,w){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=w.baseStep,this.parser_=w.parser,this.props=w.props,this.value=w.value,this.viewProps=w.viewProps,this.dragging_=ve(null),this.view=new kl(v,{arrayPosition:w.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const N=new es(this.view.knobElement);N.emitter.on("down",this.onPointerDown_),N.emitter.on("move",this.onPointerMove_),N.emitter.on("up",this.onPointerUp_)}onInputChange_(v){const w=v.currentTarget.value,N=this.parser_(w);Ue(N)||(this.value.rawValue=N),this.view.refresh()}onInputKeyDown_(v){const w=Is(this.baseStep_,mu(v));w!==0&&this.value.setRawValue(this.value.rawValue+w,{forceEmit:!1,last:!1})}onInputKeyUp_(v){Is(this.baseStep_,mu(v))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(v){if(!v.point)return null;const w=v.point.x-v.bounds.width/2;return this.originRawValue_+w*this.props.get("draggingScale")}onPointerMove_(v){const w=this.computeDraggingValue_(v.data);w!==null&&(this.value.setRawValue(w,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(v){const w=this.computeDraggingValue_(v.data);w!==null&&(this.value.setRawValue(w,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const hr=Te("sld");class Pp{constructor(v,w){this.onChange_=this.onChange_.bind(this),this.props_=w.props,this.props_.emitter.on("change",this.onChange_),this.element=v.createElement("div"),this.element.classList.add(hr()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("div");N.classList.add(hr("t")),w.viewProps.bindTabIndex(N),this.element.appendChild(N),this.trackElement=N;const Y=v.createElement("div");Y.classList.add(hr("k")),this.trackElement.appendChild(Y),this.knobElement=Y,w.value.emitter.on("change",this.onChange_),this.value=w.value,this.update_()}update_(){const v=Ri(gi(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${v}%`}onChange_(){this.update_()}}class Rp{constructor(v,w){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=w.baseStep,this.value=w.value,this.viewProps=w.viewProps,this.props=w.props,this.view=new Pp(v,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new es(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(v,w){v.point&&this.value.setRawValue(gi(Ri(v.point.x,0,v.bounds.width),0,v.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),w)}onPointerDownOrMove_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerUp_(v){this.handlePointerEvent_(v.data,{forceEmit:!0,last:!0})}onKeyDown_(v){const w=Is(this.baseStep_,Zr(v));w!==0&&this.value.setRawValue(this.value.rawValue+w,{forceEmit:!1,last:!1})}onKeyUp_(v){Is(this.baseStep_,Zr(v))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const vs=Te("sldtxt");class Bp{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(vs());const N=v.createElement("div");N.classList.add(vs("s")),this.sliderView_=w.sliderView,N.appendChild(this.sliderView_.element),this.element.appendChild(N);const Y=v.createElement("div");Y.classList.add(vs("t")),this.textView_=w.textView,Y.appendChild(this.textView_.element),this.element.appendChild(Y)}}class Eo{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.sliderC_=new Rp(v,{baseStep:w.baseStep,props:w.sliderProps,value:w.value,viewProps:this.viewProps}),this.textC_=new Ac(v,{baseStep:w.baseStep,parser:w.parser,props:w.textProps,value:w.value,viewProps:w.viewProps}),this.view=new Bp(v,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Ol(D,v){D.write(v)}function gu(D){const v=tn;return Array.isArray(D)?v.required.array(v.required.object({text:v.required.string,value:v.required.raw}))(D).value:typeof D=="object"?v.required.raw(D).value:void 0}function Em(D){if(D==="inline"||D==="popup")return D}function ba(D){const v=tn;return v.required.object({max:v.optional.number,min:v.optional.number,step:v.optional.number})(D).value}function yc(D){if(Array.isArray(D))return D;const v=[];return Object.keys(D).forEach(w=>{v.push({text:w,value:D[w]})}),v}function dr(D){return Ue(D)?null:new Tl(yc(D))}function _d(D){const v=D?io(D,Tl):null;return v?v.options:null}function Ad(D,v){const w=D&&io(D,bo);return w?Vr(w.step):Math.max(Vr(v),2)}function Ka(D){const v=function(w){const N=w?io(w,bo):null;return N?N.step:null}(D);return v??1}function bc(D,v){var w;const N=D&&io(D,bo),Y=Math.abs((w=N==null?void 0:N.step)!==null&&w!==void 0?w:v);return Y===0?.1:Math.pow(10,Math.floor(Math.log10(Y))-1)}const vu=Te("ckb");class yd{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),this.element=v.createElement("div"),this.element.classList.add(vu()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("label");N.classList.add(vu("l")),this.element.appendChild(N);const Y=v.createElement("input");Y.classList.add(vu("i")),Y.type="checkbox",N.appendChild(Y),this.inputElement=Y,w.viewProps.bindDisabled(this.inputElement);const fe=v.createElement("div");fe.classList.add(vu("w")),N.appendChild(fe);const Me=J(v,"check");fe.appendChild(Me),w.value.emitter.on("change",this.onValueChange_),this.value=w.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Ov{constructor(v,w){this.onInputChange_=this.onInputChange_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.view=new yd(v,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(v){const w=v.currentTarget;this.value.rawValue=w.checked}}const Cm={id:"input-bool",type:"input",accept:(D,v)=>{if(typeof D!="boolean")return null;const w=Bt(v,{options:tn.optional.custom(gu)});return w?{initialValue:D,params:w}:null},binding:{reader:D=>li,constraint:D=>function(v){const w=[],N=dr(v.options);return N&&w.push(N),new Ml(w)}(D.params),writer:D=>Ol},controller:D=>{var v;const w=D.document,N=D.value,Y=D.constraint;return Y&&io(Y,Tl)?new Kr(w,{props:st.fromObject({options:(v=_d(Y))!==null&&v!==void 0?v:[]}),value:N,viewProps:D.viewProps}):new Ov(w,{value:N,viewProps:D.viewProps})}},Ja=Te("col");class bd{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(Ja()),w.foldable.bindExpandedClass(this.element,Ja(void 0,"expanded")),ke(w.foldable,"completed",mt(this.element,Ja(void 0,"cpl")));const N=v.createElement("div");N.classList.add(Ja("h")),this.element.appendChild(N);const Y=v.createElement("div");Y.classList.add(Ja("s")),N.appendChild(Y),this.swatchElement=Y;const fe=v.createElement("div");if(fe.classList.add(Ja("t")),N.appendChild(fe),this.textElement=fe,w.pickerLayout==="inline"){const Me=v.createElement("div");Me.classList.add(Ja("p")),this.element.appendChild(Me),this.pickerElement=Me}else this.pickerElement=null}}function Vn(D,v,w){const N=vd(D,360),Y=Ri(v/100,0,1),fe=Ri(w/100,0,1),Me=fe*Y,ut=Me*(1-Math.abs(N/60%2-1)),Ot=fe-Me;let Tn,Ln,wn;return[Tn,Ln,wn]=N>=0&&N<60?[Me,ut,0]:N>=60&&N<120?[ut,Me,0]:N>=120&&N<180?[0,Me,ut]:N>=180&&N<240?[0,ut,Me]:N>=240&&N<300?[ut,0,Me]:[Me,0,ut],[255*(Tn+Ot),255*(Ln+Ot),255*(wn+Ot)]}function Cr(D){return[D[0],D[1],D[2]]}function kp(D,v){return[D[0],D[1],D[2],v]}const wc={hsl:{hsl:(D,v,w)=>[D,v,w],hsv:function(D,v,w){const N=w+v*(100-Math.abs(2*w-100))/200;return[D,N!==0?v*(100-Math.abs(2*w-100))/N:0,w+v*(100-Math.abs(2*w-100))/200]},rgb:function(D,v,w){const N=(D%360+360)%360,Y=Ri(v/100,0,1),fe=Ri(w/100,0,1),Me=(1-Math.abs(2*fe-1))*Y,ut=Me*(1-Math.abs(N/60%2-1)),Ot=fe-Me/2;let Tn,Ln,wn;return[Tn,Ln,wn]=N>=0&&N<60?[Me,ut,0]:N>=60&&N<120?[ut,Me,0]:N>=120&&N<180?[0,Me,ut]:N>=180&&N<240?[0,ut,Me]:N>=240&&N<300?[ut,0,Me]:[Me,0,ut],[255*(Tn+Ot),255*(Ln+Ot),255*(wn+Ot)]}},hsv:{hsl:function(D,v,w){const N=100-Math.abs(w*(200-v)/100-100);return[D,N!==0?v*w/N:0,w*(200-v)/200]},hsv:(D,v,w)=>[D,v,w],rgb:Vn},rgb:{hsl:function(D,v,w){const N=Ri(D/255,0,1),Y=Ri(v/255,0,1),fe=Ri(w/255,0,1),Me=Math.max(N,Y,fe),ut=Math.min(N,Y,fe),Ot=Me-ut;let Tn=0,Ln=0;const wn=(ut+Me)/2;return Ot!==0&&(Ln=Ot/(1-Math.abs(Me+ut-1)),Tn=N===Me?(Y-fe)/Ot:Y===Me?2+(fe-N)/Ot:4+(N-Y)/Ot,Tn=Tn/6+(Tn<0?1:0)),[360*Tn,100*Ln,100*wn]},hsv:function(D,v,w){const N=Ri(D/255,0,1),Y=Ri(v/255,0,1),fe=Ri(w/255,0,1),Me=Math.max(N,Y,fe),ut=Me-Math.min(N,Y,fe);let Ot;return Ot=ut===0?0:Me===N?((Y-fe)/ut%6+6)%6*60:Me===Y?60*((fe-N)/ut+2):60*((N-Y)/ut+4),[Ot,100*(Me===0?0:ut/Me),100*Me]},rgb:(D,v,w)=>[D,v,w]}},bh={hsl:D=>{var v;return[vd(D[0],360),Ri(D[1],0,100),Ri(D[2],0,100),Ri((v=D[3])!==null&&v!==void 0?v:1,0,1)]},hsv:D=>{var v;return[vd(D[0],360),Ri(D[1],0,100),Ri(D[2],0,100),Ri((v=D[3])!==null&&v!==void 0?v:1,0,1)]},rgb:D=>{var v;return[Ri(D[0],0,255),Ri(D[1],0,255),Ri(D[2],0,255),Ri((v=D[3])!==null&&v!==void 0?v:1,0,1)]}};function _s(D,v){return typeof D=="object"&&!Ue(D)&&v in D&&typeof D[v]=="number"}class On{constructor(v,w){this.mode_=w,this.comps_=bh[w](v)}static black(){return new On([0,0,0],"rgb")}static fromObject(v){const w="a"in v?[v.r,v.g,v.b,v.a]:[v.r,v.g,v.b];return new On(w,"rgb")}static toRgbaObject(v){return v.toRgbaObject()}static isRgbColorObject(v){return _s(v,"r")&&_s(v,"g")&&_s(v,"b")}static isRgbaColorObject(v){return this.isRgbColorObject(v)&&_s(v,"a")}static isColorObject(v){return this.isRgbColorObject(v)}static equals(v,w){if(v.mode_!==w.mode_)return!1;const N=v.comps_,Y=w.comps_;for(let fe=0;fe<N.length;fe++)if(N[fe]!==Y[fe])return!1;return!0}get mode(){return this.mode_}getComponents(v){return kp((w=Cr(this.comps_),N=this.mode_,Y=v||this.mode_,wc[N][Y](...w)),this.comps_[3]);var w,N,Y}toRgbaObject(){const v=this.getComponents("rgb");return{r:v[0],g:v[1],b:v[2],a:v[3]}}}const wa=Te("colp");class wh{constructor(v,w){this.alphaViews_=null,this.element=v.createElement("div"),this.element.classList.add(wa());const N=v.createElement("div");N.classList.add(wa("hsv"));const Y=v.createElement("div");Y.classList.add(wa("sv")),this.svPaletteView_=w.svPaletteView,Y.appendChild(this.svPaletteView_.element),N.appendChild(Y);const fe=v.createElement("div");fe.classList.add(wa("h")),this.hPaletteView_=w.hPaletteView,fe.appendChild(this.hPaletteView_.element),N.appendChild(fe),this.element.appendChild(N);const Me=v.createElement("div");if(Me.classList.add(wa("rgb")),this.textView_=w.textView,Me.appendChild(this.textView_.element),this.element.appendChild(Me),w.alphaViews){this.alphaViews_={palette:w.alphaViews.palette,text:w.alphaViews.text};const ut=v.createElement("div");ut.classList.add(wa("a"));const Ot=v.createElement("div");Ot.classList.add(wa("ap")),Ot.appendChild(this.alphaViews_.palette.element),ut.appendChild(Ot);const Tn=v.createElement("div");Tn.classList.add(wa("at")),Tn.appendChild(this.alphaViews_.text.element),ut.appendChild(Tn),this.element.appendChild(ut)}}get allFocusableElements(){const v=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(w=>w.inputElement)];return this.alphaViews_&&v.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),v}}function xh(D){const v=tn;return Bt(D,{alpha:v.optional.boolean,expanded:v.optional.boolean,picker:v.optional.custom(Em)})}function Ll(D){return D?.1:1}function Ds(D,v){const w=D.match(/^(.+)%$/);return Math.min(w?.01*parseFloat(w[1])*v:parseFloat(D),v)}const Za={deg:D=>D,grad:D=>360*D/400,rad:D=>360*D/(2*Math.PI),turn:D=>360*D};function Vi(D){const v=D.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!v)return parseFloat(D);const w=parseFloat(v[1]),N=v[2];return Za[N](w)}const wd={"func.rgb":D=>{const v=D.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!v)return null;const w=[Ds(v[1],255),Ds(v[2],255),Ds(v[3],255)];return isNaN(w[0])||isNaN(w[1])||isNaN(w[2])?null:new On(w,"rgb")},"func.rgba":D=>{const v=D.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!v)return null;const w=[Ds(v[1],255),Ds(v[2],255),Ds(v[3],255),Ds(v[4],1)];return isNaN(w[0])||isNaN(w[1])||isNaN(w[2])||isNaN(w[3])?null:new On(w,"rgb")},"func.hsl":D=>{const v=D.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!v)return null;const w=[Vi(v[1]),Ds(v[2],100),Ds(v[3],100)];return isNaN(w[0])||isNaN(w[1])||isNaN(w[2])?null:new On(w,"hsl")},"func.hsla":D=>{const v=D.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!v)return null;const w=[Vi(v[1]),Ds(v[2],100),Ds(v[3],100),Ds(v[4],1)];return isNaN(w[0])||isNaN(w[1])||isNaN(w[2])||isNaN(w[3])?null:new On(w,"hsl")},"hex.rgb":D=>{const v=D.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(v)return new On([parseInt(v[1]+v[1],16),parseInt(v[2]+v[2],16),parseInt(v[3]+v[3],16)],"rgb");const w=D.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return w?new On([parseInt(w[1],16),parseInt(w[2],16),parseInt(w[3],16)],"rgb"):null},"hex.rgba":D=>{const v=D.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(v)return new On([parseInt(v[1]+v[1],16),parseInt(v[2]+v[2],16),parseInt(v[3]+v[3],16),gi(parseInt(v[4]+v[4],16),0,255,0,1)],"rgb");const w=D.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return w?new On([parseInt(w[1],16),parseInt(w[2],16),parseInt(w[3],16),gi(parseInt(w[4],16),0,255,0,1)],"rgb"):null}};function Lt(D){return Object.keys(wd).reduce((v,w)=>v||((0,wd[w])(D)?w:null),null)}const ts=D=>{const v=Lt(D);return v?wd[v](D):null};function Sm(D){return D==="func.hsla"||D==="func.rgba"||D==="hex.rgba"}function Op(D){if(typeof D=="string"){const v=ts(D);if(v)return v}return On.black()}function xc(D){const v=Ri(Math.floor(D),0,255).toString(16);return v.length===1?`0${v}`:v}function Ec(D,v="#"){return`${v}${Cr(D.getComponents("rgb")).map(xc).join("")}`}function Zo(D,v="#"){const w=D.getComponents("rgb");return`${v}${[w[0],w[1],w[2],255*w[3]].map(xc).join("")}`}function Eh(D){const v=Ji(0);return`rgb(${Cr(D.getComponents("rgb")).map(w=>v(w)).join(", ")})`}function _u(D){const v=Ji(2),w=Ji(0);return`rgba(${D.getComponents("rgb").map((N,Y)=>(Y===3?v:w)(N)).join(", ")})`}const As={"func.hsl":function(D){const v=[Ji(0),Bl,Bl];return`hsl(${Cr(D.getComponents("hsl")).map((w,N)=>v[N](w)).join(", ")})`},"func.hsla":function(D){const v=[Ji(0),Bl,Bl,Ji(2)];return`hsla(${D.getComponents("hsl").map((w,N)=>v[N](w)).join(", ")})`},"func.rgb":Eh,"func.rgba":_u,"hex.rgb":Ec,"hex.rgba":Zo};function xd(D){return As[D]}const pr=Te("apl");class Co{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),this.value=w.value,this.value.emitter.on("change",this.onValueChange_),this.element=v.createElement("div"),this.element.classList.add(pr()),w.viewProps.bindTabIndex(this.element);const N=v.createElement("div");N.classList.add(pr("b")),this.element.appendChild(N);const Y=v.createElement("div");Y.classList.add(pr("c")),N.appendChild(Y),this.colorElem_=Y;const fe=v.createElement("div");fe.classList.add(pr("m")),this.element.appendChild(fe),this.markerElem_=fe;const Me=v.createElement("div");Me.classList.add(pr("p")),this.markerElem_.appendChild(Me),this.previewElem_=Me,this.update_()}update_(){const v=this.value.rawValue,w=v.getComponents("rgb"),N=new On([w[0],w[1],w[2],0],"rgb"),Y=new On([w[0],w[1],w[2],255],"rgb"),fe=["to right",_u(N),_u(Y)];this.colorElem_.style.background=`linear-gradient(${fe.join(",")})`,this.previewElem_.style.backgroundColor=_u(v);const Me=gi(w[3],0,1,0,100);this.markerElem_.style.left=`${Me}%`}onValueChange_(){this.update_()}}class Au{constructor(v,w){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.view=new Co(v,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new es(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(v,w){if(!v.point)return;const N=v.point.x/v.bounds.width,Y=this.value.rawValue,[fe,Me,ut]=Y.getComponents("hsv");this.value.setRawValue(new On([fe,Me,ut,N],"hsv"),w)}onPointerDown_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerMove_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerUp_(v){this.handlePointerEvent_(v.data,{forceEmit:!0,last:!0})}onKeyDown_(v){const w=Is(Ll(!0),Zr(v));if(w===0)return;const N=this.value.rawValue,[Y,fe,Me,ut]=N.getComponents("hsv");this.value.setRawValue(new On([Y,fe,Me,ut+w],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(v){Is(Ll(!0),Zr(v))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ro=Te("coltxt");class Ed{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(ro());const N=v.createElement("div");N.classList.add(ro("m")),this.modeElem_=function(Me){const ut=Me.createElement("select");return ut.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Ot,Tn)=>{const Ln=Me.createElement("option");return Ln.textContent=Tn.text,Ln.value=Tn.value,Ot.appendChild(Ln),Ot},Me.createDocumentFragment())),ut}(v),this.modeElem_.classList.add(ro("ms")),N.appendChild(this.modeSelectElement);const Y=v.createElement("div");Y.classList.add(ro("mm")),Y.appendChild(J(v,"dropdown")),N.appendChild(Y),this.element.appendChild(N);const fe=v.createElement("div");fe.classList.add(ro("w")),this.element.appendChild(fe),this.textsElem_=fe,this.textViews_=w.textViews,this.applyTextViews_(),Ae(w.colorMode,Me=>{this.modeElem_.value=Me})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(v){this.textViews_=v,this.applyTextViews_()}applyTextViews_(){Kt(this.textsElem_);const v=this.element.ownerDocument;this.textViews_.forEach(w=>{const N=v.createElement("div");N.classList.add(ro("c")),N.appendChild(w.element),this.textsElem_.appendChild(N)})}}const mn=Ji(0),So={rgb:()=>new Oi({min:0,max:255}),hsl:D=>new Oi(D===0?{min:0,max:360}:{min:0,max:100}),hsv:D=>new Oi(D===0?{min:0,max:360}:{min:0,max:100})};function Ch(D,v,w){return new Ac(D,{arrayPosition:w===0?"fst":w===2?"lst":"mid",baseStep:Ll(!1),parser:v.parser,props:st.fromObject({draggingScale:1,formatter:mn}),value:ve(0,{constraint:So[v.colorMode](w)}),viewProps:v.viewProps})}class Cc{constructor(v,w){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=w.parser,this.value=w.value,this.viewProps=w.viewProps,this.colorMode=ve(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(v),this.view=new Ed(v,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(v){const w={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},N=[Ch(v,w,0),Ch(v,w,1),Ch(v,w,2)];return N.forEach((Y,fe)=>{vc({primary:this.value,secondary:Y.value,forward:Me=>Me.rawValue.getComponents(this.colorMode.rawValue)[fe],backward:(Me,ut)=>{const Ot=this.colorMode.rawValue,Tn=Me.rawValue.getComponents(Ot);return Tn[fe]=ut.rawValue,new On(kp(Cr(Tn),Tn[3]),Ot)}})}),N}onModeSelectChange_(v){const w=v.currentTarget;this.colorMode.rawValue=w.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const yu=Te("hpl");class Lp{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),this.value=w.value,this.value.emitter.on("change",this.onValueChange_),this.element=v.createElement("div"),this.element.classList.add(yu()),w.viewProps.bindTabIndex(this.element);const N=v.createElement("div");N.classList.add(yu("c")),this.element.appendChild(N);const Y=v.createElement("div");Y.classList.add(yu("m")),this.element.appendChild(Y),this.markerElem_=Y,this.update_()}update_(){const v=this.value.rawValue,[w]=v.getComponents("hsv");this.markerElem_.style.backgroundColor=Eh(new On([w,100,100],"hsv"));const N=gi(w,0,360,0,100);this.markerElem_.style.left=`${N}%`}onValueChange_(){this.update_()}}class Ur{constructor(v,w){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.view=new Lp(v,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new es(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(v,w){if(!v.point)return;const N=gi(Ri(v.point.x,0,v.bounds.width),0,v.bounds.width,0,359),Y=this.value.rawValue,[,fe,Me,ut]=Y.getComponents("hsv");this.value.setRawValue(new On([N,fe,Me,ut],"hsv"),w)}onPointerDown_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerMove_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerUp_(v){this.handlePointerEvent_(v.data,{forceEmit:!0,last:!0})}onKeyDown_(v){const w=Is(Ll(!1),Zr(v));if(w===0)return;const N=this.value.rawValue,[Y,fe,Me,ut]=N.getComponents("hsv");this.value.setRawValue(new On([Y+w,fe,Me,ut],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(v){Is(Ll(!1),Zr(v))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ti=Te("svp");class qs{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),this.value=w.value,this.value.emitter.on("change",this.onValueChange_),this.element=v.createElement("div"),this.element.classList.add(Ti()),w.viewProps.bindTabIndex(this.element);const N=v.createElement("canvas");N.height=64,N.width=64,N.classList.add(Ti("c")),this.element.appendChild(N),this.canvasElement=N;const Y=v.createElement("div");Y.classList.add(Ti("m")),this.element.appendChild(Y),this.markerElem_=Y,this.update_()}update_(){const v=function(Tn){const Ln=Tn.ownerDocument.defaultView;return Ln&&"document"in Ln?Tn.getContext("2d"):null}(this.canvasElement);if(!v)return;const w=this.value.rawValue.getComponents("hsv"),N=this.canvasElement.width,Y=this.canvasElement.height,fe=v.getImageData(0,0,N,Y),Me=fe.data;for(let Tn=0;Tn<Y;Tn++)for(let Ln=0;Ln<N;Ln++){const wn=gi(Ln,0,N,0,100),$i=gi(Tn,0,Y,100,0),Sr=Vn(w[0],wn,$i),No=4*(Tn*N+Ln);Me[No]=Sr[0],Me[No+1]=Sr[1],Me[No+2]=Sr[2],Me[No+3]=255}v.putImageData(fe,0,0);const ut=gi(w[1],0,100,0,100);this.markerElem_.style.left=`${ut}%`;const Ot=gi(w[2],0,100,100,0);this.markerElem_.style.top=`${Ot}%`}onValueChange_(){this.update_()}}class bu{constructor(v,w){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.view=new qs(v,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new es(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(v,w){if(!v.point)return;const N=gi(v.point.x,0,v.bounds.width,0,100),Y=gi(v.point.y,0,v.bounds.height,100,0),[fe,,,Me]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new On([fe,N,Y,Me],"hsv"),w)}onPointerDown_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerMove_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerUp_(v){this.handlePointerEvent_(v.data,{forceEmit:!0,last:!0})}onKeyDown_(v){$r(v.key)&&v.preventDefault();const[w,N,Y,fe]=this.value.rawValue.getComponents("hsv"),Me=Ll(!1),ut=Is(Me,Zr(v)),Ot=Is(Me,mu(v));ut===0&&Ot===0||this.value.setRawValue(new On([w,N+ut,Y+Ot,fe],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(v){const w=Ll(!1),N=Is(w,Zr(v)),Y=Is(w,mu(v));N===0&&Y===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Mm{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.hPaletteC_=new Ur(v,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new bu(v,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=w.supportsAlpha?{palette:new Au(v,{value:this.value,viewProps:this.viewProps}),text:new Ac(v,{parser:Nr,baseStep:.1,props:st.fromObject({draggingScale:.01,formatter:Ji(2)}),value:ve(0,{constraint:new Oi({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&vc({primary:this.value,secondary:this.alphaIcs_.text.value,forward:N=>N.rawValue.getComponents()[3],backward:(N,Y)=>{const fe=N.rawValue.getComponents();return fe[3]=Y.rawValue,new On(fe,N.rawValue.mode)}}),this.textC_=new Cc(v,{parser:Nr,value:this.value,viewProps:this.viewProps}),this.view=new wh(v,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:w.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Sc=Te("colsw");class Cd{constructor(v,w){this.onValueChange_=this.onValueChange_.bind(this),w.value.emitter.on("change",this.onValueChange_),this.value=w.value,this.element=v.createElement("div"),this.element.classList.add(Sc()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("div");N.classList.add(Sc("sw")),this.element.appendChild(N),this.swatchElem_=N;const Y=v.createElement("button");Y.classList.add(Sc("b")),w.viewProps.bindDisabled(Y),this.element.appendChild(Y),this.buttonElement=Y,this.update_()}update_(){const v=this.value.rawValue;this.swatchElem_.style.backgroundColor=Zo(v)}onValueChange_(){this.update_()}}class Mo{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.view=new Cd(v,{value:this.value,viewProps:this.viewProps})}}class ns{constructor(v,w){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.foldable_=fi.create(w.expanded),this.swatchC_=new Mo(v,{value:this.value,viewProps:this.viewProps});const N=this.swatchC_.view.buttonElement;N.addEventListener("blur",this.onButtonBlur_),N.addEventListener("click",this.onButtonClick_),this.textC_=new Si(v,{parser:w.parser,props:st.fromObject({formatter:w.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new bd(v,{foldable:this.foldable_,pickerLayout:w.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=w.pickerLayout==="popup"?new An(v,{viewProps:this.viewProps}):null;const Y=new Mm(v,{supportsAlpha:w.supportsAlpha,value:this.value,viewProps:this.viewProps});Y.view.allFocusableElements.forEach(fe=>{fe.addEventListener("blur",this.onPopupChildBlur_),fe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Y,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Y.view.element),vc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:fe=>fe.rawValue,backward:(fe,Me)=>Me.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ki(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(v){if(!this.popC_)return;const w=this.view.element,N=v.relatedTarget;N&&w.contains(N)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(v){if(!this.popC_)return;const w=this.popC_.view.element,N=Qt(v);N&&w.contains(N)||N&&N===this.swatchC_.view.buttonElement&&!pt(w.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(v){this.popC_?v.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&v.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function he(D){return On.isColorObject(D)?On.fromObject(D):On.black()}function $a(D){return Cr(D.getComponents("rgb")).reduce((v,w)=>v<<8|255&Math.floor(w),0)}function To(D){return D.getComponents("rgb").reduce((v,w,N)=>v<<8|255&Math.floor(N===3?255*w:w),0)>>>0}function Mc(D){return typeof D!="number"?On.black():new On([(v=D)>>16&255,v>>8&255,255&v],"rgb");var v}function el(D){return typeof D!="number"?On.black():new On([(v=D)>>24&255,v>>16&255,v>>8&255,gi(255&v,0,255,0,1)],"rgb");var v}function Tc(D,v){const w=v.toRgbaObject();D.writeProperty("r",w.r),D.writeProperty("g",w.g),D.writeProperty("b",w.b),D.writeProperty("a",w.a)}function Sd(D,v){const w=v.toRgbaObject();D.writeProperty("r",w.r),D.writeProperty("g",w.g),D.writeProperty("b",w.b)}function $o(D){return"alpha"in D&&D.alpha===!0}function Nl(D){return D?v=>Zo(v,"0x"):v=>Ec(v,"0x")}const tl={id:"input-color-number",type:"input",accept:(D,v)=>{if(typeof D!="number"||!("view"in v)||v.view!=="color")return null;const w=xh(v);return w?{initialValue:D,params:w}:null},binding:{reader:D=>$o(D.params)?el:Mc,equals:On.equals,writer:D=>function(v){const w=v?To:$a;return(N,Y)=>{Ol(N,w(Y))}}($o(D.params))},controller:D=>{const v=$o(D.params),w="expanded"in D.params?D.params.expanded:void 0,N="picker"in D.params?D.params.picker:void 0;return new ns(D.document,{expanded:w!=null&&w,formatter:Nl(v),parser:ts,pickerLayout:N??"popup",supportsAlpha:v,value:D.value,viewProps:D.viewProps})}},ea={id:"input-color-object",type:"input",accept:(D,v)=>{if(!On.isColorObject(D))return null;const w=xh(v);return w?{initialValue:D,params:w}:null},binding:{reader:D=>he,equals:On.equals,writer:D=>{return v=D.initialValue,On.isRgbaColorObject(v)?Tc:Sd;var v}},controller:D=>{const v=On.isRgbaColorObject(D.initialValue),w="expanded"in D.params?D.params.expanded:void 0,N="picker"in D.params?D.params.picker:void 0,Y=v?Zo:Ec;return new ns(D.document,{expanded:w!=null&&w,formatter:Y,parser:ts,pickerLayout:N??"popup",supportsAlpha:v,value:D.value,viewProps:D.viewProps})}},Ul={id:"input-color-string",type:"input",accept:(D,v)=>{if(typeof D!="string"||"view"in v&&v.view==="text"||!Lt(D))return null;const w=xh(v);return w?{initialValue:D,params:w}:null},binding:{reader:D=>Op,equals:On.equals,writer:D=>{const v=Lt(D.initialValue);if(!v)throw Je.shouldNeverHappen();return function(w){const N=xd(w);return(Y,fe)=>{Ol(Y,N(fe))}}(v)}},controller:D=>{const v=Lt(D.initialValue);if(!v)throw Je.shouldNeverHappen();const w=xd(v),N="expanded"in D.params?D.params.expanded:void 0,Y="picker"in D.params?D.params.picker:void 0;return new ns(D.document,{expanded:N!=null&&N,formatter:w,parser:ts,pickerLayout:Y??"popup",supportsAlpha:Sm(v),value:D.value,viewProps:D.viewProps})}};class Ys{constructor(v){this.components=v.components,this.asm_=v.assembly}constrain(v){const w=this.asm_.toComponents(v).map((N,Y)=>{var fe,Me;return(Me=(fe=this.components[Y])===null||fe===void 0?void 0:fe.constrain(N))!==null&&Me!==void 0?Me:N});return this.asm_.fromComponents(w)}}const wu=Te("pndtxt");class Md{constructor(v,w){this.textViews=w.textViews,this.element=v.createElement("div"),this.element.classList.add(wu()),this.textViews.forEach(N=>{const Y=v.createElement("div");Y.classList.add(wu("a")),Y.appendChild(N.element),this.element.appendChild(Y)})}}class Ic{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.acs_=w.axes.map((N,Y)=>function(fe,Me,ut){return new Ac(fe,{arrayPosition:ut===0?"fst":ut===Me.axes.length-1?"lst":"mid",baseStep:Me.axes[ut].baseStep,parser:Me.parser,props:Me.axes[ut].textProps,value:ve(0,{constraint:Me.axes[ut].constraint}),viewProps:Me.viewProps})}(v,w,Y)),this.acs_.forEach((N,Y)=>{vc({primary:this.value,secondary:N.value,forward:fe=>w.assembly.toComponents(fe.rawValue)[Y],backward:(fe,Me)=>{const ut=w.assembly.toComponents(fe.rawValue);return ut[Y]=Me.rawValue,w.assembly.fromComponents(ut)}})}),this.view=new Md(v,{textViews:this.acs_.map(N=>N.view)})}}function Fl(D){const v=[],w=function(fe){return"step"in fe&&!Ue(fe.step)?new bo(fe.step):null}(D);w&&v.push(w);const N=function(fe){return"max"in fe&&!Ue(fe.max)||"min"in fe&&!Ue(fe.min)?new Oi({max:fe.max,min:fe.min}):null}(D);N&&v.push(N);const Y=dr(D.options);return Y&&v.push(Y),new Ml(v)}function Td(D){const[v,w]=function(N){const Y=N?io(N,Oi):null;return Y?[Y.minValue,Y.maxValue]:[void 0,void 0]}(D);return[v??0,w??100]}const vi={id:"input-number",type:"input",accept:(D,v)=>{if(typeof D!="number")return null;const w=tn,N=Bt(v,{format:w.optional.function,max:w.optional.number,min:w.optional.number,options:w.optional.custom(gu),step:w.optional.number});return N?{initialValue:D,params:N}:null},binding:{reader:D=>wo,constraint:D=>Fl(D.params),writer:D=>Ol},controller:D=>{var v,w;const N=D.value,Y=D.constraint;if(Y&&io(Y,Tl))return new Kr(D.document,{props:st.fromObject({options:(v=_d(Y))!==null&&v!==void 0?v:[]}),value:N,viewProps:D.viewProps});const fe=(w="format"in D.params?D.params.format:void 0)!==null&&w!==void 0?w:Ji(Ad(Y,N.rawValue));if(Y&&io(Y,Oi)){const[Me,ut]=Td(Y);return new Eo(D.document,{baseStep:Ka(Y),parser:Nr,sliderProps:st.fromObject({maxValue:ut,minValue:Me}),textProps:st.fromObject({draggingScale:bc(Y,N.rawValue),formatter:fe}),value:N,viewProps:D.viewProps})}return new Ac(D.document,{baseStep:Ka(Y),parser:Nr,props:st.fromObject({draggingScale:bc(Y,N.rawValue),formatter:fe}),value:N,viewProps:D.viewProps})}};class Zi{constructor(v=0,w=0){this.x=v,this.y=w}getComponents(){return[this.x,this.y]}static isObject(v){if(Ue(v))return!1;const w=v.x,N=v.y;return typeof w=="number"&&typeof N=="number"}static equals(v,w){return v.x===w.x&&v.y===w.y}toObject(){return{x:this.x,y:this.y}}}const Io={toComponents:D=>D.getComponents(),fromComponents:D=>new Zi(...D)},so=Te("p2d");class Do{constructor(v,w){this.element=v.createElement("div"),this.element.classList.add(so()),w.viewProps.bindClassModifiers(this.element),Ae(w.expanded,mt(this.element,so(void 0,"expanded")));const N=v.createElement("div");N.classList.add(so("h")),this.element.appendChild(N);const Y=v.createElement("button");Y.classList.add(so("b")),Y.appendChild(J(v,"p2dpad")),w.viewProps.bindDisabled(Y),N.appendChild(Y),this.buttonElement=Y;const fe=v.createElement("div");if(fe.classList.add(so("t")),N.appendChild(fe),this.textElement=fe,w.pickerLayout==="inline"){const Me=v.createElement("div");Me.classList.add(so("p")),this.element.appendChild(Me),this.pickerElement=Me}else this.pickerElement=null}}const Or=Te("p2dp");class Id{constructor(v,w){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=w.invertsY,this.maxValue_=w.maxValue,this.element=v.createElement("div"),this.element.classList.add(Or()),w.layout==="popup"&&this.element.classList.add(Or(void 0,"p"));const N=v.createElement("div");N.classList.add(Or("p")),w.viewProps.bindTabIndex(N),this.element.appendChild(N),this.padElement=N;const Y=v.createElementNS(et,"svg");Y.classList.add(Or("g")),this.padElement.appendChild(Y),this.svgElem_=Y;const fe=v.createElementNS(et,"line");fe.classList.add(Or("ax")),fe.setAttributeNS(null,"x1","0"),fe.setAttributeNS(null,"y1","50%"),fe.setAttributeNS(null,"x2","100%"),fe.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(fe);const Me=v.createElementNS(et,"line");Me.classList.add(Or("ax")),Me.setAttributeNS(null,"x1","50%"),Me.setAttributeNS(null,"y1","0"),Me.setAttributeNS(null,"x2","50%"),Me.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Me);const ut=v.createElementNS(et,"line");ut.classList.add(Or("l")),ut.setAttributeNS(null,"x1","50%"),ut.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(ut),this.lineElem_=ut;const Ot=v.createElement("div");Ot.classList.add(Or("m")),this.padElement.appendChild(Ot),this.markerElem_=Ot,w.value.emitter.on("change",this.onValueChange_),this.value=w.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[v,w]=this.value.rawValue.getComponents(),N=this.maxValue_,Y=gi(v,-N,+N,0,100),fe=gi(w,-N,+N,0,100),Me=this.invertsY_?100-fe:fe;this.lineElem_.setAttributeNS(null,"x2",`${Y}%`),this.lineElem_.setAttributeNS(null,"y2",`${Me}%`),this.markerElem_.style.left=`${Y}%`,this.markerElem_.style.top=`${Me}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function xu(D,v,w){return[Is(v[0],Zr(D)),Is(v[1],mu(D))*(w?1:-1)]}class xa{constructor(v,w){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.baseSteps_=w.baseSteps,this.maxValue_=w.maxValue,this.invertsY_=w.invertsY,this.view=new Id(v,{invertsY:this.invertsY_,layout:w.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new es(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(v,w){if(!v.point)return;const N=this.maxValue_,Y=gi(v.point.x,0,v.bounds.width,-N,+N),fe=gi(this.invertsY_?v.bounds.height-v.point.y:v.point.y,0,v.bounds.height,-N,+N);this.value.setRawValue(new Zi(Y,fe),w)}onPointerDown_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerMove_(v){this.handlePointerEvent_(v.data,{forceEmit:!1,last:!1})}onPointerUp_(v){this.handlePointerEvent_(v.data,{forceEmit:!0,last:!0})}onPadKeyDown_(v){$r(v.key)&&v.preventDefault();const[w,N]=xu(v,this.baseSteps_,this.invertsY_);w===0&&N===0||this.value.setRawValue(new Zi(this.value.rawValue.x+w,this.value.rawValue.y+N),{forceEmit:!1,last:!1})}onPadKeyUp_(v){const[w,N]=xu(v,this.baseSteps_,this.invertsY_);w===0&&N===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Eu{constructor(v,w){var N,Y;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.foldable_=fi.create(w.expanded),this.popC_=w.pickerLayout==="popup"?new An(v,{viewProps:this.viewProps}):null;const fe=new xa(v,{baseSteps:[w.axes[0].baseStep,w.axes[1].baseStep],invertsY:w.invertsY,layout:w.pickerLayout,maxValue:w.maxValue,value:this.value,viewProps:this.viewProps});fe.view.allFocusableElements.forEach(Me=>{Me.addEventListener("blur",this.onPopupChildBlur_),Me.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=fe,this.textC_=new Ic(v,{assembly:Io,axes:w.axes,parser:w.parser,value:this.value,viewProps:this.viewProps}),this.view=new Do(v,{expanded:this.foldable_.value("expanded"),pickerLayout:w.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(N=this.view.buttonElement)===null||N===void 0||N.addEventListener("blur",this.onPadButtonBlur_),(Y=this.view.buttonElement)===null||Y===void 0||Y.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),vc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Me=>Me.rawValue,backward:(Me,ut)=>ut.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ki(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(v){if(!this.popC_)return;const w=this.view.element,N=v.relatedTarget;N&&w.contains(N)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(v){if(!this.popC_)return;const w=this.popC_.view.element,N=Qt(v);N&&w.contains(N)||N&&N===this.view.buttonElement&&!pt(w.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(v){this.popC_?v.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&v.key==="Escape"&&this.view.buttonElement.focus()}}function Sh(D){return Zi.isObject(D)?new Zi(D.x,D.y):new Zi}function Dd(D,v){D.writeProperty("x",v.x),D.writeProperty("y",v.y)}function jl(D){if(!D)return;const v=[];return Ue(D.step)||v.push(new bo(D.step)),Ue(D.max)&&Ue(D.min)||v.push(new Oi({max:D.max,min:D.min})),new Ml(v)}function Gn(D,v){const w=D&&io(D,Oi);if(w)return Math.max(Math.abs(w.minValue||0),Math.abs(w.maxValue||0));const N=Ka(D);return Math.max(10*Math.abs(N),10*Math.abs(v))}function Ni(D,v){const w=v instanceof Ys?v.components[0]:void 0,N=v instanceof Ys?v.components[1]:void 0,Y=Gn(w,D.x),fe=Gn(N,D.y);return Math.max(Y,fe)}function Gr(D,v){return{baseStep:Ka(v),constraint:v,textProps:st.fromObject({draggingScale:bc(v,D),formatter:Ji(Ad(v,D))})}}function Po(D){if(!("y"in D))return!1;const v=D.y;return!!v&&"inverted"in v&&!!v.inverted}const nl={id:"input-point2d",type:"input",accept:(D,v)=>{if(!Zi.isObject(D))return null;const w=tn,N=Bt(v,{expanded:w.optional.boolean,picker:w.optional.custom(Em),x:w.optional.custom(ba),y:w.optional.object({inverted:w.optional.boolean,max:w.optional.number,min:w.optional.number,step:w.optional.number})});return N?{initialValue:D,params:N}:null},binding:{reader:D=>Sh,constraint:D=>{return v=D.params,new Ys({assembly:Io,components:[jl("x"in v?v.x:void 0),jl("y"in v?v.y:void 0)]});var v},equals:Zi.equals,writer:D=>Dd},controller:D=>{const v=D.document,w=D.value,N=D.constraint;if(!(N instanceof Ys))throw Je.shouldNeverHappen();const Y="expanded"in D.params?D.params.expanded:void 0,fe="picker"in D.params?D.params.picker:void 0;return new Eu(v,{axes:[Gr(w.rawValue.x,N.components[0]),Gr(w.rawValue.y,N.components[1])],expanded:Y!=null&&Y,invertsY:Po(D.params),maxValue:Ni(w.rawValue,N),parser:Nr,pickerLayout:fe??"popup",value:w,viewProps:D.viewProps})}};class Hr{constructor(v=0,w=0,N=0){this.x=v,this.y=w,this.z=N}getComponents(){return[this.x,this.y,this.z]}static isObject(v){if(Ue(v))return!1;const w=v.x,N=v.y,Y=v.z;return typeof w=="number"&&typeof N=="number"&&typeof Y=="number"}static equals(v,w){return v.x===w.x&&v.y===w.y&&v.z===w.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Cu={toComponents:D=>D.getComponents(),fromComponents:D=>new Hr(...D)};function Xs(D){return Hr.isObject(D)?new Hr(D.x,D.y,D.z):new Hr}function Np(D,v){D.writeProperty("x",v.x),D.writeProperty("y",v.y),D.writeProperty("z",v.z)}function Mh(D){if(!D)return;const v=[];return Ue(D.step)||v.push(new bo(D.step)),Ue(D.max)&&Ue(D.min)||v.push(new Oi({max:D.max,min:D.min})),new Ml(v)}function ta(D,v){return{baseStep:Ka(v),constraint:v,textProps:st.fromObject({draggingScale:bc(v,D),formatter:Ji(Ad(v,D))})}}const Ps={id:"input-point3d",type:"input",accept:(D,v)=>{if(!Hr.isObject(D))return null;const w=tn,N=Bt(v,{x:w.optional.custom(ba),y:w.optional.custom(ba),z:w.optional.custom(ba)});return N?{initialValue:D,params:N}:null},binding:{reader:D=>Xs,constraint:D=>{return v=D.params,new Ys({assembly:Cu,components:[Mh("x"in v?v.x:void 0),Mh("y"in v?v.y:void 0),Mh("z"in v?v.z:void 0)]});var v},equals:Hr.equals,writer:D=>Np},controller:D=>{const v=D.value,w=D.constraint;if(!(w instanceof Ys))throw Je.shouldNeverHappen();return new Ic(D.document,{assembly:Cu,axes:[ta(v.rawValue.x,w.components[0]),ta(v.rawValue.y,w.components[1]),ta(v.rawValue.z,w.components[2])],parser:Nr,value:v,viewProps:D.viewProps})}};class il{constructor(v=0,w=0,N=0,Y=0){this.x=v,this.y=w,this.z=N,this.w=Y}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(v){if(Ue(v))return!1;const w=v.x,N=v.y,Y=v.z,fe=v.w;return typeof w=="number"&&typeof N=="number"&&typeof Y=="number"&&typeof fe=="number"}static equals(v,w){return v.x===w.x&&v.y===w.y&&v.z===w.z&&v.w===w.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Dc={toComponents:D=>D.getComponents(),fromComponents:D=>new il(...D)};function is(D){return il.isObject(D)?new il(D.x,D.y,D.z,D.w):new il}function oo(D,v){D.writeProperty("x",v.x),D.writeProperty("y",v.y),D.writeProperty("z",v.z),D.writeProperty("w",v.w)}function ys(D){if(!D)return;const v=[];return Ue(D.step)||v.push(new bo(D.step)),Ue(D.max)&&Ue(D.min)||v.push(new Oi({max:D.max,min:D.min})),new Ml(v)}const Ea={id:"input-point4d",type:"input",accept:(D,v)=>{if(!il.isObject(D))return null;const w=tn,N=Bt(v,{x:w.optional.custom(ba),y:w.optional.custom(ba),z:w.optional.custom(ba),w:w.optional.custom(ba)});return N?{initialValue:D,params:N}:null},binding:{reader:D=>is,constraint:D=>{return v=D.params,new Ys({assembly:Dc,components:[ys("x"in v?v.x:void 0),ys("y"in v?v.y:void 0),ys("z"in v?v.z:void 0),ys("w"in v?v.w:void 0)]});var v},equals:il.equals,writer:D=>oo},controller:D=>{const v=D.value,w=D.constraint;if(!(w instanceof Ys))throw Je.shouldNeverHappen();return new Ic(D.document,{assembly:Dc,axes:v.rawValue.getComponents().map((N,Y)=>{return fe=N,{baseStep:Ka(Me=w.components[Y]),constraint:Me,textProps:st.fromObject({draggingScale:bc(Me,fe),formatter:Ji(Ad(Me,fe))})};var fe,Me}),parser:Nr,value:v,viewProps:D.viewProps})}},Pd={id:"input-string",type:"input",accept:(D,v)=>{if(typeof D!="string")return null;const w=Bt(v,{options:tn.optional.custom(gu)});return w?{initialValue:D,params:w}:null},binding:{reader:D=>xm,constraint:D=>function(v){const w=[],N=dr(v.options);return N&&w.push(N),new Ml(w)}(D.params),writer:D=>Ol},controller:D=>{var v;const w=D.document,N=D.value,Y=D.constraint;return Y&&io(Y,Tl)?new Kr(w,{props:st.fromObject({options:(v=_d(Y))!==null&&v!==void 0?v:[]}),value:N,viewProps:D.viewProps}):new Si(w,{parser:fe=>fe,props:st.fromObject({formatter:gc}),value:N,viewProps:D.viewProps})}},zl={defaultInterval:200,defaultLineCount:3},Th=Te("mll");class Pc{constructor(v,w){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=w.formatter,this.element=v.createElement("div"),this.element.classList.add(Th()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("textarea");N.classList.add(Th("i")),N.style.height=`calc(var(--bld-us) * ${w.lineCount})`,N.readOnly=!0,w.viewProps.bindDisabled(N),this.element.appendChild(N),this.textareaElem_=N,w.value.emitter.on("change",this.onValueUpdate_),this.value=w.value,this.update_()}update_(){const v=this.textareaElem_,w=v.scrollTop===v.scrollHeight-v.clientHeight,N=[];this.value.rawValue.forEach(Y=>{Y!==void 0&&N.push(this.formatter_(Y))}),v.textContent=N.join(`
`),w&&(v.scrollTop=v.scrollHeight)}onValueUpdate_(){this.update_()}}class Ql{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.view=new Pc(v,{formatter:w.formatter,lineCount:w.lineCount,value:this.value,viewProps:this.viewProps})}}const Rd=Te("sgl");class Up{constructor(v,w){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=w.formatter,this.element=v.createElement("div"),this.element.classList.add(Rd()),w.viewProps.bindClassModifiers(this.element);const N=v.createElement("input");N.classList.add(Rd("i")),N.readOnly=!0,N.type="text",w.viewProps.bindDisabled(N),this.element.appendChild(N),this.inputElement=N,w.value.emitter.on("change",this.onValueUpdate_),this.value=w.value,this.update_()}update_(){const v=this.value.rawValue,w=v[v.length-1];this.inputElement.value=w!==void 0?this.formatter_(w):""}onValueUpdate_(){this.update_()}}class ei{constructor(v,w){this.value=w.value,this.viewProps=w.viewProps,this.view=new Up(v,{formatter:w.formatter,value:this.value,viewProps:this.viewProps})}}const Ro={id:"monitor-bool",type:"monitor",accept:(D,v)=>{if(typeof D!="boolean")return null;const w=Bt(v,{lineCount:tn.optional.number});return w?{initialValue:D,params:w}:null},binding:{reader:D=>li},controller:D=>{var v;return D.value.rawValue.length===1?new ei(D.document,{formatter:Ya,value:D.value,viewProps:D.viewProps}):new Ql(D.document,{formatter:Ya,lineCount:(v=D.params.lineCount)!==null&&v!==void 0?v:zl.defaultLineCount,value:D.value,viewProps:D.viewProps})}};class Ca{constructor(){this.emitter=new je,this.index_=-1}get index(){return this.index_}set index(v){this.index_!==v&&(this.index_=v,this.emitter.emit("change",{index:v,sender:this}))}}const Rs=Te("grl");class na{constructor(v,w){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=v.createElement("div"),this.element.classList.add(Rs()),w.viewProps.bindClassModifiers(this.element),this.formatter_=w.formatter,this.minValue_=w.minValue,this.maxValue_=w.maxValue,this.cursor_=w.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const N=v.createElementNS(et,"svg");N.classList.add(Rs("g")),N.style.height=`calc(var(--bld-us) * ${w.lineCount})`,this.element.appendChild(N),this.svgElem_=N;const Y=v.createElementNS(et,"polyline");this.svgElem_.appendChild(Y),this.lineElem_=Y;const fe=v.createElement("div");fe.classList.add(Rs("t"),Te("tt")()),this.element.appendChild(fe),this.tooltipElem_=fe,w.value.emitter.on("change",this.onValueUpdate_),this.value=w.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const v=this.svgElem_.getBoundingClientRect(),w=this.value.rawValue.length-1,N=this.minValue_,Y=this.maxValue_,fe=[];this.value.rawValue.forEach((Ln,wn)=>{if(Ln===void 0)return;const $i=gi(wn,0,w,0,v.width),Sr=gi(Ln,N,Y,v.height,0);fe.push([$i,Sr].join(","))}),this.lineElem_.setAttributeNS(null,"points",fe.join(" "));const Me=this.tooltipElem_,ut=this.value.rawValue[this.cursor_.index];if(ut===void 0)return void Me.classList.remove(Rs("t","a"));const Ot=gi(this.cursor_.index,0,w,0,v.width),Tn=gi(ut,N,Y,v.height,0);Me.style.left=`${Ot}px`,Me.style.top=`${Tn}px`,Me.textContent=`${this.formatter_(ut)}`,Me.classList.contains(Rs("t","a"))||(Me.classList.add(Rs("t","a"),Rs("t","in")),xt(Me),Me.classList.remove(Rs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Bo{constructor(v,w){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=w.value,this.viewProps=w.viewProps,this.cursor_=new Ca,this.view=new na(v,{cursor:this.cursor_,formatter:w.formatter,lineCount:w.lineCount,maxValue:w.maxValue,minValue:w.minValue,value:this.value,viewProps:this.viewProps}),pt(v)){const N=new es(this.view.element);N.emitter.on("down",this.onGraphPointerDown_),N.emitter.on("move",this.onGraphPointerMove_),N.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(v){const w=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(gi(v.offsetX,0,w.width,0,this.value.rawValue.length))}onGraphPointerDown_(v){this.onGraphPointerMove_(v)}onGraphPointerMove_(v){v.data.point?this.cursor_.index=Math.floor(gi(v.data.point.x,0,v.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function ko(D){return"format"in D&&!Ue(D.format)?D.format:Ji(2)}function Bd(D){return"view"in D&&D.view==="graph"}const Su={id:"monitor-number",type:"monitor",accept:(D,v)=>{if(typeof D!="number")return null;const w=tn,N=Bt(v,{format:w.optional.function,lineCount:w.optional.number,max:w.optional.number,min:w.optional.number,view:w.optional.string});return N?{initialValue:D,params:N}:null},binding:{defaultBufferSize:D=>Bd(D)?64:1,reader:D=>wo},controller:D=>Bd(D.params)?function(v){var w,N,Y;return new Bo(v.document,{formatter:ko(v.params),lineCount:(w=v.params.lineCount)!==null&&w!==void 0?w:zl.defaultLineCount,maxValue:(N="max"in v.params?v.params.max:null)!==null&&N!==void 0?N:100,minValue:(Y="min"in v.params?v.params.min:null)!==null&&Y!==void 0?Y:0,value:v.value,viewProps:v.viewProps})}(D):function(v){var w;return v.value.rawValue.length===1?new ei(v.document,{formatter:ko(v.params),value:v.value,viewProps:v.viewProps}):new Ql(v.document,{formatter:ko(v.params),lineCount:(w=v.params.lineCount)!==null&&w!==void 0?w:zl.defaultLineCount,value:v.value,viewProps:v.viewProps})}(D)},kd={id:"monitor-string",type:"monitor",accept:(D,v)=>{if(typeof D!="string")return null;const w=tn,N=Bt(v,{lineCount:w.optional.number,multiline:w.optional.boolean});return N?{initialValue:D,params:N}:null},binding:{reader:D=>xm},controller:D=>{var v;const w=D.value;return w.rawValue.length>1||"multiline"in D.params&&D.params.multiline?new Ql(D.document,{formatter:gc,lineCount:(v=D.params.lineCount)!==null&&v!==void 0?v:zl.defaultLineCount,value:w,viewProps:D.viewProps}):new ei(D.document,{formatter:gc,value:w,viewProps:D.viewProps})}};class Vl{constructor(v){this.onValueChange_=this.onValueChange_.bind(this),this.reader=v.reader,this.writer=v.writer,this.emitter=new je,this.value=v.value,this.value.emitter.on("change",this.onValueChange_),this.target=v.target,this.read()}read(){const v=this.target.read();v!==void 0&&(this.value.rawValue=this.reader(v))}write_(v){this.writer(this.target,v)}onValueChange_(v){this.write_(v.rawValue),this.emitter.emit("change",{options:v.options,rawValue:v.rawValue,sender:this})}}class rs{constructor(v){this.onTick_=this.onTick_.bind(this),this.reader_=v.reader,this.target=v.target,this.emitter=new je,this.value=v.value,this.ticker=v.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const v=this.target.read();if(v===void 0)return;const w=this.value.rawValue,N=this.reader_(v);this.value.rawValue=function(Y,fe){const Me=[...Dp(Y),fe];return Me.length>Y.length?Me.splice(0,Me.length-Y.length):Jo(Me,Y.length),Me}(w,N),this.emitter.emit("update",{rawValue:N,sender:this})}onTick_(v){this.read()}}function Tm(D,v){return v===0?new pd:new wm(D,v??zl.defaultInterval)}class ss{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(v){v.type==="blade"?this.pluginsMap_.blades.unshift(v):v.type==="input"?this.pluginsMap_.inputs.unshift(v):v.type==="monitor"&&this.pluginsMap_.monitors.unshift(v)}createInput(v,w,N){if(Ue(w.read()))throw new Je({context:{key:w.key},type:"nomatchingcontroller"});const Y=this.pluginsMap_.inputs.reduce((fe,Me)=>fe||function(ut,Ot){const Tn=ut.accept(Ot.target.read(),Ot.params);if(Ue(Tn))return null;const Ln=tn,wn={target:Ot.target,initialValue:Tn.initialValue,params:Tn.params},$i=ut.binding.reader(wn),Sr=ut.binding.constraint?ut.binding.constraint(wn):void 0,No=ve($i(Tn.initialValue),{constraint:Sr,equals:ut.binding.equals}),bs=new Vl({reader:$i,target:Ot.target,value:No,writer:ut.binding.writer(wn)}),ao=Ln.optional.boolean(Ot.params.disabled).value,ia=Ln.optional.boolean(Ot.params.hidden).value,Rc=ut.controller({constraint:Sr,document:Ot.document,initialValue:Tn.initialValue,params:Tn.params,value:bs.value,viewProps:yi.create({disabled:ao,hidden:ia})}),Gl=Ln.optional.string(Ot.params.label).value;return new Wi(Ot.document,{binding:bs,blade:Xi(),props:st.fromObject({label:Gl||Ot.target.key}),valueController:Rc})}(Me,{document:v,target:w,params:N}),null);if(Y)return Y;throw new Je({context:{key:w.key},type:"nomatchingcontroller"})}createMonitor(v,w,N){const Y=this.pluginsMap_.monitors.reduce((fe,Me)=>fe||function(ut,Ot){var Tn,Ln,wn;const $i=tn,Sr=ut.accept(Ot.target.read(),Ot.params);if(Ue(Sr))return null;const No={target:Ot.target,initialValue:Sr.initialValue,params:Sr.params},bs=ut.binding.reader(No),ao=(Ln=(Tn=$i.optional.number(Ot.params.bufferSize).value)!==null&&Tn!==void 0?Tn:ut.binding.defaultBufferSize&&ut.binding.defaultBufferSize(Sr.params))!==null&&Ln!==void 0?Ln:1,ia=$i.optional.number(Ot.params.interval).value,Rc=new rs({reader:bs,target:Ot.target,ticker:Tm(Ot.document,ia),value:ui(ao)}),Gl=$i.optional.boolean(Ot.params.disabled).value,Iu=$i.optional.boolean(Ot.params.hidden).value,Ih=ut.controller({document:Ot.document,params:Sr.params,value:Rc.value,viewProps:yi.create({disabled:Gl,hidden:Iu})}),Dh=(wn=$i.optional.string(Ot.params.label).value)!==null&&wn!==void 0?wn:Ot.target.key;return new Qi(Ot.document,{binding:Rc,blade:Xi(),props:st.fromObject({label:Dh}),valueController:Ih})}(Me,{document:v,params:N,target:w}),null);if(Y)return Y;throw new Je({context:{key:w.key},type:"nomatchingcontroller"})}createBlade(v,w){const N=this.pluginsMap_.blades.reduce((Y,fe)=>Y||function(Me,ut){const Ot=Me.accept(ut.params);if(!Ot)return null;const Tn=tn.optional.boolean(ut.params.disabled).value,Ln=tn.optional.boolean(ut.params.hidden).value;return Me.controller({blade:Xi(),document:ut.document,params:Object.assign(Object.assign({},Ot.params),{disabled:Tn,hidden:Ln}),viewProps:yi.create({disabled:Tn,hidden:Ln})})}(fe,{document:v,params:w}),null);if(!N)throw new Je({type:"nomatchingview",context:{params:w}});return N}createBladeApi(v){if(v instanceof Wi)return new vr(v);if(v instanceof Qi)return new zr(v);if(v instanceof Wa)return new Yo(v,this);const w=this.pluginsMap_.blades.reduce((N,Y)=>N||Y.api({controller:v,pool:this}),null);if(!w)throw Je.shouldNeverHappen();return w}}class Sa extends f{constructor(v){super(v),this.emitter_=new je,this.controller_.valueController.value.emitter.on("change",w=>{this.emitter_.emit("change",{event:new ht(this,w.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}get options(){return this.controller_.valueController.props.get("options")}set options(v){this.controller_.valueController.props.set("options",v)}get value(){return this.controller_.valueController.value.rawValue}set value(v){this.controller_.valueController.value.rawValue=v}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}}class br extends f{constructor(v){super(v),this.emitter_=new je,this.controller_.valueController.value.emitter.on("change",w=>{this.emitter_.emit("change",{event:new ht(this,w.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(v){this.controller_.valueController.sliderController.props.set("maxValue",v)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(v){this.controller_.valueController.sliderController.props.set("minValue",v)}get value(){return this.controller_.valueController.value.rawValue}set value(v){this.controller_.valueController.value.rawValue=v}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}}class Oo extends f{constructor(v){super(v),this.emitter_=new je,this.controller_.valueController.value.emitter.on("change",w=>{this.emitter_.emit("change",{event:new ht(this,w.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(v){this.controller_.props.set("label",v)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(v){this.controller_.valueController.props.set("formatter",v)}get value(){return this.controller_.valueController.value.rawValue}set value(v){this.controller_.valueController.value.rawValue=v}on(v,w){const N=w.bind(this);return this.emitter_.on(v,Y=>{N(Y.event)}),this}}const ji={id:"list",type:"blade",accept(D){const v=tn,w=Bt(D,{options:v.required.custom(gu),value:v.required.raw,view:v.required.constant("list"),label:v.optional.string});return w?{params:w}:null},controller(D){const v=new Kr(D.document,{props:st.fromObject({options:yc(D.params.options)}),value:ve(D.params.value),viewProps:D.viewProps});return new Gs(D.document,{blade:D.blade,props:st.fromObject({label:D.params.label}),valueController:v})},api:D=>D.controller instanceof Gs&&D.controller.valueController instanceof Kr?new Sa(D.controller):null};class Mu extends lr{constructor(v,w){super(v,w)}get element(){return this.controller_.view.element}importPreset(v){(function(w,N){w.forEach(Y=>{const fe=N[Y.presetKey];fe!==void 0&&Y.write(fe)})})(this.controller_.rackController.rack.find(Wi).map(w=>w.binding.target),v),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Wi).map(v=>v.binding.target).reduce((v,w)=>Object.assign(v,{[w.presetKey]:w.read()}),{})}refresh(){this.controller_.rackController.rack.find(Wi).forEach(v=>{v.binding.read()}),this.controller_.rackController.rack.find(Qi).forEach(v=>{v.binding.read()})}}class Lo extends ir{constructor(v,w){super(v,{expanded:w.expanded,blade:w.blade,props:w.props,root:!0,viewProps:w.viewProps})}}const Tu={id:"slider",type:"blade",accept(D){const v=tn,w=Bt(D,{max:v.required.number,min:v.required.number,view:v.required.constant("slider"),format:v.optional.function,label:v.optional.string,value:v.optional.number});return w?{params:w}:null},controller(D){var v,w;const N=(v=D.params.value)!==null&&v!==void 0?v:0,Y=new Eo(D.document,{baseStep:1,parser:Nr,sliderProps:st.fromObject({maxValue:D.params.max,minValue:D.params.min}),textProps:st.fromObject({draggingScale:bc(void 0,N),formatter:(w=D.params.format)!==null&&w!==void 0?w:mc}),value:ve(N),viewProps:D.viewProps});return new Gs(D.document,{blade:D.blade,props:st.fromObject({label:D.params.label}),valueController:Y})},api:D=>D.controller instanceof Gs&&D.controller.valueController instanceof Eo?new br(D.controller):null},Bs={id:"text",type:"blade",accept(D){const v=tn,w=Bt(D,{parse:v.required.function,value:v.required.raw,view:v.required.constant("text"),format:v.optional.function,label:v.optional.string});return w?{params:w}:null},controller(D){var v;const w=new Si(D.document,{parser:D.params.parse,props:st.fromObject({formatter:(v=D.params.format)!==null&&v!==void 0?v:N=>String(N)}),value:ve(D.params.value),viewProps:D.viewProps});return new Gs(D.document,{blade:D.blade,props:st.fromObject({label:D.params.label}),valueController:w})},api:D=>D.controller instanceof Gs&&D.controller.valueController instanceof Si?new Oo(D.controller):null};function fr(D,v,w){if(D.querySelector(`style[data-tp-style=${v}]`))return;const N=D.createElement("style");N.dataset.tpStyle=v,N.textContent=w,D.head.appendChild(N)}const Fp=new class{constructor(D){const[v,w]=D.split("-"),N=v.split(".");this.major=parseInt(N[0],10),this.minor=parseInt(N[1],10),this.patch=parseInt(N[2],10),this.prerelease=w??null}toString(){const D=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[D,this.prerelease].join("-"):D}}("3.0.8");ct.BladeApi=f,ct.ButtonApi=Qe,ct.FolderApi=lr,ct.InputBindingApi=vr,ct.ListApi=Sa,ct.MonitorBindingApi=zr,ct.Pane=class extends Mu{constructor(D){var v;const w=D||{},N=(v=w.document)!==null&&v!==void 0?v:Gt(),Y=function(){const fe=new ss;return[nl,Ps,Ea,Pd,vi,Ul,ea,tl,Cm,Ro,kd,Su,Bi,Aa,Qr,no].forEach(Me=>{fe.register(Me)}),fe}();super(new Lo(N,{expanded:w.expanded,blade:Xi(),props:st.fromObject({title:w.title}),viewProps:yi.create()}),Y),this.pool_=Y,this.containerElem_=w.container||function(fe){const Me=fe.createElement("div");return Me.classList.add(Te("dfw")()),fe.body&&fe.body.appendChild(Me),Me}(N),this.containerElem_.appendChild(this.element),this.doc_=N,this.usesDefaultWrapper_=!w.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Je.alreadyDisposed();return this.doc_}dispose(){const D=this.containerElem_;if(!D)throw Je.alreadyDisposed();if(this.usesDefaultWrapper_){const v=D.parentElement;v&&v.removeChild(D)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(D){("plugin"in D?[D.plugin]:"plugins"in D?D.plugins:[]).forEach(v=>{this.pool_.register(v),this.embedPluginStyle_(v)})}embedPluginStyle_(D){D.css&&fr(this.document,`plugin-${D.id}`,D.css)}setUpDefaultPlugins_(){fr(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(D=>{this.embedPluginStyle_(D)}),this.registerPlugin({plugins:[Tu,ji,no,Bs]})}},ct.SeparatorApi=hd,ct.SliderApi=br,ct.TabApi=dd,ct.TabPageApi=Ao,ct.TextApi=Oo,ct.TpChangeEvent=ht,ct.VERSION=Fp,Object.defineProperty(ct,"__esModule",{value:!0})})(Tt)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(Mn){super(Mn),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(Mn,Tt){const ct=await super.loadAsync(Mn,Tt);return ct?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(ct,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(Mn=!0,Tt=!1){return Mn&&super.preload(),Tt&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async Mn=>Mn.text()).then(Mn=>{const Tt=Mn.indexOf("/* worker */");if(Tt<1)throw new Error("unable to load decoder module");return Mn.substring(0,Tt-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(Mn,Tt,ct){ct.d(Tt,{$TI:function(){return Ug},$V:function(){return Cw},$Vf:function(){return uy},$YQ:function(){return a0},A5E:function(){return up},AHu:function(){return Vf},AXT:function(){return uf},Aip:function(){return my},B02:function(){return vt},BFQ:function(){return Tl},BG$:function(){return Dl},BKK:function(){return pp},BVF:function(){return Gt},BVQ:function(){return df},BbS:function(){return Zc},Bf4:function(){return Qi},BtG:function(){return Nd},CJI:function(){return rs},CN8:function(){return ay},CP7:function(){return Tr},CaW:function(){return gn},CdI:function(){return fi},Cne:function(){return K0},CtA:function(){return wm},CtF:function(){return Hc},D1R:function(){return Pi},D9w:function(){return no},DT1:function(){return Gf},Djp:function(){return yh},DqL:function(){return uo},DvJ:function(){return Ma},E2K:function(){return Ml},EB7:function(){return cf},EJi:function(){return T0},EoG:function(){return Xi},F5T:function(){return ss},FDw:function(){return ir},FE5:function(){return Es},FIo:function(){return QA},FM8:function(){return Lt},FT0:function(){return D0},FUD:function(){return Rl},FvO:function(){return Cs},GG6:function(){return dc},GQ:function(){return Ba},GUF:function(){return gi},GVz:function(){return Mm},GZb:function(){return hy},Gih:function(){return Pl},Gql:function(){return U0},H$k:function(){return Gh},HTd:function(){return bm},HW6:function(){return fy},HgB:function(){return vu},HkE:function(){return o0},Hmr:function(){return Bf},Hw6:function(){return Cc},Hy8:function(){return Xt},Hyl:function(){return hl},IEO:function(){return Wd},IFH:function(){return Ji},IKL:function(){return VA},ILR:function(){return bo},IOt:function(){return Zr},Ilk:function(){return mn},Inb:function(){return vc},Ir4:function(){return bc},JOQ:function(){return Bc},JQ4:function(){return Ne},JUT:function(){return Sc},JWc:function(){return Ad},KI_:function(){return es},Kgo:function(){return pf},KhW:function(){return Vt},Kj0:function(){return os},Kz5:function(){return du},L5g:function(){return Ku},L5s:function(){return Wo},LBq:function(){return ty},LSk:function(){return Ja},LY2:function(){return ki},L_r:function(){return bd},Lcc:function(){return Oa},LgE:function(){return Dp},LgZ:function(){return on},LsT:function(){return _h},Ltg:function(){return Ti},Lun:function(){return Qd},M5h:function(){return Ee},M6v:function(){return $t},M8C:function(){return wd},Mig:function(){return YA},MyG:function(){return Rp},N$j:function(){return u0},N4l:function(){return mt},NDo:function(){return Bi},NMF:function(){return fu},NYV:function(){return hc},Ns1:function(){return jn},NwF:function(){return Ra},Ny0:function(){return hg},O7d:function(){return Af},OAl:function(){return Ol},OM3:function(){return N},OTo:function(){return Tp},OdW:function(){return nf},OoA:function(){return Yo},Ox3:function(){return qA},PA7:function(){return $r},PMe:function(){return L0},Pa4:function(){return he},PeU:function(){return Ge},Pnf:function(){return Nr},PpQ:function(){return Ch},QM0:function(){return Ka},QRU:function(){return F0},QZ1:function(){return _d},QmN:function(){return ht},Qpg:function(){return sy},R2R:function(){return Vc},REq:function(){return dp},RNb:function(){return Mu},ROQ:function(){return _0},RSm:function(){return xf},Rki:function(){return oy},RlZ:function(){return pt},RsA:function(){return It},RvT:function(){return gu},S2y:function(){return Ue},S3k:function(){return np},S9g:function(){return Ps},SJI:function(){return $A},SPe:function(){return rg},SUY:function(){return Rg},Se2:function(){return Ze},Sm8:function(){return ve},So8:function(){return j0},SvJ:function(){return Mi},Syv:function(){return fc},T95:function(){return Gs},TOt:function(){return vg},TUj:function(){return Sw},TUv:function(){return c0},T_1:function(){return Gg},T_J:function(){return hr},T__:function(){return OA},T_f:function(){return XA},TlE:function(){return ji},Tme:function(){return ei},Tn7:function(){return bg},TyD:function(){return lr},U7:function(){return b0},UCm:function(){return Ip},USm:function(){return ta},UY4:function(){return ag},UZH:function(){return f},Uk6:function(){return zA},UlW:function(){return xm},Uol:function(){return zc},V1s:function(){return Ld},V4E:function(){return py},VLJ:function(){return W0},VYz:function(){return ey},Vdb:function(){return et},Vj0:function(){return Uo},Vkp:function(){return ts},VzW:function(){return Qr},W2J:function(){return yc},WMw:function(){return ke},WTc:function(){return Lo},WXh:function(){return bf},Wbm:function(){return Z},WdD:function(){return ii},Wid:function(){return M0},Wjw:function(){return Hg},Wl3:function(){return je},Wpd:function(){return xt},Wqd:function(){return x0},WwZ:function(){return Bl},Wzm:function(){return lf},XZw:function(){return fp},Xaj:function(){return Ve},Xcj:function(){return z0},XvJ:function(){return Vu},Y8D:function(){return Ao},YBo:function(){return I0},YGz:function(){return ar},YKA:function(){return md},YLQ:function(){return ms},YN5:function(){return cy},YT8:function(){return LA},Ywn:function(){return Cd},Z6B:function(){return Ov},ZAu:function(){return Lc},ZQ6:function(){return jc},ZRs:function(){return xo},ZZA:function(){return Cf},Zp0:function(){return Zl},Zr5:function(){return J},ZzF:function(){return Mc},Zzh:function(){return iy},_12:function(){return Bu},_3:function(){return X0},_AM:function(){return gs},_C8:function(){return Hh},_Li:function(){return me},_MY:function(){return wt},_YM:function(){return Qc},_YX:function(){return Ff},_am:function(){return Lv},_fP:function(){return ns},_iA:function(){return Je},_kC:function(){return Kl},_lf:function(){return wo},_sL:function(){return mc},a$l:function(){return w},aCh:function(){return _c},aH4:function(){return cr},aLr:function(){return Do},aNw:function(){return ls},aVm:function(){return Bs},ad5:function(){return Vr},anP:function(){return Om},aq0:function(){return zf},av9:function(){return pd},b5g:function(){return l0},bGH:function(){return K},b_z:function(){return rr},bdR:function(){return Ae},blk:function(){return qd},bnF:function(){return zh},brP:function(){return Sl},bsb:function(){return Xa},c8b:function(){return st},cBI:function(){return eu},cBK:function(){return B0},cJO:function(){return $d},cLu:function(){return ya},cPb:function(){return ws},cRx:function(){return dd},cU9:function(){return R0},ce8:function(){return vd},cek:function(){return WA},cum:function(){return ba},dSO:function(){return zr},dUE:function(){return Gc},dYG:function(){return wg},dZ3:function(){return Qs},dd2:function(){return qs},dj0:function(){return dr},dpR:function(){return k0},dwk:function(){return Qe},e62:function(){return v},eD:function(){return Le},eMJ:function(){return Pp},eaV:function(){return Kr},ehD:function(){return Te},ejS:function(){return Xl},ekQ:function(){return Ko},epp:function(){return As},fHI:function(){return as},fO1:function(){return v0},fQA:function(){return Qg},fQK:function(){return Km},fSK:function(){return Yt},fY$:function(){return vr},fto:function(){return uc},g8_:function(){return Vs},gH0:function(){return Uf},gSk:function(){return gd},g_z:function(){return hf},ghN:function(){return qt},gi4:function(){return Ya},gti:function(){return w0},hEm:function(){return Ah},hH6:function(){return qc},iAb:function(){return hd},iDF:function(){return fl},iKG:function(){return Pm},iLg:function(){return Ho},iMs:function(){return Fg},iUV:function(){return wi},iWC:function(){return tn},iWj:function(){return Vp},i_9:function(){return Dg},iiP:function(){return Li},irR:function(){return yi},j4z:function(){return Em},j87:function(){return Fp},jAl:function(){return Ws},jFi:function(){return ue},jZA:function(){return Si},jfJ:function(){return kl},jwo:function(){return Bp},jyi:function(){return ng},jyz:function(){return rl},k0A:function(){return qa},k74:function(){return Bt},kB5:function(){return Wl},kFz:function(){return Mo},kaV:function(){return Ef},knz:function(){return ui},kqm:function(){return qu},ksN:function(){return Kt},l0P:function(){return An},l8J:function(){return yd},lCJ:function(){return D},lDi:function(){return Rf},lLk:function(){return Wc},lRF:function(){return $p},lRj:function(){return vh},lb7:function(){return Fh},lfu:function(){return P0},lk7:function(){return Mg},m7l:function(){return Mf},mSO:function(){return mu},mTL:function(){return xw},mXe:function(){return gg},m_w:function(){return Kh},mzJ:function(){return Yh},nls:function(){return lo},ntZ:function(){return Ye},nvb:function(){return ly},o8S:function(){return Vh},oAp:function(){return j_},oa8:function(){return yf},oqc:function(){return Ac},p3g:function(){return bu},p7A:function(){return Y0},p7y:function(){return _r},pBf:function(){return Vn},pIN:function(){return Jr},pKu:function(){return fd},pQR:function(){return Os},ptH:function(){return Il},qhX:function(){return ni},qkB:function(){return yo},qlB:function(){return fr},qyh:function(){return Wa},rAo:function(){return Tu},rBU:function(){return un},rDY:function(){return F_},rOj:function(){return te},r_:function(){return Oe},rnI:function(){return Jo},rpg:function(){return Ts},s4_:function(){return KA},sYA:function(){return Tf},tEQ:function(){return Wh},tGC:function(){return ec},tJx:function(){return Vg},tUh:function(){return ml},tf:function(){return Of},tm_:function(){return rt},trn:function(){return hp},u37:function(){return qh},u7G:function(){return Xc},u9r:function(){return wn},uEv:function(){return pc},uL9:function(){return pi},uWy:function(){return Ki},uXU:function(){return vs},ujx:function(){return dy},v3W:function(){return Oi},v9Y:function(){return Cm},vBJ:function(){return Sa},vCF:function(){return ae},vCx:function(){return pu},vZf:function(){return Xo},vmT:function(){return HA},vpT:function(){return Zm},vxC:function(){return Wi},w$m:function(){return Qt},wJv:function(){return mi},wem:function(){return ur},wk1:function(){return Hs},woe:function(){return ug},wuA:function(){return io},x12:function(){return Yl},x5V:function(){return Ri},xEZ:function(){return Ur},xG9:function(){return ry},xJs:function(){return ci},xWb:function(){return Yu},xeV:function(){return $m},xfE:function(){return fs},xo$:function(){return ep},xoR:function(){return wf},xsS:function(){return CA},y$t:function(){return Kd},y2t:function(){return li},y8_:function(){return cp},yC1:function(){return tp},yGw:function(){return Gn},ybr:function(){return Vd},yj7:function(){return y0},ylh:function(){return op},yo9:function(){return Lu},yt0:function(){return Eo},ywz:function(){return Aa},yxD:function(){return Yc},z$h:function(){return gc},z81:function(){return Is},z8B:function(){return Hd},zHn:function(){return jl},zbs:function(){return Sf},zf8:function(){return sa},zob:function(){return nu}});const f="144dev",It={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ht={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Ge=0,rt=1,Ue=2,vt=3,wt=0,Je=1,Ye=2,Qe=3,je=0,me=1,Te=2,ue=0,Ae=1,ke=2,mt=3,Ee=4,Ve=5,K=100,Z=101,te=102,Oe=103,ve=104,st=200,qt=201,Vt=202,tn=203,Bt=204,on=205,Yt=206,Xt=207,et=208,xt=209,pt=210,Gt=0,Ze=1,J=2,ae=3,Le=4,Kt=5,Qt=6,$t=7,jn=0,ni=1,Bi=2,pi=0,Xi=1,fi=2,ar=3,ki=4,Qs=5,fs=300,vr=301,Wi=302,zr=303,Qi=304,Vs=306,Ts=1e3,Ki=1001,Yo=1002,lr=1003,ms=1004,bm=1004,cr=1005,Xo=1005,ur=1006,Wa=1007,vh=1007,Pi=1008,ir=1008,Aa=1009,Gs=1010,hd=1011,_h=1012,du=1013,Ne=1014,Qr=1015,ya=1016,qa=1017,yi=1018,mi=1020,Tp=1021,Ip=1022,Hs=1023,Ao=1024,dd=1025,yo=1026,Sl=1027,Ah=1028,no=1029,pd=1030,wm=1031,Ml=1033,io=33776,Tl=33777,Oi=33778,bo=33779,gs=35840,pu=35841,Kr=35842,gn=35843,uc=36196,An=37492,Ko=37496,Il=37808,Si=37809,li=37810,Ya=37811,yh=37812,Dl=37813,hc=37814,ci=37815,fd=37816,dc=37817,Pl=37818,Rl=37819,Li=37820,Mi=37821,Xa=36492,Ws=2200,md=2201,pc=2202,fc=2300,fu=2301,Jr=2302,Nr=2400,wo=2401,mc=2402,Ji=2500,gd=2501,Bl=0,xm=1,gc=2,Jo=3e3,ui=3001,Dp=3004,vc=3005,Is=3200,mu=3201,Zr=0,$r=1,_c="",es="srgb",gi="srgb-linear",Vr=0,Ri=7680,vd=7681,xo=7682,kl=7683,Ac=34055,hr=34056,Pp=5386,Rp=512,vs=513,Bp=514,Eo=515,Ol=516,gu=517,Em=518,ba=519,yc=35044,dr=35048,_d=35040,Ad=35045,Ka=35049,bc=35041,vu=35046,yd=35050,Ov=35042,Cm="100",Ja="300 es",bd=1035;class Vn{addEventListener(i,l){this._listeners===void 0&&(this._listeners={});const u=this._listeners;u[i]===void 0&&(u[i]=[]),u[i].indexOf(l)===-1&&u[i].push(l)}hasEventListener(i,l){if(this._listeners===void 0)return!1;const u=this._listeners;return u[i]!==void 0&&u[i].indexOf(l)!==-1}removeEventListener(i,l){if(this._listeners===void 0)return;const u=this._listeners[i];if(u!==void 0){const h=u.indexOf(l);h!==-1&&u.splice(h,1)}}dispatchEvent(i){if(this._listeners===void 0)return;const l=this._listeners[i.type];if(l!==void 0){i.target=this;const u=l.slice(0);for(let h=0,g=u.length;h<g;h++)u[h].call(this,i);i.target=null}}}const Cr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let kp=1234567;const wc=Math.PI/180,bh=180/Math.PI;function _s(){const b=4294967295*Math.random()|0,i=4294967295*Math.random()|0,l=4294967295*Math.random()|0,u=4294967295*Math.random()|0;return(Cr[255&b]+Cr[b>>8&255]+Cr[b>>16&255]+Cr[b>>24&255]+"-"+Cr[255&i]+Cr[i>>8&255]+"-"+Cr[i>>16&15|64]+Cr[i>>24&255]+"-"+Cr[63&l|128]+Cr[l>>8&255]+"-"+Cr[l>>16&255]+Cr[l>>24&255]+Cr[255&u]+Cr[u>>8&255]+Cr[u>>16&255]+Cr[u>>24&255]).toLowerCase()}function On(b,i,l){return Math.max(i,Math.min(l,b))}function wa(b,i){return(b%i+i)%i}function wh(b,i,l){return(1-l)*b+l*i}function xh(b){return(b&b-1)==0&&b!==0}function Ll(b){return Math.pow(2,Math.ceil(Math.log(b)/Math.LN2))}function Ds(b){return Math.pow(2,Math.floor(Math.log(b)/Math.LN2))}function Za(b,i){switch(i.constructor){case Float32Array:return b;case Uint16Array:return b/65535;case Uint8Array:return b/255;case Int16Array:return Math.max(b/32767,-1);case Int8Array:return Math.max(b/127,-1);default:throw new Error("Invalid component type.")}}function Vi(b,i){switch(i.constructor){case Float32Array:return b;case Uint16Array:return Math.round(65535*b);case Uint8Array:return Math.round(255*b);case Int16Array:return Math.round(32767*b);case Int8Array:return Math.round(127*b);default:throw new Error("Invalid component type.")}}var wd=Object.freeze({__proto__:null,DEG2RAD:wc,RAD2DEG:bh,generateUUID:_s,clamp:On,euclideanModulo:wa,mapLinear:function(b,i,l,u,h){return u+(b-i)*(h-u)/(l-i)},inverseLerp:function(b,i,l){return b!==i?(l-b)/(i-b):0},lerp:wh,damp:function(b,i,l,u){return wh(b,i,1-Math.exp(-l*u))},pingpong:function(b,i=1){return i-Math.abs(wa(b,2*i)-i)},smoothstep:function(b,i,l){return b<=i?0:b>=l?1:(b=(b-i)/(l-i))*b*(3-2*b)},smootherstep:function(b,i,l){return b<=i?0:b>=l?1:(b=(b-i)/(l-i))*b*b*(b*(6*b-15)+10)},randInt:function(b,i){return b+Math.floor(Math.random()*(i-b+1))},randFloat:function(b,i){return b+Math.random()*(i-b)},randFloatSpread:function(b){return b*(.5-Math.random())},seededRandom:function(b){b!==void 0&&(kp=b);let i=kp+=1831565813;return i=Math.imul(i^i>>>15,1|i),i^=i+Math.imul(i^i>>>7,61|i),((i^i>>>14)>>>0)/4294967296},degToRad:function(b){return b*wc},radToDeg:function(b){return b*bh},isPowerOfTwo:xh,ceilPowerOfTwo:Ll,floorPowerOfTwo:Ds,setQuaternionFromProperEuler:function(b,i,l,u,h){const g=Math.cos,_=Math.sin,y=g(l/2),C=_(l/2),S=g((i+u)/2),B=_((i+u)/2),L=g((i-u)/2),k=_((i-u)/2),U=g((u-i)/2),Q=_((u-i)/2);switch(h){case"XYX":b.set(y*B,C*L,C*k,y*S);break;case"YZY":b.set(C*k,y*B,C*L,y*S);break;case"ZXZ":b.set(C*L,C*k,y*B,y*S);break;case"XZX":b.set(y*B,C*Q,C*U,y*S);break;case"YXY":b.set(C*U,y*B,C*Q,y*S);break;case"ZYZ":b.set(C*Q,C*U,y*B,y*S);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}},normalize:Vi,denormalize:Za});class Lt{constructor(i=0,l=0){Lt.prototype.isVector2=!0,this.x=i,this.y=l}get width(){return this.x}set width(i){this.x=i}get height(){return this.y}set height(i){this.y=i}set(i,l){return this.x=i,this.y=l,this}setScalar(i){return this.x=i,this.y=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y)}copy(i){return this.x=i.x,this.y=i.y,this}add(i){return this.x+=i.x,this.y+=i.y,this}addScalar(i){return this.x+=i,this.y+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this}subScalar(i){return this.x-=i,this.y-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this}multiply(i){return this.x*=i.x,this.y*=i.y,this}multiplyScalar(i){return this.x*=i,this.y*=i,this}divide(i){return this.x/=i.x,this.y/=i.y,this}divideScalar(i){return this.multiplyScalar(1/i)}applyMatrix3(i){const l=this.x,u=this.y,h=i.elements;return this.x=h[0]*l+h[3]*u+h[6],this.y=h[1]*l+h[4]*u+h[7],this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this}clampLength(i,l){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(i,Math.min(l,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(i){return this.x*i.x+this.y*i.y}cross(i){return this.x*i.y-this.y*i.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const l=this.x-i.x,u=this.y-i.y;return l*l+u*u}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this}lerpVectors(i,l,u){return this.x=i.x+(l.x-i.x)*u,this.y=i.y+(l.y-i.y)*u,this}equals(i){return i.x===this.x&&i.y===this.y}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this}rotateAround(i,l){const u=Math.cos(l),h=Math.sin(l),g=this.x-i.x,_=this.y-i.y;return this.x=g*u-_*h+i.x,this.y=g*h+_*u+i.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ts{constructor(){ts.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(i,l,u,h,g,_,y,C,S){const B=this.elements;return B[0]=i,B[1]=h,B[2]=y,B[3]=l,B[4]=g,B[5]=C,B[6]=u,B[7]=_,B[8]=S,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(i){const l=this.elements,u=i.elements;return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],this}extractBasis(i,l,u){return i.setFromMatrix3Column(this,0),l.setFromMatrix3Column(this,1),u.setFromMatrix3Column(this,2),this}setFromMatrix4(i){const l=i.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,l){const u=i.elements,h=l.elements,g=this.elements,_=u[0],y=u[3],C=u[6],S=u[1],B=u[4],L=u[7],k=u[2],U=u[5],Q=u[8],F=h[0],H=h[3],W=h[6],q=h[1],$=h[4],ie=h[7],se=h[2],le=h[5],Ie=h[8];return g[0]=_*F+y*q+C*se,g[3]=_*H+y*$+C*le,g[6]=_*W+y*ie+C*Ie,g[1]=S*F+B*q+L*se,g[4]=S*H+B*$+L*le,g[7]=S*W+B*ie+L*Ie,g[2]=k*F+U*q+Q*se,g[5]=k*H+U*$+Q*le,g[8]=k*W+U*ie+Q*Ie,this}multiplyScalar(i){const l=this.elements;return l[0]*=i,l[3]*=i,l[6]*=i,l[1]*=i,l[4]*=i,l[7]*=i,l[2]*=i,l[5]*=i,l[8]*=i,this}determinant(){const i=this.elements,l=i[0],u=i[1],h=i[2],g=i[3],_=i[4],y=i[5],C=i[6],S=i[7],B=i[8];return l*_*B-l*y*S-u*g*B+u*y*C+h*g*S-h*_*C}invert(){const i=this.elements,l=i[0],u=i[1],h=i[2],g=i[3],_=i[4],y=i[5],C=i[6],S=i[7],B=i[8],L=B*_-y*S,k=y*C-B*g,U=S*g-_*C,Q=l*L+u*k+h*U;if(Q===0)return this.set(0,0,0,0,0,0,0,0,0);const F=1/Q;return i[0]=L*F,i[1]=(h*S-B*u)*F,i[2]=(y*u-h*_)*F,i[3]=k*F,i[4]=(B*l-h*C)*F,i[5]=(h*g-y*l)*F,i[6]=U*F,i[7]=(u*C-S*l)*F,i[8]=(_*l-u*g)*F,this}transpose(){let i;const l=this.elements;return i=l[1],l[1]=l[3],l[3]=i,i=l[2],l[2]=l[6],l[6]=i,i=l[5],l[5]=l[7],l[7]=i,this}getNormalMatrix(i){return this.setFromMatrix4(i).invert().transpose()}transposeIntoArray(i){const l=this.elements;return i[0]=l[0],i[1]=l[3],i[2]=l[6],i[3]=l[1],i[4]=l[4],i[5]=l[7],i[6]=l[2],i[7]=l[5],i[8]=l[8],this}setUvTransform(i,l,u,h,g,_,y){const C=Math.cos(g),S=Math.sin(g);return this.set(u*C,u*S,-u*(C*_+S*y)+_+i,-h*S,h*C,-h*(-S*_+C*y)+y+l,0,0,1),this}scale(i,l){const u=this.elements;return u[0]*=i,u[3]*=i,u[6]*=i,u[1]*=l,u[4]*=l,u[7]*=l,this}rotate(i){const l=Math.cos(i),u=Math.sin(i),h=this.elements,g=h[0],_=h[3],y=h[6],C=h[1],S=h[4],B=h[7];return h[0]=l*g+u*C,h[3]=l*_+u*S,h[6]=l*y+u*B,h[1]=-u*g+l*C,h[4]=-u*_+l*S,h[7]=-u*y+l*B,this}translate(i,l){const u=this.elements;return u[0]+=i*u[2],u[3]+=i*u[5],u[6]+=i*u[8],u[1]+=l*u[2],u[4]+=l*u[5],u[7]+=l*u[8],this}equals(i){const l=this.elements,u=i.elements;for(let h=0;h<9;h++)if(l[h]!==u[h])return!1;return!0}fromArray(i,l=0){for(let u=0;u<9;u++)this.elements[u]=i[u+l];return this}toArray(i=[],l=0){const u=this.elements;return i[l]=u[0],i[l+1]=u[1],i[l+2]=u[2],i[l+3]=u[3],i[l+4]=u[4],i[l+5]=u[5],i[l+6]=u[6],i[l+7]=u[7],i[l+8]=u[8],i}clone(){return new this.constructor().fromArray(this.elements)}}function Sm(b){for(let i=b.length-1;i>=0;--i)if(b[i]>65535)return!0;return!1}const Op={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function xc(b,i){return new Op[b](i)}function Ec(b){return document.createElementNS("http://www.w3.org/1999/xhtml",b)}function Zo(b){return b<.04045?.0773993808*b:Math.pow(.9478672986*b+.0521327014,2.4)}function Eh(b){return b<.0031308?12.92*b:1.055*Math.pow(b,.41666)-.055}const _u={[es]:{[gi]:Zo},[gi]:{[es]:Eh}},As={legacyMode:!0,get workingColorSpace(){return gi},set workingColorSpace(b){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(b,i,l){if(this.legacyMode||i===l||!i||!l)return b;if(_u[i]&&_u[i][l]!==void 0){const u=_u[i][l];return b.r=u(b.r),b.g=u(b.g),b.b=u(b.b),b}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(b,i){return this.convert(b,this.workingColorSpace,i)},toWorkingColorSpace:function(b,i){return this.convert(b,i,this.workingColorSpace)}},xd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},pr={r:0,g:0,b:0},Co={h:0,s:0,l:0},Au={h:0,s:0,l:0};function ro(b,i,l){return l<0&&(l+=1),l>1&&(l-=1),l<.16666666666666666?b+6*(i-b)*l:l<.5?i:l<.6666666666666666?b+6*(i-b)*(.6666666666666666-l):b}function Ed(b,i){return i.r=b.r,i.g=b.g,i.b=b.b,i}class mn{constructor(i,l,u){return this.isColor=!0,this.r=1,this.g=1,this.b=1,l===void 0&&u===void 0?this.set(i):this.setRGB(i,l,u)}set(i){return i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i),this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,l=es){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,As.toWorkingColorSpace(this,l),this}setRGB(i,l,u,h=gi){return this.r=i,this.g=l,this.b=u,As.toWorkingColorSpace(this,h),this}setHSL(i,l,u,h=gi){if(i=wa(i,1),l=On(l,0,1),u=On(u,0,1),l===0)this.r=this.g=this.b=u;else{const g=u<=.5?u*(1+l):u+l-u*l,_=2*u-g;this.r=ro(_,g,i+.3333333333333333),this.g=ro(_,g,i),this.b=ro(_,g,i-.3333333333333333)}return As.toWorkingColorSpace(this,h),this}setStyle(i,l=es){function u(g){g!==void 0&&parseFloat(g)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}let h;if(h=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(i)){let g;const _=h[1],y=h[2];switch(_){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y))return this.r=Math.min(255,parseInt(g[1],10))/255,this.g=Math.min(255,parseInt(g[2],10))/255,this.b=Math.min(255,parseInt(g[3],10))/255,As.toWorkingColorSpace(this,l),u(g[4]),this;if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y))return this.r=Math.min(100,parseInt(g[1],10))/100,this.g=Math.min(100,parseInt(g[2],10))/100,this.b=Math.min(100,parseInt(g[3],10))/100,As.toWorkingColorSpace(this,l),u(g[4]),this;break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(y)){const C=parseFloat(g[1])/360,S=parseFloat(g[2])/100,B=parseFloat(g[3])/100;return u(g[4]),this.setHSL(C,S,B,l)}}}else if(h=/^\#([A-Fa-f\d]+)$/.exec(i)){const g=h[1],_=g.length;if(_===3)return this.r=parseInt(g.charAt(0)+g.charAt(0),16)/255,this.g=parseInt(g.charAt(1)+g.charAt(1),16)/255,this.b=parseInt(g.charAt(2)+g.charAt(2),16)/255,As.toWorkingColorSpace(this,l),this;if(_===6)return this.r=parseInt(g.charAt(0)+g.charAt(1),16)/255,this.g=parseInt(g.charAt(2)+g.charAt(3),16)/255,this.b=parseInt(g.charAt(4)+g.charAt(5),16)/255,As.toWorkingColorSpace(this,l),this}return i&&i.length>0?this.setColorName(i,l):this}setColorName(i,l=es){const u=xd[i.toLowerCase()];return u!==void 0?this.setHex(u,l):console.warn("THREE.Color: Unknown color "+i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=Zo(i.r),this.g=Zo(i.g),this.b=Zo(i.b),this}copyLinearToSRGB(i){return this.r=Eh(i.r),this.g=Eh(i.g),this.b=Eh(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=es){return As.fromWorkingColorSpace(Ed(this,pr),i),On(255*pr.r,0,255)<<16^On(255*pr.g,0,255)<<8^On(255*pr.b,0,255)<<0}getHexString(i=es){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,l=gi){As.fromWorkingColorSpace(Ed(this,pr),l);const u=pr.r,h=pr.g,g=pr.b,_=Math.max(u,h,g),y=Math.min(u,h,g);let C,S;const B=(y+_)/2;if(y===_)C=0,S=0;else{const L=_-y;switch(S=B<=.5?L/(_+y):L/(2-_-y),_){case u:C=(h-g)/L+(h<g?6:0);break;case h:C=(g-u)/L+2;break;case g:C=(u-h)/L+4}C/=6}return i.h=C,i.s=S,i.l=B,i}getRGB(i,l=gi){return As.fromWorkingColorSpace(Ed(this,pr),l),i.r=pr.r,i.g=pr.g,i.b=pr.b,i}getStyle(i=es){return As.fromWorkingColorSpace(Ed(this,pr),i),i!==es?`color(${i} ${pr.r} ${pr.g} ${pr.b})`:`rgb(${255*pr.r|0},${255*pr.g|0},${255*pr.b|0})`}offsetHSL(i,l,u){return this.getHSL(Co),Co.h+=i,Co.s+=l,Co.l+=u,this.setHSL(Co.h,Co.s,Co.l),this}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,l){return this.r=i.r+l.r,this.g=i.g+l.g,this.b=i.b+l.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,l){return this.r+=(i.r-this.r)*l,this.g+=(i.g-this.g)*l,this.b+=(i.b-this.b)*l,this}lerpColors(i,l,u){return this.r=i.r+(l.r-i.r)*u,this.g=i.g+(l.g-i.g)*u,this.b=i.b+(l.b-i.b)*u,this}lerpHSL(i,l){this.getHSL(Co),i.getHSL(Au);const u=wh(Co.h,Au.h,l),h=wh(Co.s,Au.s,l),g=wh(Co.l,Au.l,l);return this.setHSL(u,h,g),this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,l=0){return this.r=i[l],this.g=i[l+1],this.b=i[l+2],this}toArray(i=[],l=0){return i[l]=this.r,i[l+1]=this.g,i[l+2]=this.b,i}fromBufferAttribute(i,l){return this.r=i.getX(l),this.g=i.getY(l),this.b=i.getZ(l),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let So;mn.NAMES=xd;class Ch{static getDataURL(i,l=!1){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let u;if(i instanceof HTMLCanvasElement)u=i;else{So===void 0&&(So=Ec("canvas")),So.width=i.width,So.height=i.height;const h=So.getContext("2d");i instanceof ImageData?h.putImageData(i,0,0):h.drawImage(i,0,0,i.width,i.height),u=So}return!l&&(u.width>2048||u.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",i),u.toDataURL("image/jpeg",.6)):u.toDataURL("image/png")}static sRGBToLinear(i){if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap){const l=Ec("canvas");l.width=i.width,l.height=i.height;const u=l.getContext("2d");u.drawImage(i,0,0,i.width,i.height);const h=u.getImageData(0,0,i.width,i.height),g=h.data;for(let _=0;_<g.length;_++)g[_]=255*Zo(g[_]/255);return u.putImageData(h,0,0),l}if(i.data){const l=i.data.slice(0);for(let u=0;u<l.length;u++)l instanceof Uint8Array||l instanceof Uint8ClampedArray?l[u]=Math.floor(255*Zo(l[u]/255)):l[u]=Zo(l[u]);return{data:l,width:i.width,height:i.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),i}}class Cc{constructor(i=null){this.isSource=!0,this.uuid=_s(),this.data=i,this.version=0}set needsUpdate(i){i===!0&&this.version++}toJSON(i){const l=i===void 0||typeof i=="string";if(!l&&i.images[this.uuid]!==void 0)return i.images[this.uuid];const u={uuid:this.uuid,url:""},h=this.data;if(h!==null){let g;if(Array.isArray(h)){g=[];for(let _=0,y=h.length;_<y;_++)h[_].isDataTexture?g.push(yu(h[_].image)):g.push(yu(h[_]))}else g=yu(h);u.url=g}return l||(i.images[this.uuid]=u),u}}function yu(b){if(typeof HTMLImageElement<"u"&&b instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&b instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&b instanceof ImageBitmap)return Ch.getDataURL(b);if(b.data){let i=[];try{i=Array.from(b.data)}catch(l){l.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(l),i=b.data}return{data:i,width:b.width,height:b.height,type:b.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Lp=0;class Ur extends Vn{constructor(i=Ur.DEFAULT_IMAGE,l=Ur.DEFAULT_MAPPING,u=Ki,h=Ki,g=ur,_=Pi,y=Hs,C=Aa,S=1,B=Jo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lp++}),this.uuid=_s(),this.name="",this.source=new Cc(i),this.mipmaps=[],this.mapping=l,this.wrapS=u,this.wrapT=h,this.magFilter=g,this.minFilter=_,this.anisotropy=S,this.format=y,this.internalFormat=null,this.type=C,this.offset=new Lt(0,0),this.repeat=new Lt(1,1),this.center=new Lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ts,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=B,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(i){this.source.data=i}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(i){return this.name=i.name,this.source=i.source,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this.userData=JSON.parse(JSON.stringify(i.userData)),this.needsUpdate=!0,this}toJSON(i){const l=i===void 0||typeof i=="string";if(!l&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const u={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(i).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(u.userData=this.userData),l||(i.textures[this.uuid]=u),u}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(i){if(this.mapping!==fs)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case Ts:i.x=i.x-Math.floor(i.x);break;case Ki:i.x=i.x<0?0:1;break;case Yo:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x)}if(i.y<0||i.y>1)switch(this.wrapT){case Ts:i.y=i.y-Math.floor(i.y);break;case Ki:i.y=i.y<0?0:1;break;case Yo:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y)}return this.flipY&&(i.y=1-i.y),i}set needsUpdate(i){i===!0&&(this.version++,this.source.needsUpdate=!0)}}Ur.DEFAULT_IMAGE=null,Ur.DEFAULT_MAPPING=fs;class Ti{constructor(i=0,l=0,u=0,h=1){Ti.prototype.isVector4=!0,this.x=i,this.y=l,this.z=u,this.w=h}get width(){return this.z}set width(i){this.z=i}get height(){return this.w}set height(i){this.w=i}set(i,l,u,h){return this.x=i,this.y=l,this.z=u,this.w=h,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this.w=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setW(i){return this.w=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w!==void 0?i.w:1,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this.w+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this.z=i.z+l.z,this.w=i.w+l.w,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this.z+=i.z*l,this.w+=i.w*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this.w-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this.z=i.z-l.z,this.w=i.w-l.w,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this.w*=i.w,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this}applyMatrix4(i){const l=this.x,u=this.y,h=this.z,g=this.w,_=i.elements;return this.x=_[0]*l+_[4]*u+_[8]*h+_[12]*g,this.y=_[1]*l+_[5]*u+_[9]*h+_[13]*g,this.z=_[2]*l+_[6]*u+_[10]*h+_[14]*g,this.w=_[3]*l+_[7]*u+_[11]*h+_[15]*g,this}divideScalar(i){return this.multiplyScalar(1/i)}setAxisAngleFromQuaternion(i){this.w=2*Math.acos(i.w);const l=Math.sqrt(1-i.w*i.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=i.x/l,this.y=i.y/l,this.z=i.z/l),this}setAxisAngleFromRotationMatrix(i){let l,u,h,g;const C=i.elements,S=C[0],B=C[4],L=C[8],k=C[1],U=C[5],Q=C[9],F=C[2],H=C[6],W=C[10];if(Math.abs(B-k)<.01&&Math.abs(L-F)<.01&&Math.abs(Q-H)<.01){if(Math.abs(B+k)<.1&&Math.abs(L+F)<.1&&Math.abs(Q+H)<.1&&Math.abs(S+U+W-3)<.1)return this.set(1,0,0,0),this;l=Math.PI;const $=(S+1)/2,ie=(U+1)/2,se=(W+1)/2,le=(B+k)/4,Ie=(L+F)/4,De=(Q+H)/4;return $>ie&&$>se?$<.01?(u=0,h=.707106781,g=.707106781):(u=Math.sqrt($),h=le/u,g=Ie/u):ie>se?ie<.01?(u=.707106781,h=0,g=.707106781):(h=Math.sqrt(ie),u=le/h,g=De/h):se<.01?(u=.707106781,h=.707106781,g=0):(g=Math.sqrt(se),u=Ie/g,h=De/g),this.set(u,h,g,l),this}let q=Math.sqrt((H-Q)*(H-Q)+(L-F)*(L-F)+(k-B)*(k-B));return Math.abs(q)<.001&&(q=1),this.x=(H-Q)/q,this.y=(L-F)/q,this.z=(k-B)/q,this.w=Math.acos((S+U+W-1)/2),this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this.w=Math.min(this.w,i.w),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this.w=Math.max(this.w,i.w),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this.z=Math.max(i.z,Math.min(l.z,this.z)),this.w=Math.max(i.w,Math.min(l.w,this.w)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this.z=Math.max(i,Math.min(l,this.z)),this.w=Math.max(i,Math.min(l,this.w)),this}clampLength(i,l){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(i,Math.min(l,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z+this.w*i.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this.z+=(i.z-this.z)*l,this.w+=(i.w-this.w)*l,this}lerpVectors(i,l,u){return this.x=i.x+(l.x-i.x)*u,this.y=i.y+(l.y-i.y)*u,this.z=i.z+(l.z-i.z)*u,this.w=i.w+(l.w-i.w)*u,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z&&i.w===this.w}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this.z=i[l+2],this.w=i[l+3],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i[l+2]=this.z,i[l+3]=this.w,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this.z=i.getZ(l),this.w=i.getW(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class qs extends Vn{constructor(i,l,u={}){super(),this.isWebGLRenderTarget=!0,this.width=i,this.height=l,this.depth=1,this.scissor=new Ti(0,0,i,l),this.scissorTest=!1,this.viewport=new Ti(0,0,i,l);const h={width:i,height:l,depth:1};this.texture=new Ur(h,u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=u.generateMipmaps!==void 0&&u.generateMipmaps,this.texture.internalFormat=u.internalFormat!==void 0?u.internalFormat:null,this.texture.minFilter=u.minFilter!==void 0?u.minFilter:ur,this.depthBuffer=u.depthBuffer===void 0||u.depthBuffer,this.stencilBuffer=u.stencilBuffer!==void 0&&u.stencilBuffer,this.depthTexture=u.depthTexture!==void 0?u.depthTexture:null,this.samples=u.samples!==void 0?u.samples:0}setSize(i,l,u=1){this.width===i&&this.height===l&&this.depth===u||(this.width=i,this.height=l,this.depth=u,this.texture.image.width=i,this.texture.image.height=l,this.texture.image.depth=u,this.dispose()),this.viewport.set(0,0,i,l),this.scissor.set(0,0,i,l)}clone(){return new this.constructor().copy(this)}copy(i){this.width=i.width,this.height=i.height,this.depth=i.depth,this.viewport.copy(i.viewport),this.texture=i.texture.clone(),this.texture.isRenderTargetTexture=!0;const l=Object.assign({},i.texture.image);return this.texture.source=new Cc(l),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.samples=i.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class bu extends Ur{constructor(i=null,l=1,u=1,h=1){super(null),this.isDataArrayTexture=!0,this.image={data:i,width:l,height:u,depth:h},this.magFilter=lr,this.minFilter=lr,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Mm extends qs{constructor(i,l,u){super(i,l),this.isWebGLArrayRenderTarget=!0,this.depth=u,this.texture=new bu(null,i,l,u),this.texture.isRenderTargetTexture=!0}}class Sc extends Ur{constructor(i=null,l=1,u=1,h=1){super(null),this.isData3DTexture=!0,this.image={data:i,width:l,height:u,depth:h},this.magFilter=lr,this.minFilter=lr,this.wrapR=Ki,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Cd extends qs{constructor(i,l,u){super(i,l),this.isWebGL3DRenderTarget=!0,this.depth=u,this.texture=new Sc(null,i,l,u),this.texture.isRenderTargetTexture=!0}}class Mo extends qs{constructor(i,l,u,h={}){super(i,l,h),this.isWebGLMultipleRenderTargets=!0;const g=this.texture;this.texture=[];for(let _=0;_<u;_++)this.texture[_]=g.clone(),this.texture[_].isRenderTargetTexture=!0}setSize(i,l,u=1){if(this.width!==i||this.height!==l||this.depth!==u){this.width=i,this.height=l,this.depth=u;for(let h=0,g=this.texture.length;h<g;h++)this.texture[h].image.width=i,this.texture[h].image.height=l,this.texture[h].image.depth=u;this.dispose()}return this.viewport.set(0,0,i,l),this.scissor.set(0,0,i,l),this}copy(i){this.dispose(),this.width=i.width,this.height=i.height,this.depth=i.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.texture.length=0;for(let l=0,u=i.texture.length;l<u;l++)this.texture[l]=i.texture[l].clone(),this.texture[l].isRenderTargetTexture=!0;return this}}class ns{constructor(i=0,l=0,u=0,h=1){this.isQuaternion=!0,this._x=i,this._y=l,this._z=u,this._w=h}static slerpFlat(i,l,u,h,g,_,y){let C=u[h+0],S=u[h+1],B=u[h+2],L=u[h+3];const k=g[_+0],U=g[_+1],Q=g[_+2],F=g[_+3];if(y===0)return i[l+0]=C,i[l+1]=S,i[l+2]=B,void(i[l+3]=L);if(y===1)return i[l+0]=k,i[l+1]=U,i[l+2]=Q,void(i[l+3]=F);if(L!==F||C!==k||S!==U||B!==Q){let H=1-y;const W=C*k+S*U+B*Q+L*F,q=W>=0?1:-1,$=1-W*W;if($>Number.EPSILON){const se=Math.sqrt($),le=Math.atan2(se,W*q);H=Math.sin(H*le)/se,y=Math.sin(y*le)/se}const ie=y*q;if(C=C*H+k*ie,S=S*H+U*ie,B=B*H+Q*ie,L=L*H+F*ie,H===1-y){const se=1/Math.sqrt(C*C+S*S+B*B+L*L);C*=se,S*=se,B*=se,L*=se}}i[l]=C,i[l+1]=S,i[l+2]=B,i[l+3]=L}static multiplyQuaternionsFlat(i,l,u,h,g,_){const y=u[h],C=u[h+1],S=u[h+2],B=u[h+3],L=g[_],k=g[_+1],U=g[_+2],Q=g[_+3];return i[l]=y*Q+B*L+C*U-S*k,i[l+1]=C*Q+B*k+S*L-y*U,i[l+2]=S*Q+B*U+y*k-C*L,i[l+3]=B*Q-y*L-C*k-S*U,i}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get w(){return this._w}set w(i){this._w=i,this._onChangeCallback()}set(i,l,u,h){return this._x=i,this._y=l,this._z=u,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(i){return this._x=i.x,this._y=i.y,this._z=i.z,this._w=i.w,this._onChangeCallback(),this}setFromEuler(i,l){const u=i._x,h=i._y,g=i._z,_=i._order,y=Math.cos,C=Math.sin,S=y(u/2),B=y(h/2),L=y(g/2),k=C(u/2),U=C(h/2),Q=C(g/2);switch(_){case"XYZ":this._x=k*B*L+S*U*Q,this._y=S*U*L-k*B*Q,this._z=S*B*Q+k*U*L,this._w=S*B*L-k*U*Q;break;case"YXZ":this._x=k*B*L+S*U*Q,this._y=S*U*L-k*B*Q,this._z=S*B*Q-k*U*L,this._w=S*B*L+k*U*Q;break;case"ZXY":this._x=k*B*L-S*U*Q,this._y=S*U*L+k*B*Q,this._z=S*B*Q+k*U*L,this._w=S*B*L-k*U*Q;break;case"ZYX":this._x=k*B*L-S*U*Q,this._y=S*U*L+k*B*Q,this._z=S*B*Q-k*U*L,this._w=S*B*L+k*U*Q;break;case"YZX":this._x=k*B*L+S*U*Q,this._y=S*U*L+k*B*Q,this._z=S*B*Q-k*U*L,this._w=S*B*L-k*U*Q;break;case"XZY":this._x=k*B*L-S*U*Q,this._y=S*U*L-k*B*Q,this._z=S*B*Q+k*U*L,this._w=S*B*L+k*U*Q;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+_)}return l!==!1&&this._onChangeCallback(),this}setFromAxisAngle(i,l){const u=l/2,h=Math.sin(u);return this._x=i.x*h,this._y=i.y*h,this._z=i.z*h,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(i){const l=i.elements,u=l[0],h=l[4],g=l[8],_=l[1],y=l[5],C=l[9],S=l[2],B=l[6],L=l[10],k=u+y+L;if(k>0){const U=.5/Math.sqrt(k+1);this._w=.25/U,this._x=(B-C)*U,this._y=(g-S)*U,this._z=(_-h)*U}else if(u>y&&u>L){const U=2*Math.sqrt(1+u-y-L);this._w=(B-C)/U,this._x=.25*U,this._y=(h+_)/U,this._z=(g+S)/U}else if(y>L){const U=2*Math.sqrt(1+y-u-L);this._w=(g-S)/U,this._x=(h+_)/U,this._y=.25*U,this._z=(C+B)/U}else{const U=2*Math.sqrt(1+L-u-y);this._w=(_-h)/U,this._x=(g+S)/U,this._y=(C+B)/U,this._z=.25*U}return this._onChangeCallback(),this}setFromUnitVectors(i,l){let u=i.dot(l)+1;return u<Number.EPSILON?(u=0,Math.abs(i.x)>Math.abs(i.z)?(this._x=-i.y,this._y=i.x,this._z=0,this._w=u):(this._x=0,this._y=-i.z,this._z=i.y,this._w=u)):(this._x=i.y*l.z-i.z*l.y,this._y=i.z*l.x-i.x*l.z,this._z=i.x*l.y-i.y*l.x,this._w=u),this.normalize()}angleTo(i){return 2*Math.acos(Math.abs(On(this.dot(i),-1,1)))}rotateTowards(i,l){const u=this.angleTo(i);if(u===0)return this;const h=Math.min(1,l/u);return this.slerp(i,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(i){return this._x*i._x+this._y*i._y+this._z*i._z+this._w*i._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let i=this.length();return i===0?(this._x=0,this._y=0,this._z=0,this._w=1):(i=1/i,this._x=this._x*i,this._y=this._y*i,this._z=this._z*i,this._w=this._w*i),this._onChangeCallback(),this}multiply(i){return this.multiplyQuaternions(this,i)}premultiply(i){return this.multiplyQuaternions(i,this)}multiplyQuaternions(i,l){const u=i._x,h=i._y,g=i._z,_=i._w,y=l._x,C=l._y,S=l._z,B=l._w;return this._x=u*B+_*y+h*S-g*C,this._y=h*B+_*C+g*y-u*S,this._z=g*B+_*S+u*C-h*y,this._w=_*B-u*y-h*C-g*S,this._onChangeCallback(),this}slerp(i,l){if(l===0)return this;if(l===1)return this.copy(i);const u=this._x,h=this._y,g=this._z,_=this._w;let y=_*i._w+u*i._x+h*i._y+g*i._z;if(y<0?(this._w=-i._w,this._x=-i._x,this._y=-i._y,this._z=-i._z,y=-y):this.copy(i),y>=1)return this._w=_,this._x=u,this._y=h,this._z=g,this;const C=1-y*y;if(C<=Number.EPSILON){const U=1-l;return this._w=U*_+l*this._w,this._x=U*u+l*this._x,this._y=U*h+l*this._y,this._z=U*g+l*this._z,this.normalize(),this._onChangeCallback(),this}const S=Math.sqrt(C),B=Math.atan2(S,y),L=Math.sin((1-l)*B)/S,k=Math.sin(l*B)/S;return this._w=_*L+this._w*k,this._x=u*L+this._x*k,this._y=h*L+this._y*k,this._z=g*L+this._z*k,this._onChangeCallback(),this}slerpQuaternions(i,l,u){return this.copy(i).slerp(l,u)}random(){const i=Math.random(),l=Math.sqrt(1-i),u=Math.sqrt(i),h=2*Math.PI*Math.random(),g=2*Math.PI*Math.random();return this.set(l*Math.cos(h),u*Math.sin(g),u*Math.cos(g),l*Math.sin(h))}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._w===this._w}fromArray(i,l=0){return this._x=i[l],this._y=i[l+1],this._z=i[l+2],this._w=i[l+3],this._onChangeCallback(),this}toArray(i=[],l=0){return i[l]=this._x,i[l+1]=this._y,i[l+2]=this._z,i[l+3]=this._w,i}fromBufferAttribute(i,l){return this._x=i.getX(l),this._y=i.getY(l),this._z=i.getZ(l),this._w=i.getW(l),this}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class he{constructor(i=0,l=0,u=0){he.prototype.isVector3=!0,this.x=i,this.y=l,this.z=u}set(i,l,u){return u===void 0&&(u=this.z),this.x=i,this.y=l,this.z=u,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this.z=i.z+l.z,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this.z+=i.z*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this.z=i.z-l.z,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this}multiplyVectors(i,l){return this.x=i.x*l.x,this.y=i.y*l.y,this.z=i.z*l.z,this}applyEuler(i){return this.applyQuaternion(To.setFromEuler(i))}applyAxisAngle(i,l){return this.applyQuaternion(To.setFromAxisAngle(i,l))}applyMatrix3(i){const l=this.x,u=this.y,h=this.z,g=i.elements;return this.x=g[0]*l+g[3]*u+g[6]*h,this.y=g[1]*l+g[4]*u+g[7]*h,this.z=g[2]*l+g[5]*u+g[8]*h,this}applyNormalMatrix(i){return this.applyMatrix3(i).normalize()}applyMatrix4(i){const l=this.x,u=this.y,h=this.z,g=i.elements,_=1/(g[3]*l+g[7]*u+g[11]*h+g[15]);return this.x=(g[0]*l+g[4]*u+g[8]*h+g[12])*_,this.y=(g[1]*l+g[5]*u+g[9]*h+g[13])*_,this.z=(g[2]*l+g[6]*u+g[10]*h+g[14])*_,this}applyQuaternion(i){const l=this.x,u=this.y,h=this.z,g=i.x,_=i.y,y=i.z,C=i.w,S=C*l+_*h-y*u,B=C*u+y*l-g*h,L=C*h+g*u-_*l,k=-g*l-_*u-y*h;return this.x=S*C+k*-g+B*-y-L*-_,this.y=B*C+k*-_+L*-g-S*-y,this.z=L*C+k*-y+S*-_-B*-g,this}project(i){return this.applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix)}unproject(i){return this.applyMatrix4(i.projectionMatrixInverse).applyMatrix4(i.matrixWorld)}transformDirection(i){const l=this.x,u=this.y,h=this.z,g=i.elements;return this.x=g[0]*l+g[4]*u+g[8]*h,this.y=g[1]*l+g[5]*u+g[9]*h,this.z=g[2]*l+g[6]*u+g[10]*h,this.normalize()}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this}divideScalar(i){return this.multiplyScalar(1/i)}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this.z=Math.max(i.z,Math.min(l.z,this.z)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this.z=Math.max(i,Math.min(l,this.z)),this}clampLength(i,l){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(i,Math.min(l,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this.z+=(i.z-this.z)*l,this}lerpVectors(i,l,u){return this.x=i.x+(l.x-i.x)*u,this.y=i.y+(l.y-i.y)*u,this.z=i.z+(l.z-i.z)*u,this}cross(i){return this.crossVectors(this,i)}crossVectors(i,l){const u=i.x,h=i.y,g=i.z,_=l.x,y=l.y,C=l.z;return this.x=h*C-g*y,this.y=g*_-u*C,this.z=u*y-h*_,this}projectOnVector(i){const l=i.lengthSq();if(l===0)return this.set(0,0,0);const u=i.dot(this)/l;return this.copy(i).multiplyScalar(u)}projectOnPlane(i){return $a.copy(this).projectOnVector(i),this.sub($a)}reflect(i){return this.sub($a.copy(i).multiplyScalar(2*this.dot(i)))}angleTo(i){const l=Math.sqrt(this.lengthSq()*i.lengthSq());if(l===0)return Math.PI/2;const u=this.dot(i)/l;return Math.acos(On(u,-1,1))}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const l=this.x-i.x,u=this.y-i.y,h=this.z-i.z;return l*l+u*u+h*h}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)+Math.abs(this.z-i.z)}setFromSpherical(i){return this.setFromSphericalCoords(i.radius,i.phi,i.theta)}setFromSphericalCoords(i,l,u){const h=Math.sin(l)*i;return this.x=h*Math.sin(u),this.y=Math.cos(l)*i,this.z=h*Math.cos(u),this}setFromCylindrical(i){return this.setFromCylindricalCoords(i.radius,i.theta,i.y)}setFromCylindricalCoords(i,l,u){return this.x=i*Math.sin(l),this.y=u,this.z=i*Math.cos(l),this}setFromMatrixPosition(i){const l=i.elements;return this.x=l[12],this.y=l[13],this.z=l[14],this}setFromMatrixScale(i){const l=this.setFromMatrixColumn(i,0).length(),u=this.setFromMatrixColumn(i,1).length(),h=this.setFromMatrixColumn(i,2).length();return this.x=l,this.y=u,this.z=h,this}setFromMatrixColumn(i,l){return this.fromArray(i.elements,4*l)}setFromMatrix3Column(i,l){return this.fromArray(i.elements,3*l)}setFromEuler(i){return this.x=i._x,this.y=i._y,this.z=i._z,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this.z=i[l+2],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i[l+2]=this.z,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this.z=i.getZ(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const i=2*(Math.random()-.5),l=Math.random()*Math.PI*2,u=Math.sqrt(1-i**2);return this.x=u*Math.cos(l),this.y=u*Math.sin(l),this.z=i,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $a=new he,To=new ns;class Mc{constructor(i=new he(1/0,1/0,1/0),l=new he(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=i,this.max=l}set(i,l){return this.min.copy(i),this.max.copy(l),this}setFromArray(i){let l=1/0,u=1/0,h=1/0,g=-1/0,_=-1/0,y=-1/0;for(let C=0,S=i.length;C<S;C+=3){const B=i[C],L=i[C+1],k=i[C+2];B<l&&(l=B),L<u&&(u=L),k<h&&(h=k),B>g&&(g=B),L>_&&(_=L),k>y&&(y=k)}return this.min.set(l,u,h),this.max.set(g,_,y),this}setFromBufferAttribute(i){let l=1/0,u=1/0,h=1/0,g=-1/0,_=-1/0,y=-1/0;for(let C=0,S=i.count;C<S;C++){const B=i.getX(C),L=i.getY(C),k=i.getZ(C);B<l&&(l=B),L<u&&(u=L),k<h&&(h=k),B>g&&(g=B),L>_&&(_=L),k>y&&(y=k)}return this.min.set(l,u,h),this.max.set(g,_,y),this}setFromPoints(i){this.makeEmpty();for(let l=0,u=i.length;l<u;l++)this.expandByPoint(i[l]);return this}setFromCenterAndSize(i,l){const u=Tc.copy(l).multiplyScalar(.5);return this.min.copy(i).sub(u),this.max.copy(i).add(u),this}setFromObject(i,l=!1){return this.makeEmpty(),this.expandByObject(i,l)}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(i){return this.isEmpty()?i.set(0,0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}expandByObject(i,l=!1){i.updateWorldMatrix(!1,!1);const u=i.geometry;if(u!==void 0)if(l&&u.attributes!=null&&u.attributes.position!==void 0){const g=u.attributes.position;for(let _=0,y=g.count;_<y;_++)Tc.fromBufferAttribute(g,_).applyMatrix4(i.matrixWorld),this.expandByPoint(Tc)}else u.boundingBox===null&&u.computeBoundingBox(),Sd.copy(u.boundingBox),Sd.applyMatrix4(i.matrixWorld),this.union(Sd);const h=i.children;for(let g=0,_=h.length;g<_;g++)this.expandByObject(h[g],l);return this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y||i.z<this.min.z||i.z>this.max.z)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y&&this.min.z<=i.min.z&&i.max.z<=this.max.z}getParameter(i,l){return l.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y),(i.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y||i.max.z<this.min.z||i.min.z>this.max.z)}intersectsSphere(i){return this.clampPoint(i.center,Tc),Tc.distanceToSquared(i.center)<=i.radius*i.radius}intersectsPlane(i){let l,u;return i.normal.x>0?(l=i.normal.x*this.min.x,u=i.normal.x*this.max.x):(l=i.normal.x*this.max.x,u=i.normal.x*this.min.x),i.normal.y>0?(l+=i.normal.y*this.min.y,u+=i.normal.y*this.max.y):(l+=i.normal.y*this.max.y,u+=i.normal.y*this.min.y),i.normal.z>0?(l+=i.normal.z*this.min.z,u+=i.normal.z*this.max.z):(l+=i.normal.z*this.max.z,u+=i.normal.z*this.min.z),l<=-i.constant&&u>=-i.constant}intersectsTriangle(i){if(this.isEmpty())return!1;this.getCenter(wu),Md.subVectors(this.max,wu),$o.subVectors(i.a,wu),Nl.subVectors(i.b,wu),tl.subVectors(i.c,wu),ea.subVectors(Nl,$o),Ul.subVectors(tl,Nl),Ys.subVectors($o,tl);let l=[0,-ea.z,ea.y,0,-Ul.z,Ul.y,0,-Ys.z,Ys.y,ea.z,0,-ea.x,Ul.z,0,-Ul.x,Ys.z,0,-Ys.x,-ea.y,ea.x,0,-Ul.y,Ul.x,0,-Ys.y,Ys.x,0];return!!Td(l,$o,Nl,tl,Md)&&(l=[1,0,0,0,1,0,0,0,1],!!Td(l,$o,Nl,tl,Md)&&(Ic.crossVectors(ea,Ul),l=[Ic.x,Ic.y,Ic.z],Td(l,$o,Nl,tl,Md)))}clampPoint(i,l){return l.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return Tc.copy(i).clamp(this.min,this.max).sub(i).length()}getBoundingSphere(i){return this.getCenter(i.center),i.radius=.5*this.getSize(Tc).length(),i}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}applyMatrix4(i){return this.isEmpty()||(el[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i),el[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i),el[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i),el[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i),el[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i),el[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i),el[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i),el[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i),this.setFromPoints(el)),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}}const el=[new he,new he,new he,new he,new he,new he,new he,new he],Tc=new he,Sd=new Mc,$o=new he,Nl=new he,tl=new he,ea=new he,Ul=new he,Ys=new he,wu=new he,Md=new he,Ic=new he,Fl=new he;function Td(b,i,l,u,h){for(let g=0,_=b.length-3;g<=_;g+=3){Fl.fromArray(b,g);const y=h.x*Math.abs(Fl.x)+h.y*Math.abs(Fl.y)+h.z*Math.abs(Fl.z),C=i.dot(Fl),S=l.dot(Fl),B=u.dot(Fl);if(Math.max(-Math.max(C,S,B),Math.min(C,S,B))>y)return!1}return!0}const vi=new Mc,Zi=new he,Io=new he,so=new he;class Do{constructor(i=new he,l=-1){this.center=i,this.radius=l}set(i,l){return this.center.copy(i),this.radius=l,this}setFromPoints(i,l){const u=this.center;l!==void 0?u.copy(l):vi.setFromPoints(i).getCenter(u);let h=0;for(let g=0,_=i.length;g<_;g++)h=Math.max(h,u.distanceToSquared(i[g]));return this.radius=Math.sqrt(h),this}copy(i){return this.center.copy(i.center),this.radius=i.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(i){return i.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(i){return i.distanceTo(this.center)-this.radius}intersectsSphere(i){const l=this.radius+i.radius;return i.center.distanceToSquared(this.center)<=l*l}intersectsBox(i){return i.intersectsSphere(this)}intersectsPlane(i){return Math.abs(i.distanceToPoint(this.center))<=this.radius}clampPoint(i,l){const u=this.center.distanceToSquared(i);return l.copy(i),u>this.radius*this.radius&&(l.sub(this.center).normalize(),l.multiplyScalar(this.radius).add(this.center)),l}getBoundingBox(i){return this.isEmpty()?(i.makeEmpty(),i):(i.set(this.center,this.center),i.expandByScalar(this.radius),i)}applyMatrix4(i){return this.center.applyMatrix4(i),this.radius=this.radius*i.getMaxScaleOnAxis(),this}translate(i){return this.center.add(i),this}expandByPoint(i){so.subVectors(i,this.center);const l=so.lengthSq();if(l>this.radius*this.radius){const u=Math.sqrt(l),h=.5*(u-this.radius);this.center.add(so.multiplyScalar(h/u)),this.radius+=h}return this}union(i){return this.center.equals(i.center)===!0?Io.set(0,0,1).multiplyScalar(i.radius):Io.subVectors(i.center,this.center).normalize().multiplyScalar(i.radius),this.expandByPoint(Zi.copy(i.center).add(Io)),this.expandByPoint(Zi.copy(i.center).sub(Io)),this}equals(i){return i.center.equals(this.center)&&i.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Or=new he,Id=new he,xu=new he,xa=new he,Eu=new he,Sh=new he,Dd=new he;class jl{constructor(i=new he,l=new he(0,0,-1)){this.origin=i,this.direction=l}set(i,l){return this.origin.copy(i),this.direction.copy(l),this}copy(i){return this.origin.copy(i.origin),this.direction.copy(i.direction),this}at(i,l){return l.copy(this.direction).multiplyScalar(i).add(this.origin)}lookAt(i){return this.direction.copy(i).sub(this.origin).normalize(),this}recast(i){return this.origin.copy(this.at(i,Or)),this}closestPointToPoint(i,l){l.subVectors(i,this.origin);const u=l.dot(this.direction);return u<0?l.copy(this.origin):l.copy(this.direction).multiplyScalar(u).add(this.origin)}distanceToPoint(i){return Math.sqrt(this.distanceSqToPoint(i))}distanceSqToPoint(i){const l=Or.subVectors(i,this.origin).dot(this.direction);return l<0?this.origin.distanceToSquared(i):(Or.copy(this.direction).multiplyScalar(l).add(this.origin),Or.distanceToSquared(i))}distanceSqToSegment(i,l,u,h){Id.copy(i).add(l).multiplyScalar(.5),xu.copy(l).sub(i).normalize(),xa.copy(this.origin).sub(Id);const g=.5*i.distanceTo(l),_=-this.direction.dot(xu),y=xa.dot(this.direction),C=-xa.dot(xu),S=xa.lengthSq(),B=Math.abs(1-_*_);let L,k,U,Q;if(B>0)if(L=_*C-y,k=_*y-C,Q=g*B,L>=0)if(k>=-Q)if(k<=Q){const F=1/B;L*=F,k*=F,U=L*(L+_*k+2*y)+k*(_*L+k+2*C)+S}else k=g,L=Math.max(0,-(_*k+y)),U=-L*L+k*(k+2*C)+S;else k=-g,L=Math.max(0,-(_*k+y)),U=-L*L+k*(k+2*C)+S;else k<=-Q?(L=Math.max(0,-(-_*g+y)),k=L>0?-g:Math.min(Math.max(-g,-C),g),U=-L*L+k*(k+2*C)+S):k<=Q?(L=0,k=Math.min(Math.max(-g,-C),g),U=k*(k+2*C)+S):(L=Math.max(0,-(_*g+y)),k=L>0?g:Math.min(Math.max(-g,-C),g),U=-L*L+k*(k+2*C)+S);else k=_>0?-g:g,L=Math.max(0,-(_*k+y)),U=-L*L+k*(k+2*C)+S;return u&&u.copy(this.direction).multiplyScalar(L).add(this.origin),h&&h.copy(xu).multiplyScalar(k).add(Id),U}intersectSphere(i,l){Or.subVectors(i.center,this.origin);const u=Or.dot(this.direction),h=Or.dot(Or)-u*u,g=i.radius*i.radius;if(h>g)return null;const _=Math.sqrt(g-h),y=u-_,C=u+_;return y<0&&C<0?null:y<0?this.at(C,l):this.at(y,l)}intersectsSphere(i){return this.distanceSqToPoint(i.center)<=i.radius*i.radius}distanceToPlane(i){const l=i.normal.dot(this.direction);if(l===0)return i.distanceToPoint(this.origin)===0?0:null;const u=-(this.origin.dot(i.normal)+i.constant)/l;return u>=0?u:null}intersectPlane(i,l){const u=this.distanceToPlane(i);return u===null?null:this.at(u,l)}intersectsPlane(i){const l=i.distanceToPoint(this.origin);return l===0||i.normal.dot(this.direction)*l<0}intersectBox(i,l){let u,h,g,_,y,C;const S=1/this.direction.x,B=1/this.direction.y,L=1/this.direction.z,k=this.origin;return S>=0?(u=(i.min.x-k.x)*S,h=(i.max.x-k.x)*S):(u=(i.max.x-k.x)*S,h=(i.min.x-k.x)*S),B>=0?(g=(i.min.y-k.y)*B,_=(i.max.y-k.y)*B):(g=(i.max.y-k.y)*B,_=(i.min.y-k.y)*B),u>_||g>h?null:((g>u||u!=u)&&(u=g),(_<h||h!=h)&&(h=_),L>=0?(y=(i.min.z-k.z)*L,C=(i.max.z-k.z)*L):(y=(i.max.z-k.z)*L,C=(i.min.z-k.z)*L),u>C||y>h?null:((y>u||u!=u)&&(u=y),(C<h||h!=h)&&(h=C),h<0?null:this.at(u>=0?u:h,l)))}intersectsBox(i){return this.intersectBox(i,Or)!==null}intersectTriangle(i,l,u,h,g){Eu.subVectors(l,i),Sh.subVectors(u,i),Dd.crossVectors(Eu,Sh);let _,y=this.direction.dot(Dd);if(y>0){if(h)return null;_=1}else{if(!(y<0))return null;_=-1,y=-y}xa.subVectors(this.origin,i);const C=_*this.direction.dot(Sh.crossVectors(xa,Sh));if(C<0)return null;const S=_*this.direction.dot(Eu.cross(xa));if(S<0||C+S>y)return null;const B=-_*xa.dot(Dd);return B<0?null:this.at(B/y,g)}applyMatrix4(i){return this.origin.applyMatrix4(i),this.direction.transformDirection(i),this}equals(i){return i.origin.equals(this.origin)&&i.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Gn{constructor(){Gn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(i,l,u,h,g,_,y,C,S,B,L,k,U,Q,F,H){const W=this.elements;return W[0]=i,W[4]=l,W[8]=u,W[12]=h,W[1]=g,W[5]=_,W[9]=y,W[13]=C,W[2]=S,W[6]=B,W[10]=L,W[14]=k,W[3]=U,W[7]=Q,W[11]=F,W[15]=H,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Gn().fromArray(this.elements)}copy(i){const l=this.elements,u=i.elements;return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],this}copyPosition(i){const l=this.elements,u=i.elements;return l[12]=u[12],l[13]=u[13],l[14]=u[14],this}setFromMatrix3(i){const l=i.elements;return this.set(l[0],l[3],l[6],0,l[1],l[4],l[7],0,l[2],l[5],l[8],0,0,0,0,1),this}extractBasis(i,l,u){return i.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),u.setFromMatrixColumn(this,2),this}makeBasis(i,l,u){return this.set(i.x,l.x,u.x,0,i.y,l.y,u.y,0,i.z,l.z,u.z,0,0,0,0,1),this}extractRotation(i){const l=this.elements,u=i.elements,h=1/Ni.setFromMatrixColumn(i,0).length(),g=1/Ni.setFromMatrixColumn(i,1).length(),_=1/Ni.setFromMatrixColumn(i,2).length();return l[0]=u[0]*h,l[1]=u[1]*h,l[2]=u[2]*h,l[3]=0,l[4]=u[4]*g,l[5]=u[5]*g,l[6]=u[6]*g,l[7]=0,l[8]=u[8]*_,l[9]=u[9]*_,l[10]=u[10]*_,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromEuler(i){const l=this.elements,u=i.x,h=i.y,g=i.z,_=Math.cos(u),y=Math.sin(u),C=Math.cos(h),S=Math.sin(h),B=Math.cos(g),L=Math.sin(g);if(i.order==="XYZ"){const k=_*B,U=_*L,Q=y*B,F=y*L;l[0]=C*B,l[4]=-C*L,l[8]=S,l[1]=U+Q*S,l[5]=k-F*S,l[9]=-y*C,l[2]=F-k*S,l[6]=Q+U*S,l[10]=_*C}else if(i.order==="YXZ"){const k=C*B,U=C*L,Q=S*B,F=S*L;l[0]=k+F*y,l[4]=Q*y-U,l[8]=_*S,l[1]=_*L,l[5]=_*B,l[9]=-y,l[2]=U*y-Q,l[6]=F+k*y,l[10]=_*C}else if(i.order==="ZXY"){const k=C*B,U=C*L,Q=S*B,F=S*L;l[0]=k-F*y,l[4]=-_*L,l[8]=Q+U*y,l[1]=U+Q*y,l[5]=_*B,l[9]=F-k*y,l[2]=-_*S,l[6]=y,l[10]=_*C}else if(i.order==="ZYX"){const k=_*B,U=_*L,Q=y*B,F=y*L;l[0]=C*B,l[4]=Q*S-U,l[8]=k*S+F,l[1]=C*L,l[5]=F*S+k,l[9]=U*S-Q,l[2]=-S,l[6]=y*C,l[10]=_*C}else if(i.order==="YZX"){const k=_*C,U=_*S,Q=y*C,F=y*S;l[0]=C*B,l[4]=F-k*L,l[8]=Q*L+U,l[1]=L,l[5]=_*B,l[9]=-y*B,l[2]=-S*B,l[6]=U*L+Q,l[10]=k-F*L}else if(i.order==="XZY"){const k=_*C,U=_*S,Q=y*C,F=y*S;l[0]=C*B,l[4]=-L,l[8]=S*B,l[1]=k*L+F,l[5]=_*B,l[9]=U*L-Q,l[2]=Q*L-U,l[6]=y*B,l[10]=F*L+k}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromQuaternion(i){return this.compose(Po,i,nl)}lookAt(i,l,u){const h=this.elements;return Xs.subVectors(i,l),Xs.lengthSq()===0&&(Xs.z=1),Xs.normalize(),Hr.crossVectors(u,Xs),Hr.lengthSq()===0&&(Math.abs(u.z)===1?Xs.x+=1e-4:Xs.z+=1e-4,Xs.normalize(),Hr.crossVectors(u,Xs)),Hr.normalize(),Cu.crossVectors(Xs,Hr),h[0]=Hr.x,h[4]=Cu.x,h[8]=Xs.x,h[1]=Hr.y,h[5]=Cu.y,h[9]=Xs.y,h[2]=Hr.z,h[6]=Cu.z,h[10]=Xs.z,this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,l){const u=i.elements,h=l.elements,g=this.elements,_=u[0],y=u[4],C=u[8],S=u[12],B=u[1],L=u[5],k=u[9],U=u[13],Q=u[2],F=u[6],H=u[10],W=u[14],q=u[3],$=u[7],ie=u[11],se=u[15],le=h[0],Ie=h[4],De=h[8],Xe=h[12],Ke=h[1],Be=h[5],St=h[9],Ft=h[13],Et=h[2],nn=h[6],rn=h[10],dt=h[14],At=h[3],Wt=h[7],Mt=h[11],en=h[15];return g[0]=_*le+y*Ke+C*Et+S*At,g[4]=_*Ie+y*Be+C*nn+S*Wt,g[8]=_*De+y*St+C*rn+S*Mt,g[12]=_*Xe+y*Ft+C*dt+S*en,g[1]=B*le+L*Ke+k*Et+U*At,g[5]=B*Ie+L*Be+k*nn+U*Wt,g[9]=B*De+L*St+k*rn+U*Mt,g[13]=B*Xe+L*Ft+k*dt+U*en,g[2]=Q*le+F*Ke+H*Et+W*At,g[6]=Q*Ie+F*Be+H*nn+W*Wt,g[10]=Q*De+F*St+H*rn+W*Mt,g[14]=Q*Xe+F*Ft+H*dt+W*en,g[3]=q*le+$*Ke+ie*Et+se*At,g[7]=q*Ie+$*Be+ie*nn+se*Wt,g[11]=q*De+$*St+ie*rn+se*Mt,g[15]=q*Xe+$*Ft+ie*dt+se*en,this}multiplyScalar(i){const l=this.elements;return l[0]*=i,l[4]*=i,l[8]*=i,l[12]*=i,l[1]*=i,l[5]*=i,l[9]*=i,l[13]*=i,l[2]*=i,l[6]*=i,l[10]*=i,l[14]*=i,l[3]*=i,l[7]*=i,l[11]*=i,l[15]*=i,this}determinant(){const i=this.elements,l=i[0],u=i[4],h=i[8],g=i[12],_=i[1],y=i[5],C=i[9],S=i[13],B=i[2],L=i[6],k=i[10],U=i[14];return i[3]*(+g*C*L-h*S*L-g*y*k+u*S*k+h*y*U-u*C*U)+i[7]*(+l*C*U-l*S*k+g*_*k-h*_*U+h*S*B-g*C*B)+i[11]*(+l*S*L-l*y*U-g*_*L+u*_*U+g*y*B-u*S*B)+i[15]*(-h*y*B-l*C*L+l*y*k+h*_*L-u*_*k+u*C*B)}transpose(){const i=this.elements;let l;return l=i[1],i[1]=i[4],i[4]=l,l=i[2],i[2]=i[8],i[8]=l,l=i[6],i[6]=i[9],i[9]=l,l=i[3],i[3]=i[12],i[12]=l,l=i[7],i[7]=i[13],i[13]=l,l=i[11],i[11]=i[14],i[14]=l,this}setPosition(i,l,u){const h=this.elements;return i.isVector3?(h[12]=i.x,h[13]=i.y,h[14]=i.z):(h[12]=i,h[13]=l,h[14]=u),this}invert(){const i=this.elements,l=i[0],u=i[1],h=i[2],g=i[3],_=i[4],y=i[5],C=i[6],S=i[7],B=i[8],L=i[9],k=i[10],U=i[11],Q=i[12],F=i[13],H=i[14],W=i[15],q=L*H*S-F*k*S+F*C*U-y*H*U-L*C*W+y*k*W,$=Q*k*S-B*H*S-Q*C*U+_*H*U+B*C*W-_*k*W,ie=B*F*S-Q*L*S+Q*y*U-_*F*U-B*y*W+_*L*W,se=Q*L*C-B*F*C-Q*y*k+_*F*k+B*y*H-_*L*H,le=l*q+u*$+h*ie+g*se;if(le===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ie=1/le;return i[0]=q*Ie,i[1]=(F*k*g-L*H*g-F*h*U+u*H*U+L*h*W-u*k*W)*Ie,i[2]=(y*H*g-F*C*g+F*h*S-u*H*S-y*h*W+u*C*W)*Ie,i[3]=(L*C*g-y*k*g-L*h*S+u*k*S+y*h*U-u*C*U)*Ie,i[4]=$*Ie,i[5]=(B*H*g-Q*k*g+Q*h*U-l*H*U-B*h*W+l*k*W)*Ie,i[6]=(Q*C*g-_*H*g-Q*h*S+l*H*S+_*h*W-l*C*W)*Ie,i[7]=(_*k*g-B*C*g+B*h*S-l*k*S-_*h*U+l*C*U)*Ie,i[8]=ie*Ie,i[9]=(Q*L*g-B*F*g-Q*u*U+l*F*U+B*u*W-l*L*W)*Ie,i[10]=(_*F*g-Q*y*g+Q*u*S-l*F*S-_*u*W+l*y*W)*Ie,i[11]=(B*y*g-_*L*g-B*u*S+l*L*S+_*u*U-l*y*U)*Ie,i[12]=se*Ie,i[13]=(B*F*h-Q*L*h+Q*u*k-l*F*k-B*u*H+l*L*H)*Ie,i[14]=(Q*y*h-_*F*h-Q*u*C+l*F*C+_*u*H-l*y*H)*Ie,i[15]=(_*L*h-B*y*h+B*u*C-l*L*C-_*u*k+l*y*k)*Ie,this}scale(i){const l=this.elements,u=i.x,h=i.y,g=i.z;return l[0]*=u,l[4]*=h,l[8]*=g,l[1]*=u,l[5]*=h,l[9]*=g,l[2]*=u,l[6]*=h,l[10]*=g,l[3]*=u,l[7]*=h,l[11]*=g,this}getMaxScaleOnAxis(){const i=this.elements,l=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],u=i[4]*i[4]+i[5]*i[5]+i[6]*i[6],h=i[8]*i[8]+i[9]*i[9]+i[10]*i[10];return Math.sqrt(Math.max(l,u,h))}makeTranslation(i,l,u){return this.set(1,0,0,i,0,1,0,l,0,0,1,u,0,0,0,1),this}makeRotationX(i){const l=Math.cos(i),u=Math.sin(i);return this.set(1,0,0,0,0,l,-u,0,0,u,l,0,0,0,0,1),this}makeRotationY(i){const l=Math.cos(i),u=Math.sin(i);return this.set(l,0,u,0,0,1,0,0,-u,0,l,0,0,0,0,1),this}makeRotationZ(i){const l=Math.cos(i),u=Math.sin(i);return this.set(l,-u,0,0,u,l,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(i,l){const u=Math.cos(l),h=Math.sin(l),g=1-u,_=i.x,y=i.y,C=i.z,S=g*_,B=g*y;return this.set(S*_+u,S*y-h*C,S*C+h*y,0,S*y+h*C,B*y+u,B*C-h*_,0,S*C-h*y,B*C+h*_,g*C*C+u,0,0,0,0,1),this}makeScale(i,l,u){return this.set(i,0,0,0,0,l,0,0,0,0,u,0,0,0,0,1),this}makeShear(i,l,u,h,g,_){return this.set(1,u,g,0,i,1,_,0,l,h,1,0,0,0,0,1),this}compose(i,l,u){const h=this.elements,g=l._x,_=l._y,y=l._z,C=l._w,S=g+g,B=_+_,L=y+y,k=g*S,U=g*B,Q=g*L,F=_*B,H=_*L,W=y*L,q=C*S,$=C*B,ie=C*L,se=u.x,le=u.y,Ie=u.z;return h[0]=(1-(F+W))*se,h[1]=(U+ie)*se,h[2]=(Q-$)*se,h[3]=0,h[4]=(U-ie)*le,h[5]=(1-(k+W))*le,h[6]=(H+q)*le,h[7]=0,h[8]=(Q+$)*Ie,h[9]=(H-q)*Ie,h[10]=(1-(k+F))*Ie,h[11]=0,h[12]=i.x,h[13]=i.y,h[14]=i.z,h[15]=1,this}decompose(i,l,u){const h=this.elements;let g=Ni.set(h[0],h[1],h[2]).length();const _=Ni.set(h[4],h[5],h[6]).length(),y=Ni.set(h[8],h[9],h[10]).length();this.determinant()<0&&(g=-g),i.x=h[12],i.y=h[13],i.z=h[14],Gr.copy(this);const C=1/g,S=1/_,B=1/y;return Gr.elements[0]*=C,Gr.elements[1]*=C,Gr.elements[2]*=C,Gr.elements[4]*=S,Gr.elements[5]*=S,Gr.elements[6]*=S,Gr.elements[8]*=B,Gr.elements[9]*=B,Gr.elements[10]*=B,l.setFromRotationMatrix(Gr),u.x=g,u.y=_,u.z=y,this}makePerspective(i,l,u,h,g,_){const y=this.elements,C=2*g/(l-i),S=2*g/(u-h),B=(l+i)/(l-i),L=(u+h)/(u-h),k=-(_+g)/(_-g),U=-2*_*g/(_-g);return y[0]=C,y[4]=0,y[8]=B,y[12]=0,y[1]=0,y[5]=S,y[9]=L,y[13]=0,y[2]=0,y[6]=0,y[10]=k,y[14]=U,y[3]=0,y[7]=0,y[11]=-1,y[15]=0,this}makeOrthographic(i,l,u,h,g,_){const y=this.elements,C=1/(l-i),S=1/(u-h),B=1/(_-g),L=(l+i)*C,k=(u+h)*S,U=(_+g)*B;return y[0]=2*C,y[4]=0,y[8]=0,y[12]=-L,y[1]=0,y[5]=2*S,y[9]=0,y[13]=-k,y[2]=0,y[6]=0,y[10]=-2*B,y[14]=-U,y[3]=0,y[7]=0,y[11]=0,y[15]=1,this}equals(i){const l=this.elements,u=i.elements;for(let h=0;h<16;h++)if(l[h]!==u[h])return!1;return!0}fromArray(i,l=0){for(let u=0;u<16;u++)this.elements[u]=i[u+l];return this}toArray(i=[],l=0){const u=this.elements;return i[l]=u[0],i[l+1]=u[1],i[l+2]=u[2],i[l+3]=u[3],i[l+4]=u[4],i[l+5]=u[5],i[l+6]=u[6],i[l+7]=u[7],i[l+8]=u[8],i[l+9]=u[9],i[l+10]=u[10],i[l+11]=u[11],i[l+12]=u[12],i[l+13]=u[13],i[l+14]=u[14],i[l+15]=u[15],i}}const Ni=new he,Gr=new Gn,Po=new he(0,0,0),nl=new he(1,1,1),Hr=new he,Cu=new he,Xs=new he,Np=new Gn,Mh=new ns;class ta{constructor(i=0,l=0,u=0,h=ta.DefaultOrder){this.isEuler=!0,this._x=i,this._y=l,this._z=u,this._order=h}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get order(){return this._order}set order(i){this._order=i,this._onChangeCallback()}set(i,l,u,h=this._order){return this._x=i,this._y=l,this._z=u,this._order=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(i){return this._x=i._x,this._y=i._y,this._z=i._z,this._order=i._order,this._onChangeCallback(),this}setFromRotationMatrix(i,l=this._order,u=!0){const h=i.elements,g=h[0],_=h[4],y=h[8],C=h[1],S=h[5],B=h[9],L=h[2],k=h[6],U=h[10];switch(l){case"XYZ":this._y=Math.asin(On(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(-B,U),this._z=Math.atan2(-_,g)):(this._x=Math.atan2(k,S),this._z=0);break;case"YXZ":this._x=Math.asin(-On(B,-1,1)),Math.abs(B)<.9999999?(this._y=Math.atan2(y,U),this._z=Math.atan2(C,S)):(this._y=Math.atan2(-L,g),this._z=0);break;case"ZXY":this._x=Math.asin(On(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-L,U),this._z=Math.atan2(-_,S)):(this._y=0,this._z=Math.atan2(C,g));break;case"ZYX":this._y=Math.asin(-On(L,-1,1)),Math.abs(L)<.9999999?(this._x=Math.atan2(k,U),this._z=Math.atan2(C,g)):(this._x=0,this._z=Math.atan2(-_,S));break;case"YZX":this._z=Math.asin(On(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(-B,S),this._y=Math.atan2(-L,g)):(this._x=0,this._y=Math.atan2(y,U));break;case"XZY":this._z=Math.asin(-On(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(k,S),this._y=Math.atan2(y,g)):(this._x=Math.atan2(-B,U),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+l)}return this._order=l,u===!0&&this._onChangeCallback(),this}setFromQuaternion(i,l,u){return Np.makeRotationFromQuaternion(i),this.setFromRotationMatrix(Np,l,u)}setFromVector3(i,l=this._order){return this.set(i.x,i.y,i.z,l)}reorder(i){return Mh.setFromEuler(this),this.setFromQuaternion(Mh,i)}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._order===this._order}fromArray(i){return this._x=i[0],this._y=i[1],this._z=i[2],i[3]!==void 0&&(this._order=i[3]),this._onChangeCallback(),this}toArray(i=[],l=0){return i[l]=this._x,i[l+1]=this._y,i[l+2]=this._z,i[l+3]=this._order,i}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}ta.DefaultOrder="XYZ",ta.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ps{constructor(){this.mask=1}set(i){this.mask=(1<<i|0)>>>0}enable(i){this.mask|=1<<i|0}enableAll(){this.mask=-1}toggle(i){this.mask^=1<<i|0}disable(i){this.mask&=~(1<<i|0)}disableAll(){this.mask=0}test(i){return(this.mask&i.mask)!=0}isEnabled(i){return(this.mask&(1<<i|0))!=0}}let il=0;const Dc=new he,is=new ns,oo=new Gn,ys=new he,Ea=new he,Pd=new he,zl=new ns,Th=new he(1,0,0),Pc=new he(0,1,0),Ql=new he(0,0,1),Rd={type:"added"},Up={type:"removed"};class ei extends Vn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:il++}),this.uuid=_s(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ei.DefaultUp.clone();const i=new he,l=new ta,u=new ns,h=new he(1,1,1);l._onChange(function(){u.setFromEuler(l,!1)}),u._onChange(function(){l.setFromQuaternion(u,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:l},quaternion:{configurable:!0,enumerable:!0,value:u},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new Gn},normalMatrix:{value:new ts}}),this.matrix=new Gn,this.matrixWorld=new Gn,this.matrixAutoUpdate=ei.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ei.DefaultMatrixWorldAutoUpdate,this.layers=new Ps,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(i,l,u,h,g,_){this.dispatchEvent({type:"beforeRender",renderer:i,scene:l,camera:u,geometry:h,material:g,group:_})}onAfterRender(){}applyMatrix4(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(i){return this.quaternion.premultiply(i),this}setRotationFromAxisAngle(i,l){this.quaternion.setFromAxisAngle(i,l)}setRotationFromEuler(i){this.quaternion.setFromEuler(i,!0)}setRotationFromMatrix(i){this.quaternion.setFromRotationMatrix(i)}setRotationFromQuaternion(i){this.quaternion.copy(i)}rotateOnAxis(i,l){return is.setFromAxisAngle(i,l),this.quaternion.multiply(is),this}rotateOnWorldAxis(i,l){return is.setFromAxisAngle(i,l),this.quaternion.premultiply(is),this}rotateX(i){return this.rotateOnAxis(Th,i)}rotateY(i){return this.rotateOnAxis(Pc,i)}rotateZ(i){return this.rotateOnAxis(Ql,i)}translateOnAxis(i,l){return Dc.copy(i).applyQuaternion(this.quaternion),this.position.add(Dc.multiplyScalar(l)),this}translateX(i){return this.translateOnAxis(Th,i)}translateY(i){return this.translateOnAxis(Pc,i)}translateZ(i){return this.translateOnAxis(Ql,i)}localToWorld(i){return i.applyMatrix4(this.matrixWorld)}worldToLocal(i){return i.applyMatrix4(oo.copy(this.matrixWorld).invert())}lookAt(i,l,u){i.isVector3?ys.copy(i):ys.set(i,l,u);const h=this.parent;this.updateWorldMatrix(!0,!1),Ea.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oo.lookAt(Ea,ys,this.up):oo.lookAt(ys,Ea,this.up),this.quaternion.setFromRotationMatrix(oo),h&&(oo.extractRotation(h.matrixWorld),is.setFromRotationMatrix(oo),this.quaternion.premultiply(is.invert()))}add(i){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Rd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)}remove(i){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.remove(arguments[u]);return this}const l=this.children.indexOf(i);return l!==-1&&(i.parent=null,this.children.splice(l,1),i.dispatchEvent(Up)),this}removeFromParent(){const i=this.parent;return i!==null&&i.remove(this),this}clear(){for(let i=0;i<this.children.length;i++){const l=this.children[i];l.parent=null,l.dispatchEvent(Up)}return this.children.length=0,this}attach(i){return this.updateWorldMatrix(!0,!1),oo.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),oo.multiply(i.parent.matrixWorld)),i.applyMatrix4(oo),this.add(i),i.updateWorldMatrix(!1,!0),this}getObjectById(i){return this.getObjectByProperty("id",i)}getObjectByName(i){return this.getObjectByProperty("name",i)}getObjectByProperty(i,l){if(this[i]===l)return this;for(let u=0,h=this.children.length;u<h;u++){const g=this.children[u].getObjectByProperty(i,l);if(g!==void 0)return g}}getWorldPosition(i){return this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ea,i,Pd),i}getWorldScale(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ea,zl,i),i}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return i.set(l[8],l[9],l[10]).normalize()}raycast(){}traverse(i){i(this);const l=this.children;for(let u=0,h=l.length;u<h;u++)l[u].traverse(i)}traverseVisible(i){if(this.visible===!1)return;i(this);const l=this.children;for(let u=0,h=l.length;u<h;u++)l[u].traverseVisible(i)}traverseAncestors(i){const l=this.parent;l!==null&&(i(l),l.traverseAncestors(i))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const l=this.children;for(let u=0,h=l.length;u<h;u++){const g=l[u];g.matrixWorldAutoUpdate!==!0&&i!==!0||g.updateMatrixWorld(i)}}updateWorldMatrix(i,l){const u=this.parent;if(i===!0&&u!==null&&u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),l===!0){const h=this.children;for(let g=0,_=h.length;g<_;g++){const y=h[g];y.matrixWorldAutoUpdate===!0&&y.updateWorldMatrix(!1,!0)}}}toJSON(i){const l=i===void 0||typeof i=="string",u={};l&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},u.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const h={};function g(y,C){return y[C.uuid]===void 0&&(y[C.uuid]=C.toJSON(i)),C.uuid}if(h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.castShadow===!0&&(h.castShadow=!0),this.receiveShadow===!0&&(h.receiveShadow=!0),this.visible===!1&&(h.visible=!1),this.frustumCulled===!1&&(h.frustumCulled=!1),this.renderOrder!==0&&(h.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(h.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?h.background=this.background.toJSON():this.background.isTexture&&(h.background=this.background.toJSON(i).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(h.environment=this.environment.toJSON(i).uuid);else if(this.isMesh||this.isLine||this.isPoints){h.geometry=g(i.geometries,this.geometry);const y=this.geometry.parameters;if(y!==void 0&&y.shapes!==void 0){const C=y.shapes;if(Array.isArray(C))for(let S=0,B=C.length;S<B;S++){const L=C[S];g(i.shapes,L)}else g(i.shapes,C)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(g(i.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const y=[];for(let C=0,S=this.material.length;C<S;C++)y.push(g(i.materials,this.material[C]));h.material=y}else h.material=g(i.materials,this.material);if(this.children.length>0){h.children=[];for(let y=0;y<this.children.length;y++)h.children.push(this.children[y].toJSON(i).object)}if(this.animations.length>0){h.animations=[];for(let y=0;y<this.animations.length;y++){const C=this.animations[y];h.animations.push(g(i.animations,C))}}if(l){const y=_(i.geometries),C=_(i.materials),S=_(i.textures),B=_(i.images),L=_(i.shapes),k=_(i.skeletons),U=_(i.animations),Q=_(i.nodes);y.length>0&&(u.geometries=y),C.length>0&&(u.materials=C),S.length>0&&(u.textures=S),B.length>0&&(u.images=B),L.length>0&&(u.shapes=L),k.length>0&&(u.skeletons=k),U.length>0&&(u.animations=U),Q.length>0&&(u.nodes=Q)}return u.object=h,u;function _(y){const C=[];for(const S in y){const B=y[S];delete B.metadata,C.push(B)}return C}}clone(i){return new this.constructor().copy(this,i)}copy(i,l=!0){this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=i.matrixWorldAutoUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData={};for(const[u,h]of Object.entries(i.userData))this.userData[u]=!h||h&&(h.isTexture||h.isObject3D)?h:JSON.parse(JSON.stringify(h));if(l===!0)for(let u=0;u<i.children.length;u++){const h=i.children[u];this.add(h.clone())}return this}}ei.DefaultUp=new he(0,1,0),ei.DefaultMatrixAutoUpdate=!0,ei.DefaultMatrixWorldAutoUpdate=!0;const Ro=new he,Ca=new he,Rs=new he,na=new he,Bo=new he,ko=new he,Bd=new he,Su=new he,kd=new he,Vl=new he;class rs{constructor(i=new he,l=new he,u=new he){this.a=i,this.b=l,this.c=u}static getNormal(i,l,u,h){h.subVectors(u,l),Ro.subVectors(i,l),h.cross(Ro);const g=h.lengthSq();return g>0?h.multiplyScalar(1/Math.sqrt(g)):h.set(0,0,0)}static getBarycoord(i,l,u,h,g){Ro.subVectors(h,l),Ca.subVectors(u,l),Rs.subVectors(i,l);const _=Ro.dot(Ro),y=Ro.dot(Ca),C=Ro.dot(Rs),S=Ca.dot(Ca),B=Ca.dot(Rs),L=_*S-y*y;if(L===0)return g.set(-2,-1,-1);const k=1/L,U=(S*C-y*B)*k,Q=(_*B-y*C)*k;return g.set(1-U-Q,Q,U)}static containsPoint(i,l,u,h){return this.getBarycoord(i,l,u,h,na),na.x>=0&&na.y>=0&&na.x+na.y<=1}static getUV(i,l,u,h,g,_,y,C){return this.getBarycoord(i,l,u,h,na),C.set(0,0),C.addScaledVector(g,na.x),C.addScaledVector(_,na.y),C.addScaledVector(y,na.z),C}static isFrontFacing(i,l,u,h){return Ro.subVectors(u,l),Ca.subVectors(i,l),Ro.cross(Ca).dot(h)<0}set(i,l,u){return this.a.copy(i),this.b.copy(l),this.c.copy(u),this}setFromPointsAndIndices(i,l,u,h){return this.a.copy(i[l]),this.b.copy(i[u]),this.c.copy(i[h]),this}setFromAttributeAndIndices(i,l,u,h){return this.a.fromBufferAttribute(i,l),this.b.fromBufferAttribute(i,u),this.c.fromBufferAttribute(i,h),this}clone(){return new this.constructor().copy(this)}copy(i){return this.a.copy(i.a),this.b.copy(i.b),this.c.copy(i.c),this}getArea(){return Ro.subVectors(this.c,this.b),Ca.subVectors(this.a,this.b),.5*Ro.cross(Ca).length()}getMidpoint(i){return i.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)}getNormal(i){return rs.getNormal(this.a,this.b,this.c,i)}getPlane(i){return i.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(i,l){return rs.getBarycoord(i,this.a,this.b,this.c,l)}getUV(i,l,u,h,g){return rs.getUV(i,this.a,this.b,this.c,l,u,h,g)}containsPoint(i){return rs.containsPoint(i,this.a,this.b,this.c)}isFrontFacing(i){return rs.isFrontFacing(this.a,this.b,this.c,i)}intersectsBox(i){return i.intersectsTriangle(this)}closestPointToPoint(i,l){const u=this.a,h=this.b,g=this.c;let _,y;Bo.subVectors(h,u),ko.subVectors(g,u),Su.subVectors(i,u);const C=Bo.dot(Su),S=ko.dot(Su);if(C<=0&&S<=0)return l.copy(u);kd.subVectors(i,h);const B=Bo.dot(kd),L=ko.dot(kd);if(B>=0&&L<=B)return l.copy(h);const k=C*L-B*S;if(k<=0&&C>=0&&B<=0)return _=C/(C-B),l.copy(u).addScaledVector(Bo,_);Vl.subVectors(i,g);const U=Bo.dot(Vl),Q=ko.dot(Vl);if(Q>=0&&U<=Q)return l.copy(g);const F=U*S-C*Q;if(F<=0&&S>=0&&Q<=0)return y=S/(S-Q),l.copy(u).addScaledVector(ko,y);const H=B*Q-U*L;if(H<=0&&L-B>=0&&U-Q>=0)return Bd.subVectors(g,h),y=(L-B)/(L-B+(U-Q)),l.copy(h).addScaledVector(Bd,y);const W=1/(H+F+k);return _=F*W,y=k*W,l.copy(u).addScaledVector(Bo,_).addScaledVector(ko,y)}equals(i){return i.a.equals(this.a)&&i.b.equals(this.b)&&i.c.equals(this.c)}}let Tm=0;class ss extends Vn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Tm++}),this.uuid=_s(),this.name="",this.type="Material",this.blending=Ae,this.side=je,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Bt,this.blendDst=on,this.blendEquation=K,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ae,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ba,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ri,this.stencilZFail=Ri,this.stencilZPass=Ri,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(i){this._alphaTest>0!=i>0&&this.version++,this._alphaTest=i}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(i){if(i!==void 0)for(const l in i){const u=i[l];if(u===void 0){console.warn("THREE.Material: '"+l+"' parameter is undefined.");continue}const h=this[l];h!==void 0&&(h&&h.isColor?h.set(u):h&&h.isVector3&&u&&u.isVector3?h.copy(u):this[l]=u)}}toJSON(i){const l=i===void 0||typeof i=="string";l&&(i={textures:{},images:{}});const u={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function h(g){const _=[];for(const y in g){const C=g[y];delete C.metadata,_.push(C)}return _}if(u.uuid=this.uuid,u.type=this.type,this.name!==""&&(u.name=this.name),this.color&&this.color.isColor&&(u.color=this.color.getHex()),this.roughness!==void 0&&(u.roughness=this.roughness),this.metalness!==void 0&&(u.metalness=this.metalness),this.sheen!==void 0&&(u.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(u.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(u.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(u.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(u.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(u.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(u.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(u.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(u.shininess=this.shininess),this.clearcoat!==void 0&&(u.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(u.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(u.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(u.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(u.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,u.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(u.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(u.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(u.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(u.iridescenceMap=this.iridescenceMap.toJSON(i).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(u.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(i).uuid),this.map&&this.map.isTexture&&(u.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(u.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(u.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(u.lightMap=this.lightMap.toJSON(i).uuid,u.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(u.aoMap=this.aoMap.toJSON(i).uuid,u.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(u.bumpMap=this.bumpMap.toJSON(i).uuid,u.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(u.normalMap=this.normalMap.toJSON(i).uuid,u.normalMapType=this.normalMapType,u.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(u.displacementMap=this.displacementMap.toJSON(i).uuid,u.displacementScale=this.displacementScale,u.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(u.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(u.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(u.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(u.specularMap=this.specularMap.toJSON(i).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(u.specularIntensityMap=this.specularIntensityMap.toJSON(i).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(u.specularColorMap=this.specularColorMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(u.envMap=this.envMap.toJSON(i).uuid,this.combine!==void 0&&(u.combine=this.combine)),this.envMapIntensity!==void 0&&(u.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(u.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(u.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(u.gradientMap=this.gradientMap.toJSON(i).uuid),this.transmission!==void 0&&(u.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(u.transmissionMap=this.transmissionMap.toJSON(i).uuid),this.thickness!==void 0&&(u.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(u.thicknessMap=this.thicknessMap.toJSON(i).uuid),this.attenuationDistance!==void 0&&(u.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(u.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(u.size=this.size),this.shadowSide!==null&&(u.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(u.sizeAttenuation=this.sizeAttenuation),this.blending!==Ae&&(u.blending=this.blending),this.side!==je&&(u.side=this.side),this.vertexColors&&(u.vertexColors=!0),this.opacity<1&&(u.opacity=this.opacity),this.transparent===!0&&(u.transparent=this.transparent),u.depthFunc=this.depthFunc,u.depthTest=this.depthTest,u.depthWrite=this.depthWrite,u.colorWrite=this.colorWrite,u.stencilWrite=this.stencilWrite,u.stencilWriteMask=this.stencilWriteMask,u.stencilFunc=this.stencilFunc,u.stencilRef=this.stencilRef,u.stencilFuncMask=this.stencilFuncMask,u.stencilFail=this.stencilFail,u.stencilZFail=this.stencilZFail,u.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(u.rotation=this.rotation),this.polygonOffset===!0&&(u.polygonOffset=!0),this.polygonOffsetFactor!==0&&(u.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(u.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(u.linewidth=this.linewidth),this.dashSize!==void 0&&(u.dashSize=this.dashSize),this.gapSize!==void 0&&(u.gapSize=this.gapSize),this.scale!==void 0&&(u.scale=this.scale),this.dithering===!0&&(u.dithering=!0),this.alphaTest>0&&(u.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(u.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(u.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(u.wireframe=this.wireframe),this.wireframeLinewidth>1&&(u.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(u.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(u.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(u.flatShading=this.flatShading),this.visible===!1&&(u.visible=!1),this.toneMapped===!1&&(u.toneMapped=!1),this.fog===!1&&(u.fog=!1),JSON.stringify(this.userData)!=="{}"&&(u.userData=this.userData),l){const g=h(i.textures),_=h(i.images);g.length>0&&(u.textures=g),_.length>0&&(u.images=_)}return u}clone(){return new this.constructor().copy(this)}copy(i){this.name=i.name,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const l=i.clippingPlanes;let u=null;if(l!==null){const h=l.length;u=new Array(h);for(let g=0;g!==h;++g)u[g]=l[g].clone()}this.clippingPlanes=u,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.alphaToCoverage=i.alphaToCoverage,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData={};for(const[h,g]of Object.entries(i.userData))this.userData[h]=!g||g&&(g.isTexture||g.isObject3D)?g:JSON.parse(JSON.stringify(g));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(i){i===!0&&this.version++}}class Sa extends ss{constructor(i){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}const br=new he,Oo=new Lt;class ji{constructor(i,l,u){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=i,this.itemSize=l,this.count=i!==void 0?i.length/l:0,this.normalized=u===!0,this.usage=yc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}copy(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this}copyAt(i,l,u){i*=this.itemSize,u*=l.itemSize;for(let h=0,g=this.itemSize;h<g;h++)this.array[i+h]=l.array[u+h];return this}copyArray(i){return this.array.set(i),this}applyMatrix3(i){if(this.itemSize===2)for(let l=0,u=this.count;l<u;l++)Oo.fromBufferAttribute(this,l),Oo.applyMatrix3(i),this.setXY(l,Oo.x,Oo.y);else if(this.itemSize===3)for(let l=0,u=this.count;l<u;l++)br.fromBufferAttribute(this,l),br.applyMatrix3(i),this.setXYZ(l,br.x,br.y,br.z);return this}applyMatrix4(i){for(let l=0,u=this.count;l<u;l++)br.fromBufferAttribute(this,l),br.applyMatrix4(i),this.setXYZ(l,br.x,br.y,br.z);return this}applyNormalMatrix(i){for(let l=0,u=this.count;l<u;l++)br.fromBufferAttribute(this,l),br.applyNormalMatrix(i),this.setXYZ(l,br.x,br.y,br.z);return this}transformDirection(i){for(let l=0,u=this.count;l<u;l++)br.fromBufferAttribute(this,l),br.transformDirection(i),this.setXYZ(l,br.x,br.y,br.z);return this}set(i,l=0){return this.array.set(i,l),this}getX(i){let l=this.array[i*this.itemSize];return this.normalized&&(l=Za(l,this.array)),l}setX(i,l){return this.normalized&&(l=Vi(l,this.array)),this.array[i*this.itemSize]=l,this}getY(i){let l=this.array[i*this.itemSize+1];return this.normalized&&(l=Za(l,this.array)),l}setY(i,l){return this.normalized&&(l=Vi(l,this.array)),this.array[i*this.itemSize+1]=l,this}getZ(i){let l=this.array[i*this.itemSize+2];return this.normalized&&(l=Za(l,this.array)),l}setZ(i,l){return this.normalized&&(l=Vi(l,this.array)),this.array[i*this.itemSize+2]=l,this}getW(i){let l=this.array[i*this.itemSize+3];return this.normalized&&(l=Za(l,this.array)),l}setW(i,l){return this.normalized&&(l=Vi(l,this.array)),this.array[i*this.itemSize+3]=l,this}setXY(i,l,u){return i*=this.itemSize,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array)),this.array[i+0]=l,this.array[i+1]=u,this}setXYZ(i,l,u,h){return i*=this.itemSize,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array),h=Vi(h,this.array)),this.array[i+0]=l,this.array[i+1]=u,this.array[i+2]=h,this}setXYZW(i,l,u,h,g){return i*=this.itemSize,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array),h=Vi(h,this.array),g=Vi(g,this.array)),this.array[i+0]=l,this.array[i+1]=u,this.array[i+2]=h,this.array[i+3]=g,this}onUpload(i){return this.onUploadCallback=i,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const i={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(i.name=this.name),this.usage!==yc&&(i.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(i.updateRange=this.updateRange),i}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Mu extends ji{constructor(i,l,u){super(new Int8Array(i),l,u)}}class Lo extends ji{constructor(i,l,u){super(new Uint8Array(i),l,u)}}class Tu extends ji{constructor(i,l,u){super(new Uint8ClampedArray(i),l,u)}}class Bs extends ji{constructor(i,l,u){super(new Int16Array(i),l,u)}}class fr extends ji{constructor(i,l,u){super(new Uint16Array(i),l,u)}}class Fp extends ji{constructor(i,l,u){super(new Int32Array(i),l,u)}}class D extends ji{constructor(i,l,u){super(new Uint32Array(i),l,u)}}class v extends ji{constructor(i,l,u){super(new Uint16Array(i),l,u),this.isFloat16BufferAttribute=!0}}class w extends ji{constructor(i,l,u){super(new Float32Array(i),l,u)}}class N extends ji{constructor(i,l,u){super(new Float64Array(i),l,u)}}let Y=0;const fe=new Gn,Me=new ei,ut=new he,Ot=new Mc,Tn=new Mc,Ln=new he;class wn extends Vn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Y++}),this.uuid=_s(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(i){return Array.isArray(i)?this.index=new(Sm(i)?D:fr)(i,1):this.index=i,this}getAttribute(i){return this.attributes[i]}setAttribute(i,l){return this.attributes[i]=l,this}deleteAttribute(i){return delete this.attributes[i],this}hasAttribute(i){return this.attributes[i]!==void 0}addGroup(i,l,u=0){this.groups.push({start:i,count:l,materialIndex:u})}clearGroups(){this.groups=[]}setDrawRange(i,l){this.drawRange.start=i,this.drawRange.count=l}applyMatrix4(i){const l=this.attributes.position;l!==void 0&&(l.applyMatrix4(i),l.needsUpdate=!0);const u=this.attributes.normal;if(u!==void 0){const g=new ts().getNormalMatrix(i);u.applyNormalMatrix(g),u.needsUpdate=!0}const h=this.attributes.tangent;return h!==void 0&&(h.transformDirection(i),h.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(i){return fe.makeRotationFromQuaternion(i),this.applyMatrix4(fe),this}rotateX(i){return fe.makeRotationX(i),this.applyMatrix4(fe),this}rotateY(i){return fe.makeRotationY(i),this.applyMatrix4(fe),this}rotateZ(i){return fe.makeRotationZ(i),this.applyMatrix4(fe),this}translate(i,l,u){return fe.makeTranslation(i,l,u),this.applyMatrix4(fe),this}scale(i,l,u){return fe.makeScale(i,l,u),this.applyMatrix4(fe),this}lookAt(i){return Me.lookAt(i),Me.updateMatrix(),this.applyMatrix4(Me.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ut).negate(),this.translate(ut.x,ut.y,ut.z),this}setFromPoints(i){const l=[];for(let u=0,h=i.length;u<h;u++){const g=i[u];l.push(g.x,g.y,g.z||0)}return this.setAttribute("position",new w(l,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Mc);const i=this.attributes.position,l=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new he(-1/0,-1/0,-1/0),new he(1/0,1/0,1/0));if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),l)for(let u=0,h=l.length;u<h;u++){const g=l[u];Ot.setFromBufferAttribute(g),this.morphTargetsRelative?(Ln.addVectors(this.boundingBox.min,Ot.min),this.boundingBox.expandByPoint(Ln),Ln.addVectors(this.boundingBox.max,Ot.max),this.boundingBox.expandByPoint(Ln)):(this.boundingBox.expandByPoint(Ot.min),this.boundingBox.expandByPoint(Ot.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Do);const i=this.attributes.position,l=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new he,1/0);if(i){const u=this.boundingSphere.center;if(Ot.setFromBufferAttribute(i),l)for(let g=0,_=l.length;g<_;g++){const y=l[g];Tn.setFromBufferAttribute(y),this.morphTargetsRelative?(Ln.addVectors(Ot.min,Tn.min),Ot.expandByPoint(Ln),Ln.addVectors(Ot.max,Tn.max),Ot.expandByPoint(Ln)):(Ot.expandByPoint(Tn.min),Ot.expandByPoint(Tn.max))}Ot.getCenter(u);let h=0;for(let g=0,_=i.count;g<_;g++)Ln.fromBufferAttribute(i,g),h=Math.max(h,u.distanceToSquared(Ln));if(l)for(let g=0,_=l.length;g<_;g++){const y=l[g],C=this.morphTargetsRelative;for(let S=0,B=y.count;S<B;S++)Ln.fromBufferAttribute(y,S),C&&(ut.fromBufferAttribute(i,S),Ln.add(ut)),h=Math.max(h,u.distanceToSquared(Ln))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const i=this.index,l=this.attributes;if(i===null||l.position===void 0||l.normal===void 0||l.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const u=i.array,h=l.position.array,g=l.normal.array,_=l.uv.array,y=h.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ji(new Float32Array(4*y),4));const C=this.getAttribute("tangent").array,S=[],B=[];for(let Ke=0;Ke<y;Ke++)S[Ke]=new he,B[Ke]=new he;const L=new he,k=new he,U=new he,Q=new Lt,F=new Lt,H=new Lt,W=new he,q=new he;function $(Ke,Be,St){L.fromArray(h,3*Ke),k.fromArray(h,3*Be),U.fromArray(h,3*St),Q.fromArray(_,2*Ke),F.fromArray(_,2*Be),H.fromArray(_,2*St),k.sub(L),U.sub(L),F.sub(Q),H.sub(Q);const Ft=1/(F.x*H.y-H.x*F.y);isFinite(Ft)&&(W.copy(k).multiplyScalar(H.y).addScaledVector(U,-F.y).multiplyScalar(Ft),q.copy(U).multiplyScalar(F.x).addScaledVector(k,-H.x).multiplyScalar(Ft),S[Ke].add(W),S[Be].add(W),S[St].add(W),B[Ke].add(q),B[Be].add(q),B[St].add(q))}let ie=this.groups;ie.length===0&&(ie=[{start:0,count:u.length}]);for(let Ke=0,Be=ie.length;Ke<Be;++Ke){const St=ie[Ke],Ft=St.start;for(let Et=Ft,nn=Ft+St.count;Et<nn;Et+=3)$(u[Et+0],u[Et+1],u[Et+2])}const se=new he,le=new he,Ie=new he,De=new he;function Xe(Ke){Ie.fromArray(g,3*Ke),De.copy(Ie);const Be=S[Ke];se.copy(Be),se.sub(Ie.multiplyScalar(Ie.dot(Be))).normalize(),le.crossVectors(De,Be);const St=le.dot(B[Ke])<0?-1:1;C[4*Ke]=se.x,C[4*Ke+1]=se.y,C[4*Ke+2]=se.z,C[4*Ke+3]=St}for(let Ke=0,Be=ie.length;Ke<Be;++Ke){const St=ie[Ke],Ft=St.start;for(let Et=Ft,nn=Ft+St.count;Et<nn;Et+=3)Xe(u[Et+0]),Xe(u[Et+1]),Xe(u[Et+2])}}computeVertexNormals(){const i=this.index,l=this.getAttribute("position");if(l!==void 0){let u=this.getAttribute("normal");if(u===void 0)u=new ji(new Float32Array(3*l.count),3),this.setAttribute("normal",u);else for(let k=0,U=u.count;k<U;k++)u.setXYZ(k,0,0,0);const h=new he,g=new he,_=new he,y=new he,C=new he,S=new he,B=new he,L=new he;if(i)for(let k=0,U=i.count;k<U;k+=3){const Q=i.getX(k+0),F=i.getX(k+1),H=i.getX(k+2);h.fromBufferAttribute(l,Q),g.fromBufferAttribute(l,F),_.fromBufferAttribute(l,H),B.subVectors(_,g),L.subVectors(h,g),B.cross(L),y.fromBufferAttribute(u,Q),C.fromBufferAttribute(u,F),S.fromBufferAttribute(u,H),y.add(B),C.add(B),S.add(B),u.setXYZ(Q,y.x,y.y,y.z),u.setXYZ(F,C.x,C.y,C.z),u.setXYZ(H,S.x,S.y,S.z)}else for(let k=0,U=l.count;k<U;k+=3)h.fromBufferAttribute(l,k+0),g.fromBufferAttribute(l,k+1),_.fromBufferAttribute(l,k+2),B.subVectors(_,g),L.subVectors(h,g),B.cross(L),u.setXYZ(k+0,B.x,B.y,B.z),u.setXYZ(k+1,B.x,B.y,B.z),u.setXYZ(k+2,B.x,B.y,B.z);this.normalizeNormals(),u.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const i=this.attributes.normal;for(let l=0,u=i.count;l<u;l++)Ln.fromBufferAttribute(i,l),Ln.normalize(),i.setXYZ(l,Ln.x,Ln.y,Ln.z)}toNonIndexed(){function i(y,C){const S=y.array,B=y.itemSize,L=y.normalized,k=new S.constructor(C.length*B);let U=0,Q=0;for(let F=0,H=C.length;F<H;F++){U=y.isInterleavedBufferAttribute?C[F]*y.data.stride+y.offset:C[F]*B;for(let W=0;W<B;W++)k[Q++]=S[U++]}return new ji(k,B,L)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const l=new wn,u=this.index.array,h=this.attributes;for(const y in h){const C=i(h[y],u);l.setAttribute(y,C)}const g=this.morphAttributes;for(const y in g){const C=[],S=g[y];for(let B=0,L=S.length;B<L;B++){const k=i(S[B],u);C.push(k)}l.morphAttributes[y]=C}l.morphTargetsRelative=this.morphTargetsRelative;const _=this.groups;for(let y=0,C=_.length;y<C;y++){const S=_[y];l.addGroup(S.start,S.count,S.materialIndex)}return l}toJSON(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const C=this.parameters;for(const S in C)C[S]!==void 0&&(i[S]=C[S]);return i}i.data={attributes:{}};const l=this.index;l!==null&&(i.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});const u=this.attributes;for(const C in u){const S=u[C];i.data.attributes[C]=S.toJSON(i.data)}const h={};let g=!1;for(const C in this.morphAttributes){const S=this.morphAttributes[C],B=[];for(let L=0,k=S.length;L<k;L++){const U=S[L];B.push(U.toJSON(i.data))}B.length>0&&(h[C]=B,g=!0)}g&&(i.data.morphAttributes=h,i.data.morphTargetsRelative=this.morphTargetsRelative);const _=this.groups;_.length>0&&(i.data.groups=JSON.parse(JSON.stringify(_)));const y=this.boundingSphere;return y!==null&&(i.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),i}clone(){return new this.constructor().copy(this)}copy(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const l={};this.name=i.name;const u=i.index;u!==null&&this.setIndex(u.clone(l));const h=i.attributes;for(const S in h){const B=h[S];this.setAttribute(S,B.clone(l))}const g=i.morphAttributes;for(const S in g){const B=[],L=g[S];for(let k=0,U=L.length;k<U;k++)B.push(L[k].clone(l));this.morphAttributes[S]=B}this.morphTargetsRelative=i.morphTargetsRelative;const _=i.groups;for(let S=0,B=_.length;S<B;S++){const L=_[S];this.addGroup(L.start,L.count,L.materialIndex)}const y=i.boundingBox;y!==null&&(this.boundingBox=y.clone());const C=i.boundingSphere;return C!==null&&(this.boundingSphere=C.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,i.parameters!==void 0&&(this.parameters=Object.assign({},i.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const $i=new Gn,Sr=new jl,No=new Do,bs=new he,ao=new he,ia=new he,Rc=new he,Gl=new he,Iu=new he,Ih=new he,Dh=new he,Ph=new he,Od=new Lt,Im=new Lt,Dm=new Lt,jp=new he,Rh=new he;class os extends ei{constructor(i=new wn,l=new Sa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const u=i[l[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,g=u.length;h<g;h++){const _=u[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=h}}}}raycast(i,l){const u=this.geometry,h=this.material,g=this.matrixWorld;if(h===void 0||(u.boundingSphere===null&&u.computeBoundingSphere(),No.copy(u.boundingSphere),No.applyMatrix4(g),i.ray.intersectsSphere(No)===!1)||($i.copy(g).invert(),Sr.copy(i.ray).applyMatrix4($i),u.boundingBox!==null&&Sr.intersectsBox(u.boundingBox)===!1))return;let _;const y=u.index,C=u.attributes.position,S=u.morphAttributes.position,B=u.morphTargetsRelative,L=u.attributes.uv,k=u.attributes.uv2,U=u.groups,Q=u.drawRange;if(y!==null)if(Array.isArray(h))for(let F=0,H=U.length;F<H;F++){const W=U[F],q=h[W.materialIndex];for(let $=Math.max(W.start,Q.start),ie=Math.min(y.count,Math.min(W.start+W.count,Q.start+Q.count));$<ie;$+=3){const se=y.getX($),le=y.getX($+1),Ie=y.getX($+2);_=zp(this,q,i,Sr,C,S,B,L,k,se,le,Ie),_&&(_.faceIndex=Math.floor($/3),_.face.materialIndex=W.materialIndex,l.push(_))}}else for(let F=Math.max(0,Q.start),H=Math.min(y.count,Q.start+Q.count);F<H;F+=3){const W=y.getX(F),q=y.getX(F+1),$=y.getX(F+2);_=zp(this,h,i,Sr,C,S,B,L,k,W,q,$),_&&(_.faceIndex=Math.floor(F/3),l.push(_))}else if(C!==void 0)if(Array.isArray(h))for(let F=0,H=U.length;F<H;F++){const W=U[F],q=h[W.materialIndex];for(let $=Math.max(W.start,Q.start),ie=Math.min(C.count,Math.min(W.start+W.count,Q.start+Q.count));$<ie;$+=3)_=zp(this,q,i,Sr,C,S,B,L,k,$,$+1,$+2),_&&(_.faceIndex=Math.floor($/3),_.face.materialIndex=W.materialIndex,l.push(_))}else for(let F=Math.max(0,Q.start),H=Math.min(C.count,Q.start+Q.count);F<H;F+=3)_=zp(this,h,i,Sr,C,S,B,L,k,F,F+1,F+2),_&&(_.faceIndex=Math.floor(F/3),l.push(_))}}function zp(b,i,l,u,h,g,_,y,C,S,B,L){bs.fromBufferAttribute(h,S),ao.fromBufferAttribute(h,B),ia.fromBufferAttribute(h,L);const k=b.morphTargetInfluences;if(g&&k){Ih.set(0,0,0),Dh.set(0,0,0),Ph.set(0,0,0);for(let Q=0,F=g.length;Q<F;Q++){const H=k[Q],W=g[Q];H!==0&&(Rc.fromBufferAttribute(W,S),Gl.fromBufferAttribute(W,B),Iu.fromBufferAttribute(W,L),_?(Ih.addScaledVector(Rc,H),Dh.addScaledVector(Gl,H),Ph.addScaledVector(Iu,H)):(Ih.addScaledVector(Rc.sub(bs),H),Dh.addScaledVector(Gl.sub(ao),H),Ph.addScaledVector(Iu.sub(ia),H)))}bs.add(Ih),ao.add(Dh),ia.add(Ph)}b.isSkinnedMesh&&(b.boneTransform(S,bs),b.boneTransform(B,ao),b.boneTransform(L,ia));const U=function(Q,F,H,W,q,$,ie,se){let le;if(le=F.side===me?W.intersectTriangle(ie,$,q,!0,se):W.intersectTriangle(q,$,ie,F.side!==Te,se),le===null)return null;Rh.copy(se),Rh.applyMatrix4(Q.matrixWorld);const Ie=H.ray.origin.distanceTo(Rh);return Ie<H.near||Ie>H.far?null:{distance:Ie,point:Rh.clone(),object:Q}}(b,i,l,u,bs,ao,ia,jp);if(U){y&&(Od.fromBufferAttribute(y,S),Im.fromBufferAttribute(y,B),Dm.fromBufferAttribute(y,L),U.uv=rs.getUV(jp,bs,ao,ia,Od,Im,Dm,new Lt)),C&&(Od.fromBufferAttribute(C,S),Im.fromBufferAttribute(C,B),Dm.fromBufferAttribute(C,L),U.uv2=rs.getUV(jp,bs,ao,ia,Od,Im,Dm,new Lt));const Q={a:S,b:B,c:L,normal:new he,materialIndex:0};rs.getNormal(bs,ao,ia,Q.normal),U.face=Q}return U}class Ma extends wn{constructor(i=1,l=1,u=1,h=1,g=1,_=1){super(),this.type="BoxGeometry",this.parameters={width:i,height:l,depth:u,widthSegments:h,heightSegments:g,depthSegments:_};const y=this;h=Math.floor(h),g=Math.floor(g),_=Math.floor(_);const C=[],S=[],B=[],L=[];let k=0,U=0;function Q(F,H,W,q,$,ie,se,le,Ie,De,Xe){const Ke=ie/Ie,Be=se/De,St=ie/2,Ft=se/2,Et=le/2,nn=Ie+1,rn=De+1;let dt=0,At=0;const Wt=new he;for(let Mt=0;Mt<rn;Mt++){const en=Mt*Be-Ft;for(let In=0;In<nn;In++){const hi=In*Ke-St;Wt[F]=hi*q,Wt[H]=en*$,Wt[W]=Et,S.push(Wt.x,Wt.y,Wt.z),Wt[F]=0,Wt[H]=0,Wt[W]=le>0?1:-1,B.push(Wt.x,Wt.y,Wt.z),L.push(In/Ie),L.push(1-Mt/De),dt+=1}}for(let Mt=0;Mt<De;Mt++)for(let en=0;en<Ie;en++){const In=k+en+nn*Mt,hi=k+en+nn*(Mt+1),Pn=k+(en+1)+nn*(Mt+1),ri=k+(en+1)+nn*Mt;C.push(In,hi,ri),C.push(hi,Pn,ri),At+=6}y.addGroup(U,At,Xe),U+=At,k+=dt}Q("z","y","x",-1,-1,u,l,i,_,g,0),Q("z","y","x",1,-1,u,l,-i,_,g,1),Q("x","z","y",1,1,i,u,l,h,_,2),Q("x","z","y",1,-1,i,u,-l,h,_,3),Q("x","y","z",1,-1,i,l,u,h,g,4),Q("x","y","z",-1,-1,i,l,-u,h,g,5),this.setIndex(C),this.setAttribute("position",new w(S,3)),this.setAttribute("normal",new w(B,3)),this.setAttribute("uv",new w(L,2))}static fromJSON(i){return new Ma(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments)}}function Du(b){const i={};for(const l in b){i[l]={};for(const u in b[l]){const h=b[l][u];h&&(h.isColor||h.isMatrix3||h.isMatrix4||h.isVector2||h.isVector3||h.isVector4||h.isTexture||h.isQuaternion)?i[l][u]=h.clone():Array.isArray(h)?i[l][u]=h.slice():i[l][u]=h}}return i}function Ks(b){const i={};for(let l=0;l<b.length;l++){const u=Du(b[l]);for(const h in u)i[h]=u[h]}return i}const F_={clone:Du,merge:Ks};class rl extends ss{constructor(i){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&this.setValues(i)}copy(i){return super.copy(i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=Du(i.uniforms),this.uniformsGroups=function(l){const u=[];for(let h=0;h<l.length;h++)u.push(l[h].clone());return u}(i.uniformsGroups),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.fog=i.fog,this.lights=i.lights,this.clipping=i.clipping,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this}toJSON(i){const l=super.toJSON(i);l.glslVersion=this.glslVersion,l.uniforms={};for(const h in this.uniforms){const g=this.uniforms[h].value;g&&g.isTexture?l.uniforms[h]={type:"t",value:g.toJSON(i).uuid}:g&&g.isColor?l.uniforms[h]={type:"c",value:g.getHex()}:g&&g.isVector2?l.uniforms[h]={type:"v2",value:g.toArray()}:g&&g.isVector3?l.uniforms[h]={type:"v3",value:g.toArray()}:g&&g.isVector4?l.uniforms[h]={type:"v4",value:g.toArray()}:g&&g.isMatrix3?l.uniforms[h]={type:"m3",value:g.toArray()}:g&&g.isMatrix4?l.uniforms[h]={type:"m4",value:g.toArray()}:l.uniforms[h]={value:g}}Object.keys(this.defines).length>0&&(l.defines=this.defines),l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader;const u={};for(const h in this.extensions)this.extensions[h]===!0&&(u[h]=!0);return Object.keys(u).length>0&&(l.extensions=u),l}}class Ld extends ei{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Gn,this.projectionMatrix=new Gn,this.projectionMatrixInverse=new Gn}copy(i,l){return super.copy(i,l),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return i.set(-l[8],-l[9],-l[10]).normalize()}updateMatrixWorld(i){super.updateMatrixWorld(i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(i,l){super.updateWorldMatrix(i,l),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ws extends Ld{constructor(i=50,l=1,u=.1,h=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=u,this.far=h,this.focus=10,this.aspect=l,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(i,l){return super.copy(i,l),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this}setFocalLength(i){const l=.5*this.getFilmHeight()/i;this.fov=2*bh*Math.atan(l),this.updateProjectionMatrix()}getFocalLength(){const i=Math.tan(.5*wc*this.fov);return .5*this.getFilmHeight()/i}getEffectiveFOV(){return 2*bh*Math.atan(Math.tan(.5*wc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(i,l,u,h,g,_){this.aspect=i/l,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=l,this.view.offsetX=u,this.view.offsetY=h,this.view.width=g,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=this.near;let l=i*Math.tan(.5*wc*this.fov)/this.zoom,u=2*l,h=this.aspect*u,g=-.5*h;const _=this.view;if(this.view!==null&&this.view.enabled){const C=_.fullWidth,S=_.fullHeight;g+=_.offsetX*h/C,l-=_.offsetY*u/S,h*=_.width/C,u*=_.height/S}const y=this.filmOffset;y!==0&&(g+=i*y/this.getFilmWidth()),this.projectionMatrix.makePerspective(g,g+h,l,l-u,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const l=super.toJSON(i);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,this.view!==null&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}const Pu=90;class Lv extends ei{constructor(i,l,u){super(),this.type="CubeCamera",this.renderTarget=u;const h=new ws(Pu,1,i,l);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new he(1,0,0)),this.add(h);const g=new ws(Pu,1,i,l);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new he(-1,0,0)),this.add(g);const _=new ws(Pu,1,i,l);_.layers=this.layers,_.up.set(0,0,1),_.lookAt(new he(0,1,0)),this.add(_);const y=new ws(Pu,1,i,l);y.layers=this.layers,y.up.set(0,0,-1),y.lookAt(new he(0,-1,0)),this.add(y);const C=new ws(Pu,1,i,l);C.layers=this.layers,C.up.set(0,-1,0),C.lookAt(new he(0,0,1)),this.add(C);const S=new ws(Pu,1,i,l);S.layers=this.layers,S.up.set(0,-1,0),S.lookAt(new he(0,0,-1)),this.add(S)}update(i,l){this.parent===null&&this.updateMatrixWorld();const u=this.renderTarget,[h,g,_,y,C,S]=this.children,B=i.getRenderTarget(),L=i.toneMapping,k=i.xr.enabled;i.toneMapping=pi,i.xr.enabled=!1;const U=u.texture.generateMipmaps;u.texture.generateMipmaps=!1,i.setRenderTarget(u,0),i.render(l,h),i.setRenderTarget(u,1),i.render(l,g),i.setRenderTarget(u,2),i.render(l,_),i.setRenderTarget(u,3),i.render(l,y),i.setRenderTarget(u,4),i.render(l,C),u.texture.generateMipmaps=U,i.setRenderTarget(u,5),i.render(l,S),i.setRenderTarget(B),i.toneMapping=L,i.xr.enabled=k,u.texture.needsPMREMUpdate=!0}}class Nd extends Ur{constructor(i,l,u,h,g,_,y,C,S,B){super(i=i!==void 0?i:[],l=l!==void 0?l:vr,u,h,g,_,y,C,S,B),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(i){this.image=i}}class j_ extends qs{constructor(i,l={}){super(i,i,l),this.isWebGLCubeRenderTarget=!0;const u={width:i,height:i,depth:1},h=[u,u,u,u,u,u];this.texture=new Nd(h,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=l.generateMipmaps!==void 0&&l.generateMipmaps,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:ur}fromEquirectangularTexture(i,l){this.texture.type=l.type,this.texture.encoding=l.encoding,this.texture.generateMipmaps=l.generateMipmaps,this.texture.minFilter=l.minFilter,this.texture.magFilter=l.magFilter;const u={tEquirect:{value:null}},h=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,g=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,_=new Ma(5,5,5),y=new rl({name:"CubemapFromEquirect",uniforms:Du(u),vertexShader:h,fragmentShader:g,side:me,blending:ue});y.uniforms.tEquirect.value=l;const C=new os(_,y),S=l.minFilter;return l.minFilter===Pi&&(l.minFilter=ur),new Lv(1,10,this).update(i,C),l.minFilter=S,C.geometry.dispose(),C.material.dispose(),this}clear(i,l,u,h){const g=i.getRenderTarget();for(let _=0;_<6;_++)i.setRenderTarget(this,_),i.clear(l,u,h);i.setRenderTarget(g)}}const Nv=new he,Ru=new he,Uv=new ts;class Bc{constructor(i=new he(1,0,0),l=0){this.isPlane=!0,this.normal=i,this.constant=l}set(i,l){return this.normal.copy(i),this.constant=l,this}setComponents(i,l,u,h){return this.normal.set(i,l,u),this.constant=h,this}setFromNormalAndCoplanarPoint(i,l){return this.normal.copy(i),this.constant=-l.dot(this.normal),this}setFromCoplanarPoints(i,l,u){const h=Nv.subVectors(u,l).cross(Ru.subVectors(i,l)).normalize();return this.setFromNormalAndCoplanarPoint(h,i),this}copy(i){return this.normal.copy(i.normal),this.constant=i.constant,this}normalize(){const i=1/this.normal.length();return this.normal.multiplyScalar(i),this.constant*=i,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(i){return this.normal.dot(i)+this.constant}distanceToSphere(i){return this.distanceToPoint(i.center)-i.radius}projectPoint(i,l){return l.copy(this.normal).multiplyScalar(-this.distanceToPoint(i)).add(i)}intersectLine(i,l){const u=i.delta(Nv),h=this.normal.dot(u);if(h===0)return this.distanceToPoint(i.start)===0?l.copy(i.start):null;const g=-(i.start.dot(this.normal)+this.constant)/h;return g<0||g>1?null:l.copy(u).multiplyScalar(g).add(i.start)}intersectsLine(i){const l=this.distanceToPoint(i.start),u=this.distanceToPoint(i.end);return l<0&&u>0||u<0&&l>0}intersectsBox(i){return i.intersectsPlane(this)}intersectsSphere(i){return i.intersectsPlane(this)}coplanarPoint(i){return i.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(i,l){const u=l||Uv.getNormalMatrix(i),h=this.coplanarPoint(Nv).applyMatrix4(i),g=this.normal.applyMatrix3(u).normalize();return this.constant=-h.dot(g),this}translate(i){return this.constant-=i.dot(this.normal),this}equals(i){return i.normal.equals(this.normal)&&i.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Bh=new Do,Qp=new he;class Vp{constructor(i=new Bc,l=new Bc,u=new Bc,h=new Bc,g=new Bc,_=new Bc){this.planes=[i,l,u,h,g,_]}set(i,l,u,h,g,_){const y=this.planes;return y[0].copy(i),y[1].copy(l),y[2].copy(u),y[3].copy(h),y[4].copy(g),y[5].copy(_),this}copy(i){const l=this.planes;for(let u=0;u<6;u++)l[u].copy(i.planes[u]);return this}setFromProjectionMatrix(i){const l=this.planes,u=i.elements,h=u[0],g=u[1],_=u[2],y=u[3],C=u[4],S=u[5],B=u[6],L=u[7],k=u[8],U=u[9],Q=u[10],F=u[11],H=u[12],W=u[13],q=u[14],$=u[15];return l[0].setComponents(y-h,L-C,F-k,$-H).normalize(),l[1].setComponents(y+h,L+C,F+k,$+H).normalize(),l[2].setComponents(y+g,L+S,F+U,$+W).normalize(),l[3].setComponents(y-g,L-S,F-U,$-W).normalize(),l[4].setComponents(y-_,L-B,F-Q,$-q).normalize(),l[5].setComponents(y+_,L+B,F+Q,$+q).normalize(),this}intersectsObject(i){const l=i.geometry;return l.boundingSphere===null&&l.computeBoundingSphere(),Bh.copy(l.boundingSphere).applyMatrix4(i.matrixWorld),this.intersectsSphere(Bh)}intersectsSprite(i){return Bh.center.set(0,0,0),Bh.radius=.7071067811865476,Bh.applyMatrix4(i.matrixWorld),this.intersectsSphere(Bh)}intersectsSphere(i){const l=this.planes,u=i.center,h=-i.radius;for(let g=0;g<6;g++)if(l[g].distanceToPoint(u)<h)return!1;return!0}intersectsBox(i){const l=this.planes;for(let u=0;u<6;u++){const h=l[u];if(Qp.x=h.normal.x>0?i.max.x:i.min.x,Qp.y=h.normal.y>0?i.max.y:i.min.y,Qp.z=h.normal.z>0?i.max.z:i.min.z,h.distanceToPoint(Qp)<0)return!1}return!0}containsPoint(i){const l=this.planes;for(let u=0;u<6;u++)if(l[u].distanceToPoint(i)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function kc(){let b=null,i=!1,l=null,u=null;function h(g,_){l(g,_),u=b.requestAnimationFrame(h)}return{start:function(){i!==!0&&l!==null&&(u=b.requestAnimationFrame(h),i=!0)},stop:function(){b.cancelAnimationFrame(u),i=!1},setAnimationLoop:function(g){l=g},setContext:function(g){b=g}}}function Ud(b,i){const l=i.isWebGL2,u=new WeakMap;return{get:function(h){return h.isInterleavedBufferAttribute&&(h=h.data),u.get(h)},remove:function(h){h.isInterleavedBufferAttribute&&(h=h.data);const g=u.get(h);g&&(b.deleteBuffer(g.buffer),u.delete(h))},update:function(h,g){if(h.isGLBufferAttribute){const y=u.get(h);return void((!y||y.version<h.version)&&u.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version}))}h.isInterleavedBufferAttribute&&(h=h.data);const _=u.get(h);_===void 0?u.set(h,function(y,C){const S=y.array,B=y.usage,L=b.createBuffer();let k;if(b.bindBuffer(C,L),b.bufferData(C,S,B),y.onUploadCallback(),S instanceof Float32Array)k=5126;else if(S instanceof Uint16Array)if(y.isFloat16BufferAttribute){if(!l)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");k=5131}else k=5123;else if(S instanceof Int16Array)k=5122;else if(S instanceof Uint32Array)k=5125;else if(S instanceof Int32Array)k=5124;else if(S instanceof Int8Array)k=5120;else if(S instanceof Uint8Array)k=5121;else{if(!(S instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+S);k=5121}return{buffer:L,type:k,bytesPerElement:S.BYTES_PER_ELEMENT,version:y.version}}(h,g)):_.version<h.version&&(function(y,C,S){const B=C.array,L=C.updateRange;b.bindBuffer(S,y),L.count===-1?b.bufferSubData(S,0,B):(l?b.bufferSubData(S,L.offset*B.BYTES_PER_ELEMENT,B,L.offset,L.count):b.bufferSubData(S,L.offset*B.BYTES_PER_ELEMENT,B.subarray(L.offset,L.offset+L.count)),L.count=-1)}(_.buffer,h,g),_.version=h.version)}}}class Bu extends wn{constructor(i=1,l=1,u=1,h=1){super(),this.type="PlaneGeometry",this.parameters={width:i,height:l,widthSegments:u,heightSegments:h};const g=i/2,_=l/2,y=Math.floor(u),C=Math.floor(h),S=y+1,B=C+1,L=i/y,k=l/C,U=[],Q=[],F=[],H=[];for(let W=0;W<B;W++){const q=W*k-_;for(let $=0;$<S;$++){const ie=$*L-g;Q.push(ie,-q,0),F.push(0,0,1),H.push($/y),H.push(1-W/C)}}for(let W=0;W<C;W++)for(let q=0;q<y;q++){const $=q+S*W,ie=q+S*(W+1),se=q+1+S*(W+1),le=q+1+S*W;U.push($,ie,le),U.push(ie,se,le)}this.setIndex(U),this.setAttribute("position",new w(Q,3)),this.setAttribute("normal",new w(F,3)),this.setAttribute("uv",new w(H,2))}static fromJSON(i){return new Bu(i.width,i.height,i.widthSegments,i.heightSegments)}}const ii={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},un={common:{diffuse:{value:new mn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ts},uv2Transform:{value:new ts},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new mn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new mn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ts}},sprite:{diffuse:{value:new mn(16777215)},opacity:{value:1},center:{value:new Lt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ts}}},Uo={basic:{uniforms:Ks([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.fog]),vertexShader:ii.meshbasic_vert,fragmentShader:ii.meshbasic_frag},lambert:{uniforms:Ks([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new mn(0)}}]),vertexShader:ii.meshlambert_vert,fragmentShader:ii.meshlambert_frag},phong:{uniforms:Ks([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new mn(0)},specular:{value:new mn(1118481)},shininess:{value:30}}]),vertexShader:ii.meshphong_vert,fragmentShader:ii.meshphong_frag},standard:{uniforms:Ks([un.common,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.roughnessmap,un.metalnessmap,un.fog,un.lights,{emissive:{value:new mn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ii.meshphysical_vert,fragmentShader:ii.meshphysical_frag},toon:{uniforms:Ks([un.common,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.gradientmap,un.fog,un.lights,{emissive:{value:new mn(0)}}]),vertexShader:ii.meshtoon_vert,fragmentShader:ii.meshtoon_frag},matcap:{uniforms:Ks([un.common,un.bumpmap,un.normalmap,un.displacementmap,un.fog,{matcap:{value:null}}]),vertexShader:ii.meshmatcap_vert,fragmentShader:ii.meshmatcap_frag},points:{uniforms:Ks([un.points,un.fog]),vertexShader:ii.points_vert,fragmentShader:ii.points_frag},dashed:{uniforms:Ks([un.common,un.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ii.linedashed_vert,fragmentShader:ii.linedashed_frag},depth:{uniforms:Ks([un.common,un.displacementmap]),vertexShader:ii.depth_vert,fragmentShader:ii.depth_frag},normal:{uniforms:Ks([un.common,un.bumpmap,un.normalmap,un.displacementmap,{opacity:{value:1}}]),vertexShader:ii.meshnormal_vert,fragmentShader:ii.meshnormal_frag},sprite:{uniforms:Ks([un.sprite,un.fog]),vertexShader:ii.sprite_vert,fragmentShader:ii.sprite_frag},background:{uniforms:{uvTransform:{value:new ts},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:ii.background_vert,fragmentShader:ii.background_frag},cube:{uniforms:Ks([un.envmap,{opacity:{value:1}}]),vertexShader:ii.cube_vert,fragmentShader:ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ii.equirect_vert,fragmentShader:ii.equirect_frag},distanceRGBA:{uniforms:Ks([un.common,un.displacementmap,{referencePosition:{value:new he},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ii.distanceRGBA_vert,fragmentShader:ii.distanceRGBA_frag},shadow:{uniforms:Ks([un.lights,un.fog,{color:{value:new mn(0)},opacity:{value:1}}]),vertexShader:ii.shadow_vert,fragmentShader:ii.shadow_frag}};function hw(b,i,l,u,h,g){const _=new mn(0);let y,C,S=h===!0?0:1,B=null,L=0,k=null;function U(Q,F){l.buffers.color.setClear(Q.r,Q.g,Q.b,F,g)}return{getClearColor:function(){return _},setClearColor:function(Q,F=1){_.set(Q),S=F,U(_,S)},getClearAlpha:function(){return S},setClearAlpha:function(Q){S=Q,U(_,S)},getPlaneMesh:function(){return y},getBoxMesh:function(){return C},getBoxMesh2:function(){return C===void 0&&(C=new os(new Ma(1,1,1),new rl({name:"BackgroundCubeMaterial",uniforms:Du(Uo.cube.uniforms),vertexShader:Uo.cube.vertexShader,fragmentShader:Uo.cube.fragmentShader,side:me,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),C.geometry.deleteAttribute("uv"),C.onBeforeRender=function(Q,F,H){this.matrixWorld.copyPosition(H.matrixWorld)},Object.defineProperty(C.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(C)),C},render:function(Q,F){let H=!1,W=F.isScene===!0?F.background:null;W&&W.isTexture&&(W=i.get(W));const q=b.xr,$=q.getSession&&q.getSession();$&&$.environmentBlendMode==="additive"&&(W=null),W===null?U(_,S):W&&W.isColor&&(U(W,1),H=!0),(b.autoClear||H)&&b.clear(b.autoClearColor,b.autoClearDepth,b.autoClearStencil),W&&(W.isCubeTexture||W.mapping===Vs)?(C===void 0&&(C=new os(new Ma(1,1,1),new rl({name:"BackgroundCubeMaterial",uniforms:Du(Uo.cube.uniforms),vertexShader:Uo.cube.vertexShader,fragmentShader:Uo.cube.fragmentShader,side:me,depthTest:!1,depthWrite:!1,fog:!1})),C.geometry.deleteAttribute("normal"),C.geometry.deleteAttribute("uv"),C.onBeforeRender=function(ie,se,le){this.matrixWorld.copyPosition(le.matrixWorld)},Object.defineProperty(C.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(C)),C.material.uniforms.envMap.value=W,C.material.uniforms.envMapRotation.value=W.rotation||0,C.material.uniforms.flipEnvMap.value=W.isCubeTexture&&W.isRenderTargetTexture===!1?-1:1,B===W&&L===W.version&&k===b.toneMapping||(C.material.needsUpdate=!0,B=W,L=W.version,k=b.toneMapping),C.layers.enableAll(),Q.unshift(C,C.geometry,C.material,0,0,null)):W&&W.isTexture&&(y===void 0&&(y=new os(new Bu(2,2),new rl({name:"BackgroundMaterial",uniforms:Du(Uo.background.uniforms),vertexShader:Uo.background.vertexShader,fragmentShader:Uo.background.fragmentShader,side:je,depthTest:!1,depthWrite:!1,fog:!1})),y.geometry.deleteAttribute("normal"),Object.defineProperty(y.material,"map",{get:function(){return this.uniforms.t2D.value}}),u.update(y)),y.material.uniforms.t2D.value=W,y.material.uniforms.flipX.value=W.userData.flipX||!1,y.material.uniforms.flipY.value=W.userData.flipY||!1,W.matrixAutoUpdate===!0&&W.updateMatrix(),y.material.uniforms.uvTransform.value.copy(W.matrix),B===W&&L===W.version&&k===b.toneMapping||(y.material.needsUpdate=!0,B=W,L=W.version,k=b.toneMapping),y.layers.enableAll(),Q.unshift(y,y.geometry,y.material,0,0,null))}}}function dw(b,i,l,u){const h=b.getParameter(34921),g=u.isWebGL2?null:i.get("OES_vertex_array_object"),_=u.isWebGL2||g!==null,y={},C=U(null);let S=C,B=!1;function L(se){return u.isWebGL2?b.bindVertexArray(se):g.bindVertexArrayOES(se)}function k(se){return u.isWebGL2?b.deleteVertexArray(se):g.deleteVertexArrayOES(se)}function U(se){const le=[],Ie=[],De=[];for(let Xe=0;Xe<h;Xe++)le[Xe]=0,Ie[Xe]=0,De[Xe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:le,enabledAttributes:Ie,attributeDivisors:De,object:se,attributes:{},index:null}}function Q(){const se=S.newAttributes;for(let le=0,Ie=se.length;le<Ie;le++)se[le]=0}function F(se){H(se,0)}function H(se,le){const Ie=S.newAttributes,De=S.enabledAttributes,Xe=S.attributeDivisors;Ie[se]=1,De[se]===0&&(b.enableVertexAttribArray(se),De[se]=1),Xe[se]!==le&&((u.isWebGL2?b:i.get("ANGLE_instanced_arrays"))[u.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](se,le),Xe[se]=le)}function W(){const se=S.newAttributes,le=S.enabledAttributes;for(let Ie=0,De=le.length;Ie<De;Ie++)le[Ie]!==se[Ie]&&(b.disableVertexAttribArray(Ie),le[Ie]=0)}function q(se,le,Ie,De,Xe,Ke){u.isWebGL2!==!0||Ie!==5124&&Ie!==5125?b.vertexAttribPointer(se,le,Ie,De,Xe,Ke):b.vertexAttribIPointer(se,le,Ie,Xe,Ke)}function $(){ie(),B=!0,S!==C&&(S=C,L(S.object))}function ie(){C.geometry=null,C.program=null,C.wireframe=!1}return{setup:function(se,le,Ie,De,Xe){let Ke=!1;if(_){const Be=function(St,Ft,Et){const nn=Et.wireframe===!0;let rn=y[St.id];rn===void 0&&(rn={},y[St.id]=rn);let dt=rn[Ft.id];dt===void 0&&(dt={},rn[Ft.id]=dt);let At=dt[nn];return At===void 0&&(At=U(u.isWebGL2?b.createVertexArray():g.createVertexArrayOES()),dt[nn]=At),At}(De,Ie,le);S!==Be&&(S=Be,L(S.object)),Ke=function(St,Ft,Et,nn){const rn=S.attributes,dt=Ft.attributes;let At=0;const Wt=Et.getAttributes();for(const Mt in Wt)if(Wt[Mt].location>=0){const en=rn[Mt];let In=dt[Mt];if(In===void 0&&(Mt==="instanceMatrix"&&St.instanceMatrix&&(In=St.instanceMatrix),Mt==="instanceColor"&&St.instanceColor&&(In=St.instanceColor)),en===void 0||en.attribute!==In||In&&en.data!==In.data)return!0;At++}return S.attributesNum!==At||S.index!==nn}(se,De,Ie,Xe),Ke&&function(St,Ft,Et,nn){const rn={},dt=Ft.attributes;let At=0;const Wt=Et.getAttributes();for(const Mt in Wt)if(Wt[Mt].location>=0){let en=dt[Mt];en===void 0&&(Mt==="instanceMatrix"&&St.instanceMatrix&&(en=St.instanceMatrix),Mt==="instanceColor"&&St.instanceColor&&(en=St.instanceColor));const In={};In.attribute=en,en&&en.data&&(In.data=en.data),rn[Mt]=In,At++}S.attributes=rn,S.attributesNum=At,S.index=nn}(se,De,Ie,Xe)}else{const Be=le.wireframe===!0;S.geometry===De.id&&S.program===Ie.id&&S.wireframe===Be||(S.geometry=De.id,S.program=Ie.id,S.wireframe=Be,Ke=!0)}Xe!==null&&l.update(Xe,34963),(Ke||B)&&(B=!1,function(Be,St,Ft,Et){if(u.isWebGL2===!1&&(Be.isInstancedMesh||Et.isInstancedBufferGeometry)&&i.get("ANGLE_instanced_arrays")===null)return;Q();const nn=Et.attributes,rn=Ft.getAttributes(),dt=St.defaultAttributeValues;for(const At in rn){const Wt=rn[At];if(Wt.location>=0){let Mt=nn[At];if(Mt===void 0&&(At==="instanceMatrix"&&Be.instanceMatrix&&(Mt=Be.instanceMatrix),At==="instanceColor"&&Be.instanceColor&&(Mt=Be.instanceColor)),Mt!==void 0){const en=Mt.normalized,In=Mt.itemSize,hi=l.get(Mt);if(hi===void 0)continue;const Pn=hi.buffer,ri=hi.type,Ce=hi.bytesPerElement;if(Mt.isInterleavedBufferAttribute){const _e=Mt.data,it=_e.stride,qe=Mt.offset;if(_e.isInstancedInterleavedBuffer){for(let Se=0;Se<Wt.locationSize;Se++)H(Wt.location+Se,_e.meshPerAttribute);Be.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=_e.meshPerAttribute*_e.count)}else for(let Se=0;Se<Wt.locationSize;Se++)F(Wt.location+Se);b.bindBuffer(34962,Pn);for(let Se=0;Se<Wt.locationSize;Se++)q(Wt.location+Se,In/Wt.locationSize,ri,en,it*Ce,(qe+In/Wt.locationSize*Se)*Ce)}else{if(Mt.isInstancedBufferAttribute){for(let _e=0;_e<Wt.locationSize;_e++)H(Wt.location+_e,Mt.meshPerAttribute);Be.isInstancedMesh!==!0&&Et._maxInstanceCount===void 0&&(Et._maxInstanceCount=Mt.meshPerAttribute*Mt.count)}else for(let _e=0;_e<Wt.locationSize;_e++)F(Wt.location+_e);b.bindBuffer(34962,Pn);for(let _e=0;_e<Wt.locationSize;_e++)q(Wt.location+_e,In/Wt.locationSize,ri,en,In*Ce,In/Wt.locationSize*_e*Ce)}}else if(dt!==void 0){const en=dt[At];if(en!==void 0)switch(en.length){case 2:b.vertexAttrib2fv(Wt.location,en);break;case 3:b.vertexAttrib3fv(Wt.location,en);break;case 4:b.vertexAttrib4fv(Wt.location,en);break;default:b.vertexAttrib1fv(Wt.location,en)}}}}W()}(se,le,Ie,De),Xe!==null&&b.bindBuffer(34963,l.get(Xe).buffer))},reset:$,resetDefaultState:ie,dispose:function(){$();for(const se in y){const le=y[se];for(const Ie in le){const De=le[Ie];for(const Xe in De)k(De[Xe].object),delete De[Xe];delete le[Ie]}delete y[se]}},releaseStatesOfGeometry:function(se){if(y[se.id]===void 0)return;const le=y[se.id];for(const Ie in le){const De=le[Ie];for(const Xe in De)k(De[Xe].object),delete De[Xe];delete le[Ie]}delete y[se.id]},releaseStatesOfProgram:function(se){for(const le in y){const Ie=y[le];if(Ie[se.id]===void 0)continue;const De=Ie[se.id];for(const Xe in De)k(De[Xe].object),delete De[Xe];delete Ie[se.id]}},initAttributes:Q,enableAttribute:F,disableUnusedAttributes:W}}function z_(b,i,l,u){const h=u.isWebGL2;let g;this.setMode=function(_){g=_},this.render=function(_,y){b.drawArrays(g,_,y),l.update(y,g,1)},this.renderInstances=function(_,y,C){if(C===0)return;let S,B;if(h)S=b,B="drawArraysInstanced";else if(S=i.get("ANGLE_instanced_arrays"),B="drawArraysInstancedANGLE",S===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");S[B](g,_,y,C),l.update(y,g,C)}}function Q_(b,i,l){let u;function h(ie){if(ie==="highp"){if(b.getShaderPrecisionFormat(35633,36338).precision>0&&b.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ie="mediump"}return ie==="mediump"&&b.getShaderPrecisionFormat(35633,36337).precision>0&&b.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const g=typeof WebGL2RenderingContext<"u"&&b instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&b instanceof WebGL2ComputeRenderingContext;let _=l.precision!==void 0?l.precision:"highp";const y=h(_);y!==_&&(console.warn("THREE.WebGLRenderer:",_,"not supported, using",y,"instead."),_=y);const C=g||i.has("WEBGL_draw_buffers"),S=l.logarithmicDepthBuffer===!0,B=b.getParameter(34930),L=b.getParameter(35660),k=b.getParameter(3379),U=b.getParameter(34076),Q=b.getParameter(34921),F=b.getParameter(36347),H=b.getParameter(36348),W=b.getParameter(36349),q=L>0,$=g||i.has("OES_texture_float");return{isWebGL2:g,drawBuffers:C,getMaxAnisotropy:function(){if(u!==void 0)return u;if(i.has("EXT_texture_filter_anisotropic")===!0){const ie=i.get("EXT_texture_filter_anisotropic");u=b.getParameter(ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else u=0;return u},getMaxPrecision:h,precision:_,logarithmicDepthBuffer:S,maxTextures:B,maxVertexTextures:L,maxTextureSize:k,maxCubemapSize:U,maxAttributes:Q,maxVertexUniforms:F,maxVaryings:H,maxFragmentUniforms:W,vertexTextures:q,floatFragmentTextures:$,floatVertexTextures:q&&$,maxSamples:g?b.getParameter(36183):0}}function pw(b){const i=this;let l=null,u=0,h=!1,g=!1;const _=new Bc,y=new ts,C={value:null,needsUpdate:!1};function S(){C.value!==l&&(C.value=l,C.needsUpdate=u>0),i.numPlanes=u,i.numIntersection=0}function B(L,k,U,Q){const F=L!==null?L.length:0;let H=null;if(F!==0){if(H=C.value,Q!==!0||H===null){const W=U+4*F,q=k.matrixWorldInverse;y.getNormalMatrix(q),(H===null||H.length<W)&&(H=new Float32Array(W));for(let $=0,ie=U;$!==F;++$,ie+=4)_.copy(L[$]).applyMatrix4(q,y),_.normal.toArray(H,ie),H[ie+3]=_.constant}C.value=H,C.needsUpdate=!0}return i.numPlanes=F,i.numIntersection=0,H}this.uniform=C,this.numPlanes=0,this.numIntersection=0,this.init=function(L,k,U){const Q=L.length!==0||k||u!==0||h;return h=k,l=B(L,U,0),u=L.length,Q},this.beginShadows=function(){g=!0,B(null)},this.endShadows=function(){g=!1,S()},this.setState=function(L,k,U){const Q=L.clippingPlanes,F=L.clipIntersection,H=L.clipShadows,W=b.get(L);if(!h||Q===null||Q.length===0||g&&!H)g?B(null):S();else{const q=g?0:u,$=4*q;let ie=W.clippingState||null;C.value=ie,ie=B(Q,k,$,U);for(let se=0;se!==$;++se)ie[se]=l[se];W.clippingState=ie,this.numIntersection=F?this.numPlanes:0,this.numPlanes+=q}}}function fw(b){let i=new WeakMap;function l(h,g){return g===zr?h.mapping=vr:g===Qi&&(h.mapping=Wi),h}function u(h){const g=h.target;g.removeEventListener("dispose",u);const _=i.get(g);_!==void 0&&(i.delete(g),_.dispose())}return{get:function(h){if(h&&h.isTexture&&h.isRenderTargetTexture===!1){const g=h.mapping;if(g===zr||g===Qi){if(i.has(h)){const _=i.get(h).texture;return _.rotation=h.rotation,l(_,h.mapping)}{const _=h.image;if(_&&_.height>0){const y=new j_(_.height/2);return y.fromEquirectangularTexture(b,h),y.texture.rotation=h.rotation,i.set(h,y),h.addEventListener("dispose",u),l(y.texture,h.mapping)}return null}}}return h},dispose:function(){i=new WeakMap}}}Uo.physical={uniforms:Ks([Uo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Lt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new mn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Lt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new mn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new mn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ii.meshphysical_vert,fragmentShader:ii.meshphysical_frag};class Pm extends Ld{constructor(i=-1,l=1,u=1,h=-1,g=.1,_=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=l,this.top=u,this.bottom=h,this.near=g,this.far=_,this.updateProjectionMatrix()}copy(i,l){return super.copy(i,l),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:Object.assign({},i.view),this}setViewOffset(i,l,u,h,g,_){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=l,this.view.offsetX=u,this.view.offsetY=h,this.view.width=g,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),u=(this.right+this.left)/2,h=(this.top+this.bottom)/2;let g=u-i,_=u+i,y=h+l,C=h-l;if(this.view!==null&&this.view.enabled){const S=(this.right-this.left)/this.view.fullWidth/this.zoom,B=(this.top-this.bottom)/this.view.fullHeight/this.zoom;g+=S*this.view.offsetX,_=g+S*this.view.width,y-=B*this.view.offsetY,C=y-B*this.view.height}this.projectionMatrix.makeOrthographic(g,_,y,C,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const l=super.toJSON(i);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,this.view!==null&&(l.object.view=Object.assign({},this.view)),l}}const V_=[.125,.215,.35,.446,.526,.582],Rm=new Pm,Bm=new mn;let km=null;const Hl=(1+Math.sqrt(5))/2,kh=1/Hl,Fv=[new he(1,1,1),new he(-1,1,1),new he(1,1,-1),new he(-1,1,-1),new he(0,Hl,kh),new he(0,Hl,-kh),new he(kh,0,Hl),new he(-kh,0,Hl),new he(Hl,kh,0),new he(-Hl,kh,0)];class Om{constructor(i){this._renderer=i,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(i,l=0,u=.1,h=100){km=this._renderer.getRenderTarget(),this._setSize(256);const g=this._allocateTargets();return g.depthBuffer=!0,this._sceneToCubeUV(i,u,h,g),l>0&&this._blur(g,0,0,l),this._applyPMREM(g),this._cleanup(g),g}fromEquirectangular(i,l=null){return this._fromTexture(i,l)}fromCubemap(i,l=null){return this._fromTexture(i,l)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=jv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Lm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(i){this._lodMax=Math.floor(Math.log2(i)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let i=0;i<this._lodPlanes.length;i++)this._lodPlanes[i].dispose()}_cleanup(i){this._renderer.setRenderTarget(km),i.scissorTest=!1,si(i,0,0,i.width,i.height)}_fromTexture(i,l){i.mapping===vr||i.mapping===Wi?this._setSize(i.image.length===0?16:i.image[0].width||i.image[0].image.width):this._setSize(i.image.width/4),km=this._renderer.getRenderTarget();const u=l||this._allocateTargets();return this._textureToCubeUV(i,u),this._applyPMREM(u),this._cleanup(u),u}_allocateTargets(){const i=3*Math.max(this._cubeSize,112),l=4*this._cubeSize,u={magFilter:ur,minFilter:ur,generateMipmaps:!1,type:ya,format:Hs,encoding:Jo,depthBuffer:!1},h=G_(i,l,u);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=G_(i,l,u);const{_lodMax:g}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(_){const y=[],C=[],S=[];let B=_;const L=_-4+1+V_.length;for(let k=0;k<L;k++){const U=Math.pow(2,B);C.push(U);let Q=1/U;k>_-4?Q=V_[k-_+4-1]:k===0&&(Q=0),S.push(Q);const F=1/(U-2),H=-F,W=1+F,q=[H,H,W,H,W,W,H,H,W,W,H,W],$=6,ie=6,se=3,le=2,Ie=1,De=new Float32Array(se*ie*$),Xe=new Float32Array(le*ie*$),Ke=new Float32Array(Ie*ie*$);for(let St=0;St<$;St++){const Ft=St%3*2/3-1,Et=St>2?0:-1,nn=[Ft,Et,0,Ft+2/3,Et,0,Ft+2/3,Et+1,0,Ft,Et,0,Ft+2/3,Et+1,0,Ft,Et+1,0];De.set(nn,se*ie*St),Xe.set(q,le*ie*St);const rn=[St,St,St,St,St,St];Ke.set(rn,Ie*ie*St)}const Be=new wn;Be.setAttribute("position",new ji(De,se)),Be.setAttribute("uv",new ji(Xe,le)),Be.setAttribute("faceIndex",new ji(Ke,Ie)),y.push(Be),B>4&&B--}return{lodPlanes:y,sizeLods:C,sigmas:S}}(g)),this._blurMaterial=function(_,y,C){const S=new Float32Array(20),B=new he(0,1,0);return new rl({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/y,CUBEUV_TEXEL_HEIGHT:1/C,CUBEUV_MAX_MIP:`${_}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:S},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:B}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ue,depthTest:!1,depthWrite:!1})}(g,i,l)}return h}_compileMaterial(i){const l=new os(this._lodPlanes[0],i);this._renderer.compile(l,Rm)}_sceneToCubeUV(i,l,u,h){const g=new ws(90,1,l,u),_=[1,-1,1,1,1,1],y=[1,1,1,-1,-1,-1],C=this._renderer,S=C.autoClear,B=C.toneMapping;C.getClearColor(Bm),C.toneMapping=pi,C.autoClear=!1;const L=new Sa({name:"PMREM.Background",side:me,depthWrite:!1,depthTest:!1}),k=new os(new Ma,L);let U=!1;const Q=i.background;Q?Q.isColor&&(L.color.copy(Q),i.background=null,U=!0):(L.color.copy(Bm),U=!0);for(let F=0;F<6;F++){const H=F%3;H===0?(g.up.set(0,_[F],0),g.lookAt(y[F],0,0)):H===1?(g.up.set(0,0,_[F]),g.lookAt(0,y[F],0)):(g.up.set(0,_[F],0),g.lookAt(0,0,y[F]));const W=this._cubeSize;si(h,H*W,F>2?W:0,W,W),C.setRenderTarget(h),U&&C.render(k,g),C.render(i,g)}k.geometry.dispose(),k.material.dispose(),C.toneMapping=B,C.autoClear=S,i.background=Q}_textureToCubeUV(i,l){const u=this._renderer,h=i.mapping===vr||i.mapping===Wi;h?(this._cubemapMaterial===null&&(this._cubemapMaterial=jv()),this._cubemapMaterial.uniforms.flipEnvMap.value=i.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Lm());const g=h?this._cubemapMaterial:this._equirectMaterial,_=new os(this._lodPlanes[0],g);g.uniforms.envMap.value=i;const y=this._cubeSize;si(l,0,0,3*y,2*y),u.setRenderTarget(l),u.render(_,Rm)}_applyPMREM(i){const l=this._renderer,u=l.autoClear;l.autoClear=!1;for(let h=1;h<this._lodPlanes.length;h++){const g=Math.sqrt(this._sigmas[h]*this._sigmas[h]-this._sigmas[h-1]*this._sigmas[h-1]),_=Fv[(h-1)%Fv.length];this._blur(i,h-1,h,g,_)}l.autoClear=u}_blur(i,l,u,h,g){const _=this._pingPongRenderTarget;this._halfBlur(i,_,l,u,h,"latitudinal",g),this._halfBlur(_,i,u,u,h,"longitudinal",g)}_halfBlur(i,l,u,h,g,_,y){const C=this._renderer,S=this._blurMaterial;_!=="latitudinal"&&_!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const B=new os(this._lodPlanes[h],S),L=S.uniforms,k=this._sizeLods[u]-1,U=isFinite(g)?Math.PI/(2*k):2*Math.PI/39,Q=g/U,F=isFinite(g)?1+Math.floor(3*Q):20;F>20&&console.warn(`sigmaRadians, ${g}, is too large and will clip, as it requested ${F} samples when the maximum is set to 20`);const H=[];let W=0;for(let ie=0;ie<20;++ie){const se=ie/Q,le=Math.exp(-se*se/2);H.push(le),ie===0?W+=le:ie<F&&(W+=2*le)}for(let ie=0;ie<H.length;ie++)H[ie]=H[ie]/W;L.envMap.value=i.texture,L.samples.value=F,L.weights.value=H,L.latitudinal.value=_==="latitudinal",y&&(L.poleAxis.value=y);const{_lodMax:q}=this;L.dTheta.value=U,L.mipInt.value=q-u;const $=this._sizeLods[h];si(l,3*$*(h>q-4?h-q+4:0),4*(this._cubeSize-$),3*$,2*$),C.setRenderTarget(l),C.render(B,Rm)}}function G_(b,i,l){const u=new qs(b,i,l);return u.texture.mapping=Vs,u.texture.name="PMREM.cubeUv",u.scissorTest=!0,u}function si(b,i,l,u,h){b.viewport.set(i,l,u,h),b.scissor.set(i,l,u,h)}function Lm(){return new rl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ue,depthTest:!1,depthWrite:!1})}function jv(){return new rl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ue,depthTest:!1,depthWrite:!1})}function H_(b){let i=new WeakMap,l=null;function u(h){const g=h.target;g.removeEventListener("dispose",u);const _=i.get(g);_!==void 0&&(i.delete(g),_.dispose())}return{get:function(h){if(h&&h.isTexture){const g=h.mapping,_=g===zr||g===Qi,y=g===vr||g===Wi;if(_||y){if(h.isRenderTargetTexture&&h.needsPMREMUpdate===!0){h.needsPMREMUpdate=!1;let C=i.get(h);return l===null&&(l=new Om(b)),C=_?l.fromEquirectangular(h,C):l.fromCubemap(h,C),i.set(h,C),C.texture}if(i.has(h))return i.get(h).texture;{const C=h.image;if(_&&C&&C.height>0||y&&C&&function(S){let B=0;for(let L=0;L<6;L++)S[L]!==void 0&&B++;return B===6}(C)){l===null&&(l=new Om(b));const S=_?l.fromEquirectangular(h):l.fromCubemap(h);return i.set(h,S),h.addEventListener("dispose",u),S.texture}return null}}}return h},dispose:function(){i=new WeakMap,l!==null&&(l.dispose(),l=null)}}}function ln(b){const i={};function l(u){if(i[u]!==void 0)return i[u];let h;switch(u){case"WEBGL_depth_texture":h=b.getExtension("WEBGL_depth_texture")||b.getExtension("MOZ_WEBGL_depth_texture")||b.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":h=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":h=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":h=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:h=b.getExtension(u)}return i[u]=h,h}return{has:function(u){return l(u)!==null},init:function(u){u.isWebGL2?l("EXT_color_buffer_float"):(l("WEBGL_depth_texture"),l("OES_texture_float"),l("OES_texture_half_float"),l("OES_texture_half_float_linear"),l("OES_standard_derivatives"),l("OES_element_index_uint"),l("OES_vertex_array_object"),l("ANGLE_instanced_arrays")),l("OES_texture_float_linear"),l("EXT_color_buffer_half_float"),l("WEBGL_multisampled_render_to_texture")},get:function(u){const h=l(u);return h===null&&console.warn("THREE.WebGLRenderer: "+u+" extension not supported."),h}}}function Zn(b,i,l,u){const h={},g=new WeakMap;function _(C){const S=C.target;S.index!==null&&i.remove(S.index);for(const L in S.attributes)i.remove(S.attributes[L]);S.removeEventListener("dispose",_),delete h[S.id];const B=g.get(S);B&&(i.remove(B),g.delete(S)),u.releaseStatesOfGeometry(S),S.isInstancedBufferGeometry===!0&&delete S._maxInstanceCount,l.memory.geometries--}function y(C){const S=[],B=C.index,L=C.attributes.position;let k=0;if(B!==null){const F=B.array;k=B.version;for(let H=0,W=F.length;H<W;H+=3){const q=F[H+0],$=F[H+1],ie=F[H+2];S.push(q,$,$,ie,ie,q)}}else{const F=L.array;k=L.version;for(let H=0,W=F.length/3-1;H<W;H+=3){const q=H+0,$=H+1,ie=H+2;S.push(q,$,$,ie,ie,q)}}const U=new(Sm(S)?D:fr)(S,1);U.version=k;const Q=g.get(C);Q&&i.remove(Q),g.set(C,U)}return{get:function(C,S){return h[S.id]===!0||(S.addEventListener("dispose",_),h[S.id]=!0,l.memory.geometries++),S},update:function(C){const S=C.attributes;for(const L in S)i.update(S[L],34962);const B=C.morphAttributes;for(const L in B){const k=B[L];for(let U=0,Q=k.length;U<Q;U++)i.update(k[U],34962)}},getWireframeAttribute:function(C){const S=g.get(C);if(S){const B=C.index;B!==null&&S.version<B.version&&y(C)}else y(C);return g.get(C)}}}function Fd(b,i,l,u){const h=u.isWebGL2;let g,_,y;this.setMode=function(C){g=C},this.setIndex=function(C){_=C.type,y=C.bytesPerElement},this.render=function(C,S){b.drawElements(g,S,_,C*y),l.update(S,g,1)},this.renderInstances=function(C,S,B){if(B===0)return;let L,k;if(h)L=b,k="drawElementsInstanced";else if(L=i.get("ANGLE_instanced_arrays"),k="drawElementsInstancedANGLE",L===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");L[k](g,S,_,C*y,B),l.update(S,g,B)}}function sl(b){const i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(l,u,h){switch(i.calls++,u){case 4:i.triangles+=h*(l/3);break;case 1:i.lines+=h*(l/2);break;case 3:i.lines+=h*(l-1);break;case 2:i.lines+=h*l;break;case 0:i.points+=h*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",u)}}}}function zv(b,i){return b[0]-i[0]}function Qv(b,i){return Math.abs(i[1])-Math.abs(b[1])}function W_(b,i,l){const u={},h=new Float32Array(8),g=new WeakMap,_=new Ti,y=[];for(let C=0;C<8;C++)y[C]=[C,0];return{update:function(C,S,B,L){const k=C.morphTargetInfluences;if(i.isWebGL2===!0){const U=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,Q=U!==void 0?U.length:0;let F=g.get(S);if(F===void 0||F.count!==Q){F!==void 0&&F.texture.dispose();const q=S.morphAttributes.position!==void 0,$=S.morphAttributes.normal!==void 0,ie=S.morphAttributes.color!==void 0,se=S.morphAttributes.position||[],le=S.morphAttributes.normal||[],Ie=S.morphAttributes.color||[];let De=0;q===!0&&(De=1),$===!0&&(De=2),ie===!0&&(De=3);let Xe=S.attributes.position.count*De,Ke=1;Xe>i.maxTextureSize&&(Ke=Math.ceil(Xe/i.maxTextureSize),Xe=i.maxTextureSize);const Be=new Float32Array(Xe*Ke*4*Q),St=new bu(Be,Xe,Ke,Q);St.type=Qr,St.needsUpdate=!0;const Ft=4*De;for(let Et=0;Et<Q;Et++){const nn=se[Et],rn=le[Et],dt=Ie[Et],At=Xe*Ke*4*Et;for(let Wt=0;Wt<nn.count;Wt++){const Mt=Wt*Ft;q===!0&&(_.fromBufferAttribute(nn,Wt),Be[At+Mt+0]=_.x,Be[At+Mt+1]=_.y,Be[At+Mt+2]=_.z,Be[At+Mt+3]=0),$===!0&&(_.fromBufferAttribute(rn,Wt),Be[At+Mt+4]=_.x,Be[At+Mt+5]=_.y,Be[At+Mt+6]=_.z,Be[At+Mt+7]=0),ie===!0&&(_.fromBufferAttribute(dt,Wt),Be[At+Mt+8]=_.x,Be[At+Mt+9]=_.y,Be[At+Mt+10]=_.z,Be[At+Mt+11]=dt.itemSize===4?_.w:1)}}F={count:Q,texture:St,size:new Lt(Xe,Ke)},g.set(S,F),S.addEventListener("dispose",function Et(){St.dispose(),g.delete(S),S.removeEventListener("dispose",Et)})}let H=0;for(let q=0;q<k.length;q++)H+=k[q];const W=S.morphTargetsRelative?1:1-H;L.getUniforms().setValue(b,"morphTargetBaseInfluence",W),L.getUniforms().setValue(b,"morphTargetInfluences",k),L.getUniforms().setValue(b,"morphTargetsTexture",F.texture,l),L.getUniforms().setValue(b,"morphTargetsTextureSize",F.size)}else{const U=k===void 0?0:k.length;let Q=u[S.id];if(Q===void 0||Q.length!==U){Q=[];for(let $=0;$<U;$++)Q[$]=[$,0];u[S.id]=Q}for(let $=0;$<U;$++){const ie=Q[$];ie[0]=$,ie[1]=k[$]}Q.sort(Qv);for(let $=0;$<8;$++)$<U&&Q[$][1]?(y[$][0]=Q[$][0],y[$][1]=Q[$][1]):(y[$][0]=Number.MAX_SAFE_INTEGER,y[$][1]=0);y.sort(zv);const F=S.morphAttributes.position,H=S.morphAttributes.normal;let W=0;for(let $=0;$<8;$++){const ie=y[$],se=ie[0],le=ie[1];se!==Number.MAX_SAFE_INTEGER&&le?(F&&S.getAttribute("morphTarget"+$)!==F[se]&&S.setAttribute("morphTarget"+$,F[se]),H&&S.getAttribute("morphNormal"+$)!==H[se]&&S.setAttribute("morphNormal"+$,H[se]),h[$]=le,W+=le):(F&&S.hasAttribute("morphTarget"+$)===!0&&S.deleteAttribute("morphTarget"+$),H&&S.hasAttribute("morphNormal"+$)===!0&&S.deleteAttribute("morphNormal"+$),h[$]=0)}const q=S.morphTargetsRelative?1:1-W;L.getUniforms().setValue(b,"morphTargetBaseInfluence",q),L.getUniforms().setValue(b,"morphTargetInfluences",h)}}}}function qi(b,i,l,u){let h=new WeakMap;function g(_){const y=_.target;y.removeEventListener("dispose",g),l.remove(y.instanceMatrix),y.instanceColor!==null&&l.remove(y.instanceColor)}return{update:function(_){const y=u.render.frame,C=_.geometry,S=i.get(_,C);return h.get(S)!==y&&(i.update(S),h.set(S,y)),_.isInstancedMesh&&(_.hasEventListener("dispose",g)===!1&&_.addEventListener("dispose",g),l.update(_.instanceMatrix,34962),_.instanceColor!==null&&l.update(_.instanceColor,34962)),S},dispose:function(){h=new WeakMap}}}const q_=new Ur,Vv=new bu,Gv=new Sc,Hv=new Nd,Y_=[],Nm=[],Wv=new Float32Array(16),Ta=new Float32Array(9),ol=new Float32Array(4);function jd(b,i,l){const u=b[0];if(u<=0||u>0)return b;const h=i*l;let g=Y_[h];if(g===void 0&&(g=new Float32Array(h),Y_[h]=g),i!==0){u.toArray(g,0);for(let _=1,y=0;_!==i;++_)y+=l,b[_].toArray(g,y)}return g}function xs(b,i){if(b.length!==i.length)return!1;for(let l=0,u=b.length;l<u;l++)if(b[l]!==i[l])return!1;return!0}function Mr(b,i){for(let l=0,u=i.length;l<u;l++)b[l]=i[l]}function Gp(b,i){let l=Nm[i];l===void 0&&(l=new Int32Array(i),Nm[i]=l);for(let u=0;u!==i;++u)l[u]=b.allocateTextureUnit();return l}function Hp(b,i){const l=this.cache;l[0]!==i&&(b.uniform1f(this.addr,i),l[0]=i)}function qv(b,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y||(b.uniform2f(this.addr,i.x,i.y),l[0]=i.x,l[1]=i.y);else{if(xs(l,i))return;b.uniform2fv(this.addr,i),Mr(l,i)}}function Wp(b,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y&&l[2]===i.z||(b.uniform3f(this.addr,i.x,i.y,i.z),l[0]=i.x,l[1]=i.y,l[2]=i.z);else if(i.r!==void 0)l[0]===i.r&&l[1]===i.g&&l[2]===i.b||(b.uniform3f(this.addr,i.r,i.g,i.b),l[0]=i.r,l[1]=i.g,l[2]=i.b);else{if(xs(l,i))return;b.uniform3fv(this.addr,i),Mr(l,i)}}function X_(b,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y&&l[2]===i.z&&l[3]===i.w||(b.uniform4f(this.addr,i.x,i.y,i.z,i.w),l[0]=i.x,l[1]=i.y,l[2]=i.z,l[3]=i.w);else{if(xs(l,i))return;b.uniform4fv(this.addr,i),Mr(l,i)}}function Yv(b,i){const l=this.cache,u=i.elements;if(u===void 0){if(xs(l,i))return;b.uniformMatrix2fv(this.addr,!1,i),Mr(l,i)}else{if(xs(l,u))return;ol.set(u),b.uniformMatrix2fv(this.addr,!1,ol),Mr(l,u)}}function ks(b,i){const l=this.cache,u=i.elements;if(u===void 0){if(xs(l,i))return;b.uniformMatrix3fv(this.addr,!1,i),Mr(l,i)}else{if(xs(l,u))return;Ta.set(u),b.uniformMatrix3fv(this.addr,!1,Ta),Mr(l,u)}}function al(b,i){const l=this.cache,u=i.elements;if(u===void 0){if(xs(l,i))return;b.uniformMatrix4fv(this.addr,!1,i),Mr(l,i)}else{if(xs(l,u))return;Wv.set(u),b.uniformMatrix4fv(this.addr,!1,Wv),Mr(l,u)}}function qp(b,i){const l=this.cache;l[0]!==i&&(b.uniform1i(this.addr,i),l[0]=i)}function Um(b,i){const l=this.cache;xs(l,i)||(b.uniform2iv(this.addr,i),Mr(l,i))}function ll(b,i){const l=this.cache;xs(l,i)||(b.uniform3iv(this.addr,i),Mr(l,i))}function Xv(b,i){const l=this.cache;xs(l,i)||(b.uniform4iv(this.addr,i),Mr(l,i))}function Fm(b,i){const l=this.cache;l[0]!==i&&(b.uniform1ui(this.addr,i),l[0]=i)}function K_(b,i){const l=this.cache;xs(l,i)||(b.uniform2uiv(this.addr,i),Mr(l,i))}function jm(b,i){const l=this.cache;xs(l,i)||(b.uniform3uiv(this.addr,i),Mr(l,i))}function cl(b,i){const l=this.cache;xs(l,i)||(b.uniform4uiv(this.addr,i),Mr(l,i))}function ra(b,i,l){const u=this.cache,h=l.allocateTextureUnit();u[0]!==h&&(b.uniform1i(this.addr,h),u[0]=h),l.setTexture2D(i||q_,h)}function zm(b,i,l){const u=this.cache,h=l.allocateTextureUnit();u[0]!==h&&(b.uniform1i(this.addr,h),u[0]=h),l.setTexture3D(i||Gv,h)}function J_(b,i,l){const u=this.cache,h=l.allocateTextureUnit();u[0]!==h&&(b.uniform1i(this.addr,h),u[0]=h),l.setTextureCube(i||Hv,h)}function Qm(b,i,l){const u=this.cache,h=l.allocateTextureUnit();u[0]!==h&&(b.uniform1i(this.addr,h),u[0]=h),l.setTexture2DArray(i||Vv,h)}function Z_(b,i){b.uniform1fv(this.addr,i)}function Kv(b,i){const l=jd(i,this.size,2);b.uniform2fv(this.addr,l)}function Vm(b,i){const l=jd(i,this.size,3);b.uniform3fv(this.addr,l)}function $_(b,i){const l=jd(i,this.size,4);b.uniform4fv(this.addr,l)}function eA(b,i){const l=jd(i,this.size,4);b.uniformMatrix2fv(this.addr,!1,l)}function mw(b,i){const l=jd(i,this.size,9);b.uniformMatrix3fv(this.addr,!1,l)}function tA(b,i){const l=jd(i,this.size,16);b.uniformMatrix4fv(this.addr,!1,l)}function nA(b,i){b.uniform1iv(this.addr,i)}function iA(b,i){b.uniform2iv(this.addr,i)}function Fo(b,i){b.uniform3iv(this.addr,i)}function er(b,i){b.uniform4iv(this.addr,i)}function rA(b,i){b.uniform1uiv(this.addr,i)}function Oh(b,i){b.uniform2uiv(this.addr,i)}function jo(b,i){b.uniform3uiv(this.addr,i)}function ku(b,i){b.uniform4uiv(this.addr,i)}function wr(b,i,l){const u=i.length,h=Gp(l,u);b.uniform1iv(this.addr,h);for(let g=0;g!==u;++g)l.setTexture2D(i[g]||q_,h[g])}function sA(b,i,l){const u=i.length,h=Gp(l,u);b.uniform1iv(this.addr,h);for(let g=0;g!==u;++g)l.setTexture3D(i[g]||Gv,h[g])}function Jv(b,i,l){const u=i.length,h=Gp(l,u);b.uniform1iv(this.addr,h);for(let g=0;g!==u;++g)l.setTextureCube(i[g]||Hv,h[g])}function oA(b,i,l){const u=i.length,h=Gp(l,u);b.uniform1iv(this.addr,h);for(let g=0;g!==u;++g)l.setTexture2DArray(i[g]||Vv,h[g])}class aA{constructor(i,l,u){this.id=i,this.addr=u,this.cache=[],this.setValue=function(h){switch(h){case 5126:return Hp;case 35664:return qv;case 35665:return Wp;case 35666:return X_;case 35674:return Yv;case 35675:return ks;case 35676:return al;case 5124:case 35670:return qp;case 35667:case 35671:return Um;case 35668:case 35672:return ll;case 35669:case 35673:return Xv;case 5125:return Fm;case 36294:return K_;case 36295:return jm;case 36296:return cl;case 35678:case 36198:case 36298:case 36306:case 35682:return ra;case 35679:case 36299:case 36307:return zm;case 35680:case 36300:case 36308:case 36293:return J_;case 36289:case 36303:case 36311:case 36292:return Qm}}(l.type)}}class lA{constructor(i,l,u){this.id=i,this.addr=u,this.cache=[],this.size=l.size,this.setValue=function(h){switch(h){case 5126:return Z_;case 35664:return Kv;case 35665:return Vm;case 35666:return $_;case 35674:return eA;case 35675:return mw;case 35676:return tA;case 5124:case 35670:return nA;case 35667:case 35671:return iA;case 35668:case 35672:return Fo;case 35669:case 35673:return er;case 5125:return rA;case 36294:return Oh;case 36295:return jo;case 36296:return ku;case 35678:case 36198:case 36298:case 36306:case 35682:return wr;case 35679:case 36299:case 36307:return sA;case 35680:case 36300:case 36308:case 36293:return Jv;case 36289:case 36303:case 36311:case 36292:return oA}}(l.type)}}class gw{constructor(i){this.id=i,this.seq=[],this.map={}}setValue(i,l,u){const h=this.seq;for(let g=0,_=h.length;g!==_;++g){const y=h[g];y.setValue(i,l[y.id],u)}}}const Zv=/(\w+)(\])?(\[|\.)?/g;function cA(b,i){b.seq.push(i),b.map[i.id]=i}function vw(b,i,l){const u=b.name,h=u.length;for(Zv.lastIndex=0;;){const g=Zv.exec(u),_=Zv.lastIndex;let y=g[1];const C=g[2]==="]",S=g[3];if(C&&(y|=0),S===void 0||S==="["&&_+2===h){cA(l,S===void 0?new aA(y,b,i):new lA(y,b,i));break}{let B=l.map[y];B===void 0&&(B=new gw(y),cA(l,B)),l=B}}}class Gm{constructor(i,l){this.seq=[],this.map={};const u=i.getProgramParameter(l,35718);for(let h=0;h<u;++h){const g=i.getActiveUniform(l,h);vw(g,i.getUniformLocation(l,g.name),this)}}setValue(i,l,u,h){const g=this.map[l];g!==void 0&&g.setValue(i,u,h)}setOptional(i,l,u){const h=l[u];h!==void 0&&this.setValue(i,u,h)}static upload(i,l,u,h){for(let g=0,_=l.length;g!==_;++g){const y=l[g],C=u[y.id];C.needsUpdate!==!1&&y.setValue(i,C.value,h)}}static seqWithValue(i,l){const u=[];for(let h=0,g=i.length;h!==g;++h){const _=i[h];_.id in l&&u.push(_)}return u}}function uA(b,i,l){const u=b.createShader(i);return b.shaderSource(u,l),b.compileShader(u),u}let $v=0;function Yp(b){switch(b){case Jo:return["Linear","( value )"];case ui:return["sRGB","( value )"];case vc:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",b),["Linear","( value )"]}}function tr(b,i,l){const u=b.getShaderParameter(i,35713),h=b.getShaderInfoLog(i).trim();if(u&&h==="")return"";const g=/ERROR: 0:(\d+)/.exec(h);if(g){const _=parseInt(g[1]);return l.toUpperCase()+`

`+h+`

`+function(y,C){const S=y.split(`
`),B=[],L=Math.max(C-6,0),k=Math.min(C+6,S.length);for(let U=L;U<k;U++){const Q=U+1;B.push(`${Q===C?">":" "} ${Q}: ${S[U]}`)}return B.join(`
`)}(b.getShaderSource(i),_)}return h}function hA(b,i){const l=Yp(i);return"vec4 "+b+"( vec4 value ) { return "+l[0]+"ToLinear"+l[1]+"; }"}function dA(b,i){const l=Yp(i);return"vec4 "+b+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"}function Hm(b,i){let l;switch(i){case Xi:l="Linear";break;case fi:l="Reinhard";break;case ar:l="OptimizedCineon";break;case ki:l="ACESFilmic";break;case Qs:l="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),l="Linear"}return"vec3 "+b+"( vec3 color ) { return "+l+"ToneMapping( color ); }"}function Ou(b){return b!==""}function ul(b,i){const l=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return b.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,l).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function e0(b,i){return b.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}const Xp=/^[ \t]*#include +<([\w\d./]+)>/gm;function Oc(b){return b.replace(Xp,Kp)}function Kp(b,i){const l=ii[i];if(l===void 0)throw new Error("Can not resolve #include <"+i+">");return Oc(l)}const Wm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zd(b){return b.replace(Wm,Jp)}function Jp(b,i,l,u){let h="";for(let g=parseInt(i);g<parseInt(l);g++)h+=u.replace(/\[\s*i\s*\]/g,"[ "+g+" ]").replace(/UNROLLED_LOOP_INDEX/g,g);return h}function pA(b){let i="precision "+b.precision+` float;
precision `+b.precision+" int;";return b.precision==="highp"?i+=`
#define HIGH_PRECISION`:b.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:b.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}function _w(b,i,l,u){const h=b.getContext(),g=l.defines;let _=l.vertexShader,y=l.fragmentShader;const C=function(De){let Xe="SHADOWMAP_TYPE_BASIC";return De.shadowMapType===Je?Xe="SHADOWMAP_TYPE_PCF":De.shadowMapType===Ye?Xe="SHADOWMAP_TYPE_PCF_SOFT":De.shadowMapType===Qe&&(Xe="SHADOWMAP_TYPE_VSM"),Xe}(l),S=function(De){let Xe="ENVMAP_TYPE_CUBE";if(De.envMap)switch(De.envMapMode){case vr:case Wi:Xe="ENVMAP_TYPE_CUBE";break;case Vs:Xe="ENVMAP_TYPE_CUBE_UV"}return Xe}(l),B=function(De){let Xe="ENVMAP_MODE_REFLECTION";return De.envMap&&De.envMapMode===Wi&&(Xe="ENVMAP_MODE_REFRACTION"),Xe}(l),L=function(De){let Xe="ENVMAP_BLENDING_NONE";if(De.envMap)switch(De.combine){case jn:Xe="ENVMAP_BLENDING_MULTIPLY";break;case ni:Xe="ENVMAP_BLENDING_MIX";break;case Bi:Xe="ENVMAP_BLENDING_ADD"}return Xe}(l),k=function(De){const Xe=De.envMapCubeUVHeight;if(Xe===null)return null;const Ke=Math.log2(Xe)-2,Be=1/Xe;return{texelWidth:1/(3*Math.max(Math.pow(2,Ke),112)),texelHeight:Be,maxMip:Ke}}(l),U=l.isWebGL2?"":function(De){return[De.extensionDerivatives||De.envMapCubeUVHeight||De.bumpMap||De.tangentSpaceNormalMap||De.clearcoatNormalMap||De.flatShading||De.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(De.extensionFragDepth||De.logarithmicDepthBuffer)&&De.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",De.extensionDrawBuffers&&De.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(De.extensionShaderTextureLOD||De.envMap||De.transmission)&&De.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ou).join(`
`)}(l),Q=function(De){const Xe=[];for(const Ke in De){const Be=De[Ke];Be!==!1&&Xe.push("#define "+Ke+" "+Be)}return Xe.join(`
`)}(g),F=h.createProgram();let H,W,q=l.glslVersion?"#version "+l.glslVersion+`
`:"";l.isRawShaderMaterial?(H=[Q].filter(Ou).join(`
`),H.length>0&&(H+=`
`),W=[U,Q].filter(Ou).join(`
`),W.length>0&&(W+=`
`)):(H=[pA(l),"#define SHADER_NAME "+l.shaderName,Q,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+B:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularColorMap?"#define USE_SPECULARCOLORMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.sheenColorMap?"#define USE_SHEENCOLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===!1?"#define USE_MORPHNORMALS":"",l.morphColors&&l.isWebGL2?"#define USE_MORPHCOLORS":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+l.morphTextureStride:"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_COUNT "+l.morphTargetsCount:"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+C:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ou).join(`
`),W=[U,pA(l),"#define SHADER_NAME "+l.shaderName,Q,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+S:"",l.envMap?"#define "+B:"",l.envMap?"#define "+L:"",k?"#define CUBEUV_TEXEL_WIDTH "+k.texelWidth:"",k?"#define CUBEUV_TEXEL_HEIGHT "+k.texelHeight:"",k?"#define CUBEUV_MAX_MIP "+k.maxMip+".0":"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoat?"#define USE_CLEARCOAT":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescence?"#define USE_IRIDESCENCE":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularColorMap?"#define USE_SPECULARCOLORMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.alphaTest?"#define USE_ALPHATEST":"",l.sheen?"#define USE_SHEEN":"",l.sheenColorMap?"#define USE_SHEENCOLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors||l.instancingColor?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+C:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==pi?"#define TONE_MAPPING":"",l.toneMapping!==pi?ii.tonemapping_pars_fragment:"",l.toneMapping!==pi?Hm("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.opaque?"#define OPAQUE":"",ii.encodings_pars_fragment,dA("linearToOutputTexel",l.outputEncoding),l.transmissionSamplerMapEncoding?hA("transmissionSamplerMapTexelToLinear",l.transmissionSamplerMapEncoding):"",l.useDepthPacking?"#define DEPTH_PACKING "+l.depthPacking:"",`
`].filter(Ou).join(`
`)),_=Oc(_),_=ul(_,l),_=e0(_,l),y=Oc(y),y=ul(y,l),y=e0(y,l),_=zd(_),y=zd(y),l.isWebGL2&&l.isRawShaderMaterial!==!0&&(q=`#version 300 es
`,H=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+H,W=["#define varying in",l.glslVersion===Ja?"":"layout(location = 0) out highp vec4 pc_fragColor;",l.glslVersion===Ja?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+W);const $=q+W+y,ie=uA(h,35633,q+H+_),se=uA(h,35632,$);if(h.attachShader(F,ie),h.attachShader(F,se),l.index0AttributeName!==void 0?h.bindAttribLocation(F,0,l.index0AttributeName):l.morphTargets===!0&&h.bindAttribLocation(F,0,"position"),h.linkProgram(F),b.debug.checkShaderErrors){const De=h.getProgramInfoLog(F).trim(),Xe=h.getShaderInfoLog(ie).trim(),Ke=h.getShaderInfoLog(se).trim();let Be=!0,St=!0;if(h.getProgramParameter(F,35714)===!1){Be=!1;const Ft=tr(h,ie,"vertex"),Et=tr(h,se,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(F,35715)+`

Program Info Log: `+De+`
`+Ft+`
`+Et)}else De!==""?console.warn("THREE.WebGLProgram: Program Info Log:",De):Xe!==""&&Ke!==""||(St=!1);St&&(this.diagnostics={runnable:Be,programLog:De,vertexShader:{log:Xe,prefix:H},fragmentShader:{log:Ke,prefix:W}})}let le,Ie;return h.deleteShader(ie),h.deleteShader(se),this.getUniforms=function(){return le===void 0&&(le=new Gm(h,F)),le},this.getAttributes=function(){return Ie===void 0&&(Ie=function(De,Xe){const Ke={},Be=De.getProgramParameter(Xe,35721);for(let St=0;St<Be;St++){const Ft=De.getActiveAttrib(Xe,St),Et=Ft.name;let nn=1;Ft.type===35674&&(nn=2),Ft.type===35675&&(nn=3),Ft.type===35676&&(nn=4),Ke[Et]={type:Ft.type,location:De.getAttribLocation(Xe,Et),locationSize:nn}}return Ke}(h,F)),Ie},this.destroy=function(){u.releaseStatesOfProgram(this),h.deleteProgram(F),this.program=void 0},this.name=l.shaderName,this.id=$v++,this.cacheKey=i,this.usedTimes=1,this.program=F,this.vertexShader=ie,this.fragmentShader=se,this}let fA=0;class qm{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(i){const l=i.vertexShader,u=i.fragmentShader,h=this._getShaderStage(l),g=this._getShaderStage(u),_=this._getShaderCacheForMaterial(i);return _.has(h)===!1&&(_.add(h),h.usedTimes++),_.has(g)===!1&&(_.add(g),g.usedTimes++),this}remove(i){const l=this.materialCache.get(i);for(const u of l)u.usedTimes--,u.usedTimes===0&&this.shaderCache.delete(u.code);return this.materialCache.delete(i),this}getVertexShaderID(i){return this._getShaderStage(i.vertexShader).id}getFragmentShaderID(i){return this._getShaderStage(i.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(i){const l=this.materialCache;let u=l.get(i);return u===void 0&&(u=new Set,l.set(i,u)),u}_getShaderStage(i){const l=this.shaderCache;let u=l.get(i);return u===void 0&&(u=new mA(i),l.set(i,u)),u}}class mA{constructor(i){this.id=fA++,this.code=i,this.usedTimes=0}}function Aw(b,i,l,u,h,g,_){const y=new Ps,C=new qm,S=[],B=h.isWebGL2,L=h.logarithmicDepthBuffer,k=h.vertexTextures;let U=h.precision;const Q={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(F,H,W,q,$){const ie=q.fog,se=$.geometry,le=F.isMeshStandardMaterial?q.environment:null,Ie=(F.isMeshStandardMaterial?l:i).get(F.envMap||le),De=Ie&&Ie.mapping===Vs?Ie.image.height:null,Xe=Q[F.type];F.precision!==null&&(U=h.getMaxPrecision(F.precision),U!==F.precision&&console.warn("THREE.WebGLProgram.getParameters:",F.precision,"not supported, using",U,"instead."));const Ke=se.morphAttributes.position||se.morphAttributes.normal||se.morphAttributes.color,Be=Ke!==void 0?Ke.length:0;let St,Ft,Et,nn,rn=0;if(se.morphAttributes.position!==void 0&&(rn=1),se.morphAttributes.normal!==void 0&&(rn=2),se.morphAttributes.color!==void 0&&(rn=3),Xe){const In=Uo[Xe];St=In.vertexShader,Ft=In.fragmentShader}else St=F.vertexShader,Ft=F.fragmentShader,C.update(F),Et=C.getVertexShaderID(F),nn=C.getFragmentShaderID(F);const dt=b.getRenderTarget(),At=b.userData&&b.userData.transmissionRenderTarget,Wt=F.alphaTest>0,Mt=F.clearcoat>0,en=F.iridescence>0;return{isWebGL2:B,shaderID:Xe,shaderName:F.type,vertexShader:St,fragmentShader:Ft,defines:F.defines,customVertexShaderID:Et,customFragmentShaderID:nn,isRawShaderMaterial:F.isRawShaderMaterial===!0,glslVersion:F.glslVersion,precision:U,instancing:$.isInstancedMesh===!0,instancingColor:$.isInstancedMesh===!0&&$.instanceColor!==null,supportsVertexTextures:k,outputEncoding:dt===null?b.outputEncoding:dt.isXRRenderTarget===!0||dt.texture.encoding!==ui?dt.texture.encoding:Jo,map:!!F.map,matcap:!!F.matcap,envMap:!!Ie,envMapMode:Ie&&Ie.mapping,envMapCubeUVHeight:De,lightMap:!!F.lightMap,aoMap:!!F.aoMap,emissiveMap:!!F.emissiveMap,bumpMap:!!F.bumpMap,normalMap:!!F.normalMap,objectSpaceNormalMap:F.normalMapType===$r,tangentSpaceNormalMap:F.normalMapType===Zr,decodeVideoTexture:!!F.map&&F.map.isVideoTexture===!0&&F.map.encoding===ui,clearcoat:Mt,clearcoatMap:Mt&&!!F.clearcoatMap,clearcoatRoughnessMap:Mt&&!!F.clearcoatRoughnessMap,clearcoatNormalMap:Mt&&!!F.clearcoatNormalMap,iridescence:en,iridescenceMap:en&&!!F.iridescenceMap,iridescenceThicknessMap:en&&!!F.iridescenceThicknessMap,displacementMap:!!F.displacementMap,roughnessMap:!!F.roughnessMap,metalnessMap:!!F.metalnessMap,specularMap:!!F.specularMap,specularIntensityMap:!!F.specularIntensityMap,specularColorMap:!!F.specularColorMap,opaque:F.transparent===!1&&F.blending===Ae&&!(F.transmission>0),alphaMap:!!F.alphaMap,alphaTest:Wt,gradientMap:!!F.gradientMap,sheen:F.sheen>0,sheenColorMap:!!F.sheenColorMap,sheenRoughnessMap:!!F.sheenRoughnessMap,transmission:F.transmission>0,transmissionMap:!!F.transmissionMap,transmissionSamplerMapEncoding:At?At.texture.encoding:Jo,thicknessMap:!!F.thicknessMap,combine:F.combine,vertexTangents:!!F.normalMap&&!!se.attributes.tangent,vertexColors:F.vertexColors,vertexAlphas:F.vertexColors===!0&&!!se.attributes.color&&se.attributes.color.itemSize===4,vertexUvs:!!(F.map||F.bumpMap||F.normalMap||F.specularMap||F.alphaMap||F.emissiveMap||F.roughnessMap||F.metalnessMap||F.clearcoatMap||F.clearcoatRoughnessMap||F.clearcoatNormalMap||F.iridescenceMap||F.iridescenceThicknessMap||F.displacementMap||F.transmissionMap||F.thicknessMap||F.specularIntensityMap||F.specularColorMap||F.sheenColorMap||F.sheenRoughnessMap),uvsVertexOnly:!(F.map||F.bumpMap||F.normalMap||F.specularMap||F.alphaMap||F.emissiveMap||F.roughnessMap||F.metalnessMap||F.clearcoatNormalMap||F.iridescenceMap||F.iridescenceThicknessMap||F.transmission>0||F.transmissionMap||F.thicknessMap||F.specularIntensityMap||F.specularColorMap||F.sheen>0||F.sheenColorMap||F.sheenRoughnessMap||!F.displacementMap),fog:!!ie,useFog:F.fog===!0,fogExp2:ie&&ie.isFogExp2,flatShading:!!F.flatShading,sizeAttenuation:F.sizeAttenuation,logarithmicDepthBuffer:L,skinning:$.isSkinnedMesh===!0,morphTargets:se.morphAttributes.position!==void 0,morphNormals:se.morphAttributes.normal!==void 0,morphColors:se.morphAttributes.color!==void 0,morphTargetsCount:Be,morphTextureStride:rn,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numSpotLightMaps:H.spotLightMap.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numDirLightShadows:H.directionalShadowMap.length,numPointLightShadows:H.pointShadowMap.length,numSpotLightShadows:H.spotShadowMap.length,numSpotLightShadowsWithMaps:H.numSpotLightShadowsWithMaps,numClippingPlanes:_.numPlanes,numClipIntersection:_.numIntersection,dithering:F.dithering,shadowMapEnabled:b.shadowMap.enabled&&W.length>0,shadowMapType:b.shadowMap.type,toneMapping:F.toneMapped?b.toneMapping:pi,physicallyCorrectLights:b.physicallyCorrectLights,premultipliedAlpha:F.premultipliedAlpha,doubleSided:F.side===Te,flipSided:F.side===me,useDepthPacking:!!F.depthPacking,depthPacking:F.depthPacking||0,index0AttributeName:F.index0AttributeName,extensionDerivatives:F.extensions&&F.extensions.derivatives,extensionFragDepth:F.extensions&&F.extensions.fragDepth,extensionDrawBuffers:F.extensions&&F.extensions.drawBuffers,extensionShaderTextureLOD:F.extensions&&F.extensions.shaderTextureLOD,rendererExtensionFragDepth:B||u.has("EXT_frag_depth"),rendererExtensionDrawBuffers:B||u.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:B||u.has("EXT_shader_texture_lod"),customProgramCacheKey:F.customProgramCacheKey()}},getProgramCacheKey:function(F){const H=[];if(F.shaderID?H.push(F.shaderID):(H.push(F.customVertexShaderID),H.push(F.customFragmentShaderID)),F.defines!==void 0)for(const W in F.defines)H.push(W),H.push(F.defines[W]);return F.isRawShaderMaterial===!1&&(function(W,q){W.push(q.precision),W.push(q.outputEncoding),W.push(q.envMapMode),W.push(q.envMapCubeUVHeight),W.push(q.combine),W.push(q.vertexUvs),W.push(q.fogExp2),W.push(q.sizeAttenuation),W.push(q.morphTargetsCount),W.push(q.morphAttributeCount),W.push(q.numDirLights),W.push(q.numPointLights),W.push(q.numSpotLights),W.push(q.numSpotLightMaps),W.push(q.numHemiLights),W.push(q.numRectAreaLights),W.push(q.numDirLightShadows),W.push(q.numPointLightShadows),W.push(q.numSpotLightShadows),W.push(q.numSpotLightShadowsWithMaps),W.push(q.shadowMapType),W.push(q.toneMapping),W.push(q.numClippingPlanes),W.push(q.numClipIntersection),W.push(q.depthPacking)}(H,F),function(W,q){y.disableAll(),q.isWebGL2&&y.enable(0),q.supportsVertexTextures&&y.enable(1),q.instancing&&y.enable(2),q.instancingColor&&y.enable(3),q.map&&y.enable(4),q.matcap&&y.enable(5),q.envMap&&y.enable(6),q.lightMap&&y.enable(7),q.aoMap&&y.enable(8),q.emissiveMap&&y.enable(9),q.bumpMap&&y.enable(10),q.normalMap&&y.enable(11),q.objectSpaceNormalMap&&y.enable(12),q.tangentSpaceNormalMap&&y.enable(13),q.clearcoat&&y.enable(14),q.clearcoatMap&&y.enable(15),q.clearcoatRoughnessMap&&y.enable(16),q.clearcoatNormalMap&&y.enable(17),q.iridescence&&y.enable(18),q.iridescenceMap&&y.enable(19),q.iridescenceThicknessMap&&y.enable(20),q.displacementMap&&y.enable(21),q.specularMap&&y.enable(22),q.roughnessMap&&y.enable(23),q.metalnessMap&&y.enable(24),q.gradientMap&&y.enable(25),q.alphaMap&&y.enable(26),q.alphaTest&&y.enable(27),q.vertexColors&&y.enable(28),q.vertexAlphas&&y.enable(29),q.vertexUvs&&y.enable(30),q.vertexTangents&&y.enable(31),q.uvsVertexOnly&&y.enable(32),W.push(y.mask),y.disableAll(),q.fog&&y.enable(0),q.useFog&&y.enable(1),q.flatShading&&y.enable(2),q.logarithmicDepthBuffer&&y.enable(3),q.skinning&&y.enable(4),q.morphTargets&&y.enable(5),q.morphNormals&&y.enable(6),q.morphColors&&y.enable(7),q.premultipliedAlpha&&y.enable(8),q.shadowMapEnabled&&y.enable(9),q.physicallyCorrectLights&&y.enable(10),q.doubleSided&&y.enable(11),q.flipSided&&y.enable(12),q.useDepthPacking&&y.enable(13),q.dithering&&y.enable(14),q.specularIntensityMap&&y.enable(15),q.specularColorMap&&y.enable(16),q.transmission&&y.enable(17),q.transmissionMap&&y.enable(18),q.thicknessMap&&y.enable(19),q.sheen&&y.enable(20),q.sheenColorMap&&y.enable(21),q.sheenRoughnessMap&&y.enable(22),q.decodeVideoTexture&&y.enable(23),q.opaque&&y.enable(24),W.push(y.mask)}(H,F),H.push(b.outputEncoding)),H.push(F.customProgramCacheKey),H.join()},getUniforms:function(F){const H=Q[F.type];let W;if(H){const q=Uo[H];W=F_.clone(q.uniforms)}else W=F.uniforms;return W},acquireProgram:function(F,H){let W;for(let q=0,$=S.length;q<$;q++){const ie=S[q];if(ie.cacheKey===H){W=ie,++W.usedTimes;break}}return W===void 0&&(W=new _w(b,H,F,g),S.push(W)),W},releaseProgram:function(F){if(--F.usedTimes==0){const H=S.indexOf(F);S[H]=S[S.length-1],S.pop(),F.destroy()}},releaseShaderCache:function(F){C.remove(F)},programs:S,dispose:function(){C.dispose()}}}function gA(){let b=new WeakMap;return{get:function(i){let l=b.get(i);return l===void 0&&(l={},b.set(i,l)),l},remove:function(i){b.delete(i)},update:function(i,l,u){b.get(i)[l]=u},dispose:function(){b=new WeakMap}}}function vA(b,i){return b.groupOrder!==i.groupOrder?b.groupOrder-i.groupOrder:b.renderOrder!==i.renderOrder?b.renderOrder-i.renderOrder:b.material.id!==i.material.id?b.material.id-i.material.id:b.z!==i.z?b.z-i.z:b.id-i.id}function t0(b,i){return b.groupOrder!==i.groupOrder?b.groupOrder-i.groupOrder:b.renderOrder!==i.renderOrder?b.renderOrder-i.renderOrder:b.z!==i.z?i.z-b.z:b.id-i.id}function _A(){const b=[];let i=0;const l=[],u=[],h=[];function g(_,y,C,S,B,L){let k=b[i];return k===void 0?(k={id:_.id,object:_,geometry:y,material:C,groupOrder:S,renderOrder:_.renderOrder,z:B,group:L},b[i]=k):(k.id=_.id,k.object=_,k.geometry=y,k.material=C,k.groupOrder=S,k.renderOrder=_.renderOrder,k.z=B,k.group=L),i++,k}return{opaque:l,transmissive:u,transparent:h,init:function(){i=0,l.length=0,u.length=0,h.length=0},push:function(_,y,C,S,B,L){const k=g(_,y,C,S,B,L);C.transmission>0?u.push(k):C.transparent===!0?h.push(k):l.push(k)},unshift:function(_,y,C,S,B,L){const k=g(_,y,C,S,B,L);C.transmission>0?u.unshift(k):C.transparent===!0?h.unshift(k):l.unshift(k)},finish:function(){for(let _=i,y=b.length;_<y;_++){const C=b[_];if(C.id===null)break;C.id=null,C.object=null,C.geometry=null,C.material=null,C.group=null}},sort:function(_,y){l.length>1&&l.sort(_||vA),u.length>1&&u.sort(y||t0),h.length>1&&h.sort(y||t0)}}}function n0(){let b=new WeakMap;return{get:function(i,l){const u=b.get(i);let h;return u===void 0?(h=new _A,b.set(i,[h])):l>=u.length?(h=new _A,u.push(h)):h=u[l],h},dispose:function(){b=new WeakMap}}}function i0(){const b={};return{get:function(i){if(b[i.id]!==void 0)return b[i.id];let l;switch(i.type){case"DirectionalLight":l={direction:new he,color:new mn};break;case"SpotLight":l={position:new he,direction:new he,color:new mn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":l={position:new he,color:new mn,distance:0,decay:0};break;case"HemisphereLight":l={direction:new he,skyColor:new mn,groundColor:new mn};break;case"RectAreaLight":l={color:new mn,position:new he,halfWidth:new he,halfHeight:new he}}return b[i.id]=l,l}}}let Zp=0;function Ym(b,i){return(i.castShadow?2:0)-(b.castShadow?2:0)+(i.map?1:0)-(b.map?1:0)}function AA(b,i){const l=new i0,u=function(){const C={};return{get:function(S){if(C[S.id]!==void 0)return C[S.id];let B;switch(S.type){case"DirectionalLight":case"SpotLight":B={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"PointLight":B={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt,shadowCameraNear:1,shadowCameraFar:1e3}}return C[S.id]=B,B}}}(),h={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let C=0;C<9;C++)h.probe.push(new he);const g=new he,_=new Gn,y=new Gn;return{setup:function(C,S){let B=0,L=0,k=0;for(let Xe=0;Xe<9;Xe++)h.probe[Xe].set(0,0,0);let U=0,Q=0,F=0,H=0,W=0,q=0,$=0,ie=0,se=0,le=0;C.sort(Ym);const Ie=S!==!0?Math.PI:1;for(let Xe=0,Ke=C.length;Xe<Ke;Xe++){const Be=C[Xe],St=Be.color,Ft=Be.intensity,Et=Be.distance,nn=Be.shadow&&Be.shadow.map?Be.shadow.map.texture:null;if(Be.isAmbientLight)B+=St.r*Ft*Ie,L+=St.g*Ft*Ie,k+=St.b*Ft*Ie;else if(Be.isLightProbe)for(let rn=0;rn<9;rn++)h.probe[rn].addScaledVector(Be.sh.coefficients[rn],Ft);else if(Be.isDirectionalLight){const rn=l.get(Be);if(rn.color.copy(Be.color).multiplyScalar(Be.intensity*Ie),Be.castShadow){const dt=Be.shadow,At=u.get(Be);At.shadowBias=dt.bias,At.shadowNormalBias=dt.normalBias,At.shadowRadius=dt.radius,At.shadowMapSize=dt.mapSize,h.directionalShadow[U]=At,h.directionalShadowMap[U]=nn,h.directionalShadowMatrix[U]=Be.shadow.matrix,q++}h.directional[U]=rn,U++}else if(Be.isSpotLight){const rn=l.get(Be);rn.position.setFromMatrixPosition(Be.matrixWorld),rn.color.copy(St).multiplyScalar(Ft*Ie),rn.distance=Et,rn.coneCos=Math.cos(Be.angle),rn.penumbraCos=Math.cos(Be.angle*(1-Be.penumbra)),rn.decay=Be.decay,h.spot[F]=rn;const dt=Be.shadow;if(Be.map&&(h.spotLightMap[se]=Be.map,se++,dt.updateMatrices(Be),Be.castShadow&&le++),h.spotLightMatrix[F]=dt.matrix,Be.castShadow){const At=u.get(Be);At.shadowBias=dt.bias,At.shadowNormalBias=dt.normalBias,At.shadowRadius=dt.radius,At.shadowMapSize=dt.mapSize,h.spotShadow[F]=At,h.spotShadowMap[F]=nn,ie++}F++}else if(Be.isRectAreaLight){const rn=l.get(Be);rn.color.copy(St).multiplyScalar(Ft),rn.halfWidth.set(.5*Be.width,0,0),rn.halfHeight.set(0,.5*Be.height,0),h.rectArea[H]=rn,H++}else if(Be.isPointLight){const rn=l.get(Be);if(rn.color.copy(Be.color).multiplyScalar(Be.intensity*Ie),rn.distance=Be.distance,rn.decay=Be.decay,Be.castShadow){const dt=Be.shadow,At=u.get(Be);At.shadowBias=dt.bias,At.shadowNormalBias=dt.normalBias,At.shadowRadius=dt.radius,At.shadowMapSize=dt.mapSize,At.shadowCameraNear=dt.camera.near,At.shadowCameraFar=dt.camera.far,h.pointShadow[Q]=At,h.pointShadowMap[Q]=nn,h.pointShadowMatrix[Q]=Be.shadow.matrix,$++}h.point[Q]=rn,Q++}else if(Be.isHemisphereLight){const rn=l.get(Be);rn.skyColor.copy(Be.color).multiplyScalar(Ft*Ie),rn.groundColor.copy(Be.groundColor).multiplyScalar(Ft*Ie),h.hemi[W]=rn,W++}}H>0&&(i.isWebGL2||b.has("OES_texture_float_linear")===!0?(h.rectAreaLTC1=un.LTC_FLOAT_1,h.rectAreaLTC2=un.LTC_FLOAT_2):b.has("OES_texture_half_float_linear")===!0?(h.rectAreaLTC1=un.LTC_HALF_1,h.rectAreaLTC2=un.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),h.ambient[0]=B,h.ambient[1]=L,h.ambient[2]=k;const De=h.hash;De.directionalLength===U&&De.pointLength===Q&&De.spotLength===F&&De.rectAreaLength===H&&De.hemiLength===W&&De.numDirectionalShadows===q&&De.numPointShadows===$&&De.numSpotShadows===ie&&De.numSpotMaps===se||(h.directional.length=U,h.spot.length=F,h.rectArea.length=H,h.point.length=Q,h.hemi.length=W,h.directionalShadow.length=q,h.directionalShadowMap.length=q,h.pointShadow.length=$,h.pointShadowMap.length=$,h.spotShadow.length=ie,h.spotShadowMap.length=ie,h.directionalShadowMatrix.length=q,h.pointShadowMatrix.length=$,h.spotLightMatrix.length=ie+se-le,h.spotLightMap.length=se,h.numSpotLightShadowsWithMaps=le,De.directionalLength=U,De.pointLength=Q,De.spotLength=F,De.rectAreaLength=H,De.hemiLength=W,De.numDirectionalShadows=q,De.numPointShadows=$,De.numSpotShadows=ie,De.numSpotMaps=se,h.version=Zp++)},setupView:function(C,S){let B=0,L=0,k=0,U=0,Q=0;const F=S.matrixWorldInverse;for(let H=0,W=C.length;H<W;H++){const q=C[H];if(q.isDirectionalLight){const $=h.directional[B];$.direction.setFromMatrixPosition(q.matrixWorld),g.setFromMatrixPosition(q.target.matrixWorld),$.direction.sub(g),$.direction.transformDirection(F),B++}else if(q.isSpotLight){const $=h.spot[k];$.position.setFromMatrixPosition(q.matrixWorld),$.position.applyMatrix4(F),$.direction.setFromMatrixPosition(q.matrixWorld),g.setFromMatrixPosition(q.target.matrixWorld),$.direction.sub(g),$.direction.transformDirection(F),k++}else if(q.isRectAreaLight){const $=h.rectArea[U];$.position.setFromMatrixPosition(q.matrixWorld),$.position.applyMatrix4(F),y.identity(),_.copy(q.matrixWorld),_.premultiply(F),y.extractRotation(_),$.halfWidth.set(.5*q.width,0,0),$.halfHeight.set(0,.5*q.height,0),$.halfWidth.applyMatrix4(y),$.halfHeight.applyMatrix4(y),U++}else if(q.isPointLight){const $=h.point[L];$.position.setFromMatrixPosition(q.matrixWorld),$.position.applyMatrix4(F),L++}else if(q.isHemisphereLight){const $=h.hemi[Q];$.direction.setFromMatrixPosition(q.matrixWorld),$.direction.transformDirection(F),Q++}}},state:h}}function Xm(b,i){const l=new AA(b,i),u=[],h=[];return{init:function(){u.length=0,h.length=0},state:{lightsArray:u,shadowsArray:h,lights:l},setupLights:function(g){l.setup(u,g)},setupLightsView:function(g){l.setupView(u,g)},pushLight:function(g){u.push(g)},pushShadow:function(g){h.push(g)}}}function yA(b,i){let l=new WeakMap;return{get:function(u,h=0){const g=l.get(u);let _;return g===void 0?(_=new Xm(b,i),l.set(u,[_])):h>=g.length?(_=new Xm(b,i),g.push(_)):_=g[h],_},dispose:function(){l=new WeakMap}}}class $p extends ss{constructor(i){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Is,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(i)}copy(i){return super.copy(i),this.depthPacking=i.depthPacking,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this}}class Qd extends ss{constructor(i){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new he,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(i)}copy(i){return super.copy(i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this}}function bA(b,i,l){let u=new Vp;const h=new Lt,g=new Lt,_=new Ti,y=new $p({depthPacking:mu}),C=new Qd,S={},B=l.maxTextureSize,L={0:me,1:je,2:Te},k=new rl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Lt},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),U=k.clone();U.defines.HORIZONTAL_PASS=1;const Q=new wn;Q.setAttribute("position",new ji(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const F=new os(Q,k),H=this;function W(ie,se){const le=i.update(F);k.defines.VSM_SAMPLES!==ie.blurSamples&&(k.defines.VSM_SAMPLES=ie.blurSamples,U.defines.VSM_SAMPLES=ie.blurSamples,k.needsUpdate=!0,U.needsUpdate=!0),ie.mapPass===null&&(ie.mapPass=new qs(h.x,h.y)),k.uniforms.shadow_pass.value=ie.map.texture,k.uniforms.resolution.value=ie.mapSize,k.uniforms.radius.value=ie.radius,b.setRenderTarget(ie.mapPass),b.clear(),b.renderBufferDirect(se,null,le,k,F,null),U.uniforms.shadow_pass.value=ie.mapPass.texture,U.uniforms.resolution.value=ie.mapSize,U.uniforms.radius.value=ie.radius,b.setRenderTarget(ie.map),b.clear(),b.renderBufferDirect(se,null,le,U,F,null)}function q(ie,se,le,Ie,De,Xe){let Ke=null;const Be=le.isPointLight===!0?ie.customDistanceMaterial:ie.customDepthMaterial;if(Ke=Be!==void 0?Be:le.isPointLight===!0?C:y,b.localClippingEnabled&&se.clipShadows===!0&&Array.isArray(se.clippingPlanes)&&se.clippingPlanes.length!==0||se.displacementMap&&se.displacementScale!==0||se.alphaMap&&se.alphaTest>0){const St=Ke.uuid,Ft=se.uuid;let Et=S[St];Et===void 0&&(Et={},S[St]=Et);let nn=Et[Ft];nn===void 0&&(nn=Ke.clone(),Et[Ft]=nn),Ke=nn}return Ke.visible=se.visible,Ke.wireframe=se.wireframe,Ke.side=Xe===Qe?se.shadowSide!==null?se.shadowSide:se.side:se.shadowSide!==null?se.shadowSide:L[se.side],Ke.alphaMap=se.alphaMap,Ke.alphaTest=se.alphaTest,Ke.clipShadows=se.clipShadows,Ke.clippingPlanes=se.clippingPlanes,Ke.clipIntersection=se.clipIntersection,Ke.displacementMap=se.displacementMap,Ke.displacementScale=se.displacementScale,Ke.displacementBias=se.displacementBias,Ke.wireframeLinewidth=se.wireframeLinewidth,Ke.linewidth=se.linewidth,le.isPointLight===!0&&Ke.isMeshDistanceMaterial===!0&&(Ke.referencePosition.setFromMatrixPosition(le.matrixWorld),Ke.nearDistance=Ie,Ke.farDistance=De),Ke}function $(ie,se,le,Ie,De){if(ie.visible===!1)return;if(ie.layers.test(se.layers)&&(ie.isMesh||ie.isLine||ie.isPoints)&&(ie.castShadow||ie.receiveShadow&&De===Qe)&&(!ie.frustumCulled||u.intersectsObject(ie))){ie.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,ie.matrixWorld);const Ke=i.update(ie),Be=ie.material;if(Array.isArray(Be)){const St=Ke.groups;for(let Ft=0,Et=St.length;Ft<Et;Ft++){const nn=St[Ft],rn=Be[nn.materialIndex];if(rn&&rn.visible){const dt=q(ie,rn,Ie,le.near,le.far,De);b.renderBufferDirect(le,null,Ke,dt,ie,nn)}}}else if(Be.visible){const St=q(ie,Be,Ie,le.near,le.far,De);b.renderBufferDirect(le,null,Ke,St,ie,null)}}const Xe=ie.children;for(let Ke=0,Be=Xe.length;Ke<Be;Ke++)$(Xe[Ke],se,le,Ie,De)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Je,this.render=function(ie,se,le){if(H.enabled===!1||H.autoUpdate===!1&&H.needsUpdate===!1||ie.length===0)return;const Ie=b.getRenderTarget(),De=b.getActiveCubeFace(),Xe=b.getActiveMipmapLevel(),Ke=b.state;Ke.setBlending(ue),Ke.buffers.color.setClear(1,1,1,1),Ke.buffers.depth.setTest(!0),Ke.setScissorTest(!1);for(let Be=0,St=ie.length;Be<St;Be++){const Ft=ie[Be],Et=Ft.shadow;if(Et===void 0){console.warn("THREE.WebGLShadowMap:",Ft,"has no shadow.");continue}if(Et.autoUpdate===!1&&Et.needsUpdate===!1)continue;h.copy(Et.mapSize);const nn=Et.getFrameExtents();if(h.multiply(nn),g.copy(Et.mapSize),(h.x>B||h.y>B)&&(h.x>B&&(g.x=Math.floor(B/nn.x),h.x=g.x*nn.x,Et.mapSize.x=g.x),h.y>B&&(g.y=Math.floor(B/nn.y),h.y=g.y*nn.y,Et.mapSize.y=g.y)),Et.map===null){const dt=this.type!==Qe?{minFilter:lr,magFilter:lr}:{};Et.map=new qs(h.x,h.y,dt),Et.map.texture.name=Ft.name+".shadowMap",Et.camera.updateProjectionMatrix()}b.setRenderTarget(Et.map),b.clear();const rn=Et.getViewportCount();for(let dt=0;dt<rn;dt++){const At=Et.getViewport(dt);_.set(g.x*At.x,g.y*At.y,g.x*At.z,g.y*At.w),Ke.viewport(_),Et.updateMatrices(Ft,dt),u=Et.getFrustum(),$(se,le,Et.camera,Ft,this.type)}Et.isPointLightShadow!==!0&&this.type===Qe&&W(Et,le),Et.needsUpdate=!1}H.needsUpdate=!1,b.setRenderTarget(Ie,De,Xe)}}function r0(b,i,l){const u=l.isWebGL2,h=new function(){let ee=!1;const _t=new Ti;let tt=null;const Ct=new Ti(0,0,0,0);return{setMask:function(Pt){tt===Pt||ee||(b.colorMask(Pt,Pt,Pt,Pt),tt=Pt)},setLocked:function(Pt){ee=Pt},setClear:function(Pt,cn,Rn,zn,ti){ti===!0&&(Pt*=zn,cn*=zn,Rn*=zn),_t.set(Pt,cn,Rn,zn),Ct.equals(_t)===!1&&(b.clearColor(Pt,cn,Rn,zn),Ct.copy(_t))},reset:function(){ee=!1,tt=null,Ct.set(-1,0,0,0)}}},g=new function(){let ee=!1,_t=null,tt=null,Ct=null;return{setTest:function(Pt){Pt?Pn(2929):ri(2929)},setMask:function(Pt){_t===Pt||ee||(b.depthMask(Pt),_t=Pt)},setFunc:function(Pt){if(tt!==Pt){if(Pt)switch(Pt){case Gt:b.depthFunc(512);break;case Ze:b.depthFunc(519);break;case J:b.depthFunc(513);break;case ae:b.depthFunc(515);break;case Le:b.depthFunc(514);break;case Kt:b.depthFunc(518);break;case Qt:b.depthFunc(516);break;case $t:b.depthFunc(517);break;default:b.depthFunc(515)}else b.depthFunc(515);tt=Pt}},setLocked:function(Pt){ee=Pt},setClear:function(Pt){Ct!==Pt&&(b.clearDepth(Pt),Ct=Pt)},reset:function(){ee=!1,_t=null,tt=null,Ct=null}}},_=new function(){let ee=!1,_t=null,tt=null,Ct=null,Pt=null,cn=null,Rn=null,zn=null,ti=null;return{setTest:function(Un){ee||(Un?Pn(2960):ri(2960))},setMask:function(Un){_t===Un||ee||(b.stencilMask(Un),_t=Un)},setFunc:function(Un,Qn,Ui){tt===Un&&Ct===Qn&&Pt===Ui||(b.stencilFunc(Un,Qn,Ui),tt=Un,Ct=Qn,Pt=Ui)},setOp:function(Un,Qn,Ui){cn===Un&&Rn===Qn&&zn===Ui||(b.stencilOp(Un,Qn,Ui),cn=Un,Rn=Qn,zn=Ui)},setLocked:function(Un){ee=Un},setClear:function(Un){ti!==Un&&(b.clearStencil(Un),ti=Un)},reset:function(){ee=!1,_t=null,tt=null,Ct=null,Pt=null,cn=null,Rn=null,zn=null,ti=null}}},y=new WeakMap,C=new WeakMap;let S={},B={},L=new WeakMap,k=[],U=null,Q=!1,F=null,H=null,W=null,q=null,$=null,ie=null,se=null,le=!1,Ie=null,De=null,Xe=null,Ke=null,Be=null;const St=b.getParameter(35661);let Ft=!1,Et=0;const nn=b.getParameter(7938);nn.indexOf("WebGL")!==-1?(Et=parseFloat(/^WebGL (\d)/.exec(nn)[1]),Ft=Et>=1):nn.indexOf("OpenGL ES")!==-1&&(Et=parseFloat(/^OpenGL ES (\d)/.exec(nn)[1]),Ft=Et>=2);let rn=null,dt={};const At=b.getParameter(3088),Wt=b.getParameter(2978),Mt=new Ti().fromArray(At),en=new Ti().fromArray(Wt);function In(ee,_t,tt){const Ct=new Uint8Array(4),Pt=b.createTexture();b.bindTexture(ee,Pt),b.texParameteri(ee,10241,9728),b.texParameteri(ee,10240,9728);for(let cn=0;cn<tt;cn++)b.texImage2D(_t+cn,0,6408,1,1,0,6408,5121,Ct);return Pt}const hi={};function Pn(ee){S[ee]!==!0&&(b.enable(ee),S[ee]=!0)}function ri(ee){S[ee]!==!1&&(b.disable(ee),S[ee]=!1)}hi[3553]=In(3553,3553,1),hi[34067]=In(34067,34069,6),h.setClear(0,0,0,1),g.setClear(1),_.setClear(0),Pn(2929),g.setFunc(ae),qe(!1),Se(rt),Pn(2884),it(ue);const Ce={[K]:32774,[Z]:32778,[te]:32779};if(u)Ce[Oe]=32775,Ce[ve]=32776;else{const ee=i.get("EXT_blend_minmax");ee!==null&&(Ce[Oe]=ee.MIN_EXT,Ce[ve]=ee.MAX_EXT)}const _e={[st]:0,[qt]:1,[Vt]:768,[Bt]:770,[pt]:776,[et]:774,[Yt]:772,[tn]:769,[on]:771,[xt]:775,[Xt]:773};function it(ee,_t,tt,Ct,Pt,cn,Rn,zn){if(ee!==ue){if(Q===!1&&(Pn(3042),Q=!0),ee===Ve)Pt=Pt||_t,cn=cn||tt,Rn=Rn||Ct,_t===H&&Pt===$||(b.blendEquationSeparate(Ce[_t],Ce[Pt]),H=_t,$=Pt),tt===W&&Ct===q&&cn===ie&&Rn===se||(b.blendFuncSeparate(_e[tt],_e[Ct],_e[cn],_e[Rn]),W=tt,q=Ct,ie=cn,se=Rn),F=ee,le=null;else if(ee!==F||zn!==le){if(H===K&&$===K||(b.blendEquation(32774),H=K,$=K),zn)switch(ee){case Ae:b.blendFuncSeparate(1,771,1,771);break;case ke:b.blendFunc(1,1);break;case mt:b.blendFuncSeparate(0,769,0,1);break;case Ee:b.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee)}else switch(ee){case Ae:b.blendFuncSeparate(770,771,1,771);break;case ke:b.blendFunc(770,1);break;case mt:b.blendFuncSeparate(0,769,0,1);break;case Ee:b.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee)}W=null,q=null,ie=null,se=null,F=ee,le=zn}}else Q===!0&&(ri(3042),Q=!1)}function qe(ee){Ie!==ee&&(ee?b.frontFace(2304):b.frontFace(2305),Ie=ee)}function Se(ee){ee!==Ge?(Pn(2884),ee!==De&&(ee===rt?b.cullFace(1029):ee===Ue?b.cullFace(1028):b.cullFace(1032))):ri(2884),De=ee}function He(ee,_t,tt){ee?(Pn(32823),Ke===_t&&Be===tt||(b.polygonOffset(_t,tt),Ke=_t,Be=tt)):ri(32823)}function gt(ee){ee===void 0&&(ee=33984+St-1),rn!==ee&&(b.activeTexture(ee),rn=ee)}return{buffers:{color:h,depth:g,stencil:_},enable:Pn,disable:ri,bindFramebuffer:function(ee,_t){return B[ee]!==_t&&(b.bindFramebuffer(ee,_t),B[ee]=_t,u&&(ee===36009&&(B[36160]=_t),ee===36160&&(B[36009]=_t)),!0)},drawBuffers:function(ee,_t){let tt=k,Ct=!1;if(ee)if(tt=L.get(_t),tt===void 0&&(tt=[],L.set(_t,tt)),ee.isWebGLMultipleRenderTargets){const Pt=ee.texture;if(tt.length!==Pt.length||tt[0]!==36064){for(let cn=0,Rn=Pt.length;cn<Rn;cn++)tt[cn]=36064+cn;tt.length=Pt.length,Ct=!0}}else tt[0]!==36064&&(tt[0]=36064,Ct=!0);else tt[0]!==1029&&(tt[0]=1029,Ct=!0);Ct&&(l.isWebGL2?b.drawBuffers(tt):i.get("WEBGL_draw_buffers").drawBuffersWEBGL(tt))},useProgram:function(ee){return U!==ee&&(b.useProgram(ee),U=ee,!0)},setBlending:it,setMaterial:function(ee,_t){ee.side===Te?ri(2884):Pn(2884);let tt=ee.side===me;_t&&(tt=!tt),qe(tt),ee.blending===Ae&&ee.transparent===!1?it(ue):it(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.premultipliedAlpha),g.setFunc(ee.depthFunc),g.setTest(ee.depthTest),g.setMask(ee.depthWrite),h.setMask(ee.colorWrite);const Ct=ee.stencilWrite;_.setTest(Ct),Ct&&(_.setMask(ee.stencilWriteMask),_.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),_.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),He(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?Pn(32926):ri(32926)},setFlipSided:qe,setCullFace:Se,setLineWidth:function(ee){ee!==Xe&&(Ft&&b.lineWidth(ee),Xe=ee)},setPolygonOffset:He,setScissorTest:function(ee){ee?Pn(3089):ri(3089)},activeTexture:gt,bindTexture:function(ee,_t){rn===null&&gt();let tt=dt[rn];tt===void 0&&(tt={type:void 0,texture:void 0},dt[rn]=tt),tt.type===ee&&tt.texture===_t||(b.bindTexture(ee,_t||hi[ee]),tt.type=ee,tt.texture=_t)},unbindTexture:function(){const ee=dt[rn];ee!==void 0&&ee.type!==void 0&&(b.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)},compressedTexImage2D:function(){try{b.compressedTexImage2D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},texImage2D:function(){try{b.texImage2D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},texImage3D:function(){try{b.texImage3D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},updateUBOMapping:function(ee,_t){let tt=C.get(_t);tt===void 0&&(tt=new WeakMap,C.set(_t,tt));let Ct=tt.get(ee);Ct===void 0&&(Ct=b.getUniformBlockIndex(_t,ee.name),tt.set(ee,Ct))},uniformBlockBinding:function(ee,_t){const tt=C.get(_t).get(ee);y.get(ee)!==tt&&(b.uniformBlockBinding(_t,tt,ee.__bindingPointIndex),y.set(ee,tt))},texStorage2D:function(){try{b.texStorage2D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},texStorage3D:function(){try{b.texStorage3D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},texSubImage2D:function(){try{b.texSubImage2D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},texSubImage3D:function(){try{b.texSubImage3D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},compressedTexSubImage2D:function(){try{b.compressedTexSubImage2D.apply(b,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}},scissor:function(ee){Mt.equals(ee)===!1&&(b.scissor(ee.x,ee.y,ee.z,ee.w),Mt.copy(ee))},viewport:function(ee){en.equals(ee)===!1&&(b.viewport(ee.x,ee.y,ee.z,ee.w),en.copy(ee))},reset:function(){b.disable(3042),b.disable(2884),b.disable(2929),b.disable(32823),b.disable(3089),b.disable(2960),b.disable(32926),b.blendEquation(32774),b.blendFunc(1,0),b.blendFuncSeparate(1,0,1,0),b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.depthMask(!0),b.depthFunc(513),b.clearDepth(1),b.stencilMask(4294967295),b.stencilFunc(519,0,4294967295),b.stencilOp(7680,7680,7680),b.clearStencil(0),b.cullFace(1029),b.frontFace(2305),b.polygonOffset(0,0),b.activeTexture(33984),b.bindFramebuffer(36160,null),u===!0&&(b.bindFramebuffer(36009,null),b.bindFramebuffer(36008,null)),b.useProgram(null),b.lineWidth(1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.viewport(0,0,b.canvas.width,b.canvas.height),S={},rn=null,dt={},B={},L=new WeakMap,k=[],U=null,Q=!1,F=null,H=null,W=null,q=null,$=null,ie=null,se=null,le=!1,Ie=null,De=null,Xe=null,Ke=null,Be=null,Mt.set(0,0,b.canvas.width,b.canvas.height),en.set(0,0,b.canvas.width,b.canvas.height),h.reset(),g.reset(),_.reset()}}}function s0(b,i,l,u,h,g,_){const y=h.isWebGL2,C=h.maxTextures,S=h.maxCubemapSize,B=h.maxTextureSize,L=h.maxSamples,k=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,U=/OculusBrowser/g.test(navigator.userAgent),Q=new WeakMap;let F;const H=new WeakMap;let W=!1;try{W=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function q(Ce,_e){return W?new OffscreenCanvas(Ce,_e):Ec("canvas")}function $(Ce,_e,it,qe){let Se=1;if((Ce.width>qe||Ce.height>qe)&&(Se=qe/Math.max(Ce.width,Ce.height)),Se<1||_e===!0){if(typeof HTMLImageElement<"u"&&Ce instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ce instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ce instanceof ImageBitmap){const He=_e?Ds:Math.floor,gt=He(Se*Ce.width),ee=He(Se*Ce.height);F===void 0&&(F=q(gt,ee));const _t=it?q(gt,ee):F;return _t.width=gt,_t.height=ee,_t.getContext("2d").drawImage(Ce,0,0,gt,ee),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ce.width+"x"+Ce.height+") to ("+gt+"x"+ee+")."),_t}return"data"in Ce&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ce.width+"x"+Ce.height+")."),Ce}return Ce}function ie(Ce){return xh(Ce.width)&&xh(Ce.height)}function se(Ce,_e){return Ce.generateMipmaps&&_e&&Ce.minFilter!==lr&&Ce.minFilter!==ur}function le(Ce){b.generateMipmap(Ce)}function Ie(Ce,_e,it,qe,Se=!1){if(y===!1)return _e;if(Ce!==null){if(b[Ce]!==void 0)return b[Ce];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ce+"'")}let He=_e;return _e===6403&&(it===5126&&(He=33326),it===5131&&(He=33325),it===5121&&(He=33321)),_e===33319&&(it===5126&&(He=33328),it===5131&&(He=33327),it===5121&&(He=33323)),_e===6408&&(it===5126&&(He=34836),it===5131&&(He=34842),it===5121&&(He=qe===ui&&Se===!1?35907:32856),it===32819&&(He=32854),it===32820&&(He=32855)),He!==33325&&He!==33326&&He!==33327&&He!==33328&&He!==34842&&He!==34836||i.get("EXT_color_buffer_float"),He}function De(Ce,_e,it){return se(Ce,it)===!0||Ce.isFramebufferTexture&&Ce.minFilter!==lr&&Ce.minFilter!==ur?Math.log2(Math.max(_e.width,_e.height))+1:Ce.mipmaps!==void 0&&Ce.mipmaps.length>0?Ce.mipmaps.length:Ce.isCompressedTexture&&Array.isArray(Ce.image)?_e.mipmaps.length:1}function Xe(Ce){return Ce===lr||Ce===ms||Ce===cr?9728:9729}function Ke(Ce){const _e=Ce.target;_e.removeEventListener("dispose",Ke),function(it){const qe=u.get(it);if(qe.__webglInit===void 0)return;const Se=it.source,He=H.get(Se);if(He){const gt=He[qe.__cacheKey];gt.usedTimes--,gt.usedTimes===0&&St(it),Object.keys(He).length===0&&H.delete(Se)}u.remove(it)}(_e),_e.isVideoTexture&&Q.delete(_e)}function Be(Ce){const _e=Ce.target;_e.removeEventListener("dispose",Be),function(it){const qe=it.texture,Se=u.get(it),He=u.get(qe);if(He.__webglTexture!==void 0&&(b.deleteTexture(He.__webglTexture),_.memory.textures--),it.depthTexture&&it.depthTexture.dispose(),it.isWebGLCubeRenderTarget)for(let gt=0;gt<6;gt++)b.deleteFramebuffer(Se.__webglFramebuffer[gt]),Se.__webglDepthbuffer&&b.deleteRenderbuffer(Se.__webglDepthbuffer[gt]);else{if(b.deleteFramebuffer(Se.__webglFramebuffer),Se.__webglDepthbuffer&&b.deleteRenderbuffer(Se.__webglDepthbuffer),Se.__webglMultisampledFramebuffer&&b.deleteFramebuffer(Se.__webglMultisampledFramebuffer),Se.__webglColorRenderbuffer)for(let gt=0;gt<Se.__webglColorRenderbuffer.length;gt++)Se.__webglColorRenderbuffer[gt]&&b.deleteRenderbuffer(Se.__webglColorRenderbuffer[gt]);Se.__webglDepthRenderbuffer&&b.deleteRenderbuffer(Se.__webglDepthRenderbuffer)}if(it.isWebGLMultipleRenderTargets)for(let gt=0,ee=qe.length;gt<ee;gt++){const _t=u.get(qe[gt]);_t.__webglTexture&&(b.deleteTexture(_t.__webglTexture),_.memory.textures--),u.remove(qe[gt])}u.remove(qe),u.remove(it)}(_e)}function St(Ce){const _e=u.get(Ce);b.deleteTexture(_e.__webglTexture);const it=Ce.source;delete H.get(it)[_e.__cacheKey],_.memory.textures--}let Ft=0;function Et(Ce,_e){const it=u.get(Ce);if(Ce.isVideoTexture&&function(qe){const Se=_.render.frame;Q.get(qe)!==Se&&(Q.set(qe,Se),qe.update())}(Ce),Ce.isRenderTargetTexture===!1&&Ce.version>0&&it.__version!==Ce.version){const qe=Ce.image;if(qe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(qe.complete!==!1)return void Wt(it,Ce,_e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}l.activeTexture(33984+_e),l.bindTexture(3553,it.__webglTexture)}const nn={[Ts]:10497,[Ki]:33071,[Yo]:33648},rn={[lr]:9728,[ms]:9984,[cr]:9986,[ur]:9729,[Wa]:9985,[Pi]:9987};function dt(Ce,_e,it){if(it?(b.texParameteri(Ce,10242,nn[_e.wrapS]),b.texParameteri(Ce,10243,nn[_e.wrapT]),Ce!==32879&&Ce!==35866||b.texParameteri(Ce,32882,nn[_e.wrapR]),b.texParameteri(Ce,10240,rn[_e.magFilter]),b.texParameteri(Ce,10241,rn[_e.minFilter])):(b.texParameteri(Ce,10242,33071),b.texParameteri(Ce,10243,33071),Ce!==32879&&Ce!==35866||b.texParameteri(Ce,32882,33071),_e.wrapS===Ki&&_e.wrapT===Ki||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),b.texParameteri(Ce,10240,Xe(_e.magFilter)),b.texParameteri(Ce,10241,Xe(_e.minFilter)),_e.minFilter!==lr&&_e.minFilter!==ur&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i.has("EXT_texture_filter_anisotropic")===!0){const qe=i.get("EXT_texture_filter_anisotropic");if(_e.type===Qr&&i.has("OES_texture_float_linear")===!1||y===!1&&_e.type===ya&&i.has("OES_texture_half_float_linear")===!1)return;(_e.anisotropy>1||u.get(_e).__currentAnisotropy)&&(b.texParameterf(Ce,qe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(_e.anisotropy,h.getMaxAnisotropy())),u.get(_e).__currentAnisotropy=_e.anisotropy)}}function At(Ce,_e){let it=!1;Ce.__webglInit===void 0&&(Ce.__webglInit=!0,_e.addEventListener("dispose",Ke));const qe=_e.source;let Se=H.get(qe);Se===void 0&&(Se={},H.set(qe,Se));const He=function(gt){const ee=[];return ee.push(gt.wrapS),ee.push(gt.wrapT),ee.push(gt.magFilter),ee.push(gt.minFilter),ee.push(gt.anisotropy),ee.push(gt.internalFormat),ee.push(gt.format),ee.push(gt.type),ee.push(gt.generateMipmaps),ee.push(gt.premultiplyAlpha),ee.push(gt.flipY),ee.push(gt.unpackAlignment),ee.push(gt.encoding),ee.join()}(_e);if(He!==Ce.__cacheKey){Se[He]===void 0&&(Se[He]={texture:b.createTexture(),usedTimes:0},_.memory.textures++,it=!0),Se[He].usedTimes++;const gt=Se[Ce.__cacheKey];gt!==void 0&&(Se[Ce.__cacheKey].usedTimes--,gt.usedTimes===0&&St(_e)),Ce.__cacheKey=He,Ce.__webglTexture=Se[He].texture}return it}function Wt(Ce,_e,it){let qe=3553;_e.isDataArrayTexture&&(qe=35866),_e.isData3DTexture&&(qe=32879);const Se=At(Ce,_e),He=_e.source;if(l.activeTexture(33984+it),l.bindTexture(qe,Ce.__webglTexture),He.version!==He.__currentVersion||Se===!0){b.pixelStorei(37440,_e.flipY),b.pixelStorei(37441,_e.premultiplyAlpha),b.pixelStorei(3317,_e.unpackAlignment),b.pixelStorei(37443,0);const gt=function(Qn){return!y&&(Qn.wrapS!==Ki||Qn.wrapT!==Ki||Qn.minFilter!==lr&&Qn.minFilter!==ur)}(_e)&&ie(_e.image)===!1;let ee=$(_e.image,gt,!1,B);ee=ri(_e,ee);const _t=ie(ee)||y,tt=g.convert(_e.format,_e.encoding);let Ct,Pt=g.convert(_e.type),cn=Ie(_e.internalFormat,tt,Pt,_e.encoding,_e.isVideoTexture);dt(qe,_e,_t);const Rn=_e.mipmaps,zn=y&&_e.isVideoTexture!==!0,ti=He.__currentVersion===void 0||Se===!0,Un=De(_e,ee,_t);if(_e.isDepthTexture)cn=6402,y?cn=_e.type===Qr?36012:_e.type===Ne?33190:_e.type===mi?35056:33189:_e.type===Qr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),_e.format===yo&&cn===6402&&_e.type!==_h&&_e.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),_e.type=Ne,Pt=g.convert(_e.type)),_e.format===Sl&&cn===6402&&(cn=34041,_e.type!==mi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),_e.type=mi,Pt=g.convert(_e.type))),ti&&(zn?l.texStorage2D(3553,1,cn,ee.width,ee.height):l.texImage2D(3553,0,cn,ee.width,ee.height,0,tt,Pt,null));else if(_e.isDataTexture)if(Rn.length>0&&_t){zn&&ti&&l.texStorage2D(3553,Un,cn,Rn[0].width,Rn[0].height);for(let Qn=0,Ui=Rn.length;Qn<Ui;Qn++)Ct=Rn[Qn],zn?l.texSubImage2D(3553,Qn,0,0,Ct.width,Ct.height,tt,Pt,Ct.data):l.texImage2D(3553,Qn,cn,Ct.width,Ct.height,0,tt,Pt,Ct.data);_e.generateMipmaps=!1}else zn?(ti&&l.texStorage2D(3553,Un,cn,ee.width,ee.height),l.texSubImage2D(3553,0,0,0,ee.width,ee.height,tt,Pt,ee.data)):l.texImage2D(3553,0,cn,ee.width,ee.height,0,tt,Pt,ee.data);else if(_e.isCompressedTexture){zn&&ti&&l.texStorage2D(3553,Un,cn,Rn[0].width,Rn[0].height);for(let Qn=0,Ui=Rn.length;Qn<Ui;Qn++)Ct=Rn[Qn],_e.format!==Hs?tt!==null?zn?l.compressedTexSubImage2D(3553,Qn,0,0,Ct.width,Ct.height,tt,Ct.data):l.compressedTexImage2D(3553,Qn,cn,Ct.width,Ct.height,0,Ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):zn?l.texSubImage2D(3553,Qn,0,0,Ct.width,Ct.height,tt,Pt,Ct.data):l.texImage2D(3553,Qn,cn,Ct.width,Ct.height,0,tt,Pt,Ct.data)}else if(_e.isDataArrayTexture)zn?(ti&&l.texStorage3D(35866,Un,cn,ee.width,ee.height,ee.depth),l.texSubImage3D(35866,0,0,0,0,ee.width,ee.height,ee.depth,tt,Pt,ee.data)):l.texImage3D(35866,0,cn,ee.width,ee.height,ee.depth,0,tt,Pt,ee.data);else if(_e.isData3DTexture)zn?(ti&&l.texStorage3D(32879,Un,cn,ee.width,ee.height,ee.depth),l.texSubImage3D(32879,0,0,0,0,ee.width,ee.height,ee.depth,tt,Pt,ee.data)):l.texImage3D(32879,0,cn,ee.width,ee.height,ee.depth,0,tt,Pt,ee.data);else if(_e.isFramebufferTexture){if(ti)if(zn)l.texStorage2D(3553,Un,cn,ee.width,ee.height);else{let Qn=ee.width,Ui=ee.height;for(let ca=0;ca<Un;ca++)l.texImage2D(3553,ca,cn,Qn,Ui,0,tt,Pt,null),Qn>>=1,Ui>>=1}}else if(Rn.length>0&&_t){zn&&ti&&l.texStorage2D(3553,Un,cn,Rn[0].width,Rn[0].height);for(let Qn=0,Ui=Rn.length;Qn<Ui;Qn++)Ct=Rn[Qn],zn?l.texSubImage2D(3553,Qn,0,0,tt,Pt,Ct):l.texImage2D(3553,Qn,cn,tt,Pt,Ct);_e.generateMipmaps=!1}else zn?(ti&&l.texStorage2D(3553,Un,cn,ee.width,ee.height),l.texSubImage2D(3553,0,0,0,tt,Pt,ee)):l.texImage2D(3553,0,cn,tt,Pt,ee);se(_e,_t)&&le(qe),He.__currentVersion=He.version,_e.onUpdate&&_e.onUpdate(_e)}Ce.__version=_e.version}function Mt(Ce,_e,it,qe,Se){const He=g.convert(it.format,it.encoding),gt=g.convert(it.type),ee=Ie(it.internalFormat,He,gt,it.encoding);u.get(_e).__hasExternalTextures||(Se===32879||Se===35866?l.texImage3D(Se,0,ee,_e.width,_e.height,_e.depth,0,He,gt,null):l.texImage2D(Se,0,ee,_e.width,_e.height,0,He,gt,null)),l.bindFramebuffer(36160,Ce),Pn(_e)?k.framebufferTexture2DMultisampleEXT(36160,qe,Se,u.get(it).__webglTexture,0,hi(_e)):b.framebufferTexture2D(36160,qe,Se,u.get(it).__webglTexture,0),l.bindFramebuffer(36160,null)}function en(Ce,_e,it){if(b.bindRenderbuffer(36161,Ce),_e.depthBuffer&&!_e.stencilBuffer){let qe=33189;if(it||Pn(_e)){const Se=_e.depthTexture;Se&&Se.isDepthTexture&&(Se.type===Qr?qe=36012:Se.type===Ne&&(qe=33190));const He=hi(_e);Pn(_e)?k.renderbufferStorageMultisampleEXT(36161,He,qe,_e.width,_e.height):b.renderbufferStorageMultisample(36161,He,qe,_e.width,_e.height)}else b.renderbufferStorage(36161,qe,_e.width,_e.height);b.framebufferRenderbuffer(36160,36096,36161,Ce)}else if(_e.depthBuffer&&_e.stencilBuffer){const qe=hi(_e);it&&Pn(_e)===!1?b.renderbufferStorageMultisample(36161,qe,35056,_e.width,_e.height):Pn(_e)?k.renderbufferStorageMultisampleEXT(36161,qe,35056,_e.width,_e.height):b.renderbufferStorage(36161,34041,_e.width,_e.height),b.framebufferRenderbuffer(36160,33306,36161,Ce)}else{const qe=_e.isWebGLMultipleRenderTargets===!0?_e.texture:[_e.texture];for(let Se=0;Se<qe.length;Se++){const He=qe[Se],gt=g.convert(He.format,He.encoding),ee=g.convert(He.type),_t=Ie(He.internalFormat,gt,ee,He.encoding),tt=hi(_e);it&&Pn(_e)===!1?b.renderbufferStorageMultisample(36161,tt,_t,_e.width,_e.height):Pn(_e)?k.renderbufferStorageMultisampleEXT(36161,tt,_t,_e.width,_e.height):b.renderbufferStorage(36161,_t,_e.width,_e.height)}}b.bindRenderbuffer(36161,null)}function In(Ce){const _e=u.get(Ce),it=Ce.isWebGLCubeRenderTarget===!0;if(Ce.depthTexture&&!_e.__autoAllocateDepthBuffer){if(it)throw new Error("target.depthTexture not supported in Cube render targets");(function(qe,Se){if(Se&&Se.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(l.bindFramebuffer(36160,qe),!Se.depthTexture||!Se.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");u.get(Se.depthTexture).__webglTexture&&Se.depthTexture.image.width===Se.width&&Se.depthTexture.image.height===Se.height||(Se.depthTexture.image.width=Se.width,Se.depthTexture.image.height=Se.height,Se.depthTexture.needsUpdate=!0),Et(Se.depthTexture,0);const He=u.get(Se.depthTexture).__webglTexture,gt=hi(Se);if(Se.depthTexture.format===yo)Pn(Se)?k.framebufferTexture2DMultisampleEXT(36160,36096,3553,He,0,gt):b.framebufferTexture2D(36160,36096,3553,He,0);else{if(Se.depthTexture.format!==Sl)throw new Error("Unknown depthTexture format");Pn(Se)?k.framebufferTexture2DMultisampleEXT(36160,33306,3553,He,0,gt):b.framebufferTexture2D(36160,33306,3553,He,0)}})(_e.__webglFramebuffer,Ce)}else if(it){_e.__webglDepthbuffer=[];for(let qe=0;qe<6;qe++)l.bindFramebuffer(36160,_e.__webglFramebuffer[qe]),_e.__webglDepthbuffer[qe]=b.createRenderbuffer(),en(_e.__webglDepthbuffer[qe],Ce,!1)}else l.bindFramebuffer(36160,_e.__webglFramebuffer),_e.__webglDepthbuffer=b.createRenderbuffer(),en(_e.__webglDepthbuffer,Ce,!1);l.bindFramebuffer(36160,null)}function hi(Ce){return Math.min(L,Ce.samples)}function Pn(Ce){const _e=u.get(Ce);return y&&Ce.samples>0&&i.has("WEBGL_multisampled_render_to_texture")===!0&&_e.__useRenderToTexture!==!1}function ri(Ce,_e){const it=Ce.encoding,qe=Ce.format,Se=Ce.type;return Ce.isCompressedTexture===!0||Ce.isVideoTexture===!0||Ce.format===bd||it!==Jo&&(it===ui?y===!1?i.has("EXT_sRGB")===!0&&qe===Hs?(Ce.format=bd,Ce.minFilter=ur,Ce.generateMipmaps=!1):_e=Ch.sRGBToLinear(_e):qe===Hs&&Se===Aa||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):it===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",it)),_e}this.allocateTextureUnit=function(){const Ce=Ft;return Ce>=C&&console.warn("THREE.WebGLTextures: Trying to use "+Ce+" texture units while this GPU supports only "+C),Ft+=1,Ce},this.resetTextureUnits=function(){Ft=0},this.setTexture2D=Et,this.setTexture2DArray=function(Ce,_e){const it=u.get(Ce);Ce.version>0&&it.__version!==Ce.version?Wt(it,Ce,_e):(l.activeTexture(33984+_e),l.bindTexture(35866,it.__webglTexture))},this.setTexture3D=function(Ce,_e){const it=u.get(Ce);Ce.version>0&&it.__version!==Ce.version?Wt(it,Ce,_e):(l.activeTexture(33984+_e),l.bindTexture(32879,it.__webglTexture))},this.setTextureCube=function(Ce,_e){const it=u.get(Ce);Ce.version>0&&it.__version!==Ce.version?function(qe,Se,He){if(Se.image.length!==6)return;const gt=At(qe,Se),ee=Se.source;if(l.activeTexture(33984+He),l.bindTexture(34067,qe.__webglTexture),ee.version!==ee.__currentVersion||gt===!0){b.pixelStorei(37440,Se.flipY),b.pixelStorei(37441,Se.premultiplyAlpha),b.pixelStorei(3317,Se.unpackAlignment),b.pixelStorei(37443,0);const _t=Se.isCompressedTexture||Se.image[0].isCompressedTexture,tt=Se.image[0]&&Se.image[0].isDataTexture,Ct=[];for(let $n=0;$n<6;$n++)Ct[$n]=_t||tt?tt?Se.image[$n].image:Se.image[$n]:$(Se.image[$n],!1,!0,S),Ct[$n]=ri(Se,Ct[$n]);const Pt=Ct[0],cn=ie(Pt)||y,Rn=g.convert(Se.format,Se.encoding),zn=g.convert(Se.type),ti=Ie(Se.internalFormat,Rn,zn,Se.encoding),Un=y&&Se.isVideoTexture!==!0,Qn=ee.__currentVersion===void 0||gt===!0;let Ui,ca=De(Se,Pt,cn);if(dt(34067,Se,cn),_t){Un&&Qn&&l.texStorage2D(34067,ca,ti,Pt.width,Pt.height);for(let $n=0;$n<6;$n++){Ui=Ct[$n].mipmaps;for(let Gi=0;Gi<Ui.length;Gi++){const Hi=Ui[Gi];Se.format!==Hs?Rn!==null?Un?l.compressedTexSubImage2D(34069+$n,Gi,0,0,Hi.width,Hi.height,Rn,Hi.data):l.compressedTexImage2D(34069+$n,Gi,ti,Hi.width,Hi.height,0,Hi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Un?l.texSubImage2D(34069+$n,Gi,0,0,Hi.width,Hi.height,Rn,zn,Hi.data):l.texImage2D(34069+$n,Gi,ti,Hi.width,Hi.height,0,Rn,zn,Hi.data)}}}else{Ui=Se.mipmaps,Un&&Qn&&(Ui.length>0&&ca++,l.texStorage2D(34067,ca,ti,Ct[0].width,Ct[0].height));for(let $n=0;$n<6;$n++)if(tt){Un?l.texSubImage2D(34069+$n,0,0,0,Ct[$n].width,Ct[$n].height,Rn,zn,Ct[$n].data):l.texImage2D(34069+$n,0,ti,Ct[$n].width,Ct[$n].height,0,Rn,zn,Ct[$n].data);for(let Gi=0;Gi<Ui.length;Gi++){const Hi=Ui[Gi].image[$n].image;Un?l.texSubImage2D(34069+$n,Gi+1,0,0,Hi.width,Hi.height,Rn,zn,Hi.data):l.texImage2D(34069+$n,Gi+1,ti,Hi.width,Hi.height,0,Rn,zn,Hi.data)}}else{Un?l.texSubImage2D(34069+$n,0,0,0,Rn,zn,Ct[$n]):l.texImage2D(34069+$n,0,ti,Rn,zn,Ct[$n]);for(let Gi=0;Gi<Ui.length;Gi++){const Hi=Ui[Gi];Un?l.texSubImage2D(34069+$n,Gi+1,0,0,Rn,zn,Hi.image[$n]):l.texImage2D(34069+$n,Gi+1,ti,Rn,zn,Hi.image[$n])}}}se(Se,cn)&&le(34067),ee.__currentVersion=ee.version,Se.onUpdate&&Se.onUpdate(Se)}qe.__version=Se.version}(it,Ce,_e):(l.activeTexture(33984+_e),l.bindTexture(34067,it.__webglTexture))},this.rebindTextures=function(Ce,_e,it){const qe=u.get(Ce);_e!==void 0&&Mt(qe.__webglFramebuffer,Ce,Ce.texture,36064,3553),it!==void 0&&In(Ce)},this.setupRenderTarget=function(Ce){const _e=Ce.texture,it=u.get(Ce),qe=u.get(_e);Ce.addEventListener("dispose",Be),Ce.isWebGLMultipleRenderTargets!==!0&&(qe.__webglTexture===void 0&&(qe.__webglTexture=b.createTexture()),qe.__version=_e.version,_.memory.textures++);const Se=Ce.isWebGLCubeRenderTarget===!0,He=Ce.isWebGLMultipleRenderTargets===!0,gt=ie(Ce)||y;if(Se){it.__webglFramebuffer=[];for(let ee=0;ee<6;ee++)it.__webglFramebuffer[ee]=b.createFramebuffer()}else{if(it.__webglFramebuffer=b.createFramebuffer(),He)if(h.drawBuffers){const ee=Ce.texture;for(let _t=0,tt=ee.length;_t<tt;_t++){const Ct=u.get(ee[_t]);Ct.__webglTexture===void 0&&(Ct.__webglTexture=b.createTexture(),_.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(y&&Ce.samples>0&&Pn(Ce)===!1){const ee=He?_e:[_e];it.__webglMultisampledFramebuffer=b.createFramebuffer(),it.__webglColorRenderbuffer=[],l.bindFramebuffer(36160,it.__webglMultisampledFramebuffer);for(let _t=0;_t<ee.length;_t++){const tt=ee[_t];it.__webglColorRenderbuffer[_t]=b.createRenderbuffer(),b.bindRenderbuffer(36161,it.__webglColorRenderbuffer[_t]);const Ct=g.convert(tt.format,tt.encoding),Pt=g.convert(tt.type),cn=Ie(tt.internalFormat,Ct,Pt,tt.encoding),Rn=hi(Ce);b.renderbufferStorageMultisample(36161,Rn,cn,Ce.width,Ce.height),b.framebufferRenderbuffer(36160,36064+_t,36161,it.__webglColorRenderbuffer[_t])}b.bindRenderbuffer(36161,null),Ce.depthBuffer&&(it.__webglDepthRenderbuffer=b.createRenderbuffer(),en(it.__webglDepthRenderbuffer,Ce,!0)),l.bindFramebuffer(36160,null)}}if(Se){l.bindTexture(34067,qe.__webglTexture),dt(34067,_e,gt);for(let ee=0;ee<6;ee++)Mt(it.__webglFramebuffer[ee],Ce,_e,36064,34069+ee);se(_e,gt)&&le(34067),l.unbindTexture()}else if(He){const ee=Ce.texture;for(let _t=0,tt=ee.length;_t<tt;_t++){const Ct=ee[_t],Pt=u.get(Ct);l.bindTexture(3553,Pt.__webglTexture),dt(3553,Ct,gt),Mt(it.__webglFramebuffer,Ce,Ct,36064+_t,3553),se(Ct,gt)&&le(3553)}l.unbindTexture()}else{let ee=3553;(Ce.isWebGL3DRenderTarget||Ce.isWebGLArrayRenderTarget)&&(y?ee=Ce.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),l.bindTexture(ee,qe.__webglTexture),dt(ee,_e,gt),Mt(it.__webglFramebuffer,Ce,_e,36064,ee),se(_e,gt)&&le(ee),l.unbindTexture()}Ce.depthBuffer&&In(Ce)},this.updateRenderTargetMipmap=function(Ce){const _e=ie(Ce)||y,it=Ce.isWebGLMultipleRenderTargets===!0?Ce.texture:[Ce.texture],qe=Ce.isWebGLCubeRenderTarget?34067:3553;for(let Se=0,He=it.length;Se<He;Se++){const gt=it[Se],ee=u.get(gt),_t=ee.__webglTexture;ee.__version!==gt.version&&(l.bindTexture(qe,_t),dt(qe,gt,_e),l.unbindTexture(),ee.__version=gt.version),se(gt,_e)&&(l.bindTexture(qe,_t),le(qe),l.unbindTexture())}},this.updateMultisampleRenderTarget=function(Ce){if(y&&Ce.samples>0&&Pn(Ce)===!1){const _e=Ce.isWebGLMultipleRenderTargets?Ce.texture:[Ce.texture],it=Ce.width,qe=Ce.height;let Se=16384;const He=[],gt=Ce.stencilBuffer?33306:36096,ee=u.get(Ce),_t=Ce.isWebGLMultipleRenderTargets===!0;if(_t)for(let tt=0;tt<_e.length;tt++)l.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(36160,36064+tt,36161,null),l.bindFramebuffer(36160,ee.__webglFramebuffer),b.framebufferTexture2D(36009,36064+tt,3553,null,0);l.bindFramebuffer(36008,ee.__webglMultisampledFramebuffer),l.bindFramebuffer(36009,ee.__webglFramebuffer);for(let tt=0;tt<_e.length;tt++){He.push(36064+tt),Ce.depthBuffer&&He.push(gt);const Ct=ee.__ignoreDepthValues!==void 0&&ee.__ignoreDepthValues;if(Ct===!1&&(Ce.depthBuffer&&(Se|=256),Ce.stencilBuffer&&(Se|=1024)),_t&&b.framebufferRenderbuffer(36008,36064,36161,ee.__webglColorRenderbuffer[tt]),Ct===!0&&(b.invalidateFramebuffer(36008,[gt]),b.invalidateFramebuffer(36009,[gt])),_t){const Pt=u.get(_e[tt]).__webglTexture;b.framebufferTexture2D(36009,36064,3553,Pt,0)}b.blitFramebuffer(0,0,it,qe,0,0,it,qe,Se,9728),U&&b.invalidateFramebuffer(36008,He)}if(l.bindFramebuffer(36008,null),l.bindFramebuffer(36009,null),_t)for(let tt=0;tt<_e.length;tt++){l.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer),b.framebufferRenderbuffer(36160,36064+tt,36161,ee.__webglColorRenderbuffer[tt]);const Ct=u.get(_e[tt]).__webglTexture;l.bindFramebuffer(36160,ee.__webglFramebuffer),b.framebufferTexture2D(36009,36064+tt,3553,Ct,0)}l.bindFramebuffer(36009,ee.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=In,this.setupFrameBufferTexture=Mt,this.useMultisampledRTT=Pn}function Km(b,i,l){const u=l.isWebGL2;return{convert:function(h,g=null){let _;if(h===Aa)return 5121;if(h===qa)return 32819;if(h===yi)return 32820;if(h===Gs)return 5120;if(h===hd)return 5122;if(h===_h)return 5123;if(h===du)return 5124;if(h===Ne)return 5125;if(h===Qr)return 5126;if(h===ya)return u?5131:(_=i.get("OES_texture_half_float"),_!==null?_.HALF_FLOAT_OES:null);if(h===Tp)return 6406;if(h===Hs)return 6408;if(h===Ao)return 6409;if(h===dd)return 6410;if(h===yo)return 6402;if(h===Sl)return 34041;if(h===Ah)return 6403;if(h===Ip)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(h===bd)return _=i.get("EXT_sRGB"),_!==null?_.SRGB_ALPHA_EXT:null;if(h===no)return 36244;if(h===pd)return 33319;if(h===wm)return 33320;if(h===Ml)return 36249;if(h===io||h===Tl||h===Oi||h===bo)if(g===ui){if(_=i.get("WEBGL_compressed_texture_s3tc_srgb"),_===null)return null;if(h===io)return _.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(h===Tl)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(h===Oi)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(h===bo)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(_=i.get("WEBGL_compressed_texture_s3tc"),_===null)return null;if(h===io)return _.COMPRESSED_RGB_S3TC_DXT1_EXT;if(h===Tl)return _.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(h===Oi)return _.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(h===bo)return _.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(h===gs||h===pu||h===Kr||h===gn){if(_=i.get("WEBGL_compressed_texture_pvrtc"),_===null)return null;if(h===gs)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(h===pu)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(h===Kr)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(h===gn)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(h===uc)return _=i.get("WEBGL_compressed_texture_etc1"),_!==null?_.COMPRESSED_RGB_ETC1_WEBGL:null;if(h===An||h===Ko){if(_=i.get("WEBGL_compressed_texture_etc"),_===null)return null;if(h===An)return g===ui?_.COMPRESSED_SRGB8_ETC2:_.COMPRESSED_RGB8_ETC2;if(h===Ko)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:_.COMPRESSED_RGBA8_ETC2_EAC}if(h===Il||h===Si||h===li||h===Ya||h===yh||h===Dl||h===hc||h===ci||h===fd||h===dc||h===Pl||h===Rl||h===Li||h===Mi){if(_=i.get("WEBGL_compressed_texture_astc"),_===null)return null;if(h===Il)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:_.COMPRESSED_RGBA_ASTC_4x4_KHR;if(h===Si)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:_.COMPRESSED_RGBA_ASTC_5x4_KHR;if(h===li)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:_.COMPRESSED_RGBA_ASTC_5x5_KHR;if(h===Ya)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:_.COMPRESSED_RGBA_ASTC_6x5_KHR;if(h===yh)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:_.COMPRESSED_RGBA_ASTC_6x6_KHR;if(h===Dl)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:_.COMPRESSED_RGBA_ASTC_8x5_KHR;if(h===hc)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:_.COMPRESSED_RGBA_ASTC_8x6_KHR;if(h===ci)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:_.COMPRESSED_RGBA_ASTC_8x8_KHR;if(h===fd)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:_.COMPRESSED_RGBA_ASTC_10x5_KHR;if(h===dc)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:_.COMPRESSED_RGBA_ASTC_10x6_KHR;if(h===Pl)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:_.COMPRESSED_RGBA_ASTC_10x8_KHR;if(h===Rl)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:_.COMPRESSED_RGBA_ASTC_10x10_KHR;if(h===Li)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:_.COMPRESSED_RGBA_ASTC_12x10_KHR;if(h===Mi)return g===ui?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:_.COMPRESSED_RGBA_ASTC_12x12_KHR}if(h===Xa){if(_=i.get("EXT_texture_compression_bptc"),_===null)return null;if(h===Xa)return g===ui?_.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:_.COMPRESSED_RGBA_BPTC_UNORM_EXT}return h===mi?u?34042:(_=i.get("WEBGL_depth_texture"),_!==null?_.UNSIGNED_INT_24_8_WEBGL:null):b[h]!==void 0?b[h]:null}}}class o0 extends ws{constructor(i=[]){super(),this.isArrayCamera=!0,this.cameras=i}}class Lc extends ei{constructor(){super(),this.isGroup=!0,this.type="Group"}}const wA={type:"move"};class Jm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Lc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Lc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new he,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new he),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Lc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new he,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new he),this._grip}dispatchEvent(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this}disconnect(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(i,l,u){let h=null,g=null,_=null;const y=this._targetRay,C=this._grip,S=this._hand;if(i&&l.session.visibilityState!=="visible-blurred"){if(S&&i.hand){_=!0;for(const F of i.hand.values()){const H=l.getJointPose(F,u);if(S.joints[F.jointName]===void 0){const q=new Lc;q.matrixAutoUpdate=!1,q.visible=!1,S.joints[F.jointName]=q,S.add(q)}const W=S.joints[F.jointName];H!==null&&(W.matrix.fromArray(H.transform.matrix),W.matrix.decompose(W.position,W.rotation,W.scale),W.jointRadius=H.radius),W.visible=H!==null}const B=S.joints["index-finger-tip"],L=S.joints["thumb-tip"],k=B.position.distanceTo(L.position),U=.02,Q=.005;S.inputState.pinching&&k>U+Q?(S.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!S.inputState.pinching&&k<=U-Q&&(S.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else C!==null&&i.gripSpace&&(g=l.getPose(i.gripSpace,u),g!==null&&(C.matrix.fromArray(g.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),g.linearVelocity?(C.hasLinearVelocity=!0,C.linearVelocity.copy(g.linearVelocity)):C.hasLinearVelocity=!1,g.angularVelocity?(C.hasAngularVelocity=!0,C.angularVelocity.copy(g.angularVelocity)):C.hasAngularVelocity=!1));y!==null&&(h=l.getPose(i.targetRaySpace,u),h===null&&g!==null&&(h=g),h!==null&&(y.matrix.fromArray(h.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),h.linearVelocity?(y.hasLinearVelocity=!0,y.linearVelocity.copy(h.linearVelocity)):y.hasLinearVelocity=!1,h.angularVelocity?(y.hasAngularVelocity=!0,y.angularVelocity.copy(h.angularVelocity)):y.hasAngularVelocity=!1,this.dispatchEvent(wA)))}return y!==null&&(y.visible=h!==null),C!==null&&(C.visible=g!==null),S!==null&&(S.visible=_!==null),this}}class a0 extends Ur{constructor(i,l,u,h,g,_,y,C,S,B){if((B=B!==void 0?B:yo)!==yo&&B!==Sl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");u===void 0&&B===yo&&(u=Ne),u===void 0&&B===Sl&&(u=mi),super(null,h,g,_,y,C,B,u,S),this.isDepthTexture=!0,this.image={width:i,height:l},this.magFilter=y!==void 0?y:lr,this.minFilter=C!==void 0?C:lr,this.flipY=!1,this.generateMipmaps=!1}}class ef extends Vn{constructor(i,l){super();const u=this;let h=null,g=1,_=null,y="local-floor",C=null,S=null,B=null,L=null,k=null,U=null;const Q=l.getContextAttributes();let F=null,H=null;const W=[],q=[],$=new ws;$.layers.enable(1),$.viewport=new Ti;const ie=new ws;ie.layers.enable(2),ie.viewport=new Ti;const se=[$,ie],le=new o0;le.layers.enable(1),le.layers.enable(2);let Ie=null,De=null;function Xe(dt){const At=q.indexOf(dt.inputSource);if(At===-1)return;const Wt=W[At];Wt!==void 0&&Wt.dispatchEvent({type:dt.type,data:dt.inputSource})}function Ke(){h.removeEventListener("select",Xe),h.removeEventListener("selectstart",Xe),h.removeEventListener("selectend",Xe),h.removeEventListener("squeeze",Xe),h.removeEventListener("squeezestart",Xe),h.removeEventListener("squeezeend",Xe),h.removeEventListener("end",Ke),h.removeEventListener("inputsourceschange",Be);for(let dt=0;dt<W.length;dt++){const At=q[dt];At!==null&&(q[dt]=null,W[dt].disconnect(At))}Ie=null,De=null,i.setRenderTarget(F),k=null,L=null,B=null,h=null,H=null,rn.stop(),u.isPresenting=!1,u.dispatchEvent({type:"sessionend"})}function Be(dt){for(let At=0;At<dt.removed.length;At++){const Wt=dt.removed[At],Mt=q.indexOf(Wt);Mt>=0&&(q[Mt]=null,W[Mt].dispatchEvent({type:"disconnected",data:Wt}))}for(let At=0;At<dt.added.length;At++){const Wt=dt.added[At];let Mt=q.indexOf(Wt);if(Mt===-1){for(let In=0;In<W.length;In++){if(In>=q.length){q.push(Wt),Mt=In;break}if(q[In]===null){q[In]=Wt,Mt=In;break}}if(Mt===-1)break}const en=W[Mt];en&&en.dispatchEvent({type:"connected",data:Wt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(dt){let At=W[dt];return At===void 0&&(At=new Jm,W[dt]=At),At.getTargetRaySpace()},this.getControllerGrip=function(dt){let At=W[dt];return At===void 0&&(At=new Jm,W[dt]=At),At.getGripSpace()},this.getHand=function(dt){let At=W[dt];return At===void 0&&(At=new Jm,W[dt]=At),At.getHandSpace()},this.setFramebufferScaleFactor=function(dt){g=dt,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(dt){y=dt,u.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return C||_},this.setReferenceSpace=function(dt){C=dt},this.getBaseLayer=function(){return L!==null?L:k},this.getBinding=function(){return B},this.getFrame=function(){return U},this.getSession=function(){return h},this.setSession=async function(dt){if(h=dt,h!==null){if(F=i.getRenderTarget(),h.addEventListener("select",Xe),h.addEventListener("selectstart",Xe),h.addEventListener("selectend",Xe),h.addEventListener("squeeze",Xe),h.addEventListener("squeezestart",Xe),h.addEventListener("squeezeend",Xe),h.addEventListener("end",Ke),h.addEventListener("inputsourceschange",Be),Q.xrCompatible!==!0&&await l.makeXRCompatible(),h.renderState.layers===void 0||i.capabilities.isWebGL2===!1){const At={antialias:h.renderState.layers!==void 0||Q.antialias,alpha:Q.alpha,depth:Q.depth,stencil:Q.stencil,framebufferScaleFactor:g};k=new XRWebGLLayer(h,l,At),h.updateRenderState({baseLayer:k}),H=new qs(k.framebufferWidth,k.framebufferHeight,{format:Hs,type:Aa,encoding:i.outputEncoding,stencilBuffer:Q.stencil})}else{let At=null,Wt=null,Mt=null;Q.depth&&(Mt=Q.stencil?35056:33190,At=Q.stencil?Sl:yo,Wt=Q.stencil?mi:Ne);const en={colorFormat:32856,depthFormat:Mt,scaleFactor:g};B=new XRWebGLBinding(h,l),L=B.createProjectionLayer(en),h.updateRenderState({layers:[L]}),H=new qs(L.textureWidth,L.textureHeight,{format:Hs,type:Aa,depthTexture:new a0(L.textureWidth,L.textureHeight,Wt,void 0,void 0,void 0,void 0,void 0,void 0,At),stencilBuffer:Q.stencil,encoding:i.outputEncoding,samples:Q.antialias?4:0}),i.properties.get(H).__ignoreDepthValues=L.ignoreDepthValues}H.isXRRenderTarget=!0,this.setFoveation(1),C=null,_=await h.requestReferenceSpace(y),rn.setContext(h),rn.start(),u.isPresenting=!0,u.dispatchEvent({type:"sessionstart"})}};const St=new he,Ft=new he;function Et(dt,At){At===null?dt.matrixWorld.copy(dt.matrix):dt.matrixWorld.multiplyMatrices(At.matrixWorld,dt.matrix),dt.matrixWorldInverse.copy(dt.matrixWorld).invert()}this.updateCamera=function(dt){if(h===null)return;le.near=ie.near=$.near=dt.near,le.far=ie.far=$.far=dt.far,Ie===le.near&&De===le.far||(h.updateRenderState({depthNear:le.near,depthFar:le.far}),Ie=le.near,De=le.far);const At=dt.parent,Wt=le.cameras;Et(le,At);for(let en=0;en<Wt.length;en++)Et(Wt[en],At);le.matrixWorld.decompose(le.position,le.quaternion,le.scale),dt.matrix.copy(le.matrix),dt.matrix.decompose(dt.position,dt.quaternion,dt.scale);const Mt=dt.children;for(let en=0,In=Mt.length;en<In;en++)Mt[en].updateMatrixWorld(!0);Wt.length===2?function(en,In,hi){St.setFromMatrixPosition(In.matrixWorld),Ft.setFromMatrixPosition(hi.matrixWorld);const Pn=St.distanceTo(Ft),ri=In.projectionMatrix.elements,Ce=hi.projectionMatrix.elements,_e=ri[14]/(ri[10]-1),it=ri[14]/(ri[10]+1),qe=(ri[9]+1)/ri[5],Se=(ri[9]-1)/ri[5],He=(ri[8]-1)/ri[0],gt=(Ce[8]+1)/Ce[0],ee=_e*He,_t=_e*gt,tt=Pn/(-He+gt),Ct=tt*-He;In.matrixWorld.decompose(en.position,en.quaternion,en.scale),en.translateX(Ct),en.translateZ(tt),en.matrixWorld.compose(en.position,en.quaternion,en.scale),en.matrixWorldInverse.copy(en.matrixWorld).invert();const Pt=_e+tt,cn=it+tt,Rn=ee-Ct,zn=_t+(Pn-Ct),ti=qe*it/cn*Pt,Un=Se*it/cn*Pt;en.projectionMatrix.makePerspective(Rn,zn,ti,Un,Pt,cn)}(le,$,ie):le.projectionMatrix.copy($.projectionMatrix)},this.getCamera=function(){return le},this.getFoveation=function(){return L!==null?L.fixedFoveation:k!==null?k.fixedFoveation:void 0},this.setFoveation=function(dt){L!==null&&(L.fixedFoveation=dt),k!==null&&k.fixedFoveation!==void 0&&(k.fixedFoveation=dt)};let nn=null;this.onPreAnimationFrameCallback=null;const rn=new kc;rn.setAnimationLoop(function(dt,At){if(u.onPreAnimationFrameCallback&&u.onPreAnimationFrameCallback(dt,At),S=At.getViewerPose(C||_),U=At,S!==null){const Wt=S.views;k!==null&&(i.setRenderTargetFramebuffer(H,k.framebuffer),i.setRenderTarget(H));let Mt=!1;Wt.length!==le.cameras.length&&(le.cameras.length=0,Mt=!0);for(let en=0;en<Wt.length;en++){const In=Wt[en];let hi=null;if(k!==null)hi=k.getViewport(In);else{const ri=B.getViewSubImage(L,In);hi=ri.viewport,en===0&&(i.setRenderTargetTextures(H,ri.colorTexture,L.ignoreDepthValues?void 0:ri.depthStencilTexture),i.setRenderTarget(H))}let Pn=se[en];Pn===void 0&&(Pn=new ws,Pn.layers.enable(en),Pn.viewport=new Ti,se[en]=Pn),Pn.matrix.fromArray(In.transform.matrix),Pn.projectionMatrix.fromArray(In.projectionMatrix),Pn.viewport.set(hi.x,hi.y,hi.width,hi.height),en===0&&le.matrix.copy(Pn.matrix),Mt===!0&&le.cameras.push(Pn)}}for(let Wt=0;Wt<W.length;Wt++){const Mt=q[Wt],en=W[Wt];Mt!==null&&en!==void 0&&en.update(Mt,At,C||_)}nn&&nn(dt,At),U=null}),this.setAnimationLoop=function(dt){nn=dt},this.dispose=function(){}}}function xA(b,i){function l(u,h){u.opacity.value=h.opacity,h.color&&u.diffuse.value.copy(h.color),h.emissive&&u.emissive.value.copy(h.emissive).multiplyScalar(h.emissiveIntensity),h.map&&(u.map.value=h.map),h.alphaMap&&(u.alphaMap.value=h.alphaMap),h.bumpMap&&(u.bumpMap.value=h.bumpMap,u.bumpScale.value=h.bumpScale,h.side===me&&(u.bumpScale.value*=-1)),h.displacementMap&&(u.displacementMap.value=h.displacementMap,u.displacementScale.value=h.displacementScale,u.displacementBias.value=h.displacementBias),h.emissiveMap&&(u.emissiveMap.value=h.emissiveMap),h.normalMap&&(u.normalMap.value=h.normalMap,u.normalScale.value.copy(h.normalScale),h.side===me&&u.normalScale.value.negate()),h.specularMap&&(u.specularMap.value=h.specularMap),h.alphaTest>0&&(u.alphaTest.value=h.alphaTest);const g=i.get(h).envMap;if(g){u.envMap.value=g;const C=i.get(h).environment||g;u.envMapRotation.value=C?C.rotation:0,u.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,u.reflectivity.value=h.reflectivity,u.ior.value=h.ior,u.refractionRatio.value=h.refractionRatio}if(h.lightMap){u.lightMap.value=h.lightMap;const C=b.physicallyCorrectLights!==!0?Math.PI:1;u.lightMapIntensity.value=h.lightMapIntensity*C}let _,y;h.aoMap&&(u.aoMap.value=h.aoMap,u.aoMapIntensity.value=h.aoMapIntensity),h.map?_=h.map:h.specularMap?_=h.specularMap:h.displacementMap?_=h.displacementMap:h.normalMap?_=h.normalMap:h.bumpMap?_=h.bumpMap:h.roughnessMap?_=h.roughnessMap:h.metalnessMap?_=h.metalnessMap:h.alphaMap?_=h.alphaMap:h.emissiveMap?_=h.emissiveMap:h.clearcoatMap?_=h.clearcoatMap:h.clearcoatNormalMap?_=h.clearcoatNormalMap:h.clearcoatRoughnessMap?_=h.clearcoatRoughnessMap:h.iridescenceMap?_=h.iridescenceMap:h.iridescenceThicknessMap?_=h.iridescenceThicknessMap:h.specularIntensityMap?_=h.specularIntensityMap:h.specularColorMap?_=h.specularColorMap:h.transmissionMap?_=h.transmissionMap:h.thicknessMap?_=h.thicknessMap:h.sheenColorMap?_=h.sheenColorMap:h.sheenRoughnessMap&&(_=h.sheenRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),u.uvTransform.value.copy(_.matrix)),h.aoMap?y=h.aoMap:h.lightMap&&(y=h.lightMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),u.uv2Transform.value.copy(y.matrix))}return{refreshFogUniforms:function(u,h){u.fogColor.value.copy(h.color),h.isFog?(u.fogNear.value=h.near,u.fogFar.value=h.far):h.isFogExp2&&(u.fogDensity.value=h.density)},refreshMaterialUniforms:function(u,h,g,_,y){h.isMeshBasicMaterial||h.isMeshLambertMaterial?l(u,h):h.isMeshToonMaterial?(l(u,h),function(C,S){S.gradientMap&&(C.gradientMap.value=S.gradientMap)}(u,h)):h.isMeshPhongMaterial?(l(u,h),function(C,S){C.specular.value.copy(S.specular),C.shininess.value=Math.max(S.shininess,1e-4)}(u,h)):h.isMeshStandardMaterial?(l(u,h),function(C,S){C.roughness.value=S.roughness,C.metalness.value=S.metalness,S.roughnessMap&&(C.roughnessMap.value=S.roughnessMap),S.metalnessMap&&(C.metalnessMap.value=S.metalnessMap),i.get(S).envMap&&(C.envMapIntensity.value=S.envMapIntensity)}(u,h),h.isMeshPhysicalMaterial&&function(C,S,B){C.ior.value=S.ior,S.sheen>0&&(C.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),C.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(C.sheenColorMap.value=S.sheenColorMap),S.sheenRoughnessMap&&(C.sheenRoughnessMap.value=S.sheenRoughnessMap)),S.clearcoat>0&&(C.clearcoat.value=S.clearcoat,C.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(C.clearcoatMap.value=S.clearcoatMap),S.clearcoatRoughnessMap&&(C.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap),S.clearcoatNormalMap&&(C.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),C.clearcoatNormalMap.value=S.clearcoatNormalMap,S.side===me&&C.clearcoatNormalScale.value.negate())),S.iridescence>0&&(C.iridescence.value=S.iridescence,C.iridescenceIOR.value=S.iridescenceIOR,C.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],C.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(C.iridescenceMap.value=S.iridescenceMap),S.iridescenceThicknessMap&&(C.iridescenceThicknessMap.value=S.iridescenceThicknessMap)),S.transmission>0&&(C.transmission.value=S.transmission,C.transmissionSamplerMap.value=B.texture,C.transmissionSamplerSize.value.set(B.width,B.height),S.transmissionMap&&(C.transmissionMap.value=S.transmissionMap),C.thickness.value=S.thickness,S.thicknessMap&&(C.thicknessMap.value=S.thicknessMap),C.attenuationDistance.value=S.attenuationDistance,C.attenuationColor.value.copy(S.attenuationColor)),C.specularIntensity.value=S.specularIntensity,C.specularColor.value.copy(S.specularColor),S.specularIntensityMap&&(C.specularIntensityMap.value=S.specularIntensityMap),S.specularColorMap&&(C.specularColorMap.value=S.specularColorMap)}(u,h,y)):h.isMeshMatcapMaterial?(l(u,h),function(C,S){S.matcap&&(C.matcap.value=S.matcap)}(u,h)):h.isMeshDepthMaterial?l(u,h):h.isMeshDistanceMaterial?(l(u,h),function(C,S){C.referencePosition.value.copy(S.referencePosition),C.nearDistance.value=S.nearDistance,C.farDistance.value=S.farDistance}(u,h)):h.isMeshNormalMaterial?l(u,h):h.isLineBasicMaterial?(function(C,S){C.diffuse.value.copy(S.color),C.opacity.value=S.opacity}(u,h),h.isLineDashedMaterial&&function(C,S){C.dashSize.value=S.dashSize,C.totalSize.value=S.dashSize+S.gapSize,C.scale.value=S.scale}(u,h)):h.isPointsMaterial?function(C,S,B,L){let k;C.diffuse.value.copy(S.color),C.opacity.value=S.opacity,C.size.value=S.size*B,C.scale.value=.5*L,S.map&&(C.map.value=S.map),S.alphaMap&&(C.alphaMap.value=S.alphaMap),S.alphaTest>0&&(C.alphaTest.value=S.alphaTest),S.map?k=S.map:S.alphaMap&&(k=S.alphaMap),k!==void 0&&(k.matrixAutoUpdate===!0&&k.updateMatrix(),C.uvTransform.value.copy(k.matrix))}(u,h,g,_):h.isSpriteMaterial?function(C,S){let B;C.diffuse.value.copy(S.color),C.opacity.value=S.opacity,C.rotation.value=S.rotation,S.map&&(C.map.value=S.map),S.alphaMap&&(C.alphaMap.value=S.alphaMap),S.alphaTest>0&&(C.alphaTest.value=S.alphaTest),S.map?B=S.map:S.alphaMap&&(B=S.alphaMap),B!==void 0&&(B.matrixAutoUpdate===!0&&B.updateMatrix(),C.uvTransform.value.copy(B.matrix))}(u,h):h.isShadowMaterial?(u.color.value.copy(h.color),u.opacity.value=h.opacity):h.isShaderMaterial&&(h.transmission!==void 0&&(u.transmission&&(u.transmission.value=h.transmission),u.transmissionSamplerMap&&y&&(u.transmissionSamplerMap.value=y?y.texture:null),u.transmissionSamplerSize&&y&&u.transmissionSamplerSize.value.set(y.width,y.height)),h.uniformsNeedUpdate=!1)}}}function EA(b,i,l,u){let h={},g={},_=[];const y=l.isWebGL2?b.getParameter(35375):0;function C(L,k,U){const Q=L.value;if(U[k]===void 0)return U[k]=typeof Q=="number"?Q:Q.clone(),!0;if(typeof Q=="number"){if(U[k]!==Q)return U[k]=Q,!0}else{const F=U[k];if(F.equals(Q)===!1)return F.copy(Q),!0}return!1}function S(L){const k=L.value,U={boundary:0,storage:0};return typeof k=="number"?(U.boundary=4,U.storage=4):k.isVector2?(U.boundary=8,U.storage=8):k.isVector3||k.isColor?(U.boundary=16,U.storage=12):k.isVector4?(U.boundary=16,U.storage=16):k.isMatrix3?(U.boundary=48,U.storage=48):k.isMatrix4?(U.boundary=64,U.storage=64):k.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",k),U}function B(L){const k=L.target;k.removeEventListener("dispose",B);const U=_.indexOf(k.__bindingPointIndex);_.splice(U,1),b.deleteBuffer(h[k.id]),delete h[k.id],delete g[k.id]}return{bind:function(L,k){const U=k.program;u.uniformBlockBinding(L,U)},update:function(L,k){let U=h[L.id];U===void 0&&(function(H){const W=H.uniforms;let q=0,$=0;for(let ie=0,se=W.length;ie<se;ie++){const le=W[ie],Ie=S(le);if(le.__data=new Float32Array(Ie.storage/Float32Array.BYTES_PER_ELEMENT),le.__offset=q,ie>0){$=q%16;const De=16-$;$!==0&&De-Ie.boundary<0&&(q+=16-$,le.__offset=q)}q+=Ie.storage}$=q%16,$>0&&(q+=16-$),H.__size=q,H.__cache={}}(L),U=function(H){const W=function(){for(let se=0;se<y;se++)if(_.indexOf(se)===-1)return _.push(se),se;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();H.__bindingPointIndex=W;const q=b.createBuffer(),$=H.__size,ie=H.usage;return b.bindBuffer(35345,q),b.bufferData(35345,$,ie),b.bindBuffer(35345,null),b.bindBufferBase(35345,W,q),q}(L),h[L.id]=U,L.addEventListener("dispose",B));const Q=k.program;u.updateUBOMapping(L,Q);const F=i.render.frame;g[L.id]!==F&&(function(H){const W=h[H.id],q=H.uniforms,$=H.__cache;b.bindBuffer(35345,W);for(let ie=0,se=q.length;ie<se;ie++){const le=q[ie];if(C(le,ie,$)===!0){const Ie=le.value,De=le.__offset;typeof Ie=="number"?(le.__data[0]=Ie,b.bufferSubData(35345,De,le.__data)):(le.value.isMatrix3?(le.__data[0]=le.value.elements[0],le.__data[1]=le.value.elements[1],le.__data[2]=le.value.elements[2],le.__data[3]=le.value.elements[0],le.__data[4]=le.value.elements[3],le.__data[5]=le.value.elements[4],le.__data[6]=le.value.elements[5],le.__data[7]=le.value.elements[0],le.__data[8]=le.value.elements[6],le.__data[9]=le.value.elements[7],le.__data[10]=le.value.elements[8],le.__data[11]=le.value.elements[0]):Ie.toArray(le.__data),b.bufferSubData(35345,De,le.__data))}}b.bindBuffer(35345,null)}(L),g[L.id]=F)},dispose:function(){for(const L in h)b.deleteBuffer(h[L]);_=[],h={},g={}}}}function Tr(b={}){this.isWebGLRenderer=!0;const i=b.canvas!==void 0?b.canvas:function(){const be=Ec("canvas");return be.style.display="block",be}(),l=b.context!==void 0?b.context:null,u=b.depth===void 0||b.depth,h=b.stencil===void 0||b.stencil,g=b.antialias!==void 0&&b.antialias,_=b.premultipliedAlpha===void 0||b.premultipliedAlpha,y=b.preserveDrawingBuffer!==void 0&&b.preserveDrawingBuffer,C=b.powerPreference!==void 0?b.powerPreference:"default",S=b.failIfMajorPerformanceCaveat!==void 0&&b.failIfMajorPerformanceCaveat;let B;B=l!==null?l.getContextAttributes().alpha:b.alpha!==void 0&&b.alpha;let L=null,k=null;const U=[],Q=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Jo,this.physicallyCorrectLights=!1,this.toneMapping=pi,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const F=this;let H=!1,W=0,q=0,$=null,ie=-1,se=null;const le=new Ti,Ie=new Ti;let De=null,Xe=i.width,Ke=i.height,Be=1,St=null,Ft=null;const Et=new Ti(0,0,Xe,Ke),nn=new Ti(0,0,Xe,Ke);let rn=!1;const dt=new Vp;let At=!1,Wt=!1,Mt=null;const en=new Gn,In=new Lt,hi=new he,Pn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ri(){return $===null?Be:1}let Ce,_e,it,qe,Se,He,gt,ee,_t,tt,Ct,Pt,cn,Rn,zn,ti,Un,Qn,Ui,ca,$n,Gi,Hi,Wg,pn=l;function gy(be,bt){for(let kt=0;kt<be.length;kt++){const Dt=be[kt],Jt=i.getContext(Dt,bt);if(Jt!==null)return Jt}return null}try{const be={alpha:!0,depth:u,stencil:h,antialias:g,premultipliedAlpha:_,preserveDrawingBuffer:y,powerPreference:C,failIfMajorPerformanceCaveat:S};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${f}`),i.addEventListener("webglcontextlost",J0,!1),i.addEventListener("webglcontextrestored",_y,!1),i.addEventListener("webglcontextcreationerror",Z0,!1),pn===null){const bt=["webgl2","webgl","experimental-webgl"];if(F.isWebGL1Renderer===!0&&bt.shift(),pn=gy(bt,be),pn===null)throw gy(bt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}pn.getShaderPrecisionFormat===void 0&&(pn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(be){throw console.error("THREE.WebGLRenderer: "+be.message),be}function vy(){Ce=new ln(pn),_e=new Q_(pn,Ce,b),Ce.init(_e),Gi=new Km(pn,Ce,_e),it=new r0(pn,Ce,_e),qe=new sl,Se=new gA,He=new s0(pn,Ce,it,Se,_e,Gi,qe),gt=new fw(F),ee=new H_(F),_t=new Ud(pn,_e),Hi=new dw(pn,Ce,_t,_e),tt=new Zn(pn,_t,qe,Hi),Ct=new qi(pn,tt,_t,qe),Ui=new W_(pn,_e,He),ti=new pw(Se),Pt=new Aw(F,gt,ee,Ce,_e,Hi,ti),cn=new xA(F,Se),Rn=new n0,zn=new yA(Ce,_e),Qn=new hw(F,gt,it,Ct,B,_),Un=new bA(F,Ct,_e),Wg=new EA(pn,qe,_e,it),ca=new z_(pn,Ce,qe,_e),$n=new Fd(pn,Ce,qe,_e),qe.programs=Pt.programs,F.capabilities=_e,F.extensions=Ce,F.properties=Se,F.renderLists=Rn,F.shadowMap=Un,F.state=it,F.info=qe,F.background=Qn,F.cubeuvmaps=ee}vy();const po=new ef(F,pn);function J0(be){be.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),H=!0}function _y(){console.log("THREE.WebGLRenderer: Context Restored."),H=!1;const be=qe.autoReset,bt=Un.enabled,kt=Un.autoUpdate,Dt=Un.needsUpdate,Jt=Un.type;vy(),qe.autoReset=be,Un.enabled=bt,Un.autoUpdate=kt,Un.needsUpdate=Dt,Un.type=Jt}function Z0(be){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",be.statusMessage)}function _i(be){const bt=be.target;bt.removeEventListener("dispose",_i),function(kt){(function(Dt){const Jt=Se.get(Dt).programs;Jt!==void 0&&(Jt.forEach(function(xn){Pt.releaseProgram(xn)}),Dt.isShaderMaterial&&Pt.releaseShaderCache(Dt))})(kt),Se.remove(kt)}(bt)}this.xr=po,this.getContext=function(){return pn},this.getContextAttributes=function(){return pn.getContextAttributes()},this.forceContextLoss=function(){const be=Ce.get("WEBGL_lose_context");be&&be.loseContext()},this.forceContextRestore=function(){const be=Ce.get("WEBGL_lose_context");be&&be.restoreContext()},this.getPixelRatio=function(){return Be},this.setPixelRatio=function(be){be!==void 0&&(Be=be,this.setSize(Xe,Ke,!1))},this.getSize=function(be){return be.set(Xe,Ke)},this.setSize=function(be,bt,kt){po.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Xe=be,Ke=bt,i.width=Math.floor(be*Be),i.height=Math.floor(bt*Be),kt!==!1&&(i.style.width=be+"px",i.style.height=bt+"px"),this.setViewport(0,0,be,bt))},this.getDrawingBufferSize=function(be){return be.set(Xe*Be,Ke*Be).floor()},this.setDrawingBufferSize=function(be,bt,kt){Xe=be,Ke=bt,Be=kt,i.width=Math.floor(be*kt),i.height=Math.floor(bt*kt),this.setViewport(0,0,be,bt)},this.getCurrentViewport=function(be){return be.copy(le)},this.getViewport=function(be){return be.copy(Et)},this.setViewport=function(be,bt,kt,Dt){be.isVector4?Et.set(be.x,be.y,be.z,be.w):Et.set(be,bt,kt,Dt),it.viewport(le.copy(Et).multiplyScalar(Be).floor())},this.getScissor=function(be){return be.copy(nn)},this.setScissor=function(be,bt,kt,Dt){be.isVector4?nn.set(be.x,be.y,be.z,be.w):nn.set(be,bt,kt,Dt),it.scissor(Ie.copy(nn).multiplyScalar(Be).floor())},this.getScissorTest=function(){return rn},this.setScissorTest=function(be){it.setScissorTest(rn=be)},this.setOpaqueSort=function(be){St=be},this.setTransparentSort=function(be){Ft=be},this.getClearColor=function(be){return be.copy(Qn.getClearColor())},this.setClearColor=function(){Qn.setClearColor.apply(Qn,arguments)},this.getClearAlpha=function(){return Qn.getClearAlpha()},this.setClearAlpha=function(){Qn.setClearAlpha.apply(Qn,arguments)},this.clear=function(be=!0,bt=!0,kt=!0){let Dt=0;be&&(Dt|=16384),bt&&(Dt|=256),kt&&(Dt|=1024),pn.clear(Dt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",J0,!1),i.removeEventListener("webglcontextrestored",_y,!1),i.removeEventListener("webglcontextcreationerror",Z0,!1),Rn.dispose(),zn.dispose(),Se.dispose(),gt.dispose(),ee.dispose(),Ct.dispose(),Hi.dispose(),Wg.dispose(),Pt.dispose(),po.dispose(),po.removeEventListener("sessionstart",fo),po.removeEventListener("sessionend",Ay),Mt&&(Mt.dispose(),Mt=null),Jh.stop()},this.renderBufferDirect=function(be,bt,kt,Dt,Jt,xn){bt===null&&(bt=Pn);const xi=Jt.isMesh&&Jt.matrixWorld.determinant()<0,Fn=function(Ls,Yf,vl,qn,Ss){Yf.isScene!==!0&&(Yf=Pn),He.resetTextureUnits();const Kg=Yf.fog,n_=qn.isMeshStandardMaterial?Yf.environment:null,wy=$===null?F.outputEncoding:$.isXRRenderTarget===!0||$.texture.encoding&&$.texture.encoding!==ui?$.texture.encoding:Jo,Xf=(qn.isMeshStandardMaterial?ee:gt).get(qn.envMap||n_),Na=qn.vertexColors===!0&&!!vl.attributes.color&&vl.attributes.color.itemSize===4,Tw=!!qn.normalMap&&!!vl.attributes.tangent,xy=!!vl.morphAttributes.position,i_=!!vl.morphAttributes.normal,Iw=!!vl.morphAttributes.color,Dw=qn.toneMapped?F.toneMapping:pi,Jg=vl.morphAttributes.position||vl.morphAttributes.normal||vl.morphAttributes.color,Pw=Jg!==void 0?Jg.length:0,Yi=Se.get(qn),Ey=k.state.lights;if(At===!0&&(Wt===!0||Ls!==se)){const go=Ls===se&&qn.id===ie;ti.setState(qn,Ls,go)}let nc=!1;qn.version===Yi.__version?Yi.needsLights&&Yi.lightsStateVersion!==Ey.state.version||Yi.outputEncoding!==wy||Ss.isInstancedMesh&&Yi.instancing===!1?nc=!0:Ss.isInstancedMesh||Yi.instancing!==!0?Ss.isSkinnedMesh&&Yi.skinning===!1?nc=!0:Ss.isSkinnedMesh||Yi.skinning!==!0?Yi.envMap!==Xf||qn.fog===!0&&Yi.fog!==Kg?nc=!0:Yi.numClippingPlanes===void 0||Yi.numClippingPlanes===ti.numPlanes&&Yi.numIntersection===ti.numIntersection?(Yi.vertexAlphas!==Na||Yi.vertexTangents!==Tw||Yi.morphTargets!==xy||Yi.morphNormals!==i_||Yi.morphColors!==Iw||Yi.toneMapping!==Dw||_e.isWebGL2===!0&&Yi.morphTargetsCount!==Pw)&&(nc=!0):nc=!0:nc=!0:nc=!0:(nc=!0,Yi.__version=qn.version);let ic=Yi.currentProgram;nc===!0&&(ic=Hf(qn,Yf,Ss));let Zg=!1,Zh=!1,mo=!1;const Ns=ic.getUniforms(),_l=Yi.uniforms;if(it.useProgram(ic.program)&&(Zg=!0,Zh=!0,mo=!0),qn.id!==ie&&(ie=qn.id,Zh=!0),Zg||se!==Ls){if(Ns.setValue(pn,"projectionMatrix",Ls.projectionMatrix),_e.logarithmicDepthBuffer&&Ns.setValue(pn,"logDepthBufFC",2/(Math.log(Ls.far+1)/Math.LN2)),se!==Ls&&(se=Ls,Zh=!0,mo=!0),qn.isShaderMaterial||qn.isMeshPhongMaterial||qn.isMeshToonMaterial||qn.isMeshStandardMaterial||qn.envMap){const go=Ns.map.cameraPosition;go!==void 0&&go.setValue(pn,hi.setFromMatrixPosition(Ls.matrixWorld))}(qn.isMeshPhongMaterial||qn.isMeshToonMaterial||qn.isMeshLambertMaterial||qn.isMeshBasicMaterial||qn.isMeshStandardMaterial||qn.isShaderMaterial)&&Ns.setValue(pn,"isOrthographic",Ls.isOrthographicCamera===!0),(qn.isMeshPhongMaterial||qn.isMeshToonMaterial||qn.isMeshLambertMaterial||qn.isMeshBasicMaterial||qn.isMeshStandardMaterial||qn.isShaderMaterial||qn.isShadowMaterial||Ss.isSkinnedMesh)&&Ns.setValue(pn,"viewMatrix",Ls.matrixWorldInverse)}if(Ss.isSkinnedMesh){Ns.setOptional(pn,Ss,"bindMatrix"),Ns.setOptional(pn,Ss,"bindMatrixInverse");const go=Ss.skeleton;go&&(_e.floatVertexTextures?(go.boneTexture===null&&go.computeBoneTexture(),Ns.setValue(pn,"boneTexture",go.boneTexture,He),Ns.setValue(pn,"boneTextureSize",go.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const $g=vl.morphAttributes;var Ua,Fa;($g.position!==void 0||$g.normal!==void 0||$g.color!==void 0&&_e.isWebGL2===!0)&&Ui.update(Ss,vl,qn,ic),(Zh||Yi.receiveShadow!==Ss.receiveShadow)&&(Yi.receiveShadow=Ss.receiveShadow,Ns.setValue(pn,"receiveShadow",Ss.receiveShadow)),qn.isMeshGouraudMaterial&&qn.envMap!==null&&(_l.envMap.value=Xf,_l.flipEnvMap.value=Xf.isCubeTexture&&Xf.isRenderTargetTexture===!1?-1:1),Zh&&(Ns.setValue(pn,"toneMappingExposure",F.toneMappingExposure),Yi.needsLights&&(Fa=mo,(Ua=_l).ambientLightColor.needsUpdate=Fa,Ua.lightProbe.needsUpdate=Fa,Ua.directionalLights.needsUpdate=Fa,Ua.directionalLightShadows.needsUpdate=Fa,Ua.pointLights.needsUpdate=Fa,Ua.pointLightShadows.needsUpdate=Fa,Ua.spotLights.needsUpdate=Fa,Ua.spotLightShadows.needsUpdate=Fa,Ua.rectAreaLights.needsUpdate=Fa,Ua.hemisphereLights.needsUpdate=Fa),Kg&&qn.fog===!0&&cn.refreshFogUniforms(_l,Kg),cn.refreshMaterialUniforms(_l,qn,Be,Ke,F.userData.transmissionRenderTarget||Mt),Gm.upload(pn,Yi.uniformsList,_l,He)),qn.isShaderMaterial&&qn.uniformsNeedUpdate===!0&&(Gm.upload(pn,Yi.uniformsList,_l,He),qn.uniformsNeedUpdate=!1),qn.isSpriteMaterial&&Ns.setValue(pn,"center",Ss.center),Ns.setValue(pn,"modelViewMatrix",Ss.modelViewMatrix),Ns.setValue(pn,"normalMatrix",Ss.normalMatrix),Ns.setValue(pn,"modelMatrix",Ss.matrixWorld);const r_=qn.extraUniformsToUpload;if(r_&&Object.entries(r_).forEach(([go,Kf])=>Ns.setValue(pn,go,Kf.value,He)),qn.isShaderMaterial||qn.isRawShaderMaterial){const go=qn.uniformsGroups;for(let Kf=0,Rw=go.length;Kf<Rw;Kf++)if(_e.isWebGL2){const Cy=go[Kf];Wg.update(Cy,ic),Wg.bind(Cy,ic)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ic}(be,bt,kt,Dt,Jt);it.setMaterial(Dt,xi);let di=kt.index;const Ar=kt.attributes.position;if(di===null){if(Ar===void 0||Ar.count===0)return}else if(di.count===0)return;let Ei,oi=1;Dt.wireframe===!0&&(di=tt.getWireframeAttribute(kt),oi=2),Hi.setup(Jt,Dt,Fn,kt,di);let qr=ca;di!==null&&(Ei=_t.get(di),qr=$n,qr.setIndex(Ei));const Wf=di!==null?di.count:Ar.count,La=kt.drawRange.start*oi,Yg=kt.drawRange.count*oi,tc=xn!==null?xn.start*oi:0,e_=xn!==null?xn.count*oi:1/0,Xg=Math.max(La,tc),t_=Math.min(Wf,La+Yg,tc+e_)-1,qf=Math.max(0,t_-Xg+1);if(qf!==0){if(Jt.isMesh)Dt.wireframe===!0?(it.setLineWidth(Dt.wireframeLinewidth*ri()),qr.setMode(1)):qr.setMode(4);else if(Jt.isLine){let Ls=Dt.linewidth;Ls===void 0&&(Ls=1),it.setLineWidth(Ls*ri()),Jt.isLineSegments?qr.setMode(1):Jt.isLineLoop?qr.setMode(2):qr.setMode(3)}else Jt.isPoints?qr.setMode(0):Jt.isSprite&&qr.setMode(4);if(Jt.isInstancedMesh)qr.renderInstances(Xg,qf,Jt.count);else if(kt.isInstancedBufferGeometry){const Ls=Math.min(kt.instanceCount,kt._maxInstanceCount);qr.renderInstances(Xg,qf,Ls)}else qr.render(Xg,qf)}},this.compile=function(be,bt){function kt(Dt,Jt,xn){Dt.transparent===!0&&Dt.side===Te?(Dt.side=me,Dt.needsUpdate=!0,Hf(Dt,Jt,xn),Dt.side=je,Dt.needsUpdate=!0,Hf(Dt,Jt,xn),Dt.side=Te):Hf(Dt,Jt,xn)}k=zn.get(be),k.init(),Q.push(k),be.traverseVisible(function(Dt){Dt.isLight&&Dt.layers.test(bt.layers)&&(k.pushLight(Dt),Dt.castShadow&&k.pushShadow(Dt))}),k.setupLights(F.physicallyCorrectLights),be.traverse(function(Dt){const Jt=Dt.material;if(Jt)if(Array.isArray(Jt))for(let xn=0;xn<Jt.length;xn++)kt(Jt[xn],be,Dt);else kt(Jt,be,Dt)}),Q.pop(),k=null};let Rr=null;function fo(){Jh.stop()}function Ay(){Jh.start()}const Jh=new kc;function yy(be,bt,kt,Dt){if(be.visible===!1)return;if(be.layers.test(bt.layers)){if(be.isGroup)kt=be.renderOrder;else if(be.isLOD)be.autoUpdate===!0&&be.update(bt);else if(be.isLight)k.pushLight(be),be.castShadow&&k.pushShadow(be);else if(be.isSprite){if(!be.frustumCulled||dt.intersectsSprite(be)){Dt&&hi.setFromMatrixPosition(be.matrixWorld).applyMatrix4(en);const xn=Ct.update(be),xi=be.material;xi.visible&&L.push(be,xn,xi,kt,hi.z,null)}}else if((be.isMesh||be.isLine||be.isPoints)&&(be.isSkinnedMesh&&be.skeleton.frame!==qe.render.frame&&(be.skeleton.update(),be.skeleton.frame=qe.render.frame),!be.frustumCulled||dt.intersectsObject(be))){Dt&&hi.setFromMatrixPosition(be.matrixWorld).applyMatrix4(en);const xn=Ct.update(be),xi=be.material;if(Array.isArray(xi)){const Fn=xn.groups;for(let di=0,Ar=Fn.length;di<Ar;di++){const Ei=Fn[di],oi=xi[Ei.materialIndex];oi&&oi.visible&&L.push(be,xn,oi,kt,hi.z,Ei)}}else xi.visible&&L.push(be,xn,xi,kt,hi.z,null)}}const Jt=be.children;for(let xn=0,xi=Jt.length;xn<xi;xn++)yy(Jt[xn],bt,kt,Dt)}function by(be,bt,kt,Dt){const Jt=be.opaque,xn=be.transmissive,xi=be.transparent;if(k.setupLightsView(kt),F.userData.transmissionRender===void 0&&F.userData.renderTransmissionPass!==!1&&xn.length>0&&function(Fn,di,Ar){console.error("three.js internal render transmission pass should not be called");const Ei=_e.isWebGL2;Mt===null&&(Mt=new qs(1,1,{generateMipmaps:!0,type:Ce.has("EXT_color_buffer_half_float")?ya:Aa,minFilter:Pi,samples:Ei&&g===!0?4:0})),F.getDrawingBufferSize(In),Ei?Mt.setSize(In.x,In.y):Mt.setSize(Ds(In.x),Ds(In.y));const oi=F.getRenderTarget();F.setRenderTarget(Mt),F.clear();const qr=F.toneMapping;F.toneMapping=pi,qg(Fn,di,Ar),F.toneMapping=qr,He.updateMultisampleRenderTarget(Mt),He.updateRenderTargetMipmap(Mt),F.setRenderTarget(oi)}([...Jt,...xi],bt,kt),Dt&&it.viewport(le.copy(Dt)),F.userData.opaqueRender!==!1&&Jt.length>0&&qg(Jt,bt,kt),F.userData.transparentRender!==!1&&xi.length>0&&qg(xi,bt,kt),F.userData.transmissionRender!==!1&&xn.length>0){Mt||(Mt=new qs(1,1));const Fn=F.userData.transmissionRenderTarget.texture,di=_e.isWebGL2,Ar=Fn.generateMipmaps,Ei=Fn.minFilter;di&&F.userData.blurTransmissionTarget&&(Fn.generateMipmaps=!0,Fn.minFilter=Pi,Fn.needsUpdate=!0,He.updateRenderTargetMipmap(F.userData.transmissionRenderTarget)),qg(xn,bt,kt),di&&F.userData.blurTransmissionTarget&&(Fn.generateMipmaps=Ar,Fn.minFilter=Ei,Fn.needsUpdate=!0,He.updateRenderTargetMipmap(F.userData.transmissionRenderTarget))}it.buffers.depth.setTest(!0),it.buffers.depth.setMask(!0),it.buffers.color.setMask(!0),it.setPolygonOffset(!1)}function qg(be,bt,kt){const Dt={...F.userData};F.userData.opaqueRender=void 0,F.userData.transparentRender=void 0,F.userData.transmissionRender=void 0,F.userData.backgroundRender=void 0;const Jt=bt.isScene===!0?bt.overrideMaterial:null;for(let xn=0,xi=be.length;xn<xi;xn++){const Fn=be[xn],di=Fn.object,Ar=Fn.geometry,Ei=Jt===null?Fn.material:Jt,oi=Fn.group;di.layers.test(kt.layers)&&Mw(di,bt,kt,Ar,Ei,oi)}Object.assign(F.userData,Dt)}function Mw(be,bt,kt,Dt,Jt,xn){be.onBeforeRender(F,bt,kt,Dt,Jt,xn),be.modelViewMatrix.multiplyMatrices(kt.matrixWorldInverse,be.matrixWorld),be.normalMatrix.getNormalMatrix(be.modelViewMatrix),Jt.onBeforeRender(F,bt,kt,Dt,be,xn),Jt.transparent===!0&&Jt.side===Te?(Jt.side=me,Jt.needsUpdate=!0,F.renderBufferDirect(kt,bt,Dt,Jt,be,xn),Jt.side=je,Jt.needsUpdate=!0,F.renderBufferDirect(kt,bt,Dt,Jt,be,xn),Jt.side=Te):F.renderBufferDirect(kt,bt,Dt,Jt,be,xn),be.onAfterRender(F,bt,kt,Dt,Jt,xn),Jt.onAfterRender(F,bt,kt,Dt,be,xn)}function Hf(be,bt,kt){bt.isScene!==!0&&(bt=Pn);const Dt=Se.get(be),Jt=k.state.lights,xn=k.state.shadowsArray,xi=Jt.state.version,Fn=Pt.getParameters(be,Jt.state,xn,bt,kt),di=Pt.getProgramCacheKey(Fn);let Ar=Dt.programs;Dt.environment=be.isMeshStandardMaterial?bt.environment:null,Dt.fog=bt.fog,Dt.envMap=(be.isMeshStandardMaterial?ee:gt).get(be.envMap||Dt.environment),Ar===void 0&&(be.addEventListener("dispose",_i),Ar=new Map,Dt.programs=Ar);let Ei=Ar.get(di);if(Ei!==void 0){if(Dt.currentProgram===Ei&&Dt.lightsStateVersion===xi)return $0(be,Fn),Ei}else Fn.uniforms=Pt.getUniforms(be),be.onBuild(kt,Fn,F),be.onBeforeCompile(Fn,F),Ei=Pt.acquireProgram(Fn,di),Ar.set(di,Ei),Dt.uniforms=Fn.uniforms;const oi=Dt.uniforms;(be.isShaderMaterial||be.isRawShaderMaterial)&&be.clipping!==!0||(oi.clippingPlanes=ti.uniform),$0(be,Fn),Dt.needsLights=function(La){return La.isMeshLambertMaterial||La.isMeshToonMaterial||La.isMeshPhongMaterial||La.isMeshStandardMaterial||La.isShadowMaterial||La.isShaderMaterial&&La.lights===!0}(be),Dt.lightsStateVersion=xi,Dt.needsLights&&(oi.ambientLightColor.value=Jt.state.ambient,oi.lightProbe.value=Jt.state.probe,oi.directionalLights.value=Jt.state.directional,oi.directionalLightShadows.value=Jt.state.directionalShadow,oi.spotLights.value=Jt.state.spot,oi.spotLightShadows.value=Jt.state.spotShadow,oi.rectAreaLights.value=Jt.state.rectArea,oi.ltc_1.value=Jt.state.rectAreaLTC1,oi.ltc_2.value=Jt.state.rectAreaLTC2,oi.pointLights.value=Jt.state.point,oi.pointLightShadows.value=Jt.state.pointShadow,oi.hemisphereLights.value=Jt.state.hemi,oi.directionalShadowMap.value=Jt.state.directionalShadowMap,oi.directionalShadowMatrix.value=Jt.state.directionalShadowMatrix,oi.spotShadowMap.value=Jt.state.spotShadowMap,oi.spotLightMatrix.value=Jt.state.spotLightMatrix,oi.spotLightMap.value=Jt.state.spotLightMap,oi.pointShadowMap.value=Jt.state.pointShadowMap,oi.pointShadowMatrix.value=Jt.state.pointShadowMatrix);const qr=Ei.getUniforms(),Wf=Gm.seqWithValue(qr.seq,oi);return Dt.currentProgram=Ei,Dt.uniformsList=Wf,Ei}function $0(be,bt){const kt=Se.get(be);kt.outputEncoding=bt.outputEncoding,kt.instancing=bt.instancing,kt.skinning=bt.skinning,kt.morphTargets=bt.morphTargets,kt.morphNormals=bt.morphNormals,kt.morphColors=bt.morphColors,kt.morphTargetsCount=bt.morphTargetsCount,kt.numClippingPlanes=bt.numClippingPlanes,kt.numIntersection=bt.numClipIntersection,kt.vertexAlphas=bt.vertexAlphas,kt.vertexTangents=bt.vertexTangents,kt.toneMapping=bt.toneMapping}Jh.setAnimationLoop(function(be){Rr&&Rr(be)}),typeof self<"u"&&Jh.setContext(self),this.setAnimationLoop=function(be){Rr=be,po.setAnimationLoop(be),be===null?Jh.stop():Jh.start()},po.addEventListener("sessionstart",fo),po.addEventListener("sessionend",Ay),this.render=function(be,bt){if(bt===void 0||bt.isCamera===!0){if(H!==!0){if(be.matrixWorldAutoUpdate===!0&&be.updateMatrixWorld(),bt.parent===null&&bt.matrixWorldAutoUpdate===!0&&bt.updateMatrixWorld(),po.enabled===!0&&po.isPresenting===!0&&(po.cameraAutoUpdate===!0&&po.updateCamera(bt),bt=po.getCamera()),be.isScene===!0&&be.onBeforeRender(F,be,bt,$),k=zn.get(be,Q.length),k.init(),Q.push(k),en.multiplyMatrices(bt.projectionMatrix,bt.matrixWorldInverse),dt.setFromProjectionMatrix(en),Wt=this.localClippingEnabled,At=ti.init(this.clippingPlanes,Wt,bt),L=Rn.get(be,U.length),L.init(),U.push(L),yy(be,bt,0,F.sortObjects),L.finish(),F.sortObjects===!0&&L.sort(St,Ft),F.userData.shadowMapRender){At===!0&&ti.beginShadows();const kt=k.state.shadowsArray;kt.length>0&&Un.render(kt,be,bt),At===!0&&ti.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),F.userData.backgroundRender!==!1&&Qn.render(L,be),F.userData.sceneRender!==!1)if(k.setupLights(F.physicallyCorrectLights),bt.isArrayCamera){const kt=bt.cameras;for(let Dt=0,Jt=kt.length;Dt<Jt;Dt++){const xn=kt[Dt];by(L,be,xn,xn.viewport)}}else by(L,be,bt);$!==null&&(He.updateMultisampleRenderTarget($),He.updateRenderTargetMipmap($)),be.isScene===!0&&be.onAfterRender(F,be,bt),Hi.resetDefaultState(),ie=-1,se=null,Q.pop(),k=Q.length>0?Q[Q.length-1]:null,U.pop(),L=U.length>0?U[U.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return W},this.getActiveMipmapLevel=function(){return q},this.getRenderTarget=function(){return $},this.setRenderTargetTextures=function(be,bt,kt){Se.get(be.texture).__webglTexture=bt,Se.get(be.depthTexture).__webglTexture=kt;const Dt=Se.get(be);Dt.__hasExternalTextures=!0,Dt.__hasExternalTextures&&(Dt.__autoAllocateDepthBuffer=kt===void 0,Dt.__autoAllocateDepthBuffer||Ce.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Dt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(be,bt){const kt=Se.get(be);kt.__webglFramebuffer=bt,kt.__useDefaultFramebuffer=bt===void 0},this.setRenderTarget=function(be,bt=0,kt=0){$=be,W=bt,q=kt;let Dt=!0;if(be){const Fn=Se.get(be);Fn.__useDefaultFramebuffer!==void 0?(it.bindFramebuffer(36160,null),Dt=!1):Fn.__webglFramebuffer===void 0?He.setupRenderTarget(be):Fn.__hasExternalTextures&&He.rebindTextures(be,Se.get(be.texture).__webglTexture,Se.get(be.depthTexture).__webglTexture)}let Jt=null,xn=!1,xi=!1;if(be){const Fn=be.texture;(Fn.isData3DTexture||Fn.isDataArrayTexture)&&(xi=!0);const di=Se.get(be).__webglFramebuffer;be.isWebGLCubeRenderTarget?(Jt=di[bt],xn=!0):Jt=_e.isWebGL2&&be.samples>0&&He.useMultisampledRTT(be)===!1?Se.get(be).__webglMultisampledFramebuffer:di,le.copy(be.viewport),Ie.copy(be.scissor),De=be.scissorTest}else le.copy(Et).multiplyScalar(Be).floor(),Ie.copy(nn).multiplyScalar(Be).floor(),De=rn;if(it.bindFramebuffer(36160,Jt)&&_e.drawBuffers&&Dt&&it.drawBuffers(be,Jt),it.viewport(le),it.scissor(Ie),it.setScissorTest(De),xn){const Fn=Se.get(be.texture);pn.framebufferTexture2D(36160,36064,34069+bt,Fn.__webglTexture,kt)}else if(xi){const Fn=Se.get(be.texture),di=bt||0;pn.framebufferTextureLayer(36160,36064,Fn.__webglTexture,kt||0,di)}ie=-1},this.readRenderTargetPixels=function(be,bt,kt,Dt,Jt,xn,xi){if(!be||!be.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Fn=Se.get(be).__webglFramebuffer;if(be.isWebGLCubeRenderTarget&&xi!==void 0&&(Fn=Fn[xi]),Fn){it.bindFramebuffer(36160,Fn);try{const di=be.texture,Ar=di.format,Ei=di.type;if(Ar!==Hs&&Gi.convert(Ar)!==pn.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const oi=Ei===ya&&(Ce.has("EXT_color_buffer_half_float")||_e.isWebGL2&&Ce.has("EXT_color_buffer_float"));if(!(Ei===Aa||Gi.convert(Ei)===pn.getParameter(35738)||Ei===Qr&&(_e.isWebGL2||Ce.has("OES_texture_float")||Ce.has("WEBGL_color_buffer_float"))||oi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");bt>=0&&bt<=be.width-Dt&&kt>=0&&kt<=be.height-Jt&&pn.readPixels(bt,kt,Dt,Jt,Gi.convert(Ar),Gi.convert(Ei),xn)}finally{const di=$!==null?Se.get($).__webglFramebuffer:null;it.bindFramebuffer(36160,di)}}},this.copyFramebufferToTexture=function(be,bt,kt=0){const Dt=Math.pow(2,-kt),Jt=Math.floor(bt.image.width*Dt),xn=Math.floor(bt.image.height*Dt);He.setTexture2D(bt,0),pn.copyTexSubImage2D(3553,kt,0,0,be.x,be.y,Jt,xn),it.unbindTexture()},this.copyTextureToTexture=function(be,bt,kt,Dt=0){const Jt=bt.image.width,xn=bt.image.height,xi=Gi.convert(kt.format),Fn=Gi.convert(kt.type);He.setTexture2D(kt,0),pn.pixelStorei(37440,kt.flipY),pn.pixelStorei(37441,kt.premultiplyAlpha),pn.pixelStorei(3317,kt.unpackAlignment),bt.isDataTexture?pn.texSubImage2D(3553,Dt,be.x,be.y,Jt,xn,xi,Fn,bt.image.data):bt.isCompressedTexture?pn.compressedTexSubImage2D(3553,Dt,be.x,be.y,bt.mipmaps[0].width,bt.mipmaps[0].height,xi,bt.mipmaps[0].data):pn.texSubImage2D(3553,Dt,be.x,be.y,xi,Fn,bt.image),Dt===0&&kt.generateMipmaps&&pn.generateMipmap(3553),it.unbindTexture()},this.copyTextureToTexture3D=function(be,bt,kt,Dt,Jt=0){if(F.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const xn=be.max.x-be.min.x+1,xi=be.max.y-be.min.y+1,Fn=be.max.z-be.min.z+1,di=Gi.convert(Dt.format),Ar=Gi.convert(Dt.type);let Ei;if(Dt.isData3DTexture)He.setTexture3D(Dt,0),Ei=32879;else{if(!Dt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");He.setTexture2DArray(Dt,0),Ei=35866}pn.pixelStorei(37440,Dt.flipY),pn.pixelStorei(37441,Dt.premultiplyAlpha),pn.pixelStorei(3317,Dt.unpackAlignment);const oi=pn.getParameter(3314),qr=pn.getParameter(32878),Wf=pn.getParameter(3316),La=pn.getParameter(3315),Yg=pn.getParameter(32877),tc=kt.isCompressedTexture?kt.mipmaps[0]:kt.image;pn.pixelStorei(3314,tc.width),pn.pixelStorei(32878,tc.height),pn.pixelStorei(3316,be.min.x),pn.pixelStorei(3315,be.min.y),pn.pixelStorei(32877,be.min.z),kt.isDataTexture||kt.isData3DTexture?pn.texSubImage3D(Ei,Jt,bt.x,bt.y,bt.z,xn,xi,Fn,di,Ar,tc.data):kt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),pn.compressedTexSubImage3D(Ei,Jt,bt.x,bt.y,bt.z,xn,xi,Fn,di,tc.data)):pn.texSubImage3D(Ei,Jt,bt.x,bt.y,bt.z,xn,xi,Fn,di,Ar,tc),pn.pixelStorei(3314,oi),pn.pixelStorei(32878,qr),pn.pixelStorei(3316,Wf),pn.pixelStorei(3315,La),pn.pixelStorei(32877,Yg),Jt===0&&Dt.generateMipmaps&&pn.generateMipmap(Ei),it.unbindTexture()},this.initTexture=function(be){be.isCubeTexture?He.setTextureCube(be,0):be.isData3DTexture?He.setTexture3D(be,0):be.isDataArrayTexture?He.setTexture2DArray(be,0):He.setTexture2D(be,0),it.unbindTexture()},this.resetState=function(){W=0,q=0,$=null,it.reset(),Hi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class l0 extends Tr{}l0.prototype.isWebGL1Renderer=!0;class Lu{constructor(i,l=25e-5){this.isFogExp2=!0,this.name="",this.color=new mn(i),this.density=l}clone(){return new Lu(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Vd{constructor(i,l=1,u=1e3){this.isFog=!0,this.name="",this.color=new mn(i),this.near=l,this.far=u}clone(){return new Vd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class CA extends ei{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(i,l){return super.copy(i,l),i.background!==null&&(this.background=i.background.clone()),i.environment!==null&&(this.environment=i.environment.clone()),i.fog!==null&&(this.fog=i.fog.clone()),i.overrideMaterial!==null&&(this.overrideMaterial=i.overrideMaterial.clone()),this.matrixAutoUpdate=i.matrixAutoUpdate,this}toJSON(i){const l=super.toJSON(i);return this.fog!==null&&(l.object.fog=this.fog.toJSON()),l}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(i){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=i}}class Zm{constructor(i,l){this.isInterleavedBuffer=!0,this.array=i,this.stride=l,this.count=i!==void 0?i.length/l:0,this.usage=yc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_s()}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}copy(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this}copyAt(i,l,u){i*=this.stride,u*=l.stride;for(let h=0,g=this.stride;h<g;h++)this.array[i+h]=l.array[u+h];return this}set(i,l=0){return this.array.set(i,l),this}clone(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_s()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const l=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),u=new this.constructor(l,this.stride);return u.setUsage(this.usage),u}onUpload(i){return this.onUploadCallback=i,this}toJSON(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_s()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Js=new he;class Wl{constructor(i,l,u,h=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=i,this.itemSize=l,this.offset=u,this.normalized=h===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(i){this.data.needsUpdate=i}applyMatrix4(i){for(let l=0,u=this.data.count;l<u;l++)Js.fromBufferAttribute(this,l),Js.applyMatrix4(i),this.setXYZ(l,Js.x,Js.y,Js.z);return this}applyNormalMatrix(i){for(let l=0,u=this.count;l<u;l++)Js.fromBufferAttribute(this,l),Js.applyNormalMatrix(i),this.setXYZ(l,Js.x,Js.y,Js.z);return this}transformDirection(i){for(let l=0,u=this.count;l<u;l++)Js.fromBufferAttribute(this,l),Js.transformDirection(i),this.setXYZ(l,Js.x,Js.y,Js.z);return this}setX(i,l){return this.normalized&&(l=Vi(l,this.array)),this.data.array[i*this.data.stride+this.offset]=l,this}setY(i,l){return this.normalized&&(l=Vi(l,this.array)),this.data.array[i*this.data.stride+this.offset+1]=l,this}setZ(i,l){return this.normalized&&(l=Vi(l,this.array)),this.data.array[i*this.data.stride+this.offset+2]=l,this}setW(i,l){return this.normalized&&(l=Vi(l,this.array)),this.data.array[i*this.data.stride+this.offset+3]=l,this}getX(i){let l=this.data.array[i*this.data.stride+this.offset];return this.normalized&&(l=Za(l,this.array)),l}getY(i){let l=this.data.array[i*this.data.stride+this.offset+1];return this.normalized&&(l=Za(l,this.array)),l}getZ(i){let l=this.data.array[i*this.data.stride+this.offset+2];return this.normalized&&(l=Za(l,this.array)),l}getW(i){let l=this.data.array[i*this.data.stride+this.offset+3];return this.normalized&&(l=Za(l,this.array)),l}setXY(i,l,u){return i=i*this.data.stride+this.offset,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=u,this}setXYZ(i,l,u,h){return i=i*this.data.stride+this.offset,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array),h=Vi(h,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=u,this.data.array[i+2]=h,this}setXYZW(i,l,u,h,g){return i=i*this.data.stride+this.offset,this.normalized&&(l=Vi(l,this.array),u=Vi(u,this.array),h=Vi(h,this.array),g=Vi(g,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=u,this.data.array[i+2]=h,this.data.array[i+3]=g,this}clone(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const l=[];for(let u=0;u<this.count;u++){const h=u*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)l.push(this.data.array[h+g])}return new ji(new this.array.constructor(l),this.itemSize,this.normalized)}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new Wl(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const l=[];for(let u=0;u<this.count;u++){const h=u*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)l.push(this.data.array[h+g])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:l,normalized:this.normalized}}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class $m extends ss{constructor(i){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.rotation=i.rotation,this.sizeAttenuation=i.sizeAttenuation,this.fog=i.fog,this}}let Nu;const Nc=new he,Lh=new he,ql=new he,Uc=new Lt,Nh=new Lt,SA=new Gn,Uu=new he,Fu=new he,tf=new he,eg=new Lt,tg=new Lt,MA=new Lt;class ng extends ei{constructor(i){if(super(),this.isSprite=!0,this.type="Sprite",Nu===void 0){Nu=new wn;const l=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),u=new Zm(l,5);Nu.setIndex([0,1,2,0,2,3]),Nu.setAttribute("position",new Wl(u,3,0,!1)),Nu.setAttribute("uv",new Wl(u,2,3,!1))}this.geometry=Nu,this.material=i!==void 0?i:new $m,this.center=new Lt(.5,.5)}raycast(i,l){i.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Lh.setFromMatrixScale(this.matrixWorld),SA.copy(i.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(i.camera.matrixWorldInverse,this.matrixWorld),ql.setFromMatrixPosition(this.modelViewMatrix),i.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Lh.multiplyScalar(-ql.z);const u=this.material.rotation;let h,g;u!==0&&(g=Math.cos(u),h=Math.sin(u));const _=this.center;Fc(Uu.set(-.5,-.5,0),ql,_,Lh,h,g),Fc(Fu.set(.5,-.5,0),ql,_,Lh,h,g),Fc(tf.set(.5,.5,0),ql,_,Lh,h,g),eg.set(0,0),tg.set(1,0),MA.set(1,1);let y=i.ray.intersectTriangle(Uu,Fu,tf,!1,Nc);if(y===null&&(Fc(Fu.set(-.5,.5,0),ql,_,Lh,h,g),tg.set(0,1),y=i.ray.intersectTriangle(Uu,tf,Fu,!1,Nc),y===null))return;const C=i.ray.origin.distanceTo(Nc);C<i.near||C>i.far||l.push({distance:C,point:Nc.clone(),uv:rs.getUV(Nc,Uu,Fu,tf,eg,tg,MA,new Lt),face:null,object:this})}copy(i,l){return super.copy(i,l),i.center!==void 0&&this.center.copy(i.center),this.material=i.material,this}}function Fc(b,i,l,u,h,g){Uc.subVectors(b,l).addScalar(.5).multiply(u),h!==void 0?(Nh.x=g*Uc.x-h*Uc.y,Nh.y=h*Uc.x+g*Uc.y):Nh.copy(Uc),b.copy(i),b.x+=Nh.x,b.y+=Nh.y,b.applyMatrix4(SA)}const Gd=new he,TA=new he;class Hd extends ei{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(i){super.copy(i,!1);const l=i.levels;for(let u=0,h=l.length;u<h;u++){const g=l[u];this.addLevel(g.object.clone(),g.distance)}return this.autoUpdate=i.autoUpdate,this}addLevel(i,l=0){l=Math.abs(l);const u=this.levels;let h;for(h=0;h<u.length&&!(l<u[h].distance);h++);return u.splice(h,0,{distance:l,object:i}),this.add(i),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(i){const l=this.levels;if(l.length>0){let u,h;for(u=1,h=l.length;u<h&&!(i<l[u].distance);u++);return l[u-1].object}return null}raycast(i,l){if(this.levels.length>0){Gd.setFromMatrixPosition(this.matrixWorld);const u=i.ray.origin.distanceTo(Gd);this.getObjectForDistance(u).raycast(i,l)}}update(i){const l=this.levels;if(l.length>1){Gd.setFromMatrixPosition(i.matrixWorld),TA.setFromMatrixPosition(this.matrixWorld);const u=Gd.distanceTo(TA)/i.zoom;let h,g;for(l[0].object.visible=!0,h=1,g=l.length;h<g&&u>=l[h].distance;h++)l[h-1].object.visible=!1,l[h].object.visible=!0;for(this._currentLevel=h-1;h<g;h++)l[h].object.visible=!1}}toJSON(i){const l=super.toJSON(i);this.autoUpdate===!1&&(l.object.autoUpdate=!1),l.object.levels=[];const u=this.levels;for(let h=0,g=u.length;h<g;h++){const _=u[h];l.object.levels.push({object:_.object.uuid,distance:_.distance})}return l}}const Uh=new he,IA=new Ti,DA=new Ti,PA=new he,ig=new Gn;class c0 extends os{constructor(i,l){super(i,l),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Gn,this.bindMatrixInverse=new Gn}copy(i,l){return super.copy(i,l),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this}bind(i,l){this.skeleton=i,l===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.copy(l).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const i=new Ti,l=this.geometry.attributes.skinWeight;for(let u=0,h=l.count;u<h;u++){i.fromBufferAttribute(l,u);const g=1/i.manhattanLength();g!==1/0?i.multiplyScalar(g):i.set(1,0,0,0),l.setXYZW(u,i.x,i.y,i.z,i.w)}}updateMatrixWorld(i){super.updateMatrixWorld(i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(i,l){const u=this.skeleton,h=this.geometry;IA.fromBufferAttribute(h.attributes.skinIndex,i),DA.fromBufferAttribute(h.attributes.skinWeight,i),Uh.copy(l).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let g=0;g<4;g++){const _=DA.getComponent(g);if(_!==0){const y=IA.getComponent(g);ig.multiplyMatrices(u.bones[y].matrixWorld,u.boneInverses[y]),l.addScaledVector(PA.copy(Uh).applyMatrix4(ig),_)}}return l.applyMatrix4(this.bindMatrixInverse)}}class u0 extends ei{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Wd extends Ur{constructor(i=null,l=1,u=1,h,g,_,y,C,S=lr,B=lr,L,k){super(null,_,y,C,S,B,h,g,L,k),this.isDataTexture=!0,this.image={data:i,width:l,height:u},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const h0=new Gn,RA=new Gn;class nf{constructor(i=[],l=[]){this.uuid=_s(),this.bones=i.slice(0),this.boneInverses=l,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const i=this.bones,l=this.boneInverses;if(this.boneMatrices=new Float32Array(16*i.length),l.length===0)this.calculateInverses();else if(i.length!==l.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let u=0,h=this.bones.length;u<h;u++)this.boneInverses.push(new Gn)}}calculateInverses(){this.boneInverses.length=0;for(let i=0,l=this.bones.length;i<l;i++){const u=new Gn;this.bones[i]&&u.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(u)}}pose(){for(let i=0,l=this.bones.length;i<l;i++){const u=this.bones[i];u&&u.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,l=this.bones.length;i<l;i++){const u=this.bones[i];u&&(u.parent&&u.parent.isBone?(u.matrix.copy(u.parent.matrixWorld).invert(),u.matrix.multiply(u.matrixWorld)):u.matrix.copy(u.matrixWorld),u.matrix.decompose(u.position,u.quaternion,u.scale))}}update(){const i=this.bones,l=this.boneInverses,u=this.boneMatrices,h=this.boneTexture;for(let g=0,_=i.length;g<_;g++){const y=i[g]?i[g].matrixWorld:RA;h0.multiplyMatrices(y,l[g]),h0.toArray(u,16*g)}h!==null&&(h.needsUpdate=!0)}clone(){return new nf(this.bones,this.boneInverses)}computeBoneTexture(){let i=Math.sqrt(4*this.bones.length);i=Ll(i),i=Math.max(i,4);const l=new Float32Array(i*i*4);l.set(this.boneMatrices);const u=new Wd(l,i,i,Hs,Qr);return u.needsUpdate=!0,this.boneMatrices=l,this.boneTexture=u,this.boneTextureSize=i,this}getBoneByName(i){for(let l=0,u=this.bones.length;l<u;l++){const h=this.bones[l];if(h.name===i)return h}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(i,l){this.uuid=i.uuid;for(let u=0,h=i.bones.length;u<h;u++){const g=i.bones[u];let _=l[g];_===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",g),_=new u0),this.bones.push(_),this.boneInverses.push(new Gn().fromArray(i.boneInverses[u]))}return this.init(),this}toJSON(){const i={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const l=this.bones,u=this.boneInverses;for(let h=0,g=l.length;h<g;h++){const _=l[h];i.bones.push(_.uuid);const y=u[h];i.boneInverses.push(y.toArray())}return i}}class Fh extends ji{constructor(i,l,u,h=1){super(i,l,u),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=h}copy(i){return super.copy(i),this.meshPerAttribute=i.meshPerAttribute,this}toJSON(){const i=super.toJSON();return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}}const d0=new Gn,BA=new Gn,rf=[],sf=new os;class rg extends os{constructor(i,l,u){super(i,l),this.isInstancedMesh=!0,this.instanceMatrix=new Fh(new Float32Array(16*u),16),this.instanceColor=null,this.count=u,this.frustumCulled=!1}copy(i,l){return super.copy(i,l),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this}getColorAt(i,l){l.fromArray(this.instanceColor.array,3*i)}getMatrixAt(i,l){l.fromArray(this.instanceMatrix.array,16*i)}raycast(i,l){const u=this.matrixWorld,h=this.count;if(sf.geometry=this.geometry,sf.material=this.material,sf.material!==void 0)for(let g=0;g<h;g++){this.getMatrixAt(g,d0),BA.multiplyMatrices(u,d0),sf.matrixWorld=BA,sf.raycast(i,rf);for(let _=0,y=rf.length;_<y;_++){const C=rf[_];C.instanceId=g,C.object=this,l.push(C)}rf.length=0}}setColorAt(i,l){this.instanceColor===null&&(this.instanceColor=new Fh(new Float32Array(3*this.instanceMatrix.count),3)),l.toArray(this.instanceColor.array,3*i)}setMatrixAt(i,l){l.toArray(this.instanceMatrix.array,16*i)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class lo extends ss{constructor(i){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new mn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.fog=i.fog,this}}const sg=new he,p0=new he,f0=new Gn,m0=new jl,of=new Do;class Yl extends ei{constructor(i=new wn,l=new lo){super(),this.isLine=!0,this.type="Line",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),this.material=i.material,this.geometry=i.geometry,this}computeLineDistances(){const i=this.geometry;if(i.index===null){const l=i.attributes.position,u=[0];for(let h=1,g=l.count;h<g;h++)sg.fromBufferAttribute(l,h-1),p0.fromBufferAttribute(l,h),u[h]=u[h-1],u[h]+=sg.distanceTo(p0);i.setAttribute("lineDistance",new w(u,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(i,l){const u=this.geometry,h=this.matrixWorld,g=i.params.Line.threshold,_=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),of.copy(u.boundingSphere),of.applyMatrix4(h),of.radius+=g,i.ray.intersectsSphere(of)===!1)return;f0.copy(h).invert(),m0.copy(i.ray).applyMatrix4(f0);const y=g/((this.scale.x+this.scale.y+this.scale.z)/3),C=y*y,S=new he,B=new he,L=new he,k=new he,U=this.isLineSegments?2:1,Q=u.index,F=u.attributes.position;if(Q!==null)for(let H=Math.max(0,_.start),W=Math.min(Q.count,_.start+_.count)-1;H<W;H+=U){const q=Q.getX(H),$=Q.getX(H+1);if(S.fromBufferAttribute(F,q),B.fromBufferAttribute(F,$),m0.distanceSqToSegment(S,B,k,L)>C)continue;k.applyMatrix4(this.matrixWorld);const ie=i.ray.origin.distanceTo(k);ie<i.near||ie>i.far||l.push({distance:ie,point:L.clone().applyMatrix4(this.matrixWorld),index:H,face:null,faceIndex:null,object:this})}else for(let H=Math.max(0,_.start),W=Math.min(F.count,_.start+_.count)-1;H<W;H+=U){if(S.fromBufferAttribute(F,H),B.fromBufferAttribute(F,H+1),m0.distanceSqToSegment(S,B,k,L)>C)continue;k.applyMatrix4(this.matrixWorld);const q=i.ray.origin.distanceTo(k);q<i.near||q>i.far||l.push({distance:q,point:L.clone().applyMatrix4(this.matrixWorld),index:H,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const u=i[l[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,g=u.length;h<g;h++){const _=u[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=h}}}}}const kA=new he,og=new he;class Xl extends Yl{constructor(i,l){super(i,l),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const i=this.geometry;if(i.index===null){const l=i.attributes.position,u=[];for(let h=0,g=l.count;h<g;h+=2)kA.fromBufferAttribute(l,h),og.fromBufferAttribute(l,h+1),u[h]=h===0?0:u[h-1],u[h+1]=u[h]+kA.distanceTo(og);i.setAttribute("lineDistance",new w(u,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class qd extends Yl{constructor(i,l){super(i,l),this.isLineLoop=!0,this.type="LineLoop"}}class ag extends ss{constructor(i){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new mn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.fog=i.fog,this}}const g0=new Gn,lg=new jl,cg=new Do,af=new he;class ug extends ei{constructor(i=new wn,l=new ag){super(),this.isPoints=!0,this.type="Points",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),this.material=i.material,this.geometry=i.geometry,this}raycast(i,l){const u=this.geometry,h=this.matrixWorld,g=i.params.Points.threshold,_=u.drawRange;if(u.boundingSphere===null&&u.computeBoundingSphere(),cg.copy(u.boundingSphere),cg.applyMatrix4(h),cg.radius+=g,i.ray.intersectsSphere(cg)===!1)return;g0.copy(h).invert(),lg.copy(i.ray).applyMatrix4(g0);const y=g/((this.scale.x+this.scale.y+this.scale.z)/3),C=y*y,S=u.index,B=u.attributes.position;if(S!==null)for(let L=Math.max(0,_.start),k=Math.min(S.count,_.start+_.count);L<k;L++){const U=S.getX(L);af.fromBufferAttribute(B,U),Yd(af,U,C,h,i,l,this)}else for(let L=Math.max(0,_.start),k=Math.min(B.count,_.start+_.count);L<k;L++)af.fromBufferAttribute(B,L),Yd(af,L,C,h,i,l,this)}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const u=i[l[0]];if(u!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,g=u.length;h<g;h++){const _=u[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=h}}}}}function Yd(b,i,l,u,h,g,_){const y=lg.distanceSqToPoint(b);if(y<l){const C=new he;lg.closestPointToPoint(b,C),C.applyMatrix4(u);const S=h.ray.origin.distanceTo(C);if(S<h.near||S>h.far)return;g.push({distance:S,distanceToRay:Math.sqrt(y),point:C,index:i,face:null,object:_})}}class v0 extends Ur{constructor(i,l,u,h,g,_,y,C,S){super(i,l,u,h,g,_,y,C,S),this.isVideoTexture=!0,this.minFilter=_!==void 0?_:ur,this.magFilter=g!==void 0?g:ur,this.generateMipmaps=!1;const B=this;"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(function L(){B.needsUpdate=!0,i.requestVideoFrameCallback(L)})}clone(){return new this.constructor(this.image).copy(this)}update(){const i=this.image;!("requestVideoFrameCallback"in i)&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class lf extends Ur{constructor(i,l,u){super({width:i,height:l}),this.isFramebufferTexture=!0,this.format=u,this.magFilter=lr,this.minFilter=lr,this.generateMipmaps=!1,this.needsUpdate=!0}}class cf extends Ur{constructor(i,l,u,h,g,_,y,C,S,B,L,k){super(null,_,y,C,S,B,h,g,L,k),this.isCompressedTexture=!0,this.image={width:l,height:u},this.mipmaps=i,this.flipY=!1,this.generateMipmaps=!1}}class _0 extends Ur{constructor(i,l,u,h,g,_,y,C,S){super(i,l,u,h,g,_,y,C,S),this.isCanvasTexture=!0,this.needsUpdate=!0}}class hl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(i,l){const u=this.getUtoTmapping(i);return this.getPoint(u,l)}getPoints(i=5){const l=[];for(let u=0;u<=i;u++)l.push(this.getPoint(u/i));return l}getSpacedPoints(i=5){const l=[];for(let u=0;u<=i;u++)l.push(this.getPointAt(u/i));return l}getLength(){const i=this.getLengths();return i[i.length-1]}getLengths(i=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const l=[];let u,h=this.getPoint(0),g=0;l.push(0);for(let _=1;_<=i;_++)u=this.getPoint(_/i),g+=u.distanceTo(h),l.push(g),h=u;return this.cacheArcLengths=l,l}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(i,l){const u=this.getLengths();let h=0;const g=u.length;let _;_=l||i*u[g-1];let y,C=0,S=g-1;for(;C<=S;)if(h=Math.floor(C+(S-C)/2),y=u[h]-_,y<0)C=h+1;else{if(!(y>0)){S=h;break}S=h-1}if(h=S,u[h]===_)return h/(g-1);const B=u[h];return(h+(_-B)/(u[h+1]-B))/(g-1)}getTangent(i,l){let h=i-1e-4,g=i+1e-4;h<0&&(h=0),g>1&&(g=1);const _=this.getPoint(h),y=this.getPoint(g),C=l||(_.isVector2?new Lt:new he);return C.copy(y).sub(_).normalize(),C}getTangentAt(i,l){const u=this.getUtoTmapping(i);return this.getTangent(u,l)}computeFrenetFrames(i,l){const u=new he,h=[],g=[],_=[],y=new he,C=new Gn;for(let U=0;U<=i;U++){const Q=U/i;h[U]=this.getTangentAt(Q,new he)}g[0]=new he,_[0]=new he;let S=Number.MAX_VALUE;const B=Math.abs(h[0].x),L=Math.abs(h[0].y),k=Math.abs(h[0].z);B<=S&&(S=B,u.set(1,0,0)),L<=S&&(S=L,u.set(0,1,0)),k<=S&&u.set(0,0,1),y.crossVectors(h[0],u).normalize(),g[0].crossVectors(h[0],y),_[0].crossVectors(h[0],g[0]);for(let U=1;U<=i;U++){if(g[U]=g[U-1].clone(),_[U]=_[U-1].clone(),y.crossVectors(h[U-1],h[U]),y.length()>Number.EPSILON){y.normalize();const Q=Math.acos(On(h[U-1].dot(h[U]),-1,1));g[U].applyMatrix4(C.makeRotationAxis(y,Q))}_[U].crossVectors(h[U],g[U])}if(l===!0){let U=Math.acos(On(g[0].dot(g[i]),-1,1));U/=i,h[0].dot(y.crossVectors(g[0],g[i]))>0&&(U=-U);for(let Q=1;Q<=i;Q++)g[Q].applyMatrix4(C.makeRotationAxis(h[Q],U*Q)),_[Q].crossVectors(h[Q],g[Q])}return{tangents:h,normals:g,binormals:_}}clone(){return new this.constructor().copy(this)}copy(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}toJSON(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i}fromJSON(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}}class hg extends hl{constructor(i=0,l=0,u=1,h=1,g=0,_=2*Math.PI,y=!1,C=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=i,this.aY=l,this.xRadius=u,this.yRadius=h,this.aStartAngle=g,this.aEndAngle=_,this.aClockwise=y,this.aRotation=C}getPoint(i,l){const u=l||new Lt,h=2*Math.PI;let g=this.aEndAngle-this.aStartAngle;const _=Math.abs(g)<Number.EPSILON;for(;g<0;)g+=h;for(;g>h;)g-=h;g<Number.EPSILON&&(g=_?0:h),this.aClockwise!==!0||_||(g===h?g=-h:g-=h);const y=this.aStartAngle+i*g;let C=this.aX+this.xRadius*Math.cos(y),S=this.aY+this.yRadius*Math.sin(y);if(this.aRotation!==0){const B=Math.cos(this.aRotation),L=Math.sin(this.aRotation),k=C-this.aX,U=S-this.aY;C=k*B-U*L+this.aX,S=k*L+U*B+this.aY}return u.set(C,S)}copy(i){return super.copy(i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this}toJSON(){const i=super.toJSON();return i.aX=this.aX,i.aY=this.aY,i.xRadius=this.xRadius,i.yRadius=this.yRadius,i.aStartAngle=this.aStartAngle,i.aEndAngle=this.aEndAngle,i.aClockwise=this.aClockwise,i.aRotation=this.aRotation,i}fromJSON(i){return super.fromJSON(i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this}}class OA extends hg{constructor(i,l,u,h,g,_){super(i,l,u,u,h,g,_),this.isArcCurve=!0,this.type="ArcCurve"}}function dg(){let b=0,i=0,l=0,u=0;function h(g,_,y,C){b=g,i=y,l=-3*g+3*_-2*y-C,u=2*g-2*_+y+C}return{initCatmullRom:function(g,_,y,C,S){h(_,y,S*(y-g),S*(C-_))},initNonuniformCatmullRom:function(g,_,y,C,S,B,L){let k=(_-g)/S-(y-g)/(S+B)+(y-_)/B,U=(y-_)/B-(C-_)/(B+L)+(C-y)/L;k*=B,U*=B,h(_,y,k,U)},calc:function(g){const _=g*g;return b+i*g+l*_+u*(_*g)}}}const pg=new he,fg=new dg,A0=new dg,mg=new dg;class LA extends hl{constructor(i=[],l=!1,u="centripetal",h=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=i,this.closed=l,this.curveType=u,this.tension=h}getPoint(i,l=new he){const u=l,h=this.points,g=h.length,_=(g-(this.closed?0:1))*i;let y,C,S=Math.floor(_),B=_-S;this.closed?S+=S>0?0:(Math.floor(Math.abs(S)/g)+1)*g:B===0&&S===g-1&&(S=g-2,B=1),this.closed||S>0?y=h[(S-1)%g]:(pg.subVectors(h[0],h[1]).add(h[0]),y=pg);const L=h[S%g],k=h[(S+1)%g];if(this.closed||S+2<g?C=h[(S+2)%g]:(pg.subVectors(h[g-1],h[g-2]).add(h[g-1]),C=pg),this.curveType==="centripetal"||this.curveType==="chordal"){const U=this.curveType==="chordal"?.5:.25;let Q=Math.pow(y.distanceToSquared(L),U),F=Math.pow(L.distanceToSquared(k),U),H=Math.pow(k.distanceToSquared(C),U);F<1e-4&&(F=1),Q<1e-4&&(Q=F),H<1e-4&&(H=F),fg.initNonuniformCatmullRom(y.x,L.x,k.x,C.x,Q,F,H),A0.initNonuniformCatmullRom(y.y,L.y,k.y,C.y,Q,F,H),mg.initNonuniformCatmullRom(y.z,L.z,k.z,C.z,Q,F,H)}else this.curveType==="catmullrom"&&(fg.initCatmullRom(y.x,L.x,k.x,C.x,this.tension),A0.initCatmullRom(y.y,L.y,k.y,C.y,this.tension),mg.initCatmullRom(y.z,L.z,k.z,C.z,this.tension));return u.set(fg.calc(B),A0.calc(B),mg.calc(B)),u}copy(i){super.copy(i),this.points=[];for(let l=0,u=i.points.length;l<u;l++){const h=i.points[l];this.points.push(h.clone())}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}toJSON(){const i=super.toJSON();i.points=[];for(let l=0,u=this.points.length;l<u;l++){const h=this.points[l];i.points.push(h.toArray())}return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i}fromJSON(i){super.fromJSON(i),this.points=[];for(let l=0,u=i.points.length;l<u;l++){const h=i.points[l];this.points.push(new he().fromArray(h))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}}function Xd(b,i,l,u,h){const g=.5*(u-i),_=.5*(h-l),y=b*b;return(2*l-2*u+g+_)*(b*y)+(-3*l+3*u-2*g-_)*y+g*b+l}function jh(b,i,l,u){return function(h,g){const _=1-h;return _*_*g}(b,i)+function(h,g){return 2*(1-h)*h*g}(b,l)+function(h,g){return h*h*g}(b,u)}function Ir(b,i,l,u,h){return function(g,_){const y=1-g;return y*y*y*_}(b,i)+function(g,_){const y=1-g;return 3*y*y*g*_}(b,l)+function(g,_){return 3*(1-g)*g*g*_}(b,u)+function(g,_){return g*g*g*_}(b,h)}class uf extends hl{constructor(i=new Lt,l=new Lt,u=new Lt,h=new Lt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=i,this.v1=l,this.v2=u,this.v3=h}getPoint(i,l=new Lt){const u=l,h=this.v0,g=this.v1,_=this.v2,y=this.v3;return u.set(Ir(i,h.x,g.x,_.x,y.x),Ir(i,h.y,g.y,_.y,y.y)),u}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this}}class y0 extends hl{constructor(i=new he,l=new he,u=new he,h=new he){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=i,this.v1=l,this.v2=u,this.v3=h}getPoint(i,l=new he){const u=l,h=this.v0,g=this.v1,_=this.v2,y=this.v3;return u.set(Ir(i,h.x,g.x,_.x,y.x),Ir(i,h.y,g.y,_.y,y.y),Ir(i,h.z,g.z,_.z,y.z)),u}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this}}class hf extends hl{constructor(i=new Lt,l=new Lt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=i,this.v2=l}getPoint(i,l=new Lt){const u=l;return i===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(i).add(this.v1)),u}getPointAt(i,l){return this.getPoint(i,l)}getTangent(i,l){const u=l||new Lt;return u.copy(this.v2).sub(this.v1).normalize(),u}copy(i){return super.copy(i),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class b0 extends hl{constructor(i=new he,l=new he){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=i,this.v2=l}getPoint(i,l=new he){const u=l;return i===1?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(i).add(this.v1)),u}getPointAt(i,l){return this.getPoint(i,l)}copy(i){return super.copy(i),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class jc extends hl{constructor(i=new Lt,l=new Lt,u=new Lt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=i,this.v1=l,this.v2=u}getPoint(i,l=new Lt){const u=l,h=this.v0,g=this.v1,_=this.v2;return u.set(jh(i,h.x,g.x,_.x),jh(i,h.y,g.y,_.y)),u}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class gg extends hl{constructor(i=new he,l=new he,u=new he){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=i,this.v1=l,this.v2=u}getPoint(i,l=new he){const u=l,h=this.v0,g=this.v1,_=this.v2;return u.set(jh(i,h.x,g.x,_.x),jh(i,h.y,g.y,_.y),jh(i,h.z,g.z,_.z)),u}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class w0 extends hl{constructor(i=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=i}getPoint(i,l=new Lt){const u=l,h=this.points,g=(h.length-1)*i,_=Math.floor(g),y=g-_,C=h[_===0?_:_-1],S=h[_],B=h[_>h.length-2?h.length-1:_+1],L=h[_>h.length-3?h.length-1:_+2];return u.set(Xd(y,C.x,S.x,B.x,L.x),Xd(y,C.y,S.y,B.y,L.y)),u}copy(i){super.copy(i),this.points=[];for(let l=0,u=i.points.length;l<u;l++){const h=i.points[l];this.points.push(h.clone())}return this}toJSON(){const i=super.toJSON();i.points=[];for(let l=0,u=this.points.length;l<u;l++){const h=this.points[l];i.points.push(h.toArray())}return i}fromJSON(i){super.fromJSON(i),this.points=[];for(let l=0,u=i.points.length;l<u;l++){const h=i.points[l];this.points.push(new Lt().fromArray(h))}return this}}var Ii=Object.freeze({__proto__:null,ArcCurve:OA,CatmullRomCurve3:LA,CubicBezierCurve:uf,CubicBezierCurve3:y0,EllipseCurve:hg,LineCurve:hf,LineCurve3:b0,QuadraticBezierCurve:jc,QuadraticBezierCurve3:gg,SplineCurve:w0});class x0 extends hl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(i){this.curves.push(i)}closePath(){const i=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);i.equals(l)||this.curves.push(new hf(l,i))}getPoint(i,l){const u=i*this.getLength(),h=this.getCurveLengths();let g=0;for(;g<h.length;){if(h[g]>=u){const _=h[g]-u,y=this.curves[g],C=y.getLength(),S=C===0?0:1-_/C;return y.getPointAt(S,l)}g++}return null}getLength(){const i=this.getCurveLengths();return i[i.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let l=0;for(let u=0,h=this.curves.length;u<h;u++)l+=this.curves[u].getLength(),i.push(l);return this.cacheLengths=i,i}getSpacedPoints(i=40){const l=[];for(let u=0;u<=i;u++)l.push(this.getPoint(u/i));return this.autoClose&&l.push(l[0]),l}getPoints(i=12){const l=[];let u;for(let h=0,g=this.curves;h<g.length;h++){const _=g[h],y=_.isEllipseCurve?2*i:_.isLineCurve||_.isLineCurve3?1:_.isSplineCurve?i*_.points.length:i,C=_.getPoints(y);for(let S=0;S<C.length;S++){const B=C[S];u&&u.equals(B)||(l.push(B),u=B)}}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l}copy(i){super.copy(i),this.curves=[];for(let l=0,u=i.curves.length;l<u;l++){const h=i.curves[l];this.curves.push(h.clone())}return this.autoClose=i.autoClose,this}toJSON(){const i=super.toJSON();i.autoClose=this.autoClose,i.curves=[];for(let l=0,u=this.curves.length;l<u;l++){const h=this.curves[l];i.curves.push(h.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.autoClose=i.autoClose,this.curves=[];for(let l=0,u=i.curves.length;l<u;l++){const h=i.curves[l];this.curves.push(new Ii[h.type]().fromJSON(h))}return this}}class Kd extends x0{constructor(i){super(),this.type="Path",this.currentPoint=new Lt,i&&this.setFromPoints(i)}setFromPoints(i){this.moveTo(i[0].x,i[0].y);for(let l=1,u=i.length;l<u;l++)this.lineTo(i[l].x,i[l].y);return this}moveTo(i,l){return this.currentPoint.set(i,l),this}lineTo(i,l){const u=new hf(this.currentPoint.clone(),new Lt(i,l));return this.curves.push(u),this.currentPoint.set(i,l),this}quadraticCurveTo(i,l,u,h){const g=new jc(this.currentPoint.clone(),new Lt(i,l),new Lt(u,h));return this.curves.push(g),this.currentPoint.set(u,h),this}bezierCurveTo(i,l,u,h,g,_){const y=new uf(this.currentPoint.clone(),new Lt(i,l),new Lt(u,h),new Lt(g,_));return this.curves.push(y),this.currentPoint.set(g,_),this}splineThru(i){const l=[this.currentPoint.clone()].concat(i),u=new w0(l);return this.curves.push(u),this.currentPoint.copy(i[i.length-1]),this}arc(i,l,u,h,g,_){const y=this.currentPoint.x,C=this.currentPoint.y;return this.absarc(i+y,l+C,u,h,g,_),this}absarc(i,l,u,h,g,_){return this.absellipse(i,l,u,u,h,g,_),this}ellipse(i,l,u,h,g,_,y,C){const S=this.currentPoint.x,B=this.currentPoint.y;return this.absellipse(i+S,l+B,u,h,g,_,y,C),this}absellipse(i,l,u,h,g,_,y,C){const S=new hg(i,l,u,h,g,_,y,C);if(this.curves.length>0){const L=S.getPoint(0);L.equals(this.currentPoint)||this.lineTo(L.x,L.y)}this.curves.push(S);const B=S.getPoint(1);return this.currentPoint.copy(B),this}copy(i){return super.copy(i),this.currentPoint.copy(i.currentPoint),this}toJSON(){const i=super.toJSON();return i.currentPoint=this.currentPoint.toArray(),i}fromJSON(i){return super.fromJSON(i),this.currentPoint.fromArray(i.currentPoint),this}}class _r extends wn{constructor(i=[new Lt(0,-.5),new Lt(.5,0),new Lt(0,.5)],l=12,u=0,h=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:i,segments:l,phiStart:u,phiLength:h},l=Math.floor(l),h=On(h,0,2*Math.PI);const g=[],_=[],y=[],C=[],S=[],B=1/l,L=new he,k=new Lt,U=new he,Q=new he,F=new he;let H=0,W=0;for(let q=0;q<=i.length-1;q++)switch(q){case 0:H=i[q+1].x-i[q].x,W=i[q+1].y-i[q].y,U.x=1*W,U.y=-H,U.z=0*W,F.copy(U),U.normalize(),C.push(U.x,U.y,U.z);break;case i.length-1:C.push(F.x,F.y,F.z);break;default:H=i[q+1].x-i[q].x,W=i[q+1].y-i[q].y,U.x=1*W,U.y=-H,U.z=0*W,Q.copy(U),U.x+=F.x,U.y+=F.y,U.z+=F.z,U.normalize(),C.push(U.x,U.y,U.z),F.copy(Q)}for(let q=0;q<=l;q++){const $=u+q*B*h,ie=Math.sin($),se=Math.cos($);for(let le=0;le<=i.length-1;le++){L.x=i[le].x*ie,L.y=i[le].y,L.z=i[le].x*se,_.push(L.x,L.y,L.z),k.x=q/l,k.y=le/(i.length-1),y.push(k.x,k.y);const Ie=C[3*le+0]*ie,De=C[3*le+1],Xe=C[3*le+0]*se;S.push(Ie,De,Xe)}}for(let q=0;q<l;q++)for(let $=0;$<i.length-1;$++){const ie=$+q*i.length,se=ie,le=ie+i.length,Ie=ie+i.length+1,De=ie+1;g.push(se,le,De),g.push(Ie,De,le)}this.setIndex(g),this.setAttribute("position",new w(_,3)),this.setAttribute("uv",new w(y,2)),this.setAttribute("normal",new w(S,3))}static fromJSON(i){return new _r(i.points,i.segments,i.phiStart,i.phiLength)}}class df extends _r{constructor(i=1,l=1,u=4,h=8){const g=new Kd;g.absarc(0,-l/2,i,1.5*Math.PI,0),g.absarc(0,l/2,i,0,.5*Math.PI),super(g.getPoints(u),h),this.type="CapsuleGeometry",this.parameters={radius:i,height:l,capSegments:u,radialSegments:h}}static fromJSON(i){return new df(i.radius,i.length,i.capSegments,i.radialSegments)}}class sa extends wn{constructor(i=1,l=8,u=0,h=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:i,segments:l,thetaStart:u,thetaLength:h},l=Math.max(3,l);const g=[],_=[],y=[],C=[],S=new he,B=new Lt;_.push(0,0,0),y.push(0,0,1),C.push(.5,.5);for(let L=0,k=3;L<=l;L++,k+=3){const U=u+L/l*h;S.x=i*Math.cos(U),S.y=i*Math.sin(U),_.push(S.x,S.y,S.z),y.push(0,0,1),B.x=(_[k]/i+1)/2,B.y=(_[k+1]/i+1)/2,C.push(B.x,B.y)}for(let L=1;L<=l;L++)g.push(L,L+1,0);this.setIndex(g),this.setAttribute("position",new w(_,3)),this.setAttribute("normal",new w(y,3)),this.setAttribute("uv",new w(C,2))}static fromJSON(i){return new sa(i.radius,i.segments,i.thetaStart,i.thetaLength)}}class as extends wn{constructor(i=1,l=1,u=1,h=8,g=1,_=!1,y=0,C=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:i,radiusBottom:l,height:u,radialSegments:h,heightSegments:g,openEnded:_,thetaStart:y,thetaLength:C};const S=this;h=Math.floor(h),g=Math.floor(g);const B=[],L=[],k=[],U=[];let Q=0;const F=[],H=u/2;let W=0;function q($){const ie=Q,se=new Lt,le=new he;let Ie=0;const De=$===!0?i:l,Xe=$===!0?1:-1;for(let Be=1;Be<=h;Be++)L.push(0,H*Xe,0),k.push(0,Xe,0),U.push(.5,.5),Q++;const Ke=Q;for(let Be=0;Be<=h;Be++){const St=Be/h*C+y,Ft=Math.cos(St),Et=Math.sin(St);le.x=De*Et,le.y=H*Xe,le.z=De*Ft,L.push(le.x,le.y,le.z),k.push(0,Xe,0),se.x=.5*Ft+.5,se.y=.5*Et*Xe+.5,U.push(se.x,se.y),Q++}for(let Be=0;Be<h;Be++){const St=ie+Be,Ft=Ke+Be;$===!0?B.push(Ft,Ft+1,St):B.push(Ft+1,Ft,St),Ie+=3}S.addGroup(W,Ie,$===!0?1:2),W+=Ie}(function(){const $=new he,ie=new he;let se=0;const le=(l-i)/u;for(let Ie=0;Ie<=g;Ie++){const De=[],Xe=Ie/g,Ke=Xe*(l-i)+i;for(let Be=0;Be<=h;Be++){const St=Be/h,Ft=St*C+y,Et=Math.sin(Ft),nn=Math.cos(Ft);ie.x=Ke*Et,ie.y=-Xe*u+H,ie.z=Ke*nn,L.push(ie.x,ie.y,ie.z),$.set(Et,le,nn).normalize(),k.push($.x,$.y,$.z),U.push(St,1-Xe),De.push(Q++)}F.push(De)}for(let Ie=0;Ie<h;Ie++)for(let De=0;De<g;De++){const Xe=F[De][Ie],Ke=F[De+1][Ie],Be=F[De+1][Ie+1],St=F[De][Ie+1];B.push(Xe,Ke,St),B.push(Ke,Be,St),se+=6}S.addGroup(W,se,0),W+=se})(),_===!1&&(i>0&&q(!0),l>0&&q(!1)),this.setIndex(B),this.setAttribute("position",new w(L,3)),this.setAttribute("normal",new w(k,3)),this.setAttribute("uv",new w(U,2))}static fromJSON(i){return new as(i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength)}}class rr extends as{constructor(i=1,l=1,u=8,h=1,g=!1,_=0,y=2*Math.PI){super(0,i,l,u,h,g,_,y),this.type="ConeGeometry",this.parameters={radius:i,height:l,radialSegments:u,heightSegments:h,openEnded:g,thetaStart:_,thetaLength:y}}static fromJSON(i){return new rr(i.radius,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength)}}class zc extends wn{constructor(i=[],l=[],u=1,h=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:i,indices:l,radius:u,detail:h};const g=[],_=[];function y(k,U,Q,F){const H=F+1,W=[];for(let q=0;q<=H;q++){W[q]=[];const $=k.clone().lerp(Q,q/H),ie=U.clone().lerp(Q,q/H),se=H-q;for(let le=0;le<=se;le++)W[q][le]=le===0&&q===H?$:$.clone().lerp(ie,le/se)}for(let q=0;q<H;q++)for(let $=0;$<2*(H-q)-1;$++){const ie=Math.floor($/2);$%2==0?(C(W[q][ie+1]),C(W[q+1][ie]),C(W[q][ie])):(C(W[q][ie+1]),C(W[q+1][ie+1]),C(W[q+1][ie]))}}function C(k){g.push(k.x,k.y,k.z)}function S(k,U){const Q=3*k;U.x=i[Q+0],U.y=i[Q+1],U.z=i[Q+2]}function B(k,U,Q,F){F<0&&k.x===1&&(_[U]=k.x-1),Q.x===0&&Q.z===0&&(_[U]=F/2/Math.PI+.5)}function L(k){return Math.atan2(k.z,-k.x)}(function(k){const U=new he,Q=new he,F=new he;for(let H=0;H<l.length;H+=3)S(l[H+0],U),S(l[H+1],Q),S(l[H+2],F),y(U,Q,F,k)})(h),function(k){const U=new he;for(let Q=0;Q<g.length;Q+=3)U.x=g[Q+0],U.y=g[Q+1],U.z=g[Q+2],U.normalize().multiplyScalar(k),g[Q+0]=U.x,g[Q+1]=U.y,g[Q+2]=U.z}(u),function(){const k=new he;for(let Q=0;Q<g.length;Q+=3){k.x=g[Q+0],k.y=g[Q+1],k.z=g[Q+2];const F=L(k)/2/Math.PI+.5,H=(U=k,Math.atan2(-U.y,Math.sqrt(U.x*U.x+U.z*U.z))/Math.PI+.5);_.push(F,1-H)}var U;(function(){const Q=new he,F=new he,H=new he,W=new he,q=new Lt,$=new Lt,ie=new Lt;for(let se=0,le=0;se<g.length;se+=9,le+=6){Q.set(g[se+0],g[se+1],g[se+2]),F.set(g[se+3],g[se+4],g[se+5]),H.set(g[se+6],g[se+7],g[se+8]),q.set(_[le+0],_[le+1]),$.set(_[le+2],_[le+3]),ie.set(_[le+4],_[le+5]),W.copy(Q).add(F).add(H).divideScalar(3);const Ie=L(W);B(q,le+0,Q,Ie),B($,le+2,F,Ie),B(ie,le+4,H,Ie)}})(),function(){for(let Q=0;Q<_.length;Q+=6){const F=_[Q+0],H=_[Q+2],W=_[Q+4],q=Math.max(F,H,W),$=Math.min(F,H,W);q>.9&&$<.1&&(F<.2&&(_[Q+0]+=1),H<.2&&(_[Q+2]+=1),W<.2&&(_[Q+4]+=1))}}()}(),this.setAttribute("position",new w(g,3)),this.setAttribute("normal",new w(g.slice(),3)),this.setAttribute("uv",new w(_,2)),h===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(i){return new zc(i.vertices,i.indices,i.radius,i.details)}}class pf extends zc{constructor(i=1,l=0){const u=(1+Math.sqrt(5))/2,h=1/u;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-h,-u,0,-h,u,0,h,-u,0,h,u,-h,-u,0,-h,u,0,h,-u,0,h,u,0,-u,0,-h,u,0,-h,-u,0,h,u,0,h],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],i,l),this.type="DodecahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new pf(i.radius,i.detail)}}const dl=new he,Jd=new he,ff=new he,Zd=new rs;class vg extends wn{constructor(i=null,l=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:i,thresholdAngle:l},i!==null){const h=Math.pow(10,4),g=Math.cos(wc*l),_=i.getIndex(),y=i.getAttribute("position"),C=_?_.count:y.count,S=[0,0,0],B=["a","b","c"],L=new Array(3),k={},U=[];for(let Q=0;Q<C;Q+=3){_?(S[0]=_.getX(Q),S[1]=_.getX(Q+1),S[2]=_.getX(Q+2)):(S[0]=Q,S[1]=Q+1,S[2]=Q+2);const{a:F,b:H,c:W}=Zd;if(F.fromBufferAttribute(y,S[0]),H.fromBufferAttribute(y,S[1]),W.fromBufferAttribute(y,S[2]),Zd.getNormal(ff),L[0]=`${Math.round(F.x*h)},${Math.round(F.y*h)},${Math.round(F.z*h)}`,L[1]=`${Math.round(H.x*h)},${Math.round(H.y*h)},${Math.round(H.z*h)}`,L[2]=`${Math.round(W.x*h)},${Math.round(W.y*h)},${Math.round(W.z*h)}`,L[0]!==L[1]&&L[1]!==L[2]&&L[2]!==L[0])for(let q=0;q<3;q++){const $=(q+1)%3,ie=L[q],se=L[$],le=Zd[B[q]],Ie=Zd[B[$]],De=`${ie}_${se}`,Xe=`${se}_${ie}`;Xe in k&&k[Xe]?(ff.dot(k[Xe].normal)<=g&&(U.push(le.x,le.y,le.z),U.push(Ie.x,Ie.y,Ie.z)),k[Xe]=null):De in k||(k[De]={index0:S[q],index1:S[$],normal:ff.clone()})}}for(const Q in k)if(k[Q]){const{index0:F,index1:H}=k[Q];dl.fromBufferAttribute(y,F),Jd.fromBufferAttribute(y,H),U.push(dl.x,dl.y,dl.z),U.push(Jd.x,Jd.y,Jd.z)}this.setAttribute("position",new w(U,3))}}}class zh extends Kd{constructor(i){super(i),this.uuid=_s(),this.type="Shape",this.holes=[]}getPointsHoles(i){const l=[];for(let u=0,h=this.holes.length;u<h;u++)l[u]=this.holes[u].getPoints(i);return l}extractPoints(i){return{shape:this.getPoints(i),holes:this.getPointsHoles(i)}}copy(i){super.copy(i),this.holes=[];for(let l=0,u=i.holes.length;l<u;l++){const h=i.holes[l];this.holes.push(h.clone())}return this}toJSON(){const i=super.toJSON();i.uuid=this.uuid,i.holes=[];for(let l=0,u=this.holes.length;l<u;l++){const h=this.holes[l];i.holes.push(h.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.uuid=i.uuid,this.holes=[];for(let l=0,u=i.holes.length;l<u;l++){const h=i.holes[l];this.holes.push(new Kd().fromJSON(h))}return this}}function NA(b,i,l,u,h){let g,_;if(h===function(y,C,S,B){let L=0;for(let k=C,U=S-B;k<S;k+=B)L+=(y[U]-y[k])*(y[k+1]+y[U+1]),U=k;return L}(b,i,l,u)>0)for(g=i;g<l;g+=u)_=Vo(g,b[g],b[g+1],_);else for(g=l-u;g>=i;g-=u)_=Vo(g,b[g],b[g+1],_);return _&&zo(_,_.next)&&(_f(_),_=_.next),_}function ju(b,i){if(!b)return b;i||(i=b);let l,u=b;do if(l=!1,u.steiner||!zo(u,u.next)&&mr(u.prev,u,u.next)!==0)u=u.next;else{if(_f(u),u=i=u.prev,u===u.next)break;l=!0}while(l||u!==i);return i}function mf(b,i,l,u,h,g,_){if(!b)return;!_&&g&&function(B,L,k,U){let Q=B;do Q.z===null&&(Q.z=_g(Q.x,Q.y,L,k,U)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==B);Q.prevZ.nextZ=null,Q.prevZ=null,function(F){let H,W,q,$,ie,se,le,Ie,De=1;do{for(W=F,F=null,ie=null,se=0;W;){for(se++,q=W,le=0,H=0;H<De&&(le++,q=q.nextZ,q);H++);for(Ie=De;le>0||Ie>0&&q;)le!==0&&(Ie===0||!q||W.z<=q.z)?($=W,W=W.nextZ,le--):($=q,q=q.nextZ,Ie--),ie?ie.nextZ=$:F=$,$.prevZ=ie,ie=$;W=q}ie.nextZ=null,De*=2}while(se>1)}(Q)}(b,u,h,g);let y,C,S=b;for(;b.prev!==b.next;)if(y=b.prev,C=b.next,g?gf(b,u,h,g):UA(b))i.push(y.i/l),i.push(b.i/l),i.push(C.i/l),_f(b),b=C.next,S=C.next;else if((b=C)===S){_?_===1?mf(b=FA(ju(b),i,l),i,l,u,h,g,2):_===2&&E0(b,i,l,u,h,g):mf(ju(b),i,l,u,h,g,1);break}}function UA(b){const i=b.prev,l=b,u=b.next;if(mr(i,l,u)>=0)return!1;let h=b.next.next;for(;h!==b.prev;){if(Ia(i.x,i.y,l.x,l.y,u.x,u.y,h.x,h.y)&&mr(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function gf(b,i,l,u){const h=b.prev,g=b,_=b.next;if(mr(h,g,_)>=0)return!1;const y=h.x<g.x?h.x<_.x?h.x:_.x:g.x<_.x?g.x:_.x,C=h.y<g.y?h.y<_.y?h.y:_.y:g.y<_.y?g.y:_.y,S=h.x>g.x?h.x>_.x?h.x:_.x:g.x>_.x?g.x:_.x,B=h.y>g.y?h.y>_.y?h.y:_.y:g.y>_.y?g.y:_.y,L=_g(y,C,i,l,u),k=_g(S,B,i,l,u);let U=b.prevZ,Q=b.nextZ;for(;U&&U.z>=L&&Q&&Q.z<=k;){if(U!==b.prev&&U!==b.next&&Ia(h.x,h.y,g.x,g.y,_.x,_.y,U.x,U.y)&&mr(U.prev,U,U.next)>=0||(U=U.prevZ,Q!==b.prev&&Q!==b.next&&Ia(h.x,h.y,g.x,g.y,_.x,_.y,Q.x,Q.y)&&mr(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;U&&U.z>=L;){if(U!==b.prev&&U!==b.next&&Ia(h.x,h.y,g.x,g.y,_.x,_.y,U.x,U.y)&&mr(U.prev,U,U.next)>=0)return!1;U=U.prevZ}for(;Q&&Q.z<=k;){if(Q!==b.prev&&Q!==b.next&&Ia(h.x,h.y,g.x,g.y,_.x,_.y,Q.x,Q.y)&&mr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function FA(b,i,l){let u=b;do{const h=u.prev,g=u.next.next;!zo(h,g)&&zu(h,u,u.next,g)&&Qu(h,g)&&Qu(g,h)&&(i.push(h.i/l),i.push(u.i/l),i.push(g.i/l),_f(u),_f(u.next),u=b=g),u=u.next}while(u!==b);return ju(u)}function E0(b,i,l,u,h,g){let _=b;do{let y=_.next.next;for(;y!==_.prev;){if(_.i!==y.i&&Zs(_,y)){let C=Ag(_,y);return _=ju(_,_.next),C=ju(C,C.next),mf(_,i,l,u,h,g),void mf(C,i,l,u,h,g)}y=y.next}_=_.next}while(_!==b)}function vf(b,i){return b.x-i.x}function pl(b,i){if(i=function(l,u){let h=u;const g=l.x,_=l.y;let y,C=-1/0;do{if(_<=h.y&&_>=h.next.y&&h.next.y!==h.y){const Q=h.x+(_-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(Q<=g&&Q>C){if(C=Q,Q===g){if(_===h.y)return h;if(_===h.next.y)return h.next}y=h.x<h.next.x?h:h.next}}h=h.next}while(h!==u);if(!y)return null;if(g===C)return y;const S=y,B=y.x,L=y.y;let k,U=1/0;h=y;do g>=h.x&&h.x>=B&&g!==h.x&&Ia(_<L?g:C,_,B,L,_<L?C:g,_,h.x,h.y)&&(k=Math.abs(_-h.y)/(g-h.x),Qu(h,l)&&(k<U||k===U&&(h.x>y.x||h.x===y.x&&jA(y,h)))&&(y=h,U=k)),h=h.next;while(h!==S);return y}(b,i),i){const l=Ag(i,b);ju(i,i.next),ju(l,l.next)}}function jA(b,i){return mr(b.prev,b,i.prev)<0&&mr(i.next,b,b.next)<0}function _g(b,i,l,u,h){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-l)*h)|b<<8))|b<<4))|b<<2))|b<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-u)*h)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Qh(b){let i=b,l=b;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==b);return l}function Ia(b,i,l,u,h,g,_,y){return(h-_)*(i-y)-(b-_)*(g-y)>=0&&(b-_)*(u-y)-(l-_)*(i-y)>=0&&(l-_)*(g-y)-(h-_)*(u-y)>=0}function Zs(b,i){return b.next.i!==i.i&&b.prev.i!==i.i&&!function(l,u){let h=l;do{if(h.i!==l.i&&h.next.i!==l.i&&h.i!==u.i&&h.next.i!==u.i&&zu(h,h.next,l,u))return!0;h=h.next}while(h!==l);return!1}(b,i)&&(Qu(b,i)&&Qu(i,b)&&function(l,u){let h=l,g=!1;const _=(l.x+u.x)/2,y=(l.y+u.y)/2;do h.y>y!=h.next.y>y&&h.next.y!==h.y&&_<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==l);return g}(b,i)&&(mr(b.prev,b,i.prev)||mr(b,i.prev,i))||zo(b,i)&&mr(b.prev,b,b.next)>0&&mr(i.prev,i,i.next)>0)}function mr(b,i,l){return(i.y-b.y)*(l.x-i.x)-(i.x-b.x)*(l.y-i.y)}function zo(b,i){return b.x===i.x&&b.y===i.y}function zu(b,i,l,u){const h=Qo(mr(b,i,l)),g=Qo(mr(b,i,u)),_=Qo(mr(l,u,b)),y=Qo(mr(l,u,i));return h!==g&&_!==y||!(h!==0||!Da(b,l,i))||!(g!==0||!Da(b,u,i))||!(_!==0||!Da(l,b,u))||!(y!==0||!Da(l,i,u))}function Da(b,i,l){return i.x<=Math.max(b.x,l.x)&&i.x>=Math.min(b.x,l.x)&&i.y<=Math.max(b.y,l.y)&&i.y>=Math.min(b.y,l.y)}function Qo(b){return b>0?1:b<0?-1:0}function Qu(b,i){return mr(b.prev,b,b.next)<0?mr(b,i,b.next)>=0&&mr(b,b.prev,i)>=0:mr(b,i,b.prev)<0||mr(b,b.next,i)<0}function Ag(b,i){const l=new C0(b.i,b.x,b.y),u=new C0(i.i,i.x,i.y),h=b.next,g=i.prev;return b.next=i,i.prev=b,l.next=h,h.prev=l,u.next=l,l.prev=u,g.next=u,u.prev=g,u}function Vo(b,i,l,u){const h=new C0(b,i,l);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function _f(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function C0(b,i,l){this.i=b,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class fl{static area(i){const l=i.length;let u=0;for(let h=l-1,g=0;g<l;h=g++)u+=i[h].x*i[g].y-i[g].x*i[h].y;return .5*u}static isClockWise(i){return fl.area(i)<0}static triangulateShape(i,l){const u=[],h=[],g=[];oa(i),yg(u,i);let _=i.length;l.forEach(oa);for(let C=0;C<l.length;C++)h.push(_),_+=l[C].length,yg(u,l[C]);const y=function(C,S,B=2){const L=S&&S.length,k=L?S[0]*B:C.length;let U=NA(C,0,k,B,!0);const Q=[];if(!U||U.next===U.prev)return Q;let F,H,W,q,$,ie,se;if(L&&(U=function(le,Ie,De,Xe){const Ke=[];let Be,St,Ft,Et,nn;for(Be=0,St=Ie.length;Be<St;Be++)Ft=Ie[Be]*Xe,Et=Be<St-1?Ie[Be+1]*Xe:le.length,nn=NA(le,Ft,Et,Xe,!1),nn===nn.next&&(nn.steiner=!0),Ke.push(Qh(nn));for(Ke.sort(vf),Be=0;Be<Ke.length;Be++)pl(Ke[Be],De),De=ju(De,De.next);return De}(C,S,U,B)),C.length>80*B){F=W=C[0],H=q=C[1];for(let le=B;le<k;le+=B)$=C[le],ie=C[le+1],$<F&&(F=$),ie<H&&(H=ie),$>W&&(W=$),ie>q&&(q=ie);se=Math.max(W-F,q-H),se=se!==0?1/se:0}return mf(U,Q,B,F,H,se),Q}(u,h);for(let C=0;C<y.length;C+=3)g.push(y.slice(C,C+3));return g}}function oa(b){const i=b.length;i>2&&b[i-1].equals(b[0])&&b.pop()}function yg(b,i){for(let l=0;l<i.length;l++)b.push(i[l].x),b.push(i[l].y)}class Af extends wn{constructor(i=new zh([new Lt(.5,.5),new Lt(-.5,.5),new Lt(-.5,-.5),new Lt(.5,-.5)]),l={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:i,options:l},i=Array.isArray(i)?i:[i];const u=this,h=[],g=[];for(let y=0,C=i.length;y<C;y++)_(i[y]);function _(y){const C=[],S=l.curveSegments!==void 0?l.curveSegments:12,B=l.steps!==void 0?l.steps:1,L=l.depth!==void 0?l.depth:1;let k=l.bevelEnabled===void 0||l.bevelEnabled,U=l.bevelThickness!==void 0?l.bevelThickness:.2,Q=l.bevelSize!==void 0?l.bevelSize:U-.1,F=l.bevelOffset!==void 0?l.bevelOffset:0,H=l.bevelSegments!==void 0?l.bevelSegments:3;const W=l.extrudePath,q=l.UVGenerator!==void 0?l.UVGenerator:yw;let $,ie,se,le,Ie,De=!1;W&&($=W.getSpacedPoints(B),De=!0,k=!1,ie=W.computeFrenetFrames(B,!1),se=new he,le=new he,Ie=new he),k||(H=0,U=0,Q=0,F=0);const Xe=y.extractPoints(S);let Ke=Xe.shape;const Be=Xe.holes;if(!fl.isClockWise(Ke)){Ke=Ke.reverse();for(let qe=0,Se=Be.length;qe<Se;qe++){const He=Be[qe];fl.isClockWise(He)&&(Be[qe]=He.reverse())}}const St=fl.triangulateShape(Ke,Be),Ft=Ke;for(let qe=0,Se=Be.length;qe<Se;qe++){const He=Be[qe];Ke=Ke.concat(He)}function Et(qe,Se,He){return Se||console.error("THREE.ExtrudeGeometry: vec does not exist"),Se.clone().multiplyScalar(He).add(qe)}const nn=Ke.length,rn=St.length;function dt(qe,Se,He){let gt,ee,_t;const tt=qe.x-Se.x,Ct=qe.y-Se.y,Pt=He.x-qe.x,cn=He.y-qe.y,Rn=tt*tt+Ct*Ct,zn=tt*cn-Ct*Pt;if(Math.abs(zn)>Number.EPSILON){const ti=Math.sqrt(Rn),Un=Math.sqrt(Pt*Pt+cn*cn),Qn=Se.x-Ct/ti,Ui=Se.y+tt/ti,ca=((He.x-cn/Un-Qn)*cn-(He.y+Pt/Un-Ui)*Pt)/(tt*cn-Ct*Pt);gt=Qn+tt*ca-qe.x,ee=Ui+Ct*ca-qe.y;const $n=gt*gt+ee*ee;if($n<=2)return new Lt(gt,ee);_t=Math.sqrt($n/2)}else{let ti=!1;tt>Number.EPSILON?Pt>Number.EPSILON&&(ti=!0):tt<-Number.EPSILON?Pt<-Number.EPSILON&&(ti=!0):Math.sign(Ct)===Math.sign(cn)&&(ti=!0),ti?(gt=-Ct,ee=tt,_t=Math.sqrt(Rn)):(gt=tt,ee=Ct,_t=Math.sqrt(Rn/2))}return new Lt(gt/_t,ee/_t)}const At=[];for(let qe=0,Se=Ft.length,He=Se-1,gt=qe+1;qe<Se;qe++,He++,gt++)He===Se&&(He=0),gt===Se&&(gt=0),At[qe]=dt(Ft[qe],Ft[He],Ft[gt]);const Wt=[];let Mt,en=At.concat();for(let qe=0,Se=Be.length;qe<Se;qe++){const He=Be[qe];Mt=[];for(let gt=0,ee=He.length,_t=ee-1,tt=gt+1;gt<ee;gt++,_t++,tt++)_t===ee&&(_t=0),tt===ee&&(tt=0),Mt[gt]=dt(He[gt],He[_t],He[tt]);Wt.push(Mt),en=en.concat(Mt)}for(let qe=0;qe<H;qe++){const Se=qe/H,He=U*Math.cos(Se*Math.PI/2),gt=Q*Math.sin(Se*Math.PI/2)+F;for(let ee=0,_t=Ft.length;ee<_t;ee++){const tt=Et(Ft[ee],At[ee],gt);Pn(tt.x,tt.y,-He)}for(let ee=0,_t=Be.length;ee<_t;ee++){const tt=Be[ee];Mt=Wt[ee];for(let Ct=0,Pt=tt.length;Ct<Pt;Ct++){const cn=Et(tt[Ct],Mt[Ct],gt);Pn(cn.x,cn.y,-He)}}}const In=Q+F;for(let qe=0;qe<nn;qe++){const Se=k?Et(Ke[qe],en[qe],In):Ke[qe];De?(le.copy(ie.normals[0]).multiplyScalar(Se.x),se.copy(ie.binormals[0]).multiplyScalar(Se.y),Ie.copy($[0]).add(le).add(se),Pn(Ie.x,Ie.y,Ie.z)):Pn(Se.x,Se.y,0)}for(let qe=1;qe<=B;qe++)for(let Se=0;Se<nn;Se++){const He=k?Et(Ke[Se],en[Se],In):Ke[Se];De?(le.copy(ie.normals[qe]).multiplyScalar(He.x),se.copy(ie.binormals[qe]).multiplyScalar(He.y),Ie.copy($[qe]).add(le).add(se),Pn(Ie.x,Ie.y,Ie.z)):Pn(He.x,He.y,L/B*qe)}for(let qe=H-1;qe>=0;qe--){const Se=qe/H,He=U*Math.cos(Se*Math.PI/2),gt=Q*Math.sin(Se*Math.PI/2)+F;for(let ee=0,_t=Ft.length;ee<_t;ee++){const tt=Et(Ft[ee],At[ee],gt);Pn(tt.x,tt.y,L+He)}for(let ee=0,_t=Be.length;ee<_t;ee++){const tt=Be[ee];Mt=Wt[ee];for(let Ct=0,Pt=tt.length;Ct<Pt;Ct++){const cn=Et(tt[Ct],Mt[Ct],gt);De?Pn(cn.x,cn.y+$[B-1].y,$[B-1].x+He):Pn(cn.x,cn.y,L+He)}}}function hi(qe,Se){let He=qe.length;for(;--He>=0;){const gt=He;let ee=He-1;ee<0&&(ee=qe.length-1);for(let _t=0,tt=B+2*H;_t<tt;_t++){const Ct=nn*_t,Pt=nn*(_t+1);Ce(Se+gt+Ct,Se+ee+Ct,Se+ee+Pt,Se+gt+Pt)}}}function Pn(qe,Se,He){C.push(qe),C.push(Se),C.push(He)}function ri(qe,Se,He){_e(qe),_e(Se),_e(He);const gt=h.length/3,ee=q.generateTopUV(u,h,gt-3,gt-2,gt-1);it(ee[0]),it(ee[1]),it(ee[2])}function Ce(qe,Se,He,gt){_e(qe),_e(Se),_e(gt),_e(Se),_e(He),_e(gt);const ee=h.length/3,_t=q.generateSideWallUV(u,h,ee-6,ee-3,ee-2,ee-1);it(_t[0]),it(_t[1]),it(_t[3]),it(_t[1]),it(_t[2]),it(_t[3])}function _e(qe){h.push(C[3*qe+0]),h.push(C[3*qe+1]),h.push(C[3*qe+2])}function it(qe){g.push(qe.x),g.push(qe.y)}(function(){const qe=h.length/3;if(k){let Se=0,He=nn*Se;for(let gt=0;gt<rn;gt++){const ee=St[gt];ri(ee[2]+He,ee[1]+He,ee[0]+He)}Se=B+2*H,He=nn*Se;for(let gt=0;gt<rn;gt++){const ee=St[gt];ri(ee[0]+He,ee[1]+He,ee[2]+He)}}else{for(let Se=0;Se<rn;Se++){const He=St[Se];ri(He[2],He[1],He[0])}for(let Se=0;Se<rn;Se++){const He=St[Se];ri(He[0]+nn*B,He[1]+nn*B,He[2]+nn*B)}}u.addGroup(qe,h.length/3-qe,0)})(),function(){const qe=h.length/3;let Se=0;hi(Ft,Se),Se+=Ft.length;for(let He=0,gt=Be.length;He<gt;He++){const ee=Be[He];hi(ee,Se),Se+=ee.length}u.addGroup(qe,h.length/3-qe,1)}()}this.setAttribute("position",new w(h,3)),this.setAttribute("uv",new w(g,2)),this.computeVertexNormals()}toJSON(){const i=super.toJSON();return function(l,u,h){if(h.shapes=[],Array.isArray(l))for(let g=0,_=l.length;g<_;g++){const y=l[g];h.shapes.push(y.uuid)}else h.shapes.push(l.uuid);return h.options=Object.assign({},u),u.extrudePath!==void 0&&(h.options.extrudePath=u.extrudePath.toJSON()),h}(this.parameters.shapes,this.parameters.options,i)}static fromJSON(i,l){const u=[];for(let g=0,_=i.shapes.length;g<_;g++){const y=l[i.shapes[g]];u.push(y)}const h=i.options.extrudePath;return h!==void 0&&(i.options.extrudePath=new Ii[h.type]().fromJSON(h)),new Af(u,i.options)}}const yw={generateTopUV:function(b,i,l,u,h){const g=i[3*l],_=i[3*l+1],y=i[3*u],C=i[3*u+1],S=i[3*h],B=i[3*h+1];return[new Lt(g,_),new Lt(y,C),new Lt(S,B)]},generateSideWallUV:function(b,i,l,u,h,g){const _=i[3*l],y=i[3*l+1],C=i[3*l+2],S=i[3*u],B=i[3*u+1],L=i[3*u+2],k=i[3*h],U=i[3*h+1],Q=i[3*h+2],F=i[3*g],H=i[3*g+1],W=i[3*g+2];return Math.abs(y-B)<Math.abs(_-S)?[new Lt(_,1-C),new Lt(S,1-L),new Lt(k,1-Q),new Lt(F,1-W)]:[new Lt(y,1-C),new Lt(B,1-L),new Lt(U,1-Q),new Lt(H,1-W)]}};class $d extends zc{constructor(i=1,l=0){const u=(1+Math.sqrt(5))/2;super([-1,u,0,1,u,0,-1,-u,0,1,-u,0,0,-1,u,0,1,u,0,-1,-u,0,1,-u,u,0,-1,u,0,1,-u,0,-1,-u,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,l),this.type="IcosahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new $d(i.radius,i.detail)}}class Os extends zc{constructor(i=1,l=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],i,l),this.type="OctahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new Os(i.radius,i.detail)}}class Vh extends wn{constructor(i=.5,l=1,u=8,h=1,g=0,_=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:i,outerRadius:l,thetaSegments:u,phiSegments:h,thetaStart:g,thetaLength:_},u=Math.max(3,u);const y=[],C=[],S=[],B=[];let L=i;const k=(l-i)/(h=Math.max(1,h)),U=new he,Q=new Lt;for(let F=0;F<=h;F++){for(let H=0;H<=u;H++){const W=g+H/u*_;U.x=L*Math.cos(W),U.y=L*Math.sin(W),C.push(U.x,U.y,U.z),S.push(0,0,1),Q.x=(U.x/l+1)/2,Q.y=(U.y/l+1)/2,B.push(Q.x,Q.y)}L+=k}for(let F=0;F<h;F++){const H=F*(u+1);for(let W=0;W<u;W++){const q=W+H,$=q,ie=q+u+1,se=q+u+2,le=q+1;y.push($,ie,le),y.push(ie,se,le)}}this.setIndex(y),this.setAttribute("position",new w(C,3)),this.setAttribute("normal",new w(S,3)),this.setAttribute("uv",new w(B,2))}static fromJSON(i){return new Vh(i.innerRadius,i.outerRadius,i.thetaSegments,i.phiSegments,i.thetaStart,i.thetaLength)}}class yf extends wn{constructor(i=new zh([new Lt(0,.5),new Lt(-.5,-.5),new Lt(.5,-.5)]),l=12){super(),this.type="ShapeGeometry",this.parameters={shapes:i,curveSegments:l};const u=[],h=[],g=[],_=[];let y=0,C=0;if(Array.isArray(i)===!1)S(i);else for(let B=0;B<i.length;B++)S(i[B]),this.addGroup(y,C,B),y+=C,C=0;function S(B){const L=h.length/3,k=B.extractPoints(l);let U=k.shape;const Q=k.holes;fl.isClockWise(U)===!1&&(U=U.reverse());for(let H=0,W=Q.length;H<W;H++){const q=Q[H];fl.isClockWise(q)===!0&&(Q[H]=q.reverse())}const F=fl.triangulateShape(U,Q);for(let H=0,W=Q.length;H<W;H++){const q=Q[H];U=U.concat(q)}for(let H=0,W=U.length;H<W;H++){const q=U[H];h.push(q.x,q.y,0),g.push(0,0,1),_.push(q.x,q.y)}for(let H=0,W=F.length;H<W;H++){const q=F[H],$=q[0]+L,ie=q[1]+L,se=q[2]+L;u.push($,ie,se),C+=3}}this.setIndex(u),this.setAttribute("position",new w(h,3)),this.setAttribute("normal",new w(g,3)),this.setAttribute("uv",new w(_,2))}toJSON(){const i=super.toJSON();return function(l,u){if(u.shapes=[],Array.isArray(l))for(let h=0,g=l.length;h<g;h++){const _=l[h];u.shapes.push(_.uuid)}else u.shapes.push(l.uuid);return u}(this.parameters.shapes,i)}static fromJSON(i,l){const u=[];for(let h=0,g=i.shapes.length;h<g;h++){const _=l[i.shapes[h]];u.push(_)}return new yf(u,i.curveSegments)}}class ep extends wn{constructor(i=1,l=32,u=16,h=0,g=2*Math.PI,_=0,y=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:i,widthSegments:l,heightSegments:u,phiStart:h,phiLength:g,thetaStart:_,thetaLength:y},l=Math.max(3,Math.floor(l)),u=Math.max(2,Math.floor(u));const C=Math.min(_+y,Math.PI);let S=0;const B=[],L=new he,k=new he,U=[],Q=[],F=[],H=[];for(let W=0;W<=u;W++){const q=[],$=W/u;let ie=0;W==0&&_==0?ie=.5/l:W==u&&C==Math.PI&&(ie=-.5/l);for(let se=0;se<=l;se++){const le=se/l;L.x=-i*Math.cos(h+le*g)*Math.sin(_+$*y),L.y=i*Math.cos(_+$*y),L.z=i*Math.sin(h+le*g)*Math.sin(_+$*y),Q.push(L.x,L.y,L.z),k.copy(L).normalize(),F.push(k.x,k.y,k.z),H.push(le+ie,1-$),q.push(S++)}B.push(q)}for(let W=0;W<u;W++)for(let q=0;q<l;q++){const $=B[W][q+1],ie=B[W][q],se=B[W+1][q],le=B[W+1][q+1];(W!==0||_>0)&&U.push($,ie,le),(W!==u-1||C<Math.PI)&&U.push(ie,se,le)}this.setIndex(U),this.setAttribute("position",new w(Q,3)),this.setAttribute("normal",new w(F,3)),this.setAttribute("uv",new w(H,2))}static fromJSON(i){return new ep(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength)}}class Gh extends zc{constructor(i=1,l=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],i,l),this.type="TetrahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new Gh(i.radius,i.detail)}}class Vu extends wn{constructor(i=1,l=.4,u=8,h=6,g=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:i,tube:l,radialSegments:u,tubularSegments:h,arc:g},u=Math.floor(u),h=Math.floor(h);const _=[],y=[],C=[],S=[],B=new he,L=new he,k=new he;for(let U=0;U<=u;U++)for(let Q=0;Q<=h;Q++){const F=Q/h*g,H=U/u*Math.PI*2;L.x=(i+l*Math.cos(H))*Math.cos(F),L.y=(i+l*Math.cos(H))*Math.sin(F),L.z=l*Math.sin(H),y.push(L.x,L.y,L.z),B.x=i*Math.cos(F),B.y=i*Math.sin(F),k.subVectors(L,B).normalize(),C.push(k.x,k.y,k.z),S.push(Q/h),S.push(U/u)}for(let U=1;U<=u;U++)for(let Q=1;Q<=h;Q++){const F=(h+1)*U+Q-1,H=(h+1)*(U-1)+Q-1,W=(h+1)*(U-1)+Q,q=(h+1)*U+Q;_.push(F,H,q),_.push(H,W,q)}this.setIndex(_),this.setAttribute("position",new w(y,3)),this.setAttribute("normal",new w(C,3)),this.setAttribute("uv",new w(S,2))}static fromJSON(i){return new Vu(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc)}}class Es extends wn{constructor(i=1,l=.4,u=64,h=8,g=2,_=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:i,tube:l,tubularSegments:u,radialSegments:h,p:g,q:_},u=Math.floor(u),h=Math.floor(h);const y=[],C=[],S=[],B=[],L=new he,k=new he,U=new he,Q=new he,F=new he,H=new he,W=new he;for(let $=0;$<=u;++$){const ie=$/u*g*Math.PI*2;q(ie,g,_,i,U),q(ie+.01,g,_,i,Q),H.subVectors(Q,U),W.addVectors(Q,U),F.crossVectors(H,W),W.crossVectors(F,H),F.normalize(),W.normalize();for(let se=0;se<=h;++se){const le=se/h*Math.PI*2,Ie=-l*Math.cos(le),De=l*Math.sin(le);L.x=U.x+(Ie*W.x+De*F.x),L.y=U.y+(Ie*W.y+De*F.y),L.z=U.z+(Ie*W.z+De*F.z),C.push(L.x,L.y,L.z),k.subVectors(L,U).normalize(),S.push(k.x,k.y,k.z),B.push($/u),B.push(se/h)}}for(let $=1;$<=u;$++)for(let ie=1;ie<=h;ie++){const se=(h+1)*($-1)+(ie-1),le=(h+1)*$+(ie-1),Ie=(h+1)*$+ie,De=(h+1)*($-1)+ie;y.push(se,le,De),y.push(le,Ie,De)}function q($,ie,se,le,Ie){const De=Math.cos($),Xe=Math.sin($),Ke=se/ie*$,Be=Math.cos(Ke);Ie.x=le*(2+Be)*.5*De,Ie.y=le*(2+Be)*Xe*.5,Ie.z=le*Math.sin(Ke)*.5}this.setIndex(y),this.setAttribute("position",new w(C,3)),this.setAttribute("normal",new w(S,3)),this.setAttribute("uv",new w(B,2))}static fromJSON(i){return new Es(i.radius,i.tube,i.tubularSegments,i.radialSegments,i.p,i.q)}}class bf extends wn{constructor(i=new gg(new he(-1,-1,0),new he(-1,1,0),new he(1,1,0)),l=64,u=1,h=8,g=!1){super(),this.type="TubeGeometry",this.parameters={path:i,tubularSegments:l,radius:u,radialSegments:h,closed:g};const _=i.computeFrenetFrames(l,g);this.tangents=_.tangents,this.normals=_.normals,this.binormals=_.binormals;const y=new he,C=new he,S=new Lt;let B=new he;const L=[],k=[],U=[],Q=[];function F(H){B=i.getPointAt(H/l,B);const W=_.normals[H],q=_.binormals[H];for(let $=0;$<=h;$++){const ie=$/h*Math.PI*2,se=Math.sin(ie),le=-Math.cos(ie);C.x=le*W.x+se*q.x,C.y=le*W.y+se*q.y,C.z=le*W.z+se*q.z,C.normalize(),k.push(C.x,C.y,C.z),y.x=B.x+u*C.x,y.y=B.y+u*C.y,y.z=B.z+u*C.z,L.push(y.x,y.y,y.z)}}(function(){for(let H=0;H<l;H++)F(H);F(g===!1?l:0),function(){for(let H=0;H<=l;H++)for(let W=0;W<=h;W++)S.x=H/l,S.y=W/h,U.push(S.x,S.y)}(),function(){for(let H=1;H<=l;H++)for(let W=1;W<=h;W++){const q=(h+1)*(H-1)+(W-1),$=(h+1)*H+(W-1),ie=(h+1)*H+W,se=(h+1)*(H-1)+W;Q.push(q,$,se),Q.push($,ie,se)}}()})(),this.setIndex(Q),this.setAttribute("position",new w(L,3)),this.setAttribute("normal",new w(k,3)),this.setAttribute("uv",new w(U,2))}toJSON(){const i=super.toJSON();return i.path=this.parameters.path.toJSON(),i}static fromJSON(i){return new bf(new Ii[i.path.type]().fromJSON(i.path),i.tubularSegments,i.radius,i.radialSegments,i.closed)}}class zA extends wn{constructor(i=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:i},i!==null){const l=[],u=new Set,h=new he,g=new he;if(i.index!==null){const _=i.attributes.position,y=i.index;let C=i.groups;C.length===0&&(C=[{start:0,count:y.count,materialIndex:0}]);for(let S=0,B=C.length;S<B;++S){const L=C[S],k=L.start;for(let U=k,Q=k+L.count;U<Q;U+=3)for(let F=0;F<3;F++){const H=y.getX(U+F),W=y.getX(U+(F+1)%3);h.fromBufferAttribute(_,H),g.fromBufferAttribute(_,W),S0(h,g,u)===!0&&(l.push(h.x,h.y,h.z),l.push(g.x,g.y,g.z))}}}else{const _=i.attributes.position;for(let y=0,C=_.count/3;y<C;y++)for(let S=0;S<3;S++){const B=3*y+S,L=3*y+(S+1)%3;h.fromBufferAttribute(_,B),g.fromBufferAttribute(_,L),S0(h,g,u)===!0&&(l.push(h.x,h.y,h.z),l.push(g.x,g.y,g.z))}}this.setAttribute("position",new w(l,3))}}}function S0(b,i,l){const u=`${b.x},${b.y},${b.z}-${i.x},${i.y},${i.z}`,h=`${i.x},${i.y},${i.z}-${b.x},${b.y},${b.z}`;return l.has(u)!==!0&&l.has(h)!==!0&&(l.add(u),l.add(h),!0)}var Pa=Object.freeze({__proto__:null,BoxGeometry:Ma,CapsuleGeometry:df,CircleGeometry:sa,ConeGeometry:rr,CylinderGeometry:as,DodecahedronGeometry:pf,EdgesGeometry:vg,ExtrudeGeometry:Af,IcosahedronGeometry:$d,LatheGeometry:_r,OctahedronGeometry:Os,PlaneGeometry:Bu,PolyhedronGeometry:zc,RingGeometry:Vh,ShapeGeometry:yf,SphereGeometry:ep,TetrahedronGeometry:Gh,TorusGeometry:Vu,TorusKnotGeometry:Es,TubeGeometry:bf,WireframeGeometry:zA});class bg extends ss{constructor(i){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new mn(0),this.transparent=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.fog=i.fog,this}}class QA extends rl{constructor(i){super(i),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class M0 extends ss{constructor(i){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new mn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class T0 extends M0{constructor(i){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Lt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return On(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(l){this.ior=(1+.4*l)/(1-.4*l)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new mn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new mn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new mn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(i)}get sheen(){return this._sheen}set sheen(i){this._sheen>0!=i>0&&this.version++,this._sheen=i}get clearcoat(){return this._clearcoat}set clearcoat(i){this._clearcoat>0!=i>0&&this.version++,this._clearcoat=i}get iridescence(){return this._iridescence}set iridescence(i){this._iridescence>0!=i>0&&this.version++,this._iridescence=i}get transmission(){return this._transmission}set transmission(i){this._transmission>0!=i>0&&this.version++,this._transmission=i}copy(i){return super.copy(i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.ior=i.ior,this.iridescence=i.iridescence,this.iridescenceMap=i.iridescenceMap,this.iridescenceIOR=i.iridescenceIOR,this.iridescenceThicknessRange=[...i.iridescenceThicknessRange],this.iridescenceThicknessMap=i.iridescenceThicknessMap,this.sheen=i.sheen,this.sheenColor.copy(i.sheenColor),this.sheenColorMap=i.sheenColorMap,this.sheenRoughness=i.sheenRoughness,this.sheenRoughnessMap=i.sheenRoughnessMap,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this.thickness=i.thickness,this.thicknessMap=i.thicknessMap,this.attenuationDistance=i.attenuationDistance,this.attenuationColor.copy(i.attenuationColor),this.specularIntensity=i.specularIntensity,this.specularIntensityMap=i.specularIntensityMap,this.specularColor.copy(i.specularColor),this.specularColorMap=i.specularColorMap,this}}class wf extends ss{constructor(i){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new mn(16777215),this.specular=new mn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.specular.copy(i.specular),this.shininess=i.shininess,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class VA extends ss{constructor(i){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new mn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.gradientMap=i.gradientMap,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}class xf extends ss{constructor(i){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(i)}copy(i){return super.copy(i),this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.flatShading=i.flatShading,this}}class I0 extends ss{constructor(i){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new mn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new mn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=jn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class Ef extends ss{constructor(i){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new mn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zr,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.defines={MATCAP:""},this.color.copy(i.color),this.matcap=i.matcap,this.map=i.map,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.flatShading=i.flatShading,this.fog=i.fog,this}}class D0 extends lo{constructor(i){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(i)}copy(i){return super.copy(i),this.scale=i.scale,this.dashSize=i.dashSize,this.gapSize=i.gapSize,this}}function aa(b,i,l){return xr(b)?new b.constructor(b.subarray(i,l!==void 0?l:b.length)):b.slice(i,l)}function Go(b,i,l){return!b||!l&&b.constructor===i?b:typeof i.BYTES_PER_ELEMENT=="number"?new i(b):Array.prototype.slice.call(b)}function xr(b){return ArrayBuffer.isView(b)&&!(b instanceof DataView)}function GA(b){const i=b.length,l=new Array(i);for(let u=0;u!==i;++u)l[u]=u;return l.sort(function(u,h){return b[u]-b[h]}),l}function co(b,i,l){const u=b.length,h=new b.constructor(u);for(let g=0,_=0;_!==u;++g){const y=l[g]*i;for(let C=0;C!==i;++C)h[_++]=b[y+C]}return h}function Dr(b,i,l,u){let h=1,g=b[0];for(;g!==void 0&&g[u]===void 0;)g=b[h++];if(g===void 0)return;let _=g[u];if(_!==void 0)if(Array.isArray(_))do _=g[u],_!==void 0&&(i.push(g.time),l.push.apply(l,_)),g=b[h++];while(g!==void 0);else if(_.toArray!==void 0)do _=g[u],_!==void 0&&(i.push(g.time),_.toArray(l,l.length)),g=b[h++];while(g!==void 0);else do _=g[u],_!==void 0&&(i.push(g.time),l.push(_)),g=b[h++];while(g!==void 0)}var Cf=Object.freeze({__proto__:null,arraySlice:aa,convertArray:Go,isTypedArray:xr,getKeyframeOrder:GA,sortedArray:co,flattenJSON:Dr,subclip:function(b,i,l,u,h=30){const g=b.clone();g.name=i;const _=[];for(let C=0;C<g.tracks.length;++C){const S=g.tracks[C],B=S.getValueSize(),L=[],k=[];for(let U=0;U<S.times.length;++U){const Q=S.times[U]*h;if(!(Q<l||Q>=u)){L.push(S.times[U]);for(let F=0;F<B;++F)k.push(S.values[U*B+F])}}L.length!==0&&(S.times=Go(L,S.times.constructor),S.values=Go(k,S.values.constructor),_.push(S))}g.tracks=_;let y=1/0;for(let C=0;C<g.tracks.length;++C)y>g.tracks[C].times[0]&&(y=g.tracks[C].times[0]);for(let C=0;C<g.tracks.length;++C)g.tracks[C].shift(-1*y);return g.resetDuration(),g},makeClipAdditive:function(b,i=0,l=b,u=30){u<=0&&(u=30);const h=l.tracks.length,g=i/u;for(let _=0;_<h;++_){const y=l.tracks[_],C=y.ValueTypeName;if(C==="bool"||C==="string")continue;const S=b.tracks.find(function(W){return W.name===y.name&&W.ValueTypeName===C});if(S===void 0)continue;let B=0;const L=y.getValueSize();y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(B=L/3);let k=0;const U=S.getValueSize();S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(k=U/3);const Q=y.times.length-1;let F;if(g<=y.times[0]){const W=B,q=L-B;F=aa(y.values,W,q)}else if(g>=y.times[Q]){const W=Q*L+B,q=W+L-B;F=aa(y.values,W,q)}else{const W=y.createInterpolant(),q=B,$=L-B;W.evaluate(g),F=aa(W.resultBuffer,q,$)}C==="quaternion"&&new ns().fromArray(F).normalize().conjugate().toArray(F);const H=S.times.length;for(let W=0;W<H;++W){const q=W*U+k;if(C==="quaternion")ns.multiplyQuaternionsFlat(S.values,q,F,0,S.values,q);else{const $=U-2*k;for(let ie=0;ie<$;++ie)S.values[q+ie]-=F[ie]}}}return b.blendMode=gd,b}});class Hh{constructor(i,l,u,h){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=h!==void 0?h:new l.constructor(u),this.sampleValues=l,this.valueSize=u,this.settings=null,this.DefaultSettings_={}}evaluate(i){const l=this.parameterPositions;let u=this._cachedIndex,h=l[u],g=l[u-1];e:{t:{let _;n:{i:if(!(i<h)){for(let y=u+2;;){if(h===void 0){if(i<g)break i;return u=l.length,this._cachedIndex=u,this.copySampleValue_(u-1)}if(u===y)break;if(g=h,h=l[++u],i<h)break t}_=l.length;break n}if(i>=g)break e;{const y=l[1];i<y&&(u=2,g=y);for(let C=u-2;;){if(g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(u===C)break;if(h=g,g=l[--u-1],i>=g)break t}_=u,u=0}}for(;u<_;){const y=u+_>>>1;i<l[y]?_=y:u=y+1}if(h=l[u],g=l[u-1],g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(h===void 0)return u=l.length,this._cachedIndex=u,this.copySampleValue_(u-1)}this._cachedIndex=u,this.intervalChanged_(u,g,h)}return this.interpolate_(u,g,i,h)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(i){const l=this.resultBuffer,u=this.sampleValues,h=this.valueSize,g=i*h;for(let _=0;_!==h;++_)l[_]=u[g+_];return l}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class wg extends Hh{constructor(i,l,u,h){super(i,l,u,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Nr,endingEnd:Nr}}intervalChanged_(i,l,u){const h=this.parameterPositions;let g=i-2,_=i+1,y=h[g],C=h[_];if(y===void 0)switch(this.getSettings_().endingStart){case wo:g=i,y=2*l-u;break;case mc:g=h.length-2,y=l+h[g]-h[g+1];break;default:g=i,y=u}if(C===void 0)switch(this.getSettings_().endingEnd){case wo:_=i,C=2*u-l;break;case mc:_=1,C=u+h[1]-h[0];break;default:_=i-1,C=l}const S=.5*(u-l),B=this.valueSize;this._weightPrev=S/(l-y),this._weightNext=S/(C-u),this._offsetPrev=g*B,this._offsetNext=_*B}interpolate_(i,l,u,h){const g=this.resultBuffer,_=this.sampleValues,y=this.valueSize,C=i*y,S=C-y,B=this._offsetPrev,L=this._offsetNext,k=this._weightPrev,U=this._weightNext,Q=(u-l)/(h-l),F=Q*Q,H=F*Q,W=-k*H+2*k*F-k*Q,q=(1+k)*H+(-1.5-2*k)*F+(-.5+k)*Q+1,$=(-1-U)*H+(1.5+U)*F+.5*Q,ie=U*H-U*F;for(let se=0;se!==y;++se)g[se]=W*_[B+se]+q*_[S+se]+$*_[C+se]+ie*_[L+se];return g}}class P0 extends Hh{constructor(i,l,u,h){super(i,l,u,h)}interpolate_(i,l,u,h){const g=this.resultBuffer,_=this.sampleValues,y=this.valueSize,C=i*y,S=C-y,B=(u-l)/(h-l),L=1-B;for(let k=0;k!==y;++k)g[k]=_[S+k]*L+_[C+k]*B;return g}}class R0 extends Hh{constructor(i,l,u,h){super(i,l,u,h)}interpolate_(i){return this.copySampleValue_(i-1)}}class ml{constructor(i,l,u,h){if(i===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(l===void 0||l.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=Go(l,this.TimeBufferType),this.values=Go(u,this.ValueBufferType),this.setInterpolation(h||this.DefaultInterpolation)}static toJSON(i){const l=i.constructor;let u;if(l.toJSON!==this.toJSON)u=l.toJSON(i);else{u={name:i.name,times:Go(i.times,Array),values:Go(i.values,Array)};const h=i.getInterpolation();h!==i.DefaultInterpolation&&(u.interpolation=h)}return u.type=i.ValueTypeName,u}InterpolantFactoryMethodDiscrete(i){return new R0(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodLinear(i){return new P0(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodSmooth(i){return new wg(this.times,this.values,this.getValueSize(),i)}setInterpolation(i){let l;switch(i){case fc:l=this.InterpolantFactoryMethodDiscrete;break;case fu:l=this.InterpolantFactoryMethodLinear;break;case Jr:l=this.InterpolantFactoryMethodSmooth}if(l===void 0){const u="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(i===this.DefaultInterpolation)throw new Error(u);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",u),this}return this.createInterpolant=l,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return fc;case this.InterpolantFactoryMethodLinear:return fu;case this.InterpolantFactoryMethodSmooth:return Jr}}getValueSize(){return this.values.length/this.times.length}shift(i){if(i!==0){const l=this.times;for(let u=0,h=l.length;u!==h;++u)l[u]+=i}return this}scale(i){if(i!==1){const l=this.times;for(let u=0,h=l.length;u!==h;++u)l[u]*=i}return this}trim(i,l){const u=this.times,h=u.length;let g=0,_=h-1;for(;g!==h&&u[g]<i;)++g;for(;_!==-1&&u[_]>l;)--_;if(++_,g!==0||_!==h){g>=_&&(_=Math.max(_,1),g=_-1);const y=this.getValueSize();this.times=aa(u,g,_),this.values=aa(this.values,g*y,_*y)}return this}validate(){let i=!0;const l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);const u=this.times,h=this.values,g=u.length;g===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let _=null;for(let y=0;y!==g;y++){const C=u[y];if(typeof C=="number"&&isNaN(C)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,y,C),i=!1;break}if(_!==null&&_>C){console.error("THREE.KeyframeTrack: Out of order keys.",this,y,C,_),i=!1;break}_=C}if(h!==void 0&&xr(h))for(let y=0,C=h.length;y!==C;++y){const S=h[y];if(isNaN(S)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,y,S),i=!1;break}}return i}optimize(){const i=aa(this.times),l=aa(this.values),u=this.getValueSize(),h=this.getInterpolation()===Jr,g=i.length-1;let _=1;for(let y=1;y<g;++y){let C=!1;const S=i[y];if(S!==i[y+1]&&(y!==1||S!==i[0]))if(h)C=!0;else{const B=y*u,L=B-u,k=B+u;for(let U=0;U!==u;++U){const Q=l[B+U];if(Q!==l[L+U]||Q!==l[k+U]){C=!0;break}}}if(C){if(y!==_){i[_]=i[y];const B=y*u,L=_*u;for(let k=0;k!==u;++k)l[L+k]=l[B+k]}++_}}if(g>0){i[_]=i[g];for(let y=g*u,C=_*u,S=0;S!==u;++S)l[C+S]=l[y+S];++_}return _!==i.length?(this.times=aa(i,0,_),this.values=aa(l,0,_*u)):(this.times=i,this.values=l),this}clone(){const i=aa(this.times,0),l=aa(this.values,0),u=new this.constructor(this.name,i,l);return u.createInterpolant=this.createInterpolant,u}}ml.prototype.TimeBufferType=Float32Array,ml.prototype.ValueBufferType=Float32Array,ml.prototype.DefaultInterpolation=fu;class Qc extends ml{}Qc.prototype.ValueTypeName="bool",Qc.prototype.ValueBufferType=Array,Qc.prototype.DefaultInterpolation=fc,Qc.prototype.InterpolantFactoryMethodLinear=void 0,Qc.prototype.InterpolantFactoryMethodSmooth=void 0;class Vc extends ml{}Vc.prototype.ValueTypeName="color";class Gc extends ml{}Gc.prototype.ValueTypeName="number";class Sf extends Hh{constructor(i,l,u,h){super(i,l,u,h)}interpolate_(i,l,u,h){const g=this.resultBuffer,_=this.sampleValues,y=this.valueSize,C=(u-l)/(h-l);let S=i*y;for(let B=S+y;S!==B;S+=4)ns.slerpFlat(g,0,_,S-y,_,S,C);return g}}class Ho extends ml{InterpolantFactoryMethodLinear(i){return new Sf(this.times,this.values,this.getValueSize(),i)}}Ho.prototype.ValueTypeName="quaternion",Ho.prototype.DefaultInterpolation=fu,Ho.prototype.InterpolantFactoryMethodSmooth=void 0;class Ra extends ml{}Ra.prototype.ValueTypeName="string",Ra.prototype.ValueBufferType=Array,Ra.prototype.DefaultInterpolation=fc,Ra.prototype.InterpolantFactoryMethodLinear=void 0,Ra.prototype.InterpolantFactoryMethodSmooth=void 0;class tp extends ml{}tp.prototype.ValueTypeName="vector";class Mf{constructor(i,l=-1,u,h=Ji){this.name=i,this.tracks=u,this.duration=l,this.blendMode=h,this.uuid=_s(),this.duration<0&&this.resetDuration()}static parse(i){const l=[],u=i.tracks,h=1/(i.fps||1);for(let _=0,y=u.length;_!==y;++_)l.push(Gu(u[_]).scale(h));const g=new this(i.name,i.duration,l,i.blendMode);return g.uuid=i.uuid,g}static toJSON(i){const l=[],u=i.tracks,h={name:i.name,duration:i.duration,tracks:l,uuid:i.uuid,blendMode:i.blendMode};for(let g=0,_=u.length;g!==_;++g)l.push(ml.toJSON(u[g]));return h}static CreateFromMorphTargetSequence(i,l,u,h){const g=l.length,_=[];for(let y=0;y<g;y++){let C=[],S=[];C.push((y+g-1)%g,y,(y+1)%g),S.push(0,1,0);const B=GA(C);C=co(C,1,B),S=co(S,1,B),h||C[0]!==0||(C.push(g),S.push(S[0])),_.push(new Gc(".morphTargetInfluences["+l[y].name+"]",C,S).scale(1/u))}return new this(i,-1,_)}static findByName(i,l){let u=i;if(!Array.isArray(i)){const h=i;u=h.geometry&&h.geometry.animations||h.animations}for(let h=0;h<u.length;h++)if(u[h].name===l)return u[h];return null}static CreateClipsFromMorphTargetSequences(i,l,u){const h={},g=/^([\w-]*?)([\d]+)$/;for(let y=0,C=i.length;y<C;y++){const S=i[y],B=S.name.match(g);if(B&&B.length>1){const L=B[1];let k=h[L];k||(h[L]=k=[]),k.push(S)}}const _=[];for(const y in h)_.push(this.CreateFromMorphTargetSequence(y,h[y],l,u));return _}static parseAnimation(i,l){if(!i)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const u=function(B,L,k,U,Q){if(k.length!==0){const F=[],H=[];Dr(k,F,H,U),F.length!==0&&Q.push(new B(L,F,H))}},h=[],g=i.name||"default",_=i.fps||30,y=i.blendMode;let C=i.length||-1;const S=i.hierarchy||[];for(let B=0;B<S.length;B++){const L=S[B].keys;if(L&&L.length!==0)if(L[0].morphTargets){const k={};let U;for(U=0;U<L.length;U++)if(L[U].morphTargets)for(let Q=0;Q<L[U].morphTargets.length;Q++)k[L[U].morphTargets[Q]]=-1;for(const Q in k){const F=[],H=[];for(let W=0;W!==L[U].morphTargets.length;++W){const q=L[U];F.push(q.time),H.push(q.morphTarget===Q?1:0)}h.push(new Gc(".morphTargetInfluence["+Q+"]",F,H))}C=k.length*_}else{const k=".bones["+l[B].name+"]";u(tp,k+".position",L,"pos",h),u(Ho,k+".quaternion",L,"rot",h),u(tp,k+".scale",L,"scl",h)}}return h.length===0?null:new this(g,C,h,y)}resetDuration(){let i=0;for(let l=0,u=this.tracks.length;l!==u;++l){const h=this.tracks[l];i=Math.max(i,h.times[h.times.length-1])}return this.duration=i,this}trim(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this}validate(){let i=!0;for(let l=0;l<this.tracks.length;l++)i=i&&this.tracks[l].validate();return i}optimize(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this}clone(){const i=[];for(let l=0;l<this.tracks.length;l++)i.push(this.tracks[l].clone());return new this.constructor(this.name,this.duration,i,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Gu(b){if(b.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const i=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gc;case"vector":case"vector2":case"vector3":case"vector4":return tp;case"color":return Vc;case"quaternion":return Ho;case"bool":case"boolean":return Qc;case"string":return Ra}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(b.type);if(b.times===void 0){const l=[],u=[];Dr(b.keys,l,u,"value"),b.times=l,b.values=u}return i.parse!==void 0?i.parse(b):new i(b.name,b.times,b.values,b.interpolation)}const Hc={enabled:!1,files:{},add:function(b,i){this.enabled!==!1&&(this.files[b]=i)},get:function(b,i){return this.enabled===!1?i?Promise.resolve():void 0:i?Promise.resolve(this.files[b]):this.files[b]},remove:function(b){delete this.files[b]},clear:function(){this.files={}}};class Wc{constructor(i,l,u){const h=this;let g,_=!1,y=0,C=0;const S=[];this.onStart=void 0,this.onLoad=i,this.onProgress=l,this.onError=u,this.itemStart=function(B){C++,_===!1&&h.onStart!==void 0&&h.onStart(B,y,C),_=!0},this.itemEnd=function(B){y++,h.onProgress!==void 0&&h.onProgress(B,y,C),y===C&&(_=!1,h.onLoad!==void 0&&h.onLoad())},this.itemError=function(B){h.onError!==void 0&&h.onError(B)},this.resolveURL=function(B){return g?g(B):B},this.setURLModifier=function(B){return g=B,this},this.addHandler=function(B,L){return S.push(B,L),this},this.removeHandler=function(B){const L=S.indexOf(B);return L!==-1&&S.splice(L,2),this},this.getHandler=function(B){for(let L=0,k=S.length;L<k;L+=2){const U=S[L],Q=S[L+1];if(U.global&&(U.lastIndex=0),U.test(B))return Q}return null}}}const Wh=new Wc;class ls{constructor(i){this.manager=i!==void 0?i:Wh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(i,l){const u=this;return new Promise(function(h,g){u.load(i,h,l,g)})}parse(){}setCrossOrigin(i){return this.crossOrigin=i,this}setWithCredentials(i){return this.withCredentials=i,this}setPath(i){return this.path=i,this}setResourcePath(i){return this.resourcePath=i,this}setRequestHeader(i){return this.requestHeader=i,this}}const Wr={};class bw extends Error{constructor(i,l){super(i),this.response=l}}class qc extends ls{constructor(i){super(i),this.responseType="text"}load(i,l,u,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i),Hc.get(i,this.responseType,this.mimeType).then(g=>{if(g!==void 0)return this.manager.itemStart(i),setTimeout(()=>{l&&l(g),this.manager.itemEnd(i)},0),g;if(Wr[i]!==void 0)return void Wr[i].push({onLoad:l,onProgress:u,onError:h});Wr[i]=[],Wr[i].push({onLoad:l,onProgress:u,onError:h});const _=new Request(i,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),y=this.mimeType,C=this.responseType;fetch(_).then(S=>{if(S.status===200||S.status===0){if(S.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||S.body===void 0||S.body.getReader===void 0)return S;const B=Wr[i],L=S.body.getReader(),k=S.headers.get("Content-Length"),U=k?parseInt(k):0,Q=U!==0;let F=0;const H=new ReadableStream({start(W){(function q(){L.read().then(({done:$,value:ie})=>{if($)W.close();else{F+=ie.byteLength;const se=new ProgressEvent("progress",{lengthComputable:Q,loaded:F,total:U});for(let le=0,Ie=B.length;le<Ie;le++){const De=B[le];De.onProgress&&De.onProgress(se)}W.enqueue(ie),q()}})})()}});return new Response(H)}throw new bw(`fetch for "${S.url}" responded with ${S.status}: ${S.statusText}`,S)}).then(S=>{switch(C){case"arraybuffer":return S.arrayBuffer();case"blob":return S.blob();case"document":return S.text().then(B=>new DOMParser().parseFromString(B,y));case"json":return S.json();default:if(y===void 0)return S.text();{const B=/charset="?([^;"\s]*)"?/i.exec(y),L=B&&B[1]?B[1].toLowerCase():void 0,k=new TextDecoder(L);return S.arrayBuffer().then(U=>k.decode(U))}}}).then(S=>{Hc.add(i,S,this.responseType);const B=Wr[i];delete Wr[i];for(let L=0,k=B.length;L<k;L++){const U=B[L];U.onLoad&&U.onLoad(S)}}).catch(S=>{const B=Wr[i];if(B===void 0)throw this.manager.itemError(i),S;delete Wr[i];for(let L=0,k=B.length;L<k;L++){const U=B[L];U.onError&&U.onError(S)}this.manager.itemError(i)}).finally(()=>{this.manager.itemEnd(i)}),this.manager.itemStart(i)})}setResponseType(i){return this.responseType=i,this}setMimeType(i){return this.mimeType=i,this}}class Tf extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=new qc(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(i,function(y){try{l(g.parse(JSON.parse(y)))}catch(C){h?h(C):console.error(C),g.manager.itemError(i)}},u,h)}parse(i){const l=[];for(let u=0;u<i.length;u++){const h=Mf.parse(i[u]);l.push(h)}return l}}class uo extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=[],y=new cf,C=new qc(this.manager);C.setPath(this.path),C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setWithCredentials(g.withCredentials);let S=0;function B(L){C.load(i[L],function(k){const U=g.parse(k,!0);_[L]={width:U.width,height:U.height,format:U.format,mipmaps:U.mipmaps},S+=1,S===6&&(U.mipmapCount===1&&(y.minFilter=ur),y.image=_,y.format=U.format,y.needsUpdate=!0,l&&l(y))},u,h)}if(Array.isArray(i))for(let L=0,k=i.length;L<k;++L)B(L);else C.load(i,function(L){const k=g.parse(L,!0);if(k.isCubemap){const U=k.mipmaps.length/k.mipmapCount;for(let Q=0;Q<U;Q++){_[Q]={mipmaps:[]};for(let F=0;F<k.mipmapCount;F++)_[Q].mipmaps.push(k.mipmaps[Q*k.mipmapCount+F]),_[Q].format=k.format,_[Q].width=k.width,_[Q].height=k.height}y.image=_}else y.image.width=k.width,y.image.height=k.height,y.mipmaps=k.mipmaps;k.mipmapCount===1&&(y.minFilter=ur),y.format=k.format,y.needsUpdate=!0,l&&l(y)},u,h);return y}}class np extends ls{constructor(i){super(i)}load(i,l,u,h){this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const g=this,_=Hc.get(i);if(_!==void 0)return g.manager.itemStart(i),setTimeout(function(){l&&l(_),g.manager.itemEnd(i)},0),_;const y=Ec("img");function C(){B(),Hc.add(i,this),l&&l(this),g.manager.itemEnd(i)}function S(L){B(),h&&h(L),g.manager.itemError(i),g.manager.itemEnd(i)}function B(){y.removeEventListener("load",C,!1),y.removeEventListener("error",S,!1)}return y.addEventListener("load",C,!1),y.addEventListener("error",S,!1),i.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(y.crossOrigin=this.crossOrigin),g.manager.itemStart(i),y.src=i,y}}class B0 extends ls{constructor(i){super(i)}load(i,l,u,h){const g=new Nd,_=new np(this.manager);_.setCrossOrigin(this.crossOrigin),_.setPath(this.path);let y=0;function C(S){_.load(i[S],function(B){g.images[S]=B,y++,y===6&&(g.needsUpdate=!0,l&&l(g))},void 0,h)}for(let S=0;S<i.length;++S)C(S);return g}}class Yc extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=new Wd,y=new qc(this.manager);return y.setResponseType("arraybuffer"),y.setRequestHeader(this.requestHeader),y.setPath(this.path),y.setWithCredentials(g.withCredentials),y.load(i,function(C){const S=g.parse(C);S&&(S.image!==void 0?_.image=S.image:S.data!==void 0&&(_.image.width=S.width,_.image.height=S.height,_.image.data=S.data,_.image.complete=!0),_.wrapS=S.wrapS!==void 0?S.wrapS:Ki,_.wrapT=S.wrapT!==void 0?S.wrapT:Ki,_.magFilter=S.magFilter!==void 0?S.magFilter:ur,_.minFilter=S.minFilter!==void 0?S.minFilter:ur,_.anisotropy=S.anisotropy!==void 0?S.anisotropy:1,S.encoding!==void 0&&(_.encoding=S.encoding),S.flipY!==void 0&&(_.flipY=S.flipY),S.format!==void 0&&(_.format=S.format),S.type!==void 0&&(_.type=S.type),S.mipmaps!==void 0&&(_.mipmaps=S.mipmaps,_.minFilter=Pi),S.mipmapCount===1&&(_.minFilter=ur),S.generateMipmaps!==void 0&&(_.generateMipmaps=S.generateMipmaps),_.needsUpdate=!0,l&&l(_,S))},u,h),_}}class k0 extends ls{constructor(i){super(i)}load(i,l,u,h){const g=new Ur,_=new np(this.manager);return _.setCrossOrigin(this.crossOrigin),_.setPath(this.path),_.load(i,function(y){g.image=y,g.needsUpdate=!0,l!==void 0&&l(g)},u,h),g}}class Kl extends ei{constructor(i,l=1){super(),this.isLight=!0,this.type="Light",this.color=new mn(i),this.intensity=l}dispose(){}copy(i,l){return super.copy(i,l),this.color.copy(i.color),this.intensity=i.intensity,this}toJSON(i){const l=super.toJSON(i);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,this.groundColor!==void 0&&(l.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(l.object.distance=this.distance),this.angle!==void 0&&(l.object.angle=this.angle),this.decay!==void 0&&(l.object.decay=this.decay),this.penumbra!==void 0&&(l.object.penumbra=this.penumbra),this.shadow!==void 0&&(l.object.shadow=this.shadow.toJSON()),l}}class HA extends Kl{constructor(i,l,u){super(i,u),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ei.DefaultUp),this.updateMatrix(),this.groundColor=new mn(l)}copy(i,l){return super.copy(i,l),this.groundColor.copy(i.groundColor),this}}const O0=new Gn,xg=new he,Eg=new he;class If{constructor(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Lt(512,512),this.map=null,this.mapPass=null,this.matrix=new Gn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vp,this._frameExtents=new Lt(1,1),this._viewportCount=1,this._viewports=[new Ti(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(i){const l=this.camera,u=this.matrix;xg.setFromMatrixPosition(i.matrixWorld),l.position.copy(xg),Eg.setFromMatrixPosition(i.target.matrixWorld),l.lookAt(Eg),l.updateMatrixWorld(),O0.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(O0),u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(l.projectionMatrix),u.multiply(l.matrixWorldInverse)}getViewport(i){return this._viewports[i]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.normalBias=i.normalBias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const i={};return this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}}class Jl extends If{constructor(){super(new ws(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(i){const l=this.camera,u=2*bh*i.angle*this.focus,h=this.mapSize.width/this.mapSize.height,g=i.distance||l.far;u===l.fov&&h===l.aspect&&g===l.far||(l.fov=u,l.aspect=h,l.far=g,l.updateProjectionMatrix()),super.updateMatrices(i)}copy(i){return super.copy(i),this.focus=i.focus,this}}class L0 extends Kl{constructor(i,l,u=0,h=Math.PI/3,g=0,_=1){super(i,l),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ei.DefaultUp),this.updateMatrix(),this.target=new ei,this.distance=u,this.angle=h,this.penumbra=g,this.decay=_,this.map=null,this.shadow=new Jl}get power(){return this.intensity*Math.PI}set power(i){this.intensity=i/Math.PI}dispose(){this.shadow.dispose()}copy(i,l){return super.copy(i,l),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}const Cg=new Gn,Df=new he,Pf=new he;class N0 extends If{constructor(){super(new ws(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Lt(4,2),this._viewportCount=6,this._viewports=[new Ti(2,1,1,1),new Ti(0,1,1,1),new Ti(3,1,1,1),new Ti(1,1,1,1),new Ti(3,0,1,1),new Ti(1,0,1,1)],this._cubeDirections=[new he(1,0,0),new he(-1,0,0),new he(0,0,1),new he(0,0,-1),new he(0,1,0),new he(0,-1,0)],this._cubeUps=[new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,0,1),new he(0,0,-1)]}updateMatrices(i,l=0){const u=this.camera,h=this.matrix,g=i.distance||u.far;g!==u.far&&(u.far=g,u.updateProjectionMatrix()),Df.setFromMatrixPosition(i.matrixWorld),u.position.copy(Df),Pf.copy(u.position),Pf.add(this._cubeDirections[l]),u.up.copy(this._cubeUps[l]),u.lookAt(Pf),u.updateMatrixWorld(),h.makeTranslation(-Df.x,-Df.y,-Df.z),Cg.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cg)}}class WA extends Kl{constructor(i,l,u=0,h=1){super(i,l),this.isPointLight=!0,this.type="PointLight",this.distance=u,this.decay=h,this.shadow=new N0}get power(){return 4*this.intensity*Math.PI}set power(i){this.intensity=i/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(i,l){return super.copy(i,l),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}}class Sg extends If{constructor(){super(new Pm(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class qA extends Kl{constructor(i,l){super(i,l),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ei.DefaultUp),this.updateMatrix(),this.target=new ei,this.shadow=new Sg}dispose(){this.shadow.dispose()}copy(i){return super.copy(i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}class YA extends Kl{constructor(i,l){super(i,l),this.isAmbientLight=!0,this.type="AmbientLight"}}class XA extends Kl{constructor(i,l,u=10,h=10){super(i,l),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=u,this.height=h}get power(){return this.intensity*this.width*this.height*Math.PI}set power(i){this.intensity=i/(this.width*this.height*Math.PI)}copy(i){return super.copy(i),this.width=i.width,this.height=i.height,this}toJSON(i){const l=super.toJSON(i);return l.object.width=this.width,l.object.height=this.height,l}}class Rf{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let i=0;i<9;i++)this.coefficients.push(new he)}set(i){for(let l=0;l<9;l++)this.coefficients[l].copy(i[l]);return this}zero(){for(let i=0;i<9;i++)this.coefficients[i].set(0,0,0);return this}getAt(i,l){const u=i.x,h=i.y,g=i.z,_=this.coefficients;return l.copy(_[0]).multiplyScalar(.282095),l.addScaledVector(_[1],.488603*h),l.addScaledVector(_[2],.488603*g),l.addScaledVector(_[3],.488603*u),l.addScaledVector(_[4],u*h*1.092548),l.addScaledVector(_[5],h*g*1.092548),l.addScaledVector(_[6],.315392*(3*g*g-1)),l.addScaledVector(_[7],u*g*1.092548),l.addScaledVector(_[8],.546274*(u*u-h*h)),l}getIrradianceAt(i,l){const u=i.x,h=i.y,g=i.z,_=this.coefficients;return l.copy(_[0]).multiplyScalar(.886227),l.addScaledVector(_[1],1.023328*h),l.addScaledVector(_[2],1.023328*g),l.addScaledVector(_[3],1.023328*u),l.addScaledVector(_[4],.858086*u*h),l.addScaledVector(_[5],.858086*h*g),l.addScaledVector(_[6],.743125*g*g-.247708),l.addScaledVector(_[7],.858086*u*g),l.addScaledVector(_[8],.429043*(u*u-h*h)),l}add(i){for(let l=0;l<9;l++)this.coefficients[l].add(i.coefficients[l]);return this}addScaledSH(i,l){for(let u=0;u<9;u++)this.coefficients[u].addScaledVector(i.coefficients[u],l);return this}scale(i){for(let l=0;l<9;l++)this.coefficients[l].multiplyScalar(i);return this}lerp(i,l){for(let u=0;u<9;u++)this.coefficients[u].lerp(i.coefficients[u],l);return this}equals(i){for(let l=0;l<9;l++)if(!this.coefficients[l].equals(i.coefficients[l]))return!1;return!0}copy(i){return this.set(i.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(i,l=0){const u=this.coefficients;for(let h=0;h<9;h++)u[h].fromArray(i,l+3*h);return this}toArray(i=[],l=0){const u=this.coefficients;for(let h=0;h<9;h++)u[h].toArray(i,l+3*h);return i}static getBasisAt(i,l){const u=i.x,h=i.y,g=i.z;l[0]=.282095,l[1]=.488603*h,l[2]=.488603*g,l[3]=.488603*u,l[4]=1.092548*u*h,l[5]=1.092548*h*g,l[6]=.315392*(3*g*g-1),l[7]=1.092548*u*g,l[8]=.546274*(u*u-h*h)}}class Mg extends Kl{constructor(i=new Rf,l=1){super(void 0,l),this.isLightProbe=!0,this.sh=i}copy(i){return super.copy(i),this.sh.copy(i.sh),this}fromJSON(i){return this.intensity=i.intensity,this.sh.fromArray(i.sh),this}toJSON(i){const l=super.toJSON(i);return l.object.sh=this.sh.toArray(),l}}class Xc extends ls{constructor(i){super(i),this.textures={}}load(i,l,u,h){const g=this,_=new qc(g.manager);_.setPath(g.path),_.setRequestHeader(g.requestHeader),_.setWithCredentials(g.withCredentials),_.load(i,function(y){try{l(g.parse(JSON.parse(y)))}catch(C){h?h(C):console.error(C),g.manager.itemError(i)}},u,h)}parse(i){const l=this.textures;function u(g){return l[g]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",g),l[g]}const h=Xc.createMaterialFromType(i.type);if(i.uuid!==void 0&&(h.uuid=i.uuid),i.name!==void 0&&(h.name=i.name),i.color!==void 0&&h.color!==void 0&&h.color.setHex(i.color),i.roughness!==void 0&&(h.roughness=i.roughness),i.metalness!==void 0&&(h.metalness=i.metalness),i.sheen!==void 0&&(h.sheen=i.sheen),i.sheenColor!==void 0&&(h.sheenColor=new mn().setHex(i.sheenColor)),i.sheenRoughness!==void 0&&(h.sheenRoughness=i.sheenRoughness),i.emissive!==void 0&&h.emissive!==void 0&&h.emissive.setHex(i.emissive),i.specular!==void 0&&h.specular!==void 0&&h.specular.setHex(i.specular),i.specularIntensity!==void 0&&(h.specularIntensity=i.specularIntensity),i.specularColor!==void 0&&h.specularColor!==void 0&&h.specularColor.setHex(i.specularColor),i.shininess!==void 0&&(h.shininess=i.shininess),i.clearcoat!==void 0&&(h.clearcoat=i.clearcoat),i.clearcoatRoughness!==void 0&&(h.clearcoatRoughness=i.clearcoatRoughness),i.iridescence!==void 0&&(h.iridescence=i.iridescence),i.iridescenceIOR!==void 0&&(h.iridescenceIOR=i.iridescenceIOR),i.iridescenceThicknessRange!==void 0&&(h.iridescenceThicknessRange=i.iridescenceThicknessRange),i.transmission!==void 0&&(h.transmission=i.transmission),i.thickness!==void 0&&(h.thickness=i.thickness),i.attenuationDistance!==void 0&&(h.attenuationDistance=i.attenuationDistance),i.attenuationColor!==void 0&&h.attenuationColor!==void 0&&h.attenuationColor.setHex(i.attenuationColor),i.fog!==void 0&&(h.fog=i.fog),i.flatShading!==void 0&&(h.flatShading=i.flatShading),i.blending!==void 0&&(h.blending=i.blending),i.combine!==void 0&&(h.combine=i.combine),i.side!==void 0&&(h.side=i.side),i.shadowSide!==void 0&&(h.shadowSide=i.shadowSide),i.opacity!==void 0&&(h.opacity=i.opacity),i.transparent!==void 0&&(h.transparent=i.transparent),i.alphaTest!==void 0&&(h.alphaTest=i.alphaTest),i.depthTest!==void 0&&(h.depthTest=i.depthTest),i.depthWrite!==void 0&&(h.depthWrite=i.depthWrite),i.colorWrite!==void 0&&(h.colorWrite=i.colorWrite),i.stencilWrite!==void 0&&(h.stencilWrite=i.stencilWrite),i.stencilWriteMask!==void 0&&(h.stencilWriteMask=i.stencilWriteMask),i.stencilFunc!==void 0&&(h.stencilFunc=i.stencilFunc),i.stencilRef!==void 0&&(h.stencilRef=i.stencilRef),i.stencilFuncMask!==void 0&&(h.stencilFuncMask=i.stencilFuncMask),i.stencilFail!==void 0&&(h.stencilFail=i.stencilFail),i.stencilZFail!==void 0&&(h.stencilZFail=i.stencilZFail),i.stencilZPass!==void 0&&(h.stencilZPass=i.stencilZPass),i.wireframe!==void 0&&(h.wireframe=i.wireframe),i.wireframeLinewidth!==void 0&&(h.wireframeLinewidth=i.wireframeLinewidth),i.wireframeLinecap!==void 0&&(h.wireframeLinecap=i.wireframeLinecap),i.wireframeLinejoin!==void 0&&(h.wireframeLinejoin=i.wireframeLinejoin),i.rotation!==void 0&&(h.rotation=i.rotation),i.linewidth!==1&&(h.linewidth=i.linewidth),i.dashSize!==void 0&&(h.dashSize=i.dashSize),i.gapSize!==void 0&&(h.gapSize=i.gapSize),i.scale!==void 0&&(h.scale=i.scale),i.polygonOffset!==void 0&&(h.polygonOffset=i.polygonOffset),i.polygonOffsetFactor!==void 0&&(h.polygonOffsetFactor=i.polygonOffsetFactor),i.polygonOffsetUnits!==void 0&&(h.polygonOffsetUnits=i.polygonOffsetUnits),i.dithering!==void 0&&(h.dithering=i.dithering),i.alphaToCoverage!==void 0&&(h.alphaToCoverage=i.alphaToCoverage),i.premultipliedAlpha!==void 0&&(h.premultipliedAlpha=i.premultipliedAlpha),i.visible!==void 0&&(h.visible=i.visible),i.toneMapped!==void 0&&(h.toneMapped=i.toneMapped),i.userData!==void 0&&(h.userData=i.userData),i.vertexColors!==void 0&&(typeof i.vertexColors=="number"?h.vertexColors=i.vertexColors>0:h.vertexColors=i.vertexColors),i.uniforms!==void 0)for(const g in i.uniforms){const _=i.uniforms[g];switch(h.uniforms[g]={},_.type){case"t":h.uniforms[g].value=u(_.value);break;case"c":h.uniforms[g].value=new mn().setHex(_.value);break;case"v2":h.uniforms[g].value=new Lt().fromArray(_.value);break;case"v3":h.uniforms[g].value=new he().fromArray(_.value);break;case"v4":h.uniforms[g].value=new Ti().fromArray(_.value);break;case"m3":h.uniforms[g].value=new ts().fromArray(_.value);break;case"m4":h.uniforms[g].value=new Gn().fromArray(_.value);break;default:h.uniforms[g].value=_.value}}if(i.defines!==void 0&&(h.defines=i.defines),i.vertexShader!==void 0&&(h.vertexShader=i.vertexShader),i.fragmentShader!==void 0&&(h.fragmentShader=i.fragmentShader),i.glslVersion!==void 0&&(h.glslVersion=i.glslVersion),i.extensions!==void 0)for(const g in i.extensions)h.extensions[g]=i.extensions[g];if(i.size!==void 0&&(h.size=i.size),i.sizeAttenuation!==void 0&&(h.sizeAttenuation=i.sizeAttenuation),i.map!==void 0&&(h.map=u(i.map)),i.matcap!==void 0&&(h.matcap=u(i.matcap)),i.alphaMap!==void 0&&(h.alphaMap=u(i.alphaMap)),i.bumpMap!==void 0&&(h.bumpMap=u(i.bumpMap)),i.bumpScale!==void 0&&(h.bumpScale=i.bumpScale),i.normalMap!==void 0&&(h.normalMap=u(i.normalMap)),i.normalMapType!==void 0&&(h.normalMapType=i.normalMapType),i.normalScale!==void 0){let g=i.normalScale;Array.isArray(g)===!1&&(g=[g,g]),h.normalScale=new Lt().fromArray(g)}return i.displacementMap!==void 0&&(h.displacementMap=u(i.displacementMap)),i.displacementScale!==void 0&&(h.displacementScale=i.displacementScale),i.displacementBias!==void 0&&(h.displacementBias=i.displacementBias),i.roughnessMap!==void 0&&(h.roughnessMap=u(i.roughnessMap)),i.metalnessMap!==void 0&&(h.metalnessMap=u(i.metalnessMap)),i.emissiveMap!==void 0&&(h.emissiveMap=u(i.emissiveMap)),i.emissiveIntensity!==void 0&&(h.emissiveIntensity=i.emissiveIntensity),i.specularMap!==void 0&&(h.specularMap=u(i.specularMap)),i.specularIntensityMap!==void 0&&(h.specularIntensityMap=u(i.specularIntensityMap)),i.specularColorMap!==void 0&&(h.specularColorMap=u(i.specularColorMap)),i.envMap!==void 0&&(h.envMap=u(i.envMap)),i.envMapIntensity!==void 0&&(h.envMapIntensity=i.envMapIntensity),i.reflectivity!==void 0&&(h.reflectivity=i.reflectivity),i.refractionRatio!==void 0&&(h.refractionRatio=i.refractionRatio),i.lightMap!==void 0&&(h.lightMap=u(i.lightMap)),i.lightMapIntensity!==void 0&&(h.lightMapIntensity=i.lightMapIntensity),i.aoMap!==void 0&&(h.aoMap=u(i.aoMap)),i.aoMapIntensity!==void 0&&(h.aoMapIntensity=i.aoMapIntensity),i.gradientMap!==void 0&&(h.gradientMap=u(i.gradientMap)),i.clearcoatMap!==void 0&&(h.clearcoatMap=u(i.clearcoatMap)),i.clearcoatRoughnessMap!==void 0&&(h.clearcoatRoughnessMap=u(i.clearcoatRoughnessMap)),i.clearcoatNormalMap!==void 0&&(h.clearcoatNormalMap=u(i.clearcoatNormalMap)),i.clearcoatNormalScale!==void 0&&(h.clearcoatNormalScale=new Lt().fromArray(i.clearcoatNormalScale)),i.iridescenceMap!==void 0&&(h.iridescenceMap=u(i.iridescenceMap)),i.iridescenceThicknessMap!==void 0&&(h.iridescenceThicknessMap=u(i.iridescenceThicknessMap)),i.transmissionMap!==void 0&&(h.transmissionMap=u(i.transmissionMap)),i.thicknessMap!==void 0&&(h.thicknessMap=u(i.thicknessMap)),i.sheenColorMap!==void 0&&(h.sheenColorMap=u(i.sheenColorMap)),i.sheenRoughnessMap!==void 0&&(h.sheenRoughnessMap=u(i.sheenRoughnessMap)),h}setTextures(i){return this.textures=i,this}static createMaterialFromType(i){return new{ShadowMaterial:bg,SpriteMaterial:$m,RawShaderMaterial:QA,ShaderMaterial:rl,PointsMaterial:ag,MeshPhysicalMaterial:T0,MeshStandardMaterial:M0,MeshPhongMaterial:wf,MeshToonMaterial:VA,MeshNormalMaterial:xf,MeshLambertMaterial:I0,MeshDepthMaterial:$p,MeshDistanceMaterial:Qd,MeshBasicMaterial:Sa,MeshMatcapMaterial:Ef,LineDashedMaterial:D0,LineBasicMaterial:lo,Material:ss}[i]}}class Zl{static decodeText(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let l="";for(let u=0,h=i.length;u<h;u++)l+=String.fromCharCode(i[u]);try{return decodeURIComponent(escape(l))}catch{return l}}static extractUrlBase(i){const l=i.lastIndexOf("/");return l===-1?"./":i.slice(0,l+1)}static resolveURL(i,l){return typeof i!="string"||i===""?"":(/^https?:\/\//i.test(l)&&/^\//.test(i)&&(l=l.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(i)||/^data:.*,.*$/i.test(i)||/^blob:.*$/i.test(i)?i:l+i)}}class Wo extends wn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(i){return super.copy(i),this.instanceCount=i.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const i=super.toJSON(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}}class KA extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=new qc(g.manager);_.setPath(g.path),_.setRequestHeader(g.requestHeader),_.setWithCredentials(g.withCredentials),_.load(i,function(y){try{l(g.parse(JSON.parse(y)))}catch(C){h?h(C):console.error(C),g.manager.itemError(i)}},u,h)}parse(i){const l={},u={};function h(L,k){if(l[k]!==void 0)return l[k];const U=L.interleavedBuffers[k],Q=function(W,q){if(u[q]!==void 0)return u[q];const $=W.arrayBuffers[q],ie=new Uint32Array($).buffer;return u[q]=ie,ie}(L,U.buffer),F=xc(U.type,Q),H=new Zm(F,U.stride);return H.uuid=U.uuid,l[k]=H,H}const g=i.isInstancedBufferGeometry?new Wo:new wn,_=i.data.index;if(_!==void 0){const L=xc(_.type,_.array);g.setIndex(new ji(L,1))}const y=i.data.attributes;for(const L in y){const k=y[L];let U;if(k.isInterleavedBufferAttribute){const Q=h(i.data,k.data);U=new Wl(Q,k.itemSize,k.offset,k.normalized)}else{const Q=xc(k.type,k.array);U=new(k.isInstancedBufferAttribute?Fh:ji)(Q,k.itemSize,k.normalized)}k.name!==void 0&&(U.name=k.name),k.usage!==void 0&&U.setUsage(k.usage),k.updateRange!==void 0&&(U.updateRange.offset=k.updateRange.offset,U.updateRange.count=k.updateRange.count),g.setAttribute(L,U)}const C=i.data.morphAttributes;if(C)for(const L in C){const k=C[L],U=[];for(let Q=0,F=k.length;Q<F;Q++){const H=k[Q];let W;if(H.isInterleavedBufferAttribute){const q=h(i.data,H.data);W=new Wl(q,H.itemSize,H.offset,H.normalized)}else{const q=xc(H.type,H.array);W=new ji(q,H.itemSize,H.normalized)}H.name!==void 0&&(W.name=H.name),U.push(W)}g.morphAttributes[L]=U}i.data.morphTargetsRelative&&(g.morphTargetsRelative=!0);const S=i.data.groups||i.data.drawcalls||i.data.offsets;if(S!==void 0)for(let L=0,k=S.length;L!==k;++L){const U=S[L];g.addGroup(U.start,U.count,U.materialIndex)}const B=i.data.boundingSphere;if(B!==void 0){const L=new he;B.center!==void 0&&L.fromArray(B.center),g.boundingSphere=new Do(L,B.radius)}return i.name&&(g.name=i.name),i.userData&&(g.userData=i.userData),g}}class U0 extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=this.path===""?Zl.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||_;const y=new qc(this.manager);y.setPath(this.path),y.setRequestHeader(this.requestHeader),y.setWithCredentials(this.withCredentials),y.load(i,function(C){let S=null;try{S=JSON.parse(C)}catch(L){return h!==void 0&&h(L),void console.error("THREE:ObjectLoader: Can't parse "+i+".",L.message)}const B=S.metadata;B!==void 0&&B.type!==void 0&&B.type.toLowerCase()!=="geometry"?g.parse(S,l):console.error("THREE.ObjectLoader: Can't load "+i)},u,h)}async loadAsync(i,l){const u=this.path===""?Zl.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||u;const h=new qc(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials);const g=await h.loadAsync(i,l),_=JSON.parse(g),y=_.metadata;if(y===void 0||y.type===void 0||y.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+i);return await this.parseAsync(_)}parse(i,l){const u=this.parseAnimations(i.animations),h=this.parseShapes(i.shapes),g=this.parseGeometries(i.geometries,h),_=this.parseImages(i.images,function(){l!==void 0&&l(S)}),y=this.parseTextures(i.textures,_),C=this.parseMaterials(i.materials,y),S=this.parseObject(i.object,g,C,y,u),B=this.parseSkeletons(i.skeletons,S);if(this.bindSkeletons(S,B),l!==void 0){let L=!1;for(const k in _)if(_[k].data instanceof HTMLImageElement){L=!0;break}L===!1&&l(S)}return S}async parseAsync(i){const l=this.parseAnimations(i.animations),u=this.parseShapes(i.shapes),h=this.parseGeometries(i.geometries,u),g=await this.parseImagesAsync(i.images),_=this.parseTextures(i.textures,g),y=this.parseMaterials(i.materials,_),C=this.parseObject(i.object,h,y,_,l),S=this.parseSkeletons(i.skeletons,C);return this.bindSkeletons(C,S),C}parseShapes(i){const l={};if(i!==void 0)for(let u=0,h=i.length;u<h;u++){const g=new zh().fromJSON(i[u]);l[g.uuid]=g}return l}parseSkeletons(i,l){const u={},h={};if(l.traverse(function(g){g.isBone&&(h[g.uuid]=g)}),i!==void 0)for(let g=0,_=i.length;g<_;g++){const y=new nf().fromJSON(i[g],h);u[y.uuid]=y}return u}parseGeometries(i,l){const u={};if(i!==void 0){const h=new KA;for(let g=0,_=i.length;g<_;g++){let y;const C=i[g];switch(C.type){case"BufferGeometry":case"InstancedBufferGeometry":y=h.parse(C);break;default:C.type in Pa?y=Pa[C.type].fromJSON(C,l):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${C.type}"`)}y.uuid=C.uuid,C.name!==void 0&&(y.name=C.name),y.isBufferGeometry===!0&&C.userData!==void 0&&(y.userData=C.userData),u[C.uuid]=y}}return u}parseMaterials(i,l){const u={},h={};if(i!==void 0){const g=new Xc;g.setTextures(l);for(let _=0,y=i.length;_<y;_++){const C=i[_];u[C.uuid]===void 0&&(u[C.uuid]=g.parse(C)),h[C.uuid]=u[C.uuid]}}return h}parseAnimations(i){const l={};if(i!==void 0)for(let u=0;u<i.length;u++){const h=i[u],g=Mf.parse(h);l[g.uuid]=g}return l}parseImages(i,l){const u=this,h={};let g;function _(y){if(typeof y=="string"){const C=y;return function(S){return u.manager.itemStart(S),g.load(S,function(){u.manager.itemEnd(S)},void 0,function(){u.manager.itemError(S),u.manager.itemEnd(S)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(C)?C:u.resourcePath+C)}return y.data?{data:xc(y.type,y.data),width:y.width,height:y.height,complete:!0}:null}if(i!==void 0&&i.length>0){const y=new Wc(l);g=new np(y),g.setCrossOrigin(this.crossOrigin);for(let C=0,S=i.length;C<S;C++){const B=i[C],L=B.url;if(Array.isArray(L)){const k=[];for(let U=0,Q=L.length;U<Q;U++){const F=_(L[U]);F!==null&&(F instanceof HTMLImageElement?k.push(F):k.push(new Wd(F.data,F.width,F.height)))}h[B.uuid]=new Cc(k)}else{const k=_(B.url);h[B.uuid]=new Cc(k)}}}return h}async parseImagesAsync(i){const l=this,u={};let h;async function g(_){if(typeof _=="string"){const y=_,C=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(y)?y:l.resourcePath+y;return await h.loadAsync(C)}return _.data?{data:xc(_.type,_.data),width:_.width,height:_.height,complete:!0}:null}if(i!==void 0&&i.length>0){h=new np(this.manager),h.setCrossOrigin(this.crossOrigin);for(let _=0,y=i.length;_<y;_++){const C=i[_],S=C.url;if(Array.isArray(S)){const B=[];for(let L=0,k=S.length;L<k;L++){const U=S[L],Q=await g(U);Q!==null&&(Q instanceof HTMLImageElement?B.push(Q):B.push(new Wd(Q.data,Q.width,Q.height)))}u[C.uuid]=new Cc(B)}else{const B=await g(C.url);u[C.uuid]=new Cc(B)}}}return u}parseTextures(i,l){function u(g,_){return typeof g=="number"?g:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",g),_[g])}const h={};if(i!==void 0)for(let g=0,_=i.length;g<_;g++){const y=i[g];y.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',y.uuid),l[y.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",y.image);const C=l[y.image],S=C?C.data:void 0;let B;Array.isArray(S)?(B=new Nd,S.length===6&&(B.needsUpdate=!0)):(B=S&&S.data?new Wd:new Ur,S&&S.complete&&(B.needsUpdate=!0)),B.source=C,B.uuid=y.uuid,y.name!==void 0&&(B.name=y.name),y.mapping!==void 0&&(B.mapping=u(y.mapping,ww)),y.offset!==void 0&&B.offset.fromArray(y.offset),y.repeat!==void 0&&B.repeat.fromArray(y.repeat),y.center!==void 0&&B.center.fromArray(y.center),y.rotation!==void 0&&(B.rotation=y.rotation),y.wrap!==void 0&&(B.wrapS=u(y.wrap[0],Tg),B.wrapT=u(y.wrap[1],Tg)),y.format!==void 0&&(B.format=y.format),y.type!==void 0&&(B.type=y.type),y.encoding!==void 0&&(B.encoding=y.encoding),y.minFilter!==void 0&&(B.minFilter=u(y.minFilter,JA)),y.magFilter!==void 0&&(B.magFilter=u(y.magFilter,JA)),y.anisotropy!==void 0&&(B.anisotropy=y.anisotropy),y.flipY!==void 0&&(B.flipY=y.flipY),y.premultiplyAlpha!==void 0&&(B.premultiplyAlpha=y.premultiplyAlpha),y.unpackAlignment!==void 0&&(B.unpackAlignment=y.unpackAlignment),y.userData!==void 0&&(B.userData=y.userData),h[y.uuid]=B}return h}parseObject(i,l,u,h,g){let _,y,C;function S(k){return l[k]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",k),l[k]}function B(k){if(k!==void 0){if(Array.isArray(k)){const U=[];for(let Q=0,F=k.length;Q<F;Q++){const H=k[Q];u[H]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",H),U.push(u[H])}return U}return u[k]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",k),u[k]}}function L(k){return h[k]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",k),h[k]}switch(i.type){case"Scene":_=new CA,i.background!==void 0&&(Number.isInteger(i.background)?_.background=new mn(i.background):_.background=L(i.background)),i.environment!==void 0&&(_.environment=L(i.environment)),i.fog!==void 0&&(i.fog.type==="Fog"?_.fog=new Vd(i.fog.color,i.fog.near,i.fog.far):i.fog.type==="FogExp2"&&(_.fog=new Lu(i.fog.color,i.fog.density)));break;case"PerspectiveCamera":_=new ws(i.fov,i.aspect,i.near,i.far),i.focus!==void 0&&(_.focus=i.focus),i.zoom!==void 0&&(_.zoom=i.zoom),i.filmGauge!==void 0&&(_.filmGauge=i.filmGauge),i.filmOffset!==void 0&&(_.filmOffset=i.filmOffset),i.view!==void 0&&(_.view=Object.assign({},i.view));break;case"OrthographicCamera":_=new Pm(i.left,i.right,i.top,i.bottom,i.near,i.far),i.zoom!==void 0&&(_.zoom=i.zoom),i.view!==void 0&&(_.view=Object.assign({},i.view));break;case"AmbientLight":_=new YA(i.color,i.intensity);break;case"DirectionalLight":_=new qA(i.color,i.intensity);break;case"PointLight":_=new WA(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":_=new XA(i.color,i.intensity,i.width,i.height);break;case"SpotLight":_=new L0(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":_=new HA(i.color,i.groundColor,i.intensity);break;case"LightProbe":_=new Mg().fromJSON(i);break;case"SkinnedMesh":y=S(i.geometry),C=B(i.material),_=new c0(y,C),i.bindMode!==void 0&&(_.bindMode=i.bindMode),i.bindMatrix!==void 0&&_.bindMatrix.fromArray(i.bindMatrix),i.skeleton!==void 0&&(_.skeleton=i.skeleton);break;case"Mesh":y=S(i.geometry),C=B(i.material),_=new os(y,C);break;case"InstancedMesh":y=S(i.geometry),C=B(i.material);const k=i.count,U=i.instanceMatrix,Q=i.instanceColor;_=new rg(y,C,k),_.instanceMatrix=new Fh(new Float32Array(U.array),16),Q!==void 0&&(_.instanceColor=new Fh(new Float32Array(Q.array),Q.itemSize));break;case"LOD":_=new Hd;break;case"Line":_=new Yl(S(i.geometry),B(i.material));break;case"LineLoop":_=new qd(S(i.geometry),B(i.material));break;case"LineSegments":_=new Xl(S(i.geometry),B(i.material));break;case"PointCloud":case"Points":_=new ug(S(i.geometry),B(i.material));break;case"Sprite":_=new ng(B(i.material));break;case"Group":_=new Lc;break;case"Bone":_=new u0;break;default:_=new ei}if(_.uuid=i.uuid,i.name!==void 0&&(_.name=i.name),i.matrix!==void 0?(_.matrix.fromArray(i.matrix),i.matrixAutoUpdate!==void 0&&(_.matrixAutoUpdate=i.matrixAutoUpdate),_.matrixAutoUpdate&&_.matrix.decompose(_.position,_.quaternion,_.scale)):(i.position!==void 0&&_.position.fromArray(i.position),i.rotation!==void 0&&_.rotation.fromArray(i.rotation),i.quaternion!==void 0&&_.quaternion.fromArray(i.quaternion),i.scale!==void 0&&_.scale.fromArray(i.scale)),i.castShadow!==void 0&&(_.castShadow=i.castShadow),i.receiveShadow!==void 0&&(_.receiveShadow=i.receiveShadow),i.shadow&&(i.shadow.bias!==void 0&&(_.shadow.bias=i.shadow.bias),i.shadow.normalBias!==void 0&&(_.shadow.normalBias=i.shadow.normalBias),i.shadow.radius!==void 0&&(_.shadow.radius=i.shadow.radius),i.shadow.mapSize!==void 0&&_.shadow.mapSize.fromArray(i.shadow.mapSize),i.shadow.camera!==void 0&&(_.shadow.camera=this.parseObject(i.shadow.camera))),i.visible!==void 0&&(_.visible=i.visible),i.frustumCulled!==void 0&&(_.frustumCulled=i.frustumCulled),i.renderOrder!==void 0&&(_.renderOrder=i.renderOrder),i.userData!==void 0&&(_.userData=i.userData),i.layers!==void 0&&(_.layers.mask=i.layers),i.children!==void 0){const k=i.children;for(let U=0;U<k.length;U++)_.add(this.parseObject(k[U],l,u,h,g))}if(i.animations!==void 0){const k=i.animations;for(let U=0;U<k.length;U++){const Q=k[U];_.animations.push(g[Q])}}if(i.type==="LOD"){i.autoUpdate!==void 0&&(_.autoUpdate=i.autoUpdate);const k=i.levels;for(let U=0;U<k.length;U++){const Q=k[U],F=_.getObjectByProperty("uuid",Q.object);F!==void 0&&_.addLevel(F,Q.distance)}}return _}bindSkeletons(i,l){Object.keys(l).length!==0&&i.traverse(function(u){if(u.isSkinnedMesh===!0&&u.skeleton!==void 0){const h=l[u.skeleton];h===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",u.skeleton):u.bind(h,u.bindMatrix)}})}}const ww={UVMapping:fs,CubeReflectionMapping:vr,CubeRefractionMapping:Wi,EquirectangularReflectionMapping:zr,EquirectangularRefractionMapping:Qi,CubeUVReflectionMapping:Vs},Tg={RepeatWrapping:Ts,ClampToEdgeWrapping:Ki,MirroredRepeatWrapping:Yo},JA={NearestFilter:lr,NearestMipmapNearestFilter:ms,NearestMipmapLinearFilter:cr,LinearFilter:ur,LinearMipmapNearestFilter:Wa,LinearMipmapLinearFilter:Pi};class F0 extends ls{constructor(i){super(i),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(i){return this.options=i,this}load(i,l,u,h){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const g=this,_=Hc.get(i);if(_!==void 0)return g.manager.itemStart(i),setTimeout(function(){l&&l(_),g.manager.itemEnd(i)},0),_;const y={};y.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",y.headers=this.requestHeader,fetch(i,y).then(function(C){return C.blob()}).then(function(C){return createImageBitmap(C,Object.assign(g.options,{colorSpaceConversion:"none"}))}).then(function(C){Hc.add(i,C),l&&l(C),g.manager.itemEnd(i)}).catch(function(C){h&&h(C),g.manager.itemError(i),g.manager.itemEnd(i)}),g.manager.itemStart(i)}}let Ig;const Bf={getContext:function(){return Ig===void 0&&(Ig=new(window.AudioContext||window.webkitAudioContext)),Ig},setContext:function(b){Ig=b}};class xw extends ls{constructor(i){super(i)}load(i,l,u,h){const g=this,_=new qc(this.manager);_.setResponseType("arraybuffer"),_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(i,function(y){try{const C=y.slice(0);Bf.getContext().decodeAudioData(C,function(S){l(S)})}catch(C){h?h(C):console.error(C),g.manager.itemError(i)}},u,h)}}class j0 extends Mg{constructor(i,l,u=1){super(void 0,u),this.isHemisphereLightProbe=!0;const h=new mn().set(i),g=new mn().set(l),_=new he(h.r,h.g,h.b),y=new he(g.r,g.g,g.b),C=Math.sqrt(Math.PI),S=C*Math.sqrt(.75);this.sh.coefficients[0].copy(_).add(y).multiplyScalar(C),this.sh.coefficients[1].copy(_).sub(y).multiplyScalar(S)}}class Dg extends Mg{constructor(i,l=1){super(void 0,l),this.isAmbientLightProbe=!0;const u=new mn().set(i);this.sh.coefficients[0].set(u.r,u.g,u.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const ip=new Gn,Pg=new Gn,Kc=new Gn;class qh{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ws,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ws,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(i){const l=this._cache;if(l.focus!==i.focus||l.fov!==i.fov||l.aspect!==i.aspect*this.aspect||l.near!==i.near||l.far!==i.far||l.zoom!==i.zoom||l.eyeSep!==this.eyeSep){l.focus=i.focus,l.fov=i.fov,l.aspect=i.aspect*this.aspect,l.near=i.near,l.far=i.far,l.zoom=i.zoom,l.eyeSep=this.eyeSep,Kc.copy(i.projectionMatrix);const u=l.eyeSep/2,h=u*l.near/l.focus,g=l.near*Math.tan(wc*l.fov*.5)/l.zoom;let _,y;Pg.elements[12]=-u,ip.elements[12]=u,_=-g*l.aspect+h,y=g*l.aspect+h,Kc.elements[0]=2*l.near/(y-_),Kc.elements[8]=(y+_)/(y-_),this.cameraL.projectionMatrix.copy(Kc),_=-g*l.aspect-h,y=g*l.aspect-h,Kc.elements[0]=2*l.near/(y-_),Kc.elements[8]=(y+_)/(y-_),this.cameraR.projectionMatrix.copy(Kc)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(Pg),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(ip)}}class Rg{constructor(i=!0){this.autoStart=i,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ZA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let i=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const l=ZA();i=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=i}return i}}function ZA(){return(typeof performance>"u"?Date:performance).now()}const Hu=new he,Jc=new ns,Ew=new he,$s=new he;class $A extends ei{constructor(){super(),this.type="AudioListener",this.context=Bf.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Rg}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(i){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=i,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}updateMatrixWorld(i){super.updateMatrixWorld(i);const l=this.context.listener,u=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Hu,Jc,Ew),$s.set(0,0,-1).applyQuaternion(Jc),l.positionX){const h=this.context.currentTime+this.timeDelta;l.positionX.linearRampToValueAtTime(Hu.x,h),l.positionY.linearRampToValueAtTime(Hu.y,h),l.positionZ.linearRampToValueAtTime(Hu.z,h),l.forwardX.linearRampToValueAtTime($s.x,h),l.forwardY.linearRampToValueAtTime($s.y,h),l.forwardZ.linearRampToValueAtTime($s.z,h),l.upX.linearRampToValueAtTime(u.x,h),l.upY.linearRampToValueAtTime(u.y,h),l.upZ.linearRampToValueAtTime(u.z,h)}else l.setPosition(Hu.x,Hu.y,Hu.z),l.setOrientation($s.x,$s.y,$s.z,u.x,u.y,u.z)}}class Zc extends ei{constructor(i){super(),this.type="Audio",this.listener=i,this.context=i.context,this.gain=this.context.createGain(),this.gain.connect(i.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(i){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=i,this.connect(),this}setMediaElementSource(i){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(i),this.connect(),this}setMediaStreamSource(i){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(i),this.connect(),this}setBuffer(i){return this.buffer=i,this.sourceType="buffer",this.autoplay&&this.play(),this}play(i=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+i;const l=this.context.createBufferSource();return l.buffer=this.buffer,l.loop=this.loop,l.loopStart=this.loopStart,l.loopEnd=this.loopEnd,l.onended=this.onEnded.bind(this),l.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=l,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let i=1,l=this.filters.length;i<l;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let i=1,l=this.filters.length;i<l;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(i){return i||(i=[]),this._connected===!0?(this.disconnect(),this.filters=i.slice(),this.connect()):this.filters=i.slice(),this}setDetune(i){if(this.detune=i,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(i){return this.setFilters(i?[i]:[])}setPlaybackRate(i){if(this.hasPlaybackControl!==!1)return this.playbackRate=i,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(i){if(this.hasPlaybackControl!==!1)return this.loop=i,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(i){return this.loopStart=i,this}setLoopEnd(i){return this.loopEnd=i,this}getVolume(){return this.gain.gain.value}setVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}}const Wu=new he,Bg=new ns,kf=new he,gl=new he;class ey extends Zc{constructor(i){super(i),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(i){return this.panner.refDistance=i,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(i){return this.panner.rolloffFactor=i,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(i){return this.panner.distanceModel=i,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(i){return this.panner.maxDistance=i,this}setDirectionalCone(i,l,u){return this.panner.coneInnerAngle=i,this.panner.coneOuterAngle=l,this.panner.coneOuterGain=u,this}updateMatrixWorld(i){if(super.updateMatrixWorld(i),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Wu,Bg,kf),gl.set(0,0,1).applyQuaternion(Bg);const l=this.panner;if(l.positionX){const u=this.context.currentTime+this.listener.timeDelta;l.positionX.linearRampToValueAtTime(Wu.x,u),l.positionY.linearRampToValueAtTime(Wu.y,u),l.positionZ.linearRampToValueAtTime(Wu.z,u),l.orientationX.linearRampToValueAtTime(gl.x,u),l.orientationY.linearRampToValueAtTime(gl.y,u),l.orientationZ.linearRampToValueAtTime(gl.z,u)}else l.setPosition(Wu.x,Wu.y,Wu.z),l.setOrientation(gl.x,gl.y,gl.z)}}class qu{constructor(i,l=2048){this.analyser=i.context.createAnalyser(),this.analyser.fftSize=l,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let i=0;const l=this.getFrequencyData();for(let u=0;u<l.length;u++)i+=l[u];return i/l.length}}class Of{constructor(i,l,u){let h,g,_;switch(this.binding=i,this.valueSize=u,l){case"quaternion":h=this._slerp,g=this._slerpAdditive,_=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*u),this._workIndex=5;break;case"string":case"bool":h=this._select,g=this._select,_=this._setAdditiveIdentityOther,this.buffer=new Array(5*u);break;default:h=this._lerp,g=this._lerpAdditive,_=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*u)}this._mixBufferRegion=h,this._mixBufferRegionAdditive=g,this._setIdentity=_,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(i,l){const u=this.buffer,h=this.valueSize,g=i*h+h;let _=this.cumulativeWeight;if(_===0){for(let y=0;y!==h;++y)u[g+y]=u[y];_=l}else{_+=l;const y=l/_;this._mixBufferRegion(u,g,0,y,h)}this.cumulativeWeight=_}accumulateAdditive(i){const l=this.buffer,u=this.valueSize,h=u*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(l,h,0,i,u),this.cumulativeWeightAdditive+=i}apply(i){const l=this.valueSize,u=this.buffer,h=i*l+l,g=this.cumulativeWeight,_=this.cumulativeWeightAdditive,y=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,g<1){const C=l*this._origIndex;this._mixBufferRegion(u,h,C,1-g,l)}_>0&&this._mixBufferRegionAdditive(u,h,this._addIndex*l,1,l);for(let C=l,S=l+l;C!==S;++C)if(u[C]!==u[C+l]){y.setValue(u,h);break}}saveOriginalState(){const i=this.binding,l=this.buffer,u=this.valueSize,h=u*this._origIndex;i.getValue(l,h);for(let g=u,_=h;g!==_;++g)l[g]=l[h+g%u];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const i=3*this.valueSize;this.binding.setValue(this.buffer,i)}_setAdditiveIdentityNumeric(){const i=this._addIndex*this.valueSize,l=i+this.valueSize;for(let u=i;u<l;u++)this.buffer[u]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const i=this._origIndex*this.valueSize,l=this._addIndex*this.valueSize;for(let u=0;u<this.valueSize;u++)this.buffer[l+u]=this.buffer[i+u]}_select(i,l,u,h,g){if(h>=.5)for(let _=0;_!==g;++_)i[l+_]=i[u+_]}_slerp(i,l,u,h){ns.slerpFlat(i,l,i,l,i,u,h)}_slerpAdditive(i,l,u,h,g){const _=this._workIndex*g;ns.multiplyQuaternionsFlat(i,_,i,l,i,u),ns.slerpFlat(i,l,i,l,i,_,h)}_lerp(i,l,u,h,g){const _=1-h;for(let y=0;y!==g;++y){const C=l+y;i[C]=i[C]*_+i[u+y]*h}}_lerpAdditive(i,l,u,h,g){for(let _=0;_!==g;++_){const y=l+_;i[y]=i[y]+i[u+_]*h}}}const Lf=new RegExp("[\\[\\]\\.:\\/]","g"),rp="[^\\[\\]\\.:\\/]",sp="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",kg=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rp)+/(WCOD+)?/.source.replace("WCOD",sp)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rp)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rp)+"$"),Nf=["material","materials","bones","map"];class wi{constructor(i,l,u){this.path=l,this.parsedPath=u||wi.parseTrackName(l),this.node=wi.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(i,l,u){return i&&i.isAnimationObjectGroup?new wi.Composite(i,l,u):new wi(i,l,u)}static sanitizeNodeName(i){return i.replace(/\s/g,"_").replace(Lf,"")}static parseTrackName(i){const l=kg.exec(i);if(l===null)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const u={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},h=u.nodeName&&u.nodeName.lastIndexOf(".");if(h!==void 0&&h!==-1){const g=u.nodeName.substring(h+1);Nf.indexOf(g)!==-1&&(u.nodeName=u.nodeName.substring(0,h),u.objectName=g)}if(u.propertyName===null||u.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return u}static findNode(i,l){if(l===void 0||l===""||l==="."||l===-1||l===i.name||l===i.uuid)return i;if(i.skeleton){const u=i.skeleton.getBoneByName(l);if(u!==void 0)return u}if(i.children){const u=function(g){for(let _=0;_<g.length;_++){const y=g[_];if(y.name===l||y.uuid===l)return y;const C=u(y.children);if(C)return C}return null},h=u(i.children);if(h)return h}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(i,l){i[l]=this.targetObject[this.propertyName]}_getValue_array(i,l){const u=this.resolvedProperty;for(let h=0,g=u.length;h!==g;++h)i[l++]=u[h]}_getValue_arrayElement(i,l){i[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(i,l){this.resolvedProperty.toArray(i,l)}_setValue_direct(i,l){this.targetObject[this.propertyName]=i[l]}_setValue_direct_setNeedsUpdate(i,l){this.targetObject[this.propertyName]=i[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(i,l){this.targetObject[this.propertyName]=i[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(i,l){const u=this.resolvedProperty;for(let h=0,g=u.length;h!==g;++h)u[h]=i[l++]}_setValue_array_setNeedsUpdate(i,l){const u=this.resolvedProperty;for(let h=0,g=u.length;h!==g;++h)u[h]=i[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(i,l){const u=this.resolvedProperty;for(let h=0,g=u.length;h!==g;++h)u[h]=i[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(i,l){this.resolvedProperty[this.propertyIndex]=i[l]}_setValue_arrayElement_setNeedsUpdate(i,l){this.resolvedProperty[this.propertyIndex]=i[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(i,l){this.resolvedProperty[this.propertyIndex]=i[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(i,l){this.resolvedProperty.fromArray(i,l)}_setValue_fromArray_setNeedsUpdate(i,l){this.resolvedProperty.fromArray(i,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(i,l){this.resolvedProperty.fromArray(i,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(i,l){this.bind(),this.getValue(i,l)}_setValue_unbound(i,l){this.bind(),this.setValue(i,l)}bind(){let i=this.node;const l=this.parsedPath,u=l.objectName,h=l.propertyName;let g=l.propertyIndex;if(i||(i=wi.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(u){let S=l.objectIndex;switch(u){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(let B=0;B<i.length;B++)if(i[B].name===S){S=B;break}break;case"map":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);i=i.material.map;break;default:if(i[u]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[u]}if(S!==void 0){if(i[S]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[S]}}const _=i[h];if(_===void 0){const S=l.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+S+"."+h+" but it wasn't found.",i)}let y=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?y=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(y=this.Versioning.MatrixWorldNeedsUpdate);let C=this.BindingType.Direct;if(g!==void 0){if(h==="morphTargetInfluences"){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);i.morphTargetDictionary[g]!==void 0&&(g=i.morphTargetDictionary[g])}C=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=g}else _.fromArray!==void 0&&_.toArray!==void 0?(C=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(C=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=h;this.getValue=this.GetterByBindingType[C],this.setValue=this.SetterByBindingTypeAndVersioning[C][y]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}wi.Composite=class{constructor(b,i,l){const u=l||wi.parseTrackName(i);this._targetGroup=b,this._bindings=b.subscribe_(i,u)}getValue(b,i){this.bind();const l=this._targetGroup.nCachedObjects_,u=this._bindings[l];u!==void 0&&u.getValue(b,i)}setValue(b,i){const l=this._bindings;for(let u=this._targetGroup.nCachedObjects_,h=l.length;u!==h;++u)l[u].setValue(b,i)}bind(){const b=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=b.length;i!==l;++i)b[i].bind()}unbind(){const b=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=b.length;i!==l;++i)b[i].unbind()}},wi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wi.prototype.GetterByBindingType=[wi.prototype._getValue_direct,wi.prototype._getValue_array,wi.prototype._getValue_arrayElement,wi.prototype._getValue_toArray],wi.prototype.SetterByBindingTypeAndVersioning=[[wi.prototype._setValue_direct,wi.prototype._setValue_direct_setNeedsUpdate,wi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_array,wi.prototype._setValue_array_setNeedsUpdate,wi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_arrayElement,wi.prototype._setValue_arrayElement_setNeedsUpdate,wi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wi.prototype._setValue_fromArray,wi.prototype._setValue_fromArray_setNeedsUpdate,wi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yh{constructor(){this.isAnimationObjectGroup=!0,this.uuid=_s(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let u=0,h=arguments.length;u!==h;++u)i[arguments[u].uuid]=u;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}add(){const i=this._objects,l=this._indicesByUUID,u=this._paths,h=this._parsedPaths,g=this._bindings,_=g.length;let y,C=i.length,S=this.nCachedObjects_;for(let B=0,L=arguments.length;B!==L;++B){const k=arguments[B],U=k.uuid;let Q=l[U];if(Q===void 0){Q=C++,l[U]=Q,i.push(k);for(let F=0,H=_;F!==H;++F)g[F].push(new wi(k,u[F],h[F]))}else if(Q<S){y=i[Q];const F=--S,H=i[F];l[H.uuid]=Q,i[Q]=H,l[U]=F,i[F]=k;for(let W=0,q=_;W!==q;++W){const $=g[W],ie=$[F];let se=$[Q];$[Q]=ie,se===void 0&&(se=new wi(k,u[W],h[W])),$[F]=se}}else i[Q]!==y&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=S}remove(){const i=this._objects,l=this._indicesByUUID,u=this._bindings,h=u.length;let g=this.nCachedObjects_;for(let _=0,y=arguments.length;_!==y;++_){const C=arguments[_],S=C.uuid,B=l[S];if(B!==void 0&&B>=g){const L=g++,k=i[L];l[k.uuid]=B,i[B]=k,l[S]=L,i[L]=C;for(let U=0,Q=h;U!==Q;++U){const F=u[U],H=F[L],W=F[B];F[B]=H,F[L]=W}}}this.nCachedObjects_=g}uncache(){const i=this._objects,l=this._indicesByUUID,u=this._bindings,h=u.length;let g=this.nCachedObjects_,_=i.length;for(let y=0,C=arguments.length;y!==C;++y){const S=arguments[y].uuid,B=l[S];if(B!==void 0)if(delete l[S],B<g){const L=--g,k=i[L],U=--_,Q=i[U];l[k.uuid]=B,i[B]=k,l[Q.uuid]=L,i[L]=Q,i.pop();for(let F=0,H=h;F!==H;++F){const W=u[F],q=W[L],$=W[U];W[B]=q,W[L]=$,W.pop()}}else{const L=--_,k=i[L];L>0&&(l[k.uuid]=B),i[B]=k,i.pop();for(let U=0,Q=h;U!==Q;++U){const F=u[U];F[B]=F[L],F.pop()}}}this.nCachedObjects_=g}subscribe_(i,l){const u=this._bindingsIndicesByPath;let h=u[i];const g=this._bindings;if(h!==void 0)return g[h];const _=this._paths,y=this._parsedPaths,C=this._objects,S=C.length,B=this.nCachedObjects_,L=new Array(S);h=g.length,u[i]=h,_.push(i),y.push(l),g.push(L);for(let k=B,U=C.length;k!==U;++k){const Q=C[k];L[k]=new wi(Q,i,l)}return L}unsubscribe_(i){const l=this._bindingsIndicesByPath,u=l[i];if(u!==void 0){const h=this._paths,g=this._parsedPaths,_=this._bindings,y=_.length-1,C=_[y];l[i[y]]=u,_[u]=C,_.pop(),g[u]=g[y],g.pop(),h[u]=h[y],h.pop()}}}class Og{constructor(i,l,u=null,h=l.blendMode){this._mixer=i,this._clip=l,this._localRoot=u,this.blendMode=h;const g=l.tracks,_=g.length,y=new Array(_),C={endingStart:Nr,endingEnd:Nr};for(let S=0;S!==_;++S){const B=g[S].createInterpolant(null);y[S]=B,B.settings=C}this._interpolantSettings=C,this._interpolants=y,this._propertyBindings=new Array(_),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=md,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(i){return this._startTime=i,this}setLoop(i,l){return this.loop=i,this.repetitions=l,this}setEffectiveWeight(i){return this.weight=i,this._effectiveWeight=this.enabled?i:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(i){return this._scheduleFading(i,0,1)}fadeOut(i){return this._scheduleFading(i,1,0)}crossFadeFrom(i,l,u){if(i.fadeOut(l),this.fadeIn(l),u){const h=this._clip.duration,g=i._clip.duration,_=g/h,y=h/g;i.warp(1,_,l),this.warp(y,1,l)}return this}crossFadeTo(i,l,u){return i.crossFadeFrom(this,l,u)}stopFading(){const i=this._weightInterpolant;return i!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(i)),this}setEffectiveTimeScale(i){return this.timeScale=i,this._effectiveTimeScale=this.paused?0:i,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(i){return this.timeScale=this._clip.duration/i,this.stopWarping()}syncWith(i){return this.time=i.time,this.timeScale=i.timeScale,this.stopWarping()}halt(i){return this.warp(this._effectiveTimeScale,0,i)}warp(i,l,u){const h=this._mixer,g=h.time,_=this.timeScale;let y=this._timeScaleInterpolant;y===null&&(y=h._lendControlInterpolant(),this._timeScaleInterpolant=y);const C=y.parameterPositions,S=y.sampleValues;return C[0]=g,C[1]=g+u,S[0]=i/_,S[1]=l/_,this}stopWarping(){const i=this._timeScaleInterpolant;return i!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(i)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(i,l,u,h){if(!this.enabled)return void this._updateWeight(i);const g=this._startTime;if(g!==null){const C=(i-g)*u;C<0||u===0?l=0:(this._startTime=null,l=u*C)}l*=this._updateTimeScale(i);const _=this._updateTime(l),y=this._updateWeight(i);if(y>0){const C=this._interpolants,S=this._propertyBindings;if(this.blendMode===gd)for(let B=0,L=C.length;B!==L;++B)C[B].evaluate(_),S[B].accumulateAdditive(y);else for(let B=0,L=C.length;B!==L;++B)C[B].evaluate(_),S[B].accumulate(h,y)}}_updateWeight(i){let l=0;if(this.enabled){l=this.weight;const u=this._weightInterpolant;if(u!==null){const h=u.evaluate(i)[0];l*=h,i>u.parameterPositions[1]&&(this.stopFading(),h===0&&(this.enabled=!1))}}return this._effectiveWeight=l,l}_updateTimeScale(i){let l=0;if(!this.paused){l=this.timeScale;const u=this._timeScaleInterpolant;u!==null&&(l*=u.evaluate(i)[0],i>u.parameterPositions[1]&&(this.stopWarping(),l===0?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l}_updateTime(i){const l=this._clip.duration,u=this.loop;let h=this.time+i,g=this._loopCount;const _=u===pc;if(i===0)return g===-1?h:_&&(1&g)==1?l-h:h;if(u===Ws){g===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=l)h=l;else{if(!(h<0)){this.time=h;break e}h=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:i<0?-1:1})}}else{if(g===-1&&(i>=0?(g=0,this._setEndings(!0,this.repetitions===0,_)):this._setEndings(this.repetitions===0,!0,_)),h>=l||h<0){const y=Math.floor(h/l);h-=l*y,g+=Math.abs(y);const C=this.repetitions-g;if(C<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=i>0?l:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:i>0?1:-1});else{if(C===1){const S=i<0;this._setEndings(S,!S,_)}else this._setEndings(!1,!1,_);this._loopCount=g,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:y})}}else this.time=h;if(_&&(1&g)==1)return l-h}return h}_setEndings(i,l,u){const h=this._interpolantSettings;u?(h.endingStart=wo,h.endingEnd=wo):(h.endingStart=i?this.zeroSlopeAtStart?wo:Nr:mc,h.endingEnd=l?this.zeroSlopeAtEnd?wo:Nr:mc)}_scheduleFading(i,l,u){const h=this._mixer,g=h.time;let _=this._weightInterpolant;_===null&&(_=h._lendControlInterpolant(),this._weightInterpolant=_);const y=_.parameterPositions,C=_.sampleValues;return y[0]=g,C[0]=l,y[1]=g+i,C[1]=u,this}}const Lg=new Float32Array(1);class z0 extends Vn{constructor(i){super(),this._root=i,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(i,l){const u=i._localRoot||this._root,h=i._clip.tracks,g=h.length,_=i._propertyBindings,y=i._interpolants,C=u.uuid,S=this._bindingsByRootAndName;let B=S[C];B===void 0&&(B={},S[C]=B);for(let L=0;L!==g;++L){const k=h[L],U=k.name;let Q=B[U];if(Q!==void 0)++Q.referenceCount,_[L]=Q;else{if(Q=_[L],Q!==void 0){Q._cacheIndex===null&&(++Q.referenceCount,this._addInactiveBinding(Q,C,U));continue}const F=l&&l._propertyBindings[L].binding.parsedPath;Q=new Of(wi.create(u,U,F),k.ValueTypeName,k.getValueSize()),++Q.referenceCount,this._addInactiveBinding(Q,C,U),_[L]=Q}y[L].resultBuffer=Q.buffer}}_activateAction(i){if(!this._isActiveAction(i)){if(i._cacheIndex===null){const u=(i._localRoot||this._root).uuid,h=i._clip.uuid,g=this._actionsByClip[h];this._bindAction(i,g&&g.knownActions[0]),this._addInactiveAction(i,h,u)}const l=i._propertyBindings;for(let u=0,h=l.length;u!==h;++u){const g=l[u];g.useCount++==0&&(this._lendBinding(g),g.saveOriginalState())}this._lendAction(i)}}_deactivateAction(i){if(this._isActiveAction(i)){const l=i._propertyBindings;for(let u=0,h=l.length;u!==h;++u){const g=l[u];--g.useCount==0&&(g.restoreOriginalState(),this._takeBackBinding(g))}this._takeBackAction(i)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const i=this;this.stats={actions:{get total(){return i._actions.length},get inUse(){return i._nActiveActions}},bindings:{get total(){return i._bindings.length},get inUse(){return i._nActiveBindings}},controlInterpolants:{get total(){return i._controlInterpolants.length},get inUse(){return i._nActiveControlInterpolants}}}}_isActiveAction(i){const l=i._cacheIndex;return l!==null&&l<this._nActiveActions}_addInactiveAction(i,l,u){const h=this._actions,g=this._actionsByClip;let _=g[l];if(_===void 0)_={knownActions:[i],actionByRoot:{}},i._byClipCacheIndex=0,g[l]=_;else{const y=_.knownActions;i._byClipCacheIndex=y.length,y.push(i)}i._cacheIndex=h.length,h.push(i),_.actionByRoot[u]=i}_removeInactiveAction(i){const l=this._actions,u=l[l.length-1],h=i._cacheIndex;u._cacheIndex=h,l[h]=u,l.pop(),i._cacheIndex=null;const g=i._clip.uuid,_=this._actionsByClip,y=_[g],C=y.knownActions,S=C[C.length-1],B=i._byClipCacheIndex;S._byClipCacheIndex=B,C[B]=S,C.pop(),i._byClipCacheIndex=null,delete y.actionByRoot[(i._localRoot||this._root).uuid],C.length===0&&delete _[g],this._removeInactiveBindingsForAction(i)}_removeInactiveBindingsForAction(i){const l=i._propertyBindings;for(let u=0,h=l.length;u!==h;++u){const g=l[u];--g.referenceCount==0&&this._removeInactiveBinding(g)}}_lendAction(i){const l=this._actions,u=i._cacheIndex,h=this._nActiveActions++,g=l[h];i._cacheIndex=h,l[h]=i,g._cacheIndex=u,l[u]=g}_takeBackAction(i){const l=this._actions,u=i._cacheIndex,h=--this._nActiveActions,g=l[h];i._cacheIndex=h,l[h]=i,g._cacheIndex=u,l[u]=g}_addInactiveBinding(i,l,u){const h=this._bindingsByRootAndName,g=this._bindings;let _=h[l];_===void 0&&(_={},h[l]=_),_[u]=i,i._cacheIndex=g.length,g.push(i)}_removeInactiveBinding(i){const l=this._bindings,u=i.binding,h=u.rootNode.uuid,g=u.path,_=this._bindingsByRootAndName,y=_[h],C=l[l.length-1],S=i._cacheIndex;C._cacheIndex=S,l[S]=C,l.pop(),delete y[g],Object.keys(y).length===0&&delete _[h]}_lendBinding(i){const l=this._bindings,u=i._cacheIndex,h=this._nActiveBindings++,g=l[h];i._cacheIndex=h,l[h]=i,g._cacheIndex=u,l[u]=g}_takeBackBinding(i){const l=this._bindings,u=i._cacheIndex,h=--this._nActiveBindings,g=l[h];i._cacheIndex=h,l[h]=i,g._cacheIndex=u,l[u]=g}_lendControlInterpolant(){const i=this._controlInterpolants,l=this._nActiveControlInterpolants++;let u=i[l];return u===void 0&&(u=new P0(new Float32Array(2),new Float32Array(2),1,Lg),u.__cacheIndex=l,i[l]=u),u}_takeBackControlInterpolant(i){const l=this._controlInterpolants,u=i.__cacheIndex,h=--this._nActiveControlInterpolants,g=l[h];i.__cacheIndex=h,l[h]=i,g.__cacheIndex=u,l[u]=g}clipAction(i,l,u){const h=l||this._root,g=h.uuid;let _=typeof i=="string"?Mf.findByName(h,i):i;const y=_!==null?_.uuid:i,C=this._actionsByClip[y];let S=null;if(u===void 0&&(u=_!==null?_.blendMode:Ji),C!==void 0){const L=C.actionByRoot[g];if(L!==void 0&&L.blendMode===u)return L;S=C.knownActions[0],_===null&&(_=S._clip)}if(_===null)return null;const B=new Og(this,_,l,u);return this._bindAction(B,S),this._addInactiveAction(B,y,g),B}existingAction(i,l){const u=l||this._root,h=u.uuid,g=typeof i=="string"?Mf.findByName(u,i):i,_=g?g.uuid:i,y=this._actionsByClip[_];return y!==void 0&&y.actionByRoot[h]||null}stopAllAction(){const i=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)i[l].stop();return this}update(i){i*=this.timeScale;const l=this._actions,u=this._nActiveActions,h=this.time+=i,g=Math.sign(i),_=this._accuIndex^=1;for(let S=0;S!==u;++S)l[S]._update(h,i,g,_);const y=this._bindings,C=this._nActiveBindings;for(let S=0;S!==C;++S)y[S].apply(_);return this}setTime(i){this.time=0;for(let l=0;l<this._actions.length;l++)this._actions[l].time=0;return this.update(i)}getRoot(){return this._root}uncacheClip(i){const l=this._actions,u=i.uuid,h=this._actionsByClip,g=h[u];if(g!==void 0){const _=g.knownActions;for(let y=0,C=_.length;y!==C;++y){const S=_[y];this._deactivateAction(S);const B=S._cacheIndex,L=l[l.length-1];S._cacheIndex=null,S._byClipCacheIndex=null,L._cacheIndex=B,l[B]=L,l.pop(),this._removeInactiveBindingsForAction(S)}delete h[u]}}uncacheRoot(i){const l=i.uuid,u=this._actionsByClip;for(const g in u){const _=u[g].actionByRoot[l];_!==void 0&&(this._deactivateAction(_),this._removeInactiveAction(_))}const h=this._bindingsByRootAndName[l];if(h!==void 0)for(const g in h){const _=h[g];_.restoreOriginalState(),this._removeInactiveBinding(_)}}uncacheAction(i,l){const u=this.existingAction(i,l);u!==null&&(this._deactivateAction(u),this._removeInactiveAction(u))}}class Yu{constructor(i){this.value=i}clone(){return new Yu(this.value.clone===void 0?this.value:this.value.clone())}}let Ng=0;class Uf extends Vn{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ng++}),this.name="",this.usage=yc,this.uniforms=[]}add(i){return this.uniforms.push(i),this}remove(i){const l=this.uniforms.indexOf(i);return l!==-1&&this.uniforms.splice(l,1),this}setName(i){return this.name=i,this}setUsage(i){return this.usage=i,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(i){this.name=i.name,this.usage=i.usage;const l=i.uniforms;this.uniforms.length=0;for(let u=0,h=l.length;u<h;u++)this.uniforms.push(l[u].clone());return this}clone(){return new this.constructor().copy(this)}}class Ug extends Zm{constructor(i,l,u=1){super(i,l),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=u}copy(i){return super.copy(i),this.meshPerAttribute=i.meshPerAttribute,this}clone(i){const l=super.clone(i);return l.meshPerAttribute=this.meshPerAttribute,l}toJSON(i){const l=super.toJSON(i);return l.isInstancedInterleavedBuffer=!0,l.meshPerAttribute=this.meshPerAttribute,l}}class op{constructor(i,l,u,h,g){this.isGLBufferAttribute=!0,this.buffer=i,this.type=l,this.itemSize=u,this.elementSize=h,this.count=g,this.version=0}set needsUpdate(i){i===!0&&this.version++}setBuffer(i){return this.buffer=i,this}setType(i,l){return this.type=i,this.elementSize=l,this}setItemSize(i){return this.itemSize=i,this}setCount(i){return this.count=i,this}}class Fg{constructor(i,l,u=0,h=1/0){this.ray=new jl(i,l),this.near=u,this.far=h,this.camera=null,this.layers=new Ps,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(i,l){this.ray.set(i,l)}setFromCamera(i,l){l.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(l.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(l).sub(this.ray.origin).normalize(),this.camera=l):l.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(l.near+l.far)/(l.near-l.far)).unproject(l),this.ray.direction.set(0,0,-1).transformDirection(l.matrixWorld),this.camera=l):console.error("THREE.Raycaster: Unsupported camera type: "+l.type)}intersectObject(i,l=!0,u=[]){return zg(i,this,u,l),u.sort(jg),u}intersectObjects(i,l=!0,u=[]){for(let h=0,g=i.length;h<g;h++)zg(i[h],this,u,l);return u.sort(jg),u}}function jg(b,i){return b.distance-i.distance}function zg(b,i,l,u){if(b.layers.test(i.layers)&&b.raycast(i,l),u===!0){const h=b.children;for(let g=0,_=h.length;g<_;g++)zg(h[g],i,l,!0)}}class Cw{constructor(i=1,l=0,u=0){return this.radius=i,this.phi=l,this.theta=u,this}set(i,l,u){return this.radius=i,this.phi=l,this.theta=u,this}copy(i){return this.radius=i.radius,this.phi=i.phi,this.theta=i.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,l,u){return this.radius=Math.sqrt(i*i+l*l+u*u),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(i,u),this.phi=Math.acos(On(l/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ty{constructor(i=1,l=0,u=0){return this.radius=i,this.theta=l,this.y=u,this}set(i,l,u){return this.radius=i,this.theta=l,this.y=u,this}copy(i){return this.radius=i.radius,this.theta=i.theta,this.y=i.y,this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,l,u){return this.radius=Math.sqrt(i*i+u*u),this.theta=Math.atan2(i,u),this.y=l,this}clone(){return new this.constructor().copy(this)}}const ny=new Lt;class Sw{constructor(i=new Lt(1/0,1/0),l=new Lt(-1/0,-1/0)){this.isBox2=!0,this.min=i,this.max=l}set(i,l){return this.min.copy(i),this.max.copy(l),this}setFromPoints(i){this.makeEmpty();for(let l=0,u=i.length;l<u;l++)this.expandByPoint(i[l]);return this}setFromCenterAndSize(i,l){const u=ny.copy(l).multiplyScalar(.5);return this.min.copy(i).sub(u),this.max.copy(i).add(u),this}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(i){return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y}getParameter(i,l){return l.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y)}clampPoint(i,l){return l.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return ny.copy(i).clamp(this.min,this.max).sub(i).length()}intersect(i){return this.min.max(i.min),this.max.min(i.max),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}}const Q0=new he,ap=new he;class iy{constructor(i=new he,l=new he){this.start=i,this.end=l}set(i,l){return this.start.copy(i),this.end.copy(l),this}copy(i){return this.start.copy(i.start),this.end.copy(i.end),this}getCenter(i){return i.addVectors(this.start,this.end).multiplyScalar(.5)}delta(i){return i.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(i,l){return this.delta(l).multiplyScalar(i).add(this.start)}closestPointToPointParameter(i,l){Q0.subVectors(i,this.start),ap.subVectors(this.end,this.start);const u=ap.dot(ap);let h=ap.dot(Q0)/u;return l&&(h=On(h,0,1)),h}closestPointToPoint(i,l,u){const h=this.closestPointToPointParameter(i,l);return this.delta(u).multiplyScalar(h).add(this.start)}applyMatrix4(i){return this.start.applyMatrix4(i),this.end.applyMatrix4(i),this}equals(i){return i.start.equals(this.start)&&i.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const bi=new he;class Cs extends ei{constructor(i,l){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=l;const u=new wn,h=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let _=0,y=1,C=32;_<C;_++,y++){const S=_/C*Math.PI*2,B=y/C*Math.PI*2;h.push(Math.cos(S),Math.sin(S),1,Math.cos(B),Math.sin(B),1)}u.setAttribute("position",new w(h,3));const g=new lo({fog:!1,toneMapped:!1});this.cone=new Xl(u,g),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const i=this.light.distance?this.light.distance:1e3,l=i*Math.tan(this.light.angle);this.cone.scale.set(l,l,i),bi.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(bi),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const eo=new he,$c=new Gn,Xu=new Gn;class Ff extends Xl{constructor(i){const l=V0(i),u=new wn,h=[],g=[],_=new mn(0,0,1),y=new mn(0,1,0);for(let C=0;C<l.length;C++){const S=l[C];S.parent&&S.parent.isBone&&(h.push(0,0,0),h.push(0,0,0),g.push(_.r,_.g,_.b),g.push(y.r,y.g,y.b))}u.setAttribute("position",new w(h,3)),u.setAttribute("color",new w(g,3)),super(u,new lo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=i,this.bones=l,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(i){const l=this.bones,u=this.geometry,h=u.getAttribute("position");Xu.copy(this.root.matrixWorld).invert();for(let g=0,_=0;g<l.length;g++){const y=l[g];y.parent&&y.parent.isBone&&($c.multiplyMatrices(Xu,y.matrixWorld),eo.setFromMatrixPosition($c),h.setXYZ(_,eo.x,eo.y,eo.z),$c.multiplyMatrices(Xu,y.parent.matrixWorld),eo.setFromMatrixPosition($c),h.setXYZ(_+1,eo.x,eo.y,eo.z),_+=2)}u.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(i)}}function V0(b){const i=[];b.isBone===!0&&i.push(b);for(let l=0;l<b.children.length;l++)i.push.apply(i,V0(b.children[l]));return i}class ry extends os{constructor(i,l,u){super(new ep(l,4,2),new Sa({wireframe:!0,fog:!1,toneMapped:!1})),this.light=i,this.light.updateMatrixWorld(),this.color=u,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const G0=new he,jf=new mn,H0=new mn;class sy extends ei{constructor(i,l,u){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=u;const h=new Os(l);h.rotateY(.5*Math.PI),this.material=new Sa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const g=h.getAttribute("position"),_=new Float32Array(3*g.count);h.setAttribute("color",new ji(_,3)),this.add(new os(h,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const i=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const l=i.geometry.getAttribute("color");jf.copy(this.light.color),H0.copy(this.light.groundColor);for(let u=0,h=l.count;u<h;u++){const g=u<h/2?jf:H0;l.setXYZ(u,g.r,g.g,g.b)}l.needsUpdate=!0}i.lookAt(G0.setFromMatrixPosition(this.light.matrixWorld).negate())}}class W0 extends Xl{constructor(i=10,l=10,u=4473924,h=8947848){u=new mn(u),h=new mn(h);const g=l/2,_=i/l,y=i/2,C=[],S=[];for(let L=0,k=0,U=-y;L<=l;L++,U+=_){C.push(-y,0,U,y,0,U),C.push(U,0,-y,U,0,y);const Q=L===g?u:h;Q.toArray(S,k),k+=3,Q.toArray(S,k),k+=3,Q.toArray(S,k),k+=3,Q.toArray(S,k),k+=3}const B=new wn;B.setAttribute("position",new w(C,3)),B.setAttribute("color",new w(S,3)),super(B,new lo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class zf extends Xl{constructor(i=10,l=16,u=8,h=64,g=4473924,_=8947848){g=new mn(g),_=new mn(_);const y=[],C=[];if(l>1)for(let B=0;B<l;B++){const L=B/l*(2*Math.PI),k=Math.sin(L)*i,U=Math.cos(L)*i;y.push(0,0,0),y.push(k,0,U);const Q=1&B?g:_;C.push(Q.r,Q.g,Q.b),C.push(Q.r,Q.g,Q.b)}for(let B=0;B<u;B++){const L=1&B?g:_,k=i-i/u*B;for(let U=0;U<h;U++){let Q=U/h*(2*Math.PI),F=Math.sin(Q)*k,H=Math.cos(Q)*k;y.push(F,0,H),C.push(L.r,L.g,L.b),Q=(U+1)/h*(2*Math.PI),F=Math.sin(Q)*k,H=Math.cos(Q)*k,y.push(F,0,H),C.push(L.r,L.g,L.b)}}const S=new wn;S.setAttribute("position",new w(y,3)),S.setAttribute("color",new w(C,3)),super(S,new lo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const gr=new he,$l=new he,la=new he;class eu extends ei{constructor(i,l,u){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,l===void 0&&(l=1);let h=new wn;h.setAttribute("position",new w([-l,l,0,l,l,0,l,-l,0,-l,-l,0,-l,l,0],3));const g=new lo({fog:!1,toneMapped:!1});this.lightPlane=new Yl(h,g),this.add(this.lightPlane),h=new wn,h.setAttribute("position",new w([0,0,0,0,0,1],3)),this.targetLine=new Yl(h,g),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){gr.setFromMatrixPosition(this.light.matrixWorld),$l.setFromMatrixPosition(this.light.target.matrixWorld),la.subVectors($l,gr),this.lightPlane.lookAt($l),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($l),this.targetLine.scale.z=la.length()}}const tu=new he,Pr=new Ld;class oy extends Xl{constructor(i){const l=new wn,u=new lo({color:16777215,vertexColors:!0,toneMapped:!1}),h=[],g=[],_={};function y(Q,F){C(Q),C(F)}function C(Q){h.push(0,0,0),g.push(0,0,0),_[Q]===void 0&&(_[Q]=[]),_[Q].push(h.length/3-1)}y("n1","n2"),y("n2","n4"),y("n4","n3"),y("n3","n1"),y("f1","f2"),y("f2","f4"),y("f4","f3"),y("f3","f1"),y("n1","f1"),y("n2","f2"),y("n3","f3"),y("n4","f4"),y("p","n1"),y("p","n2"),y("p","n3"),y("p","n4"),y("u1","u2"),y("u2","u3"),y("u3","u1"),y("c","t"),y("p","c"),y("cn1","cn2"),y("cn3","cn4"),y("cf1","cf2"),y("cf3","cf4"),l.setAttribute("position",new w(h,3)),l.setAttribute("color",new w(g,3)),super(l,u),this.type="CameraHelper",this.camera=i,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=_,this.update();const S=new mn(16755200),B=new mn(16711680),L=new mn(43775),k=new mn(16777215),U=new mn(3355443);this.setColors(S,B,L,k,U)}setColors(i,l,u,h,g){const _=this.geometry.getAttribute("color");_.setXYZ(0,i.r,i.g,i.b),_.setXYZ(1,i.r,i.g,i.b),_.setXYZ(2,i.r,i.g,i.b),_.setXYZ(3,i.r,i.g,i.b),_.setXYZ(4,i.r,i.g,i.b),_.setXYZ(5,i.r,i.g,i.b),_.setXYZ(6,i.r,i.g,i.b),_.setXYZ(7,i.r,i.g,i.b),_.setXYZ(8,i.r,i.g,i.b),_.setXYZ(9,i.r,i.g,i.b),_.setXYZ(10,i.r,i.g,i.b),_.setXYZ(11,i.r,i.g,i.b),_.setXYZ(12,i.r,i.g,i.b),_.setXYZ(13,i.r,i.g,i.b),_.setXYZ(14,i.r,i.g,i.b),_.setXYZ(15,i.r,i.g,i.b),_.setXYZ(16,i.r,i.g,i.b),_.setXYZ(17,i.r,i.g,i.b),_.setXYZ(18,i.r,i.g,i.b),_.setXYZ(19,i.r,i.g,i.b),_.setXYZ(20,i.r,i.g,i.b),_.setXYZ(21,i.r,i.g,i.b),_.setXYZ(22,i.r,i.g,i.b),_.setXYZ(23,i.r,i.g,i.b),_.setXYZ(24,l.r,l.g,l.b),_.setXYZ(25,l.r,l.g,l.b),_.setXYZ(26,l.r,l.g,l.b),_.setXYZ(27,l.r,l.g,l.b),_.setXYZ(28,l.r,l.g,l.b),_.setXYZ(29,l.r,l.g,l.b),_.setXYZ(30,l.r,l.g,l.b),_.setXYZ(31,l.r,l.g,l.b),_.setXYZ(32,u.r,u.g,u.b),_.setXYZ(33,u.r,u.g,u.b),_.setXYZ(34,u.r,u.g,u.b),_.setXYZ(35,u.r,u.g,u.b),_.setXYZ(36,u.r,u.g,u.b),_.setXYZ(37,u.r,u.g,u.b),_.setXYZ(38,h.r,h.g,h.b),_.setXYZ(39,h.r,h.g,h.b),_.setXYZ(40,g.r,g.g,g.b),_.setXYZ(41,g.r,g.g,g.b),_.setXYZ(42,g.r,g.g,g.b),_.setXYZ(43,g.r,g.g,g.b),_.setXYZ(44,g.r,g.g,g.b),_.setXYZ(45,g.r,g.g,g.b),_.setXYZ(46,g.r,g.g,g.b),_.setXYZ(47,g.r,g.g,g.b),_.setXYZ(48,g.r,g.g,g.b),_.setXYZ(49,g.r,g.g,g.b),_.needsUpdate=!0}update(){const i=this.geometry,l=this.pointMap;Pr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Lr("c",l,i,Pr,0,0,-1),Lr("t",l,i,Pr,0,0,1),Lr("n1",l,i,Pr,-1,-1,-1),Lr("n2",l,i,Pr,1,-1,-1),Lr("n3",l,i,Pr,-1,1,-1),Lr("n4",l,i,Pr,1,1,-1),Lr("f1",l,i,Pr,-1,-1,1),Lr("f2",l,i,Pr,1,-1,1),Lr("f3",l,i,Pr,-1,1,1),Lr("f4",l,i,Pr,1,1,1),Lr("u1",l,i,Pr,.7,1.1,-1),Lr("u2",l,i,Pr,-.7,1.1,-1),Lr("u3",l,i,Pr,0,2,-1),Lr("cf1",l,i,Pr,-1,0,1),Lr("cf2",l,i,Pr,1,0,1),Lr("cf3",l,i,Pr,0,-1,1),Lr("cf4",l,i,Pr,0,1,1),Lr("cn1",l,i,Pr,-1,0,-1),Lr("cn2",l,i,Pr,1,0,-1),Lr("cn3",l,i,Pr,0,-1,-1),Lr("cn4",l,i,Pr,0,1,-1),i.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Lr(b,i,l,u,h,g,_){tu.set(h,g,_).unproject(u);const y=i[b];if(y!==void 0){const C=l.getAttribute("position");for(let S=0,B=y.length;S<B;S++)C.setXYZ(y[S],tu.x,tu.y,tu.z)}}const Qf=new Mc;class Qg extends Xl{constructor(i,l=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=new Float32Array(24),g=new wn;g.setIndex(new ji(u,1)),g.setAttribute("position",new ji(h,3)),super(g,new lo({color:l,toneMapped:!1})),this.object=i,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(i){if(i!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Qf.setFromObject(this.object),Qf.isEmpty())return;const l=Qf.min,u=Qf.max,h=this.geometry.attributes.position,g=h.array;g[0]=u.x,g[1]=u.y,g[2]=u.z,g[3]=l.x,g[4]=u.y,g[5]=u.z,g[6]=l.x,g[7]=l.y,g[8]=u.z,g[9]=u.x,g[10]=l.y,g[11]=u.z,g[12]=u.x,g[13]=u.y,g[14]=l.z,g[15]=l.x,g[16]=u.y,g[17]=l.z,g[18]=l.x,g[19]=l.y,g[20]=l.z,g[21]=u.x,g[22]=l.y,g[23]=l.z,h.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(i){return this.object=i,this.update(),this}copy(i,l){return super.copy(i,l),this.object=i.object,this}}class Ba extends Xl{constructor(i,l=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=new wn;h.setIndex(new ji(u,1)),h.setAttribute("position",new w([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(h,new lo({color:l,toneMapped:!1})),this.box=i,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(i){const l=this.box;l.isEmpty()||(l.getCenter(this.position),l.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(i))}}class Vg extends Yl{constructor(i,l=1,u=16776960){const h=u,g=new wn;g.setAttribute("position",new w([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),g.computeBoundingSphere(),super(g,new lo({color:h,toneMapped:!1})),this.type="PlaneHelper",this.plane=i,this.size=l;const _=new wn;_.setAttribute("position",new w([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),_.computeBoundingSphere(),this.add(new os(_,new Sa({color:h,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(i){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(i)}}const lp=new he;let ho,Xh;class ec extends ei{constructor(i=new he(0,0,1),l=new he(0,0,0),u=1,h=16776960,g=.2*u,_=.2*g){super(),this.type="ArrowHelper",ho===void 0&&(ho=new wn,ho.setAttribute("position",new w([0,0,0,0,1,0],3)),Xh=new as(0,.5,1,5,1),Xh.translate(0,-.5,0)),this.position.copy(l),this.line=new Yl(ho,new lo({color:h,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new os(Xh,new Sa({color:h,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(u,g,_)}setDirection(i){if(i.y>.99999)this.quaternion.set(0,0,0,1);else if(i.y<-.99999)this.quaternion.set(1,0,0,0);else{lp.set(i.z,0,-i.x).normalize();const l=Math.acos(i.y);this.quaternion.setFromAxisAngle(lp,l)}}setLength(i,l=.2*i,u=.2*l){this.line.scale.set(1,Math.max(1e-4,i-l),1),this.line.updateMatrix(),this.cone.scale.set(u,l,u),this.cone.position.y=i,this.cone.updateMatrix()}setColor(i){this.line.material.color.set(i),this.cone.material.color.set(i)}copy(i){return super.copy(i,!1),this.line.copy(i.line),this.cone.copy(i.cone),this}}class cp extends Xl{constructor(i=1){const l=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],u=new wn;u.setAttribute("position",new w(l,3)),u.setAttribute("color",new w([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(u,new lo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(i,l,u){const h=new mn,g=this.geometry.attributes.color.array;return h.set(i),h.toArray(g,0),h.toArray(g,3),h.set(l),h.toArray(g,6),h.toArray(g,9),h.set(u),h.toArray(g,12),h.toArray(g,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Gg{constructor(){this.type="ShapePath",this.color=new mn,this.subPaths=[],this.currentPath=null}moveTo(i,l){return this.currentPath=new Kd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(i,l),this}lineTo(i,l){return this.currentPath.lineTo(i,l),this}quadraticCurveTo(i,l,u,h){return this.currentPath.quadraticCurveTo(i,l,u,h),this}bezierCurveTo(i,l,u,h,g,_){return this.currentPath.bezierCurveTo(i,l,u,h,g,_),this}splineThru(i){return this.currentPath.splineThru(i),this}toShapes(i,l){function u(q){const $=[];for(let ie=0,se=q.length;ie<se;ie++){const le=q[ie],Ie=new zh;Ie.curves=le.curves,$.push(Ie)}return $}function h(q,$){const ie=$.length;let se=!1;for(let le=ie-1,Ie=0;Ie<ie;le=Ie++){let De=$[le],Xe=$[Ie],Ke=Xe.x-De.x,Be=Xe.y-De.y;if(Math.abs(Be)>Number.EPSILON){if(Be<0&&(De=$[Ie],Ke=-Ke,Xe=$[le],Be=-Be),q.y<De.y||q.y>Xe.y)continue;if(q.y===De.y){if(q.x===De.x)return!0}else{const St=Be*(q.x-De.x)-Ke*(q.y-De.y);if(St===0)return!0;if(St<0)continue;se=!se}}else{if(q.y!==De.y)continue;if(Xe.x<=q.x&&q.x<=De.x||De.x<=q.x&&q.x<=Xe.x)return!0}}return se}const g=fl.isClockWise,_=this.subPaths;if(_.length===0)return[];if(l===!0)return u(_);let y,C,S;const B=[];if(_.length===1)return C=_[0],S=new zh,S.curves=C.curves,B.push(S),B;let L=!g(_[0].getPoints());L=i?!L:L;const k=[],U=[];let Q,F,H=[],W=0;U[W]=void 0,H[W]=[];for(let q=0,$=_.length;q<$;q++)C=_[q],Q=C.getPoints(),y=g(Q),y=i?!y:y,y?(!L&&U[W]&&W++,U[W]={s:new zh,p:Q},U[W].s.curves=C.curves,L&&W++,H[W]=[]):H[W].push({h:C,p:Q[0]});if(!U[0])return u(_);if(U.length>1){let q=!1,$=0;for(let ie=0,se=U.length;ie<se;ie++)k[ie]=[];for(let ie=0,se=U.length;ie<se;ie++){const le=H[ie];for(let Ie=0;Ie<le.length;Ie++){const De=le[Ie];let Xe=!0;for(let Ke=0;Ke<U.length;Ke++)h(De.p,U[Ke].p)&&(ie!==Ke&&$++,Xe?(Xe=!1,k[Ke].push(De)):q=!0);Xe&&k[ie].push(De)}}$>0&&q===!1&&(H=k)}for(let q=0,$=U.length;q<$;q++){S=U[q].s,B.push(S),F=H[q];for(let ie=0,se=F.length;ie<se;ie++)S.holes.push(F[ie].h)}return B}}const ka=q0();function q0(){const b=new ArrayBuffer(4),i=new Float32Array(b),l=new Uint32Array(b),u=new Uint32Array(512),h=new Uint32Array(512);for(let C=0;C<256;++C){const S=C-127;S<-27?(u[C]=0,u[256|C]=32768,h[C]=24,h[256|C]=24):S<-14?(u[C]=1024>>-S-14,u[256|C]=1024>>-S-14|32768,h[C]=-S-1,h[256|C]=-S-1):S<=15?(u[C]=S+15<<10,u[256|C]=S+15<<10|32768,h[C]=13,h[256|C]=13):S<128?(u[C]=31744,u[256|C]=64512,h[C]=24,h[256|C]=24):(u[C]=31744,u[256|C]=64512,h[C]=13,h[256|C]=13)}const g=new Uint32Array(2048),_=new Uint32Array(64),y=new Uint32Array(64);for(let C=1;C<1024;++C){let S=C<<13,B=0;for(;!(8388608&S);)S<<=1,B-=8388608;S&=-8388609,B+=947912704,g[C]=S|B}for(let C=1024;C<2048;++C)g[C]=939524096+(C-1024<<13);for(let C=1;C<31;++C)_[C]=C<<23;_[31]=1199570944,_[32]=2147483648;for(let C=33;C<63;++C)_[C]=2147483648+(C-32<<23);_[63]=3347054592;for(let C=1;C<64;++C)C!==32&&(y[C]=1024);return{floatView:i,uint32View:l,baseTable:u,shiftTable:h,mantissaTable:g,exponentTable:_,offsetTable:y}}var up=Object.freeze({__proto__:null,toHalfFloat:function(b){Math.abs(b)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),b=On(b,-65504,65504),ka.floatView[0]=b;const i=ka.uint32View[0],l=i>>23&511;return ka.baseTable[l]+((8388607&i)>>ka.shiftTable[l])},fromHalfFloat:function(b){const i=b>>10;return ka.uint32View[0]=ka.mantissaTable[ka.offsetTable[i]+(1023&b)]+ka.exponentTable[i],ka.floatView[0]}});function Vf(){console.error("THREE.ImmediateRenderObject has been removed.")}class Y0 extends qs{constructor(i,l,u){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(i,l,u),this.samples=4}}class ay extends bu{constructor(i,l,u,h){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(i,l,u,h)}}class nu extends Sc{constructor(i,l,u,h){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(i,l,u,h)}}class ly extends Ma{constructor(i,l,u,h,g,_){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(i,l,u,h,g,_)}}class cy extends df{constructor(i,l,u,h){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(i,l,u,h)}}class hp extends sa{constructor(i,l,u,h){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(i,l,u,h)}}class X0 extends rr{constructor(i,l,u,h,g,_,y){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(i,l,u,h,g,_,y)}}class Kh extends as{constructor(i,l,u,h,g,_,y,C){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(i,l,u,h,g,_,y,C)}}class Gf extends pf{constructor(i,l){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(i,l)}}class uy extends Af{constructor(i,l){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(i,l)}}class Hg extends $d{constructor(i,l){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(i,l)}}class hy extends _r{constructor(i,l,u,h){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(i,l,u,h)}}class dp extends Os{constructor(i,l){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(i,l)}}class pp extends Bu{constructor(i,l,u,h){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(i,l,u,h)}}class dy extends zc{constructor(i,l,u,h){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(i,l,u,h)}}class py extends Vh{constructor(i,l,u,h,g,_){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(i,l,u,h,g,_)}}class fy extends yf{constructor(i,l){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(i,l)}}class my extends ep{constructor(i,l,u,h,g,_,y){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(i,l,u,h,g,_,y)}}class Ku extends Gh{constructor(i,l){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(i,l)}}class K0 extends Vu{constructor(i,l,u,h,g){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(i,l,u,h,g)}}class fp extends Es{constructor(i,l,u,h,g,_){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(i,l,u,h,g,_)}}class Oa extends bf{constructor(i,l,u,h,g){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(i,l,u,h,g)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:f}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=f)},553:function(Mn,Tt,ct){ct.d(Tt,{_:function(){return ht}});var f=ct(988);const It=new WeakMap;class ht extends f.aNw{constructor(Ue){super(Ue),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Ue){return this.decoderPath=Ue,this}setDecoderConfig(Ue){return this.decoderConfig=Ue,this}setWorkerLimit(Ue){return this.workerLimit=Ue,this}load(Ue,vt,wt,Je){const Ye=new f.hH6(this.manager);Ye.setPath(this.path),Ye.setResponseType("arraybuffer"),Ye.setRequestHeader(this.requestHeader),Ye.setWithCredentials(this.withCredentials),Ye.load(Ue,Qe=>{this.decodeDracoFile(Qe,vt).catch(Je)},wt,Je)}decodeDracoFile(Ue,vt,wt,Je){const Ye={attributeIDs:wt||this.defaultAttributeIDs,attributeTypes:Je||this.defaultAttributeTypes,useUniqueIDs:!!wt};return this.decodeGeometry(Ue,Ye).then(vt)}decodeGeometry(Ue,vt){const wt=JSON.stringify(vt);if(It.has(Ue)){const me=It.get(Ue);if(me.key===wt)return me.promise;if(Ue.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let Je;const Ye=this.workerNextTaskID++,Qe=Ue.byteLength,je=this._getWorker(Ye,Qe).then(me=>(Je=me,new Promise((Te,ue)=>{Je._callbacks[Ye]={resolve:Te,reject:ue},Je.postMessage({type:"decode",id:Ye,taskConfig:vt,buffer:Ue},[Ue])}))).then(me=>this._createGeometry(me.geometry));return je.catch(()=>!0).then(()=>{Je&&Ye&&this._releaseTask(Je,Ye)}),It.set(Ue,{key:wt,promise:je}),je}_createGeometry(Ue){const vt=new f.u9r;Ue.index&&vt.setIndex(new f.TlE(Ue.index.array,1));for(let wt=0;wt<Ue.attributes.length;wt++){const Je=Ue.attributes[wt],Ye=Je.name,Qe=Je.array,je=Je.itemSize;vt.setAttribute(Ye,new f.TlE(Qe,je))}return vt}_loadLibrary(Ue,vt){const wt=new f.hH6(this.manager);return wt.setPath(this.decoderPath),wt.setResponseType(vt),wt.setWithCredentials(this.withCredentials),new Promise((Je,Ye)=>{wt.load(Ue,Je,void 0,Ye)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Ue=typeof WebAssembly!="object"||this.decoderConfig.type==="js",vt=[];return Ue?vt.push(this._loadLibrary("draco_decoder.js","text")):(vt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),vt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(vt).then(wt=>{const Je=wt[0];Ue||(this.decoderConfig.wasmBinary=wt[1]);const Ye=Ge.toString(),Qe=["/* draco decoder */",Je,"","/* worker */",Ye.substring(Ye.indexOf("{")+1,Ye.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([Qe]))}),this.decoderPending}_getWorker(Ue,vt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const Je=new Worker(this.workerSourceURL);Je._callbacks={},Je._taskCosts={},Je._taskLoad=0,Je.postMessage({type:"init",decoderConfig:this.decoderConfig}),Je.onmessage=function(Ye){const Qe=Ye.data;switch(Qe.type){case"decode":Je._callbacks[Qe.id].resolve(Qe);break;case"error":Je._callbacks[Qe.id].reject(Qe);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+Qe.type+'"')}},this.workerPool.push(Je)}else this.workerPool.sort(function(Je,Ye){return Je._taskLoad>Ye._taskLoad?-1:1});const wt=this.workerPool[this.workerPool.length-1];return wt._taskCosts[Ue]=vt,wt._taskLoad+=vt,wt})}_releaseTask(Ue,vt){Ue._taskLoad-=Ue._taskCosts[vt],delete Ue._callbacks[vt],delete Ue._taskCosts[vt]}debug(){console.log("Task load: ",this.workerPool.map(Ue=>Ue._taskLoad))}dispose(){for(let Ue=0;Ue<this.workerPool.length;++Ue)this.workerPool[Ue].terminate();return this.workerPool.length=0,this}}function Ge(){let rt,Ue;function vt(wt,Je,Ye,Qe,je,me){const Te=me.num_components(),ue=Ye.num_points()*Te,Ae=ue*je.BYTES_PER_ELEMENT,ke=function(Ve,K){switch(K){case Float32Array:return Ve.DT_FLOAT32;case Int8Array:return Ve.DT_INT8;case Int16Array:return Ve.DT_INT16;case Int32Array:return Ve.DT_INT32;case Uint8Array:return Ve.DT_UINT8;case Uint16Array:return Ve.DT_UINT16;case Uint32Array:return Ve.DT_UINT32}}(wt,je),mt=wt._malloc(Ae);Je.GetAttributeDataArrayForAllPoints(Ye,me,ke,Ae,mt);const Ee=new je(wt.HEAPF32.buffer,mt,ue).slice();return wt._free(mt),{name:Qe,array:Ee,itemSize:Te}}onmessage=function(wt){const Je=wt.data;switch(Je.type){case"init":rt=Je.decoderConfig,Ue=new Promise(function(je){rt.onModuleLoaded=function(me){je({draco:me})},DracoDecoderModule(rt)});break;case"decode":const Ye=Je.buffer,Qe=Je.taskConfig;Ue.then(je=>{const me=je.draco,Te=new me.Decoder,ue=new me.DecoderBuffer;ue.Init(new Int8Array(Ye),Ye.byteLength);try{const Ae=function(mt,Ee,Ve,K){const Z=K.attributeIDs,te=K.attributeTypes;let Oe,ve;const st=Ee.GetEncodedGeometryType(Ve);if(st===mt.TRIANGULAR_MESH)Oe=new mt.Mesh,ve=Ee.DecodeBufferToMesh(Ve,Oe);else{if(st!==mt.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");Oe=new mt.PointCloud,ve=Ee.DecodeBufferToPointCloud(Ve,Oe)}if(!ve.ok()||Oe.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+ve.error_msg());const qt={index:null,attributes:[]};for(const Vt in Z){const tn=self[te[Vt]];let Bt,on;if(K.useUniqueIDs)on=Z[Vt],Bt=Ee.GetAttributeByUniqueId(Oe,on);else{if(on=Ee.GetAttributeId(Oe,mt[Z[Vt]]),on===-1)continue;Bt=Ee.GetAttribute(Oe,on)}qt.attributes.push(vt(mt,Ee,Oe,Vt,tn,Bt))}return st===mt.TRIANGULAR_MESH&&(qt.index=function(Vt,tn,Bt){const on=3*Bt.num_faces(),Yt=4*on,Xt=Vt._malloc(Yt);tn.GetTrianglesUInt32Array(Bt,Yt,Xt);const et=new Uint32Array(Vt.HEAPF32.buffer,Xt,on).slice();return Vt._free(Xt),{array:et,itemSize:1}}(mt,Ee,Oe)),mt.destroy(Oe),qt}(me,Te,ue,Qe),ke=Ae.attributes.map(mt=>mt.array.buffer);Ae.index&&ke.push(Ae.index.array.buffer),self.postMessage({type:"decode",id:Je.id,geometry:Ae},ke)}catch(Ae){console.error(Ae),self.postMessage({type:"error",id:Je.id,error:Ae.message})}finally{me.destroy(ue),me.destroy(Te)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(Mn){var Tt=__webpackgi_module_cache__[Mn];if(Tt!==void 0)return Tt.exports;var ct=__webpackgi_module_cache__[Mn]={id:Mn,exports:{}};return __webpackgi_modules__[Mn].call(ct.exports,ct,ct.exports,__webpackgi_require__),ct.exports}__webpackgi_require__.n=function(Mn){var Tt=Mn&&Mn.__esModule?function(){return Mn.default}:function(){return Mn};return __webpackgi_require__.d(Tt,{a:Tt}),Tt},__webpackgi_require__.d=function(Mn,Tt){for(var ct in Tt)__webpackgi_require__.o(Tt,ct)&&!__webpackgi_require__.o(Mn,ct)&&Object.defineProperty(Mn,ct,{enumerable:!0,get:Tt[ct]})},__webpackgi_require__.o=function(Mn,Tt){return Object.prototype.hasOwnProperty.call(Mn,Tt)},__webpackgi_require__.r=function(Mn){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Mn,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Mn,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{LY2:function(){return f.LY2},HRj:function(){return ba},li4:function(){return XE},FO5:function(){return KE},Nlh:function(){return qE},QvI:function(){return Zn},JHp:function(){return qv},bGH:function(){return f.bGH},NDo:function(){return f.NDo},gSk:function(){return f.gSk},WMw:function(){return f.WMw},OTo:function(){return f.OTo},Se2:function(){return f.Se2},cum:function(){return f.cum},Mig:function(){return f.Mig},B$7:function(){return Om},i_9:function(){return f.i_9},m7l:function(){return f.m7l},sYA:function(){return f.sYA},Xcj:function(){return f.Xcj},mzJ:function(){return f.mzJ},ZZA:function(){return f.ZZA},$Ph:function(){return Vo},T__:function(){return f.T__},HkE:function(){return f.HkE},tGC:function(){return f.tGC},g1S:function(){return Ju},I$C:function(){return s_},QIH:function(){return si},_JE:function(){return Jc},ksm:function(){return ln},jl_:function(){return ia},b7R:function(){return Ks},BDV:function(){return Tn},Ea_:function(){return Ih},qff:function(){return ia},tmC:function(){return Sr},BON:function(){return fw},P40:function(){return os},wLL:function(){return Uo},iHO:function(){return Im},BbS:function(){return f.BbS},kqm:function(){return f.kqm},Hmr:function(){return f.Hmr},SJI:function(){return f.SJI},mTL:function(){return f.mTL},y8_:function(){return f.y8_},_Li:function(){return f._Li},g56:function(){return Zs},bj3:function(){return pi},z81:function(){return f.z81},_MY:function(){return f._MY},yEv:function(){return Pw},dFZ:function(){return Qu},N$j:function(){return f.N$j},_YM:function(){return f._YM},TUj:function(){return f.TUj},ZzF:function(){return f.ZzF},qzb:function(){return Vt},GQ:function(){return f.GQ},nvb:function(){return f.nvb},DvJ:function(){return f.DvJ},fQA:function(){return f.fQA},cPz:function(){return i0},TlE:function(){return f.TlE},u9r:function(){return f.u9r},s4_:function(){return f.s4_},T95:function(){return f.T95},F5w:function(){return Cb},NlP:function(){return Gb},$8Z:function(){return id},YYN:function(){return td},CtF:function(){return f.CtF},V1s:function(){return f.V1s},jOv:function(){return Ws},Rki:function(){return f.Rki},pzV:function(){return $b},itZ:function(){return co},qKx:function(){return Dr},vlJ:function(){return d_},nPO:function(){return nh},zcQ:function(){return D0},GH1:function(){return Go},ROQ:function(){return f.ROQ},YN5:function(){return f.YN5},BVQ:function(){return f.BVQ},YT8:function(){return f.YT8},_DE:function(){return Ng},YGz:function(){return f.YGz},trn:function(){return f.trn},zf8:function(){return f.zf8},uWy:function(){return f.uWy},wYQ:function(){return Pa},SUY:function(){return f.SUY},Ilk:function(){return f.Ilk},R2R:function(){return f.R2R},epp:function(){return f.epp},xmJ:function(){return $s},GD$:function(){return ao},EB7:function(){return f.EB7},DqL:function(){return f.DqL},_3:function(){return f._3},b_z:function(){return f.b_z},OCn:function(){return ih},_am:function(){return f._am},kB7:function(){return $_},fY$:function(){return f.fY$},vxC:function(){return f.vxC},BtG:function(){return f.BtG},cBK:function(){return f.cBK},g8_:function(){return f.g8_},AXT:function(){return f.AXT},yj7:function(){return f.yj7},dYG:function(){return f.dYG},tm_:function(){return f.tm_},S2y:function(){return f.S2y},B02:function(){return f.B02},PeU:function(){return f.PeU},Hyl:function(){return f.Hyl},Wqd:function(){return f.Wqd},Xaj:function(){return f.Xaj},DUb:function(){return Es},dZ3:function(){return f.dZ3},m_w:function(){return f.m_w},fHI:function(){return f.fHI},LBq:function(){return f.LBq},dHf:function(){return WE},Qww:function(){return Ic.Q},CGV:function(){return sv},JUT:function(){return f.JUT},p3g:function(){return f.p3g},IEO:function(){return f.IEO},CN8:function(){return f.CN8},zob:function(){return f.zob},yxD:function(){return f.yxD},CUS:function(){return Yi},A5E:function(){return f.A5E},zqG:function(){return dl},PfX:function(){return j_},Q1o:function(){return Du},jfJ:function(){return f.jfJ},T_J:function(){return f.T_J},tEQ:function(){return f.tEQ},gb4:function(){return Ot},qkB:function(){return f.qkB},cvk:function(){return Gu},HWo:function(){return Wc},brP:function(){return f.brP},$YQ:function(){return f.$YQ},X8d:function(){return R_},Zdt:function(){return n1},yNB:function(){return er},h7x:function(){return _r},Ox3:function(){return f.Ox3},qtn:function(){return Hl},cBI:function(){return f.cBI},cU9:function(){return f.cU9},DT1:function(){return f.DT1},Kgo:function(){return f.Kgo},ehD:function(){return f.ehD},fhJ:function(){return Gp},y1s:function(){return Hp},fSK:function(){return f.fSK},Vdb:function(){return f.Vdb},l8J:function(){return f.l8J},dj0:function(){return f.dj0},QM0:function(){return f.QM0},OIS:function(){return po},q8b:function(){return jh},TOt:function(){return f.TOt},xaN:function(){return Qe},Ny0:function(){return f.Ny0},NeD:function(){return Bx},Zof:function(){return Nv},eD:function(){return f.eD},jwo:function(){return f.jwo},dSO:function(){return f.dSO},Bf4:function(){return f.Bf4},USm:function(){return f.USm},pBf:function(){return f.pBf},$Vf:function(){return f.$Vf},O7d:function(){return f.O7d},ksq:function(){return oi},gXf:function(){return E0},hH6:function(){return f.hH6},kpi:function(){return Fg},DwZ:function(){return js},kN3:function(){return s1},e62:function(){return f.e62},a$l:function(){return f.a$l},OM3:function(){return f.OM3},VzW:function(){return f.VzW},ybr:function(){return f.ybr},yo9:function(){return f.yo9},$Bt:function(){return jc},Wzm:function(){return f.Wzm},Wl3:function(){return f.Wl3},iWj:function(){return f.iWj},DNz:function(){return Mr},m1M:function(){return qi},ylh:function(){return f.ylh},v9Y:function(){return f.v9Y},LSk:function(){return f.LSk},LHE:function(){return rr},KE0:function(){return tx},KCF:function(){return jE},a4n:function(){return Bw},zIH:function(){return Mm},Hfk:function(){return tl},png:function(){return $o},tAj:function(){return Nl},Eb_:function(){return ea},BT2:function(){return e_},_8p:function(){return C1},V5Z:function(){return Wu},s5b:function(){return Bg},hkn:function(){return vd},GFY:function(){return sl},w$m:function(){return f.w$m},ksN:function(){return f.ksN},j4z:function(){return f.j4z},OAl:function(){return f.OAl},VLJ:function(){return f.VLJ},C73:function(){return zo},ZAu:function(){return f.ZAu},ibP:function(){return Iu},_fI:function(){return ao},hUN:function(){return Ho},cLu:function(){return f.cLu},vmT:function(){return f.vmT},Qpg:function(){return f.Qpg},So8:function(){return f.So8},eOv:function(){return Xb},Wjw:function(){return f.Wjw},cJO:function(){return f.cJO},QRU:function(){return f.QRU},S3k:function(){return f.S3k},PpQ:function(){return f.PpQ},AHu:function(){return f.AHu},q_9:function(){return dr},ZRs:function(){return f.ZRs},oqc:function(){return f.oqc},T_x:function(){return $i},lb7:function(){return f.lb7},L5s:function(){return f.L5s},$TI:function(){return f.$TI},SPe:function(){return f.SPe},aVm:function(){return f.aVm},j87:function(){return f.j87},RNb:function(){return f.RNb},Kz5:function(){return f.Kz5},vpT:function(){return f.vpT},kB5:function(){return f.kB5},_C8:function(){return f._C8},Syv:function(){return f.Syv},NMF:function(){return f.NMF},pIN:function(){return f.pIN},eMJ:function(){return f.eMJ},rN7:function(){return Pf},iUp:function(){return N0},GFd:function(){return Jg},x5V:function(){return f.x5V},tUh:function(){return f.tUh},z8B:function(){return f.z8B},vcl:function(){return kg},GZb:function(){return f.GZb},p7y:function(){return f.p7y},S9g:function(){return f.S9g},Zr5:function(){return f.Zr5},vCF:function(){return f.vCF},yt0:function(){return f.yt0},uXU:function(){return f.uXU},_kC:function(){return f._kC},lk7:function(){return f.lk7},USc:function(){return Kb},x12:function(){return f.x12},Zzh:function(){return f.Zzh},nls:function(){return f.nls},g_z:function(){return f.g_z},U7:function(){return f.U7},FT0:function(){return f.FT0},blk:function(){return f.blk},ejS:function(){return f.ejS},rnI:function(){return f.rnI},wem:function(){return f.wem},lfu:function(){return f.lfu},FDw:function(){return f.FDw},lRj:function(){return f.lRj},D1R:function(){return f.D1R},qyh:function(){return f.qyh},GUF:function(){return f.GUF},EoG:function(){return f.EoG},aNw:function(){return f.aNw},Zp0:function(){return f.Zp0},lLk:function(){return f.lLk},jAl:function(){return f.jAl},uEv:function(){return f.uEv},YKA:function(){return f.YKA},cRx:function(){return f.cRx},Y8D:function(){return f.Y8D},RsA:function(){return f.RsA},Y0m:function(){return qf},F5T:function(){return f.F5T},EDU:function(){return hb},z$Q:function(){return hm},KA8:function(){return $r},XUj:function(){return wb},Me$:function(){return Ap},u7G:function(){return f.u7G},PEk:function(){return yc},BG4:function(){return lx},M8C:function(){return f.M8C},Vkp:function(){return f.Vkp},yGw:function(){return f.yGw},Sm8:function(){return f.Sm8},Kj0:function(){return f.Kj0},vBJ:function(){return f.vBJ},QfV:function(){return Eo},lRF:function(){return f.lRF},Lun:function(){return f.Lun},YBo:function(){return f.YBo},kaV:function(){return f.kaV},RSm:function(){return f.RSm},xoR:function(){return f.xoR},EJi:function(){return f.EJi},Wid:function(){return f.Wid},iuj:function(){return vs},IKL:function(){return f.IKL},r_:function(){return f.r_},OoA:function(){return f.OoA},qhX:function(){return f.qhX},qPT:function(){return Wp},M5h:function(){return f.M5h},Ns1:function(){return f.Ns1},TyD:function(){return f.TyD},vZf:function(){return f.vZf},HTd:function(){return f.HTd},aH4:function(){return f.aH4},YLQ:function(){return f.YLQ},BVF:function(){return f.BVF},MyG:function(){return f.MyG},jFi:function(){return f.jFi},aCh:function(){return f.aCh},uL9:function(){return f.uL9},TNj:function(){return Os},IFH:function(){return f.IFH},bdR:function(){return f.bdR},kM_:function(){return eA},M6v:function(){return f.M6v},RvT:function(){return f.RvT},dUE:function(){return f.dUE},oe_:function(){return xy},BuN:function(){return i_},Tme:function(){return f.Tme},N9P:function(){return Ka},Gql:function(){return f.Gql},$XY:function(){return Cd},O9d:function(){return rA},zEO:function(){return vu},qfx:function(){return ah},PA7:function(){return f.PA7},REq:function(){return f.REq},pQR:function(){return f.pQR},ghN:function(){return f.ghN},Hy8:function(){return f.Hy8},Wpd:function(){return f.Wpd},LgZ:function(){return f.LgZ},iWC:function(){return f.iWC},mqn:function(){return PI},SKe:function(){return Mi},iKG:function(){return f.iKG},_iA:function(){return f._iA},ntZ:function(){return f.ntZ},anP:function(){return f.anP},X2e:function(){return QE},FCo:function(){return au},y$t:function(){return f.y$t},cPb:function(){return f.cPb},lmx:function(){return Ii},JOQ:function(){return f.JOQ},BKK:function(){return f.BKK},_12:function(){return f._12},tJx:function(){return f.tJx},cek:function(){return f.cek},qD0:function(){return Fv},xG9:function(){return f.xG9},wI8:function(){return od},Sgv:function(){return o1},woe:function(){return f.woe},UY4:function(){return f.UY4},aq0:function(){return f.aq0},ujx:function(){return f.ujx},Uol:function(){return f.Uol},JiH:function(){return y_},VYz:function(){return f.VYz},_Pm:function(){return Xc},EsW:function(){return ks},iUV:function(){return f.iUV},tf:function(){return f.tf},ZQ6:function(){return f.ZQ6},mXe:function(){return f.mXe},_fP:function(){return f._fP},iLg:function(){return f.iLg},zbs:function(){return f.zbs},UZH:function(){return f.UZH},mSO:function(){return f.mSO},wk1:function(){return f.wk1},E2K:function(){return f.E2K},FUD:function(){return f.FUD},pKu:function(){return f.pKu},GG6:function(){return f.GG6},Gih:function(){return f.Gih},iiP:function(){return f.iiP},SvJ:function(){return f.SvJ},ptH:function(){return f.ptH},jZA:function(){return f.jZA},y2t:function(){return f.y2t},gi4:function(){return f.gi4},Djp:function(){return f.Djp},BG$:function(){return f.BG$},NYV:function(){return f.NYV},xJs:function(){return f.xJs},bsb:function(){return f.bsb},ekQ:function(){return f.ekQ},CaW:function(){return f.CaW},eaV:function(){return f.eaV},BFQ:function(){return f.BFQ},v3W:function(){return f.v3W},ILR:function(){return f.ILR},UCm:function(){return f.UCm},Inb:function(){return f.Inb},U1$:function(){return Yt},LgE:function(){return f.LgE},fto:function(){return f.fto},l0P:function(){return f.l0P},vCx:function(){return f.vCx},_AM:function(){return f._AM},wuA:function(){return f.wuA},av9:function(){return f.av9},CtA:function(){return f.CtA},BvQ:function(){return gf},FZJ:function(){return Vc},FIo:function(){return f.FIo},zHn:function(){return f.zHn},iMs:function(){return f.iMs},T_f:function(){return f.T_f},hEm:function(){return f.hEm},D9w:function(){return f.D9w},sHH:function(){return Qh},CdI:function(){return f.CdI},rkc:function(){return ad},rpg:function(){return f.rpg},ce8:function(){return f.ce8},rOj:function(){return f.rOj},P6m:function(){return tc},JA6:function(){return Yg},V4E:function(){return f.V4E},o8S:function(){return f.o8S},flB:function(){return pc},DUH:function(){return dT},KI_:function(){return f.KI_},iLN:function(){return Vm},jsw:function(){return Wr},srG:function(){return xb},i6Z:function(){return zm},vfv:function(){return t_},xsS:function(){return f.xsS},or:function(){return Jb},EQj:function(){return Wo},ov0:function(){return n0},WdD:function(){return f.WdD},Vj0:function(){return f.Vj0},jyz:function(){return f.jyz},mTM:function(){return _c},Mn1:function(){return es},Hlq:function(){return Vr},Fi7:function(){return pl},Tn7:function(){return f.Tn7},bnF:function(){return f.bnF},HW6:function(){return f.HW6},oa8:function(){return f.oa8},T_1:function(){return f.T_1},zHJ:function(){return xl},iDF:function(){return f.iDF},iAb:function(){return f.iAb},d4E:function(){return ny},lBg:function(){return qb},JeJ:function(){return Sw},FKY:function(){return ct},zlZ:function(){return Ey},vkg:function(){return yd},brh:function(){return nc},kZK:function(){return El},puG:function(){return Yb},OdW:function(){return f.OdW},_YX:function(){return f._YX},TUv:function(){return f.TUv},Hw6:function(){return f.Hw6},aLr:function(){return f.aLr},Aip:function(){return f.Aip},xo$:function(){return f.xo$},bIn:function(){return RI},$V:function(){return f.$V},lDi:function(){return f.lDi},gti:function(){return f.gti},PMe:function(){return f.PMe},iwP:function(){return kh},FvO:function(){return f.FvO},jyi:function(){return f.jyi},xeV:function(){return f.xeV},k74:function(){return f.k74},RlZ:function(){return f.RlZ},KhW:function(){return f.KhW},HgB:function(){return f.HgB},W2J:function(){return f.W2J},JWc:function(){return f.JWc},u37:function(){return f.u37},Z6B:function(){return f.Z6B},QZ1:function(){return f.QZ1},Ir4:function(){return f.Ir4},NwF:function(){return f.NwF},Wbm:function(){return f.Wbm},N4l:function(){return f.N4l},ej9:function(){return yp},QmN:function(){return f.QmN},IOt:function(){return f.IOt},NOD:function(){return Ef},L5g:function(){return f.L5g},H$k:function(){return f.H$k},cuP:function(){return Fs},xEZ:function(){return f.xEZ},dpR:function(){return f.dpR},wOD:function(){return oa},KNb:function(){return H_},IiN:function(){return Of},Cne:function(){return f.Cne},XvJ:function(){return f.XvJ},XZw:function(){return f.XZw},FE5:function(){return f.FE5},lVp:function(){return x0},CJI:function(){return f.CJI},z$h:function(){return f.z$h},UlW:function(){return f.UlW},WwZ:function(){return f.WwZ},Lcc:function(){return f.Lcc},WXh:function(){return f.WXh},Vjr:function(){return Px},LuM:function(){return d1},LP5:function(){return zS},xfE:function(){return f.xfE},qlB:function(){return f.qlB},lCJ:function(){return f.lCJ},WTc:function(){return f.WTc},rAo:function(){return f.rAo},LZj:function(){return ey},xWb:function(){return f.xWb},gH0:function(){return f.gH0},rBU:function(){return f.rBU},rDY:function(){return f.rDY},ywz:function(){return f.ywz},wJv:function(){return f.wJv},JQ4:function(){return f.JQ4},k0A:function(){return f.k0A},irR:function(){return f.irR},LsT:function(){return f.LsT},q5h:function(){return Pm},TKh:function(){return pw},tyg:function(){return Q_},Ro5:function(){return Rh},dwk:function(){return f.dwk},FM8:function(){return f.FM8},Pa4:function(){return f.Pa4},Ltg:function(){return f.Ltg},yC1:function(){return f.yC1},lHq:function(){return xf},fO1:function(){return f.fO1},oMA:function(){return Ta},JzW:function(){return Mn},QEt:function(){return Og},b5g:function(){return f.b5g},Ywn:function(){return f.Ywn},GVz:function(){return f.GVz},oAp:function(){return f.oAp},kFz:function(){return f.kFz},p7A:function(){return f.p7A},dd2:function(){return f.dd2},CP7:function(){return f.CP7},fQK:function(){return f.fQK},Wd$:function(){return ty},t1_:function(){return v1},Uk6:function(){return f.Uk6},_sL:function(){return f._sL},Pnf:function(){return f.Pnf},c8b:function(){return f.c8b},_lf:function(){return f._lf},ad5:function(){return f.ad5},sZV:function(){return hw},TfA:function(){return un},sKX:function(){return Bm},UdM:function(){return ii},P0y:function(){return Od},L_r:function(){return f.L_r},Bve:function(){return jg},UeO:function(){return Fl},$nx:function(){return kw},Bk6:function(){return ns},y4l:function(){return Cm},pQ0:function(){return km},wXW:function(){return uC},r5x:function(){return aC},MSI:function(){return pC},EUu:function(){return kI},jtH:function(){return Xd},T0T:function(){return b0},gAb:function(){return rw},iwT:function(){return Cf},je_:function(){return GS},wBP:function(){return hf},LU2:function(){return a0},wQL:function(){return OI},Zs7:function(){return vb},x7s:function(){return MC},Mnd:function(){return NI},A0_:function(){return UI},d73:function(){return fb},HCD:function(){return jn},RG9:function(){return ni},G2P:function(){return Lc},XLf:function(){return Jm},CGN:function(){return wA},mvg:function(){return uv},Hiy:function(){return Bp},XMc:function(){return lC},N7M:function(){return sC},iv:function(){return hC},n55:function(){return Nr},IaC:function(){return yl},h9t:function(){return xA},yDW:function(){return EA},gJv:function(){return ef},l$g:function(){return $C},vQi:function(){return LS},$MY:function(){return Y_},wJl:function(){return Gv},Z7Y:function(){return s0},X7D:function(){return o0},BnX:function(){return Km},uZ5:function(){return Lu},zVI:function(){return iC},DpF:function(){return tp},nNb:function(){return Rc},cqZ:function(){return Gl},pKN:function(){return sb},d_$:function(){return nA},DdI:function(){return nx},rrX:function(){return ob},KlC:function(){return tA},KVn:function(){return on},oau:function(){return bx},aw9:function(){return Gs},Aap:function(){return no},Dxg:function(){return mt},MjT:function(){return _h},F7Q:function(){return yA},IFq:function(){return w1},IJl:function(){return Xm},O5A:function(){return fc},wCn:function(){return Ji},gGT:function(){return AA},pEc:function(){return HE},Bi6:function(){return gd},fi_:function(){return PC},TT:function(){return _T},q2Z:function(){return SI},NyK:function(){return Xi},bgu:function(){return xm},kcS:function(){return Bl},rRN:function(){return Nx},ivY:function(){return Z},_s1:function(){return HI},_HO:function(){return Kt},tpL:function(){return Qt},DMK:function(){return ag},LjN:function(){return F_},iFs:function(){return rl},qTg:function(){return ue},Wtl:function(){return Ln},DmK:function(){return wn},Htt:function(){return YS},Hx7:function(){return mi},imt:function(){return qa},US6:function(){return fv},vZs:function(){return iA},TE$:function(){return FI},lmu:function(){return Jr},SvO:function(){return wo},YQY:function(){return Qd},mZN:function(){return r0},VvG:function(){return bA},omp:function(){return JC},utz:function(){return hv},TFV:function(){return ol},hrz:function(){return Ee},JKM:function(){return _x},jZf:function(){return y1},RjL:function(){return a1},RRI:function(){return CC},RUq:function(){return ZC},_t4:function(){return Dl},YHh:function(){return hc},R8g:function(){return Xt},Bbl:function(){return Ad},V9r:function(){return Ae},PZ2:function(){return ke},w7A:function(){return je},N6S:function(){return pt},Uxp:function(){return Gt},tAz:function(){return xt},R$F:function(){return J},N33:function(){return Ze},gw2:function(){return Lm},KlU:function(){return et},wo6:function(){return vc},H4P:function(){return K},swA:function(){return Dh},_Z3:function(){return Ph},ivc:function(){return Rc},rZ1:function(){return Gl},CpZ:function(){return DC},dyc:function(){return te},MxZ:function(){return IT},btp:function(){return DT},mXy:function(){return kx},Ej0:function(){return Sl},ep4:function(){return Aa},DQP:function(){return Ah},VNr:function(){return hd},V7q:function(){return gc},zEk:function(){return Zr},qfq:function(){return Jo},piB:function(){return st},IIc:function(){return BI},rrF:function(){return No},naq:function(){return bs},sXR:function(){return og},p5I:function(){return y0},wps:function(){return sw},wuo:function(){return x1},GpE:function(){return me},F4b:function(){return qd},t$v:function(){return fa},tdn:function(){return wg},Y9t:function(){return P0},GEo:function(){return $p},DH3:function(){return cC},uxM:function(){return ZE},zH3:function(){return $E},MLs:function(){return Fd},xXG:function(){return ir},YM4:function(){return uf},B3r:function(){return b1},iAx:function(){return p_},lDn:function(){return Le},oaQ:function(){return Ym},CD7:function(){return Nc},Rc0:function(){return ig},iPG:function(){return Yl},TIc:function(){return Dp},xsC:function(){return fC},zOc:function(){return ui},r46:function(){return AC},z2C:function(){return ve},_X$:function(){return _d},_yn:function(){return gi},Dyg:function(){return fu},cUc:function(){return Rp},zGw:function(){return sg},Ctq:function(){return vx},$ch:function(){return jI},k5b:function(){return dv},kZl:function(){return mb},OCg:function(){return yx},YjH:function(){return SC},Ui8:function(){return S1},YD2:function(){return Nu},vi9:function(){return qS},ij3:function(){return oC},YPW:function(){return rC},Bg1:function(){return II},kon:function(){return Ve},M3g:function(){return Zp},F2z:function(){return bl},pJF:function(){return KC},knz:function(){return f.knz},Ejo:function(){return Te},BgY:function(){return Ip},qCG:function(){return Ne},HD9:function(){return yi},fEB:function(){return Qr},Udc:function(){return yo},ZQg:function(){return dd},ofC:function(){return $t},yRy:function(){return Is},_NL:function(){return zg},LCA:function(){return Ao},j1w:function(){return bc},i8J:function(){return qI},p7C:function(){return hr},ZAS:function(){return ml},ipH:function(){return zI},$TF:function(){return KS},uZI:function(){return QI},VWG:function(){return ax},pQ7:function(){return Hh},STw:function(){return Wl},jc8:function(){return Pp},BL_:function(){return cm},S6:function(){return WI},T8U:function(){return Uv},TD6:function(){return Ru},akS:function(){return cx},QKE:function(){return eC},dKx:function(){return Oe},OvX:function(){return HS},VsW:function(){return Ir},YMc:function(){return XS},aPg:function(){return Bi},LFn:function(){return mu},wey:function(){return pa},MaE:function(){return Si},s4x:function(){return Ya},FJA:function(){return Kr},vIA:function(){return Il},Spv:function(){return ci},w8l:function(){return yh},riG:function(){return li},Kbh:function(){return uc},t8K:function(){return An},Q7n:function(){return gn},KGF:function(){return Ko},e5:function(){return ae},Rik:function(){return V_},GZo:function(){return Rm},Bds:function(){return zp},HTu:function(){return Ma},cTq:function(){return mc},X_Y:function(){return Hv},dA8:function(){return Vv},bwS:function(){return gx},Lks:function(){return VI},Rvq:function(){return WS},P4F:function(){return fT},Pd0:function(){return Mo},Pjo:function(){return mx},Tum:function(){return he},dRH:function(){return To},RX0:function(){return $a},reQ:function(){return GI},cWm:function(){return dC},NC9:function(){return JE},$Re:function(){return dw},Xo9:function(){return z_},LNO:function(){return Dm},iZP:function(){return jp}});var Mn,Tt={};__webpackgi_require__.r(Tt),__webpackgi_require__.d(Tt,{AsyncCompress:function(){return se},AsyncDecompress:function(){return en},AsyncDeflate:function(){return U},AsyncGunzip:function(){return Xe},AsyncGzip:function(){return se},AsyncInflate:function(){return W},AsyncUnzipInflate:function(){return Hi},AsyncUnzlib:function(){return dt},AsyncZipDeflate:function(){return Un},AsyncZlib:function(){return Ft},Compress:function(){return ie},DecodeUTF8:function(){return qe},Decompress:function(){return Mt},Deflate:function(){return k},EncodeUTF8:function(){return Se},Gunzip:function(){return De},Gzip:function(){return ie},Inflate:function(){return H},Unzip:function(){return Wg},UnzipInflate:function(){return Gi},UnzipPassThrough:function(){return $n},Unzlib:function(){return rn},Zip:function(){return Qn},ZipDeflate:function(){return ti},ZipPassThrough:function(){return zn},Zlib:function(){return St},compress:function(){return le},compressSync:function(){return Ie},decompress:function(){return In},decompressSync:function(){return hi},deflate:function(){return Q},deflateSync:function(){return F},gunzip:function(){return Ke},gunzipSync:function(){return Be},gzip:function(){return le},gzipSync:function(){return Ie},inflate:function(){return q},inflateSync:function(){return $},strFromU8:function(){return gt},strToU8:function(){return He},unzip:function(){return pn},unzipSync:function(){return gy},unzlib:function(){return At},unzlibSync:function(){return Wt},zip:function(){return Ui},zipSync:function(){return ca},zlib:function(){return Et},zlibSync:function(){return nn}}),function(s){s[s.Error=-2]="Error",s[s.Destroyed=-1]="Destroyed",s[s.None=0]="None",s[s.Running=1]="Running",s[s.Paused=2]="Paused"}(Mn||(Mn={}));class ct{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const n=this._eventListeners;n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}hasEventListener(e,t){const n=this._eventListeners;return n[e]!==void 0&&n[e].includes(t)}removeEventListener(e,t){const n=this._eventListeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}}}var f=__webpackgi_require__(988);const It={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ht{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const Ge=new f.iKG(-1,1,1,-1,0,1),rt=new f.u9r;rt.setAttribute("position",new f.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),rt.setAttribute("uv",new f.a$l([0,2,0,0,2,0],2));class Ue{constructor(e){this._mesh=new f.Kj0(rt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Ge)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class vt extends ht{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof f.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=f.rDY.clone(e.uniforms),this.material=new f.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ue(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class wt extends ht{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),o=e.state;let a,c;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(a=0,c=1):(a=1,c=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),o.buffers.stencil.setClear(c),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(r.EQUAL,1,4294967295),o.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.buffers.stencil.setLocked(!0)}}class Je extends ht{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new f.iKG(-1,1,1,-1,0,1);const Ye=new f.u9r;Ye.setAttribute("position",new f.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Ye.setAttribute("uv",new f.a$l([0,2,0,0,2,0],2));class Qe extends class{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new f.FM8);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new f.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],It===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),vt===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new vt(It),this.clock=new f.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,o=this.passes.length;r<o;r++){const a=this.passes[r];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const c=this.renderer.getContext(),d=this.renderer.state.buffers.stencil;d.setFunc(c.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),d.setFunc(c.EQUAL,1,4294967295)}this.swapBuffers()}wt!==void 0&&(a instanceof wt?n=!0:a instanceof Je&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new f.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}function je(s,e){let t;do t=Object.getOwnPropertyDescriptor(s,e);while(!t&&(s=Object.getPrototypeOf(s)));return t}function me(s,e,t=!1,n=!1){const r=je(s,e);return!!(r!=null&&r.set)||t&&(r==null?void 0:r.writable)!==!1&&(r==null?void 0:r.get)===void 0||n&&!r}function Te(s,e,t,n=!1,r=!1){return!(!s||!me(s,e,n,r)||(s[e]=t,0))}function ue(s,e){for(;s.length>0;){if(!e)return;const t=s.splice(0,1)[0];if(!(t.length<1)){if(!(t in e))return console.error("invalid access, check",t,e),e;e=e[t]}}return e}function Ae(s,e){return Object.keys(s).find(t=>s[t]===e)}function ke(s,...e){return typeof s=="function"&&(s=s(...e)),s}function mt(s,e,t){for(const n of t){const r=s[n];r!==void 0&&Te(e,n,r,!0)}}function Ee(s){return s.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Ve(s,e,t){return s.replace(new RegExp(Ee(e),"g"),t)}const K=(s,...e)=>String.raw({raw:s},...e),Z=(s,...e)=>String.raw({raw:s},...e),te=(s,...e)=>String.raw({raw:s},...e),Oe=(s,...e)=>{let t=String.raw({raw:s},...e);return t=Ve(t,"%","%25"),t=Ve(t,"> <","><"),t=Ve(t,"; }",";}"),t=Ve(t,"<","%3c"),t=Ve(t,">","%3e"),t=Ve(t,'"',"'"),t=Ve(t,"#","%23"),t=Ve(t,"{","%7b"),t=Ve(t,"}","%7d"),t=Ve(t,"|","%7c"),t=Ve(t,"^","%5e"),t=Ve(t,"`","%60"),t=Ve(t,"@","%40"),t=Ve(t,"&","&amp;"),t=Ve(t,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+t};function ve(s){if(!s)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,t)=>{let n=e[t];Object.defineProperty(e,t,{get:()=>n,set(r){var o;if(n===r)return;n=r;const a=[t,r];if(typeof s=="string")(o=this[s])===null||o===void 0||o.call(this,...a);else if(typeof s=="function"){let c=!1;if(s.name){let d=this;for(;d;){if(d[s.name]===s){s.call(this,...a),c=!0;break}d=Object.getPrototypeOf(d)}}c||(s.name&&this[s.name].name===`bound ${s.name}`?this[s.name](...a):s(...a))}}})}}function st(s,e){for(const t of e)if(!s.includes(t))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(s,e){return Object.prototype.toString.call(s).toLowerCase()==="[object regexp]"?this.replace(s,e):this.replace(new RegExp(s,"g"),e)});class qt{constructor(e=0,t=0){qt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*n-a*r+e.x,this.y=o*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vt extends f.ZzF{expandByObject(e,t=!1,n=!1){var r;if(((r=e.userData)===null||r===void 0?void 0:r.bboxVisible)===!1)return this;if(!e.visible&&n)return this;e.updateWorldMatrix(!1,!1);const o=e.geometry;if(o!==void 0)if(t&&o.attributes!=null&&o.attributes.position!==void 0){const c=o.attributes.position;for(let d=0,p=c.count;d<p;d++)Bt.fromBufferAttribute(c,d).applyMatrix4(e.matrixWorld),this.expandByPoint(Bt)}else o.boundingBox===null&&o.computeBoundingBox(),tn.copy(o.boundingBox),tn.applyMatrix4(e.matrixWorld),this.union(tn);const a=e.children;for(let c=0,d=a.length;c<d;c++)this.expandByObject(a[c],t,n);return this}expandByObjects(e,t=!1,n=!1){for(let r=0,o=e.length;r<o;r++)this.expandByObject(e[r],t,n);return this}getPoints(){return[new f.Pa4(this.min.x,this.min.y,this.min.z),new f.Pa4(this.min.x,this.min.y,this.max.z),new f.Pa4(this.min.x,this.max.y,this.min.z),new f.Pa4(this.min.x,this.max.y,this.max.z),new f.Pa4(this.max.x,this.min.y,this.min.z),new f.Pa4(this.max.x,this.min.y,this.max.z),new f.Pa4(this.max.x,this.max.y,this.min.z),new f.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new f.TUj;for(const r of t){const o=r.project(e);n.min.min(o),n.max.max(o)}return n}}const tn=new Vt,Bt=new f.Pa4;function on(s,e){let t,n;if(Array.isArray(s))for(const o of s){const a=on(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}const r=s;if(r.geometry!==void 0){const o=r.geometry.vertices;if(o===void 0&&r.geometry.attributes!==void 0&&"position"in r.geometry.attributes){const a=new f.Pa4,c=r.geometry.attributes.position;for(let d=0;d<c.count*c.itemSize;d+=c.itemSize){a.set(c.array[d],c.array[d+1],c.array[3]);const p=a.applyMatrix4(s.matrixWorld).project(e),m=new qt(p.x,p.y);t===void 0||n===void 0?(t=m.clone(),n=m.clone()):(t.min(m),n.max(m))}}else for(const a of o){const c=a.clone().applyMatrix4(s.matrixWorld).project(e),d=new qt(c.x,c.y);t===void 0||n===void 0?(t=d.clone(),n=d.clone()):(t.min(d),n.max(d))}}if(s.children!==void 0)for(const o of s.children){const a=on(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}return new f.TUj(t,n)}const Yt=3005;function Xt(s){switch(s){case f.rnI:return["Linear","( value )"];case f.knz:return["sRGB","( value )"];case Yt:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",s),["Linear","( value )"]}}function et(s,e){let t;return s&&s.isTexture?t=s.encoding:s&&s.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=s.texture.encoding):t=f.rnI,e&&s&&s.isTexture&&s.format===f.wk1&&s.type===f.ywz&&s.encoding===f.knz&&(t=f.rnI),t}function xt(s,e){const t=Xt(e);return"vec4 "+s+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function pt(s,e,t){return xt(s+"TexelToLinear",et(e,t))+`
`}function Gt(s,e){return xt(s+"TexelToLinear",e)+`
`}function Ze(s,e){const t=Xt(e);return"vec4 "+s+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function J(s,e,t){return Ze(s,et(e,t))}function ae({uniforms:s,propKey:e,thisTarget:t=!1}={}){const n=!!s,r=!!e,o=t;return(a,c)=>{const d=p=>{const m=o?p:n?s:p.uniforms||p._uniforms;let A=r?e:c;o&&(A="_"+A);let x=m[A];return x||(x={value:null},m[A]=x),x};Object.defineProperty(a,c,{get(){return d(this).value},set(p){d(this).value=p,Te(this,"uniformsNeedUpdate",!0,!0)}})}}function Le(s,e,t=!1,n){const r=!!e,o=!!s;return(a,c)=>{const d=p=>({t:r?e:p.defines||p._defines,p:o?s:c});Object.defineProperty(a,c,{get(){const{t:p,p:m}=d(t?this:this.material);return p[m]},set(p){const{t:m,p:A}=d(t?this:this.material);if(Te(m,A,p,!0),typeof n=="function"){const x=[A,p];if(n.name){const E=this[n.name];E===n?n.call(this,...x):E.name===`bound ${n.name}`?E(...x):n(...x)}else n(...x)}else Te(t?this:this.material,"needsUpdate",!0,!0)}})}}function Kt(s){const e=new f.IEO(new Uint8Array([Math.floor(255*s.r),Math.floor(255*s.g),Math.floor(255*s.b),255]),1,1,f.wk1,f.ywz);return e.needsUpdate=!0,e.encoding=f.rnI,e}function Qt(s){const e=new f.IEO(new Uint8Array([Math.floor(255*s.x),Math.floor(255*s.y),Math.floor(255*s.z),Math.floor(255*s.w)]),1,1,f.wk1,f.ywz);return e.needsUpdate=!0,e}function $t(s,e,t){const n=s.userData,{backgroundRender:r,transparentRender:o,shadowMapRender:a,mainRenderPass:c,opaqueRender:d,transmissionRender:p,sceneRender:m,screenSpaceRendering:A}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=r,n.transparentRender=o,n.shadowMapRender=a,n.mainRenderPass=c,n.opaqueRender=d,n.sceneRender=m,n.transmissionRender=p,n.screenSpaceRendering=A}function jn(s){const e=new Vt().expandByObject(s,!0,!0).getCenter(new f.Pa4);s.position.sub(e),s.updateMatrix(),s.userData.autoCentered=!0}function ni(s,e){const t=.5*new Vt().expandByObject(s,!0,!0).getSize(new f.Pa4).length();e===void 0&&(e=s.userData.autoScaleRadius||1);const n=e/t;return isFinite(n)&&(s.userData.pseudoCentered?s.children.forEach(r=>{r.scale.multiplyScalar(n)}):s.scale.multiplyScalar(n)),s.traverse(r=>{var o,a;r.isLight&&(!((a=(o=r.shadow)===null||o===void 0?void 0:o.camera)===null||a===void 0)&&a.right)&&(r.shadow.camera.right*=n,r.shadow.camera.left*=n,r.shadow.camera.top*=n,r.shadow.camera.bottom*=n),r.isCamera&&r.right&&(r.right*=n,r.left*=n,r.top*=n,r.bottom*=n)}),s.userData.autoScaled=!0,s.userData.autoScaleRadius=e,s.dispatchEvent({type:"objectUpdate"}),s}function Bi(s,e=-1){return function(t,n=1e-4){const r=n>0;n=Math.max(n,Number.EPSILON);const o={},a=t.getIndex(),c=t.getAttribute("position"),d=a?a.count:c.count;let p=0;const m=Object.keys(t.attributes),A={},x={},E=[],M=["getX","getY","getZ","getW"];for(let R=0,I=m.length;R<I;R++){const j=m[R];A[j]=[];const z=t.morphAttributes[j];z&&(x[j]=new Array(z.length).fill().map(()=>[]))}const T=Math.log10(1/n),O=Math.pow(10,T);for(let R=0;R<d;R++){const I=a?a.getX(R):R;let j="";for(let z=0,V=m.length;z<V&&r;z++){const G=m[z],X=t.getAttribute(G),ne=X.itemSize;for(let ce=0;ce<ne;ce++)j+=~~(X[M[ce]](I)*O)+","}if(r&&j in o)E.push(o[j]);else{for(let z=0,V=m.length;z<V;z++){const G=m[z],X=t.getAttribute(G),ne=t.morphAttributes[G],ce=X.itemSize,ge=A[G],de=x[G];for(let xe=0;xe<ce;xe++){const pe=M[xe];if(ge.push(X[pe](I)),ne)for(let ye=0,Re=ne.length;ye<Re;ye++)de[ye].push(ne[ye][pe](I))}}r&&(o[j]=p),E.push(p),p++}}const P=t.clone();for(let R=0,I=m.length;R<I;R++){const j=m[R],z=t.getAttribute(j),V=new z.array.constructor(A[j]),G=new f.TlE(V,z.itemSize,z.normalized);if(P.setAttribute(j,G),j in x)for(let X=0;X<x[j].length;X++){const ne=t.morphAttributes[j][X],ce=new ne.array.constructor(x[j][X]),ge=new f.TlE(ce,ne.itemSize,ne.normalized);P.morphAttributes[j][X]=ge}}return P.setIndex(E),P}(s,e)}class pi extends ct{constructor({animationLoop:e,canvas:t,alpha:n=!0,targetOptions:r}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new f.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new f.CP7({canvas:t,antialias:!0,alpha:n,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new f.FM8(t.clientWidth,t.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=f.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=f.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=f._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(r,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new Qe(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,t,n;const r=this._passes,o=[],a={};for(const c of r){if(c.enabled===!1)continue;const d={after:(e=c.after)!==null&&e!==void 0?e:[],before:(t=c.before)!==null&&t!==void 0?t:[],dependencies:new Set((n=c.required)!==null&&n!==void 0?n:[])};a[c.passId]=d}for(const[c,d]of Object.entries(a)){const p=new Set([...d.after,...d.before]);d.dependencies.forEach(m=>p.has(m)&&p.delete(m)),p.forEach(m=>{const A=a[m];if(A){if(A.dependencies.has(c))throw console.error("cyclic",c,m),"Cyclic dependency";d.dependencies.add(m)}})}for(;;){let c=!1;const d=[...Object.entries(a)];for(const[p,m]of d)if(!o.includes(p)&&st(o,m.dependencies.values())){const A=Math.max(-1,...m.after.map(E=>o.indexOf(E))),x=Math.min(o.length,...m.before.map(E=>{const M=o.indexOf(E);return M<0?o.length:M}));if(A>=x)throw console.error(m,r,o,A,x),"Not possible";o.splice(m.after.length>0?A+1:x,0,p),c=!0,delete a[p]}if(Object.keys(a).length<1)break;if(!c)throw console.log(d,a,o),"Not possible 2"}return this.pipeline=o,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,t){const n=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=n,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:n,time:e,renderer:this,xrFrame:t}))}get clock(){return this._composer.clock}registerPass(e,t=!0){var n;if(t)for(const r of[...this._passes])e.passId===r.passId&&this.unregisterPass(r);this._passes.push(e),(n=e.onRegister)===null||n===void 0||n.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var t;const n=this._passes.indexOf(e);n>=0&&((t=e.onUnregister)===null||t===void 0||t.call(e,this),this._passes.splice(n,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,t,n=!1){!n&&(e?Math.abs(e-this._renderSize.width):0)+(t?Math.abs(t-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),t&&(this._renderSize.height=t),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(r=>{const o=r,a=o.sizeMultiplier;if(a){const c=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*a);o.setSize(c.width,c.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,t,{viewport:n,material:r,shader:o,pass:a,clear:c=!0}={}){const d=this._composer.copyPass,{renderToScreen:p,material:m,uniforms:A,clear:x}=d;r&&(d.material=r);const E=this._renderer.getViewport(new f.Ltg),M=this._renderer.autoClear,T=this._renderer.getRenderTarget();n&&this._renderer.setViewport(new f.Ltg().fromArray(n)),this._renderer.autoClear=!1,d.uniforms=d.material.uniforms,d.renderToScreen=!1,d.clear=c,$t(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{d.render(this._renderer,t??null,{texture:e},0,!1)}),d.renderToScreen=p,d.clear=x,d.material=m,d.uniforms=A,this._renderer.autoClear=M,n&&this._renderer.setViewport(E),this._renderer.setRenderTarget(T)}clearColor({r:e,g:t,b:n,a:r,target:o,depth:a=!0,stencil:c=!0}){var d;const p=this._renderer.getClearColor(new f.Ilk),m=this._renderer.getClearAlpha();this._renderer.setClearAlpha(r??m),this._renderer.setClearColor(new f.Ilk(e??p.r,t??p.g,n??p.b));const A=this._renderer.getRenderTarget(),x=this._renderer.getActiveCubeFace(),E=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((d=o)!==null&&d!==void 0?d:null),this._renderer.clear(!0,a,c),this._renderer.setRenderTarget(A,x,E),this._renderer.setClearColor(p),this._renderer.setClearAlpha(m)}renderModel(e,t){this._renderer.render(e.modelObject,t.cameraObject)}renderScene(e){const t=e.activeCamera;t&&this.renderModel(e,t)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&((e=t.update)===null||e===void 0||e.call(t));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const t of this._pipeline){const n=this._passes.find(r=>r.passId===t);n?e.push(n.passObject):console.warn("Unable to find pass: ",t)}[...this._composer.passes].forEach(t=>this._composer.removePass(t)),e.forEach(t=>this._composer.addPass(t)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e,samples:t=0,encoding:n=f.rnI,type:r=f.ywz,format:o=f.wk1,depthBuffer:a=!0,depthTexture:c=!1,size:d,textureCount:p=1,...m}={},A=!0){this.isWebGL2||(t=0),e!==void 0&&d!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),d=d||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const x=c?new f.$YQ(d.width,d.height,f.ywz):void 0,E=this.createTargetCustom(p>1?{width:d.width,height:d.height,count:p}:d,{samples:t,encoding:n,type:r,format:o,depthBuffer:a,depthTexture:x},p>1?f.kFz:f.dd2);return this._processNewTarget(E,e,A),this._setTargetOptions(E,m),E}_processNewTarget(e,t,n){return t!==void 0&&(e.sizeMultiplier=t),n&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:t,count:n},r={},o){var a;const c=this._processNewTarget;let d=[e,t];if(n&&n>1&&d.push(n),(o==null?void 0:o.prototype)===f.oAp.prototype){if(e!==t)throw"Width and height of cube render target must be equal";d=[e]}r={format:f.wk1,minFilter:f.wem,magFilter:f.wem,generateMipmaps:!1,type:f.ywz,encoding:f.rnI,...r};const p=[...d,r];return new class extends((a=o)!==null&&a!==void 0?a:f.dd2){constructor(...m){super(...m),Array.isArray(this.texture)?this.texture.forEach(A=>{A.encoding=r.encoding,A.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(m=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const A=super.clone();return A.texture.isRenderTargetTexture=!0,c(A,this.sizeMultiplier||1,m)}}(...p)}getTempTarget(e={}){var t;const n=Xi(e);let r;return!((t=this._tempTargets[n])===null||t===void 0)&&t.length&&(r=this._tempTargets[n].pop()),r?this._setTargetOptions(r,e):(r=this.createTarget(e),this._processNewTempTarget(r,n)),r}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,this._tempTargets[t]===void 0&&(this._tempTargets[t]=[]),e}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._tempTargets[t].length>this.maxTempPerKey?e.dispose():this._tempTargets[t].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,t){var n,r,o;e.texture.minFilter=(n=t.minFilter)!==null&&n!==void 0?n:f.wem,e.texture.magFilter=(r=t.magFilter)!==null&&r!==void 0?r:f.wem,e.texture.generateMipmaps=(o=t.generateMipmaps)!==null&&o!==void 0&&o,e.texture.generateMipmaps&&e.texture.minFilter===f.wem&&(e.texture.minFilter=f.FDw),e.texture.generateMipmaps||e.texture.minFilter!==f.FDw||(e.texture.minFilter=f.wem)}}function Xi(s={}){var e,t;return[s.sizeMultiplier,s.samples,s.encoding,s.type,s.format,s.depthBuffer,s.depthTexture,(e=s.size)===null||e===void 0?void 0:e.width,(t=s.size)===null||t===void 0?void 0:t.height].join(";")}const fi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function ar(){const s=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(fi[255&s]+fi[s>>8&255]+fi[s>>16&255]+fi[s>>24&255]+"-"+fi[255&e]+fi[e>>8&255]+"-"+fi[e>>16&15|64]+fi[e>>24&255]+"-"+fi[63&t|128]+fi[t>>8&255]+"-"+fi[t>>16&255]+fi[t>>24&255]+fi[255&n]+fi[n>>8&255]+fi[n>>16&255]+fi[n>>24&255]).toLowerCase()}function ki(s,e,t){return Math.max(e,Math.min(t,s))}function Qs(s,e,t){return(1-t)*s+t*e}const fs=0,vr=1,Wi=3,zr=4,Qi=1006,Vs="srgb",Ts="srgb-linear";function Ki(s){return s<.04045?.0773993808*s:Math.pow(.9478672986*s+.0521327014,2.4)}function Yo(s){return s<.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}const lr={[Vs]:{[Ts]:Ki},[Ts]:{[Vs]:Yo}},ms={legacyMode:!0,get workingColorSpace(){return Ts},set workingColorSpace(s){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(s,e,t){if(this.legacyMode||e===t||!e||!t)return s;if(lr[e]&&lr[e][t]!==void 0){const n=lr[e][t];return s.r=n(s.r),s.g=n(s.g),s.b=n(s.b),s}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(s,e){return this.convert(s,this.workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this.workingColorSpace)}},bm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},cr={r:0,g:0,b:0},Xo={h:0,s:0,l:0},ur={h:0,s:0,l:0};function Wa(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+6*(e-s)*t:t<.5?e:t<2/3?s+6*(e-s)*(2/3-t):s}function vh(s,e){return e.r=s.r,e.g=s.g,e.b=s.b,e}class Pi{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ms.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r="srgb-linear"){return this.r=e,this.g=t,this.b=n,ms.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r="srgb-linear"){if(e=function(o,a){return(o%a+a)%a}(e,1),t=ki(t,0,1),n=ki(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o;this.r=Wa(a,o,e+1/3),this.g=Wa(a,o,e),this.b=Wa(a,o,e-1/3)}return ms.toWorkingColorSpace(this,r),this}setStyle(e,t="srgb"){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const a=r[1],c=r[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,ms.toWorkingColorSpace(this,t),n(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,ms.toWorkingColorSpace(this,t),n(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const d=parseFloat(o[1])/360,p=parseFloat(o[2])/100,m=parseFloat(o[3])/100;return n(o[4]),this.setHSL(d,p,m,t)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(a===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,ms.toWorkingColorSpace(this,t),this;if(a===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,ms.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=bm[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ki(e.r),this.g=Ki(e.g),this.b=Ki(e.b),this}copyLinearToSRGB(e){return this.r=Yo(e.r),this.g=Yo(e.g),this.b=Yo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return ms.fromWorkingColorSpace(vh(this,cr),e),ki(255*cr.r,0,255)<<16^ki(255*cr.g,0,255)<<8^ki(255*cr.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){ms.fromWorkingColorSpace(vh(this,cr),t);const n=cr.r,r=cr.g,o=cr.b,a=Math.max(n,r,o),c=Math.min(n,r,o);let d,p;const m=(c+a)/2;if(c===a)d=0,p=0;else{const A=a-c;switch(p=m<=.5?A/(a+c):A/(2-a-c),a){case n:d=(r-o)/A+(r<o?6:0);break;case r:d=(o-n)/A+2;break;case o:d=(n-r)/A+4}d/=6}return e.h=d,e.s=p,e.l=m,e}getRGB(e,t="srgb-linear"){return ms.fromWorkingColorSpace(vh(this,cr),t),e.r=cr.r,e.g=cr.g,e.b=cr.b,e}getStyle(e="srgb"){return ms.fromWorkingColorSpace(vh(this,cr),e),e!==Vs?`color(${e} ${cr.r} ${cr.g} ${cr.b})`:`rgb(${255*cr.r|0},${255*cr.g|0},${255*cr.b|0})`}offsetHSL(e,t,n){return this.getHSL(Xo),Xo.h+=e,Xo.s+=t,Xo.l+=n,this.setHSL(Xo.h,Xo.s,Xo.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Xo),e.getHSL(ur);const n=Qs(Xo.h,ur.h,t),r=Qs(Xo.s,ur.s,t),o=Qs(Xo.l,ur.l,t);return this.setHSL(n,r,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function ir(s,e){const t=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!s[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!t&&s.map,bounds:[-100,100],stepSize:.001,property:[s[e],"repeat"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!t&&s.map,bounds:[-2,2],property:[s[e],"offset"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!t&&s.map,bounds:[-2,2],property:[s[e],"center"],onChange:s==null?void 0:s.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!t&&s.map,bounds:[-Math.PI,Math.PI],property:[s[e],"rotation"],onChange:s==null?void 0:s.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[s[e],"encoding"],children:[["Linear",f.rnI],["sRGB",f.knz]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{const n=s[e];n&&(n.needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var n,r;return(r=(n=s[e])===null||n===void 0?void 0:n.flipY)!==null&&r!==void 0&&r},setValue:n=>{var r;const o=s[e];if(o&&o.flipY!==n)if(o.image&&ImageBitmap&&o.image instanceof ImageBitmap){const a=o,c=o.source.data;createImageBitmap(c,{imageOrientation:"flipY"}).then(d=>{var p;c.close&&c.close(),a.flipY=n,a.source.data=d,a.source.needsUpdate=!0,a.needsUpdate=!0,(p=s==null?void 0:s.setDirty)===null||p===void 0||p.call(s)})}else o.flipY=n,o.needsUpdate=!0,(r=s==null?void 0:s.setDirty)===null||r===void 0||r.call(s)}}),()=>({type:"dropdown",label:"Wrap S",property:[s[e],"wrapS"],children:[["ClampToEdge",f.uWy],["MirroredRepeat",f.OoA],["Repeat",f.rpg]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[s[e],"wrapT"],children:[["ClampToEdge",f.uWy],["MirroredRepeat",f.OoA],["Repeat",f.rpg]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[s[e],"anisotropy"],onChange:[()=>{s[e]&&(s[e].needsUpdate=!0),s.needsUpdate=!0},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[s[e],"minFilter"],children:[["Linear",Qi],["Nearest",f.TyD],["NearestMipmapNearest",f.YLQ],["NearestMipmapLinear",f.vZf],["LinearMipmapNearest",f.qyh],["LinearMipmapLinear",f.D1R]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[s[e],"magFilter"],children:[["Linear",Qi],["Nearest",f.TyD]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]})]}}Pi.NAMES=bm;const Aa=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Gs(s,e){if(e)for(const t of Object.keys(e))Aa.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}const hd=["appliedMaterials","uuid"];function _h(s,e){if(e)for(const t of Object.keys(e))hd.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}const du=new Map;function Ne(s){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");du.has(n)||du.set(n,[]),du.get(n).push([s||t,t])}}const Qr={obj:(s,e)=>Object.fromEntries(Object.entries(s).map(([t,n])=>[t,yi(n,!1,e)])),vec4:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isVector4:!0}),vec3:s=>({x:s.x,y:s.y,z:s.z,isVector3:!0}),vec2:s=>({x:s.x,y:s.y,isVector2:!0}),color:s=>({r:s.r,g:s.g,b:s.b,isColor:!0}),quat:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isQuaternion:!0}),texture:(s,e)=>{if(!(s!=null&&s.isTexture))throw new Error("Expected a texture");if(s.isRenderTargetTexture)return;if(e!=null&&e.textures[s.uuid])return{uuid:s.uuid,resource:"textures"};const t=s.source.data;s.userData.rootPath&&(s.source.data=null);const n=s.userData;s.userData={};let r=s.toJSON(e);return s.userData=n,r.userData=yi(_h({},n),!1,e),s.userData.rootPath&&(delete e.images[s.source.uuid],s.source.data=t),e!=null&&e.textures&&(e.textures[r.uuid]||(e.textures[r.uuid]=r),r={uuid:r.uuid,resource:"textures"}),r},material:(s,e)=>{var t;if(!(s!=null&&s.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[s.uuid])return{uuid:s.uuid,resource:"materials"};s.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const n=e??{textures:{},images:{}},r={},o={};for(const[c,d]of Object.entries(s))if(!((t=d)===null||t===void 0)&&t.isTexture&&!c.startsWith("__")){const p=Qr.texture(d,n);r[c]=p,o[c]=d,s[c]=p?{isTexture:!0,toJSON:()=>p}:null}let a=s.toJSON(e);for(const[c,d]of Object.entries(o))s[c]=d,delete o[c];if(e){for(const[c,d]of Object.entries(r))d&&(a[c]=d);e!=null&&e.materials&&(e.materials[a.uuid]||(e.materials[a.uuid]=a),a={uuid:a.uuid,resource:"materials"})}else{for(const[c,d]of Object.entries(r))a[c]=d.uuid;a.textures=Object.values(n.textures),a.images=Object.values(n.images)}return a}},ya=s=>(e,t)=>{var n,r;return(r=(n=t==null?void 0:t.copy)===null||n===void 0?void 0:n.call(t,e))!==null&&r!==void 0?r:new s().copy(e)},qa={obj:(s,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(s).map(([n,r])=>[n,mi(r,e==null?void 0:e[n],!1,t)]))),vec4:ya(f.Ltg),vec3:ya(f.Pa4),vec2:ya(qt),color:ya(Pi),quat:ya(f._fP)};function yi(s,e,t){var n,r;if(typeof s=="function")return;if(Array.isArray(s))return s.map(c=>yi(c,!1,t));if(typeof s!="object"){if(typeof s=="number"){if(s===1/0)return"Infinity";if(s===-1/0)return"-Infinity";if(isNaN(s))return"NaN"}return s}if(!s)return s;let o=(n=s.constructor)!==null&&n!==void 0?n:Object;if(o===Object)return Qr.obj(s,t);if(s.isVector2)return Qr.vec2(s);if(s.isVector3)return Qr.vec3(s);if(s.isVector4)return Qr.vec4(s);if(s.isColor)return Qr.color(s);if(s.isQuaternion)return Qr.quat(s);if(s.isTexture)return Qr.texture(s,t);if(s.isMaterial)return Qr.material(s,t);if(!e&&typeof s.toJSON=="function")return s.toJSON(t);const a={};for(;o&&o!==Object;)(r=du.get(o))===null||r===void 0||r.forEach(([c,d])=>{const p=s[d];a[c]=yi(p,!1,t)}),o=Object.getPrototypeOf(o);return s.serializableClassId&&(a.serializableClassId=s.serializableClassId),a}function mi(s,e,t,n){var r,o,a;let c=e;if(s===void 0)return c;if(typeof e=="number"){if(s==="Infinity")return 1/0;if(s==="-Infinity")return-1/0;if(s==="NaN")return NaN;if(typeof s=="number"||!s)return s}if(Array.isArray(s)){const m=s.length;Array.isArray(c)||(c=[]);for(let A=0;A<m;A++){const x=s[A],E=c.length>A?mi(x,c[A],!1,n):mi(x,void 0,!1,n);c.length<=A?c.push(E):c[A]=E}return c}let d=!1;if(s&&s.resource&&typeof s.resource=="string"&&(s=(r=n[s.resource])===null||r===void 0?void 0:r[s.uuid],d=!0),!c&&s&&!d)if(s.serializableClassId){const m=Tp.get(s.serializableClassId);m&&(c=new m)}else typeof s!="object"||s.constructor&&s.constructor!==Object||(c={});if(typeof c=="function")return console.error("cannot deserialize over function",c,s),c;if(s&&typeof s=="object"&&!d){if(s.isVector2)return qa.vec2(s,c);if(s.isVector3)return qa.vec3(s,c);if(s.isVector4)return qa.vec4(s,c);if(s.isColor)return qa.color(s,c);if(s.isQuaternion)return qa.quat(s,c)}if(s==null||c==null||typeof c!="object"||c.isTexture)return d&&(s?s.__useCount=s.__useCount?s.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),s;let p=(o=c.constructor)!==null&&o!==void 0?o:Object;if(p===Object)return qa.obj(s,c,n);if(!t&&typeof c.fromJSON=="function")return c.isMaterial&&(Object.entries(s).forEach(([m,A])=>{var x;if(!A||!A.resource||typeof A.resource!="string")return;const E=(x=n[A.resource])===null||x===void 0?void 0:x[A.uuid];s[m]=E||null}),s.userData&&(s.userData=mi(s.userData,void 0,!1,n))),c.fromJSON(s,n),c;for(;p&&p!==Object;)(a=du.get(p))===null||a===void 0||a.forEach(([m,A])=>{const x=c[A],E=mi(s[m],x,!1,n);E!==x&&Te(c,A,E,!0)}),p=Object.getPrototypeOf(p);return c}const Tp=new Map;function Ip(s){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=s}},Tp.set(s,e),e)}function Hs(s,e){if(s.uiConfig)return s.uiConfig;const t={type:"folder",label:s.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[s,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{s.dispatchEvent({type:"select",ui:!0,value:s,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!s.parent,value:()=>{const r=s.parent;r&&r.dispatchEvent({type:"select",ui:!0,value:r})}},{type:"input",label:"Name",property:[s,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!s.isMesh,property:[s,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!s.isMesh,property:[s,"receiveShadow"]},{type:"vec3",label:"Position",property:[s,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[s,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[s,"scale"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",s.userData.autoScaleRadius||"2",!0],value:r=>{if(!r)return;const o=parseFloat(r);Math.abs(o)>0&&ni(s,o)}},s.userData.license!==void 0?{type:"input",label:"License/Credits",property:[s.userData,"license"],limitedUi:!0}:{}]},n=s;if(n!=null&&n.isMesh&&e!==!1){const r=[()=>{var o;return(o=n.geometry)===null||o===void 0?void 0:o.uiConfig},()=>{var o;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(a=>a==null?void 0:a.uiConfig).filter(a=>a)}:(o=n.material)===null||o===void 0?void 0:o.uiConfig}];t.children.push(...r)}if(s!=null&&s.isCamera){const r=[{type:"button",label:"Set View",value:()=>{s.dispatchEvent({type:"setView",ui:!0,camera:s})}},{type:"button",label:"Activate main",hidden:()=>{var o;return(o=s.userData.iCamera)===null||o===void 0?void 0:o.isActiveCamera},value:()=>{s.dispatchEvent({type:"activateMain",ui:!0,camera:s})}},{type:"button",label:"Deactivate main",hidden:()=>{var o;return!(!((o=s.userData.iCamera)===null||o===void 0)&&o.isActiveCamera)},value:()=>{s.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];t.children.push(...r)}return s.uiConfig=t,t}function Ao(s,e,t){var n;if(!s)return void console.warn("setupIModel: object is undefined");if(s.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",s),delete s.__disposed),s.userData||(s.userData={}),s.userData.__iModelSetup&&s.modelObject)return s;s.userData.__iModelSetup=!0;let r=[];r.push(()=>{[...s.children].forEach(M=>{var T;(T=M==null?void 0:M.dispose)===null||T===void 0||T.call(M)}),s.children=[],s.parent&&s.removeFromParent()}),s.isLight&&!s.assetType?(s.assetType="light",s.lightObject=s):s.isCamera?(s.assetType="camera",s.cameraObject=s):s.assetType||(s.assetType="model"),s.modelObject||(s.modelObject=s),s.setDirty||(s.setDirty=(M={})=>{s.dispatchEvent({...M,type:"objectUpdate",object:s})},s.userData.setDirty&&console.warn("userData.setDirty already defined",s.userData.setDirty,s),s.userData.setDirty=M=>{var T;console.warn("userData.setDirty is deprecated, use setDirty directly"),(T=s.setDirty)===null||T===void 0||T.call(s,M)});const o=M=>{var T,O,P;const R=(O=(T=s.parent)===null||T===void 0?void 0:T.userData.parentRoot)!==null&&O!==void 0?O:s.parent;R!==s.userData.parentRoot&&s.traverse(I=>{I.userData.parentRoot=R}),(P=s.setDirty)===null||P===void 0||P.call(s,{change:"addedToParent"})},a=()=>{var M;(M=s.setDirty)===null||M===void 0||M.call(s,{change:"removedFromParent"}),s.userData.parentRoot!==void 0&&s.traverse(T=>{T.userData.parentRoot=void 0})};s.addEventListener("added",o),s.addEventListener("removed",a),r.push(()=>{s.removeEventListener("added",o),s.removeEventListener("removed",a)});const c=s.dispose;s.dispose=()=>{s.dispatchEvent({type:"dispose"}),c==null||c.call(s)},s.userData.dispose&&console.warn("userData.dispose already defined"),s.userData.dispose=()=>{var M;console.warn("userData.dispose is deprecated, use dispose directly"),(M=s.dispose)===null||M===void 0||M.call(s)};const d=s;!d.isMesh&&!d.isLine||d.userData.__meshSetup||(d.userData.__meshSetup=!0,d.setMaterial||(d.setMaterial=M=>dd(d,M)),d.setGeometry||(d.setGeometry=(M,T=!1)=>yo(d,M,T),d.setGeometry(d.geometry,!0)),s.userData.setMaterial&&console.warn("userData.setMaterial already defined"),s.userData.setMaterial=M=>{var T;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(T=s.setMaterial)===null||T===void 0||T.call(s,M)},s.userData.setGeometry&&console.warn("userData.setGeometry already defined"),s.userData.setGeometry=(M,...T)=>{var O;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(O=s.setGeometry)===null||O===void 0||O.call(s,M,...T)},s.userData.__keepShadowDef||(s.castShadow=!0,s.receiveShadow=!0,s.userData.__keepShadowDef=!0),r.push(()=>{var M,T;const O=((M=d.setMaterial)===null||M===void 0?void 0:M.call(d,void 0))||[],P=(T=d.setGeometry)===null||T===void 0?void 0:T.call(d,void 0);for(const R of O)R&&R.userData.__appliedMeshes.size===0&&R.userData.disposeOnIdle!==!1&&R.dispose();P&&P.userData.__appliedMeshes.size===0&&P.userData.disposeOnIdle!==!1&&P.dispose()})),s.uiConfig||s.assetType!=="model"&&s.assetType!=="camera"||(Hs(s),r.push(()=>{s.uiConfig=void 0}));const p=()=>{var M,T;return(T=(M=s.uiConfig)===null||M===void 0?void 0:M.uiRefresh)===null||T===void 0?void 0:T.call(M,"postFrame",!0,1)};s.addEventListener("objectUpdate",p),r.push(()=>s.removeEventListener("objectUpdate",p)),s.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(s.userData.__autoParentDispatchEvents=s.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],s.isCamera&&s.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(s.userData.parentRoot=e),r.push(()=>{delete s.userData.parentRoot});const m=s.dispatchEvent;s.dispatchEvent=M=>{var T;!((T=s.userData.__autoParentDispatchEvents)===null||T===void 0)&&T.includes(M.type)&&(M.parentDispatch=!0),M.parentDispatch&&(O=>{var P;const R=(P=s.userData.parentRoot)!==null&&P!==void 0?P:s.parent;R!=null&&R.modelObject&&R.dispatchEvent(O)})(M),m.call(s,M)},r.push(()=>{s.dispatchEvent=m});const A=s.clone;s.clone=(...M)=>{const T=s.userData;s.userData={};let O=A.call(s,...M);s.userData=T,no(O.userData,T);const P=s.userData.parentRoot;return P&&P.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),O=Ao(O,P,t),O.userData.cloneParent=s.uuid,O},r.push(()=>{s.clone=A});const x=s.copy;s.copy=(M,...T)=>{const O=M.userData;M.userData={};const P=x.call(s,M,...T);return M.userData=O,no(s.userData,M),P},r.push(()=>{s.copy=x});const E=s.add;return s.add=(...M)=>(M.forEach(T=>Ao(T,s.userData.parentRoot||s,t)),E.call(s,...M)),r.push(()=>{s.add=E}),s=(n=t==null?void 0:t(s))!==null&&n!==void 0?n:s,r.push(()=>{Te(s,"modelObject",void 0,!0),s.userData={}}),s.addEventListener("dispose",()=>{s.__disposed?console.warn("Object already disposed",s):(s.__disposed=!0,r.forEach(M=>M()),r=[])}),[...s.children].forEach(M=>Ao(M,s,t)),s}function dd(s,e){var t,n,r,o,a;const c=(Array.isArray(e)?e:[e]).map(m=>m==null?void 0:m.materialObject).filter(m=>m);if(s.material==c||c.length===1&&s.material===c[0])return[];s.userData.__materialUpdater||(s.userData.__materialUpdater=()=>{s.dispatchEvent({type:"materialUpdate"})});const d=Array.isArray(s.material)?[...s.material]:[s.material];for(const m of d)m&&(m.removeEventListener("materialUpdate",s.userData.__materialUpdater),(n=(t=m.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||n===void 0||n.delete(s));const p=[];for(const m of c)m.userData.__appliedMeshes||(m.userData.__appliedMeshes=new Set),p.push(m),m&&(m.addEventListener("materialUpdate",s.userData.__materialUpdater),m.userData.__appliedMeshes.add(s));return s.material=p.length!==1?p:(r=p[0])!==null&&r!==void 0?r:void 0,s.traverseAncestors(m=>{m.isRootScene&&m.refreshEnvMapIntensity(s)}),s.dispatchEvent({type:"materialChanged",material:e}),(a=(o=s.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||a===void 0||a.call(o,"postFrame",!0),d}function yo(s,e,t=!1){var n,r,o,a,c,d,p;s.userData.__objectUpdater||(s.userData.__objectUpdater=x=>{s.dispatchEvent({...x,type:"objectUpdate"})});let m=s.geometry;const A=m;return(m!==e||t)&&(m&&(m.removeEventListener("geometryUpdate",s.userData.__objectUpdater),(r=(n=m.userData)===null||n===void 0?void 0:n.__appliedMeshes)===null||r===void 0||r.delete(s)),m=e,m&&!m.userData.__appliedMeshes&&(m.userData.__appliedMeshes=new Set),s.geometry=(o=m)!==null&&o!==void 0?o:void 0,m&&(m.addEventListener("geometryUpdate",s.userData.__objectUpdater),(c=(a=m.userData)===null||a===void 0?void 0:a.__appliedMeshes)===null||c===void 0||c.add(s))),e&&!e.uiConfig&&(e.uiConfig=function(x){return{label:"Geometry",type:"folder",children:[{type:"input",property:[x,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{x.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||x.setAttribute("uv2",x.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var E,M,T;return(T=(M=(E=x.userData)===null||E===void 0?void 0:E.__appliedMeshes)===null||M===void 0?void 0:M.size)!==null&&T!==void 0?T:0},set value(E){},disabled:!0}]}}(s.geometry)),s.dispatchEvent({type:"geometryChanged",geometry:e}),(p=(d=s.uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||p===void 0||p.call(d,"postFrame",!0),A===m?void 0:A||void 0}const Sl=["appliedMeshes"],Ah=["parentRoot","iCamera","iModel"];function no(s,e){if(e)for(const t of Object.keys(e))Ah.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}var pd,wm=new Uint8Array(16);function Ml(){if(!pd&&!(pd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pd(wm)}for(var io=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Tl=function(s){return typeof s=="string"&&io.test(s)},Oi=[],bo=0;bo<256;++bo)Oi.push((bo+256).toString(16).substr(1));var gs=function(s,e,t){var n=(s=s||{}).random||(s.rng||Ml)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var r=0;r<16;++r)e[t+r]=n[r];return e}return function(o){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=(Oi[o[a+0]]+Oi[o[a+1]]+Oi[o[a+2]]+Oi[o[a+3]]+"-"+Oi[o[a+4]]+Oi[o[a+5]]+"-"+Oi[o[a+6]]+Oi[o[a+7]]+"-"+Oi[o[a+8]]+Oi[o[a+9]]+"-"+Oi[o[a+10]]+Oi[o[a+11]]+Oi[o[a+12]]+Oi[o[a+13]]+Oi[o[a+14]]+Oi[o[a+15]]).toLowerCase();if(!Tl(c))throw TypeError("Stringified UUID is invalid");return c}(n)};const pu=new Map;function Kr(s,e){return(t,n)=>{const r=t.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");pu.has(r)||pu.set(r,[]);const o=pu.get(r);if(!(o.findIndex(a=>a.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);o.push({params:e||{},propKey:n,uiType:s})}}function gn(s,e){return Kr("checkbox",{label:s,params:e})}function uc(s,e){return Kr("monitor",{label:s,params:e})}function An(s,e,t,n){return Kr("slider",{label:s,bounds:e,stepSize:t,params:n})}function Ko(s,e,t,n){return Kr("vec",{label:s,bounds:e,stepSize:t,params:n})}function Il(s,e,t){return Kr("dropdown",{label:s,children:e,params:t})}function Si(s,e){return Kr("button",{label:s,params:e})}function li(s,e){return Kr("input",{label:s,params:e})}function Ya(s,e){return Kr("color",{label:s,params:e})}function yh(s,e){return Kr("image",{label:s,params:e})}function Dl(s){let e=s==null?void 0:s.constructor;if(!s||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);return n.reverse().forEach(r=>{var o;(o=pu.get(r))===null||o===void 0||o.forEach(({params:a,propKey:c,uiType:d})=>{var p;let m;if(d||(m=(p=s[c])===null||p===void 0?void 0:p.uiConfig),m||(m={property:[s,c],type:d||"input"}),a){const A=typeof a.params=="function"?a.params(s):a.params||{};delete a.params,Object.assign(m,{...a,...A})}t.push(m)})}),t}function hc(s,e,t={}){return{type:"folder",label:s,children:Dl(e),uuid:gs(),...t}}function ci(s,e){return t=>class extends t{constructor(){super(...arguments),this.uiConfig=hc(s,this,e||{})}}}const fd={type:"change"},dc={type:"start"},Pl={type:"end"};class Rl extends f.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new f.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:f.RsA.ROTATE,MIDDLE:f.RsA.DOLLY,RIGHT:f.RsA.PAN},this.touches={ONE:f.QmN.ROTATE,TWO:f.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(lt){lt.addEventListener("keydown",Yn),this._domElementKeyEvents=lt},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(fd),n.update(),o=r.NONE},this.update=function(){const lt=new f.Pa4,jt=new f._fP().setFromUnitVectors(e.up,new f.Pa4(0,1,0)),zt=jt.clone().invert(),Kn=new f.Pa4,Fi=new f._fP,re=2*Math.PI;return function(){const Pe=n.object.position;lt.copy(Pe).sub(n.target),lt.applyQuaternion(jt),c.setFromVector3(lt),n.autoRotate&&o===r.NONE&&X(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=d.theta*n.dampingFactor,c.phi+=d.phi*n.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi);let oe=n.minAzimuthAngle,ze=n.maxAzimuthAngle;isFinite(oe)&&isFinite(ze)&&(oe<-Math.PI?oe+=re:oe>Math.PI&&(oe-=re),ze<-Math.PI?ze+=re:ze>Math.PI&&(ze-=re),c.theta=oe<=ze?Math.max(oe,Math.min(ze,c.theta)):c.theta>(oe+ze)/2?Math.max(oe,c.theta):Math.min(ze,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),Math.abs(d.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+d.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(d.radius=0)),c.radius*=1+d.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(p-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*p)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(p=1)),c.radius*=p);let $e=0;n.autoPushTarget&&c.radius<n.minDistance&&($e=n.minDistance-c.radius),c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),n.enableDamping===!0?n.target.addScaledVector(m,n.dampingFactor):n.target.add(m),lt.setFromSpherical(c),lt.applyQuaternion(zt),Pe.copy(n.target).add(lt),n.target.add(lt.normalize().multiplyScalar(-$e)),n.object.lookAt(n.target);let Fe=!1;return n.enableDamping===!0&&Math.abs(d.theta)+Math.abs(d.phi)+Math.abs(d.radius)+m.length()>.001?(d.theta*=1-n.dampingFactor,d.phi*=1-n.dampingFactor,d.radius*=1-n.dampingFactor,m.multiplyScalar(1-n.dampingFactor),Fe=!0):(d.set(0,0,0),m.set(0,0,0)),p=1,!!(A||Fe||Kn.distanceToSquared(n.object.position)>a||8*(1-Fi.dot(n.object.quaternion))>a)&&(n.dispatchEvent(fd),Kn.copy(n.object.position),Fi.copy(n.object.quaternion),A=!1,!0)}}(),this.stopDamping=function(){d.set(0,0,0),m.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",ai),n.domElement.removeEventListener("pointerdown",Nt),n.domElement.removeEventListener("pointercancel",yn),n.domElement.removeEventListener("wheel",yt),n.domElement.removeEventListener("pointermove",Ut),n.domElement.removeEventListener("pointerup",Ht),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Yn)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const a=1e-6,c=new f.$V,d=new f.$V(0,0,0);let p=1;const m=new f.Pa4;let A=!1;const x=new f.FM8,E=new f.FM8,M=new f.FM8,T=new f.FM8,O=new f.FM8,P=new f.FM8,R=new f.FM8,I=new f.FM8,j=new f.FM8,z=[],V={};function G(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function X(lt){d.theta-=lt}function ne(lt){d.phi-=lt}this.rotateUp=ne,this.rotateLeft=X;const ce=function(){const lt=new f.Pa4;return function(jt,zt){lt.setFromMatrixColumn(zt,0),lt.multiplyScalar(-jt),m.add(lt)}}(),ge=function(){const lt=new f.Pa4;return function(jt,zt){n.screenSpacePanning===!0?lt.setFromMatrixColumn(zt,1):(lt.setFromMatrixColumn(zt,0),lt.crossVectors(n.object.up,lt)),lt.multiplyScalar(jt),m.add(lt)}}(),de=function(){const lt=new f.Pa4;return function(jt,zt){const Kn=n.domElement;if(n.object.isPerspectiveCamera){const Fi=n.object.position;lt.copy(Fi).sub(n.target);let re=lt.length();re*=Math.tan(n.object.fov/2*Math.PI/180),ce(2*jt*re/Kn.clientHeight,n.object.matrix),ge(2*zt*re/Kn.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(ce(jt*(n.object.right-n.object.left)/n.object.zoom/Kn.clientWidth,n.object.matrix),ge(zt*(n.object.top-n.object.bottom)/n.object.zoom/Kn.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function xe(lt,jt=0){n.object.isPerspectiveCamera?(p/=lt,d.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,d.radius-jt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*lt)),n.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function pe(lt,jt=0){n.object.isPerspectiveCamera?(p*=lt,d.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,d.radius+jt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/lt)),n.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ye(lt){x.set(lt.clientX,lt.clientY)}function Re(lt){T.set(lt.clientX,lt.clientY)}function we(){if(z.length===1)x.set(z[0].pageX,z[0].pageY);else{const lt=.5*(z[0].pageX+z[1].pageX),jt=.5*(z[0].pageY+z[1].pageY);x.set(lt,jt)}}function We(){if(z.length===1)T.set(z[0].pageX,z[0].pageY);else{const lt=.5*(z[0].pageX+z[1].pageX),jt=.5*(z[0].pageY+z[1].pageY);T.set(lt,jt)}}function ot(){const lt=z[0].pageX-z[1].pageX,jt=z[0].pageY-z[1].pageY,zt=Math.sqrt(lt*lt+jt*jt);R.set(0,zt)}function ft(lt){if(z.length==1)E.set(lt.pageX,lt.pageY);else{const zt=zi(lt),Kn=.5*(lt.pageX+zt.x),Fi=.5*(lt.pageY+zt.y);E.set(Kn,Fi)}M.subVectors(E,x).multiplyScalar(n.rotateSpeed);const jt=n.domElement;X(2*Math.PI*M.x/jt.clientHeight),ne(2*Math.PI*M.y/jt.clientHeight),x.copy(E)}function nt(lt){if(z.length===1)O.set(lt.pageX,lt.pageY);else{const jt=zi(lt),zt=.5*(lt.pageX+jt.x),Kn=.5*(lt.pageY+jt.y);O.set(zt,Kn)}P.subVectors(O,T).multiplyScalar(n.panSpeed),de(P.x,P.y),T.copy(O)}function Rt(lt){const jt=zi(lt),zt=lt.pageX-jt.x,Kn=lt.pageY-jt.y,Fi=Math.sqrt(zt*zt+Kn*Kn);I.set(0,Fi),j.set(0,Math.pow(I.y/R.y,n.zoomSpeed)),xe(j.y),R.copy(I)}function Nt(lt){n.enabled!==!1&&(z.length===0&&(n.domElement.setPointerCapture(lt.pointerId),n.domElement.addEventListener("pointermove",Ut),n.domElement.addEventListener("pointerup",Ht)),function(jt){z.push(jt)}(lt),lt.pointerType==="touch"?function(jt){switch(Ci(jt),z.length){case 1:switch(n.touches.ONE){case f.QmN.ROTATE:if(n.enableRotate===!1)return;we(),o=r.TOUCH_ROTATE;break;case f.QmN.PAN:if(n.enablePan===!1)return;We(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(n.touches.TWO){case f.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&ot(),n.enablePan&&We(),o=r.TOUCH_DOLLY_PAN;break;case f.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&ot(),n.enableRotate&&we(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(dc)}(lt):function(jt){let zt;switch(jt.button){case 0:zt=n.mouseButtons.LEFT;break;case 1:zt=n.mouseButtons.MIDDLE;break;case 2:zt=n.mouseButtons.RIGHT;break;default:zt=-1}switch(zt){case f.RsA.DOLLY:if(n.enableZoom===!1)return;(function(Kn){R.set(Kn.clientX,Kn.clientY)})(jt),o=r.DOLLY;break;case f.RsA.ROTATE:if(jt.ctrlKey||jt.metaKey||jt.shiftKey){if(n.enablePan===!1)return;Re(jt),o=r.PAN}else{if(n.enableRotate===!1)return;ye(jt),o=r.ROTATE}break;case f.RsA.PAN:if(jt.ctrlKey||jt.metaKey||jt.shiftKey){if(n.enableRotate===!1)return;ye(jt),o=r.ROTATE}else{if(n.enablePan===!1)return;Re(jt),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(dc)}(lt))}function Ut(lt){n.enabled!==!1&&(lt.pointerType==="touch"?function(jt){switch(Ci(jt),o){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;ft(jt),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;nt(jt),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(zt){n.enableZoom&&Rt(zt),n.enablePan&&nt(zt)})(jt),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(zt){n.enableZoom&&Rt(zt),n.enableRotate&&ft(zt)})(jt),n.update();break;default:o=r.NONE}}(lt):function(jt){switch(o){case r.ROTATE:if(n.enableRotate===!1)return;(function(zt){E.set(zt.clientX,zt.clientY),M.subVectors(E,x).multiplyScalar(n.rotateSpeed);const Kn=n.domElement;X(2*Math.PI*M.x/Kn.clientHeight),ne(2*Math.PI*M.y/Kn.clientHeight),x.copy(E),n.update()})(jt);break;case r.DOLLY:if(n.enableZoom===!1)return;(function(zt){I.set(zt.clientX,zt.clientY),j.subVectors(I,R),j.y>0?xe(G()):j.y<0&&pe(G()),R.copy(I),n.update()})(jt);break;case r.PAN:if(n.enablePan===!1)return;(function(zt){O.set(zt.clientX,zt.clientY),P.subVectors(O,T).multiplyScalar(n.panSpeed),de(P.x,P.y),T.copy(O),n.update()})(jt)}}(lt))}function Ht(lt){Xn(lt),z.length===0&&(n.domElement.releasePointerCapture(lt.pointerId),n.domElement.removeEventListener("pointermove",Ut),n.domElement.removeEventListener("pointerup",Ht)),n.dispatchEvent(Pl),o=r.NONE}function yn(lt){Xn(lt)}function yt(lt){n.enabled!==!1&&n.enableZoom!==!1&&o===r.NONE&&(lt.preventDefault(),n.dispatchEvent(dc),function(jt){let zt=0;switch(jt.deltaMode){case 2:zt+=1*jt.deltaY;break;case 1:zt+=.4*jt.deltaY;break;default:zt+=.01*jt.deltaY}jt.deltaY<0?pe(1,zt*n.zoomSpeed):jt.deltaY>0&&xe(1,-zt*n.zoomSpeed),n.update()}(lt),n.dispatchEvent(Pl))}function Yn(lt){n.enabled!==!1&&n.enablePan!==!1&&function(jt){let zt=!1;switch(jt.code){case n.keys.UP:de(0,n.keyPanSpeed),zt=!0;break;case n.keys.BOTTOM:de(0,-n.keyPanSpeed),zt=!0;break;case n.keys.LEFT:de(n.keyPanSpeed,0),zt=!0;break;case n.keys.RIGHT:de(-n.keyPanSpeed,0),zt=!0}zt&&(jt.preventDefault(),n.update())}(lt)}function ai(lt){n.enabled!==!1&&lt.preventDefault()}function Xn(lt){delete V[lt.pointerId];for(let jt=0;jt<z.length;jt++)if(z[jt].pointerId==lt.pointerId)return void z.splice(jt,1)}function Ci(lt){let jt=V[lt.pointerId];jt===void 0&&(jt=new f.FM8,V[lt.pointerId]=jt),jt.set(lt.pageX,lt.pageY)}function zi(lt){const jt=lt.pointerId===z[0].pointerId?z[1]:z[0];return V[jt.pointerId]}this.zoomIn=function(lt){xe(1,lt*n.zoomSpeed)},this.zoomOut=function(lt){pe(1,lt*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",ai),n.domElement.addEventListener("pointerdown",Nt),n.domElement.addEventListener("pointercancel",yn),n.domElement.addEventListener("wheel",yt,{passive:!1}),this.update()}}var Li=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Mi=class extends Rl{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(s){super.zoomIn(s)}zoomOut(s){super.zoomOut(s)}dispatchEvent(s){super.dispatchEvent(s)}};Li([Ne()],Mi.prototype,"type",void 0),Li([gn()],Mi.prototype,"enabled",void 0),Li([gn(),Ne()],Mi.prototype,"dollyZoom",void 0),Li([gn(),Ne()],Mi.prototype,"enableDamping",void 0),Li([li(),Ne()],Mi.prototype,"dampingFactor",void 0),Li([gn(),Ne()],Mi.prototype,"autoRotate",void 0),Li([li(),Ne()],Mi.prototype,"autoRotateSpeed",void 0),Li([gn(),Ne()],Mi.prototype,"enableZoom",void 0),Li([li(),Ne()],Mi.prototype,"zoomSpeed",void 0),Li([li(),Ne()],Mi.prototype,"maxZoomSpeed",void 0),Li([gn(),Ne()],Mi.prototype,"enableRotate",void 0),Li([li(),Ne()],Mi.prototype,"rotateSpeed",void 0),Li([gn(),Ne()],Mi.prototype,"enablePan",void 0),Li([li(),Ne()],Mi.prototype,"panSpeed",void 0),Li([li(),Ne()],Mi.prototype,"autoPushTarget",void 0),Li([li(),Ne()],Mi.prototype,"minDistance",void 0),Li([li(),Ne()],Mi.prototype,"maxDistance",void 0),Li([li(),Ne()],Mi.prototype,"minZoom",void 0),Li([li(),Ne()],Mi.prototype,"maxZoom",void 0),Li([li(),Ne()],Mi.prototype,"minPolarAngle",void 0),Li([li(),Ne()],Mi.prototype,"maxPolarAngle",void 0),Li([li(),Ne()],Mi.prototype,"minAzimuthAngle",void 0),Li([li(),Ne()],Mi.prototype,"maxAzimuthAngle",void 0),Li([Ne()],Mi.prototype,"screenSpacePanning",void 0),Li([Ne()],Mi.prototype,"keyPanSpeed",void 0),Mi=Li([ci("Orbit Controls")],Mi);var Xa=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Ws extends ct{constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=a=>{this.setDirty(a)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new f.Pa4(0,0,10),this._target=new f.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(a,c)=>{const d=new Mi(a,c.ownerDocument?c:c.documentElement);return d.screenSpacePanning=!0,d}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit","firstPerson","pointerLock",...this._controlsCtors.keys()].map(a=>({label:a===""?"none":a,value:a})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var a;return(a=this._controls)===null||a===void 0?void 0:a.uiConfig},()=>{var a;return!((a=this._controls)===null||a===void 0)&&a.zoomIn?{type:"button",label:"Zoom in",value:()=>{var c;(c=this._controls)===null||c===void 0||c.zoomIn(1)}}:{}},()=>{var a;return!((a=this._controls)===null||a===void 0)&&a.zoomOut?{type:"button",label:"Zoom out",value:()=>{var c;(c=this._controls)===null||c===void 0||c.zoomOut(1)}}:{}}]},this.assetType="model",this.uuid=ar(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const r=t??this._options;this._camera=this._setCameraObject(e??(r.type==="OrthographicCamera"?new f.iKG(-1,1,1,-1):new f.cPb)),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(r.fov=o.fov,r.focus=o.focus,r.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,r.zoom=o.zoom):o.isOrthographicCamera&&(r.left=o.left,r.right=o.right,r.top=o.top,r.bottom=o.bottom,r.zoom=o.zoom),r.near=o.near,r.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(r)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>1e-5;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>1e-5;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var n,r;const o={...e};!((n=o.position)===null||n===void 0)&&n.isVector3&&(o.position=[o.position.x,o.position.y,o.position.z]),!((r=o.target)===null||r===void 0)&&r.isVector3&&(o.target=[o.target.x,o.target.y,o.target.z]),Object.keys(o).forEach(a=>a!=="frustumSize"&&o[a]===void 0&&delete o[a]),Object.assign(this._options,o),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const r=this._options.type==="PerspectiveCamera"?new f.cPb:new f.iKG;r.name=this._camera.name,r.near=this._camera.modelObject.near,r.far=this._camera.modelObject.far,r.zoom=this._camera.modelObject.zoom,r.scale.copy(this._camera.modelObject.scale);const o=this._isActiveCamera;o&&this.deactivateMain(),this._camera=this._setCameraObject(r),t=this._camera.modelObject,o&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const r=this._options.frustumSize;r!==void 0?(t.top=r/2,t.bottom=-r/2,t.left=n*r/2,t.right=-n*r/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Ao(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new f._fP))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t,n;const r=this._options.controlsMode;this._controls=(t=(e=this._controlsCtors.get(r))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&t!==void 0?t:void 0,this._controls||console.error("Unable to create controls with mode "+r+". Are you missing a plugin?"),(n=this._controls)===null||n===void 0||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?r:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(t=this._controls)===null||t===void 0||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const r=this._options.controlsMode;this._controls?this._controlsMode===r&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=r}if(this._controls){const r=this.interactionsEnabled;this._controls.enabled=r,r&&this._camera.modelObject.up.copy(f.Tme.DefaultUp)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)===null||n===void 0?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new f.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(n=(t=this._camera).setDirty)===null||n===void 0||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,n;const r=this.target;(n=(t=this._controls)===null||t===void 0?void 0:t.target)===null||n===void 0||n.set(r.x,r.y,r.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(r),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t;return!((t=e.uniforms.cameraPositionWorld)===null||t===void 0)&&t.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},yi(this,!0,e))}fromJSON(e,t){return mi(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Xa([Ne("camControls")],Ws.prototype,"_controls",void 0),Xa([Ne()],Ws.prototype,"userData",void 0),Xa([ve(Ws.prototype._nearFarChanged)],Ws.prototype,"near",void 0),Xa([ve(Ws.prototype._nearFarChanged)],Ws.prototype,"far",void 0),Xa([Ne("camOptions")],Ws.prototype,"_options",void 0),Xa([Ne("position")],Ws.prototype,"_position",void 0),Xa([Ne("target")],Ws.prototype,"_target",void 0);var md=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class pc extends f.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Vt,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new Ws(new f.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Ao(new f.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new f.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(t=>{(Array.isArray(t.material)?t.material:[t.material]).forEach(n=>{n&&n.envMapIntensity!==void 0&&!n.userData.separateEnvMapIntensity&&(n.envMapIntensity=this.envMapIntensity,n.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let r=!1;switch(n){case"model":r=e.modelObject.isCamera,r&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:r=!1}={}){const o=e;o?(t&&!o.userData.autoScaled&&ni(o,o.userData.autoScaleRadius||n),o.traverse(a=>{a.isMesh&&!a.userData.__keepShadowDef&&(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(o),r?this.modelObject.add(o):this.modelRoot.add(o),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var t,n;((t=e.dispose)!==null&&t!==void 0?t:(n=e.modelObject)===null||n===void 0?void 0:n.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(t=>Ao(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===f.xfE&&(e.mapping=f.dSO,e.needsUpdate=!0);const t=e.textureObject||e;this.environment=t,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var t;let n;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)n=((t=e)===null||t===void 0?void 0:t.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);n=new f.Ilk(e)}this.background=n,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,r;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(r=(n=(t=this.boxHelper)===null||t===void 0?void 0:t.box)===null||n===void 0?void 0:n.copy)===null||r===void 0||r.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new f.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(r=>{r.name===e&&n.push(r)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var n;const r=e.lightObject;r&&((n=r.children)===null||n===void 0||n.length,t?this.add(r):this.modelRoot.add(r))}getBounds(e=!1,t=!0){return new Vt().expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new f.Pa4).sub(t.getCenter(new f.Pa4)),r=1.5*t.getSize(new f.Pa4).length()/2,o=n.length(),a=Math.max(this.minNearDistance,o-r),c=Math.max(a+1,o+r);e.near=a,e.far=c}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return yi(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(mi(n,this.getEnvironment(),!1,t)),delete e.environment),mi(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}function fc(){const s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return s.style.display="block",s}function fu(s,e){const t=e||"/";return s.join(t)}function Jr(s,e){const t=window.URL.createObjectURL(s),n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(t)},1e3)}async function Nr(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=r=>e(n.result),n.onerror=r=>t(n.error),n.onabort=r=>t(new Error("Read aborted")),n.readAsDataURL(s)})}function wo(s,e){return Jr(s,e??s.name)}async function mc(s=!1,e=!1,t){const n=document.createElement("input");n.type="file",n.multiple=s,n.accept=t||"*",n.webkitdirectory=e,n.style.display="none",document.body.appendChild(n),n.click();const r=await new Promise(o=>{n.onchange=a=>{o(Array.from(n.files||[]))}});return document.body.removeChild(n),r}function Ji({innerHTML:s="",id:e,classList:t,addToBody:n=!0,elementTag:r="div"}){const o=document.createElement(r);return e&&(o.id=e),o.innerHTML=s,t&&o.classList.add(...t),n&&document.body.appendChild(o),o}async function gd(s){return new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.crossOrigin="anonymous",n.decoding="sync",n.src=s})}function Bl(s){const e=document.createElement("style");return e.type="text/css",e.innerText=s,document.head.appendChild(e),e}async function xm(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.addEventListener("load",e),n.addEventListener("error",t),document.body.appendChild(n)})}function gc(s,e=8192,t=!1){var n;if(!s.width||!s.height)return"";const r=document.createElement("canvas");r.width=Math.min(e,s.width),r.height=Math.floor(1+r.width*s.height/s.width);const o=s instanceof ImageBitmap,a=o&&t&&Math.abs(r.width-s.width)<.5?r.getContext("bitmaprenderer"):void 0;a?a.transferFromImageBitmap(s):(n=r.getContext("2d"))===null||n===void 0||n.drawImage(s,0,0,r.width,r.height);const c=r.toDataURL("image/png");return r.remove(),o&&t&&s.close(),c}async function Jo(s){return new Promise((e,t)=>{const n=new Image;n.addEventListener("load",()=>{const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d");if(!o)return void t(new Error("Could not get 2d context"));o.drawImage(n,0,0,r.width,r.height);const a=o.getImageData(0,0,r.width,r.height);e(a),r.remove(),n.remove()},!1),n.addEventListener("error",r=>{n.remove(),t(r)},!1),n.src=s})}function ui(){return(typeof performance>"u"?Date:performance).now()}function Dp(){let s=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(s=!0),s;var e}function vc(s,e=null){var t;return(t=new URL(window.location.href).searchParams.get(s))!==null&&t!==void 0?t:e}function Is(s,e,t=!1){const n=new URLSearchParams(location.search);e==null?n.has(s)&&n.delete(s):n.set(s,e),t?window.location.search=n.toString():window.history.replaceState({},"","?"+n.toString())}function mu(s){return s.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Zr(s,{backgroundColor:e="",displayPixelRatio:t=1,width:n=512,height:r=512}){const o=document.createElement("canvas"),a=o.getContext("2d"),c=t,d=n,p=r;return o.width=d*c,o.height=p*c,o.style.width=`${d}`,o.style.height=`${p}`,(e==null?void 0:e.length)>0&&(a.fillStyle=e,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}md([Ne()],pc.prototype,"defaultCamera",void 0),md([ve(pc.prototype.refreshEnvMapIntensity),Ne()],pc.prototype,"envMapIntensity",void 0),md([Ne()],pc.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(s,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-s),r=new Uint8Array(n);for(let o=0;o<r.length;o++)r[o]=t[o+s];return n});class $r{static ApplyMaterialExtensions(e,t,n,r){for(const o of n)this.ApplyMaterialExtension(e,t,o,r)}static ApplyMaterialExtension(e,t,n,r){var o,a;let c=(o=ke(n.parsFragmentSnippet,r,e))!==null&&o!==void 0?o:"";c.length&&(t.fragmentShader=t.fragmentShader.replace(this.FragVoidMain,`
${c}
${this.FragVoidMain}`)),c=(a=ke(n.parsVertexSnippet,r,e))!==null&&a!==void 0?a:"",c.length&&(t.vertexShader=t.vertexShader.replace(this.VertVoidMain,`
${c}
${this.VertVoidMain}`)),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.shaderExtender&&n.shaderExtender(t,e,r),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const r of t)n+=this.CacheKeyForExtension(e,r);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),n}static RegisterExtensions(e,t){const n=[];if(t)for(const r of t)r.isCompatible&&r.isCompatible(e)&&(n.push(r),r.uuid||(r.uuid=gs()),r.setDirty||(r.setDirty=()=>{r.updateVersion||(r.updateVersion=0),r.updateVersion++}));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",r=>function(o,{object:a,renderer:c}){var d;(d=o.materialExtensions)===null||d===void 0||d.forEach(p=>{var m,A;(m=p.onObjectRender)===null||m===void 0||m.call(p,a,o,c),o.lastShader&&((A=ke(p.updaters))===null||A===void 0||A.forEach(x=>x==null?void 0:x.updateShaderProperties(o.lastShader))),p.updateVersion!==o.materialObject.userData["_"+p.uuid+"_version"]&&(o.materialObject.userData["_"+p.uuid+"_version"]=p.updateVersion,o.materialObject.needsUpdate=!0)})}(e,r))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",r=>function(o,{object:a,renderer:c}){var d;(d=o.materialExtensions)===null||d===void 0||d.forEach(p=>{var m;(m=p.onAfterRender)===null||m===void 0||m.call(p,a,o,c)})}(e,r))),n}}$r.FragVoidMain="void main() {",$r.VertVoidMain="void main() {";class _c extends f.jyz{constructor(e){var t;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=$r.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...$r.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){$r.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+$r.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}onAfterRender(e,t,n,r,o){super.onAfterRender(e,t,n,r,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class es extends _c{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,encoding:f.rnI})),this.setDirty())}_setUniformTexSize(e,t){var n,r,o,a;if(!t||!e)return;const c=(r=(n=t.image)===null||n===void 0?void 0:n.width)!==null&&r!==void 0?r:512,d=(a=(o=t.image)===null||o===void 0?void 0:o.height)!==null&&a!==void 0?a:512,p=e.value;p.isVector2||console.warn("uniform is not a Vector2"),p&&Math.abs(p.x-c)+Math.abs(p.y-d)>.1&&(p.x=c,p.y=d,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,r,o){var a,c;this._setUniformTexSize(this.uniforms.screenSize,(a=e.getRenderTarget())===null||a===void 0?void 0:a.texture);for(const d of this.textures){const p=d.id,m=(c=this.uniforms[p])===null||c===void 0?void 0:c.value;m&&(this._setUniformTexSize(this.uniforms[p+"Size"],m),m.encoding!==d.encoding&&(d.encoding=m.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,r,o)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>{var r,o;return`uniform sampler2D ${n.id}; 
`+Gt((r=n.id)!==null&&r!==void 0?r:"input",(o=n.encoding)!==null&&o!==void 0?o:f.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function gi(s,...e){const t=s.fragmentShader;return new es({defines:Object.assign({},s.defines),uniforms:s.uniforms,vertexShader:s.vertexShader,fragmentShader:t},e)}class Vr extends vt{constructor(e,...t){super(e.isMaterial?e:gi(e,...t),t.length<1?Vr.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,r;(t=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||t===void 0||t.call(e),(r=(n=this.fsQuad)===null||n===void 0?void 0:n.dispose)===null||r===void 0||r.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,r,o){this.enabled&&super.render(e,t,n,r,o)}}Vr.DEFAULT_TEX_ID="tDiffuse",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([gn("Enabled"),Ne()],Vr.prototype,"enabled",void 0);class Ri extends ht{constructor(e,t,n,r,o){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new f.Ilk}render(e,t,n,r,o,a){const c=e.autoClear;let d,p;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(p=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),d=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,a)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,d),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=p),e.autoClear=c}}class vd extends Vr{constructor(e,t="c = a + b;",n="",r){super({vertexShader:It.vertexShader,fragmentShader:K`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:r},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class xo extends f.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new f.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new f.Ltg(1,1,1,1)}},glslVersion:e?f.LSk:f.v9Y})}onBeforeRender(e,t,n,r,o){var a,c,d;let p=o.material;Array.isArray(p)&&(p=p[0]),this.uniforms.alphaMap.value=(a=p==null?void 0:p.alphaMap)!==null&&a!==void 0?a:null,this.uniforms.alphaTest.value=!p||!p.alphaTest||p.alphaTest<1e-7?.001:p.alphaTest,this.uniforms.flags.value.x=(p==null?void 0:p.userData.postTonemap)===!1?0:1,this.uniforms.flags.value.y=p!=null&&p.userData._ssBevel?(p==null?void 0:p.userData._ssBevel.radius)/255:0,this.uniforms.flags.value.z=(p!=null&&p.userData.matId?p==null?void 0:p.userData.matId:0)/255,this.uniforms.flags.value.w=p!=null&&p.userData.enableLUT?p==null?void 0:p.userData.enableLUT:0,this.uniformsNeedUpdate=!0;let m=this.uniforms.alphaMap.value?1:void 0;m!==this.defines.USE_ALPHAMAP&&(m===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=m,this.needsUpdate=!0),m=p.userData.ALPHA_I_RGBA_PACKING?1:void 0,m!==this.defines.ALPHA_I_RGBA_PACKING&&(m===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=m,this.needsUpdate=!0),m=(c=p.userData.forcedLinearDepth)!==null&&c!==void 0?c:void 0,m!==this.defines.FORCED_LINEAR_DEPTH&&(m===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=m,this.needsUpdate=!0),this.side=(d=p.side)!==null&&d!==void 0?d:f.ehD}}var kl=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const Ac={name:"",fog:!0,blending:f.bdR,side:f.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:f.k74,blendDst:f.LgZ,blendEquation:f.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:f.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:f.cum,stencilRef:0,stencilFuncMask:255,stencilFail:f.x5V,stencilZFail:f.x5V,stencilZPass:f.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function hr(s,e,t,{replaceAll:n=!1,prepend:r=!1,append:o=!1}={}){if(!s.includes(e))return console.error(`${e} not found in shader`),s;let a=t;return r?a=t+e:o&&(a=e+t),n?s.replaceAll(e,a):s.replace(e,a)}const Pp={...Ac,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:f.IOt,normalScale:new f.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new Pi(0),specularColorMap:null},Rp={...Pp,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new f.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new Pi(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new Pi(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new Pi(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class vs extends f.EJi{constructor(e){var t;super(e),this.typeSlug=vs.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=n=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(n)},this.fog=!1,this.userData.enableLUT=!0,this.materialExtensions=$r.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...$r.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},ir(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},ir(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},ir(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},ir(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",f.IOt],["ObjectSpace",f.PA7]].map(e=>({label:e[0],value:e[1]}))},ir(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},ir(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},ir(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},ir(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},ir(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},ir(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},ir(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},ir(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},ir(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},ir(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",f.BVF],["Always",f.Se2],["Less",f.Zr5],["LessEqual",f.vCF],["Equal",f.eD],["GreaterEqual",f.ksN],["Greater",f.w$m],["NotEqual",f.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",fs],["Normal",vr],["Additive",f.WMw],["Subtractive",Wi],["Multiply",zr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},ir(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},ir(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},ir(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",f.Wl3],["Back",f._Li],["Double",f.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:e=>{this.userData.enableLUT=e||void 0,this.setDirty()}},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return(n=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&n!==void 0?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Jr(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const o of r)e.vertexShader=hr(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=hr(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);$r.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+$r.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o});const a=this.userData.inverseAlphaMap?1:0;a!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=a,this.needsUpdate=!0)}copyProps(e,t=!1){if(!t&&!["MeshStandardMaterial",vs.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={};mt(e,n,Array.from(Object.keys(Rp)));const r=n.userData;delete n.userData;for(const o of Object.keys(n))n[o]===void 0&&delete n[o];return this.setValues(n),r&&Gs(this.userData,r),this.setDirty(),this}toJSON(e){var t,n;const r=this.userData;this.userData={};const o=super.toJSON(e);this.userData=r,o.userData={},Gs(o.userData,r),o.userData.uuid=this.userData.uuid;const a=e||{textures:Object.fromEntries(((t=o.textures)===null||t===void 0?void 0:t.map(c=>[c.uuid,c]))||[]),images:Object.fromEntries(((n=o.images)===null||n===void 0?void 0:n.map(c=>[c.uuid,c]))||[])};o.userData=yi(o.userData,!1,a),e||(Object.keys(a.textures).length>0&&(o.textures=Object.values(a.textures)),Object.keys(a.images).length>0&&(o.images=Object.values(a.images))),o.type=vs.TYPE;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];return o}fromJSON(e,t,n=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new f.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new f.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,n)}clone(){return super.clone()}}vs.TypeSlug="pmat",vs.TYPE="MeshStandardMaterial2";const Bp={...Ac,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:f.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class Eo extends f.vBJ{constructor(e){var t;super(e),this.typeSlug=Eo.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=n=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(n)},this.materialExtensions=$r.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...$r.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},ir(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",fs],["Normal",vr],["Additive",f.WMw],["Subtractive",Wi],["Multiply",zr]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},ir(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},ir(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},ir(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",f.Wl3],["Back",f._Li],["Double",f.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return(n=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&n!==void 0?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Jr(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const o of r)e.vertexShader=hr(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=hr(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);$r.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+$r.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",Eo.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={};mt(e,n,Array.from(Object.keys(Bp)));const r=n.userData;delete n.userData;for(const o of Object.keys(n))n[o]===void 0&&delete n[o];return this.setValues(n),r&&Gs(this.userData,r),this.setDirty(),this}toJSON(e){var t,n;const r=this.userData;this.userData={};const o=super.toJSON(e);this.userData=r,o.userData={},Gs(o.userData,r),o.userData.uuid=this.userData.uuid;const a=e||{textures:Object.fromEntries(((t=o.textures)===null||t===void 0?void 0:t.map(c=>[c.uuid,c]))||[]),images:Object.fromEntries(((n=o.images)===null||n===void 0?void 0:n.map(c=>[c.uuid,c]))||[])};o.userData=yi(o.userData,!1,a),e||(Object.keys(a.textures).length>0&&(o.textures=Object.values(a.textures)),Object.keys(a.images).length>0&&(o.images=Object.values(a.images))),o.type=Eo.TYPE;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];return o}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Eo.TypeSlug="bmat",Eo.TYPE="MeshBasicMaterial2";const Ol={materialType:vs.TYPE,name:"standard",color:"#ffffff"},gu={materialType:Eo.TYPE,name:"basic",color:"#ffffff"},Em={[vs.TYPE]:Ol.name,MeshStandardMaterial:Ol.name,MeshPhysicalMaterial:Ol.name,[Eo.TYPE]:gu.name,MeshBasicMaterial:gu.name};class ba extends ct{constructor(){super(),this._templates=[Ol,gu],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),r=[];n.forEach(o=>{const a=o.userData.__appliedMaterials;a==null||a.delete(t),a&&o.userData.disposeOnIdle!==!1&&a.size===0&&r.push(o)}),r.forEach(o=>{o.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(r=>r.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(t=>{let n=t.userData.__appliedMaterials;n||(t.userData.__appliedMaterials=n=new Set),n.add(e)})})}_getMapsForMaterial(e){var t;const n=new Set;for(const r of Object.values(e))r&&r.isTexture&&n.add(r);for(const r of Object.values((t=e.userData)!==null&&t!==void 0?t:{}))r&&r.isTexture&&n.add(r);return n}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=gs());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(t=>t.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){return Te(e,"modelObject",this._processModel(e,t)),e}_processMaterial(e,t){var n,r,o;if(!e)return;if(!((n=e.materialObject)===null||n===void 0)&&n.isMaterial)return e;let a=e.mmMaterial;if(!a){const c=((r=e.userData)===null||r===void 0?void 0:r.uuid)||e.uuid;if(a=this.findMaterial(c),a)a.copyProps(e);else{const d=t.useSourceMaterial===!1||!e.isMaterial,p=(o=t.materialTemplate)!==null&&o!==void 0?o:d?"standard":Em[e.type]||"standard";a=this.generateFromTemplate(p,d?{}:e)}e.mmMaterial=a}return a}processMaterial(e,t){return t.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,r=!1){const o=yi(e,!1),a=JSON.stringify(o,null,n?0:2),c=(t||e.name||"physical_material")+"."+e.typeSlug,d=new File([a],c,{type:"application/json"});return r&&wo(d),d}}class yc extends ba{_generateFromTemplate(e,t){var n,r,o,a,c,d;let p;const m={...e};m.customMaterialExtensions=[...(n=m.customMaterialExtensions)!==null&&n!==void 0?n:[],...this._materialExtensions];let A={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&mt(t,m,Array.from(Object.keys(Rp))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(m.roughness=.9,m.metalness=0,!((r=m.userData)===null||r===void 0)&&r.uuid&&delete m.userData.uuid),A=(o=m.userData)===null||o===void 0?void 0:o.uuid,A&&delete m.userData.uuid,p=new vs({customMaterialExtensions:m.customMaterialExtensions}).fromJSON(m,void 0,!0),A&&(p.uuid=A),p.userData.uuid=p.uuid,p.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=p);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&mt(t,m,Array.from(Object.keys(Bp))),A=(a=m.userData)===null||a===void 0?void 0:a.uuid,A&&delete m.userData.uuid,p=new Eo({customMaterialExtensions:m.customMaterialExtensions}).fromJSON(m,void 0,!0),A&&(p.uuid=A),p.userData.uuid=p.uuid,p.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:A=null,t&&t.userData&&(A=t.userData,delete t.userData),p=((c=e.generator)===null||c===void 0?void 0:c.call(e,m,t))||void 0,t&&A&&(t.userData=A),A&&p&&(Gs(p.userData,A),A!=null&&A.uuid&&(p.uuid=A.uuid),A=null),p&&(p.userData.uuid=p.uuid)}if(p){t.runtimeMaterial&&(p.userData.__runtimeMaterial=!0);const x=p;if(p.clone=()=>{x.userData.cloneId||(x.userData.cloneId="0",x.userData.cloneCount=0),x.userData.cloneCount+=1;const E=this.generateFromTemplate(e.name);return E&&(E.copyProps(x),E.userData.cloneId=E.userData.cloneId+"_"+x.userData.cloneCount,E.userData.cloneCount=0,E.name=E.name+"_"+E.userData.cloneId),E==null?void 0:E.materialObject},t){let E=this.findMaterial(t==null?void 0:t.uuid);E&&this.unregisterMaterial(E),E=this.findMaterial((d=t==null?void 0:t.materialObject)===null||d===void 0?void 0:d.uuid),E&&this.unregisterMaterial(E)}return this.registerMaterialObject(x)}}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let r=!0;Array.isArray(n)||(n=[n],r=!1);const o=[];for(const a of n){const c=this._processMaterial(a,t);o.push(c==null?void 0:c.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(r?o:o[0]))}if(t.recursive!==!1)for(let r=0;r<e.modelObject.children.length;r++)e.modelObject.children[r]=this._processModel(e.modelObject.children[r],t);return e}}class dr{constructor(e,t,n,r){this.cls=e,this.ext=t,this.root=n,this.onCtor=r}ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}}function _d(s){var e;if(!s||s===""||s.match(/__MACOSX\/.*\._/))return"";const t=(e=(s=s.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",n=t.lastIndexOf(".");return t===""||n<1?"":t.slice(n+1)}function Ad(s){return s.substring(s.lastIndexOf("/")+1)}class Ka{constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:r=!1,autoScaleRadius:o=2,license:a=""}={}){if(this.assetType="model",this._modelObject=Ao(new f.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):jn(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const c=new Vt().expandByObject(e,!0,!0).getCenter(new f.Pa4);this._modelObject.position.copy(c).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,e.userData.iModel=this}r&&!this._modelObject.userData.autoScaled?ni(this._modelObject,e.userData.autoScaleRadius||o):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=a}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,r,o;(n=(t=this._modelObject)===null||t===void 0?void 0:t.setDirty)===null||n===void 0||n.call(t,e),(o=(r=this._uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)===null||n===void 0?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,r;if(this._modelObject.isMesh)return(r=(n=this._modelObject).setGeometry)===null||r===void 0?void 0:r.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Hs(this._modelObject,!1)),this._uiConfig}clone(){return new Ka(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function bc(s,e){return[s.modelObject,...s.modelObject.children].forEach(t=>{Ao(t,t!==s.modelObject?s:void 0,e)}),s}class vu{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))===null||n===void 0||n.push(t)}remove(e,t){const n=this._processors.get(e),r=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(o=>o.process&&o.process===t.process||o.processAsync&&o.processAsync===t.processAsync));!n||!r||r<0||n.splice(r,1)}get(e){var t;return(t=this._processors.get(e))!==null&&t!==void 0?t:[]}async process(e,t,n){var r,o,a,c;const d=this.get(e),p=t.assetType;for(const m of d)m.forAssetType===p&&(t=(o=(r=m.process)===null||r===void 0?void 0:r.call(m,t,n))!==null&&o!==void 0?o:t,t=(c=await((a=m.processAsync)===null||a===void 0?void 0:a.call(m,t,n)))!==null&&c!==void 0?c:t);return t}dispose(){this._processors.clear()}}class yd extends f.hH6{load(e,t,n,r){return super.load(e,o=>{try{if(typeof o!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(o))}catch(a){r==null||r(a)}},n,r)}}class Ov extends f.yxD{constructor(e){super(e),this.type=f.cLu}parse(e){const t=function(d,p){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(p||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(p||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(p||""));break;default:console.error("THREE.RGBELoader: Error: "+(p||""))}return-1},n=function(d,p,m){p=p||1024;let A=d.pos,x=-1,E=0,M="",T=String.fromCharCode.apply(null,new Uint16Array(d.subarray(A,A+128)));for(;0>(x=T.indexOf(`
`))&&E<p&&A<d.byteLength;)M+=T,E+=T.length,A+=128,T+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(A,A+128)));return-1<x&&(m!==!1&&(d.pos+=E+x+1),M+T.slice(0,x))},r=function(d,p,m,A){const x=d[p+3],E=Math.pow(2,x-128)/255;m[A+0]=d[p+0]*E,m[A+1]=d[p+1]*E,m[A+2]=d[p+2]*E,m[A+3]=1},o=function(d,p,m,A){const x=d[p+3],E=Math.pow(2,x-128)/255;m[A+0]=f.A5E.toHalfFloat(Math.min(d[p+0]*E,65504)),m[A+1]=f.A5E.toHalfFloat(Math.min(d[p+1]*E,65504)),m[A+2]=f.A5E.toHalfFloat(Math.min(d[p+2]*E,65504)),m[A+3]=f.A5E.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;const c=function(d){const p=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,m=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*FORMAT=(\S+)\s*$/,x=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,E={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let M,T;if(d.pos>=d.byteLength||!(M=n(d)))return t(1,"no header found");if(!(T=M.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(E.valid|=1,E.programtype=T[1],E.string+=M+`
`;M=n(d),M!==!1;)if(E.string+=M+`
`,M.charAt(0)!=="#"){if((T=M.match(p))&&(E.gamma=parseFloat(T[1])),(T=M.match(m))&&(E.exposure=parseFloat(T[1])),(T=M.match(A))&&(E.valid|=2,E.format=T[1]),(T=M.match(x))&&(E.valid|=4,E.height=parseInt(T[1],10),E.width=parseInt(T[2],10)),2&E.valid&&4&E.valid)break}else E.comments+=M+`
`;return 2&E.valid?4&E.valid?E:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(c!==-1){const d=c.width,p=c.height,m=function(A,x,E){const M=x;if(M<8||M>32767||A[0]!==2||A[1]!==2||128&A[2])return new Uint8Array(A);if(M!==(A[2]<<8|A[3]))return t(3,"wrong scanline width");const T=new Uint8Array(4*x*E);if(!T.length)return t(4,"unable to allocate buffer space");let O=0,P=0;const R=4*M,I=new Uint8Array(4),j=new Uint8Array(R);let z=E;for(;z>0&&P<A.byteLength;){if(P+4>A.byteLength)return t(1);if(I[0]=A[P++],I[1]=A[P++],I[2]=A[P++],I[3]=A[P++],I[0]!=2||I[1]!=2||(I[2]<<8|I[3])!=M)return t(3,"bad rgbe scanline format");let V,G=0;for(;G<R&&P<A.byteLength;){V=A[P++];const ne=V>128;if(ne&&(V-=128),V===0||G+V>R)return t(3,"bad scanline data");if(ne){const ce=A[P++];for(let ge=0;ge<V;ge++)j[G++]=ce}else j.set(A.subarray(P,P+V),G),G+=V,P+=V}const X=M;for(let ne=0;ne<X;ne++){let ce=0;T[O]=j[ne+ce],ce+=M,T[O+1]=j[ne+ce],ce+=M,T[O+2]=j[ne+ce],ce+=M,T[O+3]=j[ne+ce],O+=4}z--}return T}(a.subarray(a.pos),d,p);if(m!==-1){let A,x,E;switch(this.type){case f.VzW:E=m.length/4;const M=new Float32Array(4*E);for(let O=0;O<E;O++)r(m,4*O,M,4*O);A=M,x=f.VzW;break;case f.cLu:E=m.length/4;const T=new Uint16Array(4*E);for(let O=0;O<E;O++)o(m,4*O,T,4*O);A=T,x=f.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:p,data:A,header:c.string,gamma:c.gamma,exposure:c.exposure,type:x}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(o,a){switch(o.type){case f.VzW:case f.cLu:o.encoding=f.rnI,o.minFilter=f.wem,o.magFilter=f.wem,o.generateMipmaps=!1,o.flipY=!0}t&&t(o,a)},n,r)}}function Cm(s){si.Importers.push(new dr(class extends Ov{constructor(e){super(e),this.setDataType(Lm(s))}},["hdr"],!1))}class Ja extends f.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new bh(t)}),this.register(function(t){return new Ds(t)}),this.register(function(t){return new Za(t)}),this.register(function(t){return new On(t)}),this.register(function(t){return new wa(t)}),this.register(function(t){return new wh(t)}),this.register(function(t){return new xh(t)}),this.register(function(t){return new wc(t)}),this.register(function(t){return new Ll(t)}),this.register(function(t){return new _s(t)}),this.register(function(t){return new Cr(t)}),this.register(function(t){return new Vi(t)})}load(e,t,n,r){const o=this;let a;a=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:f.Zp0.extractUrlBase(e),this.manager.itemStart(e);const c=function(p){r?r(p):console.error(p),o.manager.itemError(e),o.manager.itemEnd(e)},d=new f.hH6(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(p){try{o.parse(p,a,function(m){t(m),o.manager.itemEnd(e)},c)}catch(m){c(m)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let o;const a={},c={};if(typeof e=="string")o=e;else if(f.Zp0.decodeText(new Uint8Array(e,0,4))===wd){try{a[Vn.KHR_BINARY_GLTF]=new Lt(e)}catch(m){return void(r&&r(m))}o=a[Vn.KHR_BINARY_GLTF].content}else o=f.Zp0.decodeText(new Uint8Array(e));const d=JSON.parse(o);if(d.asset===void 0||d.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const p=new Ur(d,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){const A=this.pluginCallbacks[m](p);c[A.name]=A,a[A.name]=!0}if(d.extensionsUsed)for(let m=0;m<d.extensionsUsed.length;++m){const A=d.extensionsUsed[m],x=d.extensionsRequired||[];switch(A){case Vn.KHR_MATERIALS_UNLIT:a[A]=new kp;break;case Vn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[A]=new xc;break;case Vn.KHR_DRACO_MESH_COMPRESSION:a[A]=new ts(d,this.dracoLoader);break;case Vn.KHR_TEXTURE_TRANSFORM:a[A]=new Sm;break;case Vn.KHR_MESH_QUANTIZATION:a[A]=new Ec;break;default:x.indexOf(A)>=0&&c[A]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}p.setExtensions(a),p.setPlugins(c),p.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,t,r,o)})}}function bd(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const Vn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Cr{constructor(e){this.parser=e,this.name=Vn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const d=new f.Ilk(16777215);a.color!==void 0&&d.fromArray(a.color);const p=a.range!==void 0?a.range:0;switch(a.type){case"directional":c=new f.Ox3(d),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new f.cek(d),c.distance=p;break;case"spot":c=new f.PMe(d),c.distance=p,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,c.angle=a.spot.outerConeAngle,c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return c.position.set(0,0,0),c.decay=2,a.intensity!==void 0&&(c.intensity=a.intensity),c.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(c),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return n._getNodeRef(t.cache,o,a)})}}class kp{constructor(){this.name=Vn.KHR_MATERIALS_UNLIT}getMaterialType(){return f.vBJ}extendParams(e,t,n){const r=[];e.color=new f.Ilk(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}o.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",o.baseColorTexture,f.knz))}return Promise.all(r)}}class wc{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class bh{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new f.FM8(c,c)}return Promise.all(o)}}class _s{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class On{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new f.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];return a.sheenColorFactor!==void 0&&t.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,f.knz)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),r.extras&&r.extras.sheenFactor!==void 0&&(t.sheen=r.extras.sheenFactor,delete r.extras.sheenFactor),Promise.all(o)}}class wa{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class wh{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;const c=a.attenuationColor||[1,1,1];return t.attenuationColor=new f.Ilk(c[0],c[1],c[2]),Promise.all(o)}}class xh{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Ll{constructor(e){this.parser=e,this.name=Vn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?f.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return t.specularColor=new f.Ilk(c[0],c[1],c[2]),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,f.knz)),Promise.all(o)}}class Ds{constructor(e){this.parser=e,this.name=Vn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,a)}}class Za{constructor(e){this.parser=e,this.name=Vn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],c=r.images[a.source];let d=n.textureLoader;if(c.uri){const p=n.options.manager.getHandler(c.uri);p!==null&&(d=p)}return this.detectSupport().then(function(p){if(p)return n.loadTextureImage(e,a.source,d);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vi{constructor(e){this.name=Vn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const d=r.byteOffset||0,p=r.byteLength||0,m=r.count,A=r.byteStride,x=new Uint8Array(c,d,p);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(m,A,x,r.mode,r.filter).then(function(E){return E.buffer}):a.ready.then(function(){const E=new ArrayBuffer(m*A);return a.decodeGltfBuffer(new Uint8Array(E),m,A,x,r.mode,r.filter),E})})}return null}}const wd="glTF";class Lt{constructor(e){this.name=Vn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:f.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wd)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const c=r.getUint32(o,!0);if(o+=4,c===1313821514){const d=new Uint8Array(e,12+o,a);this.content=f.Zp0.decodeText(d)}else if(c===5130562){const d=12+o;this.body=e.slice(d,d+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ts{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Vn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},d={},p={};for(const m in a){const A=Au[m]||m.toLowerCase();c[A]=a[m]}for(const m in e.attributes){const A=Au[m]||m.toLowerCase();if(a[m]!==void 0){const x=n.accessors[e.attributes[m]],E=As[x.componentType];p[A]=E.name,d[A]=x.normalized===!0}}return t.getDependency("bufferView",o).then(function(m){return new Promise(function(A){r.decodeDracoFile(m,function(x){for(const E in x.attributes){const M=x.attributes[E],T=d[E];T!==void 0&&(M.normalized=T)}A(x)},c,p)})})}}class Sm{constructor(){this.name=Vn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Op extends f.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new f.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(d){for(const p in c)d.uniforms[p]=c[p];d.fragmentShader=d.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(d){c.specular.value=d}},specularMap:{get:function(){return c.specularMap.value},set:function(d){c.specularMap.value=d,d?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(d){c.glossiness.value=d}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(d){c.glossinessMap.value=d,d?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class xc{constructor(){this.name=Vn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Op}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new f.Ilk(1,1,1),e.opacity=1;const o=[];if(Array.isArray(r.diffuseFactor)){const a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(r.diffuseTexture!==void 0&&o.push(n.assignTexture(e,"map",r.diffuseTexture,f.knz)),e.emissive=new f.Ilk(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new f.Ilk(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const a=r.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",a)),o.push(n.assignTexture(e,"specularMap",a,f.knz))}return Promise.all(o)}createMaterial(e){const t=new Op(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=f.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Ec{constructor(){this.name=Vn.KHR_MESH_QUANTIZATION}}class Zo extends f._C8{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let a=0;a!==r;a++)t[a]=n[o+a];return t}interpolate_(e,t,n,r){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,d=2*c,p=3*c,m=r-t,A=(n-t)/m,x=A*A,E=x*A,M=e*p,T=M-p,O=-2*E+3*x,P=E-x,R=1-O,I=P-x+A;for(let j=0;j!==c;j++){const z=a[T+j+c],V=a[T+j+d]*m,G=a[M+j+c],X=a[M+j]*m;o[j]=R*z+I*V+O*G+P*X}return o}}const Eh=new f._fP;class _u extends Zo{interpolate_(e,t,n,r){const o=super.interpolate_(e,t,n,r);return Eh.fromArray(o).normalize().toArray(o),o}}const As={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xd={9728:f.TyD,9729:f.wem,9984:f.YLQ,9985:f.qyh,9986:f.aH4,9987:f.D1R},pr={33071:f.uWy,33648:f.OoA,10497:f.rpg},Co={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Au={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ro={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ed={CUBICSPLINE:void 0,LINEAR:f.NMF,STEP:f.Syv};function mn(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function So(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ch(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Cc(s){const e=s.extensions&&s.extensions[Vn.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+yu(e.attributes):s.indices+":"+yu(s.attributes)+":"+s.mode,t}function yu(s){let e="";const t=Object.keys(s).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Lp(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Ur{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new bd,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||n||r&&o<98?this.textureLoader=new f.dpR(this.options.manager):this.textureLoader=new f.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new f.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const c={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:n,userData:{}};mn(o,c,r),So(c,r),Promise.all(n._invokeAll(function(d){return d.afterRoot&&d.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){const a=t[r].joints;for(let c=0,d=a.length;c<d;c++)e[a[c]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),o=(a,c)=>{const d=this.associations.get(a);d!=null&&this.associations.set(c,d);for(const[p,m]of a.children.entries())o(m,c.children[p])};return o(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Vn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){n.load(f.Zp0.resolveURL(t.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const c=a[0],d=Co[r.type],p=As[r.componentType],m=p.BYTES_PER_ELEMENT,A=m*d,x=r.byteOffset||0,E=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,M=r.normalized===!0;let T,O;if(E&&E!==A){const P=Math.floor(x/E),R="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+P+":"+r.count;let I=t.cache.get(R);I||(T=new p(c,P*E,r.count*E/m),I=new f.vpT(T,E/m),t.cache.add(R,I)),O=new f.kB5(I,d,x%E/m,M)}else T=c===null?new p(r.count*d):new p(c,x,r.count*d),O=new f.TlE(T,d,M);if(r.sparse!==void 0){const P=Co.SCALAR,R=As[r.sparse.indices.componentType],I=r.sparse.indices.byteOffset||0,j=r.sparse.values.byteOffset||0,z=new R(a[1],I,r.sparse.count*P),V=new p(a[2],j,r.sparse.count*d);c!==null&&(O=new f.TlE(O.array.slice(),O.itemSize,O.normalized));for(let G=0,X=z.length;G<X;G++){const ne=z[G];if(O.setX(ne,V[G*d]),d>=2&&O.setY(ne,V[G*d+1]),d>=3&&O.setZ(ne,V[G*d+2]),d>=4&&O.setW(ne,V[G*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return O})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const r=this,o=this.json,a=o.textures[e],c=o.images[t],d=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[d])return this.textureCache[d];const p=this.loadImageSource(t,n).then(function(m){a.name&&(m.name=a.name);const A=(o.samplers||{})[a.sampler]||{};return m.magFilter=xd[A.magFilter]||f.wem,m.minFilter=xd[A.minFilter]||f.D1R,m.wrapS=pr[A.wrapS]||f.rpg,m.wrapT=pr[A.wrapT]||f.rpg,A.extras&&A.extras.uuid!==void 0&&(m.uuid=A.extras.uuid),r.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[d]=p,p}loadImageSource(e,t){const n=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(A=>A.clone());const a=r.images[e],c=self.URL||self.webkitURL;let d=a.uri||"",p=!1;if(a.bufferView!==void 0)d=n.getDependency("bufferView",a.bufferView).then(function(A){p=!0;const x=new Blob([A],{type:a.mimeType});return d=c.createObjectURL(x),d});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const m=Promise.resolve(d).then(function(A){return new Promise(function(x,E){let M=x;t.isImageBitmapLoader===!0&&(M=function(T){const O=new f.xEZ(T);O.needsUpdate=!0,x(O)}),t.load(f.Zp0.resolveURL(A,o.path),M,void 0,function(T){t.isImageBitmapLoader===!0?(t=new f.dpR(n.options.manager),M=x,t.setCrossOrigin(n.options.crossOrigin),t.setRequestHeader(n.options.requestHeader),t.load(f.Zp0.resolveURL(A,o.path),M,void 0,E)):E(T)})})}).then(function(A){var x;if(p===!0&&c.revokeObjectURL(d),A.userData.mimeType=a.mimeType||((x=a.uri).search(/\.jpe?g($|\?)/i)>0||x.search(/^data\:image\/jpeg/)===0?"image/jpeg":x.search(/\.webp($|\?)/i)>0||x.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),A.flipY=!1,a.extras){if(a.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const E=A,M=a.extras.flipY&&!E.flipY;createImageBitmap(E.source.data,{imageOrientation:M?"flipY":"none"}).then(function(T){E.source.data.close&&E.source.data.close(),E.source.data=T,E.source.needsUpdate=!0,E.needsUpdate=!0})}A.flipY=a.extras.flipY,A.needsUpdate=!0,delete a.extras.flipY}a.extras.uuid!==void 0&&(A.source.uuid=a.extras.uuid),a.extras.t_uuid!==void 0&&(A.uuid=a.extras.t_uuid)}return a.uri&&typeof a.uri=="string"&&(A.userData.rootPath=a.uri),A}).catch(function(A){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),A});return this.sourceCache[e]=m,m}assignTexture(e,t,n,r){const o=this;return this.getDependency("texture",n.index).then(function(a){if(n.texCoord===void 0||n.texCoord==0||t==="aoMap"&&n.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[Vn.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[Vn.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const d=o.associations.get(a);a=o.extensions[Vn.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),o.associations.set(a,d)}}return r!==void 0&&(a.encoding=r),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let d=this.cache.get(c);d||(d=new f.UY4,f.F5T.prototype.copy.call(d,n),d.color.copy(n.color),d.map=n.map,d.sizeAttenuation=!1,this.cache.add(c,d)),n=d}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let d=this.cache.get(c);d||(d=new f.nls,f.F5T.prototype.copy.call(d,n),d.color.copy(n.color),this.cache.add(c,d)),n=d}if(r||o||a){let c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let d=this.cache.get(c);d||(d=n.clone(),o&&(d.vertexColors=!0),a&&(d.flatShading=!0),r&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(c,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return f.Wid}loadMaterial(e){const t=this,n=this.json,r=this.extensions,o=n.materials[e];let a;const c={},d=o.extensions||{},p=[];if(d[Vn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const A=r[Vn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=A.getMaterialType(),p.push(A.extendParams(c,o,t))}else if(d[Vn.KHR_MATERIALS_UNLIT]){const A=r[Vn.KHR_MATERIALS_UNLIT];a=A.getMaterialType(),p.push(A.extendParams(c,o,t))}else{const A=o.pbrMetallicRoughness||{};if(c.color=new f.Ilk(1,1,1),c.opacity=1,Array.isArray(A.baseColorFactor)){const x=A.baseColorFactor;c.color.fromArray(x),c.opacity=x[3]}A.baseColorTexture!==void 0&&p.push(t.assignTexture(c,"map",A.baseColorTexture,f.knz)),c.metalness=A.metallicFactor!==void 0?A.metallicFactor:1,c.roughness=A.roughnessFactor!==void 0?A.roughnessFactor:1,A.metallicRoughnessTexture!==void 0&&(p.push(t.assignTexture(c,"metalnessMap",A.metallicRoughnessTexture)),p.push(t.assignTexture(c,"roughnessMap",A.metallicRoughnessTexture))),a=this._invokeOne(function(x){return x.getMaterialType&&x.getMaterialType(e)}),p.push(Promise.all(this._invokeAll(function(x){return x.extendMaterialParams&&x.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=f.ehD);const m=o.alphaMode||"OPAQUE";if(m==="BLEND"?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,m==="MASK"&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==f.vBJ&&(p.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new f.FM8(1,1),o.normalTexture.scale!==void 0)){const A=o.normalTexture.scale;c.normalScale.set(A,A)}return o.occlusionTexture!==void 0&&a!==f.vBJ&&(p.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==f.vBJ&&(c.emissive=new f.Ilk().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&a!==f.vBJ&&p.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,f.knz)),Promise.all(p).then(function(){let A;return A=a===Op?r[Vn.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new a(c),o.name&&(A.name=o.name),So(A,o),t.associations.set(A,{materials:e}),o.extensions&&mn(r,A,o),A})}createUniqueName(e){const t=f.iUV.sanitizeNodeName(e||"");let n=t;for(let r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function o(c){return n[Vn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(d){return qs(d,c,t)})}const a=[];for(let c=0,d=e.length;c<d;c++){const p=e[c],m=Cc(p),A=r[m];if(A)a.push(A.promise);else{let x;x=p.extensions&&p.extensions[Vn.KHR_DRACO_MESH_COMPRESSION]?o(p):qs(new f.u9r,p,t),r[m]={primitive:p,promise:x},a.push(x)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,r=this.extensions,o=n.meshes[e],a=o.primitives,c=[];for(let p=0,m=a.length;p<m;p++){const A=a[p].material===void 0?((d=this.cache).DefaultMaterial===void 0&&(d.DefaultMaterial=new f.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:f.Wl3})),d.DefaultMaterial):this.getDependency("material",a[p].material);c.push(A)}var d;return c.push(t.loadGeometries(a)),Promise.all(c).then(function(p){const m=p.slice(0,p.length-1),A=p[p.length-1],x=[];for(let M=0,T=A.length;M<T;M++){const O=A[M],P=a[M];let R;const I=m[M];if(P.mode===4||P.mode===5||P.mode===6||P.mode===void 0)R=o.isSkinnedMesh===!0?new f.TUv(O,I):new f.Kj0(O,I),R.isSkinnedMesh!==!0||R.geometry.attributes.skinWeight.normalized||R.normalizeSkinWeights(),P.mode===5?R.geometry=bu(R.geometry,f.UlW):P.mode===6&&(R.geometry=bu(R.geometry,f.z$h));else if(P.mode===1)R=new f.ejS(O,I);else if(P.mode===3)R=new f.x12(O,I);else if(P.mode===2)R=new f.blk(O,I);else{if(P.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);R=new f.woe(O,I)}Object.keys(R.geometry.morphAttributes).length>0&&Ch(R,o),R.name=t.createUniqueName(o.name||"mesh_"+e),So(R,o),P.extensions&&mn(r,R,P),t.assignFinalMaterial(R),x.push(R)}o.extensions&&x.forEach(M=>mn(r,M,o));for(let M=0,T=x.length;M<T;M++)t.associations.set(x[M],{meshes:e,primitives:M});if(x.length===1)return x[0];const E=new f.ZAu;t.associations.set(E,{meshes:e});for(let M=0,T=x.length;M<T;M++)E.add(x[M]);return E})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return n.type==="perspective"?t=new f.cPb(f.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new f.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),So(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return n.inverseBindMatrices=r,n})}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],o=[],a=[],c=[];for(let d=0,p=t.channels.length;d<p;d++){const m=t.channels[d],A=t.samplers[m.sampler],x=m.target,E=x.node,M=t.parameters!==void 0?t.parameters[A.input]:A.input,T=t.parameters!==void 0?t.parameters[A.output]:A.output;n.push(this.getDependency("node",E)),r.push(this.getDependency("accessor",M)),o.push(this.getDependency("accessor",T)),a.push(A),c.push(x)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(d){const p=d[0],m=d[1],A=d[2],x=d[3],E=d[4],M=[];for(let O=0,P=p.length;O<P;O++){const R=p[O],I=m[O],j=A[O],z=x[O],V=E[O];if(R===void 0)continue;let G;switch(R.updateMatrix(),ro[V.path]){case ro.weights:G=f.dUE;break;case ro.rotation:G=f.iLg;break;default:G=f.yC1}const X=R.name?R.name:R.uuid,ne=z.interpolation!==void 0?Ed[z.interpolation]:f.NMF,ce=[];ro[V.path]===ro.weights?R.traverse(function(de){de.morphTargetInfluences&&ce.push(de.name?de.name:de.uuid)}):ce.push(X);let ge=j.array;if(j.normalized){const de=Lp(ge.constructor),xe=new Float32Array(ge.length);for(let pe=0,ye=ge.length;pe<ye;pe++)xe[pe]=ge[pe]*de;ge=xe}for(let de=0,xe=ce.length;de<xe;de++){const pe=new G(ce[de]+"."+ro[V.path],I.array,ge,ne);z.interpolation==="CUBICSPLINE"&&(pe.createInterpolant=function(ye){return new(this instanceof f.iLg?_u:Zo)(this.times,this.values,this.getValueSize()/3,ye)},pe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),M.push(pe)}}const T=t.name?t.name:"animation_"+e;return new f.m7l(T,void 0,M)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let d=0,p=r.weights.length;d<p;d++)c.morphTargetInfluences[d]=r.weights[d]}),a})}loadNode(e){const t=this.json,n=this.extensions,r=this,o=t.nodes[e],a=o.name?r.createUniqueName(o.name):"";return function(){const c=[],d=r._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(e)});return d&&c.push(d),o.camera!==void 0&&c.push(r.getDependency("camera",o.camera).then(function(p){return r._getNodeRef(r.cameraCache,o.camera,p)})),r._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(e)}).forEach(function(p){c.push(p)}),Promise.all(c)}().then(function(c){let d;if(d=o.isBone===!0?new f.N$j:c.length>1?new f.ZAu:c.length===1?c[0]:new f.Tme,d!==c[0])for(let p=0,m=c.length;p<m;p++)d.add(c[p]);if(o.name&&(d.userData.name=o.name,d.name=a),So(d,o),o.extensions&&mn(n,d,o),o.matrix!==void 0){const p=new f.yGw;p.fromArray(o.matrix),d.applyMatrix4(p)}else o.translation!==void 0&&d.position.fromArray(o.translation),o.rotation!==void 0&&d.quaternion.fromArray(o.rotation),o.scale!==void 0&&d.scale.fromArray(o.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d})}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],o=this,a=new f.ZAu;r.name&&(a.name=o.createUniqueName(r.name)),So(a,r),r.extensions&&mn(n,a,r);const c=r.nodes||[],d=[];for(let p=0,m=c.length;p<m;p++)d.push(Ti(c[p],a,t,o));return Promise.all(d).then(function(){return o.associations=(p=>{const m=new Map;for(const[A,x]of o.associations)(A instanceof f.F5T||A instanceof f.xEZ)&&m.set(A,x);return p.traverse(A=>{const x=o.associations.get(A);x!=null&&m.set(A,x)}),m})(a),a})}}function Ti(s,e,t,n){const r=t.nodes[s];return n.getDependency("node",s).then(function(o){if(r.skin===void 0)return o;let a;return n.getDependency("skin",r.skin).then(function(c){a=c;const d=[];for(let p=0,m=a.joints.length;p<m;p++)d.push(n.getDependency("node",a.joints[p]));return Promise.all(d)}).then(function(c){return o.traverse(function(d){if(!d.isMesh)return;const p=[],m=[];for(let A=0,x=c.length;A<x;A++){const E=c[A];if(E){p.push(E);const M=new f.yGw;a.inverseBindMatrices!==void 0&&M.fromArray(a.inverseBindMatrices.array,16*A),m.push(M)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[A])}d.bind(new f.OdW(p,m),d.matrixWorld)}),o})}).then(function(o){e.add(o);const a=[];if(r.children){const c=r.children;for(let d=0,p=c.length;d<p;d++){const m=c[d];a.push(Ti(m,o,t,n))}}return Promise.all(a)})}function qs(s,e,t){const n=e.attributes,r=[];function o(a,c){return t.getDependency("accessor",a).then(function(d){s.setAttribute(c,d)})}for(const a in n){const c=Au[a]||a.toLowerCase();c in s.attributes||r.push(o(n[a],c))}if(e.indices!==void 0&&!s.index){const a=t.getDependency("accessor",e.indices).then(function(c){s.setIndex(c)});r.push(a)}return So(s,e),function(a,c,d){const p=c.attributes,m=new f.ZzF;if(p.POSITION===void 0)return;{const E=d.json.accessors[p.POSITION],M=E.min,T=E.max;if(M===void 0||T===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(m.set(new f.Pa4(M[0],M[1],M[2]),new f.Pa4(T[0],T[1],T[2])),E.normalized){const O=Lp(As[E.componentType]);m.min.multiplyScalar(O),m.max.multiplyScalar(O)}}const A=c.targets;if(A!==void 0){const E=new f.Pa4,M=new f.Pa4;for(let T=0,O=A.length;T<O;T++){const P=A[T];if(P.POSITION!==void 0){const R=d.json.accessors[P.POSITION],I=R.min,j=R.max;if(I!==void 0&&j!==void 0){if(M.setX(Math.max(Math.abs(I[0]),Math.abs(j[0]))),M.setY(Math.max(Math.abs(I[1]),Math.abs(j[1]))),M.setZ(Math.max(Math.abs(I[2]),Math.abs(j[2]))),R.normalized){const z=Lp(As[R.componentType]);M.multiplyScalar(z)}E.max(M)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}m.expandByVector(E)}a.boundingBox=m;const x=new f.aLr;m.getCenter(x.center),x.radius=m.min.distanceTo(m.max)/2,a.boundingSphere=x}(s,e,t),Promise.all(r).then(function(){return e.targets!==void 0?function(a,c,d){let p=!1,m=!1,A=!1;for(let T=0,O=c.length;T<O;T++){const P=c[T];if(P.POSITION!==void 0&&(p=!0),P.NORMAL!==void 0&&(m=!0),P.COLOR_0!==void 0&&(A=!0),p&&m&&A)break}if(!p&&!m&&!A)return Promise.resolve(a);const x=[],E=[],M=[];for(let T=0,O=c.length;T<O;T++){const P=c[T];if(p){const R=P.POSITION!==void 0?d.getDependency("accessor",P.POSITION):a.attributes.position;x.push(R)}if(m){const R=P.NORMAL!==void 0?d.getDependency("accessor",P.NORMAL):a.attributes.normal;E.push(R)}if(A){const R=P.COLOR_0!==void 0?d.getDependency("accessor",P.COLOR_0):a.attributes.color;M.push(R)}}return Promise.all([Promise.all(x),Promise.all(E),Promise.all(M)]).then(function(T){const O=T[0],P=T[1],R=T[2];return p&&(a.morphAttributes.position=O),m&&(a.morphAttributes.normal=P),A&&(a.morphAttributes.color=R),a.morphTargetsRelative=!0,a})}(s,e.targets,t):s})}function bu(s,e){let t=s.getIndex();if(t===null){const a=[],c=s.getAttribute("position");if(c===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s;for(let d=0;d<c.count;d++)a.push(d);s.setIndex(a),t=s.getIndex()}const n=t.count-2,r=[];if(e===f.z$h)for(let a=1;a<=n;a++)r.push(t.getX(0)),r.push(t.getX(a)),r.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2==0?(r.push(t.getX(a)),r.push(t.getX(a+1)),r.push(t.getX(a+2))):(r.push(t.getX(a+2)),r.push(t.getX(a+1)),r.push(t.getX(a)));r.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(r),o}class Mm extends Ja{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,t){const n=await super.loadAsync(e,t),r=n?n.scene||n.scenes&&n.scenes.length>0&&n.scenes[0]:void 0;return r&&n.animations.length>0&&(r.animations=n.animations),r.traverse(o=>{o.userData.gltfUUID&&(o.uuid=o.userData.gltfUUID,delete o.userData.gltfUUID)}),r}register(e){return super.register(e)}}class Sc extends f.hH6{constructor(e){super(e),this.type=f.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),r=new f.IEO(n.data,n.width,n.height,f.wk1,this.type);return r.needsUpdate=!0,r.flipY=!0,r.encoding=f.rnI,r.minFilter=f.wem,r.magFilter=f.wem,r.source.data.complete=!0,r}async parseAsync(e,t,n=!1){if(!e.startsWith("data:")){this.responseType="blob";const c=await super.loadAsync(e,t);e=(e=await Nr(c)).replace("application/octet-stream","image/png")}const r=await Jo(e);let o=Uint8Array;return this.type===f.cLu?o=Uint16Array:this.type===f.VzW&&(o=Uint32Array),{data:function(c,d=3,p=Uint16Array,m=!1){let A;const x=c.byteLength>>2,E=new p(x*d);for(let M=0;M<x;M++)A=Math.pow(2,c[4*M+3]-136),m?(E[M*d]=Math.min(c[4*M]*A,65504),E[M*d+1]=Math.min(c[4*M+1]*A,65504),E[M*d+2]=Math.min(c[4*M+2]*A,65504)):(E[M*d]=f.A5E.toHalfFloat(Math.min(c[4*M]*A,65504)),E[M*d+1]=f.A5E.toHalfFloat(Math.min(c[4*M+1]*A,65504)),E[M*d+2]=f.A5E.toHalfFloat(Math.min(c[4*M+2]*A,65504))),d===4&&(E[M*d+3]=f.A5E.toHalfFloat(1));return E}(r.data,4,o,n),width:r.width,height:r.height}}setDataType(e){return this.type=e,this}}class Cd extends f.Gql{constructor(e){super(e),this._imageLoader=new f.S3k(e)}parseTextures2(e,t,n){var r;for(const o of e){const a=(r=o==null?void 0:o.userData)===null||r===void 0?void 0:r.rootPath;if(a&&(!o.image||!t[o.image])){const c=new f.Hw6(this._imageLoader.load(a,n));if(!c)continue;o.image&&(c.uuid=o.image),t[c.uuid]=c,o.image=c.uuid}o.userData=mi(o.userData,void 0,!1,{images:t})}return super.parseTextures(e,t)}parseMaterials2(e,t,n){const r={};return e.forEach(o=>{if(!o)return;const a={...o},c=Object.keys(a);for(const p of c)if(p==="map"||p.endsWith("Map")){const m=a[p];typeof m=="string"&&(t[m]?a[p]=t[m]:(console.warn(`Texture ${m} not found`),delete a[p]))}a.userData&&(a.userData=mi(a.userData,void 0,!1,{textures:t}));const d=n.generateFromTemplateType(a.type,a);d&&(r[o.uuid]=d)}),r}}const Mo="WEBGI_viewer";function ns(s){si.Importers.push(new dr(Mm,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,r=new Cd(t.loadingManager);return n.register(el(r,s)),n.register(Mc()),n.register(Tc(r)),n.register(o=>new Ul(o)),n.register(o=>new Ys(o)),n.register(o=>new wu(o)),n.register(o=>new Md(o)),n.register(o=>{var a,c,d,p,m,A,x,E,M;const T=gs()+".drc",O=gs()+".ktx2",P=(d=(c=(a=o.json)===null||a===void 0?void 0:a.extensionsRequired)===null||c===void 0?void 0:c.includes)===null||d===void 0?void 0:d.call(c,"KHR_draco_mesh_compression");if(P){const I=t.registerFile(T);I&&n.setDRACOLoader(I)}!((A=(m=(p=o.json)===null||p===void 0?void 0:p.extensionsUsed)===null||m===void 0?void 0:m.includes)===null||A===void 0)&&A.call(m,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),o.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const R=(M=(E=(x=o.json)===null||x===void 0?void 0:x.extensionsUsed)===null||E===void 0?void 0:E.includes)===null||M===void 0?void 0:M.call(E,"KHR_texture_basisu");if(R){const I=t.registerFile(O);I&&(n.setKTX2Loader(I),o.options.ktx2Loader=I)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async I=>{P&&t.unregisterFile(T),R&&t.unregisterFile(O);const j=await Sd(o,s,r);I.scene.__importedViewerConfig=j}}}),n}))}const he="WEBGI_light_extras",$a="WEBGI_object3d_extras",To="WEBGI_material_extras",Mc=s=>e=>({name:"__"+$a,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(r=>{var o,a;if(!r.isObject3D)return;const c=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[$a];if(!c)return void(r.isLight&&!r.isAmbientLight&&(r.castShadow=!0));const d=c.castShadow!==void 0||c.receiveShadow!==void 0;c.castShadow!==void 0&&(r.castShadow=c.castShadow),c.receiveShadow!==void 0&&(r.receiveShadow=c.receiveShadow),c.visible!==void 0&&(r.visible=c.visible),c.frustumCulled!==void 0&&(r.frustumCulled=c.frustumCulled),c.renderOrder!==void 0&&(r.renderOrder=c.renderOrder),c.layers!==void 0&&(r.layers.mask=c.layers),d&&(r.userData.__keepShadowDef=!0),delete r.userData.gltfExtensions[$a]})})}}),el=(s,e)=>t=>({name:"__"+To,afterRoot:async n=>{var r,o,a;const c=n.scenes||(n.scene?[n.scene]:[]);for(const d of c){const p=(o=(r=d.userData)===null||r===void 0?void 0:r.gltfExtensions)===null||o===void 0?void 0:o[To],m=p&&await((a=e.getPlugin(ln))===null||a===void 0?void 0:a.importConfigResources(p.resources||{}))||{};d.traverse(A=>{var x,E;const M=A==null?void 0:A.material;if(!(M!=null&&M.isMaterial))return;const T=(E=(x=M.userData)===null||x===void 0?void 0:x.gltfExtensions)===null||E===void 0?void 0:E[To];T&&(T.emissiveIntensity!==void 0&&(M.emissiveIntensity=T.emissiveIntensity),T.fog!==void 0&&(M.fog=T.fog),T.flatShading!==void 0&&(M.flatShading=T.flatShading),T.blending!==void 0&&(M.blending=T.blending),T.side!==void 0&&(M.side=T.side),T.shadowSide!==void 0&&(M.shadowSide=T.shadowSide),T.depthFunc!==void 0&&(M.depthFunc=T.depthFunc),T.depthTest!==void 0&&(M.depthTest=T.depthTest),T.depthWrite!==void 0&&(M.depthWrite=T.depthWrite),T.colorWrite!==void 0&&(M.colorWrite=T.colorWrite),T.wireframe!==void 0&&(M.wireframe=T.wireframe),T.wireframeLinewidth!==void 0&&(M.wireframeLinewidth=T.wireframeLinewidth),T.wireframeLinecap!==void 0&&(M.wireframeLinecap=T.wireframeLinecap),T.wireframeLinejoin!==void 0&&(M.wireframeLinejoin=T.wireframeLinejoin),T.rotation!==void 0&&(M.rotation=T.rotation),T.polygonOffset!==void 0&&(M.polygonOffset=T.polygonOffset),T.polygonOffsetFactor!==void 0&&(M.polygonOffsetFactor=T.polygonOffsetFactor),T.polygonOffsetUnits!==void 0&&(M.polygonOffsetUnits=T.polygonOffsetUnits),T.dithering!==void 0&&(M.dithering=T.dithering),T.alphaToCoverage!==void 0&&(M.alphaToCoverage=T.alphaToCoverage),T.premultipliedAlpha!==void 0&&(M.premultipliedAlpha=T.premultipliedAlpha),T.toneMapped!==void 0&&(M.toneMapped=T.toneMapped),T.reflectivity!==void 0&&(M.reflectivity=T.reflectivity),Object.entries(T).forEach(([O,P])=>{O.startsWith("_")||P&&P.resource&&typeof P.resource=="string"&&(M[O]=mi(P,M[O],!1,m))}),delete M.userData.gltfExtensions[To])}),p&&delete d.userData.gltfExtensions[To]}}}),Tc=s=>e=>({name:"__"+he,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(r=>{var o,a;if(!r.isLight)return;const c=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[he];c&&(!r.shadow&&c.shadow&&console.error("Light has no shadow, cannot import",r,c),c.shadow&&r.shadow&&(c.shadow.bias!==void 0&&(r.shadow.bias=c.shadow.bias),c.shadow.normalBias!==void 0&&(r.shadow.normalBias=c.shadow.normalBias),c.shadow.radius!==void 0&&(r.shadow.radius=c.shadow.radius),c.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(c.shadow.mapSize),c.shadow.camera!==void 0&&(r.shadow.camera=s.parseObject(c.shadow.camera))),delete r.userData.gltfExtensions[he])})})}});async function Sd(s,e,t,n){var r;if(!n){const d=s.json.scenes||[];if(d.length!==1){for(const p of d)await Sd(s,e,p);return}n=d[0]}const o=(r=n.extensions)===null||r===void 0?void 0:r[Mo];if(!o)return;const a=[];Object.values(o.resources).forEach(d=>{Object.values(d).forEach(p=>{p.url&&(p.url.type==="Uint16Array"&&p.url.data&&a.push(p.url),p.url.type==="Uint8Array"&&p.url.data&&a.push(p.url))})});for(const d of a){const p=d.data.image,m=s.json.images[p],A=await s.getDependency("bufferView",m.bufferView);if(m.mimeType.startsWith("image/")&&d.type==="Uint16Array"&&d.encoding==="rgbe"){const x=new Blob([A],{type:m.mimeType}),E="data:image/png;base64,"+btoa(await x.text());d.data=(await new Sc().parseAsync(E,void 0,!0)).data,delete d.encoding}else d.data=A}const c={textures:{}};if(o.resources.textures&&s.json.textures)for(const[d,p]of Object.entries(o.resources.textures)){if(p.uuid||!d)continue;delete o.resources.textures[d];const m=s.json.textures.findIndex(A=>{var x,E,M,T,O,P,R;return((x=A.extras)===null||x===void 0?void 0:x.uuid)===d||((T=(M=(E=s.json.samplers)===null||E===void 0?void 0:E[A.sampler])===null||M===void 0?void 0:M.extras)===null||T===void 0?void 0:T.uuid)===d||((R=(P=(O=s.json.images)===null||O===void 0?void 0:O[A.source])===null||P===void 0?void 0:P.extras)===null||R===void 0?void 0:R.t_uuid)===d});m>=0&&(c.textures[d]=await s.getDependency("texture",m))}if(o.resources.materials&&s.json.materials)for(const[d,p]of Object.entries(o.resources.materials)){if(p.uuid||!d)continue;delete o.resources.materials[d];const m=s.json.materials.findIndex(A=>{var x;return((x=A.extras)===null||x===void 0?void 0:x.uuid)===d});m>=0&&(c.materials[d]=await s.getDependency("material",m))}return o.resources=await e.getPlugin(ln).importConfigResources(o.resources||{},t,c),o}const $o="WEBGI_materials_bumpmap",Nl="WEBGI_materials_displacementmap",tl="WEBGI_materials_alphamap",ea="WEBGI_materials_lightmap";class Ul{constructor(e){this.parser=e,this.name=$o}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.bumpScale!==void 0&&(t.bumpScale=a.bumpScale),a.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(o)}}class Ys{constructor(e){this.parser=e,this.name=Nl}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.displacementScale!==void 0&&(t.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(t.displacementBias=a.displacementBias),a.displacementTexture!==void 0&&o.push(n.assignTexture(t,"displacementMap",a.displacementTexture)),Promise.all(o)}}class wu{constructor(e){this.parser=e,this.name=ea}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.lightMapIntensity!==void 0&&(t.lightMapIntensity=a.lightMapIntensity),a.lightMapTexture!==void 0&&o.push(n.assignTexture(t,"lightMap",a.lightMapTexture)),Promise.all(o)}}class Md{constructor(e){this.parser=e,this.name=tl}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.alphaTexture!==void 0&&o.push(n.assignTexture(t,"alphaMap",a.alphaTexture)),Promise.all(o)}}var Ic=__webpackgi_require__(23);function Fl(){si.Importers.push(new dr(Ic.Q,["drc"],!0))}var Td={},vi=Uint8Array,Zi=Uint16Array,Io=Uint32Array,so=new vi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Do=new vi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Or=new vi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Id=function(s,e){for(var t=new Zi(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var r=new Io(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return[t,r]},xu=Id(so,2),xa=xu[0],Eu=xu[1];xa[28]=258,Eu[258]=28;for(var Sh=Id(Do,0),Dd=Sh[0],jl=Sh[1],Gn=new Zi(32768),Ni=0;Ni<32768;++Ni){var Gr=(43690&Ni)>>>1|(21845&Ni)<<1;Gr=(61680&(Gr=(52428&Gr)>>>2|(13107&Gr)<<2))>>>4|(3855&Gr)<<4,Gn[Ni]=((65280&Gr)>>>8|(255&Gr)<<8)>>>1}var Po=function(s,e,t){for(var n=s.length,r=0,o=new Zi(e);r<n;++r)++o[s[r]-1];var a,c=new Zi(e);for(r=0;r<e;++r)c[r]=c[r-1]+o[r-1]<<1;if(t){a=new Zi(1<<e);var d=15-e;for(r=0;r<n;++r)if(s[r])for(var p=r<<4|s[r],m=e-s[r],A=c[s[r]-1]++<<m,x=A|(1<<m)-1;A<=x;++A)a[Gn[A]>>>d]=p}else for(a=new Zi(n),r=0;r<n;++r)s[r]&&(a[r]=Gn[c[s[r]-1]++]>>>15-s[r]);return a},nl=new vi(288);for(Ni=0;Ni<144;++Ni)nl[Ni]=8;for(Ni=144;Ni<256;++Ni)nl[Ni]=9;for(Ni=256;Ni<280;++Ni)nl[Ni]=7;for(Ni=280;Ni<288;++Ni)nl[Ni]=8;var Hr=new vi(32);for(Ni=0;Ni<32;++Ni)Hr[Ni]=5;var Cu=Po(nl,9,0),Xs=Po(nl,9,1),Np=Po(Hr,5,0),Mh=Po(Hr,5,1),ta=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Ps=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},il=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},Dc=function(s){return(s/8|0)+(7&s&&1)},is=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Zi?Zi:s instanceof Io?Io:vi)(t-e);return n.set(s.subarray(e,t)),n},oo=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new vi(0);var r=!e||t,o=!t||t.i;t||(t={}),e||(e=new vi(3*n));var a=function(yn){var yt=e.length;if(yn>yt){var Yn=new vi(Math.max(2*yt,yn));Yn.set(e),e=Yn}},c=t.f||0,d=t.p||0,p=t.b||0,m=t.l,A=t.d,x=t.m,E=t.n,M=8*n;do{if(!m){t.f=c=Ps(s,d,1);var T=Ps(s,d+1,3);if(d+=3,!T){var O=s[(ge=Dc(d)+4)-4]|s[ge-3]<<8,P=ge+O;if(P>n){if(o)throw"unexpected EOF";break}r&&a(p+O),e.set(s.subarray(ge,P),p),t.b=p+=O,t.p=d=8*P;continue}if(T==1)m=Xs,A=Mh,x=9,E=5;else{if(T!=2)throw"invalid block type";var R=Ps(s,d,31)+257,I=Ps(s,d+10,15)+4,j=R+Ps(s,d+5,31)+1;d+=14;for(var z=new vi(j),V=new vi(19),G=0;G<I;++G)V[Or[G]]=Ps(s,d+3*G,7);d+=3*I;var X=ta(V),ne=(1<<X)-1,ce=Po(V,X,1);for(G=0;G<j;){var ge,de=ce[Ps(s,d,ne)];if(d+=15&de,(ge=de>>>4)<16)z[G++]=ge;else{var xe=0,pe=0;for(ge==16?(pe=3+Ps(s,d,3),d+=2,xe=z[G-1]):ge==17?(pe=3+Ps(s,d,7),d+=3):ge==18&&(pe=11+Ps(s,d,127),d+=7);pe--;)z[G++]=xe}}var ye=z.subarray(0,R),Re=z.subarray(R);x=ta(ye),E=ta(Re),m=Po(ye,x,1),A=Po(Re,E,1)}if(d>M){if(o)throw"unexpected EOF";break}}r&&a(p+131072);for(var we=(1<<x)-1,We=(1<<E)-1,ot=d;;ot=d){var ft=(xe=m[il(s,d)&we])>>>4;if((d+=15&xe)>M){if(o)throw"unexpected EOF";break}if(!xe)throw"invalid length/literal";if(ft<256)e[p++]=ft;else{if(ft==256){ot=d,m=null;break}var nt=ft-254;if(ft>264){var Rt=so[G=ft-257];nt=Ps(s,d,(1<<Rt)-1)+xa[G],d+=Rt}var Nt=A[il(s,d)&We],Ut=Nt>>>4;if(!Nt)throw"invalid distance";if(d+=15&Nt,Re=Dd[Ut],Ut>3&&(Rt=Do[Ut],Re+=il(s,d)&(1<<Rt)-1,d+=Rt),d>M){if(o)throw"unexpected EOF";break}r&&a(p+131072);for(var Ht=p+nt;p<Ht;p+=4)e[p]=e[p-Re],e[p+1]=e[p+1-Re],e[p+2]=e[p+2-Re],e[p+3]=e[p+3-Re];p=Ht}}t.l=m,t.p=ot,t.b=p,m&&(c=1,t.m=x,t.d=A,t.n=E)}while(!c);return p==e.length?e:is(e,0,p)},ys=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},Ea=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},Pd=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return[ei,0];if(r==1){var a=new vi(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(z,V){return z.f-V.f}),t.push({s:-1,f:25001});var c=t[0],d=t[1],p=0,m=1,A=2;for(t[0]={s:-1,f:c.f+d.f,l:c,r:d};m!=r-1;)c=t[t[p].f<t[A].f?p++:A++],d=t[p!=m&&t[p].f<t[A].f?p++:A++],t[m++]={s:-1,f:c.f+d.f,l:c,r:d};var x=o[0].s;for(n=1;n<r;++n)o[n].s>x&&(x=o[n].s);var E=new Zi(x+1),M=zl(t[m-1],E,0);if(M>e){n=0;var T=0,O=M-e,P=1<<O;for(o.sort(function(z,V){return E[V.s]-E[z.s]||z.f-V.f});n<r;++n){var R=o[n].s;if(!(E[R]>e))break;T+=P-(1<<M-E[R]),E[R]=e}for(T>>>=O;T>0;){var I=o[n].s;E[I]<e?T-=1<<e-E[I]++-1:++n}for(;n>=0&&T;--n){var j=o[n].s;E[j]==e&&(--E[j],++T)}M=e}return[new vi(E),M]},zl=function(s,e,t){return s.s==-1?Math.max(zl(s.l,e,t+1),zl(s.r,e,t+1)):e[s.s]=t},Th=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Zi(++e),n=0,r=s[0],o=1,a=function(d){t[n++]=d},c=1;c<=e;++c)if(s[c]==r&&c!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=s[c]}return[t.subarray(0,n),e]},Pc=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},Ql=function(s,e,t){var n=t.length,r=Dc(e+2);s[r]=255&n,s[r+1]=n>>>8,s[r+2]=255^s[r],s[r+3]=255^s[r+1];for(var o=0;o<n;++o)s[r+o+4]=t[o];return 8*(r+4+n)},Rd=function(s,e,t,n,r,o,a,c,d,p,m){ys(e,m++,t),++r[256];for(var A=Pd(r,15),x=A[0],E=A[1],M=Pd(o,15),T=M[0],O=M[1],P=Th(x),R=P[0],I=P[1],j=Th(T),z=j[0],V=j[1],G=new Zi(19),X=0;X<R.length;++X)G[31&R[X]]++;for(X=0;X<z.length;++X)G[31&z[X]]++;for(var ne=Pd(G,7),ce=ne[0],ge=ne[1],de=19;de>4&&!ce[Or[de-1]];--de);var xe,pe,ye,Re,we=p+5<<3,We=Pc(r,nl)+Pc(o,Hr)+a,ot=Pc(r,x)+Pc(o,T)+a+14+3*de+Pc(G,ce)+(2*G[16]+3*G[17]+7*G[18]);if(we<=We&&we<=ot)return Ql(e,m,s.subarray(d,d+p));if(ys(e,m,1+(ot<We)),m+=2,ot<We){xe=Po(x,E,0),pe=x,ye=Po(T,O,0),Re=T;var ft=Po(ce,ge,0);for(ys(e,m,I-257),ys(e,m+5,V-1),ys(e,m+10,de-4),m+=14,X=0;X<de;++X)ys(e,m+3*X,ce[Or[X]]);m+=3*de;for(var nt=[R,z],Rt=0;Rt<2;++Rt){var Nt=nt[Rt];for(X=0;X<Nt.length;++X){var Ut=31&Nt[X];ys(e,m,ft[Ut]),m+=ce[Ut],Ut>15&&(ys(e,m,Nt[X]>>>5&127),m+=Nt[X]>>>12)}}}else xe=Cu,pe=nl,ye=Np,Re=Hr;for(X=0;X<c;++X)if(n[X]>255){Ut=n[X]>>>18&31,Ea(e,m,xe[Ut+257]),m+=pe[Ut+257],Ut>7&&(ys(e,m,n[X]>>>23&31),m+=so[Ut]);var Ht=31&n[X];Ea(e,m,ye[Ht]),m+=Re[Ht],Ht>3&&(Ea(e,m,n[X]>>>5&8191),m+=Do[Ht])}else Ea(e,m,xe[n[X]]),m+=pe[n[X]];return Ea(e,m,xe[256]),m+pe[256]},Up=new Io([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ei=new vi(0),Ro=function(s,e,t,n,r,o){var a=s.length,c=new vi(n+a+5*(1+Math.ceil(a/7e3))+r),d=c.subarray(n,c.length-r),p=0;if(!e||a<8)for(var m=0;m<=a;m+=65535){var A=m+65535;A<a?p=Ql(d,p,s.subarray(m,A)):(d[m]=o,p=Ql(d,p,s.subarray(m,a)))}else{for(var x=Up[e-1],E=x>>>13,M=8191&x,T=(1<<t)-1,O=new Zi(32768),P=new Zi(T+1),R=Math.ceil(t/3),I=2*R,j=function(zi){return(s[zi]^s[zi+1]<<R^s[zi+2]<<I)&T},z=new Io(25e3),V=new Zi(288),G=new Zi(32),X=0,ne=0,ce=(m=0,0),ge=0,de=0;m<a;++m){var xe=j(m),pe=32767&m,ye=P[xe];if(O[pe]=ye,P[xe]=pe,ge<=m){var Re=a-m;if((X>7e3||ce>24576)&&Re>423){p=Rd(s,d,0,z,V,G,ne,ce,de,m-de,p),ce=X=ne=0,de=m;for(var we=0;we<286;++we)V[we]=0;for(we=0;we<30;++we)G[we]=0}var We=2,ot=0,ft=M,nt=pe-ye&32767;if(Re>2&&xe==j(m-nt))for(var Rt=Math.min(E,Re)-1,Nt=Math.min(32767,m),Ut=Math.min(258,Re);nt<=Nt&&--ft&&pe!=ye;){if(s[m+We]==s[m+We-nt]){for(var Ht=0;Ht<Ut&&s[m+Ht]==s[m+Ht-nt];++Ht);if(Ht>We){if(We=Ht,ot=nt,Ht>Rt)break;var yn=Math.min(nt,Ht-2),yt=0;for(we=0;we<yn;++we){var Yn=m-nt+we+32768&32767,ai=Yn-O[Yn]+32768&32767;ai>yt&&(yt=ai,ye=Yn)}}}nt+=(pe=ye)-(ye=O[pe])+32768&32767}if(ot){z[ce++]=268435456|Eu[We]<<18|jl[ot];var Xn=31&Eu[We],Ci=31&jl[ot];ne+=so[Xn]+Do[Ci],++V[257+Xn],++G[Ci],ge=m+We,++X}else z[ce++]=s[m],++V[s[m]]}}p=Rd(s,d,o,z,V,G,ne,ce,de,m-de,p),!o&&7&p&&(p=Ql(d,p+1,ei))}return is(c,0,n+Dc(p)+r)},Ca=function(){for(var s=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;s[e]=t}return s}(),Rs=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=Ca[255&t^e[n]]^t>>>8;s=t},d:function(){return~s}}},na=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,o=t.length,a=0;a!=o;){for(var c=Math.min(a+2655,o);a<c;++a)r+=n+=t[a];n=(65535&n)+15*(n>>16),r=(65535&r)+15*(r>>16)}s=n,e=r},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Bo=function(s,e,t,n,r){return Ro(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!r)},ko=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},Bd=function(s,e,t){for(var n=s(),r=s.toString(),o=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var c=n[a],d=o[a];if(typeof c=="function"){e+=";"+d+"=";var p=c.toString();if(c.prototype)if(p.indexOf("[native code]")!=-1){var m=p.indexOf(" ",8)+1;e+=p.slice(m,p.indexOf("(",m))}else for(var A in e+=p,c.prototype)e+=";"+d+".prototype."+A+"="+c.prototype[A].toString();else e+=p}else t[d]=c}return[e,t]},Su=[],kd=function(s,e,t,n){var r;if(!Su[t]){for(var o="",a={},c=s.length-1,d=0;d<c;++d)o=(r=Bd(s[d],o,a))[0],a=r[1];Su[t]=Bd(s[c],o,a)}var p=ko({},Su[t][1]);return function(m,A,x,E,M){var T=new Worker(Td[A]||(Td[A]=URL.createObjectURL(new Blob([m],{type:"text/javascript"}))));return T.onerror=function(O){return M(O.error,null)},T.onmessage=function(O){return M(null,O.data)},T.postMessage(x,E),T}(Su[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,p,function(m){var A=[];for(var x in m)(m[x]instanceof vi||m[x]instanceof Zi||m[x]instanceof Io)&&A.push((m[x]=new m[x].constructor(m[x])).buffer);return A}(p),n)},Vl=function(){return[vi,Zi,Io,so,Do,Or,xa,Dd,Xs,Mh,Gn,Po,ta,Ps,il,Dc,is,oo,bs,Oo,ji]},rs=function(){return[vi,Zi,Io,so,Do,Or,Eu,jl,Cu,nl,Np,Hr,Gn,Up,ei,Po,ys,Ea,Pd,zl,Th,Pc,Ql,Rd,Dc,is,Ro,Bo,wn,Oo]},Tm=function(){return[v,Y,D,Rs,Ca]},ss=function(){return[w,N]},Sa=function(){return[fe,D,na]},br=function(){return[Me]},Oo=function(s){return postMessage(s,[s.buffer])},ji=function(s){return s&&s.size&&new vi(s.size)},Mu=function(s,e,t,n,r,o){var a=kd(t,n,r,function(c,d){a.terminate(),o(c,d)});return a.postMessage([s,e],e.consume?[s.buffer]:[]),function(){a.terminate()}},Lo=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},Tu=function(s,e,t,n,r){var o,a=kd(s,n,r,function(c,d){c?(a.terminate(),e.ondata.call(e,c)):(d[1]&&a.terminate(),e.ondata.call(e,c,d[0],d[1]))});a.postMessage(t),e.push=function(c,d){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([c,o=d],[c.buffer])},e.terminate=function(){a.terminate()}},Bs=function(s,e){return s[e]|s[e+1]<<8},fr=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},Fp=function(s,e){return fr(s,e)+4294967296*fr(s,e+4)},D=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},v=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&D(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},w=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;4&e&&(t+=s[10]|2+(s[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(2&e)},N=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},Y=function(s){return 10+(s.filename&&s.filename.length+1||0)},fe=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},Me=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function ut(s,e){return e||typeof s!="function"||(e=s,s={}),this.ondata=e,s}var Ot=function(){function s(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(Bo(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),Tn=function(){return function(s,e){Tu([rs,function(){return[Lo,Ot]}],this,ut.call(this,s,e),function(t){var n=new Ot(t.data);onmessage=Lo(n)},6)}}();function Ln(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[rs],function(n){return Oo(wn(n.data[0],n.data[1]))},0,t)}function wn(s,e){return Bo(s,e||{},0,0)}var $i=function(){function s(e){this.s={},this.p=new vi(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new vi(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=oo(this.p,this.o,this.s);this.ondata(is(n,t,this.s.b),this.d),this.o=is(n,this.s.b-32768),this.s.b=this.o.length,this.p=is(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),Sr=function(){return function(s){this.ondata=s,Tu([Vl,function(){return[Lo,$i]}],this,0,function(){var e=new $i;onmessage=Lo(e)},7)}}();function No(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[Vl],function(n){return Oo(bs(n.data[0],ji(n.data[1])))},1,t)}function bs(s,e){return oo(s,e)}var ao=function(){function s(e,t){this.c=Rs(),this.l=0,this.v=1,Ot.call(this,e,t)}return s.prototype.push=function(e,t){Ot.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Bo(e,this.o,this.v&&Y(this.o),t&&8,!t);this.v&&(v(n,this.o),this.v=0),t&&(D(n,n.length-8,this.c.d()),D(n,n.length-4,this.l)),this.ondata(n,t)},s}(),ia=function(){return function(s,e){Tu([rs,Tm,function(){return[Lo,Ot,ao]}],this,ut.call(this,s,e),function(t){var n=new ao(t.data);onmessage=Lo(n)},8)}}();function Rc(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[rs,Tm,function(){return[Gl]}],function(n){return Oo(Gl(n.data[0],n.data[1]))},2,t)}function Gl(s,e){e||(e={});var t=Rs(),n=s.length;t.p(s);var r=Bo(s,e,Y(e),8),o=r.length;return v(r,e),D(r,o-8,t.d()),D(r,o-4,n),r}var Iu=function(){function s(e){this.v=1,$i.call(this,e)}return s.prototype.push=function(e,t){if($i.prototype.e.call(this,e),this.v){var n=this.p.length>3?w(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$i.prototype.c.call(this,t)},s}(),Ih=function(){return function(s){this.ondata=s,Tu([Vl,ss,function(){return[Lo,$i,Iu]}],this,0,function(){var e=new Iu;onmessage=Lo(e)},9)}}();function Dh(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[Vl,ss,function(){return[Ph]}],function(n){return Oo(Ph(n.data[0]))},3,t)}function Ph(s,e){return oo(s.subarray(w(s),-8),e||new vi(N(s)))}var Od=function(){function s(e,t){this.c=na(),this.v=1,Ot.call(this,e,t)}return s.prototype.push=function(e,t){Ot.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=Bo(e,this.o,this.v&&2,t&&4,!t);this.v&&(fe(n,this.o),this.v=0),t&&D(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),Im=function(){return function(s,e){Tu([rs,Sa,function(){return[Lo,Ot,Od]}],this,ut.call(this,s,e),function(t){var n=new Od(t.data);onmessage=Lo(n)},10)}}();function Dm(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[rs,Sa,function(){return[jp]}],function(n){return Oo(jp(n.data[0],n.data[1]))},4,t)}function jp(s,e){e||(e={});var t=na();t.p(s);var n=Bo(s,e,2,4);return fe(n,e),D(n,n.length-4,t.d()),n}var Rh=function(){function s(e){this.v=1,$i.call(this,e)}return s.prototype.push=function(e,t){if($i.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$i.prototype.c.call(this,t)},s}(),os=function(){return function(s){this.ondata=s,Tu([Vl,br,function(){return[Lo,$i,Rh]}],this,0,function(){var e=new Rh;onmessage=Lo(e)},11)}}();function zp(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Mu(s,e,[Vl,br,function(){return[Ma]}],function(n){return Oo(Ma(n.data[0],ji(n.data[1])))},5,t)}function Ma(s,e){return oo((Me(s),s.subarray(2,-4)),e)}var Du=function(){function s(e){this.G=Iu,this.I=$i,this.Z=Rh,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new vi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},s}(),Ks=function(){function s(e){this.G=Ih,this.I=Sr,this.Z=os,this.ondata=e}return s.prototype.push=function(e,t){Du.prototype.push.call(this,e,t)},s}();function F_(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?Dh(s,e,t):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?No(s,e,t):zp(s,e,t)}function rl(s,e){return s[0]==31&&s[1]==139&&s[2]==8?Ph(s,e):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?bs(s,e):Ma(s,e)}var Ld=function(s,e,t,n){for(var r in s){var o=s[r],a=e+r;o instanceof vi?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],ko(n,o[1])]:Ld(o,a+"/",t,n)}},ws=typeof TextEncoder<"u"&&new TextEncoder,Pu=typeof TextDecoder<"u"&&new TextDecoder,Lv=0;try{Pu.decode(ei,{stream:!0}),Lv=1}catch{}var Nd=function(s){for(var e="",t=0;;){var n=s[t++],r=(n>127)+(n>223)+(n>239);if(t+r>s.length)return[e,is(s,t-1)];r?r==3?(n=((15&n)<<18|(63&s[t++])<<12|(63&s[t++])<<6|63&s[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&r?String.fromCharCode((31&n)<<6|63&s[t++]):String.fromCharCode((15&n)<<12|(63&s[t++])<<6|63&s[t++]):e+=String.fromCharCode(n)}},j_=function(){function s(e){this.ondata=e,Lv?this.t=new TextDecoder:this.p=ei}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new vi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Nd(n),o=r[0],a=r[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,t)}},s}(),Nv=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Ru(e),this.d=t||!1)},s}();function Ru(s,e){if(e){for(var t=new vi(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(ws)return ws.encode(s);var r=s.length,o=new vi(s.length+(s.length>>1)),a=0,c=function(m){o[a++]=m};for(n=0;n<r;++n){if(a+5>o.length){var d=new vi(a+8+(r-n<<1));d.set(o),o=d}var p=s.charCodeAt(n);p<128||e?c(p):p<2048?(c(192|p>>6),c(128|63&p)):p>55295&&p<57344?(c(240|(p=65536+(1047552&p)|1023&s.charCodeAt(++n))>>18),c(128|p>>12&63),c(128|p>>6&63),c(128|63&p)):(c(224|p>>12),c(128|p>>6&63),c(128|63&p))}return is(o,0,a)}function Uv(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}if(Pu)return Pu.decode(s);var r=Nd(s),o=r[0];if(r[1].length)throw"invalid utf-8 data";return o}var Bc=function(s){return s==1?3:s<6?2:s==9?1:0},Bh=function(s,e){return e+30+Bs(s,e+26)+Bs(s,e+28)},Qp=function(s,e,t){var n=Bs(s,e+28),r=Uv(s.subarray(e+46,e+46+n),!(2048&Bs(s,e+8))),o=e+46+n,a=fr(s,e+20),c=t&&a==4294967295?Vp(s,o):[a,fr(s,e+24),fr(s,e+42)],d=c[0],p=c[1],m=c[2];return[Bs(s,e+10),d,p,r,o+Bs(s,e+30)+Bs(s,e+32),m]},Vp=function(s,e){for(;Bs(s,e)!=1;e+=4+Bs(s,e+2));return[Fp(s,e+12),Fp(s,e+4),Fp(s,e+20)]},kc=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Ud=function(s,e,t,n,r,o,a,c){var d=n.length,p=t.extra,m=c&&c.length,A=kc(p);D(s,e,a!=null?33639248:67324752),e+=4,a!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(o==null&&8),s[e++]=r&&8,s[e++]=255&t.compression,s[e++]=t.compression>>8;var x=new Date(t.mtime==null?Date.now():t.mtime),E=x.getFullYear()-1980;if(E<0||E>119)throw"date not in range 1980-2099";if(D(s,e,E<<25|x.getMonth()+1<<21|x.getDate()<<16|x.getHours()<<11|x.getMinutes()<<5|x.getSeconds()>>>1),e+=4,o!=null&&(D(s,e,t.crc),D(s,e+4,o),D(s,e+8,t.size)),D(s,e+12,d),D(s,e+14,A),e+=16,a!=null&&(D(s,e,m),D(s,e+6,t.attrs),D(s,e+10,a),e+=14),s.set(n,e),e+=d,A)for(var M in p){var T=p[M],O=T.length;D(s,e,+M),D(s,e+2,O),s.set(T,e+4),e+=4+O}return m&&(s.set(c,e),e+=m),e},Bu=function(s,e,t,n,r){D(s,e,101010256),D(s,e+8,t),D(s,e+10,t),D(s,e+12,n),D(s,e+16,r)},ii=function(){function s(e){this.filename=e,this.c=Rs(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),un=function(){function s(e,t){var n=this;t||(t={}),ii.call(this,e),this.d=new Ot(t,function(r,o){n.ondata(null,r,o)}),this.compression=8,this.flag=Bc(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){ii.prototype.push.call(this,e,t)},s}(),Uo=function(){function s(e,t){var n=this;t||(t={}),ii.call(this,e),this.d=new Tn(t,function(r,o,a){n.ondata(r,o,a)}),this.compression=8,this.flag=Bc(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){ii.prototype.push.call(this,e,t)},s}(),hw=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Ru(e.filename),r=n.length,o=e.comment,a=o&&Ru(o),c=r!=e.filename.length||a&&o.length!=a.length,d=r+kc(e.extra)+30;if(r>65535)throw"filename too long";var p=new vi(d);Ud(p,0,e,n,c);var m=[p],A=function(){for(var O=0,P=m;O<P.length;O++){var R=P[O];t.ondata(null,R,!1)}m=[]},x=this.d;this.d=0;var E=this.u.length,M=ko(e,{f:n,u:c,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(A(),x){var O=t.u[E+1];O?O.r():t.d=1}x=1}}),T=0;e.ondata=function(O,P,R){if(O)t.ondata(O,P,R),t.terminate();else if(T+=P.length,m.push(P),R){var I=new vi(16);D(I,0,134695760),D(I,4,e.crc),D(I,8,T),D(I,12,e.size),m.push(I),M.c=T,M.b=d+T+16,M.crc=e.crc,M.size=e.size,x&&M.r(),x=1}else x&&A()},this.u.push(M)},s.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,r=0,o=this.u;r<o.length;r++)n+=46+(p=o[r]).f.length+kc(p.extra)+(p.o?p.o.length:0);for(var a=new vi(n+22),c=0,d=this.u;c<d.length;c++){var p=d[c];Ud(a,e,p,p.f,p.u,p.c,t,p.o),e+=46+p.f.length+kc(p.extra)+(p.o?p.o.length:0),t+=p.b}Bu(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},s}();function dw(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Ld(s,"",n,e);var r=Object.keys(n),o=r.length,a=0,c=0,d=o,p=new Array(o),m=[],A=function(){for(var T=0;T<m.length;++T)m[T]()},x=function(){var T=new vi(c+22),O=a,P=c-a;c=0;for(var R=0;R<d;++R){var I=p[R];try{var j=I.c.length;Ud(T,c,I,I.f,I.u,j);var z=30+I.f.length+kc(I.extra),V=c+z;T.set(I.c,V),Ud(T,a,I,I.f,I.u,j,c,I.m),a+=16+z+(I.m?I.m.length:0),c=V+j}catch(G){return t(G,null)}}Bu(T,a,p.length,P,O),t(null,T)};o||x();for(var E=function(T){var O=r[T],P=n[O],R=P[0],I=P[1],j=Rs(),z=R.length;j.p(R);var V=Ru(O),G=V.length,X=I.comment,ne=X&&Ru(X),ce=ne&&ne.length,ge=kc(I.extra),de=I.level==0?0:8,xe=function(pe,ye){if(pe)A(),t(pe,null);else{var Re=ye.length;p[T]=ko(I,{size:z,crc:j.d(),c:ye,f:V,m:ne,u:G!=O.length||ne&&X.length!=ce,compression:de}),a+=30+G+ge+Re,c+=76+2*(G+ge)+(ce||0)+Re,--o||x()}};if(G>65535&&xe("filename too long",null),de)if(z<16e4)try{xe(null,wn(R,I))}catch(pe){xe(pe,null)}else m.push(Ln(R,I,xe));else xe(null,R)},M=0;M<d;++M)E(M);return A}function z_(s,e){e||(e={});var t={},n=[];Ld(s,"",t,e);var r=0,o=0;for(var a in t){var c=t[a],d=c[0],p=c[1],m=p.level==0?0:8,A=(G=Ru(a)).length,x=p.comment,E=x&&Ru(x),M=E&&E.length,T=kc(p.extra);if(A>65535)throw"filename too long";var O=m?wn(d,p):d,P=O.length,R=Rs();R.p(d),n.push(ko(p,{size:d.length,crc:R.d(),c:O,f:G,m:E,u:A!=a.length||E&&x.length!=M,o:r,compression:m})),r+=30+A+T+P,o+=76+2*(A+T)+(M||0)+P}for(var I=new vi(o+22),j=r,z=o-r,V=0;V<n.length;++V){var G=n[V];Ud(I,G.o,G,G.f,G.u,G.c.length);var X=30+G.f.length+kc(G.extra);I.set(G.c,G.o+X),Ud(I,r,G,G.f,G.u,G.c.length,G.o,G.m),r+=16+X+(G.m?G.m.length:0)}return Bu(I,r,n.length,z,j),I}var Q_=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),pw=function(){function s(){var e=this;this.i=new $i(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),fw=function(){function s(e,t){var n=this;t<32e4?this.i=new $i(function(r,o){n.ondata(null,r,o)}):(this.i=new Sr(function(r,o,a){n.ondata(r,o,a)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=is(e,0)),this.i.push(e,t)},s.compression=8,s}(),Pm=function(){function s(e){this.onfile=e,this.k=[],this.o={0:Q_},this.p=ei}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),o=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(r)).length)return this.push(e,t)}else{var a=0,c=0,d=void 0,p=void 0;this.p.length?e.length?((p=new vi(this.p.length+e.length)).set(this.p),p.set(e,this.p.length)):p=this.p:p=e;for(var m=p.length,A=this.c,x=A&&this.d,E=function(){var O,P=fr(p,c);if(P==67324752){a=1,d=c,M.d=null,M.c=0;var R=Bs(p,c+6),I=Bs(p,c+8),j=2048&R,z=8&R,V=Bs(p,c+26),G=Bs(p,c+28);if(m>c+30+V+G){var X=[];M.k.unshift(X),a=2;var ne,ce=fr(p,c+18),ge=fr(p,c+22),de=Uv(p.subarray(c+30,c+=30+V),!j);ce==4294967295?(O=z?[-2]:Vp(p,c),ce=O[0],ge=O[1]):z&&(ce=-1),c+=G,M.c=ce;var xe={name:de,compression:I,start:function(){if(!xe.ondata)throw"no callback";if(ce){var pe=n.o[I];if(!pe)throw"unknown compression type "+I;(ne=ce<0?new pe(de):new pe(de,ce,ge)).ondata=function(We,ot,ft){xe.ondata(We,ot,ft)};for(var ye=0,Re=X;ye<Re.length;ye++){var we=Re[ye];ne.push(we,!1)}n.k[0]==X&&n.c?n.d=ne:ne.push(ei,!0)}else xe.ondata(null,ei,!0)},terminate:function(){ne&&ne.terminate&&ne.terminate()}};ce>=0&&(xe.size=ce,xe.originalSize=ge),M.onfile(xe)}return"break"}if(A){if(P==134695760)return d=c+=12+(A==-2&&8),a=3,M.c=0,"break";if(P==33639248)return d=c-=4,a=3,M.c=0,"break"}},M=this;c<m-4&&E()!=="break";++c);if(this.p=ei,A<0){var T=a?p.subarray(0,d-12-(A==-2&&8)-(fr(p,d-16)==134695760&&4)):p.subarray(0,c);x?x.push(T,!!a):this.k[+(a==2)].push(T)}if(2&a)return this.push(p.subarray(c),t);this.p=p.subarray(c)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function V_(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var x=0;x<t.length;++x)t[x]()},r={},o=s.length-22;fr(s,o)!=101010256;--o)if(!o||s.length-o>65558)return void e("invalid zip file",null);var a=Bs(s,o+8);a||e(null,{});var c=a,d=fr(s,o+16),p=d==4294967295;if(p){if(o=fr(s,o-12),fr(s,o)!=101075792)return void e("invalid zip file",null);c=a=fr(s,o+32),d=fr(s,o+48)}for(var m=function(x){var E=Qp(s,d,p),M=E[0],T=E[1],O=E[2],P=E[3],R=E[4],I=E[5],j=Bh(s,I);d=R;var z=function(G,X){G?(n(),e(G,null)):(r[P]=X,--a||e(null,r))};if(M)if(M==8){var V=s.subarray(j,j+T);if(T<32e4)try{z(null,bs(V,new vi(O)))}catch(G){z(G,null)}else t.push(No(V,{size:O},z))}else z("unknown compression type "+M,null);else z(null,is(s,j,j+T))},A=0;A<c;++A)m();return n}function Rm(s){for(var e={},t=s.length-22;fr(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=Bs(s,t+8);if(!n)return{};var r=fr(s,t+16),o=r==4294967295;if(o){if(t=fr(s,t-12),fr(s,t)!=101075792)throw"invalid zip file";n=fr(s,t+32),r=fr(s,t+48)}for(var a=0;a<n;++a){var c=Qp(s,r,o),d=c[0],p=c[1],m=c[2],A=c[3],x=c[4],E=c[5],M=Bh(s,E);if(r=x,d){if(d!=8)throw"unknown compression type "+d;e[A]=bs(s.subarray(M,M+p),new vi(m))}else e[A]=is(s,M,M+p)}return e}class Bm extends f.hH6{load(e,t,n,r){return this.setResponseType("arraybuffer"),super.load(e,o=>{const a=Rm(new Uint8Array(o)),c=new Map(Object.entries(a).map(([d,p])=>[d,new File([p],d)]));t==null||t(c)},n,r)}}function km(){si.Importers.push(new dr(Bm,["zip"],!0))}class Hl extends f.Ox3{constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new f.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),no(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=yi(no({},t),!1),this.userData={},this.children=n,r.type="DirectionalLight2",r.target=this.target.position.toArray(),Object.assign(r,yi(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,r=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,mi(e,this,!0,t),n&&(e.target=n),r&&(r.color!==void 0&&this.color.set(r.color),r.intensity!==void 0&&(this.intensity=r.intensity),e.object=r),this}}class kh extends f.PMe{constructor(e,t,n,r,o,a){super(e,t,n,r,o,a),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),no(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=yi(no({},t),!1),this.userData={},this.children=n,r.type="SpotLight2",r.target=this.target.position.toArray(),Object.assign(r,yi(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),mi(e,this,!0,t),this):this)}}class Fv extends f.cek{constructor(e,t,n,r){super(e,t,n,r),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),no(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=yi(no({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,yi(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),mi(e,this,!0,t),this):this}}class Om extends f.Mig{constructor(e,t){super(e,t),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),no(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=yi(no({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,yi(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),mi(e,this,!0,t),this):this}}class G_ extends f.aNw{load(e,t,n,r){const o=new f.hH6(this.manager);o.setPath(this.path),o.setResponseType("text"),o.load(e,a=>{try{t(this.parse(a))}catch(c){r?r(c):console.error(c),this.manager.itemError(e)}},n,r)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const r=new f.Pa4(0,0,0),o=new f.Pa4(1,1,1),a=e.split(/[\n\r]+/g);let c=null,d=0;for(let A=0,x=a.length;A<x;A++){const E=a[A].trim(),M=E.split(/\s/g);switch(M[0]){case"TITLE":t=E.substring(7,E.length-1);break;case"LUT_3D_SIZE":const T=M[1];n=parseFloat(T),c=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":r.x=parseFloat(M[1]),r.y=parseFloat(M[2]),r.z=parseFloat(M[3]);break;case"DOMAIN_MAX":o.x=parseFloat(M[1]),o.y=parseFloat(M[2]),o.z=parseFloat(M[3]);break;default:const O=parseFloat(M[0]),P=parseFloat(M[1]),R=parseFloat(M[2]);if(O>1||O<0||P>1||P<0||R>1||R<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");c[d+0]=255*O,c[d+1]=255*P,c[d+2]=255*R,c[d+3]=255,d+=4}}const p=new f.IEO;p.image.data=c,p.image.width=n,p.image.height=n*n,p.type=f.ywz,p.magFilter=f.wem,p.minFilter=f.wem,p.wrapS=f.uWy,p.wrapT=f.uWy,p.generateMipmaps=!1,p.needsUpdate=!0;const m=new f.JUT;return m.image.data=c,m.image.width=n,m.image.height=n,m.image.depth=n,m.type=f.ywz,m.magFilter=f.wem,m.minFilter=f.wem,m.wrapS=f.uWy,m.wrapT=f.uWy,m.wrapR=f.uWy,m.generateMipmaps=!1,m.needsUpdate=!0,{title:t,size:n,domainMin:r,domainMax:o,texture:p,texture3D:m}}}class si extends ct{constructor(e,t=!1){super(),this._processors=new vu,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new f.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),km(),Cm(e.renderer.rendererObject),ns(e),Fl()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var t;let n=decodeURI(e);const r=(t=this._rootContext)===null||t===void 0?void 0:t.rootUrl;n.includes("://")||!r||n.startsWith(r)||(n=r+n),n=n.replace("./",""),n=n.replace(/^(\/\/)/,"/"),n=n.replace(/\?.*$/,"");const o=this._fileDatabase.get(n);return o?o.ext?(o.objectUrl||(o.objectUrl=URL.createObjectURL(o)+"#"+n),o.objectUrl):(console.error("Unable to determine file extension",o),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(r=>{const o=new RegExp(r.startsWith("data:")?"^"+r+"\\/":"\\."+r+"$","i");this._loadingManager.addHandler(o,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:r}=t;if(r&&r.length<1&&(r=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const o=[],a=[];if(e.forEach((c,d)=>{var p;this.registerFile(d,c);const m=c.ext;m&&((p=r==null?void 0:r.includes(m.toLowerCase()))===null||p===void 0||p)&&(this._isRootFileExtension(m)?o.push(d):a.push(d))}),o.length>0)for(const c of o){let d=await this._importFile(c,void 0,t);d&&(d=await this.processImported(d,t)),n.set(c,d)}else for(const c of a){let d=await this._importFile(c,void 0,t);d&&(d=await this.processImported(d,t)),n.set(c,d)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((c,d)=>{this.unregisterFile(d)}),n}registerFile(e,t){var n,r,o;e=e.replace(/\?.*$/,"");const a=(n=t==null?void 0:t.ext)!==null&&n!==void 0?n:(o=_d((r=t==null?void 0:t.name)!==null&&r!==void 0?r:e))===null||o===void 0?void 0:o.toLowerCase();t&&(t.ext||(t.ext=a),this._fileDatabase.set(e,t));let c=this._getLoader(e);if(c||(c=this._createLoader(t??{name:e,ext:a})),c){for(const d of this._loaderCache)if(d.loader===c){d.files.push(e);break}}return c}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return si.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},r){var o,a;if(!((o=t)===null||o===void 0)&&o.__imported)return t.__imported;let c;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t),n.rootPath=e;const d=this.resolveURL(e),p=e.replace(/\?.*$/,""),m=(a=n.fileHandler)!==null&&a!==void 0?a:await this._loadingManager.getHandler(p)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0);if(!m)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:d,rootUrl:f.Zp0.extractUrlBase(e),baseUrl:f.Zp0.extractUrlBase(d)},c=await m.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),A=>{r&&r(A),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:A.loaded/A.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(d){return console.error("AssetImporter: Unable to import file",e,t),console.error(d),console.error(d==null?void 0:d.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:d}),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),t&&(t.__imported=c),c}_getImporter(e,t=!1){return si.Importers.find(n=>{if(t&&!n.root)return!1;const r=n.ext.find(o=>{var a,c,d;return e.ext&&o===e.ext.toLowerCase()||((c=(a=e.name)===null||a===void 0?void 0:a.toLowerCase())===null||c===void 0?void 0:c.endsWith("."+o.toLowerCase()))||(o==null?void 0:o.startsWith("data:"))&&((d=e.name)===null||d===void 0?void 0:d.startsWith(o))});return!!r&&(e.ext=r,!0)})}_getLoader(e){var t;return(t=this._loadingManager.getHandler(e))!==null&&t!==void 0?t:void 0}async importAsset(e,t={},n){var r;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const c=this._cachedAssets.find(d=>d.path===e.path);c&&Object.assign(e,c)}const a=this._cachedAssets.findIndex(c=>c.path===e.path);a>=0&&this._cachedAssets.splice(a,1),this._cachedAssets.push(e)}let o;if(e!=null&&e.preImported&&(o=await e.preImported),!t.forceImport&&o){const a=await this.processImported(o,t);let c=!1;for(const d of a)if(d.__disposed){c=!0;break}if(!c||t.reimportDisposed===!1)return a}return e.preImported=this._importFile(t.pathOverride||e.path,typeof((r=e.file)===null||r===void 0?void 0:r.arrayBuffer)=="function"?e.file:void 0,t,n),o=await e.preImported,o&&(o=await this.processImported(o,t)),o}async importSingle(e,t={}){var n;return(n=await this.importAsset(e,t))===null||n===void 0?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))===null||n===void 0?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed;const r=JSON.stringify(n);let o;return o=this._cachedAssets.find(a=>a.path===e&&a._options===r)||{path:e},o._options=r,await this.importAsset(o,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var n,r,o,a,c,d,p,m;let A=e;if(!A)return[];if(t.processImported===!1)return[A];if(Array.isArray(A)){const x=[];for(const E of A)x.push(...await this.processImported(E,t));return x}if(!((n=A.userData)===null||n===void 0)&&n.rootSceneModelRoot){if(t._rootSceneImported=!0,A.__processedChildren&&!t.forceImporterReprocess)return A.__processedChildren;if(!(A.children.length<1))return A.animations&&(A.children[0].animations||(A.children[0].animations=[]),A.children[0].animations.push(...A.animations)),A.__importedViewerConfig&&(A.children[0].__importedViewerConfig=A.__importedViewerConfig),A.__processedChildren=await this.processImported([...A.children],t),A.__processedChildren;if(((r=A.animations)===null||r===void 0?void 0:r.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",A.animations),!A.__importedViewerConfig)return[];A=A.__importedViewerConfig}if(!((o=A.userData)===null||o===void 0)&&o.iModel&&(A=A.userData.iModel),!((a=A.userData)===null||a===void 0)&&a.iMaterial&&(A=A.userData.iMaterial),A.assetImporterProcessed&&!t.forceImporterReprocess)return[A];if(!A.assetType){if(A.isBufferGeometry&&(A=new f.Kj0(A,new f.Wid)),A.isObject3D){if(A.isLight)A=jv(A);else{const x=[];A.traverse(E=>{E!==A&&E.isLight&&x.push(E)});for(const E of x)jv(E);A=new Ka(A,t)}!t.rootPath||A.modelObject.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(A.modelObject.userData.rootPath=t.rootPath)}A.isTexture&&(A.assetType="texture",t._testDataTextureComplete&&(A.isDataTexture&&(!((c=A.image)===null||c===void 0)&&c.data)&&(A.image.complete=!0),!((d=A.image)===null||d===void 0)&&d.complete&&(A.needsUpdate=!0)),t.generateMipmaps!==void 0&&(A.generateMipmaps=t.generateMipmaps),A.generateMipmaps||A.isRenderTargetTexture||(A.minFilter=A.minFilter===f.D1R?f.wem:A.minFilter,A.magFilter=A.magFilter===f.D1R?f.wem:A.magFilter),!t.rootPath||A.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(A.userData.rootPath=t.rootPath)),A.isMaterial&&(A.assetType="material",!t.rootPath||A.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(A.userData.rootPath=t.rootPath))}if(A.assetType!=null)return A=await this._processors.process(A.assetType,A,{}),A.assetImporterProcessed=!0,[A];if(A instanceof Map)return[...(await this.importFiles(A,t)).values()].flat();if(A.type){const x=this._viewer.getPluginByType(A.type);if(x){let E=A._importedResources||{};return A.resources&&(E=await((p=this._viewer.getManager())===null||p===void 0?void 0:p.importConfigResources(A.resources)),delete A.resources,A._importedResources=E),typeof x.fromJSON=="function"&&(await Promise.resolve(x.fromJSON(A,E)),A.assetImporterProcessed=!1),[]}}else if(A.plugins)return A.resources=await((m=this._viewer.getManager())===null||m===void 0?void 0:m.importConfigResources(A.resources)),await this._viewer.getManager().importViewerConfig(A),A.assetImporterProcessed=!1,[];return console.warn("unknown asset type: ",A),[A]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function Lm(s){if(!s)return f.ywz;const e=s.extensions.has("EXT_color_buffer_half_float")||s.capabilities.isWebGL2&&s.extensions.has("EXT_color_buffer_float"),t=s.capabilities.isWebGL2||s.extensions.has("OES_texture_float")||s.extensions.has("WEBGL_color_buffer_float");return e?f.cLu:t?f.VzW:f.ywz}function jv(s){var e,t,n;if(!s.isLight||s.assetType==="light")return s;if(s.uiConfig)return console.warn("ui config already exists, not supported",s),s;let r;if(s.children.length,s.isDirectionalLight&&(r=new Hl),s.isAmbientLight&&(r=new Om),s.isSpotLight&&(r=new kh),s.isPointLight&&(r=new Fv),r){(t=(e=r.lightObject).copy)===null||t===void 0||t.call(e,s);const o=s.parent;!((n=o)===null||n===void 0)&&n.isObject3D&&(o.remove(s),s.dispose(),s.userData.iModel=r,o.add(r.lightObject),r.uuid=s.uuid),Ao(r.lightObject,o)}else console.warn("unknown light type: ",s);return r}si.Importers=[new dr(yd,["json"],!1),new dr(f.hH6,["txt"],!1),new dr(Sc,["rgbe.png","hdr.png","hdrpng"],!1),new dr(f.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new dr(G_,["CUBE"],!1)];class H_ extends f.u7G{constructor(e){super(e)}async loadAsync(e,t){var n;const r=new f.hH6(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t);try{const a=JSON.parse(o);if(a.images&&this.importer){const c={};let d=a.images;Array.isArray(d)||(d=Object.values(d));for(const p of a.images){if(!p.url||!p.uuid)continue;const m=(n=await this.importer.importPath(p.url,{processImported:!1}))===null||n===void 0?void 0:n[0],A=m==null?void 0:m.source;if(!m||!A)continue;const x=new f.Hw6(A.data);x.uuid=p.uuid,c[x.uuid]=x,m.dispose()}return this.parse(a,c)}return this.parse(a)}catch(a){throw console.error(a),this.manager.itemError(e),a}}parse(e,t){var n,r;let o;const a={p:new Promise(m=>{o=m})};if(e.images||e.textures){const m=new Cd(this.manager);let A={};const x=O=>{o(),a.p=void 0,Object.values(A).forEach(P=>{var R;P.isTexture&&(!((R=P.image)===null||R===void 0)&&R.complete)&&(P.needsUpdate=!0)})};let E=e.images||[];Array.isArray(E)||(E=Object.values(E));const M=t||m.parseImages(E,x);let T=e.textures;Array.isArray(T)||(T=Object.values(T)),A=m.parseTextures2(T,M,x),this.setTextures(A)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const c={...e};if(Object.entries(c).forEach(([m,A])=>{A&&typeof A=="string"&&this.textures[A]&&(c[m]=this.textures[A])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?c.vertexColors=e.vertexColors>0:c.vertexColors=e.vertexColors),e.normalScale!==void 0){let m=e.normalScale;Array.isArray(m)===!1&&(m=[m,m]),c.normalScale=new f.FM8().fromArray(m)}let d=e.type;d!=="MeshPhysicalMaterial"&&d!=="MeshStandardMaterial"||(d=vs.TYPE),c.userData=mi(c.userData,void 0,!1,this);const p=(r=(n=this.materials)===null||n===void 0?void 0:n.generateFromTemplateType(d,c))!==null&&r!==void 0?r:super.parse(e);return this.setTextures({}),p.userData.imageLoadAwaiter=a,p}}class ln extends ct{constructor(e,t,{simpleCache:n=!1,storage:r}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||r)&&(n&&(f.CtF.enabled=!0),r&&window.Cache&&typeof window.Cache=="function"&&r instanceof window.Cache)){const o={...f.CtF};f.CtF.get=(a,c,d)=>c?a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")?Promise.resolve(void 0):r.match(a).then(p=>{if(p)switch(c){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(m=>new DOMParser().parseFromString(m,d??"text/html"));case"json":return p.json();default:if(d===void 0)return p.text();{const m=/charset="?([^;"\s]*)"?/i.exec(d),A=m&&m[1]?m[1].toLowerCase():void 0,x=new TextDecoder(A);return p.arrayBuffer().then(E=>x.decode(E))}}}):o.get(a),f.CtF.add=(a,c,d)=>{d||o.add(a,c),a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")||r.put(a,new Response(c,{status:200}))},f.CtF.remove=(a,c)=>{c||o.remove(a),r.delete(a)}}this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var r;return(r=this._viewer)===null||r===void 0?void 0:r.scene.addSceneObject(n,t)})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,t))===null||n===void 0?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)===null||n===void 0?void 0:n.processImported(e,t).then(r=>(this.addProcessedAssets(r,t),r))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)===null||t===void 0||t.processMaterial(n,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new yc,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new si(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,r)=>(bc(n,o=>{var a;return(a=this._materials)===null||a===void 0?void 0:a.processModel(o,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,r)=>{var o;return!((o=this.materials)===null||o===void 0)&&o.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=ar(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,r)}})),si.Importers.push(new dr(H_,[vs.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);si.Importers.push(new dr(class extends yd{async loadAsync(n,r){return t(await super.loadAsync(n,r))}},[ln.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var t,n;e===this._viewer&&((t=this._importer)===null||t===void 0||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)===null||n===void 0||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e){if(!this._viewer)return{};const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},...e},n=this._viewer.toJSON(t);return n.resources=t,n}exportPluginPresets(e){var t;const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};return{plugins:(t=this._viewer)===null||t===void 0?void 0:t.serializePlugins(n,e),resources:n}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var n;const r=e.type;if(!(t=t||((n=this._viewer)===null||n===void 0?void 0:n.getPluginByType(r))))return void console.warn(`No plugin found for type ${r} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${r} does not support importing presets`);const o=e.resources||{};return e.resources&&delete e.resources,await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const r of Object.values(t.materials))r.__useCount?delete r.__useCount:(n=this._materials)===null||n===void 0||n.unregisterMaterial(r);for(const r of Object.values(t.textures))r.__useCount&&delete r.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var r,o,a;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const c={};t=t??new Cd(this._importer.loadingManager),c.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(c.animations={...c.animations,...n.animations}),c.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(c.shapes={...c.shapes,...n.shapes}),c.geometries=e.geometries?t.parseGeometries(e.geometries,c.shapes):{},n&&n.geometries&&(c.geometries={...c.geometries,...n.geometries}),c.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(c.images={...c.images,...n.images});for(const p of Object.values(e.textures)){const m=(r=p==null?void 0:p.userData)===null||r===void 0?void 0:r.rootPath;if(m&&(!p.image||!c.images[p.image])){const A=(o=await this._importer.importPath(m,{processImported:!1}))===null||o===void 0?void 0:o[0],x=A==null?void 0:A.source;if(!A||!x)continue;const E=new f.Hw6(x.data);p.image&&(E.uuid=p.image),c.images[E.uuid]=E,p.image=E.uuid,A.dispose()}}c.textures=e.textures?t.parseTextures2(Object.values(e.textures),c.images,()=>{Object.values(c.textures).forEach(p=>{var m;p.isTexture&&(!((m=p.image)===null||m===void 0)&&m.complete)&&(p.needsUpdate=!0)})}):{};for(const p of Object.entries(c.textures))p[1]=(a=await this._importer.processImported(p[1],{}))===null||a===void 0?void 0:a[0],p[1]?c.textures[p[0]]=p[1]:delete c.textures[p[0]];n&&n.textures&&(c.textures={...c.textures,...n.textures});const d=e.materials?Object.values(e.materials):[];for(const p of d)Object.entries(p).forEach(([m,A])=>{A&&A.resource&&A.uuid&&A.resource==="textures"&&(p[m]=A.uuid)});return c.materials=t.parseMaterials2(d,c.textures,this._materials),n&&n.materials&&(c.materials={...c.materials,...n.materials}),e.object&&(c.object=t.parseObject(e.object,c.geometries,c.materials,c.textures,c.animations),e.skeletons&&(c.skeletons=t.parseSkeletons(e.skeletons,c.object),t.bindSkeletons(c.object,c.skeletons))),c.__isLoadedResources=!0,c}}ln.PluginType="AssetManager",ln.ViewerTypeSlug="vjson";class Zn extends ct{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=yi(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(mi(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e}),this)}}function Fd(s,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){Te(e,"dirty",n,!0)},update(){var n,r,o;this.passObject.enabled&&((r=(n=this.passObject).updateShaderProperties)===null||r===void 0||r.call(n,ke(t)),(o=e.update)===null||o===void 0||o.call(this))},onRegister(n){var r,o,a;this.passObject.materialExtension&&((o=(r=s.getPlugin(ln))===null||r===void 0?void 0:r.materials)===null||o===void 0||o.registerMaterialExtension(this.passObject.materialExtension)),(a=e.onRegister)===null||a===void 0||a.call(this,n)},onUnregister(n){var r,o,a;this.passObject.materialExtension&&((o=(r=s.getPlugin(ln))===null||r===void 0?void 0:r.materials)===null||o===void 0||o.unregisterMaterialExtension(this.passObject.materialExtension)),(a=e.onUnregister)===null||a===void 0||a.call(this,n)},dispose(){var n,r,o;(r=(n=this.passObject).dispose)===null||r===void 0||r.call(n),(o=e.dispose)===null||o===void 0||o.call(this)}}}class sl extends Zn{constructor(){super(),this._enabledTemp=!0}_update(e){var t;return((t=this._pass)===null||t===void 0?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||this._enabledTemp}set enabled(e){var t;!((t=this._pass)===null||t===void 0)&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Fd(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)===null||t===void 0?void 0:t.dispose)===null||n===void 0||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var t,n;const r=super.toJSON(e);if(!r.type)return r;const o=this.pass;return o&&(r.pass=yi((n=(t=o)===null||t===void 0?void 0:t.passObject)!==null&&n!==void 0?n:o,!1,e)),r}fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;if(e.pass){const o=this.pass;o&&mi(e.pass,(r=(n=o)===null||n===void 0?void 0:n.passObject)!==null&&r!==void 0?r:o,!1,t)}return this}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Ne()],sl.prototype,"enabled",null);const zv=new Set,Qv=new Set;class W_ extends Ri{constructor(e,t,n,r){super(void 0,void 0,t,new Pi(1,1,1),1),this.target=e}render(e,t,n,r,o){const a=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel();this.scene.traverse(({material:p})=>{p&&((p.transparent&&p.userData.renderToDepth||!p.transparent&&p.transmission===0&&p.userData.renderToDepth===!1)&&(zv.add(p),p.transparent=!p.transparent),Math.abs(p.transmission||0)>0&&p.userData.renderToDepth&&(Qv.add([p,p.transmission]),p.transmission=0))}),$t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,r,o)),zv.forEach(p=>p.transparent=!p.transparent),zv.clear(),Qv.forEach(([p,m])=>p.transmission=m),Qv.clear(),e.setRenderTarget(a,c,d)}}class qi extends sl{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var t,n;const r=((t=this._viewer)===null||t===void 0?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,o=e.renderer.createTarget({depthBuffer:!0,type:f.ywz,textureCount:r?2:1});Array.isArray(o.texture)?(o.texture[0].name="gbufferDepthNormal",o.texture[1].name="gbufferFlags",this._gbufferTextures=o.texture):(o.texture.name="gbufferDepthNormal",this._gbufferTextures.push(o.texture)),this._gbufferTarget=o;const a=(n=this._viewer)===null||n===void 0?void 0:n.getPluginByType("debug");return a&&(a.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&a.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),new W_(o,new xo(r))}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return kl}updateShaderProperties(e){var t,n;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(t=this.getDepthNormal())!==null&&t!==void 0?t:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(n=this.getFlagsTexture())!==null&&n!==void 0?n:void 0;const r=e.uniforms.tGBufferFlags.value?1:0;r!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=r,e.needsUpdate=!0)}return this}}qi.PluginType="GBuffer";class q_ extends Ri{constructor(e,t=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new Pi(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new vd({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:f.rnI,type:f.cLu,format:f.wk1,minFilter:f.wem,magFilter:f.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,t,n,r,o){var a;let c=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,r,o),this.needsSwap=c,void(e.userData.mainRenderPass=void 0);const d=e.userData;d||console.error("threejs is not patched?");const p=this._viewer.useGBufferDepth;let m;if(p){const x=(a=this._viewer.getPlugin(qi))===null||a===void 0?void 0:a.getTarget();if(x){const E=e.properties.get(x);m=E.__webglDepthRenderbuffer||E.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let A=()=>{super.render(e,void 0,n,r,o,m)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(c=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const x=e.autoClearDepth;e.autoClearDepth=!p,$t(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},A),e.autoClearDepth=x}if(!p){const x=e.properties.get(n);m=x.__webglDepthRenderbuffer||x.__webglDepthbuffer}A=()=>{super.render(e,void 0,this.transparentTarget,r,o,m)};{const x=this.clear,E=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,$t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},A),this.clear=x,e.autoClearDepth=E}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,o),c=!0);{const x=this.clear;this.clear=!1,d.transmissionRenderTarget=c?t:n,d.blurTransmissionTarget=this.blurTransmissionTarget,$t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},A),d.blurTransmissionTarget=void 0,d.transmissionRenderTarget=void 0,this.clear=x}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,o),c=!0)}}else{{const x=this.clear,E=e.autoClearDepth;e.autoClearDepth=!p,this.clear=!0,$t(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},A),this.clear=x,e.autoClearDepth=E}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const x=this.clear;this.clear=!1,d.transmissionRenderTarget=t,d.blurTransmissionTarget=this.blurTransmissionTarget,$t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},A),d.blurTransmissionTarget=void 0,d.transmissionRenderTarget=void 0,this.clear=x}c=!1}this._releaseTransparentTarget(),this.needsSwap=c,e.userData.mainRenderPass=void 0}}function Vv(s,e){return s.multiplyScalar(s.w*e),s.w=1,s}function Gv(s,e){return Vv(s,e),new Pi(s.x,s.y,s.z)}function Hv(s,e){const t=Math.max(s.x,Math.max(s.y,s.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,s.divideScalar(n*e),s.w=n,s}function Y_(s,e){return Hv(new f.Ltg(s.r,s.g,s.b,1),e)}var Nm=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function Wv(s){return Object.getPrototypeOf(s).constructor.PluginType}f.Vj0.background.fragmentShader=f.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),f.Vj0.background.fragmentShader=f.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Ta extends ct{constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!1,screenShader:r="",...o}){var a;super(),this.console=console,this._state=Mn.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(x=>this.resize()):void 0,this._lastSize=new f.FM8,this._onContextRestore=x=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=x=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===ol&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=x=>{var E;if(!x||!x.object)return;const M=x.object.__importedViewerConfig||((E=x.object.modelObject)===null||E===void 0?void 0:E.__importedViewerConfig);if(!M)return;const T=this.getManager();T?T.applyViewerConfig(M,M.resources):this.fromJSON(M,M.resources)},this.alert=async x=>alert(x),this.confirm=async x=>confirm(x),this.prompt=async(x,E,M=!0)=>prompt(x,E),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=r,this._canvas=o.canvas||fc();let c=o.container;if(c&&!o.canvas&&c.appendChild(this._canvas),c||(c=(a=this._canvas.parentElement)!==null&&a!==void 0?a:void 0),!c)throw new Error("No container.");this._container=c,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){try{const x=window.location.href;if(x.startsWith("http://localhost:8062")||x.startsWith("https://localhost:8062"))return!0;await fetch("https://europe-west1-pixotronics-320918.cloudfunctions.net/viewer-hit-test"+"/?u="+encodeURIComponent(x),{mode:"no-cors",method:"POST",credentials:"omit",cache:"no-store",keepalive:!1,referrer:"about:client",referrerPolicy:"unsafe-url"})}catch{return!1}}(),async function(){var x;const E=window.location.href,M="https://dev-sandbox.pixotronics.com/webgi/";if(!E.startsWith(M)||vc("noUpdate")!==null)return!0;const T=(x=E.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||x===void 0?void 0:x[1],O=(await(await fetch(M+"version.txt")).text()).split(`
`)[0];if(T&&T!==O){if(confirm(`New version ${O} is available, do you want to open?`)){const P=window.location.href.replace(T,O);return window.location.href=P,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const d=new Ws(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var x,E;const M=m.scene.activeCamera;if(M&&M.interactionsEnabled){if(((x=this.getPluginByType("Progressive"))===null||x===void 0?void 0:x.postFrameConvergedRecordingDelta())===0)return;(E=M.controls)===null||E===void 0||E.update()}}),this.scene=new pc(d),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new pi({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:t?Yt:f.rnI,type:t?f.ywz:f.cLu,depthBuffer:!n}}),this._isAntialiased=e&&this._renderer.isWebGL2;let p=!0;this._renderer.rendererObject.userData||(p=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!p;const m=this;this.renderFilter={passId:"render",passObject:new q_(this,p),update(){const x=this.passObject;x.scene=m.scene.modelObject,x.camera=m.scene.activeCamera.cameraObject}};const A={passId:"screen",after:["render"],required:["render"],passObject:jd(r)};[this.renderFilter,A].forEach(x=>this._renderer.registerPass(x)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",x=>this.setDirty(this.scene,x)),this.scene.addEventListener("sceneUpdate",x=>{this.setDirty(this.scene,x),x.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",x=>this.setDirty(this.scene,x)),this._renderer.addEventListener("update",x=>this.setDirty(this._renderer,x)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Ta.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var r,o;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let a=0;a<this.maxFramePerLoop;a++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const p=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const m=(o=(r=this._renderer.rendererObject.xr.getCamera())===null||r===void 0?void 0:r.cameras[0])===null||o===void 0?void 0:o.viewport;m?(m.x===0&&m.y===0||this.console.warn("x and y must be 0?"),p[0]=m.width,p[1]=m.height,this.console.log("resize for xr",p)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...p),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const c=Object.values(this.plugins).filter(p=>p.dirty);c.length>0&&this.setDirty(c),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const d=this._renderer.dirty;if(d){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(p){this.console.error(p),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!d)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...t){var n;let r;r=e.prototype?new e(...t):e;const o=Wv(r);return o?((n=r.dependencies)===null||n===void 0||n.forEach(a=>{this.getPlugin(a)||(this.console.log("Adding plugin dependency",a.name,"for",o),this.addPlugin(a))}),this.plugins[o]&&this.console.error(`Plugin of type ${o} already exists`,this.plugins[o],r),this.plugins[o]=r,await r.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:r}),this.setDirty(r),r):(this.console.error("PluginType is not defined for",r),r)}async removePlugin(e,t=!0){const n=Wv(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var t;const n=(t=e.userData.iCamera)!==null&&t!==void 0?t:new Ws(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return n.autoLookAtTarget=!1,n}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,t,n,r;const o=(r=(n=(t=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||t===void 0?void 0:t.background.getPlaneMesh())===null||n===void 0?void 0:n.material.uniforms)!==null&&r!==void 0?r:f.Vj0.background.uniforms;o.intensity||(o.intensity={value:1}),o.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const t=new Pi().set(e).convertSRGBToLinear();return this.setBackground(t)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===ol)return this._sceneEnvironmentChanged();const t=e.isVector4?Qt(e):Kt(e.isColor?e:new Pi(e));return t.assetType="texture",this.scene.setBackground(t)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var t,n,r;if(e)return this._rawBackground;let o=(t=this._rawBackground)!==null&&t!==void 0?t:this.scene.getBackground();return o?(!((n=o)===null||n===void 0)&&n.isVector4&&(o=Gv(o,7).getHexString()),!((r=o)===null||r===void 0)&&r.isColor?o.getHexString():this._rawBackground===ol?this.scene.getEnvironment():o):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:t=new f.Pa4(1,1,1),targetOffset:n=new f.Pa4(0,0,0),...r}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const o=e?new Vt().expandByObject(e,!0,!0):this.scene.getBounds(!0),a=o.getCenter(new f.Pa4),c=.5*o.getSize(new f.Pa4).length();a.add(n.clone().multiplyScalar(c)),this.scene.activeCamera.position=new f.Pa4(a.x+t.x*c,a.y+t.y*c,a.z+t.z*c),this.scene.activeCamera.target=a,this.setDirty()}}async createObject3D(e){var t;return(t=this.getManager())===null||t===void 0?void 0:t.addImportedSingle(e||new f.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,r,o,a,c;if(!((n=t)===null||n===void 0)&&n.isMaterial){const d=(o=(r=this.getManager())===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(t.uuid);if(d)return d}return(c=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||c===void 0?void 0:c.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var r,o;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(o=(r=n[1]).toJSON)===null||o===void 0?void 0:o.call(r,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var r;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const o=this.getPluginByType(n.type);o&&((r=o.fromJSON)===null||r===void 0||r.call(o,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){return Object.assign({version:Ta.VERSION,plugins:this.serializePlugins(e,t)},yi(this,!0,e))}fromJSON(e,t){return mi(e,this,!0,t),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,t),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Ta.VERSION="0.5.5",Nm([Ne()],Ta.prototype,"scene",void 0),Nm([Ne("background")],Ta.prototype,"_rawBackground",void 0),Nm([Ne(),ve(Ta.prototype._backgroundIntensityChanged)],Ta.prototype,"backgroundIntensity",void 0);const ol="envMapBackground";function jd(s){var e,t,n;return!((e=s)===null||e===void 0)&&e.isShaderPass2?s:new Vr({...It,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(s)?s[0]:((t=s)===null||t===void 0?void 0:t.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(s)?s[1]:typeof s=="string"?s:((n=s)===null||n===void 0?void 0:n.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var xs=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Mr=class extends Zn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=s=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(s){var e;if(this.isFullScreen())return;const t=s||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return t?(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(s){return this.isFullScreen()?this.exit():this.enter(s)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Mr.PluginType="FullScreenPlugin",xs([Si("Enter FullScreen")],Mr.prototype,"enter",null),xs([Si("Exit FullScreen")],Mr.prototype,"exit",null),xs([Si("Toggle FullScreen")],Mr.prototype,"toggle",null),Mr=xs([ci("Full Screen")],Mr);class Gp{constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([r,o])=>o&&this.on(r,o))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,n;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const r=Array.from(((t=e.dataTransfer)===null||t===void 0?void 0:t.files)||[]),o=Array.from(((n=e.dataTransfer)===null||n===void 0?void 0:n.items)||[]);if(r.length!==0||o.length!==0)if(o.length>0){const a=o.map(c=>c.webkitGetAsEntry());this._loadNextEntry(new Map,a)}else this._emit("drop",{files:new Map(r.map(a=>(a.filePath=a.name,[a.filePath,a])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var t;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const n=[].slice.call((t=this._inputEl.files)!==null&&t!==void 0?t:new FileList),r=new Map;n.forEach(o=>{o.filePath=o.webkitRelativePath||o.name,r.set(o.filePath,o)}),this._emit("drop",{files:r})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(r=>{r.filePath=n.fullPath,e.set(n.fullPath,r),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const r=n.createReader(),o=a=>{a.length?(t=t.concat(a),r.readEntries(o)):this._loadNextEntry(e,t)};r.readEntries(o)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Hp extends ct{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!0,autoCenter:!1,autoImport:!0,autoAdd:!0,centerOffset:new f.Pa4(.5,.5,3)},this.dependencies=[ln],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"pseudoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Gp(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,n,r,o,a,c;if(!e)return;const d=this._viewer;if(!d)return;if(this._allowedExtensions!==void 0)for(const A of e.keys())this._allowedExtensions.includes((n=(t=A.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())!==null&&n!==void 0?n:"")||e.delete(A);if(e.size<1)return;const p=d.getPlugin(ln),m={type:"drop",files:e};if(this.importerParams.autoImport){const A={allowedExtensions:this.allowedExtensions,...this.importerParams};if(m.imported=await((r=p.importer)===null||r===void 0?void 0:r.importFiles(e,A)),this.importerParams.autoAdd){const x=(c=[...(a=(o=m.imported)===null||o===void 0?void 0:o.values())!==null&&a!==void 0?a:[]].flat(2).filter(E=>!!E))!==null&&c!==void 0?c:[];if(m.assets=p.addProcessedAssets(x,{...this.importerParams}),!A._rootSceneImported)for(const E of m.assets)E.modelObject&&E.modelObject.dispatchEvent({type:"select",value:E.modelObject})}}this.dispatchEvent(m)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var t;(t=this._dropzone)===null||t===void 0||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}Hp.PluginType="Dropzone";class qv extends Vr{constructor(e){super({vertexShader:It.vertexShader,fragmentShader:K`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new f.Ltg(1,1,1,1)},weight2:{value:new f.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Wp extends Zn{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=gs()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const r=n;e.renderer.unregisterPass(r),(t=r==null?void 0:r.dispose)===null||t===void 0||t.call(r)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var t,n;const r=super.toJSON(e);if(!r.type)return r;const o=Object.entries(this.passes);r.passes={};for(const[a,c]of o)r.passes[a]=yi((n=(t=c)===null||t===void 0?void 0:t.passObject)!==null&&n!==void 0?n:c,!1,e);return r}fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;if(e.passes){const o=Object.entries(this.passes);for(const[a,c]of o)mi(e.passes[a],(r=(n=c)===null||n===void 0?void 0:n.passObject)!==null&&r!==void 0?r:c,!1,t)}return this}}var X_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Yv=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class ks extends Wp{constructor(e=2*Yv.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(r=>{var o;!((o=r==null?void 0:r.shadow)===null||o===void 0)&&o.camera&&r.shadow.mapSize&&this.trackedJitterCameras.add([r.shadow.camera,r.shadow.mapSize])})},this._jitterCamera=t=>{var n;const r=t.target;if(this.jitter&&r.renderer.frameCount>2){const o=(c,d)=>{const p={...Yv[r.renderer.frameCount%Yv.length]};c.setViewOffset(d.width,d.height,p.x,p.y,d.width,d.height)},a=r.scene.activeCamera.cameraObject;o(a,{width:r.canvas.clientWidth*r.renderer.displayCanvasScaling,height:r.canvas.clientHeight*r.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(c=>o(...c)),this._hasSetOffset=!0,(n=this._viewer)===null||n===void 0||n.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=hc("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[Fd(e,{passId:"progressive",get dirty(){var r;return t.jitter&&(((r=t._viewer)===null||r===void 0?void 0:r.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends qv{render(r,o,a,c,d){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((a==null?void 0:a.texture)&&e.renderer.blit(a.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(r,o,a,c,d),e.renderer.blit(o.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let r=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(r,r,r,r),r=1-r,this.passObject.weights2.set(r,r,r,r),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t,n;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(n=(t=this.lastFrame)===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}ks.PluginType="Progressive",X_([Ne(),li("Frame count")],ks.prototype,"maxFrameCount",void 0),X_([Ne(),gn("Jitter")],ks.prototype,"jitter",void 0);var al="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",qp=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Um=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,ll=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,Xv=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,Fm=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,K_=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,jm=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,cl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ra=class extends Vr{constructor(s,e,t,n=!0){super({vertexShader:al,fragmentShader:`

varying vec2 vUv;

${Um}
${qp}
${ll}
${Xv}
${t}

${Fm}

${K_}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new f.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new f.yGw},cameraPositionWorld:{value:new f.Pa4},cameraNearFar:{value:new f.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,o,a)=>{if(!r.defines.SSR_ENABLED)return;const c="#glMarker beforeModulation";r.fragmentShader=r.fragmentShader.replace(c,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${c}`)},onObjectRender:(r,o,a)=>{var c,d,p,m;let A=this.enabled&&a.userData.screenSpaceRendering!==!1&&!(!((c=o.materialObject.userData)===null||c===void 0)&&c.ssreflDisabled)?1:0;o.materialObject.defines.SSR_ENABLED!==A&&(o.materialObject.defines.SSR_ENABLED=A,o.materialObject.needsUpdate=!0),A=this.material.defines.SSR_STEP_COUNT,o.materialObject.defines.SSR_STEP_COUNT!==A&&(o.materialObject.defines.SSR_STEP_COUNT=A,o.materialObject.needsUpdate=!0),A=this.material.defines.SSR_LOW_QUALITY_FRAMES,o.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==A&&(o.materialObject.defines.SSR_LOW_QUALITY_FRAMES=A,o.materialObject.needsUpdate=!0),A=this.material.defines.PERSPECTIVE_CAMERA,o.materialObject.defines.PERSPECTIVE_CAMERA!==A&&(o.materialObject.defines.PERSPECTIVE_CAMERA=A,o.materialObject.needsUpdate=!0),A=this.material.defines.SSR_INLINE,o.materialObject.defines.SSR_INLINE!==A&&(o.materialObject.defines.SSR_INLINE=A,o.materialObject.needsUpdate=!0),A=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,o.materialObject.defines.SSR_MASK_FRONT_RAYS!==A&&(o.materialObject.defines.SSR_MASK_FRONT_RAYS=A,o.materialObject.needsUpdate=!0),A=!((d=o.materialObject.userData)===null||d===void 0)&&d.ssreflNonPhysical?"1":"0",o.materialObject.defines.SSR_NON_PHYSICAL!==A&&(o.materialObject.defines.SSR_NON_PHYSICAL=A,o.materialObject.needsUpdate=!0),A=(m=(p=this._target)===null||p===void 0?void 0:p.texture)!==null&&m!==void 0?m:null,this.materialExtension.extraUniforms.tSSRMap.value!==A&&(this.materialExtension.extraUniforms.tSSRMap.value=A,o.materialObject.needsUpdate=!0)},parsFragmentSnippet:r=>{var o;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+pt("tSSRMap",(o=this._target)===null||o===void 0?void 0:o.texture,r.capabilities.isWebGL2)+pt("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,r.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Um}
    
    #define THREE_PACKING_INCLUDED
    ${qp}
    
    ${ll}
    ${Xv}
    ${kl}
    
    ${Fm}
    
    ${K_}
// #endif // SSR_INLINE
#endif
`:"")+`

${jm}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:r=>{var o,a;return this.enabled?"1":"0"+((a=(o=this._target)===null||o===void 0?void 0:o.texture)===null||a===void 0?void 0:a.encoding)},isCompatible:r=>{var o;return!(!((o=r.materialObject.userData)===null||o===void 0)&&o.ssreflDisabled)&&r.isMeshStandardMaterial2}},this.intensity=1,this.boost=new f.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=s,this._target=e,this.needsSwap=!1,this._inline=n}render(s,e,t,n,r){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(s,this._target,t,n,r),this.needsSwap=!1}}};cl([An("Intensity",[0,4]),Ne(),ae()],ra.prototype,"intensity",void 0),cl([Ko("Boost"),Ne(),ae()],ra.prototype,"boost",void 0),cl([An("Object Radius",[.01,2]),Ne(),ae()],ra.prototype,"objectRadius",void 0),cl([gn("Auto radius"),Ne(),ae()],ra.prototype,"autoRadius",void 0),cl([An("Power",[0,3]),Ne(),ae()],ra.prototype,"power",void 0),cl([An("Tolerance",[.1,5]),Ne(),ae()],ra.prototype,"tolerance",void 0),cl([An("Step count",[1,32],1),Ne(),Le("SSR_STEP_COUNT")],ra.prototype,"stepCount",void 0),cl([An("Low Quality Frames",[0,4],1),Ne(),Le("SSR_LOW_QUALITY_FRAMES")],ra.prototype,"lowQualityFrames",void 0),cl([gn("Ignore front rays"),Ne(),Le("SSR_MASK_FRONT_RAYS")],ra.prototype,"maskFrontRays",void 0),cl([An("Mask front rays factor",[-1,1],.01,s=>({hidden:()=>!s.maskFrontRays})),Ne(),ae()],ra.prototype,"maskFrontFactor",void 0),ra=cl([ci("Screen Space Reflections")],ra);class zm extends Wp{constructor(){super(),this.dependencies=[ln,qi,ks],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,t;return((t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssr)===null||t===void 0)&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}createPasses(e){var t,n;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Fd(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new ra(e.renderer,this._ssrTarget,(n=(t=e.getPlugin(qi))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:"",this.inlineSSR)},()=>[e.getPlugin(qi),e.getPlugin(ks),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(c=>ke(c)))===null||o===void 0||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),a}}zm.PluginType="SSReflection";var J_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Qm extends Vr{constructor(e,t,n="rgba"){super({vertexShader:It.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new f.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new f.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,r,o){var a,c,d,p;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((a=this.uniforms.tDiffuse.value)===null||a===void 0?void 0:a.image.width)||0,((c=this.uniforms.tDiffuse.value)===null||c===void 0?void 0:c.image.height)||0),super.render(e,t,this._target,r,o),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((d=this.uniforms.tDiffuse.value)===null||d===void 0?void 0:d.image.width)||0,((p=this.uniforms.tDiffuse.value)===null||p===void 0?void 0:p.image.height)||0),super.render(e,this._target,t,r,o))}}J_([Ne(),ae()],Qm.prototype,"smoothEnabled",void 0),J_([Ne(),ae()],Qm.prototype,"edgeSharpness",void 0);var Z_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Kv extends Vr{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new f.FM8(512,512)},saoData:{value:new f.Ltg},frameCount:{value:0},cameraNearFar:{value:new f.FM8(.1,1e3)},projection:{value:new f.yGw},saoBiasEpsilon:{value:new f.Pa4(1,1,1)}},vertexShader:al,fragmentShader:`

${ll}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(r,o,a)=>{r.defines.SSAO_ENABLED&&(r.fragmentShader=r.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(r,o,a)=>{var c,d;this.materialExtension.extraUniforms.tSSAOMap.value=(c=this._target)===null||c===void 0?void 0:c.texture;const p=o.materialObject,m=!p.transparent&&p.transmission<.001;let A=this.enabled&&m&&a.userData.screenSpaceRendering!==!1&&!(!((d=o.materialObject.userData)===null||d===void 0)&&d.ssaoDisabled)?1:0;p.defines.SSAO_ENABLED!==A&&(p.defines.SSAO_ENABLED=A,p.needsUpdate=!0),A=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==A&&(this.materialExtension.extraUniforms.tSSAOMap.value=A,p.needsUpdate=!0)},parsFragmentSnippet:r=>{var o;return K`
             uniform sampler2D tSSAOMap;
             ${pt("tSSAOMap",(o=this._target)===null||o===void 0?void 0:o.texture,r.capabilities.isWebGL2)}
            ${jm}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:r=>{var o,a;return this.enabled?"1":"0"+((a=(o=this._target)===null||o===void 0?void 0:o.texture)===null||a===void 0?void 0:a.encoding)},isCompatible:r=>{var o;return!(!((o=r.materialObject.userData)===null||o===void 0)&&o.ssaoDisabled)&&r.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new Qm(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,r,o){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,o),this._smoothEnabled&&this.bilateralPass.render(e,t,n,r,o))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Z_([Ne()],Kv.prototype,"bilateralPass",void 0),Z_([Ne()],Kv.prototype,"parameters",void 0);class Vm extends Wp{constructor(){super(),this.dependencies=[ln,qi],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t,n;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Fd(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new Kv(e.renderer,this._aoTarget,(n=(t=e.getPlugin(qi))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(qi)])}},()=>[e.getPlugin(qi),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssao)===null||t===void 0)&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,n=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[n,"enabled"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[n.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[n.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[n.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[n.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=n.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>n.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[n.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"vec4",property:[n.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}Vm.PluginType="SSAO";class $_{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new f.xsS,this._mesh=new f.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new eA}dispose(){this._mesh.material.dispose()}captureNormalMap(e,t,n=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const r=t==null?void 0:t.split(";").find(d=>this._normalsCache[d]);if(r){const d=this._normalsCache[r];return t==null||t.split(";").forEach(p=>p!==r&&(this._normalsCache[p]=d)),d.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=d,!1}const o=this._renderer.createTargetCustom({width:n,height:n},{minFilter:f.TyD,magFilter:f.TyD,generateMipmaps:!1,type:f.cLu},f.oAp);if(!o)throw"Unable to create render target";t==null||t.split(";").forEach(d=>this._normalsCache[d]=o),o.addEventListener("dispose",()=>delete this._normalsCache[t]);const a=new f._am(1e-4,100,o);this._scene.add(a);const c=e.userData._normalsCaptureOffsets;return c.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(c.center),c.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(c.offsetMatrixInv),c.radius!==void 0&&(this._mesh.material.uniforms.radius.value=c.radius),this._mesh.geometry=e,a.update(this._renderer.rendererObject,this._scene),this._scene.remove(a),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=o,!0}}class eA extends f.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:f.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new f.yGw().identity()},offsetCenter:{value:new f.Pa4}}})}}var mw=__webpackgi_require__(654);function tA(s){const e=new f.Pa4(0,0,0),t=new f.Pa4(0,0,0),n=new f.Pa4(0,0,0),r=new f.Pa4(0,0,0),o=s.getAttribute("position"),a=s.index;if(a)for(let x=Math.max(0,s.drawRange.start),E=Math.min(a.count,s.drawRange.start+s.drawRange.count)-1;x<E/3;x+=3){const M=a.getX(x),T=a.getX(x+1),O=a.getX(x+2);t.set(o.getX(M),o.getY(M),o.getZ(M)),n.set(o.getX(T),o.getY(T),o.getZ(T)),r.set(o.getX(O),o.getY(O),o.getZ(O)),n.sub(t),r.sub(t),r.cross(n),r.normalize(),e.add(r)}else for(let x=0;x<o.count;x+=3)t.set(o.getX(x),o.getY(x),o.getZ(x)),n.set(o.getX(x+1),o.getY(x+1),o.getZ(x+1)),r.set(o.getX(x+2),o.getY(x+2),o.getZ(x+2)),n.sub(t),r.sub(t),r.cross(n),r.normalize(),e.add(r);e.normalize();let c=!1,d=0;for(;!c;){const x=d/3,E=a?a.getX(x):x,M=a?a.getX(x+1):x+1;t.set(o.getX(E),o.getY(E),o.getZ(E)),n.set(o.getX(M),o.getY(M),o.getZ(M)),t.sub(n),t.normalize();const T=e.dot(t);Math.abs(T-1)>.001&&t.length()>.5&&(c=!0),d+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const p=new f.yGw;p.elements[0]=t.x,p.elements[1]=t.y,p.elements[2]=t.z,p.elements[3]=0,p.elements[4]=e.x,p.elements[5]=e.y,p.elements[6]=e.z,p.elements[7]=0,p.elements[8]=n.x,p.elements[9]=n.y,p.elements[10]=n.z,p.elements[11]=0,p.elements[12]=0,p.elements[13]=0,p.elements[14]=0,p.elements[15]=1,s.computeBoundingSphere();const m=s.boundingSphere.radius,A=new f.yGw().makeScale(m,m,m);return p.multiply(A),p}function nA(s){const e=s.getAttribute("position");if(e.count>0)return tA(s);const t=new f.Pa4(0,0,0),n=new f.Pa4(0,0,0),r=new f.Pa4(0,0,0),o=s.index,a=[];if(o)for(let A=Math.max(0,s.drawRange.start),x=Math.min(o.count,s.drawRange.start+s.drawRange.count)-1;A<x/3;A+=3){const E=o.getX(A),M=o.getX(A+1),T=o.getX(A+2);t.set(e.getX(E),e.getY(E),e.getZ(E)),n.set(e.getX(M),e.getY(M),e.getZ(M)),r.set(e.getX(T),e.getY(T),e.getZ(T)),a.push(t.toArray(),n.toArray(),r.toArray())}else for(let A=0;A<e.count;A++)t.set(e.getX(A),e.getY(A),e.getZ(A)),a.push(t.toArray());const c=(0,mw.getEigenVectors)(a),d=new f.yGw;d.elements[0]=c[0].vector[0],d.elements[1]=c[0].vector[1],d.elements[2]=c[0].vector[2],d.elements[3]=0,d.elements[4]=c[1].vector[0],d.elements[5]=c[1].vector[1],d.elements[6]=c[1].vector[2],d.elements[7]=0,d.elements[8]=c[2].vector[0],d.elements[9]=c[2].vector[1],d.elements[10]=c[2].vector[2],d.elements[11]=0,d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,console.log(d.determinant()),s.computeBoundingSphere();const p=s.boundingSphere.radius,m=new f.yGw().makeScale(p,p,p);return d.multiply(m),d}const iA={...Ac,color:new Pi(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new f.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var Fo=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class er extends f.jyz{constructor(e){super({side:f.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new f.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new f.Pa4(1,1,1)}}}),this.typeSlug=er.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new Pi(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new f.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new f.yGw().identity()},radius:{value:1},centerOffset:{value:new f.Pa4(0,0,0)},offsetMatrix:{value:new f.yGw().identity()},offsetMatrixInv:{value:new f.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.userData.enableLUT=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,r,o){var a,c;super.onBeforeRender(e,t,n,r,o),this.uniforms.envMapRotation.value=((a=this.envMap)===null||a===void 0?void 0:a.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(o.matrixWorld).invert();const d=r.userData._normalsCaptureOffsets;d&&(this.extraUniformsToUpload.centerOffset.value.copy(d.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(d.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(d.offsetMatrixInv),this.extraUniformsToUpload.radius.value=d.radius);const p=(c=r.userData._normalsCaptureMap)===null||c===void 0?void 0:c.texture;this.normalsCaptureMap!==p&&(this.normalsCaptureMap=p)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}set envMap(e){var t;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((t=this.__envMap)===null||t===void 0)&&t.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const t={};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=er.TYPE,t.userData={},Gs(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...Dl(this),{type:"input",label:"Mesh count",get value(){var t,n,r;return(r=(n=(t=e.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||n===void 0?void 0:n.size)!==null&&r!==void 0?r:0},set value(t){},disabled:!0},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:t=>{this.userData.enableLUT=t||void 0,this.setDirty()}},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{Jr(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==er.TYPE)return console.warn("Material type is not supported",e),this;const t={};mt(e,t,Array.from(Object.keys(iA)));const n=t.userData;return delete t.userData,this.setValues(t),Gs(this.userData,n),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}er.TypeSlug="dmat",er.TYPE="DiamondMaterial",Fo([Ya("Color",{limitedUi:!0}),ae()],er.prototype,"color",void 0),Fo([An("Env Intensity",[0,5],.01,{limitedUi:!0}),ae()],er.prototype,"envMapIntensity",void 0),Fo([An("Dispersion",[0,.1],1e-4,{limitedUi:!0}),ae({propKey:"rIndexDelta"})],er.prototype,"dispersion",void 0),Fo([An("Absorption",[0,15],.01,{limitedUi:!0}),ae()],er.prototype,"absorptionFactor",void 0),Fo([An("Refractive Index",[0,4],.01,{limitedUi:!0}),ae()],er.prototype,"refractiveIndex",void 0),Fo([ae()],er.prototype,"squashFactor",void 0),Fo([ae()],er.prototype,"geometryFactor",void 0),Fo([ae()],er.prototype,"gammaFactor",void 0),Fo([Ko("RGB Boost",void 0,void 0,{limitedUi:!0}),ae()],er.prototype,"boostFactors",void 0),Fo([An("Transmission",[0,1],.01,{limitedUi:!0}),ae()],er.prototype,"transmission",void 0),Fo([An("Reflectivity",[0,2],.01,{limitedUi:!0}),ae()],er.prototype,"reflectivity",void 0),Fo([Le("RAY_BOUNCES",void 0,!0),An("Ray Bounces",[1,16],1)],er.prototype,"rayBounces",void 0),Fo([Le("DIA_ORIENT_ENVMAP",void 0,!0),An("Diamond Oriented Lighting",[0,1],1)],er.prototype,"diamondOrientedEnvMap",void 0),Fo([ae({propKey:"tCubeMapNormals"})],er.prototype,"normalsCaptureMap",void 0);class rA extends ct{constructor(e,t,n,r){super(),this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=r??(o=>o.userData.userSelectable!==!1&&o.userData.bboxVisible!==!1&&o.material!=null&&o.material.type!=="ShadowMaterial"),this.raycaster=new f.iMs,this.mouse=new f.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",o=>this.onPointerMove(o)),this.domElement.addEventListener("pointerleave",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointerout",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointercancel",o=>this.onPointerCancel(o)),this.domElement.addEventListener("pointerenter",o=>this.onPointerEnter(o)),this.domElement.addEventListener("pointerdown",o=>this.onPointerDown(o)),this.domElement.addEventListener("pointerup",o=>this.onPointerUp(o))}get scene(){return this._scene}set scene(e){var t;(t=this._scene)===null||t===void 0||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=ui(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);const n=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0),r=this.selectedObject;if(r){const o=n.length-1-[...n].reverse().findIndex(a=>{let c=a.object;for(;c;){if(a.object===r)return!0;c=c.parent}return!1});o>=0&&n.splice(0,o+1)}if(n.length>0){for(const o of n){let a=o.object;for(;!(a==null||a.visible&&this.selectionCondition(a));)a=a.parent;if(a)return{selectedObject:a,intersect:o,intersects:n,mouse:this.mouse.toArray()}}return null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const Oh=new f.iMs,jo=new f.Pa4,ku=new f.Pa4,wr=new f._fP,sA={X:new f.Pa4(1,0,0),Y:new f.Pa4(0,1,0),Z:new f.Pa4(0,0,1)},Jv={type:"change"},oA={type:"mouseDown"},aA={type:"mouseUp",mode:null},lA={type:"objectChange"};class gw extends f.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new pA;this._gizmo=n,this.add(n);const r=new _w;this._plane=r,this.add(r);const o=this;function a(P,R){let I=R;Object.defineProperty(o,P,{get:function(){return I!==void 0?I:R},set:function(j){I!==j&&(I=j,r[P]=j,n[P]=j,o.dispatchEvent({type:P+"-changed",value:j}),o.dispatchEvent(Jv))}}),o[P]=R,r[P]=R,n[P]=R}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const c=new f.Pa4,d=new f.Pa4,p=new f._fP,m=new f._fP,A=new f.Pa4,x=new f._fP,E=new f.Pa4,M=new f.Pa4,T=new f.Pa4,O=new f.Pa4;a("worldPosition",c),a("worldPositionStart",d),a("worldQuaternion",p),a("worldQuaternionStart",m),a("cameraPosition",A),a("cameraQuaternion",x),a("pointStart",E),a("pointEnd",M),a("rotationAxis",T),a("rotationAngle",0),a("eye",O),this._offset=new f.Pa4,this._startNorm=new f.Pa4,this._endNorm=new f.Pa4,this._cameraScale=new f.Pa4,this._parentPosition=new f.Pa4,this._parentQuaternion=new f._fP,this._parentQuaternionInv=new f._fP,this._parentScale=new f.Pa4,this._worldScaleStart=new f.Pa4,this._worldQuaternionInv=new f._fP,this._worldScale=new f.Pa4,this._positionStart=new f.Pa4,this._quaternionStart=new f._fP,this._scaleStart=new f.Pa4,this._getPointer=Zv.bind(this),this._onPointerDown=vw.bind(this),this._onPointerHover=cA.bind(this),this._onPointerMove=Gm.bind(this),this._onPointerUp=uA.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Oh.setFromCamera(e,this.camera);const t=$v(this._gizmo.picker[this.mode],Oh);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){Oh.setFromCamera(e,this.camera);const t=$v(this._plane,Oh,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,oA.mode=this.mode,this.dispatchEvent(oA)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let o=this.space;if(n==="scale"?o="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(o="world"),r===void 0||t===null||this.dragging===!1||e.button!==-1)return;Oh.setFromCamera(e,this.camera);const a=$v(this._plane,Oh,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(r.position.applyQuaternion(wr.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),o==="world"&&(r.parent&&r.position.add(jo.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(jo.setFromMatrixPosition(r.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),ku.set(c,c,c)}else jo.copy(this.pointStart),ku.copy(this.pointEnd),jo.applyQuaternion(this._worldQuaternionInv),ku.applyQuaternion(this._worldQuaternionInv),ku.divide(jo),t.search("X")===-1&&(ku.x=1),t.search("Y")===-1&&(ku.y=1),t.search("Z")===-1&&(ku.z=1);r.scale.copy(this._scaleStart).multiply(ku),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(jo.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(jo.copy(this.rotationAxis).cross(this.eye))*c):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(sA[t]),jo.copy(sA[t]),o==="local"&&jo.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(jo.cross(this.eye).normalize())*c),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(wr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(wr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Jv),this.dispatchEvent(lA)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(aA.mode=this.mode,this.dispatchEvent(aA)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Jv),this.dispatchEvent(lA),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Oh}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Zv(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function cA(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s))}}function vw(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Gm(s){this.enabled&&this.pointerMove(this._getPointer(s))}function uA(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function $v(s,e,t){const n=e.intersectObject(s,!0);for(let r=0;r<n.length;r++)if(n[r].object.visible||t)return n[r];return!1}const Yp=new f.USm,tr=new f.Pa4(0,1,0),hA=new f.Pa4(0,0,0),dA=new f.yGw,Hm=new f._fP,Ou=new f._fP,ul=new f.Pa4,e0=new f.yGw,Xp=new f.Pa4(1,0,0),Oc=new f.Pa4(0,1,0),Kp=new f.Pa4(0,0,1),Wm=new f.Pa4,zd=new f.Pa4,Jp=new f.Pa4;class pA extends f.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new f.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new f.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const c=e.clone();c.color.setHex(255);const d=e.clone();d.color.setHex(16711680),d.opacity=.5;const p=e.clone();p.color.setHex(65280),p.opacity=.5;const m=e.clone();m.color.setHex(255),m.opacity=.5;const A=e.clone();A.opacity=.25;const x=e.clone();x.color.setHex(16776960),x.opacity=.25,e.clone().color.setHex(16776960);const E=e.clone();E.color.setHex(7895160);const M=new f.fHI(0,.04,.1,12);M.translate(0,.05,0);const T=new f.DvJ(.08,.08,.08);T.translate(0,.04,0);const O=new f.u9r;O.setAttribute("position",new f.a$l([0,0,0,1,0,0],3));const P=new f.fHI(.0075,.0075,.5,3);function R(xe,pe){const ye=new f.XvJ(xe,.0075,3,64,pe*Math.PI*2);return ye.rotateY(Math.PI/2),ye.rotateX(Math.PI/2),ye}P.translate(0,.25,0);const I={X:[[new f.Kj0(M,o),[.5,0,0],[0,0,-Math.PI/2]],[new f.Kj0(M,o),[-.5,0,0],[0,0,Math.PI/2]],[new f.Kj0(P,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new f.Kj0(M,a),[0,.5,0]],[new f.Kj0(M,a),[0,-.5,0],[Math.PI,0,0]],[new f.Kj0(P,a)]],Z:[[new f.Kj0(M,c),[0,0,.5],[Math.PI/2,0,0]],[new f.Kj0(M,c),[0,0,-.5],[-Math.PI/2,0,0]],[new f.Kj0(P,c),null,[Math.PI/2,0,0]]],XYZ:[[new f.Kj0(new f.pQR(.1,0),A.clone()),[0,0,0]]],XY:[[new f.Kj0(new f.DvJ(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new f.Kj0(new f.DvJ(.15,.15,.01),d.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f.Kj0(new f.DvJ(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},j={X:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,.3,0]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new f.Kj0(new f.pQR(.2,0),n)]],XY:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},z={START:[[new f.Kj0(new f.pQR(.01,2),r),null,null,null,"helper"]],END:[[new f.Kj0(new f.pQR(.01,2),r),null,null,null,"helper"]],DELTA:[[new f.x12(function(){const xe=new f.u9r;return xe.setAttribute("position",new f.a$l([0,0,0,1,1,1],3)),xe}(),r),null,null,null,"helper"]],X:[[new f.x12(O,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new f.x12(O,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new f.x12(O,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={XYZE:[[new f.Kj0(R(.5,1),E),null,[0,Math.PI/2,0]]],X:[[new f.Kj0(R(.5,.5),o)]],Y:[[new f.Kj0(R(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new f.Kj0(R(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new f.Kj0(R(.75,1),x),null,[0,Math.PI/2,0]]]},G={AXIS:[[new f.x12(O,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},X={XYZE:[[new f.Kj0(new f.xo$(.25,10,8),n)]],X:[[new f.Kj0(new f.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new f.Kj0(new f.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new f.Kj0(new f.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new f.Kj0(new f.XvJ(.75,.1,2,24),n)]]},ne={X:[[new f.Kj0(T,o),[.5,0,0],[0,0,-Math.PI/2]],[new f.Kj0(P,o),[0,0,0],[0,0,-Math.PI/2]],[new f.Kj0(T,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new f.Kj0(T,a),[0,.5,0]],[new f.Kj0(P,a)],[new f.Kj0(T,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new f.Kj0(T,c),[0,0,.5],[Math.PI/2,0,0]],[new f.Kj0(P,c),[0,0,0],[Math.PI/2,0,0]],[new f.Kj0(T,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new f.Kj0(new f.DvJ(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new f.Kj0(new f.DvJ(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f.Kj0(new f.DvJ(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new f.Kj0(new f.DvJ(.1,.1,.1),A.clone())]]},ce={X:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,.3,0]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new f.Kj0(new f.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new f.Kj0(new f.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new f.Kj0(new f.DvJ(.2,.2,.2),n),[0,0,0]]]},ge={X:[[new f.x12(O,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new f.x12(O,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new f.x12(O,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function de(xe){const pe=new f.Tme;for(const ye in xe)for(let Re=xe[ye].length;Re--;){const we=xe[ye][Re][0].clone(),We=xe[ye][Re][1],ot=xe[ye][Re][2],ft=xe[ye][Re][3],nt=xe[ye][Re][4];we.name=ye,we.tag=nt,We&&we.position.set(We[0],We[1],We[2]),ot&&we.rotation.set(ot[0],ot[1],ot[2]),ft&&we.scale.set(ft[0],ft[1],ft[2]),we.updateMatrix();const Rt=we.geometry.clone();Rt.applyMatrix4(we.matrix),we.geometry=Rt,we.renderOrder=1/0,we.position.set(0,0,0),we.rotation.set(0,0,0),we.scale.set(1,1,1),pe.add(we)}return pe}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=de(I)),this.add(this.gizmo.rotate=de(V)),this.add(this.gizmo.scale=de(ne)),this.add(this.picker.translate=de(j)),this.add(this.picker.rotate=de(X)),this.add(this.picker.scale=de(ce)),this.add(this.helper.translate=de(z)),this.add(this.helper.rotate=de(G)),this.add(this.helper.scale=de(ge)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Ou;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const o=n[r];let a;o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),a=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag!=="helper"?(o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(tr.copy(Xp).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(tr.copy(Oc).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(tr.copy(Kp).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(tr.copy(Kp).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(tr.copy(Xp).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(tr.copy(Oc).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Hm.copy(t),tr.copy(this.eye).applyQuaternion(wr.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(dA.lookAt(this.eye,hA,Oc)),o.name==="X"&&(wr.setFromAxisAngle(Xp,Math.atan2(-tr.y,tr.z)),wr.multiplyQuaternions(Hm,wr),o.quaternion.copy(wr)),o.name==="Y"&&(wr.setFromAxisAngle(Oc,Math.atan2(tr.x,tr.z)),wr.multiplyQuaternions(Hm,wr),o.quaternion.copy(wr)),o.name==="Z"&&(wr.setFromAxisAngle(Kp,Math.atan2(tr.y,tr.x)),wr.multiplyQuaternions(Hm,wr),o.quaternion.copy(wr))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(c){return o.name===c}))&&(o.material.color.setHex(16776960),o.material.opacity=1)):(o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(wr.setFromEuler(Yp.set(0,0,0)),o.quaternion.copy(t).multiply(wr),Math.abs(tr.copy(Xp).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(wr.setFromEuler(Yp.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(wr),Math.abs(tr.copy(Oc).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(wr.setFromEuler(Yp.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(wr),Math.abs(tr.copy(Kp).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(wr.setFromEuler(Yp.set(0,Math.PI/2,0)),tr.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(dA.lookAt(hA,tr,Oc)),o.quaternion.multiply(wr),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),jo.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),jo.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(jo),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1)))}super.updateMatrixWorld(e)}}class _w extends f.Kj0{constructor(){super(new f._12(1e5,1e5,2,2),new f.vBJ({visible:!1,wireframe:!0,side:f.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Wm.copy(Xp).applyQuaternion(t==="local"?this.worldQuaternion:Ou),zd.copy(Oc).applyQuaternion(t==="local"?this.worldQuaternion:Ou),Jp.copy(Kp).applyQuaternion(t==="local"?this.worldQuaternion:Ou),tr.copy(zd),this.mode){case"translate":case"scale":switch(this.axis){case"X":tr.copy(this.eye).cross(Wm),ul.copy(Wm).cross(tr);break;case"Y":tr.copy(this.eye).cross(zd),ul.copy(zd).cross(tr);break;case"Z":tr.copy(this.eye).cross(Jp),ul.copy(Jp).cross(tr);break;case"XY":ul.copy(Jp);break;case"YZ":ul.copy(Wm);break;case"XZ":tr.copy(Jp),ul.copy(zd);break;case"XYZ":case"E":ul.set(0,0,0)}break;default:ul.set(0,0,0)}ul.length()===0?this.quaternion.copy(this.cameraQuaternion):(e0.lookAt(jo.set(0,0,0),ul,tr),this.quaternion.setFromRotationMatrix(e0)),super.updateMatrixWorld(e)}}const fA=new f.ZzF,qm=new f.Pa4;class mA extends f.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new f.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new f.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new f.$TI(t,6,1);return this.setAttribute("instanceStart",new f.kB5(n,3,0)),this.setAttribute("instanceEnd",new f.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new f.$TI(t,6,1);return this.setAttribute("instanceColorStart",new f.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new f.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new f.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new f.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),fA.setFromBufferAttribute(t),this.boundingBox.union(fA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new f.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let o=0,a=e.count;o<a;o++)qm.fromBufferAttribute(e,o),r=Math.max(r,n.distanceToSquared(qm)),qm.fromBufferAttribute(t,o),r=Math.max(r,n.distanceToSquared(qm));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Aw extends mA{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new f.Uk6(e))}}f.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new f.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},f.Vj0.line={uniforms:f.rDY.merge([f.rBU.common,f.rBU.fog,f.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class gA extends f.jyz{constructor(e){super({type:"LineMaterial",uniforms:f.rDY.clone(f.Vj0.line.uniforms),vertexShader:f.Vj0.line.vertexShader,fragmentShader:f.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const vA=new f.Pa4,t0=new f.Pa4;class _A extends f.Kj0{constructor(e=new mA,t=new gA({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let a=0,c=0,d=t.count;a<d;a++,c+=2)vA.fromBufferAttribute(t,a),t0.fromBufferAttribute(n,a),r[c]=c===0?0:r[c-1],r[c+1]=r[c]+vA.distanceTo(t0);const o=new f.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new f.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new f.kB5(o,1,1)),this}}class n0 extends f.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const t=new Vt().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new f.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const t=new Aw(e);this._geometry=t;const n=new gA({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new f.FM8(1024,1024),dashed:!1,toneMapped:!1}),r=new _A(t,n);r.computeLineDistances(),r.scale.set(1,1,1),r.visible=!0,this.add(r)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)===null||t===void 0||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class i0 extends n0{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new f.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Vt().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Zp=function(s){return function(e){return 1-s(1-e)}},Ym=function(s){return function(e){return e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2}},AA=function(s){return function(e){return Math.pow(e,s)}},Xm=function(s){return function(e){return e*e*((s+1)*e-s)}},yA=function(s){var e=Xm(s);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},$p=function(s){return s},Qd=AA(2),bA=Zp(Qd),r0=Ym(Qd),s0=function(s){return 1-Math.sin(Math.acos(s))},Km=Zp(s0),o0=Ym(Km),Lc=Xm(1.525),wA=Zp(Lc),Jm=Ym(Lc),a0=yA(1.525),ef=function(s){if(s===1||s===0)return s;var e=s*s;return s<.36363636363636365?7.5625*e:s<.7272727272727273?9.075*e-9.9*s+3.4:s<.9?12.066481994459833*e-19.63545706371191*s+8.898060941828255:10.8*s*s-20.52*s+10.72},xA=Zp(ef),EA=function(s){return s<.5?.5*(1-ef(1-2*s)):.5*ef(2*s-1)+.5},Tr=function(){return Tr=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r]);return s},Tr.apply(this,arguments)};function l0(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]])}return t}var Lu=function(s,e,t){return Math.min(Math.max(t,s),e)};function Vd(s,e){return s*Math.sqrt(1-e*e)}var CA=["duration","bounce"],Zm=["stiffness","damping","mass"];function Js(s,e){return e.some(function(t){return s[t]!==void 0})}function Wl(s){var e=s.from,t=e===void 0?0:e,n=s.to,r=n===void 0?1:n,o=s.restSpeed,a=o===void 0?2:o,c=s.restDelta,d=l0(s,["from","to","restSpeed","restDelta"]),p={done:!1,value:t},m=function(j){var z=Tr({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},j);if(!Js(j,Zm)&&Js(j,CA)){var V=function(G){var X,ne,ce=G.duration,ge=ce===void 0?800:ce,de=G.bounce,xe=de===void 0?.25:de,pe=G.velocity,ye=pe===void 0?0:pe,Re=G.mass,we=Re===void 0?1:Re,We=1-xe;We=Lu(.05,1,We),ge=Lu(.01,10,ge/1e3),We<1?(X=function(nt){var Rt=nt*We,Nt=Rt*ge;return .001-(Rt-ye)/Vd(nt,We)*Math.exp(-Nt)},ne=function(nt){var Rt=nt*We*ge,Nt=Rt*ye+ye,Ut=Math.pow(We,2)*Math.pow(nt,2)*ge,Ht=Math.exp(-Rt),yn=Vd(Math.pow(nt,2),We);return(.001-X(nt)>0?-1:1)*((Nt-Ut)*Ht)/yn}):(X=function(nt){return Math.exp(-nt*ge)*((nt-ye)*ge+1)-.001},ne=function(nt){return Math.exp(-nt*ge)*(ge*ge*(ye-nt))});var ot=function(nt,Rt,Nt){for(var Ut=Nt,Ht=1;Ht<12;Ht++)Ut-=nt(Ut)/Rt(Ut);return Ut}(X,ne,5/ge);if(ge*=1e3,isNaN(ot))return{stiffness:100,damping:10,duration:ge};var ft=Math.pow(ot,2)*we;return{stiffness:ft,damping:2*We*Math.sqrt(we*ft),duration:ge}}(j);(z=Tr(Tr(Tr({},z),V),{velocity:0,mass:1})).isResolvedFromDuration=!0}return z}(d),A=m.stiffness,x=m.damping,E=m.mass,M=m.velocity,T=m.duration,O=m.isResolvedFromDuration,P=$m,R=$m;function I(){var j=M?-M/1e3:0,z=r-t,V=x/(2*Math.sqrt(A*E)),G=Math.sqrt(A/E)/1e3;if(c!=null||(c=Math.abs(r-t)<=1?.01:.4),V<1){var X=Vd(G,V);P=function(ce){var ge=Math.exp(-V*G*ce);return r-ge*((j+V*G*z)/X*Math.sin(X*ce)+z*Math.cos(X*ce))},R=function(ce){var ge=Math.exp(-V*G*ce);return V*G*ge*(Math.sin(X*ce)*(j+V*G*z)/X+z*Math.cos(X*ce))-ge*(Math.cos(X*ce)*(j+V*G*z)-X*z*Math.sin(X*ce))}}else if(V===1)P=function(ce){return r-Math.exp(-G*ce)*(z+(j+G*z)*ce)};else{var ne=G*Math.sqrt(V*V-1);P=function(ce){var ge=Math.exp(-V*G*ce),de=Math.min(ne*ce,300);return r-ge*((j+V*G*z)*Math.sinh(de)+ne*z*Math.cosh(de))/ne}}}return I(),{next:function(j){var z=P(j);if(O)p.done=j>=T;else{var V=1e3*R(j),G=Math.abs(V)<=a,X=Math.abs(r-z)<=c;p.done=G&&X}return p.value=p.done?r:z,p},flipTarget:function(){var j;M=-M,t=(j=[r,t])[0],r=j[1],I()}}}Wl.needsInterpolation=function(s,e){return typeof s=="string"||typeof e=="string"};var $m=function(s){return 0},Nu=function(s,e,t){var n=e-s;return n===0?1:(t-s)/n},Nc=function(s,e,t){return-t*s+t*e+s},Lh=function(s,e){return function(t){return Math.max(Math.min(t,e),s)}},ql=function(s){return s%1?Number(s.toFixed(5)):s},Uc=/(-)?([\d]*\.?[\d])+/g,Nh=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,SA=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Uu(s){return typeof s=="string"}var Fu={test:function(s){return typeof s=="number"},parse:parseFloat,transform:function(s){return s}},tf=Tr(Tr({},Fu),{transform:Lh(0,1)}),eg=(Tr(Tr({},Fu),{default:1}),function(s,e){return function(t){return Boolean(Uu(t)&&SA.test(t)&&t.startsWith(s)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),tg=function(s,e,t){return function(n){var r;if(!Uu(n))return n;var o=n.match(Uc),a=o[0],c=o[1],d=o[2],p=o[3];return(r={})[s]=parseFloat(a),r[e]=parseFloat(c),r[t]=parseFloat(d),r.alpha=p!==void 0?parseFloat(p):1,r}},MA=Lh(0,255),ng=Tr(Tr({},Fu),{transform:function(s){return Math.round(MA(s))}}),Fc={test:eg("rgb","red"),parse:tg("red","green","blue"),transform:function(s){var e=s.red,t=s.green,n=s.blue,r=s.alpha,o=r===void 0?1:r;return"rgba("+ng.transform(e)+", "+ng.transform(t)+", "+ng.transform(n)+", "+ql(tf.transform(o))+")"}},Gd={test:eg("#"),parse:function(s){var e="",t="",n="",r="";return s.length>5?(e=s.substr(1,2),t=s.substr(3,2),n=s.substr(5,2),r=s.substr(7,2)):(e=s.substr(1,1),t=s.substr(2,1),n=s.substr(3,1),r=s.substr(4,1),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}},transform:Fc.transform},TA=function(s){return{test:function(e){return Uu(e)&&e.endsWith(s)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+s}}},Hd=TA("%"),Uh=(Tr(Tr({},Hd),{parse:function(s){return Hd.parse(s)/100},transform:function(s){return Hd.transform(100*s)}}),{test:eg("hsl","hue"),parse:tg("hue","saturation","lightness"),transform:function(s){var e=s.hue,t=s.saturation,n=s.lightness,r=s.alpha,o=r===void 0?1:r;return"hsla("+Math.round(e)+", "+Hd.transform(ql(t))+", "+Hd.transform(ql(n))+", "+ql(tf.transform(o))+")"}}),IA=function(s,e,t){var n=s*s,r=e*e;return Math.sqrt(Math.max(0,t*(r-n)+n))},DA=[Gd,Fc,Uh],PA=function(s){return DA.find(function(e){return e.test(s)})},ig=function(s,e){var t=PA(s),n=PA(e);t.transform,n.transform;var r=t.parse(s),o=n.parse(e),a=Tr({},r),c=t===Uh?Nc:IA;return function(d){for(var p in a)p!=="alpha"&&(a[p]=c(r[p],o[p],d));return a.alpha=Nc(r.alpha,o.alpha,d),t.transform(a)}},c0=function(s){return Fc.test(s)||Gd.test(s)||Uh.test(s)},u0=function(s){return Fc.test(s)?Fc.parse(s):Uh.test(s)?Uh.parse(s):Gd.parse(s)},Wd=function(s){return Uu(s)?s:s.hasOwnProperty("red")?Fc.transform(s):Uh.transform(s)},h0="${c}",RA="${n}";function nf(s){var e=[],t=0,n=s.match(Nh);n&&(t=n.length,s=s.replace(Nh,h0),e.push.apply(e,n.map(u0)));var r=s.match(Uc);return r&&(s=s.replace(Uc,RA),e.push.apply(e,r.map(Fu.parse))),{values:e,numColors:t,tokenised:s}}function Fh(s){return nf(s).values}function d0(s){var e=nf(s),t=e.values,n=e.numColors,r=e.tokenised,o=t.length;return function(a){for(var c=r,d=0;d<o;d++)c=c.replace(d<n?h0:RA,d<n?Wd(a[d]):ql(a[d]));return c}}var BA=function(s){return typeof s=="number"?0:s},rf={test:function(s){var e,t,n,r;return isNaN(s)&&Uu(s)&&((t=(e=s.match(Uc))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((r=(n=s.match(Nh))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0)>0},parse:Fh,createTransformer:d0,getAnimatableNone:function(s){var e=Fh(s);return d0(s)(e.map(BA))}},sf={x:0,y:0,z:0},rg=function(s){return typeof s=="number"},lo=function(s,e){return function(t){return e(s(t))}},sg=function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return s.reduce(lo)};function p0(s,e){return rg(s)?function(t){return Nc(s,e,t)}:c0(s)?ig(s,e):Yl(s,e)}var f0=function(s,e){var t=function(o,a){for(var c=0,d=a.length,p=o.length;c<d;c++,p++)o[p]=a[c];return o}([],s),n=t.length,r=s.map(function(o,a){return p0(o,e[a])});return function(o){for(var a=0;a<n;a++)t[a]=r[a](o);return t}},m0=function(s,e){var t=Tr(Tr({},s),e),n={};for(var r in t)s[r]!==void 0&&e[r]!==void 0&&(n[r]=p0(s[r],e[r]));return function(o){for(var a in n)t[a]=n[a](o);return t}};function of(s){for(var e=rf.parse(s),t=e.length,n=0,r=0,o=0,a=0;a<t;a++)n||typeof e[a]=="number"?n++:e[a].hue!==void 0?o++:r++;return{parsed:e,numNumbers:n,numRGB:r,numHSL:o}}var Yl=function(s,e){var t=rf.createTransformer(e),n=of(s),r=of(e);return sg(f0(n.parsed,r.parsed),t)},kA=function(s,e){return function(t){return Nc(s,e,t)}};function og(s,e,t){var n=t===void 0?{}:t,r=n.clamp,o=r===void 0||r,a=n.ease,c=n.mixer,d=s.length;e.length,!a||!Array.isArray(a)||a.length,s[0]>s[d-1]&&(s=[].concat(s),e=[].concat(e),s.reverse(),e.reverse());var p=function(A,x,E){for(var M=[],T=E||(typeof(j=A[0])=="number"?kA:typeof j=="string"?c0(j)?ig:Yl:Array.isArray(j)?f0:typeof j=="object"?m0:void 0),O=A.length-1,P=0;P<O;P++){var R=T(A[P],A[P+1]);if(x){var I=Array.isArray(x)?x[P]:x;R=sg(I,R)}M.push(R)}var j;return M}(e,a,c),m=d===2?function(A,x){var E=A[0],M=A[1],T=x[0];return function(O){return T(Nu(E,M,O))}}(s,p):function(A,x){var E=A.length,M=E-1;return function(T){var O=0,P=!1;if(T<=A[0]?P=!0:T>=A[M]&&(O=M-1,P=!0),!P){for(var R=1;R<E&&!(A[R]>T||R===M);R++);O=R-1}var I=Nu(A[O],A[O+1],T);return x[O](I)}}(s,p);return o?function(A){return m(Lu(s[0],s[d-1],A))}:m}function Xl(s,e){return s.map(function(){return e||r0}).splice(0,s.length-1)}function qd(s){var e=s.from,t=e===void 0?0:e,n=s.to,r=n===void 0?1:n,o=s.ease,a=s.offset,c=s.duration,d=c===void 0?300:c,p={done:!1,value:t},m=Array.isArray(r)?r:[t,r],A=function(M,T){return M.map(function(O){return O*T})}(a&&a.length===m.length?a:function(M){var T=M.length;return M.map(function(O,P){return P!==0?P/(T-1):0})}(m),d);function x(){return og(A,m,{ease:Array.isArray(o)?o:Xl(m,o)})}var E=x();return{next:function(M){return p.value=E(M),p.done=M>=d,p},flipTarget:function(){m.reverse(),E=x()}}}function ag(s){var e=s.velocity,t=e===void 0?0:e,n=s.from,r=n===void 0?0:n,o=s.power,a=o===void 0?.8:o,c=s.timeConstant,d=c===void 0?350:c,p=s.restDelta,m=p===void 0?.5:p,A=s.modifyTarget,x={done:!1,value:r},E=a*t,M=r+E,T=A===void 0?M:A(M);return T!==M&&(E=T-r),{next:function(O){var P=-E*Math.exp(-O/d);return x.done=!(P>m||P<-m),x.value=x.done?T:T+P,x},flipTarget:function(){}}}var g0={keyframes:qd,spring:Wl,decay:ag},lg=1/60*1e3,cg=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},af=typeof window<"u"?function(s){return window.requestAnimationFrame(s)}:function(s){return setTimeout(function(){return s(cg())},lg)},ug=!0,Yd=!1,v0=!1,lf={delta:0,timestamp:0},cf=["read","update","preRender","render","postRender"],_0=cf.reduce(function(s,e){return s[e]=function(t){var n=[],r=[],o=0,a=!1,c=new WeakSet,d={schedule:function(p,m,A){m===void 0&&(m=!1),A===void 0&&(A=!1);var x=A&&a,E=x?n:r;return m&&c.add(p),E.indexOf(p)===-1&&(E.push(p),x&&a&&(o=n.length)),p},cancel:function(p){var m=r.indexOf(p);m!==-1&&r.splice(m,1),c.delete(p)},process:function(p){var m;if(a=!0,n=(m=[r,n])[0],(r=m[1]).length=0,o=n.length)for(var A=0;A<o;A++){var x=n[A];x(p),c.has(x)&&(d.schedule(x),t())}a=!1}};return d}(function(){return Yd=!0}),s},{}),hl=cf.reduce(function(s,e){var t=_0[e];return s[e]=function(n,r,o){return r===void 0&&(r=!1),o===void 0&&(o=!1),Yd||pg(),t.schedule(n,r,o)},s},{}),hg=cf.reduce(function(s,e){return s[e]=_0[e].cancel,s},{}),OA=function(s){return _0[s].process(lf)},dg=function(s){Yd=!1,lf.delta=ug?lg:Math.max(Math.min(s-lf.timestamp,40),1),lf.timestamp=s,v0=!0,cf.forEach(OA),v0=!1,Yd&&(ug=!1,af(dg))},pg=function(){Yd=!0,ug=!0,v0||af(dg)},fg=function(){return lf},A0=hl;function mg(s,e,t){return t===void 0&&(t=0),s-e-t}var LA=function(s){var e=function(t){var n=t.delta;return s(n)};return{start:function(){return A0.update(e,!0)},stop:function(){return hg.update(e)}}};function Xd(s){var e,t,n,r,o,a=s.from,c=s.autoplay,d=c===void 0||c,p=s.driver,m=p===void 0?LA:p,A=s.elapsed,x=A===void 0?0:A,E=s.repeat,M=E===void 0?0:E,T=s.repeatType,O=T===void 0?"loop":T,P=s.repeatDelay,R=P===void 0?0:P,I=s.onPlay,j=s.onStop,z=s.onComplete,V=s.onRepeat,G=s.onUpdate,X=l0(s,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),ne=X.to,ce=0,ge=X.duration,de=!1,xe=!0,pe=function(Re){if(Array.isArray(Re.to))return qd;if(g0[Re.type])return g0[Re.type];var we=new Set(Object.keys(Re));return we.has("ease")||we.has("duration")&&!we.has("dampingRatio")?qd:we.has("dampingRatio")||we.has("stiffness")||we.has("mass")||we.has("damping")||we.has("restSpeed")||we.has("restDelta")?Wl:qd}(X);!((t=(e=pe).needsInterpolation)===null||t===void 0)&&t.call(e,a,ne)&&(o=og([0,100],[a,ne],{clamp:!1}),a=0,ne=100);var ye=pe(Tr(Tr({},X),{from:a,to:ne}));return d&&(I==null||I(),(n=m(function(Re){if(xe||(Re=-Re),x+=Re,!de){var we=ye.next(Math.max(0,x));r=we.value,o&&(r=o(r)),de=xe?we.done:x<=0}G==null||G(r),de&&(ce===0&&(ge!=null||(ge=x)),ce<M?function(We,ot,ft,nt){return nt?We>=ot+ft:We<=-ft}(x,ge,R,xe)&&(ce++,O==="reverse"?x=function(We,ot,ft,nt){return ft===void 0&&(ft=0),nt===void 0&&(nt=!0),nt?mg(ot+-We,ot,ft):ot-(We-ot)+ft}(x,ge,R,xe=ce%2==0):(x=mg(x,ge,R),O==="mirror"&&ye.flipTarget()),de=!1,V&&V()):(n.stop(),z&&z()))})).start()),{stop:function(){j==null||j(),n.stop()}}}const jh={linear:$p,easeIn:Qd,easeOut:bA,easeInOut:r0,circIn:s0,circOut:Km,circInOut:o0,backIn:Lc,backOut:wA,backInOut:Jm,anticipate:a0,bounceOut:ef,bounceIn:xA,bounceInOut:EA,easeInOutSine:function(s){return-(Math.cos(Math.PI*s)-1)/2}};async function Ir(s){return new Promise(e=>setTimeout(e,Math.max(0,s)))}function uf(s,e,t){const n=s[e],r=()=>{typeof(s==null?void 0:s.setDirty)=="function"&&s.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?o=>{n.copy(o),r()}:o=>{s[e]=o,r()}}function y0(s){return typeof s!="boolean"}async function hf(s,e,t){e in s||console.error("invalid key",e,s);const n=uf(s,e),r=s[e],o=a=>{var c;n(a),(c=t.onUpdate)===null||c===void 0||c.call(t,a)};if(y0(r))return typeof t.to=="function"&&(t={...t,to:t.to(r,s)}),b0({...t,from:r,onUpdate:o});{const{duration:a}=t;return Ir(a??0).then(()=>o(t.to))}}async function b0(s){return new Promise((e,t)=>{Xd({onComplete:()=>{var n;(n=s.onComplete)===null||n===void 0||n.call(s),e()},onStop:()=>{var n;(n=s.onStop)===null||n===void 0||n.call(s),e()},...s})})}class jc extends sl{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[ks],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var t;const n=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(!n)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==n)return void(this.pointerEnabled=!0);const r=n.getBoundingClientRect(),o=(e.clientX-r.left)/r.width,a=(e.clientY-r.top)/r.height;this.pointerEnabled=o<0||o>1||a<0||a>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:f.wem,magFilter:f.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await Ir(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(ks),r=new class extends qv{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=hc("Frame Fade",this)}render(o,a,c,d,p){this.needsSwap=!1;const m=t._target;if(!m||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001)return;t._toSaveFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,m),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=m==null?void 0:m.texture;const A=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(A),this.weights2.w=1,this.weights1.setScalar(1-A),this.weights1.w=1,super.render(o,a,c,d,p),this.needsSwap=!0;const x=ui();this._lastTime<10&&(this._lastTime=x-10);const E=x-this._lastTime;this._lastTime=x,t._fadeTimeState-=E}};return r.enabled=!0,r}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}jc.PluginType="FrameFade";var gg=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},w0=f.M8C.degToRad;class Ii extends Zn{constructor(e=i0,t=!1,n=!0,r=!1){super(),this.enabled=!0,this.autoFocus=!1,this._onObjectHit=o=>{this._viewer&&(this.enabled?this.dispatchEvent(o):o.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const o=this.getSelectedObject();this.autoFocus&&o&&this.setSelectedObject(o,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=r}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new rA(e.scene,e.canvas,void 0,t=>{var n,r;if(!t.material)return!1;let o=t,a=!1;for(;o;){if(!o.visible||(((n=o.userData.iModel)!==null&&n!==void 0?n:o).assetType==="model"&&(a=!0),((r=o.userData.iModel)!==null&&r!==void 0?r:o).assetType==="widget")||o.userData.userSelectable===!1||o.userData.bboxVisible===!1)return!1;o=o.parent}return a}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new x0(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var n,r,o,a;this.dispatchEvent(t);const c=((n=this._picker)===null||n===void 0?void 0:n.selectedObject)||void 0;if(this._pickUi){const m=(r=c)===null||r===void 0?void 0:r.uiConfig,A=this.uiConfig;A.children=[...this._uiConfigChildren],m&&A.children.push(m),(o=A.uiRefresh)===null||o===void 0||o.call(A)}const d=this._widget;d&&(c?d.attach(c):d.detach());const p=this._transformControls;p&&(!((a=this._viewer)===null||a===void 0)&&a.scene.activeCamera.controls)&&(c&&p.enabled?p.attach(c):p.detach()),e.setDirty(),this.autoFocus&&this.focusObject(c)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value?this.setSelectedObject(t.value,this.autoFocus||t.focusCamera):console.warn("e.value must be set for picking")}),e.scene.addEventListener("addSceneObject",async t=>{var n,r,o;const a=t.object,c=this.getSelectedObject();if(c&&(a==null?void 0:a.assetType)==="material"&&typeof(c==null?void 0:c.setMaterial)=="function"&&(!((n=c==null?void 0:c.modelObject)===null||n===void 0)&&n.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const d=c.material;if(Array.isArray(d))console.warn("Dropping on material array not yet fully supported."),c.setMaterial(a);else{let p=Array.from((r=d==null?void 0:d.userData.__appliedMeshes)!==null&&r!==void 0?r:[]);(p.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):p.length<1)&&(p=[c]);for(const m of p)m&&((o=m.setMaterial)===null||o===void 0||o.call(m,a))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let r=!1;n==null||n.traverseAncestors(o=>{o===e.scene.modelObject&&(r=!0)}),r||this.setSelectedObject(void 0)})}async focusObject(e){var t,n,r,o;const a=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CameraViews");await(a==null?void 0:a.animateToObject(e,4,1e3,"easeOut",{min:((o=(r=(n=this._viewer)===null||n===void 0?void 0:n.scene.activeCamera.getControls())===null||r===void 0?void 0:r.minDistance)!==null&&o!==void 0?o:.5)+.5,max:5}))}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}Ii.PluginType="Picking",gg([Ne(),gn()],Ii.prototype,"enabled",void 0),gg([Ne()],Ii.prototype,"autoFocus",void 0);class x0 extends gw{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)===null||t===void 0||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(jc);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(w0(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Kd=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class _r extends Zn{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(r=>{var o,a,c,d;const p=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[_r.DIAMOND_GLTF_EXTENSION];p&&r.geometry&&(this.prepareDiamondMesh(r,p),delete r.userData.gltfExtensions[_r.DIAMOND_GLTF_EXTENSION]),r.material&&!n.includes(r.material)&&(!((d=(c=r.material.userData)===null||c===void 0?void 0:c.gltfExtensions)===null||d===void 0)&&d[_r.DIAMOND_GLTF_EXTENSION])&&(r.material.materialObject||console.warn("material not processed",r.material),n.push(r.material))}),n.forEach(r=>{const o=r.userData.gltfExtensions[_r.DIAMOND_GLTF_EXTENSION];o&&this._convertToDiamondMaterial(r,o)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,n;const r=(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject())===null||n===void 0?void 0:n.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==vs.TypeSlug},value:async()=>{var e,t,n,r,o,a;const c=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();if(!(c!=null&&c.material))return;const d=await((n=this._viewer)===null||n===void 0?void 0:n.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let p=parseInt(await((r=this._viewer)===null||r===void 0?void 0:r.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(p)||(p=512),p<64&&(p=64),((o=c.material.userData)===null||o===void 0?void 0:o.__appliedMeshes.size)>1&&await((a=this._viewer)===null||a===void 0?void 0:a.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(c.material,{cacheKey:d||void 0,normalMapRes:p},{}):this.makeDiamondMesh(c,{cacheKey:d||void 0,normalMapRes:p},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,n;const r=(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject())===null||n===void 0?void 0:n.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==er.TypeSlug},value:async()=>{var e,t,n,r,o,a,c,d;const p=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject(),m=p==null?void 0:p.material;if(!m)return;const A=m.userData._baseMaterial;let x=(o=(r=(n=this._viewer)===null||n===void 0?void 0:n.getManager())===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(A);if(x&&!x.isDiamondMaterial||(x=(a=this._viewer)===null||a===void 0?void 0:a.createPhysicalMaterial({color:m.color})),x){const E=m.userData.__appliedMeshes.size>1&&await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Convert all with this material?"))?Array.from(m.userData.__appliedMeshes):[p];for(const M of E)(d=M==null?void 0:M.setMaterial)===null||d===void 0||d.call(M,x)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,t;return(t=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&t!==void 0?t:0}set envMapRotation(e){var t;const n=this.envMap;n&&(n.rotation=e,(t=this._viewer)===null||t===void 0||t.scene.setDirty())}refreshEnvMaps(){var e,t,n;if(!this._viewer)return;const r=this.getEnvMap(),o=((t=(e=this._viewer.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0?void 0:t.getMaterialsOfType(er.TypeSlug))||[];for(const a of o)a&&a.envMap!==r&&(a.envMap=r,a.needsUpdate=!0);(n=this._viewer)===null||n===void 0||n.scene.setDirty()}refreshUi(){var e,t,n;(e=this._viewer)===null||e===void 0||e.setDirty(),(n=(t=this.uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}async onAdded(e){var t,n,r,o,a,c;this._normalCapture=new $_(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const d=e.getPlugin(ln);(t=d==null?void 0:d.importer)===null||t===void 0||t.processors.add("model",this._modelProcessor),(n=e.getPlugin(Ii))===null||n===void 0||n.addEventListener("selectedObjectChanged",this.refreshUi);const p=this.getEnvMap,m=new dr(class extends yd{async loadAsync(A,x){var E;const M=await super.loadAsync(A,x);return M.type===er.TYPE||M.isDiamondMaterialParameters?(M.envMap=p(),(E=d==null?void 0:d.materials)===null||E===void 0?void 0:E.generateFromTemplate("diamond",M)):(console.error("Invalid material type for Diamond Material.",M),null)}},[er.TypeSlug],!1);return si.Importers.push(m),(a=(o=(r=d==null?void 0:d.exporter)===null||r===void 0?void 0:r.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||a===void 0||a.push(df),(c=d==null?void 0:d.materials)===null||c===void 0||c.registerMaterialTemplate({name:"diamond",materialType:er.TYPE,isDiamondMaterialParameters:!0,generator:(A,x)=>{const E=new er(A);return E.envMap=p(),x&&x!=={}&&E.copyProps(x),E}}),super.onAdded(e)}async onRemove(e){var t,n,r,o;return(t=this._normalCapture)===null||t===void 0||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(r=(n=e.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.processors.remove("model",this._modelProcessor),(o=e.getPlugin(Ii))===null||o===void 0||o.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){var r,o,a;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const c=(o=(r=this._normalCapture)===null||r===void 0?void 0:r.captureNormalMap(e.geometry,t,n))!==null&&o!==void 0?o:[void 0,!1],d=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("debug");d&&c&&(d.counters.normalsCapture||(d.counters.normalsCapture=0),d.counters.normalsCapture++,console.log("DEBUG: new normal map captured",d.counters.normalsCapture,t),d.addTexture("normal"+d.counters.normalsCapture,()=>{var p;return(p=e.geometry.userData._normalsCaptureMap)===null||p===void 0?void 0:p.texture},[40,110*d.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var r,o;Array.from((r=e==null?void 0:e.userData.__appliedMeshes)!==null&&r!==void 0?r:[]).forEach(a=>{a!=null&&a.isMesh&&a.geometry&&this.prepareDiamondMesh(a,t)}),this._convertToDiamondMaterial(e,n),(o=this._viewer)===null||o===void 0||o.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const r=Array.isArray(e.material)?e.material[0]:e.material,o=this._convertToDiamondMaterial(r,n,!1);e.setMaterial(o)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var r,o,a,c,d,p,m;let A={...t??{}};A.isDiamond||A.isDiamondMaterialParameters?Array.isArray(A.boostFactors)&&(A.boostFactors=new f.Pa4().fromArray(A.boostFactors)):A={isDiamondMaterialParameters:!0},A.color=(a=(r=A.color)!==null&&r!==void 0?r:(o=e==null?void 0:e.materialObject)===null||o===void 0?void 0:o.color)!==null&&a!==void 0?a:new Pi(1,1,1);const x=(p=(d=(c=this._viewer)===null||c===void 0?void 0:c.getManager())===null||d===void 0?void 0:d.materials)===null||p===void 0?void 0:p.generateFromTemplate("diamond",A);if(x&&e&&!e.isDiamondMaterial&&(x.userData._baseMaterial=e.uuid),n){const E=M=>{var T;return(T=M.setMaterial)!==null&&T!==void 0?T:O=>{M.material=O.materialObject}};Array.from((m=e==null?void 0:e.userData.__appliedMeshes)!==null&&m!==void 0?m:[]).forEach(M=>{E(M)(x),this.prepareDiamondMesh(M,t)})}return x}_computeOffsets(e,t,n=!1){const r=t.split(";").find(p=>this.offsetCache[p]);if(r&&!n){const p=this.offsetCache[r];return t.split(";").forEach(m=>m!==r&&(this.offsetCache[m]=p)),e.userData._normalsCaptureOffsets=p,p}e.computeBoundingBox();const o=e.boundingBox.getCenter(new f.Pa4),a=nA(e),c=a.clone().invert(),d={center:o,offsetMatrix:a,offsetMatrixInv:c,radius:1,centerOffset:new f.Pa4().copy(o).applyMatrix4(c)};return t.split(";").forEach(p=>this.offsetCache[p]=d),e.userData._normalsCaptureOffsets=d,d}}_r.PluginType="Diamond",_r.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Kd([ve(_r.prototype.refreshEnvMaps),Ne()],_r.prototype,"envMap",void 0),Kd([ve(_r.prototype.refreshEnvMaps),Ne()],_r.prototype,"forceSceneEnvMap",void 0);const df=s=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[_r.DIAMOND_GLTF_EXTENSION]=e.toJSON(),s.extensionsUsed[_r.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var n,r;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const o={};(r=(n=e.userData)===null||n===void 0?void 0:n.gltfExtensions)===null||r===void 0||delete r[_r.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(o.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(o.cacheKey=e.userData._diamondCacheKey),t.extensions[_r.DIAMOND_GLTF_EXTENSION]=o,s.extensionsUsed[_r.DIAMOND_GLTF_EXTENSION]=!0}});var sa,as=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let rr=sa=class extends Zn{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[ln],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=s=>{const e=s.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(t=>{const n=t.animations;if(n.length<1)return;const r=Math.max(...n.map(c=>c.duration));n.forEach(c=>c.duration=r);const o=new f.Xcj(this._viewer.scene.modelRoot.modelObject),a=n.map(c=>o.clipAction(c).setLoop(this.loopAnimations?f.YKA:f.jAl,this.loopRepetitions));this.animations.push({mixer:o,clips:n,actions:a,duration:r}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:s}){this.enabled&&Math.abs(s)>.001&&(this._scrollAnimationState=-1*Math.sign(s))}_postFrame(){var s,e;if(!this._viewer)return;const t=this._viewer,n=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!n)return this._lastFrameTime=0,void(this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))===null||s===void 0||s.enable(sa.PluginType),this._fadeDisabled=!1));const r=ui()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/30);let o=r-this._lastFrameTime;if(o*=this.animationSpeed,this._lastFrameTime=r,n&&(o*=this._scrollAnimationState),Math.abs(o)<1e-4)return;const a=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(a&&a>0&&(o=a),a!==0&&(this.animations.map(c=>c.mixer.update(o)),this._animationTime+=o,this._animationTime>this._animationDuration&&(this._animationTime-=this._animationDuration),this._animationTime<0&&(this._animationTime+=this._animationDuration),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,t.scene.activeCamera.cameraObject.userData.__animatingCamera&&t.scene.activeCamera.setDirty(),t.renderer.resetShadows(),t.setDirty(),!this._fadeDisabled)){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(sa.PluginType),this._fadeDisabled=!0)}}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new zc(e,this))}async onAdded(s){var e,t,n,r,o,a;(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),s.scene.addEventListener("addSceneObject",this._objectAdded),(a=(o=(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.exporter)===null||r===void 0?void 0:r.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||a===void 0||a.push(pf),s.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let c=-1;return Object.defineProperty(s.scene.modelRoot,"currentTimelineMarker",{get:()=>c,set:d=>s.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[c=d]})}),s.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:d})=>{var p;if(!this._viewer)return;if(!d)return this._viewer.scene.activeCamera=(p=this._viewer)===null||p===void 0?void 0:p.scene.defaultCamera,void this._viewer.setDirty();const m=d.camera;m&&(m.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(m))}),super.onAdded(s)}async onRemove(s){var e,t;return s.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),s.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(s)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:s})=>s))}onStateChange(){var s,e;(e=(s=this.uiConfig)===null||s===void 0?void 0:s.children)===null||e===void 0||e.map(t=>t&&ke(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)===null||n===void 0?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(s,e=!1){return this.playClips([s],e)}async playClips(s,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(r=>{s.includes(r.getClip().name)&&t.push(r)})}),this.playAnimation(e,t)}async playAnimation(s=!1,e){var t,n,r;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1),Te((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"))===null||n===void 0?void 0:n.transformControls,"enabled",!1);let o=0;e||(e=[],this.animations.forEach(({mixer:d,actions:p,clips:m})=>{e.push(...p)}));const a=gs();this._lastAnimId=a,this._animationState!=="paused"&&this.resetAnimation();for(const d of e)this.timeScale>0&&(d.timeScale=this.timeScale),d.setLoop(this.loopAnimations?f.YKA:f.jAl,this.loopRepetitions),d.play(),o=Math.max(o,d.getClip().duration/d.timeScale);if(this._animationState="playing",(r=this._viewer)===null||r===void 0||r.setDirty(),o*=this.loopAnimations?this.loopRepetitions:1,o/=this.animationSpeed,!isFinite(o))return;const c=1e3*o-this._animationTime/this.animationSpeed+.01;c>0&&await Ir(c),a===this._lastAnimId&&this.stopAnimation(s)}pauseAnimation(){var s,e,t;this._animationState="paused",Te((e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.transformControls,"enabled",!0),(t=this._viewer)===null||t===void 0||t.setDirty(),this._lastAnimId=""}stopAnimation(s=!1){var e,t,n;this._animationState="stopped",Te((e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"),"enabled",!0),s?this.resetAnimation():(t=this._viewer)===null||t===void 0||t.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((n=this._viewer.getPluginByType("FrameFade"))===null||n===void 0||n.enable(sa.PluginType),this._fadeDisabled=!1)}resetAnimation(){var s;this._animationState==="stopped"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(s=this._viewer)===null||s===void 0||s.setDirty()):this.stopAnimation(!0)}};rr.PluginType="GLTFAnimation",rr.AnimationMarkersExtension="WEBGI_animation_markers",as([uc()],rr.prototype,"animationState",null),as([uc()],rr.prototype,"animationTime",null),as([uc()],rr.prototype,"animationDuration",null),as([ve(sa.prototype.onPropertyChange),gn("Loop",{limitedUi:!0})],rr.prototype,"loopAnimations",void 0),as([ve(sa.prototype.onPropertyChange)],rr.prototype,"loopRepetitions",void 0),as([ve(sa.prototype.onPropertyChange)],rr.prototype,"timeScale",void 0),as([gn(),Ne()],rr.prototype,"animateOnScroll",void 0),as([An("Speed",[.1,4],.1,{limitedUi:!0}),Ne()],rr.prototype,"animationSpeed",void 0),as([ve(sa.prototype.onStateChange)],rr.prototype,"_animationState",void 0),as([Si("Play/Pause",s=>({label:()=>s.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],rr.prototype,"playPauseAnimation",null),as([Si("Stop",{limitedUi:!0})],rr.prototype,"stopAnimation",null),as([Si("Reset",{limitedUi:!0})],rr.prototype,"resetAnimation",null),rr=sa=as([ci("GLTF Animations")],rr);class zc{constructor(e,t){this.parser=e,this.name=rr.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){var t;let n=[];for(const x of this.parser.json.scenes){if(!x.extensions)continue;const E=x.extensions[this.name];for(const M of(E==null?void 0:E.markers)||[]){const T=M.camera!==void 0?await this.parser.getDependency("camera",M.camera):void 0;M.time===void 0&&(M.time=M.frame/30,console.error("Update timeline markers plugin for correct times.")),n.push({name:M.name,frame:M.frame,time:M.time,camera:T})}}if(n.length<1)return;n=n.sort((x,E)=>x.frame-E.frame);const r=(t=e.scene)!==null&&t!==void 0?t:e.scenes[0];if(!r)return;r.userData.__markers=n;const o=this.plugin.timelineMarkers,a=n.map(x=>x.time);let c=o.length;const d=n.map(x=>c++),p=Math.max(...a)+.01;o.push(...n);const m=new f.dUE(".currentTimelineMarker",a,d,2300),A=new f.m7l("animationTimelineMarker",p,[m]);A.__gltfExport=!1,e.animations.push(A)}}const pf=s=>({afterParse(e){const t=s.json.scenes[s.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},r=[];if((Array.isArray(e)?e:[e]).forEach(o=>o.traverse(a=>{a.userData.__markers&&r.push(...a.userData.__markers)})),r.sort((o,a)=>o.frame-a.frame),!(r.length<1)){for(const o of r){const a=o.camera;if(a){const c=s.nodeMap.get(a);if(c===void 0){console.warn("Camera not found in gltf export",a,s.nodeMap);continue}const d=s.json.nodes[c].camera;o.camera=d,n.markers.push(o)}}t.extensions[rr.AnimationMarkersExtension]=n,s.extensionsUsed[rr.AnimationMarkersExtension]=!0}}});class dl extends ct{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,n,r,o,a="postRender",c=!1){var d;this._generators.has(a)||this._generators.set(a,[]),(d=this._generators.get(a))===null||d===void 0||d.push({key:e,fn:t,rect:n?[...n]:void 0,frag:o||r||c?new f.jyz({vertexShader:It.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:o??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${c?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${c?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${r??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n,r;this._generators.set(t,(r=(n=this._generators.get(t))===null||n===void 0?void 0:n.filter(o=>o.key!==e))!==null&&r!==void 0?r:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const n=this._viewer,r=n==null?void 0:n.renderer;r&&n&&((t=this._generators.get(e))===null||t===void 0||t.forEach(({key:o,fn:a,rect:c,frag:d})=>{const p=a(n);if(p){if(p.image&&c){const m=p.image.width/p.image.height;c[2]<1&&c[3]<1&&(c[2]=200),c[2]<1&&(c[2]=c[3]*m),c[3]<1&&(c[3]=c[2]/m)}r.blit(p,void 0,{viewport:c,clear:!1,material:d})}}))}}dl.PluginType="debug";var Jd=function(s,e){return Jd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])},Jd(s,e)};function ff(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=s}Jd(s,e),s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Zd,vg=function(){function s(){}return s._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},s}(),zh=function(s){function e(t){var n=s.call(this)||this;return n.a=e._xfnv1a(t)(),n}return ff(e,s),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(vg),NA=function(s){function e(t){var n=s.call(this)||this,r=e._xfnv1a(t);return n.a=r(),n.b=r(),n.c=r(),n.d=r(),n}return ff(e,s),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(vg),ju=function(s){function e(t){var n=s.call(this)||this,r=e._xfnv1a(t);return n.a=r(),n.b=r(),n.c=r(),n.d=r(),n}return ff(e,s),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(vg);(function(s){s.sfc32="sfc32",s.mulberry32="mulberry32",s.xoshiro128ss="xoshiro128ss"})(Zd||(Zd={}));var mf=function(){function s(e,t){t===void 0&&(t=Zd.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return s.prototype.next=function(){return this.generator.next()},s.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new NA(this.str);case"mulberry32":return new zh(this.str);case"xoshiro128ss":return new ju(this.str);default:return this.wrap()}},s.prototype.wrap=function(){return{next:function(){return Math.random()}}},s}(),UA=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class gf extends Hl{constructor(e,t,n,r){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new f.Pa4(10,10,10),normalDirection:new f.Pa4(.01,.98,.01).normalize(),direction:new f.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=r??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const r=new mf(e.toString()),o=new f.FM8(r.next()*Math.PI*2,Math.asin(2*r.next()-1));let a=new f.Pa4(Math.cos(o.x)*Math.cos(o.y),Math.sin(o.y),Math.sin(o.x)*Math.cos(o.y));const c=new f.FM8;for(let d=0;d<5;d++){c.set(r.next(),r.next()),a=FA(c,this._randomParams.normalDirection,.4),r.next()<Math.sqrt(t??this._randomParams.focus)&&(c.set(r.next(),r.next()),a=FA(c,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const p=a.dot(this._randomParams.normalDirection);if(p>0&&p<.4)break}a.normalize(),a.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(a.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new f.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function FA(s,e,t){e=e.clone().normalize();const n=new f.Pa4(0,-e.z,e.y).normalize(),r=new f.Pa4().crossVectors(e,n).normalize(),o=s;o.x=2*o.x*Math.PI,o.y=1-o.y*t;const a=Math.sqrt(1-o.y*o.y);return n.multiplyScalar(Math.cos(o.x)*a).add(r.multiplyScalar(Math.sin(o.x)*a)).add(e.multiplyScalar(o.y))}UA([Ne("shadowParams")],gf.prototype,"_shadowParams",void 0),UA([Ne("randomParams")],gf.prototype,"_randomParams",void 0);class E0 extends f.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",K`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([ae({propKey:"tLastThis"})],E0.prototype,"lastFrameTexture",void 0);var vf=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class pl{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(n,r,o)=>{this.groundMapMode==="aoMap"?n.fragmentShader=hr(n.fragmentShader,"#include <aomap_fragment>",hr(f.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=hr(n.fragmentShader,"#include <map_fragment>",hr(f.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=hr(n.fragmentShader,"#include <alphamap_fragment>",hr(f.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&o.capabilities.isWebGL2&&(n.fragmentShader=hr(n.fragmentShader,"#include <output_fragment>",K`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,r)=>{r.materialObject.userData.gMapMode!==this.groundMapMode&&(r.materialObject.userData.gMapMode=this.groundMapMode,r.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new gf(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new f.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new f.Pa4(10,10,10),normalDirection:new f.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new E0({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:f.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e),(n=this._viewer)===null||n===void 0||n.setDirty()}fromJSON(e,t){return mi(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:f.ywz,depthBuffer:!1,size:new f.FM8(t,t),sizeMultiplier:void 0,encoding:f.rnI,format:f.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,r=n.shadowMap,o=r.type,a=r.needsUpdate,c=r.autoUpdate;r.type=f._MY,r.needsUpdate=!0,r.autoUpdate=!1;const d=this._viewer.scene,p=new f.S9g;p.disableAll(),d.modelObject.traverse(M=>{M.isLight&&M!==this._light.lightObject&&(M.userData.__gp_layers=M.layers,M.layers=p)});const m=d.activeCamera.cameraObject;if(m.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";m.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),$t(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(d)),m.layers.disable(this._lightLayer);const A=m.layers.mask;m.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const x=this._viewer.renderer.getTempTarget({type:f.ywz,depthBuffer:!1,size:new f.FM8(t,t),encoding:f.rnI,format:f.wk1}),E=x.texture.encoding;x.texture.encoding=f.rnI,this._viewer.renderer.blit(this._target.texture,x,{clear:!0});{const M=d.modelObject.environment,T=d.modelObject.background,O=e.material,P=e.frustumCulled,R=n.getRenderTarget(),I=n.getActiveCubeFace(),j=n.getActiveMipmapLevel();d.modelObject.background=null,d.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=x.texture,this._shadowMat.needsUpdate=!0,$t(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(d)),n.setRenderTarget(R,I,j),e.frustumCulled=P,e.material=O,d.modelObject.environment=M,d.modelObject.background=T}return x.texture.encoding=E,this._viewer.renderer.releaseTempTarget(x),e.layers.disable(this._lightLayer),m.layers.mask=A,d.modelObject.traverse(M=>{M.isLight&&M!==this._light.lightObject&&(M.layers=M.userData.__gp_layers,delete M.userData.__gp_layers)}),r.type=o,r.needsUpdate=a,r.autoUpdate=c,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,r;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)===null||t===void 0?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)===null||n===void 0?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((r=this._target)===null||r===void 0?void 0:r.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}vf([Ne("randomizedLight")],pl.prototype,"_light",void 0),vf([ve(pl.prototype.reset),Ne()],pl.prototype,"maxFrameNumber",void 0),vf([ve(pl.prototype._groundMapModeChanged),Ne()],pl.prototype,"groundMapMode",void 0),vf([Ne(),ve(pl.prototype._alphaVignetteChanged)],pl.prototype,"alphaVignette",void 0),vf([Ne(),ve(pl.prototype._alphaVignetteChanged)],pl.prototype,"alphaVignetteAxis",void 0);var jA="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",_g=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Qh extends f.Kj0{constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new f.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(O,P,R)=>{if(this.enabled){O.vertexShader=O.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const I="#glMarker beforeModulation";O.fragmentShader=O.fragmentShader.replace(I,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+I),O.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?jA+`
`+ll+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:O=>this.enabled+" "+O.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(O,{materialObject:P})=>{P.userData.__lastTransparent!==P.transparent&&(P.needsUpdate=!0,P.userData.__lastTransparent=P.transparent)},isCompatible:O=>O.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const r=new f.JOQ,o=new f.Pa4,a=new f.Pa4,c=new f.Pa4,d=new f.yGw,p=new f.Pa4(0,0,-1),m=new f.Ltg,A=new f.Pa4,x=new f.Pa4,E=new f.Ltg,M=new f.yGw,T=new f.cPb;f.M8C.isPowerOfTwo(t.texture.image.width)&&f.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(O,P,R)=>{if(!this.enabled||!O.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const I=R.view?Object.assign({},R.view):null;if(I&&R.clearViewOffset&&R.clearViewOffset(),a.setFromMatrixPosition(this.matrixWorld),c.setFromMatrixPosition(R.matrixWorld),d.extractRotation(this.matrixWorld),o.set(0,0,1),o.applyMatrix4(d),A.subVectors(a,c),A.dot(o)>0)return;A.reflect(o).negate(),A.add(a),d.extractRotation(R.matrixWorld),p.set(0,0,-1),p.applyMatrix4(d),p.add(c),x.subVectors(a,p),x.reflect(o).negate(),x.add(a),T.position.copy(A),T.up.set(0,1,0),T.up.applyMatrix4(d),T.up.reflect(o),T.lookAt(x),T.far=2,T.near=0,T.updateMatrixWorld(),T.projectionMatrix.copy(R.projectionMatrix),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(T.projectionMatrix),M.multiply(T.matrixWorldInverse),M.multiply(this.matrixWorld),r.setFromNormalAndCoplanarPoint(o,a),r.applyMatrix4(T.matrixWorldInverse),m.set(r.normal.x,r.normal.y,r.normal.z,r.constant);const j=T.projectionMatrix;E.x=(Math.sign(m.x)+j.elements[8])/j.elements[0],E.y=(Math.sign(m.y)+j.elements[9])/j.elements[5],E.z=-1,E.w=(1+j.elements[10])/j.elements[14],m.multiplyScalar(2/m.dot(E)),j.elements[2]=m.x,j.elements[6]=m.y,j.elements[10]=m.z+1-n,j.elements[14]=m.w,this.visible=!1;const z=O.getRenderTarget(),V=O.xr.enabled,G=O.shadowMap.autoUpdate;O.xr.enabled=!1,O.shadowMap.autoUpdate=!1,O.setRenderTarget(this._renderTarget),O.state.buffers.depth.setMask(!0),O.autoClear===!1&&O.clear();const X=P.background;this.transparentReflectionBackground&&(P.background=null);const ne=!this.transparentReflectionBackground;X&&ne&&(X.userData.flipX=!X.userData.flipX),$t(O,{shadowMapRender:!1,backgroundRender:ne,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>O.render(P,T)),X&&ne&&(X.userData.flipX=!X.userData.flipX||void 0),this.transparentReflectionBackground&&(P.background=X),O.xr.enabled=V,O.shadowMap.autoUpdate=G,O.setRenderTarget(z),I!=null&&I.enabled&&R.setViewOffset&&R.setViewOffset(I.fullWidth,I.fullHeight,I.offsetX,I.offsetY,I.width,I.height);const ce=R.viewport;ce!==void 0&&O.state.viewport(ce),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=M,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new f.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=M}_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e)}getRenderTarget(){return this._renderTarget}}_g([ve(Qh.prototype._updateExtension)],Qh.prototype,"enabled",void 0),_g([ve(Qh.prototype._updateExtension)],Qh.prototype,"reflectorModePhysical",void 0),Qh.prototype.isReflector=!0;var Ia=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Zs extends Zn{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[ln],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new f._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new f.Kj0(this._geometry)}async onAdded(e){var t,n;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(ln);const r=this._createMesh();r.userData.physicsMass=0,this._iMesh=await((t=this._manager)===null||t===void 0?void 0:t.addImportedSingle(r,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(n=this._iMesh)===null||n===void 0?void 0:n.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n;return this._geometry.dispose(),(n=(t=this._iMesh)===null||t===void 0?void 0:t.dispose)===null||n===void 0||n.call(t),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,t;this._material&&((t=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;t&&(t.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,n;if(!this._mesh||!this._viewer)return;let r=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,r=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const o=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const a=o.getCenter(new f.Pa4).sub(new f.Pa4(0,o.getSize(new f.Pa4).y/2+this.yOffset,0));r=r||a.clone().sub(this._mesh.position).length()>1e-4,r&&this._mesh.position.copy(a)}r=r||Math.abs(this._mesh.scale.x-this.size)>1e-4,r&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new f.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(n=(t=this._mesh).setDirty)===null||n===void 0||n.call(t)),this._transformNeedRefresh=!1}else r&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,t,n,r,o,a,c,d;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const p=(t=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||t===void 0?void 0:t.findOrCreate((r=(n=this._material)===null||n===void 0?void 0:n.uuid)!==null&&r!==void 0?r:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let m=!1;return(p==null?void 0:p.uuid)!==((o=this._material)===null||o===void 0?void 0:o.uuid)&&(this._removeMaterial(),p&&(this._material=p),!((a=this._material)===null||a===void 0)&&a.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((d=(c=this._mesh)===null||c===void 0?void 0:c.setMaterial)!==null&&d!==void 0?d:A=>{this._mesh&&(this._mesh.material=A.materialObject)})(this._material)),m=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),m}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}Ia([Ne("material")],Zs.prototype,"_material",void 0),Ia([ve(Zs.prototype.refreshTransform),Ne()],Zs.prototype,"visible",void 0),Ia([ve(Zs.prototype._onSceneUpdate),Ne()],Zs.prototype,"size",void 0),Ia([ve(Zs.prototype._onSceneUpdate),Ne()],Zs.prototype,"yOffset",void 0),Ia([ve(Zs.prototype._refreshOptions2),Ne()],Zs.prototype,"renderToDepth",void 0),Ia([ve(Zs.prototype._refreshOptions2),Ne()],Zs.prototype,"tonemapGround",void 0),Ia([ve(Zs.prototype._refreshCameraLimits),Ne()],Zs.prototype,"limitCameraAboveGround",void 0);var mr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class zo extends Zs{constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=t,t&&this.dependencies.push(dl),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new Qh(this._geometry,this._viewer.renderer.createTarget({type:f.ywz,format:f.wk1,encoding:f.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:f.D1R,magFilter:f.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var r,o,a,c,d;let p=(o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("SSReflection"))===null||o===void 0?void 0:o.passes.ssr.passObject;p&&!p.enabled&&(p=void 0),p&&(p.enabled=!1);let m=(d=(c=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSBevelPlugin"))===null||c===void 0?void 0:c.pass)===null||d===void 0?void 0:d.passObject;m&&!m.enabled&&(m=void 0),m&&(m.enabled=!1),t(...n),p&&(p.enabled=!0),m&&(m.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(dl))===null||t===void 0||t.addTexture("bake_ground_1",()=>{var r,o;return(o=(r=this._shadowBaker)===null||r===void 0?void 0:r.light.shadow.map)===null||o===void 0?void 0:o.texture},[100,100,200,200]),(n=e.getPlugin(dl))===null||n===void 0||n.addTexture("bake_ground_2",()=>{var r,o;return(o=(r=this._shadowBaker)===null||r===void 0?void 0:r.target)===null||o===void 0?void 0:o.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,r;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)===null||t===void 0||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o||console.warn("unable to find the extension to unregister"),(r=(n=this._material).unregisterMaterialExtensions)===null||r===void 0||r.call(n,[o]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&((t=this._shadowBaker)===null||t===void 0||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new pl(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,n,r;if(!this._viewer)return!1;const o=super._refreshMaterial();if(!this._material)return o;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const a=this._mesh.materialExtension;a.updaters=[this._viewer.scene,this._viewer.renderer],(t=(e=this._material).registerMaterialExtensions)===null||t===void 0||t.call(e,[a]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((r=(n=this._material).registerMaterialExtensions)===null||r===void 0||r.call(n,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),o}_extraUiConfig(){var e,t,n,r,o,a,c,d,p,m,A,x,E,M,T,O,P,R,I,j,z,V,G,X,ne,ce,ge,de,xe,pe;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var ye,Re;return(Re=(ye=this._uiConfig)===null||ye===void 0?void 0:ye.uiRefresh)===null||Re===void 0?void 0:Re.call(ye,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var ye;return!(!((ye=this._shadowBaker)===null||ye===void 0)&&ye.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(ye=>({label:ye,value:ye})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)===null||t===void 0?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(r=(n=this._shadowBaker)===null||n===void 0?void 0:n.light)===null||r===void 0?void 0:r.shadowParams,"enabled"],onChange:[(a=(o=this._shadowBaker)===null||o===void 0?void 0:o.light)===null||a===void 0?void 0:a.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(d=(c=this._shadowBaker)===null||c===void 0?void 0:c.light)===null||d===void 0?void 0:d.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(m=(p=this._shadowBaker)===null||p===void 0?void 0:p.light)===null||m===void 0?void 0:m.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(x=(A=this._shadowBaker)===null||A===void 0?void 0:A.light)===null||x===void 0?void 0:x.randomParams,"distanceScale"],onChange:[(M=(E=this._shadowBaker)===null||E===void 0?void 0:E.light)===null||M===void 0?void 0:M.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(O=(T=this._shadowBaker)===null||T===void 0?void 0:T.light)===null||O===void 0?void 0:O.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(R=(P=this._shadowBaker)===null||P===void 0?void 0:P.light)===null||R===void 0?void 0:R.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(j=(I=this._shadowBaker)===null||I===void 0?void 0:I.light)===null||j===void 0?void 0:j.shadowParams,"radius"],onChange:[(V=(z=this._shadowBaker)===null||z===void 0?void 0:z.light)===null||V===void 0?void 0:V.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(X=(G=this._shadowBaker)===null||G===void 0?void 0:G.light)===null||X===void 0?void 0:X.shadowParams,"frustumSize"],onChange:[(ce=(ne=this._shadowBaker)===null||ne===void 0?void 0:ne.light)===null||ce===void 0?void 0:ce.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(de=(ge=this._shadowBaker)===null||ge===void 0?void 0:ge.light)===null||de===void 0?void 0:de.shadowParams,"bias"],onChange:[(pe=(xe=this._shadowBaker)===null||xe===void 0?void 0:xe.light)===null||pe===void 0?void 0:pe.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}zo.PluginType="Ground",mr([ve(zo.prototype.refreshOptions),Ne()],zo.prototype,"bakedShadows",void 0),mr([ve(zo.prototype.refreshOptions),Ne()],zo.prototype,"groundReflection",void 0),mr([ve(zo.prototype.refreshOptions),Ne()],zo.prototype,"physicalReflections",void 0),mr([Ne("shadowBaker")],zo.prototype,"_shadowBaker",void 0);var zu,Da=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Qo=zu=class extends Vr{constructor(){super({vertexShader:It.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new f.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:kl+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new f.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(s,e,t,n,r){const o=s.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=t;let c=.5,d=a.width*c,p=a.height*c;const m=[];let A=o.getTempTarget({sizeMultiplier:.5,type:f.cLu});m.push(A);let x=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(s,A,x,n,r),x=A;let E=1;for(;E<this.bloomIterations&&(d/=2,p/=2,c/=2,!(p<2||d<2));E++){A=o.getTempTarget({sizeMultiplier:c,type:f.cLu}),m.push(A),this.material.defines.PASS_STEP=1;let T=this._weights[E];T=this._weights[E-1]!==0?this._weights[E]/this._weights[E-1]:this._weights[E],this.material.uniforms.weight.value=T,this.material.needsUpdate=!0,super.render(s,A,x,n,r),x=A}this.clear=!1;const M=s.autoClear;for(s.autoClear=!1,E-=2;E>=0;E--)A=m[E],m[E]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=f.WMw,this.material.needsUpdate=!0,s.autoClear=!1,super.render(s,A,x,n,r),this.material.blending=f.jFi,o.releaseTempTarget(x),x=A;this.clear=!0,s.autoClear=M,s.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(s,e,x,n,r)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(s,e,x,n,r),this.uniforms.tSource.value=null),o.releaseTempTarget(x)}_updateWeights(){if(!this._weights)return;const s=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,r=1.2-n;n=Math.pow(n,this.power),r=Math.pow(r,this.power),this._weights[t]=r*(1-s)+n*s}this.setDirty()}};Da([ae()],Qo.prototype,"prefilter",void 0),Da([An("Threshold",[0,2]),ve(zu.prototype._thresholdsUpdated),Ne()],Qo.prototype,"threshold",void 0),Da([An("Soft Threshold",[0,1]),ve(zu.prototype._thresholdsUpdated),Ne()],Qo.prototype,"softThreshold",void 0),Da([An("Intensity",[0,3]),Ne(),ae()],Qo.prototype,"intensity",void 0),Da([An("Iterations",[0,7],1),ve(zu.prototype._updateWeights),Ne()],Qo.prototype,"bloomIterations",void 0),Da([An("Radius",[0,1],.01),ve(zu.prototype._updateWeights),Ne()],Qo.prototype,"radius",void 0),Da([An("Power",[.2,10],.01),ve(zu.prototype._updateWeights),Ne()],Qo.prototype,"power",void 0),Da([gn("Debug")],Qo.prototype,"bloomDebug",void 0),Qo=zu=Da([ci("Bloom")],Qo);class Qu extends sl{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new Qo}_update(e){var t,n;return(t=e.getPlugin(qi))===null||t===void 0||t.updateShaderProperties((n=this.pass)===null||n===void 0?void 0:n.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Qu.PluginType="Bloom";var Ag=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Vo=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const r=(n=e.materialObject.userData)===null||n===void 0?void 0:n._anisotropyDirectionMap,o=K`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${ll}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(r?pt("anisotropyDirectionMap",r,t.capabilities.isWebGL2):"");s.fragmentShader=s.fragmentShader.replace("#include <bsdfs>",o),s.fragmentShader=s.fragmentShader.replace("#include <lights_fragment_begin>",f.WdD.lights_fragment_begin),s.fragmentShader=s.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const a=f.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");s.fragmentShader=s.fragmentShader.replace("#include <lights_physical_pars_fragment>",a);const c=K`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+f.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");s.fragmentShader=s.fragmentShader.replace("#include <lights_fragment_maps>",c),s.vertexUvs=!0,s.vertexTangents=!0},onObjectRender:(s,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._isAnisotropic))return;const r=s;if(!r.isMesh||!r.geometry)return;if(!r.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=n._anisotropyFactor,this._uniforms.anisotropyNoise.value=n._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((t=n._anisotropyDirectionMap)===null||t===void 0)&&t.isTexture?n._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=n._anisotropyDirection;let o=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==o&&(e.materialObject.defines.ANISOTROPY_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==o&&(e.materialObject.defines.ANISOTROPY_DEBUG=o,e.materialObject.needsUpdate=!0),o=n._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(o="CONSTANT"),o=o==="DIRECTION"?2:o==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==o&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+(!((e=s.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((n=(t=s.materialObject.userData)===null||t===void 0?void 0:t._anisotropyDirectionMap)===null||n===void 0?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>{var s;return[(s=this._viewer)===null||s===void 0?void 0:s.renderer]},getUiConfig:s=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._isAnisotropic||!1},set value(r){var o;r!==s.materialObject.userData._isAnisotropic&&(r?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._isAnisotropic=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)===null||o===void 0||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(r=>({label:r})),onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this.makeSelectedAnisotropic=()=>{var s,e,t;const n=(t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Ii))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.makeAnisotropic(n)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(s){var e;const t=(e=s.materialObject)===null||e===void 0?void 0:e.userData;if(!t)return!1;if(t._isAnisotropic===void 0){const n=t.__appliedMeshes;let r=!0;if(n)for(const{geometry:o}of n)!o||o.index&&o.attributes.position&&o.attributes.normal&&o.attributes.uv||(r=!1),r&&!o.attributes.tangent&&o.computeTangents();if(!r)return!1}return t._isAnisotropic=!0,t._anisotropyFactor===void 0&&(t._anisotropyFactor=1),t._anisotropyNoise===void 0&&(t._anisotropyNoise=0),t._anisotropyDirectionMode===void 0&&(t._anisotropyDirectionMode="DIRECTION"),s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new _f(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(ln);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(C0)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};Vo.PluginType="AnisotropyPlugin",Vo.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",Ag([gn("Enabled",s=>({onChange:s.setDirty})),Ne()],Vo.prototype,"enabled",void 0),Ag([Si("Make Anisotropy",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPlugin(Ii))}}))],Vo.prototype,"makeSelectedAnisotropic",void 0),Vo=Ag([ci("Anisotropy Materials")],Vo);class _f{constructor(e){this.parser=e,this.name=Vo.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){var n,r,o;const a=this.parser,c=a.json.materials[e];if(!c.extensions||!c.extensions[this.name])return Promise.resolve();const d=[],p=c.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=(n=p.anisotropyFactor)!==null&&n!==void 0?n:0,t.userData._anisotropyNoise=(o=(r=p.anisotropyNoiseFactor)!==null&&r!==void 0?r:p.anisotropyNoise)!==null&&o!==void 0?o:0;let{anisotropyDirectionMode:m,anisotropyDirection:A}=p;return m||(m=p.anisotropyTextureMode),A||(A=p.anisotropyRotation),t.userData._anisotropyDirectionMode=m&&typeof(A==null?void 0:A.index)=="number"?m:"CONSTANT",m==="ROTATION"||m==="DIRECTION"?d.push(a.assignTexture(t.userData,"_anisotropyDirectionMap",A).then(x=>{x.encoding=f.knz})):t.userData._anisotropyDirection=A??0,Promise.all(d)}afterRoot(e){return e.scene.traverse(t=>{var n,r;if(!(!((r=(n=t.material)===null||n===void 0?void 0:n.userData)===null||r===void 0)&&r._isAnisotropic))return;const o=t.geometry;o.attributes.tangent||(o.computeTangents(),o.attributes.tangent.needsUpdate=!0)}),null}}const C0=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const r={index:s.processTexture(e.userData._anisotropyDirectionMap)};s.applyTextureTransform(r,e.userData._anisotropyDirectionMap),n.anisotropyDirection=r}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[Vo.ANISOTROPY_GLTF_EXTENSION]=n,s.extensionsUsed[Vo.ANISOTROPY_GLTF_EXTENSION]=!0}});var fl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let oa=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new f.Ltg},thinNoiseLayerFactors:{value:new f.Ltg},thinColorNoiseParams:{value:new f.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm)?ll+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!(!((n=e.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm))return;const r="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(r,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+r),s.vertexUvs=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._thinFilmLayer;if(!(n!=null&&n.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(n.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(n.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(n.colorNoiseParams),this._uniforms.thinFilmFactor.value=n.filmFactor;const r=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==r&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0?void 0:n.hasThinFilm)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._thinFilmLayer)===null||r===void 0?void 0:r.hasThinFilm)&&(n?yg(s.materialObject)||e.alert("Cannot add thin film."):(s.materialObject.userData._thinFilmLayer.hasThinFilm=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(s){return yg(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new Af(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(ln);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(yw)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function yg(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),s.isMaterial&&(s.needsUpdate=!0),!0}oa.PluginType="ThinFilmLayerPlugin",oa.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",fl([gn("Enabled",s=>({onChange:s.setDirty})),Ne()],oa.prototype,"enabled",void 0),oa=fl([ci("ThinFilmLayer Materials")],oa);class Af{constructor(e){this.parser=e,this.name=oa.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),yg(t),t.userData._thinFilmLayer=mi(r,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const yw=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=yi(e.userData._thinFilmLayer,!1);t.extensions[oa.THIN_FILM_LAYER_GLTF_EXTENSION]=n,s.extensionsUsed[oa.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var $d=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Os=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this._defines={},this._uniforms={noiseBumpParams:{value:new f.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||t===void 0)&&t.hasBump)?ll+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!(!((n=e.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump))return;const r="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(r,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+r),s.vertexUvs=!0,s.extensionDerivatives=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._noiseBumpMat;if(!(n!=null&&n.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(n.bumpNoiseParams),this._uniforms.noiseBumpScale.value=n.bumpScale,this._uniforms.noiseBumpFlakeScale.value=n.flakeScale,this._uniforms.noiseFlakeClamp.value=n.flakeClamp,this._uniforms.noiseFlakeRadius.value=n.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=n.flakeRoughnessMod;const r=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==r&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||t===void 0)&&t.hasBump?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0?void 0:n.hasBump)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._noiseBumpMat)===null||r===void 0?void 0:r.hasBump)&&(n?Vh(s.materialObject)||e.alert("Cannot add noise bump."):(s.materialObject.userData._noiseBumpMat.hasBump=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(s){return Vh(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new yf(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(ln);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(ep)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function Vh(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.flakeRoughnessMod===void 0&&(t.flakeRoughnessMod=1),s.isMaterial&&(s.needsUpdate=!0),!0}Os.PluginType="NoiseBumpMaterialPlugin",Os.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",$d([gn("Enabled",s=>({onChange:s.setDirty})),Ne()],Os.prototype,"enabled",void 0),Os=$d([ci("NoiseBumpMaterial Materials")],Os);class yf{constructor(e){this.parser=e,this.name=Os.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),Vh(t),t.userData._noiseBumpMat=mi(r,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const ep=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=yi(e.userData._noiseBumpMat,!1);t.extensions[Os.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,s.extensionsUsed[Os.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var Gh,Vu=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Es=Gh=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new f.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(s,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(s,e,t)=>{var n;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((n=e.materialObject.userData)===null||n===void 0)&&n._customBumpMap)&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),s.vertexShader=hr(s.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),s.vertexShader=hr(s.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),s.vertexUvs=!0)},onObjectRender:(s,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._hasCustomBump))return;const r=s;if(!r.isMesh||!r.geometry)return;const o=!((t=n._customBumpMap)===null||t===void 0)&&t.isTexture?n._customBumpMap:null;this._uniforms.customBumpMap.value=o,this._uniforms.customBumpScale.value=o?n._customBumpScale:0,o&&(o.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(o.matrix));let a=this.enabled&&o?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=a,e.materialObject.needsUpdate=!0),a=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=a,e.materialObject.needsUpdate=!0),a=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+(!((e=s.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((n=(t=s.materialObject.userData)===null||t===void 0?void 0:t._customBumpMap)===null||n===void 0?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._hasCustomBump||!1},set value(r){var o;r!==s.materialObject.userData._hasCustomBump&&(r?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._hasCustomBump=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)===null||o===void 0||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},ir(s.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)===null||e===void 0||e.call(s),(t=this._viewer)===null||t===void 0||t.setDirty()},this.enableCustomBumpSelected=()=>{var s,e,t;const n=(t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Ii))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.enableCustomBump(n)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(s,e,t){var n,r;const o=(n=s.materialObject)===null||n===void 0?void 0:n.userData;if(!o)return!1;if(o._hasCustomBump===void 0){const a=o.__appliedMeshes;let c=!0;if(a)for(const{geometry:d}of a)!d||d.attributes.position&&d.attributes.normal&&d.attributes.uv||(c=!1);if(!c)return!1}return o._hasCustomBump=!0,o._customBumpScale=(r=t??o._customBumpScale)!==null&&r!==void 0?r:.001,o._customBumpMap=e??o._customBumpMap,s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new bf(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(ln);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(zA)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};Es.PluginType="CustomBumpMapPlugin",Es.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",Vu([gn("Enabled",s=>({onChange:s.setDirty})),Ne()],Es.prototype,"enabled",void 0),Vu([gn("Bicubic",s=>({onChange:s.setDirty})),Le("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,Gh.prototype.setDirty),Ne()],Es.prototype,"bicubicFiltering",void 0),Vu([Si("Enable CustomBumpMap",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPlugin(Ii))}}))],Es.prototype,"enableCustomBumpSelected",void 0),Es=Gh=Vu([ci("CustomBumpMap Materials")],Es);class bf{constructor(e){this.parser=e,this.name=Es.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){var n;const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],c=o.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=(n=c.customBumpScale)!==null&&n!==void 0?n:0;const d=c.customBumpMap;return d&&a.push(r.assignTexture(t.userData,"_customBumpMap",d).then(p=>{p.encoding=f.knz})),Promise.all(a)}}const zA=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const r={index:s.processTexture(e.userData._customBumpMap)};s.applyTextureTransform(r,e.userData._customBumpMap),n.customBumpMap=r}t.extensions[Es.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,s.extensionsUsed[Es.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var S0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Pa=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this._defines={},this._uniforms={ccTintColor:{value:new Pi},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||t===void 0)&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(s,e,t)=>{var n;if(!(this.enabled&&(!((n=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)&&e.materialObject.clearcoat>0))return;const r="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",o="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";s.fragmentShader.includes(o)&&s.fragmentShader.includes(r)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),s.fragmentShader=s.fragmentShader.replace(o,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),s.fragmentShader=s.fragmentShader.replace(r,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+r),s.vertexUvs=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._clearcoatTint;if(!(n!=null&&n.enableTint))return;this._uniforms.ccTintColor.value.set(n.tintColor),this._uniforms.ccThickness.value=n.thickness,this._uniforms.ccIor.value=n.ior;const r=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==r&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||t===void 0)&&t.enableTint?"1":"0")+(s.materialObject.clearcoat>0?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._clearcoatTint)===null||n===void 0?void 0:n.enableTint)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._clearcoatTint)===null||r===void 0?void 0:r.enableTint)&&(n?bg(s.materialObject)||e.alert("Cannot add clearcoat tint."):(s.materialObject.userData._clearcoatTint.enableTint=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(s){return bg(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new QA(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(ln);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(M0)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(ln))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function bg(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),s.isMaterial&&(s.needsUpdate=!0),!0}Pa.PluginType="ClearcoatTintPlugin",Pa.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",S0([gn("Enabled",s=>({onChange:s.setDirty})),Ne()],Pa.prototype,"enabled",void 0),Pa=S0([ci("ClearcoatTint Materials")],Pa);class QA{constructor(e){this.parser=e,this.name=Pa.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),bg(t),t.userData._clearcoatTint=mi(r,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const M0=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=yi(e.userData._clearcoatTint,!1);t.extensions[Pa.CLEARCOAT_TINT_GLTF_EXTENSION]=n,s.extensionsUsed[Pa.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var T0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let wf=class extends Ri{constructor(s,e,t){super(s,e,t??new VA,new Pi(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,r){if(!this.enabled)return;const o=this.overrideMaterial;o.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(s,e,t,n,r),o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value)}};T0([gn("Enabled")],wf.prototype,"enabled",void 0),wf=T0([ci("Velocity Buffer (TAA)")],wf);class VA extends f.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new f.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new f.yGw},lastProjectionViewMatrix:{value:new f.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new f.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,r,o){var a,c;const d=this._previousWorldMatrices[o.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(d??o.matrixWorld),d?d.copy(o.matrixWorld):this._previousWorldMatrices[o.uuid]=o.matrixWorld.clone();let p=o.material;Array.isArray(p)&&(p=p[0]),this.uniforms.alphaMap.value=(a=p==null?void 0:p.alphaMap)!==null&&a!==void 0?a:null,this.uniforms.alphaTest.value=!p||!p.alphaTest||p.alphaTest<1e-7?.001:p.alphaTest;let m=this.uniforms.alphaMap.value?1:void 0;m!==this.defines.USE_ALPHAMAP&&(m===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=m,this.needsUpdate=!0),m=p.userData.ALPHA_I_RGBA_PACKING?1:void 0,m!==this.defines.ALPHA_I_RGBA_PACKING&&(m===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=m,this.needsUpdate=!0),this.side=(c=p.side)!==null&&c!==void 0?c:f.ehD}}class xf extends sl{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:f.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,r=new Set;return new class extends wf{render(o,a,c,d,p){if(e.renderer.frameCount>0)return;const m=o.getRenderTarget(),A=o.getActiveCubeFace(),x=o.getActiveMipmapLevel();this.scene.traverse(({material:E})=>{E&&((E.transparent&&E.userData.renderToDepth||!E.transparent&&E.transmission===0&&E.userData.renderToDepth===!1)&&(n.add(E),E.transparent=!E.transparent),Math.abs(E.transmission||0)>0&&E.userData.renderToDepth&&(r.add([E,E.transmission]),E.transmission=0))}),$t(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,d,p)),n.forEach(E=>E.transparent=!E.transparent),n.clear(),r.forEach(([E,M])=>E.transmission=M),r.clear(),o.setRenderTarget(m,A,x)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)===null||n===void 0?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(n=(t=this.getVelocityBuffer())===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}xf.PluginType="VelocityBuffer";class I0 extends Vr{constructor(e,t){super({vertexShader:It.vertexShader,fragmentShader:t+`
`+qp+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new f.FM8},cameraNearFar:{value:new f.FM8},lastProjectionViewMatrix:{value:new f.yGw},currentProjectionViewMatrix:{value:new f.yGw},projection:{value:new f.yGw},inverseViewMatrix:{value:new f.yGw},jitterSample:{value:new f.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new f.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,r,o){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const a=this.uniforms.tVelocity.value?1:0;a!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=a,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,r,o),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([Ne(),ae()],I0.prototype,"feedBack",void 0);class Ef extends sl{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[qi]}passCtor(e){if(!e.getPlugin(ks))throw"Add ProgressivePlugin before TAA";const t=new I0(e.getPlugin(ks).lastFrame,e.getPlugin(qi).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<1,!n.taaEnabled)return!1;const r=e.scene.activeCamera;return n.updateShaderProperties([e.getPlugin(qi),r,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(ks).lastFrame,n.updateCameraProperties(r==null?void 0:r.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Ef.PluginType="TAA";class D0{static async GetDataUrl(e,{mimeType:t="image/png",rect:n={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:r=1,scale:o=1}){var a,c,d;const p=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");p.width=n.width*o*r,p.height=n.height*o*r,n.assumeClientRect&&(n.x*=e.width/(r*e.clientWidth),n.y*=e.height/(r*e.clientHeight),n.width*=e.width/(r*e.clientWidth),n.height*=e.height/(r*e.clientHeight));const m=p.getContext("2d");if(!m)return console.error("snapshot: cannot create context"),"";const A=e.style.background||((a=e.parentElement)===null||a===void 0?void 0:a.style.background)||"";if(A.includes("url")){const E=(c=/url\("(.*)"\)/gi.exec(A))===null||c===void 0?void 0:c[1];if(E){const M=new Image;M.src=E,await new Promise((T,O)=>{M.onload=()=>T(),M.onerror=()=>O(),M.complete&&T()}),m.drawImage(M,M.width*n.x*r/e.width,M.height*n.y*r/e.height,M.width*n.width*r/e.width,M.height*n.height*r/e.height,0,0,p.width,p.height)}}else m.fillStyle=e.style.background||((d=e.parentElement)===null||d===void 0?void 0:d.style.backgroundColor)||"#00000000",m.fillRect(0,0,p.width,p.height);m==null||m.drawImage(e,n.x*r,n.y*r,n.width*r,n.height*r,0,0,p.width,p.height);const x=m.canvas.toDataURL(t);return p.remove(),x}static async GetImage(e,t={}){const n=await this.GetDataUrl(e,t);return new Promise((r,o)=>{const a=new Image;a.onload=()=>{r(a)},a.src=n})}static async GetBlob(e,t={}){return await(await fetch(await this.GetDataUrl(e,t))).blob()}static async GetFile(e,t="image.png",n={}){var r;return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:(r=n.mimeType)!==null&&r!==void 0?r:"image/png",lastModified:ui()})}}var aa=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Go=class extends Zn{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(s,e={}){return e.getDataUrl=!1,await this._getFile(s,e)}async getDataUrl(s={}){var e;return s.getDataUrl=!0,(e=await this._getFile("",s))!==null&&e!==void 0?e:""}async _getFile(s,e={}){var t,n,r;const o=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(o){const a=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==a&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const c=(n=this._viewer)===null||n===void 0?void 0:n.getPlugin(ks);if(e.waitForProgressive&&c&&e.timeout===void 0)for(;!c.isConverged(!0);)await Ir(64);else await Ir((r=e.timeout)!==null&&r!==void 0?r:200);e.displayPixelRatio=1;const d=await D0.GetFile(o,s,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=a,d}}async downloadSnapshot(s="snapshot.png",e={}){const t=await this.getFile(s,e);t&&wo(t)}};Go.PluginType="CanvasSnipper",aa([Si("Download .png",{limitedUi:!0})],Go.prototype,"downloadSnapshot",null),Go=aa([ci("Image Export")],Go);var xr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let GA=1,co=class{constructor(s,e,t,n,r){this.position=new f.Pa4,this.target=new f.Pa4,this.quaternion=new f._fP,this.up=new f.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=hc(this.name,this),s&&(this.position=s),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),r&&(this.snap=r),this.name="Camera View"+GA++}_nameChanged(){var s,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(s=this.uiConfig).uiRefresh)===null||e===void 0||e.call(s))}};xr([Ne(),Ko()],co.prototype,"position",void 0),xr([Ne(),Ko()],co.prototype,"target",void 0),xr([Ne(),Ko()],co.prototype,"quaternion",void 0),xr([Ne(),Ko()],co.prototype,"up",void 0),xr([Ne(),li()],co.prototype,"name",void 0),xr([yh()],co.prototype,"snap",void 0),xr([Si()],co.prototype,"focusView",void 0),xr([Si()],co.prototype,"deleteView",void 0),co=xr([Ip("CameraView")],co);class Dr extends Zn{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Dl(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera;if(!n)return;const r=new f.$V,o=n.position,a=n.target,c=new f._fP().setFromUnitVectors(n.cameraObject.up,new f.Pa4(0,1,0)),d=c.clone().invert(),p=o.clone().sub(a);p.applyQuaternion(c),r.setFromVector3(p),r.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,r.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,r.makeSafe(),p.setFromSpherical(r),p.applyQuaternion(d),o.copy(a).add(p),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,t;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(Dr.PluginType),this._fadeDisabled=!1));const n=ui()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=n-1/60);let r=n-this._lastFrameTime;this._lastFrameTime=n,r*=this.animateOnScroll?this._scrollAnimationState:1;const o=(t=this._viewer.getPluginByType("Progressive"))===null||t===void 0?void 0:t.postFrameConvergedRecordingDelta();if(o&&o>0&&(r=o),o!==0&&(r*=1e3,!(r<=0||(this._updaters.forEach(a=>{let c=r;a.time+c<0&&(c=-a.time),a.time+=c,Math.abs(c)>.001&&a.u(c)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const a=this._viewer.getPluginByType("FrameFade");a&&(a.disable(Dr.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await Ir(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await Ir(2))}async recordAllViews(e){var t;if(!this.enabled)return;const n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CanvasRecorder");return n&&n.enabled&&(await this.resetToFirstView(),n.startRecording())?new Promise((r,o)=>{const a=()=>{n.removeEventListener("start",c),n.removeEventListener("stop",a),n.removeEventListener("error",d)},c=async()=>{a(),e==null||e(),await this.animateAllViews();const p=await n.stopRecording();p&&Jr(p,"recording.mp4"),r()},d=async()=>{a(),o()};n.addEventListener("start",c),n.addEventListener("stop",a),n.addEventListener("error",d)}):void 0}async addCurrentView(){var e,t,n,r,o;if(!this.enabled)return;const a=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!a)return;const c=this.getCurrentCameraView(a);c.snap=await((n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Go))===null||n===void 0?void 0:n.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(c),(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r)}getCurrentCameraView(e){var t;if(e||(e=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera),!e)return new co;const n=new f.Pa4,r=e.cameraObject.matrixWorld;n.x=r.elements[4],n.y=r.elements[5],n.z=r.elements[6];const o=new co(e.position.clone(),e.target.clone(),n.normalize(),e.cameraObject.quaternion.clone(),"");return o.focusView=async()=>this.focusView(o),o.deleteView=()=>this.deleteView(o),o}async focusView(e){return this.animateToView(e)}deleteView(e){var t,n;const r=this._cameraViews.indexOf(e);r>=0&&this._cameraViews.splice(r,1),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)===null||t===void 0?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await Ir(100)}async animateToView(e,t,n){var r;const o=(r=this._viewer)===null||r===void 0?void 0:r.scene.activeCamera;if(!o)return;if(this._animating&&(this._popAnimations.forEach(m=>{var A;return(A=m==null?void 0:m.stop)===null||A===void 0?void 0:A.call(m)}),await Ir(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration);const a=typeof n=="function"?n:jh[n||this.animEase],c=this._driver,d=[];this._popAnimations=[];const p=this._popAnimations;if(this.interpolateMode==="spherical")d.push(async function(m,A,x,E,M,T){const O=m.target.clone(),P=new f.Pa4,R=new f.Pa4,I=Hh(m.cameraObject,O),j=Hh(A,A.target),z=new f.$V;return Cf({from:0,to:1,duration:x,ease:E,driver:M,onUpdate:V=>{z.phi=wg(I.phi,j.phi,V),z.theta=wg(I.theta,j.theta,V),z.radius=Qs(I.radius,j.radius,V),P.copy(O).lerp(A.target,V),R.setFromSpherical(z),R.add(P),m.position=R,m.target=P,m.positionUpdated(!1),m.targetUpdated()},onComplete:()=>{m.position=A.position,m.target=A.target,m.positionUpdated(!1),m.targetUpdated()}},T)}(o,e,t,a,c,p));else if(this.interpolateMode==="linear"){d.push(Cf({from:o.position.clone(),to:e.position.clone(),duration:t,ease:a,driver:c,onUpdate:x=>o.position=x,onComplete:()=>o.position=e.position},p)),d.push(Cf({from:o.target.clone(),to:e.target.clone(),duration:t,ease:a,driver:c,onUpdate:x=>{o.target=x,o.targetUpdated()},onComplete:()=>{o.target=e.target,o.targetUpdated()}},p));const m=o.cameraObject.quaternion.clone(),A=new f._fP;d.push(Cf({from:0,to:1,duration:t,ease:a,driver:c,onUpdate:x=>{A.copy(m).slerp(e.quaternion,x),o.cameraObject.quaternion.copy(A),o.cameraObject.updateProjectionMatrix()},onComplete:()=>{o.cameraObject.quaternion.copy(e.quaternion),o.cameraObject.updateProjectionMatrix()}},p))}await Promise.all(d),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await Ir(10)}fromJSON(e,t){var n,r;return this._cameraViews.forEach(o=>this.deleteView(o)),super.fromJSON(e,t)?(this._cameraViews.forEach(o=>o.focusView=async()=>this.focusView(o)),this._cameraViews.forEach(o=>o.deleteView=()=>this.deleteView(o)),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n),this):null}async animateToObject(e,t=4,n,r,o={min:.5,max:5}){if(!this._viewer)return;const a=new Vt().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),c=a.getCenter(new f.Pa4),d=a.getSize(new f.Pa4).length()/2;await this.animateToTarget(Math.min(o.max,Math.max(o.min,d*t)),c,n,r)}async animateToTarget(e,t,n,r){const o=this.getCurrentCameraView();o.target.copy(t);const a=new f.Pa4().subVectors(o.target,o.position).normalize();o.position.copy(a.multiplyScalar(-e).add(o.target)),await this.animateToView(o,n,r)}}async function Cf(s,e){const t=s.onComplete,n=s.onStop;return s={...s},new Promise((r,o)=>{s.onComplete=()=>{t==null||t(),r()},s.onStop=()=>{n==null||n(),r()};const a=Xd(s);e.push(a)})}function Hh(s,e){const t=s.position.clone();t.sub(e);const n=new f.$V().setFromVector3(t);return n.makeSafe(),n}function wg(s,e,t){const n=e-s;return n>=Math.PI?s+(n-2*Math.PI)*t:n<=-Math.PI?s+(n+2*Math.PI)*t:s+n*t}function P0(s,e,t){const n=(1-t)*Math.cos(s)+t*Math.cos(e),r=(1-t)*Math.sin(s)+t*Math.sin(e);return Math.atan2(r,n)}Dr.PluginType="CameraViews",xr([Ne("cameraViews")],Dr.prototype,"_cameraViews",void 0),xr([ve(Dr.prototype._animationLoop),Ne(),gn("Loop All Views",{limitedUi:!0})],Dr.prototype,"viewLooping",void 0),xr([Ne(),li("View Pause Time")],Dr.prototype,"viewPauseTime",void 0),xr([Ne(),Il("Ease",Object.keys(jh).map(s=>({label:s})))],Dr.prototype,"animEase",void 0),xr([Ne(),An("Duration",[10,1e4],10,{limitedUi:!0})],Dr.prototype,"animDuration",void 0),xr([Ne(),An("RotationOffset",[.2,.75],.01)],Dr.prototype,"rotationOffset",void 0),xr([Ne(),Il("Interpolation",["spherical","linear"].map(s=>({label:s})))],Dr.prototype,"interpolateMode",void 0),xr([gn(),Ne()],Dr.prototype,"seekOnScroll",void 0),xr([Si("Animate All Views",{limitedUi:!0})],Dr.prototype,"animateAllViews",null),xr([Si("Record All Views")],Dr.prototype,"recordAllViews",null),xr([Si("Add Current View")],Dr.prototype,"addCurrentView",null),xr([Si("Focus Next")],Dr.prototype,"focusNext",void 0),xr([Si("Focus Previous")],Dr.prototype,"focusPrevious",void 0);const R0=new f.Pa4;function ml(s,e,t){let n=s.dot(e);n=Math.min(Math.max(n,-1),1);const r=Math.acos(n)*t;return R0.copy(s).multiplyScalar(n).sub(e).negate().normalize(),s.multiplyScalar(Math.cos(r)).add(R0.multiplyScalar(Math.sin(r)))}var Qc=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Vc extends Zn{constructor(e=!0){super(),this.enabled=!0,this.light=new gf("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var t,n,r;if(!this.enabled)return void(this.light.layers.mask=0);const o=(n=(t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)!==null&&n!==void 0?n:0;(o<1||o>5)&&this.light.randomizePosition(o<5?0:o),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(r=this._cameraHelper)===null||r===void 0||r.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new f.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)===null||t===void 0||t.scene.setDirty():(n=this._viewer)===null||n===void 0||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Vc.PluginType="RandomizedDirectionalLight",Qc([Ne()],Vc.prototype,"enabled",void 0),Qc([Ne("rdLight")],Vc.prototype,"light",void 0),Qc([Ne()],Vc.prototype,"lightLayers",void 0);var Gc,Sf=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ho=Gc=class extends Zn{constructor(s=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=s}_paramsChanged(){var s,e,t,n,r,o,a,c,d,p,m;const A=(s=this._viewer)===null||s===void 0?void 0:s.getBackground(!0);if(this.enabled&&A&&A!==ol)if(A.isDataTexture)A.mapping=f.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const M=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");M?(M.envmapBg=!0,(n=(t=M.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)):(r=this._viewer)===null||r===void 0||r.setBackground(ol)}else this.enabled=!1;const x=(d=(c=(a=(o=this._viewer)===null||o===void 0?void 0:o.renderer)===null||a===void 0?void 0:a.rendererObject)===null||c===void 0?void 0:c.background.getBoxMesh2())===null||d===void 0?void 0:d.material,E=(p=x==null?void 0:x.uniforms)!==null&&p!==void 0?p:f.Vj0.cube.uniforms;E.tripodHeight||(E.tripodHeight={value:1}),E.worldRadius||(E.worldRadius={value:1}),E.tripodHeight.value=this.tripodHeight,E.worldRadius.value=this.worldRadius,x&&(!this.enabled&&x.defines.HDRi_GROUND_PROJ?delete x.defines.HDRi_GROUND_PROJ:this.enabled&&(x.defines.HDRi_GROUND_PROJ="1"),x.needsUpdate=!0),(m=this._viewer)===null||m===void 0||m.setDirty()}async onAdded(s){var e,t,n;await super.onAdded(s),!((n=(t=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||t===void 0?void 0:t.rendererObject)===null||n===void 0)&&n.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),f.Vj0.cube.fragmentShader=f.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),f.Vj0.cube.fragmentShader=f.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),s.scene.addEventListener("environmentChanged",this._paramsChanged)}};Ho.PluginType="HDRiGroundPlugin",Sf([Ne(),ve(Gc.prototype._paramsChanged),gn("Enabled")],Ho.prototype,"enabled",void 0),Sf([Ne(),ve(Gc.prototype._paramsChanged),An("World Radius",[1,1e3])],Ho.prototype,"worldRadius",void 0),Sf([Ne(),ve(Gc.prototype._paramsChanged),An("Tripod height",[0,50])],Ho.prototype,"tripodHeight",void 0),Ho=Gc=Sf([ci("HDRi Ground")],Ho);var Ra=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const tp={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new f.FM8},cameraNearFar:{value:new f.FM8}},vertexShader:al,fragmentShader:kl+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Mf=(gi({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new f.FM8},direction:{value:new f.FM8}},vertexShader:al,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),gi({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new f.FM8},direction:{value:new f.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:al,fragmentShader:ll+`
`+jA+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Gu extends Vr{constructor(){super(tp,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Mf,this.nearFarBlurScale=new f.FM8(.25,.25),this.focalDepthRange=new f.FM8(.5,1.5),this.crossCenter=new f.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new Pi(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=gi({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:al,fragmentShader:kl+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=gi({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new f.FM8},direction:{value:new f.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:al,fragmentShader:kl+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,r,o){if(!this.enabled)return;const a=e.baseRenderer,c={minFilter:f.TyD,magFilter:f.TyD,type:f.cLu,encoding:f.rnI,sizeMultiplier:.5,isAntialiased:!1,format:f.wk1,depthBuffer:!1,generateMipmaps:!1},d=a.getTempTarget(c),p=a.getTempTarget(c);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,a.blit(void 0,d,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=d.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,p,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=p.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,d,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=d.texture,a.blit(void 0,p,{material:this.dofBlurMaterial});else{const m=a.getTempTarget(c);this.dofBlurMaterial.uniforms.cocTexture.value=d.texture,this.dofBlurMaterial.uniforms.colorTexture.value=d.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,m,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=m.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,p,{material:this.dofBlurMaterial}),a.releaseTempTarget(m)}this.material.uniforms.blurTexture.value=p.texture,this.material.uniforms.cocTexture.value=d.texture,super.render(e,t,n,r,o),a.releaseTempTarget(d),a.releaseTempTarget(p)}}Ra([Ne(),ae()],Gu.prototype,"nearFarBlurScale",void 0),Ra([Ne(),ae()],Gu.prototype,"focalDepthRange",void 0),Ra([ae()],Gu.prototype,"crossCenter",void 0),Ra([ae()],Gu.prototype,"crossRadius",void 0),Ra([ae()],Gu.prototype,"crossAlpha",void 0),Ra([ae()],Gu.prototype,"crossColor",void 0);var Hc=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Wc extends sl{constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[qi],this.enableEdit=!1,this._focalPointHit=new f.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new f.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new Gu}setFocalPoint(e,t=!0,n=!1){var r,o;this._focalPointHit.copy(e),t&&((o=(r=this._viewer)===null||r===void 0?void 0:r.getPlugin(jc))===null||o===void 0||o.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=ui()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&t!==void 0?t:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&t!==void 0?t:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&t!==void 0?t:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(jc))===null||n===void 0||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))===null||t===void 0||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))===null||t===void 0||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var t,n;if(!super._update(e))return!1;const r=(t=this.pass)===null||t===void 0?void 0:t.passObject;if(!r)return!1;const o=e.getPlugin(qi);o==null||o.updateShaderProperties(r.material),r.dofBlurMaterial.uniforms.frameCount&&((n=e.renderer)===null||n===void 0||n.updateShaderProperties(r.dofBlurMaterial));const a=e.scene.activeCamera;if(!a)return!1;a.cameraObject.updateMatrixWorld(!0),a.updateShaderProperties(r.material),this._tempVec.subVectors(this._focalPointHit,a.cameraObject.position),r.focalDepthRange.x=this._tempVec.length(),r.focalDepthRange.x*=a.cameraObject.getWorldDirection(new f.Pa4).dot(this._tempVec.normalize());let c=(ui()-this._focalPointHitTime)/this.crossFadeTime;if(c=1-Math.min(1,Math.max(0,c)),Math.abs(c-r.crossAlpha)>.01&&(r.crossAlpha=c,this.setDirty()),c>0){const d=this._tempVec.copy(this._focalPointHit).project(a.cameraObject).addScalar(1).divideScalar(2);r.crossCenter.set(d.x,d.y),r.computeCocMaterial.uniformsNeedUpdate=!0,r.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,t,n,r,o;if(this._uiConfig)return this._uiConfig;const a=(t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig;return a?((r=(n=a.children)===null||n===void 0?void 0:n.map(c=>ke(c)))===null||r===void 0||r.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),(o=a.children)===null||o===void 0||o.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=a,a):{}}}Wc.PluginType="DepthOfField",Hc([Ne()],Wc.prototype,"enableEdit",void 0),Hc([Ne("focalPoint")],Wc.prototype,"_focalPointHit",void 0),Hc([Ne()],Wc.prototype,"crossFadeTime",void 0);var Wh,ls=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Wr=Wh=class extends Zn{constructor(s=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[qi,ln],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const r=K`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Um}
    
    #define THREE_PACKING_INCLUDED
    ${qp}
    
    ${kl}
    ${ll}
    
    ${Fm}

#endif
            
            `+f.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${r}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",f.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var r;const o=t.materialObject;let a=this.enabled&&n.userData.screenSpaceRendering!==!1&&!(!((r=o.userData)===null||r===void 0)&&r.sscsDisabled)?1:0;o.defines.SSCS_ENABLED!==a&&(o.defines.SSCS_ENABLED=a,o.needsUpdate=!0),a=this._defines.SSCS_STEP_COUNT,o.defines.SSCS_STEP_COUNT!==a&&(o.defines.SSCS_STEP_COUNT=a,o.needsUpdate=!0),a=+this._defines.SSCS_DEBUG,o.defines.SSCS_DEBUG!==a&&(o.defines.SSCS_DEBUG=a,o.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...Wh._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,r,o;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(qi),(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(ks),(n=this._viewer)===null||n===void 0?void 0:n.scene.activeCamera,(r=this._viewer)===null||r===void 0?void 0:r.renderer,(o=this._viewer)===null||o===void 0?void 0:o.scene]}},this.enabled=s,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(s){var e,t;await super.onAdded(s),(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this.materialExtension)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(s)}};Wr.PluginType="SSContactShadows",Wr._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new f.yGw},cameraPositionWorld:{value:new f.Pa4},cameraNearFar:{value:new f.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},ls([gn("Enabled"),Ne()],Wr.prototype,"enabled",void 0),ls([ae({uniforms:Wh._uniforms,propKey:"sscsRadius"}),An("Radius",[1e-4,.1],1e-4),Ne()],Wr.prototype,"radius",void 0),ls([ae({uniforms:Wh._uniforms,propKey:"sscsIntensity"}),An("Intensity",[1e-4,1],1e-4),Ne()],Wr.prototype,"intensity",void 0),ls([ae({uniforms:Wh._uniforms,propKey:"sscsTolerance"}),An("Tolerance",[.1,5]),Ne()],Wr.prototype,"tolerance",void 0),ls([Le("SSCS_DEBUG",void 0,!0),gn("Debug only SSCS"),Ne()],Wr.prototype,"onlySSCSDebug",void 0),ls([Le("SSCS_STEP_COUNT",void 0,!0),An("Step count",[1,8],1),Ne()],Wr.prototype,"stepCount",void 0),Wr=Wh=ls([ci("Screen Space Contact Shadows")],Wr);class bw{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class qc{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Tf{constructor(e,t,n,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const uo=[171,75,84,88,32,50,48,187,13,10,26,10];function np(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}let B0,Yc,k0;const Kl={env:{emscripten_notify_memory_growth:function(s){k0=new Uint8Array(Yc.exports.memory.buffer)}}};class HA{init(){return B0||(B0=typeof fetch<"u"?fetch("data:application/wasm;base64,"+O0).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Kl)).then(this._init):WebAssembly.instantiate(Buffer.from(O0,"base64"),Kl).then(this._init),B0)}_init(e){Yc=e.instance,Kl.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Yc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=Yc.exports.malloc(n);k0.set(e,r),t=t||Number(Yc.exports.ZSTD_findDecompressedSize(r,n));const o=Yc.exports.malloc(t),a=Yc.exports.ZSTD_decompress(o,t,r,n),c=k0.slice(o,o+a);return Yc.exports.free(r),Yc.exports.free(o),c}}const O0="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",xg=new WeakMap;let Eg,If=0;class Jl extends f.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new bw,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new f.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new f.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([o,a])=>{const c=Jl.BasisWorker.toString(),d=["/* constants */","let _EngineFormat = "+JSON.stringify(Jl.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Jl.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Jl.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([d])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const p=new Worker(this.workerSourceURL),m=this.transcoderBinary.slice(0);return p.postMessage({type:"init",config:this.workerConfig,transcoderBinary:m},[m]),p})}),If>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),If++}return this.transcoderPending}load(e,t,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new f.hH6(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{if(xg.has(a))return xg.get(a).promise.then(t).catch(r);this.createTexture(a).then(c=>t?t(c):null).catch(r)},n,r)}_createTextureFrom(e){const{mipmaps:t,width:n,height:r,format:o,type:a,error:c,dfdTransferFn:d,dfdFlags:p}=e;if(a==="error")return Promise.reject(c);const m=new f.EB7(t,n,r,o,f.ywz);return m.minFilter=t.length===1?f.wem:f.D1R,m.magFilter=f.wem,m.generateMipmaps=!1,m.needsUpdate=!0,m.encoding=d===2?f.knz:f.rnI,m.premultiplyAlpha=!!(1&p),m}createTexture(e,t={}){const n=function(a){const c=new Uint8Array(a.buffer,a.byteOffset,uo.length);if(c[0]!==uo[0]||c[1]!==uo[1]||c[2]!==uo[2]||c[3]!==uo[3]||c[4]!==uo[4]||c[5]!==uo[5]||c[6]!==uo[6]||c[7]!==uo[7]||c[8]!==uo[8]||c[9]!==uo[9]||c[10]!==uo[10]||c[11]!==uo[11])throw new Error("Missing KTX 2.0 identifier.");const d=new qc,p=17*Uint32Array.BYTES_PER_ELEMENT,m=new Tf(a,uo.length,p,!0);d.vkFormat=m._nextUint32(),d.typeSize=m._nextUint32(),d.pixelWidth=m._nextUint32(),d.pixelHeight=m._nextUint32(),d.pixelDepth=m._nextUint32(),d.layerCount=m._nextUint32(),d.faceCount=m._nextUint32();const A=m._nextUint32();d.supercompressionScheme=m._nextUint32();const x=m._nextUint32(),E=m._nextUint32(),M=m._nextUint32(),T=m._nextUint32(),O=m._nextUint64(),P=m._nextUint64(),R=new Tf(a,uo.length+p,3*A*8,!0);for(let Nt=0;Nt<A;Nt++)d.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+R._nextUint64(),R._nextUint64()),uncompressedByteLength:R._nextUint64()});const I=new Tf(a,x,E,!0),j={vendorId:I._skip(4)._nextUint16(),descriptorType:I._nextUint16(),versionNumber:I._nextUint16(),descriptorBlockSize:I._nextUint16(),colorModel:I._nextUint8(),colorPrimaries:I._nextUint8(),transferFunction:I._nextUint8(),flags:I._nextUint8(),texelBlockDimension:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],bytesPlane:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],samples:[]},z=(j.descriptorBlockSize/4-6)/4;for(let Nt=0;Nt<z;Nt++){const Ut={bitOffset:I._nextUint16(),bitLength:I._nextUint8(),channelType:I._nextUint8(),samplePosition:[I._nextUint8(),I._nextUint8(),I._nextUint8(),I._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Ut.channelType?(Ut.sampleLower=I._nextInt32(),Ut.sampleUpper=I._nextInt32()):(Ut.sampleLower=I._nextUint32(),Ut.sampleUpper=I._nextUint32()),j.samples[Nt]=Ut}d.dataFormatDescriptor.length=0,d.dataFormatDescriptor.push(j);const V=new Tf(a,M,T,!0);for(;V._offset<T;){const Nt=V._nextUint32(),Ut=V._scan(Nt),Ht=np(Ut),yn=V._scan(Nt-Ut.byteLength);d.keyValue[Ht]=Ht.match(/^ktx/i)?np(yn):yn,V._offset%4&&V._skip(4-V._offset%4)}if(P<=0)return d;const G=new Tf(a,O,P,!0),X=G._nextUint16(),ne=G._nextUint16(),ce=G._nextUint32(),ge=G._nextUint32(),de=G._nextUint32(),xe=G._nextUint32(),pe=[];for(let Nt=0;Nt<A;Nt++)pe.push({imageFlags:G._nextUint32(),rgbSliceByteOffset:G._nextUint32(),rgbSliceByteLength:G._nextUint32(),alphaSliceByteOffset:G._nextUint32(),alphaSliceByteLength:G._nextUint32()});const ye=O+G._offset,Re=ye+ce,we=Re+ge,We=we+de,ot=new Uint8Array(a.buffer,a.byteOffset+ye,ce),ft=new Uint8Array(a.buffer,a.byteOffset+Re,ge),nt=new Uint8Array(a.buffer,a.byteOffset+we,de),Rt=new Uint8Array(a.buffer,a.byteOffset+We,xe);return d.globalData={endpointCount:X,selectorCount:ne,imageDescs:pe,endpointsData:ot,selectorsData:ft,tablesData:nt,extendedData:Rt},d}(new Uint8Array(e));if(n.vkFormat!==0)return async function(a){const{vkFormat:c,pixelWidth:d,pixelHeight:p,pixelDepth:m}=a;if(L0[c]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const A=a.levels[0];let x,E;if(a.supercompressionScheme===0)x=A.levelData;else{if(a.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Eg||(Eg=new Promise(async T=>{const O=new HA;await O.init(),T(O)})),x=(await Eg).decode(A.levelData,A.uncompressedByteLength)}E=Cg[c]===f.VzW?new Float32Array(x.buffer,x.byteOffset,x.byteLength/Float32Array.BYTES_PER_ELEMENT):Cg[c]===f.cLu?new Uint16Array(x.buffer,x.byteOffset,x.byteLength/Uint16Array.BYTES_PER_ELEMENT):x;const M=m===0?new f.IEO(E,d,p):new f.JUT(E,d,p,m);return M.type=Cg[c],M.format=L0[c],M.encoding=Df[c]||f.rnI,M.needsUpdate=!0,Promise.resolve(M)}(n);const r=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(a=>this._createTextureFrom(a.data));return xg.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),If--,this}}Jl.BasisFormat={ETC1S:0,UASTC_4x4:1},Jl.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Jl.EngineFormat={RGBAFormat:f.wk1,RGBA_ASTC_4x4_Format:f.ptH,RGBA_BPTC_Format:f.bsb,RGBA_ETC2_EAC_Format:f.ekQ,RGBA_PVRTC_4BPPV1_Format:f.eaV,RGBA_S3TC_DXT5_Format:f.ILR,RGB_ETC1_Format:f.fto,RGB_ETC2_Format:f.l0P,RGB_PVRTC_4BPPV1_Format:f._AM,RGB_S3TC_DXT1_Format:f.wuA},Jl.BasisWorker=function(){let s,e,t;const n=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(m){const A=m.data;switch(A.type){case"init":s=A.config,x=A.transcoderBinary,e=new Promise(E=>{t={wasmBinary:x,onRuntimeInitialized:E},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:E,height:M,hasAlpha:T,mipmaps:O,format:P,dfdTransferFn:R,dfdFlags:I}=function(z){const V=new t.KTX2File(new Uint8Array(z));function G(){V.close(),V.delete()}if(!V.isValid())throw G(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const X=V.isUASTC()?o.UASTC_4x4:o.ETC1S,ne=V.getWidth(),ce=V.getHeight(),ge=V.getLevels(),de=V.getHasAlpha(),xe=V.getDFDTransferFunc(),pe=V.getDFDFlags(),{transcoderFormat:ye,engineFormat:Re}=function(We,ot,ft,nt){let Rt,Nt;const Ut=We===o.ETC1S?c:d;for(let Ht=0;Ht<Ut.length;Ht++){const yn=Ut[Ht];if(s[yn.if]&&yn.basisFormat.includes(We)&&!(nt&&yn.transcoderFormat.length<2)&&(!yn.needsPowerOfTwo||p(ot)&&p(ft)))return Rt=yn.transcoderFormat[nt?1:0],Nt=yn.engineFormat[nt?1:0],{transcoderFormat:Rt,engineFormat:Nt}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),Rt=r.RGBA32,Nt=n.RGBAFormat,{transcoderFormat:Rt,engineFormat:Nt}}(X,ne,ce,de);if(!ne||!ce||!ge)throw G(),new Error("THREE.KTX2Loader:	Invalid texture");if(!V.startTranscoding())throw G(),new Error("THREE.KTX2Loader: .startTranscoding failed");const we=[];for(let We=0;We<ge;We++){const ot=V.getImageLevelInfo(We,0,0),ft=ot.origWidth,nt=ot.origHeight,Rt=new Uint8Array(V.getImageTranscodedSizeInBytes(We,0,0,ye));if(!V.transcodeImage(Rt,We,0,0,ye,0,-1,-1))throw G(),new Error("THREE.KTX2Loader: .transcodeImage failed.");we.push({data:Rt,width:ft,height:nt})}return G(),{width:ne,height:ce,hasAlpha:de,mipmaps:we,format:Re,dfdTransferFn:xe,dfdFlags:pe}}(A.buffer),j=[];for(let z=0;z<O.length;++z)j.push(O[z].data.buffer);self.postMessage({type:"transcode",id:A.id,width:E,height:M,hasAlpha:T,mipmaps:O,format:P,dfdTransferFn:R,dfdFlags:I},j)}catch(E){console.error(E),self.postMessage({type:"error",id:A.id,error:E.message})}})}var x});const a=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=a.sort(function(m,A){return m.priorityETC1S-A.priorityETC1S}),d=a.sort(function(m,A){return m.priorityUASTC-A.priorityUASTC});function p(m){return m<=2||(m&m-1)==0&&m!==0}};const L0={109:f.wk1,97:f.wk1,37:f.wk1,43:f.wk1,103:f.av9,83:f.av9,16:f.av9,22:f.av9,100:f.hEm,76:f.hEm,15:f.hEm,9:f.hEm},Cg={109:f.VzW,97:f.cLu,37:f.ywz,43:f.ywz,103:f.VzW,83:f.cLu,16:f.ywz,22:f.ywz,100:f.VzW,76:f.cLu,15:f.ywz,9:f.ywz},Df={43:f.knz,22:f.knz,15:f.knz},Pf="KHR_texture_basisu";class N0 extends ct{constructor(){super(...arguments),this.dependencies=[ln]}async onAdded(e){var t,n,r,o;this._importer||(this._importer=new dr(class extends Jl{constructor(a){super(a),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(a,c){const d=a.map(m=>new Uint8Array(m.slice(0))),p=await super.createTexture(a,c);return p.source._sourceImgBuffer=d,p.userData.mimeType="image/ktx2",p}},["ktx2"],!1)),si.Importers.push(this._importer),(o=(r=(n=(t=e.getManager())===null||t===void 0?void 0:t.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(WA)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&si.Importers.splice(si.Importers.indexOf(this._importer),1),this._importer=void 0}}N0.PluginType="KTX2LoadPlugin";const WA=s=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer;if(!n||!n.length)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const r={},o=new Blob(Array.isArray(n)?n:[n],{type:"image/ktx2"});r.source=s.processImageBlob(o,e),t.extensions[Pf]=r,s.extensionsUsed[Pf]=!0}});class Sg{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,t,n){var r,o;if(!t)return void(this.selected=void 0);let a=this.presets.find(c=>c.path===t.path);return a||(this.presets.push(t),a=t),this.selected=a,(o=(r=e.getManager())===null||r===void 0?void 0:r.importer)===null||o===void 0?void 0:o.importAsset(a,n)}}class qA extends Sg{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return r&&(r.encoding=f.knz,await e.setBackground(r)),r}}class YA extends Sg{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return r&&await e.scene.setEnvironment(r),r}}class XA extends Sg{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return Te(e.getPluginByType("Diamond"),"envMap",r),r}}class Rf extends Sg{async apply(e,t){var n,r;const o=await super.apply(e,t,{processImported:!1});return o?(r=(n=e.getManager())===null||n===void 0?void 0:n.importer)===null||r===void 0?void 0:r.processImported(o):void 0}}class Mg extends Rf{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class Xc extends Zn{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>({label:t.path.split("/").pop(),value:t.path}))],getValue:()=>{var t;return((t=e.selected)===null||t===void 0?void 0:t.path)||""},setValue:t=>{e.apply(this._viewer,e.presets.find(n=>n.path===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();wo(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();wo(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new qA),this.presetGroups.push(new YA),this.presetGroups.push(new XA),this.presetGroups.push(new Rf("Ground")),this.presetGroups.push(new Rf("CameraViews")),this.presetGroups.push(new Rf("MaterialConfiguration")),this.presetGroups.push(new Mg),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>{var n;return[t.name,((n=t.selected)===null||n===void 0?void 0:n.path)||void 0]}).filter(([,t])=>t));return e.type=Xc.PluginType,e}async fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;const o={...e};delete o.type;const a=[];for(const[c,d]of Object.entries(o)){const p=this.presetGroups.find(x=>x.name===c),m=p==null?void 0:p.presets;if(!p||!m)continue;const A=typeof d=="string"?{path:d}:d;a.push(p.apply(this._viewer,A))}return await Promise.all(a),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0),this}loadPresetGroups(e){var t;for(const[n,r]of Object.entries(e)){const o=(t=this.presetGroups.find(a=>a.name===n))===null||t===void 0?void 0:t.presets;o==null||o.push(...r)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(t=>t.path)]).filter(([,e])=>e.length>0))}}Xc.PluginType="PresetLibraryPlugin";var Zl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Wo=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const s=await mc(!0,!1,"model/gltf");await this.loadScenes(s)}async loadScenes(s){var e,t;const n=await Promise.all(s.map(async r=>await r.arrayBuffer()));for(let r=0;r<s.length;r++){const o=s[r];this.scenes.push({[o.name]:new Uint8Array(n[r])}),this.assets[o.name]={path:o.name,file:o}}(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e)}async play(){var s;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const t=this._viewer.getPluginByType("FrameFade"),n=this._viewer.getPluginByType("GLTFAnimation"),r=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const o of this.scenes){if(!this._isPlaying)break;const a=Object.keys(o);n==null||n.stopAnimation(!1),await(r==null?void 0:r.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const d of a){let p=this.assets[d];p||(p={path:d,file:new File([o[d]],d)},this.assets[d]=p),await((s=this._viewer.getManager())===null||s===void 0?void 0:s.addAssetSingle(p,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),t&&(t.enabled=!0,await t.startTransition(1e3));const c=[Ir(this.minSceneTime)];n&&c.push(n.playAnimation()),r&&c.push(r.animateAllViews()),await Promise.all(c)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const s={};for(const t of this.scenes)for(const n of Object.keys(t)){const r=s[n]?n+"_":n;s[r]=t[r]}const e=z_(s);Jr(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(s){await super.onAdded(s);const e=this;si.Importers.push(new dr(class extends Bm{load(t,n,r,o){super.load(t,a=>{e.loadScenes([...a.values()]),n==null||n(null),Ir(100).then(e.play)},r,o)}},["glbloop"],!0))}};Wo.PluginType="SceneLoopPlugin",Zl([uc("Loaded scenes")],Wo.prototype,"loadedScenes",null),Zl([Si("Load Scenes")],Wo.prototype,"promptLoadScenes",null),Zl([uc("Playing")],Wo.prototype,"_isPlaying",void 0),Zl([li("Min Scene Time")],Wo.prototype,"minSceneTime",void 0),Zl([Si("Play")],Wo.prototype,"play",null),Zl([Si("Stop")],Wo.prototype,"stop",null),Zl([Si("Download Scenes")],Wo.prototype,"downloadScenes",null),Wo=Zl([ci("Scene Loop")],Wo);var KA=__webpackgi_require__(701),U0=__webpackgi_require__.n(KA),ww=__webpackgi_require__(236),Tg=__webpackgi_require__.n(ww),JA=__webpackgi_require__(850),F0=__webpackgi_require__.n(JA),Ig=__webpackgi_require__(182),Bf=__webpackgi_require__.n(Ig),xw=__webpackgi_require__(213),j0=__webpackgi_require__.n(xw),Dg=__webpackgi_require__(798),ip={};Dg.Z&&Dg.Z.locals&&(ip.locals=Dg.Z.locals);var Pg,Kc=0,qh={};qh.styleTagTransform=j0(),qh.setAttributes=F0(),qh.insert=function(s,e){(e.target||document.head).appendChild(s)},qh.domAPI=Tg(),qh.insertStyleElement=Bf(),ip.use=function(s){return qh.options=s||{},Kc++||(Pg=U0()(Dg.Z,qh)),ip},ip.unuse=function(){Kc>0&&!--Kc&&(Pg(),Pg=null)};var Rg,ZA=ip,Hu=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Jc=Rg=class extends Zn{constructor(){super(),this.enabled=!0,this.dependencies=[ln],this._popupDiv=Ji({id:"assetManagerPopup",addToBody:!1,innerHTML:""});const s=Ji({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});s.addEventListener("click",()=>{this._popupDiv.style.display="none"}),this._popupContent=Ji({id:"assetManagerPopupContent",addToBody:!1,innerHTML:""}),this.enabled||(this._popupDiv.style.display="none"),this._popupDiv.appendChild(s),this._popupDiv.appendChild(this._popupContent)}_onEnabledChange(){this.enabled||(this._popupDiv.style.display="none")}_updatePopupDiv(s){if(!this._popupContent)return;if(!this.enabled)return void(this._popupDiv.style.display="none");let e="";s.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${n.split("/").pop()} ${t.progress?" - "+t.progress:""}<br>`}),this._popupContent.innerHTML=e,s.size===0?this._popupDiv.style.display="none":this._popupDiv.style.display="block"}async onAdded(s){var e,t,n,r;await super.onAdded(s),ZA.use({target:s.container}),s.container.appendChild(this._popupDiv);const o=new Map;(t=(e=s.getManager())===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("importFile",a=>{a.state!=="done"?o.set(a.path,{state:a.state,progress:a.progress?(100*a.progress).toFixed(0)+"%":void 0}):o.delete(a.path),this._updatePopupDiv(o)}),(r=(n=s.getManager())===null||n===void 0?void 0:n.exporter)===null||r===void 0||r.addEventListener("exportFile",a=>{a.state!=="done"?o.set(a.obj.name,{state:a.state,progress:a.progress?(100*a.progress).toFixed(0)+"%":void 0}):o.delete(a.obj.name),this._updatePopupDiv(o)})}};Jc.PluginType="AssetManagerBasicPopupPlugin",Hu([gn("Enabled"),ve(Rg.prototype._onEnabledChange),Ne()],Jc.prototype,"enabled",void 0),Jc=Rg=Hu([ci("Asset manager popup")],Jc);class Ew extends Vr{constructor(e){super({vertexShader:It.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new _c}render(e,t,n,r,o){super.render(e,t,n,r,o),this.needsSwap=!0}}class $s extends sl{constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[qi],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}get renderToScreen(){return this._renderToScreen}async onAdded(e){var t,n;return!((n=(t=this._viewer)===null||t===void 0?void 0:t.screenShader)===null||n===void 0)&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&Te(e.renderer.passes.find(r=>r.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var t,n,r,o;const a=e.screenShader,c=["",""];this._renderToScreen&&!a.isShaderPass2&&(c[0]=Array.isArray(a)?a[0]:((t=a)===null||t===void 0?void 0:t.pars)||"",c[1]=Array.isArray(a)?a[1]:typeof a=="string"?a:((n=a)===null||n===void 0?void 0:n.main)||"");const d=new Ew(c);return Te((o=(r=d.uiConfig)===null||r===void 0?void 0:r.children)===null||o===void 0?void 0:o.find(p=>{var m;return((m=p)===null||m===void 0?void 0:m.label)==="Enabled"}),"hidden",!0,!0),d}_update(e){var t;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)===null||t===void 0?void 0:t.getPlugin(qi)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t,n;return(n=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}$s.PluginType="CombinedPostPlugin";var $A=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Zc extends Zn{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[$s]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin($s))===null||t===void 0||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}$A([Ne("extension")],Zc.prototype,"_extension",void 0),$A([Ne()],Zc.prototype,"enabled",void 0);class Wu{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=hr(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class Bg extends Zc{generateExtension(e){return new Wu}}Bg.PluginType="GammaCorrection";var kf,gl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ey=f.dZ3;let qu=kf=class{constructor(s,e=!0,t=!0){this.depthTonemap=e,this.toneMapping=f.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(n,r)=>this.enabled?K`
            ${this.depthTonemap?kl:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getGBufferFlags(vUv).x>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=s.getPlugin($s),this._setDirty=this._setDirty.bind(this),this._renderToScreen=t,this.depthTonemap=e}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:r,outputEncoding:o}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=r,this._rendererState.outputEncoding=o;let a=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==a&&(e.materialObject.defines.TONEMAP_BACKGROUND=a,e.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=a,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputEncoding=f.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(s,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};qu.PluginType="Tonemap",gl([Il("Mode",[["Linear",f.EoG],["Reinhard",f.CdI],["Cineon",f.YGz],["ACESFilmic",f.LY2],["Uncharted2",ey]].map(s=>({label:s[0],value:s[1]})),{limitedUi:!0}),ve(kf.prototype._setDirty),Ne()],qu.prototype,"toneMapping",void 0),gl([gn("Tonemap Background",{limitedUi:!0}),Ne()],qu.prototype,"tonemapBackground",void 0),gl([ve(kf.prototype._setDirty),gn("Clip Background"),Ne()],qu.prototype,"clipBackground",void 0),gl([ve(kf.prototype._setDirty),An("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Ne()],qu.prototype,"exposure",void 0),qu=kf=gl([ci("Tonemapping")],qu);class Of extends Zc{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}generateExtension(e){return new qu(e,this.depthTonemap)}get exposure(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&t!==void 0?t:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&t!==void 0?t:f.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}}Of.PluginType="Tonemap",f.WdD.tonemapping_pars_fragment=f.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Lf,rp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let sp=Lf=class{constructor(s){this.enabled=!1,this.intensity=1,this.lutMap=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
vec4 colorLookUp(in vec4 color){vec4 outColor;float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);float lutFac=step(0.0001,getGBufferFlags(vUv).a);
#if USE_3DTEXTURE == 1
outColor=vec4(texture(lut3d,uvw).rgb,color.a);
#else
outColor=vec4(lutLookup(lut,lutSize,uvw),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=s.getPlugin($s),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                gl_FragColor = colorLookUp(gl_FragColor);
            #endif
            #glMarker
        `))}onObjectRender(s,e,t){if(this.enabled)if(this.lutMap){const n=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==n&&(e.materialObject.defines.USE_3DTEXTURE=n,e.materialObject.needsUpdate=!0);let r=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,r=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,r=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=r,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}};rp([Ne(),ve(Lf.prototype._setDirty),gn("Enable")],sp.prototype,"enabled",void 0),rp([Ne(),ve(Lf.prototype._setDirty),An("Intensity")],sp.prototype,"intensity",void 0),rp([ve(Lf.prototype._setDirty),yh("LUT"),Ne()],sp.prototype,"lutMap",void 0),sp=Lf=rp([ci("LUT")],sp);class kg extends Zc{generateExtension(e){return new sp(e)}}kg.PluginType="LUT";var Nf,wi=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Yh=Nf=class{constructor(s){this.enabled=!1,this.power=.5,this.bgcolor=new f.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new f.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?K`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=s.getPlugin($s),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};Yh.PluginType="Vignette",wi([ve(Nf.prototype._setDirty),gn("Enable"),Ne()],Yh.prototype,"enabled",void 0),wi([ve(Nf.prototype._setDirty),An("Power",[.1,4],.01,{limitedUi:!0}),Ne()],Yh.prototype,"power",void 0),wi([ve(Nf.prototype._setDirty),Ya("Color"),Ne()],Yh.prototype,"bgcolor",void 0),Yh=Nf=wi([ci("Vignette")],Yh);class Og extends Zc{constructor(){super()}generateExtension(e){return new Yh(e)}get power(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&t!==void 0?t:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&t!==void 0?t:new f.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}Og.PluginType="Vignette";var Lg,z0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Yu=Lg=class{constructor(s){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?K`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin($s),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};Yu.PluginType="ChromaticAberration",z0([ve(Lg.prototype._setDirty),gn("Enable"),Ne()],Yu.prototype,"enabled",void 0),z0([ve(Lg.prototype._setDirty),An("Intensity",[0,.1],.001,{limitedUi:!0}),Ne()],Yu.prototype,"aberrationIntensity",void 0),Yu=Lg=z0([ci("ChromaticAberration")],Yu);class Ng extends Zc{constructor(){super()}generateExtension(e){return new Yu(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Ng.PluginType="ChromaticAberration";var Uf,Ug=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let op=Uf=class{constructor(s){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?K`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin($s),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=hr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};Ug([ve(Uf.prototype._setDirty),gn("Enable"),Ne()],op.prototype,"enabled",void 0),Ug([ve(Uf.prototype._setDirty),gn("Multiply"),Ne()],op.prototype,"grainMultiply",void 0),Ug([ve(Uf.prototype._setDirty),An("Intensity",[0,20],.01,{limitedUi:!0}),Ne()],op.prototype,"grainIntensity",void 0),op=Uf=Ug([ci("FilmicGrain")],op);class Fg extends Zc{constructor(){super()}generateExtension(e){return new op(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&t!==void 0&&t}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}async function jg(s,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:r=!1}={}){await s.addPlugin(qi),await s.addPlugin(Mr),r&&await s.addPlugin(Hp),await s.addPlugin(new ks(32)),await s.addPlugin(new $s),await s.addPlugin(new Ng),await s.addPlugin(new Of(n||!s.useRgbm)),await s.addPlugin(new kg),await s.addPlugin(new Og),await s.addPlugin(new Fg),await s.addPlugin(new Bg),await s.addPlugin(zm),await s.addPlugin(Vm),await s.addPlugin(_r),await s.addPlugin(jc),await s.addPlugin(rr),e&&await s.addPlugin(zo),t&&await s.addPlugin(Qu),await s.addPlugin(Vo),await s.addPlugin(oa),await s.addPlugin(Os),await s.addPlugin(Es),await s.addPlugin(Pa),await s.addPlugin(xf,!1),await s.addPlugin(Ef),await s.addPlugin(Dr),await s.addPlugin(Vc,!1),await s.addPlugin(Ho,!1),await s.addPlugin(Wc,!1),await s.addPlugin(Wr,!1),await s.addPlugin(N0),await s.addPlugin(Xc),await s.addPlugin(Wo)}async function zg(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:r=!1,importPopup:o=!0,enableDrop:a=!1}={}){var c;const d=new Ta(s);e&&await d.addPlugin(dl);const p=await d.addPlugin(ln,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return o&&await d.addPlugin(Jc),await jg(d,{ground:t,bloom:n,depthTonemap:r,enableDrop:a}),d.renderer.refreshPipeline(),(c=p.importer)===null||c===void 0||c.processors.add("model",{forAssetType:"model",process:(m,A)=>m}),d}Fg.PluginType="FilmicGrain";let Cw=0;class ty extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=Cw++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=fc(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Z`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await zg({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,t,n){console.log("WebGiViewerElement attributes changed.",e,t,n),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],r=[];for(const o of t)!this._models[o]&&o&&(this._models[o]=this.viewer.getManager().importer.importPath(o,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[o,a]of Object.entries(this._models))t.includes(o)?n.push(a):r.push(a);await Promise.all([Promise.all(n).then(async o=>Promise.all(o.map(async a=>this.viewer.getManager().importer.processImported(a)))).then(o=>{for(const a of o)for(const c of a)c&&c.assetType==="model"&&this.viewer.scene.addSceneObject(c)}),Promise.all(r).then(o=>{for(const a of o)for(const c of a)c&&c.assetType==="model"&&c.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",ty);class ny{constructor(e){var t,n,r;this._basePath=(t=e==null?void 0:e.basePath)!==null&&t!==void 0?t:"",this._assets=(r=(n=e==null?void 0:e.assets)===null||n===void 0?void 0:n.map(o=>this._resolveAsset(o)))!==null&&r!==void 0?r:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const t=this._assets.find(e);return t??void 0}_resolveAsset(e){return{...e,path:fu([this._basePath,e.path])}}}class Sw extends ct{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(r=>{var o,a;return r&&(e.test(r.path)||e.test((a=(o=r.file)===null||o===void 0?void 0:o.name)!==null&&a!==void 0?a:""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}var Q0={},ap=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))},iy=function(s){return new Worker(s)};try{URL.revokeObjectURL(ap(""))}catch{ap=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},iy=function(e){return new Worker(e,{type:"module"})}}var bi=Uint8Array,Cs=Uint16Array,eo=Uint32Array,$c=new bi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xu=new bi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ff=new bi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V0=function(s,e){for(var t=new Cs(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var r=new eo(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return[t,r]},ry=V0($c,2),G0=ry[0],jf=ry[1];G0[28]=258,jf[258]=28;for(var H0=V0(Xu,0),sy=H0[0],W0=H0[1],zf=new Cs(32768),gr=0;gr<32768;++gr){var $l=(43690&gr)>>>1|(21845&gr)<<1;$l=(61680&($l=(52428&$l)>>>2|(13107&$l)<<2))>>>4|(3855&$l)<<4,zf[gr]=((65280&$l)>>>8|(255&$l)<<8)>>>1}var la=function(s,e,t){for(var n=s.length,r=0,o=new Cs(e);r<n;++r)++o[s[r]-1];var a,c=new Cs(e);for(r=0;r<e;++r)c[r]=c[r-1]+o[r-1]<<1;if(t){a=new Cs(1<<e);var d=15-e;for(r=0;r<n;++r)if(s[r])for(var p=r<<4|s[r],m=e-s[r],A=c[s[r]-1]++<<m,x=A|(1<<m)-1;A<=x;++A)a[zf[A]>>>d]=p}else for(a=new Cs(n),r=0;r<n;++r)s[r]&&(a[r]=zf[c[s[r]-1]++]>>>15-s[r]);return a},eu=new bi(288);for(gr=0;gr<144;++gr)eu[gr]=8;for(gr=144;gr<256;++gr)eu[gr]=9;for(gr=256;gr<280;++gr)eu[gr]=7;for(gr=280;gr<288;++gr)eu[gr]=8;var tu=new bi(32);for(gr=0;gr<32;++gr)tu[gr]=5;var Pr=la(eu,9,0),oy=la(eu,9,1),Lr=la(tu,5,0),Qf=la(tu,5,1),Qg=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Ba=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},Vg=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},lp=function(s){return(s/8|0)+(7&s&&1)},ho=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Cs?Cs:s instanceof eo?eo:bi)(t-e);return n.set(s.subarray(e,t)),n},Xh=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new bi(0);var r=!e||t,o=!t||t.i;t||(t={}),e||(e=new bi(3*n));var a=function(yn){var yt=e.length;if(yn>yt){var Yn=new bi(Math.max(2*yt,yn));Yn.set(e),e=Yn}},c=t.f||0,d=t.p||0,p=t.b||0,m=t.l,A=t.d,x=t.m,E=t.n,M=8*n;do{if(!m){t.f=c=Ba(s,d,1);var T=Ba(s,d+1,3);if(d+=3,!T){var O=s[(ge=lp(d)+4)-4]|s[ge-3]<<8,P=ge+O;if(P>n){if(o)throw"unexpected EOF";break}r&&a(p+O),e.set(s.subarray(ge,P),p),t.b=p+=O,t.p=d=8*P;continue}if(T==1)m=oy,A=Qf,x=9,E=5;else{if(T!=2)throw"invalid block type";var R=Ba(s,d,31)+257,I=Ba(s,d+10,15)+4,j=R+Ba(s,d+5,31)+1;d+=14;for(var z=new bi(j),V=new bi(19),G=0;G<I;++G)V[Ff[G]]=Ba(s,d+3*G,7);d+=3*I;var X=Qg(V),ne=(1<<X)-1,ce=la(V,X,1);for(G=0;G<j;){var ge,de=ce[Ba(s,d,ne)];if(d+=15&de,(ge=de>>>4)<16)z[G++]=ge;else{var xe=0,pe=0;for(ge==16?(pe=3+Ba(s,d,3),d+=2,xe=z[G-1]):ge==17?(pe=3+Ba(s,d,7),d+=3):ge==18&&(pe=11+Ba(s,d,127),d+=7);pe--;)z[G++]=xe}}var ye=z.subarray(0,R),Re=z.subarray(R);x=Qg(ye),E=Qg(Re),m=la(ye,x,1),A=la(Re,E,1)}if(d>M){if(o)throw"unexpected EOF";break}}r&&a(p+131072);for(var we=(1<<x)-1,We=(1<<E)-1,ot=d;;ot=d){var ft=(xe=m[Vg(s,d)&we])>>>4;if((d+=15&xe)>M){if(o)throw"unexpected EOF";break}if(!xe)throw"invalid length/literal";if(ft<256)e[p++]=ft;else{if(ft==256){ot=d,m=null;break}var nt=ft-254;if(ft>264){var Rt=$c[G=ft-257];nt=Ba(s,d,(1<<Rt)-1)+G0[G],d+=Rt}var Nt=A[Vg(s,d)&We],Ut=Nt>>>4;if(!Nt)throw"invalid distance";if(d+=15&Nt,Re=sy[Ut],Ut>3&&(Rt=Xu[Ut],Re+=Vg(s,d)&(1<<Rt)-1,d+=Rt),d>M){if(o)throw"unexpected EOF";break}r&&a(p+131072);for(var Ht=p+nt;p<Ht;p+=4)e[p]=e[p-Re],e[p+1]=e[p+1-Re],e[p+2]=e[p+2-Re],e[p+3]=e[p+3-Re];p=Ht}}t.l=m,t.p=ot,t.b=p,m&&(c=1,t.m=x,t.d=A,t.n=E)}while(!c);return p==e.length?e:ho(e,0,p)},ec=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},cp=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},Gg=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return[nu,0];if(r==1){var a=new bi(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(z,V){return z.f-V.f}),t.push({s:-1,f:25001});var c=t[0],d=t[1],p=0,m=1,A=2;for(t[0]={s:-1,f:c.f+d.f,l:c,r:d};m!=r-1;)c=t[t[p].f<t[A].f?p++:A++],d=t[p!=m&&t[p].f<t[A].f?p++:A++],t[m++]={s:-1,f:c.f+d.f,l:c,r:d};var x=o[0].s;for(n=1;n<r;++n)o[n].s>x&&(x=o[n].s);var E=new Cs(x+1),M=ka(t[m-1],E,0);if(M>e){n=0;var T=0,O=M-e,P=1<<O;for(o.sort(function(z,V){return E[V.s]-E[z.s]||z.f-V.f});n<r;++n){var R=o[n].s;if(!(E[R]>e))break;T+=P-(1<<M-E[R]),E[R]=e}for(T>>>=O;T>0;){var I=o[n].s;E[I]<e?T-=1<<e-E[I]++-1:++n}for(;n>=0&&T;--n){var j=o[n].s;E[j]==e&&(--E[j],++T)}M=e}return[new bi(E),M]},ka=function(s,e,t){return s.s==-1?Math.max(ka(s.l,e,t+1),ka(s.r,e,t+1)):e[s.s]=t},q0=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Cs(++e),n=0,r=s[0],o=1,a=function(d){t[n++]=d},c=1;c<=e;++c)if(s[c]==r&&c!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=s[c]}return[t.subarray(0,n),e]},up=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},Vf=function(s,e,t){var n=t.length,r=lp(e+2);s[r]=255&n,s[r+1]=n>>>8,s[r+2]=255^s[r],s[r+3]=255^s[r+1];for(var o=0;o<n;++o)s[r+o+4]=t[o];return 8*(r+4+n)},Y0=function(s,e,t,n,r,o,a,c,d,p,m){ec(e,m++,t),++r[256];for(var A=Gg(r,15),x=A[0],E=A[1],M=Gg(o,15),T=M[0],O=M[1],P=q0(x),R=P[0],I=P[1],j=q0(T),z=j[0],V=j[1],G=new Cs(19),X=0;X<R.length;++X)G[31&R[X]]++;for(X=0;X<z.length;++X)G[31&z[X]]++;for(var ne=Gg(G,7),ce=ne[0],ge=ne[1],de=19;de>4&&!ce[Ff[de-1]];--de);var xe,pe,ye,Re,we=p+5<<3,We=up(r,eu)+up(o,tu)+a,ot=up(r,x)+up(o,T)+a+14+3*de+up(G,ce)+(2*G[16]+3*G[17]+7*G[18]);if(we<=We&&we<=ot)return Vf(e,m,s.subarray(d,d+p));if(ec(e,m,1+(ot<We)),m+=2,ot<We){xe=la(x,E,0),pe=x,ye=la(T,O,0),Re=T;var ft=la(ce,ge,0);for(ec(e,m,I-257),ec(e,m+5,V-1),ec(e,m+10,de-4),m+=14,X=0;X<de;++X)ec(e,m+3*X,ce[Ff[X]]);m+=3*de;for(var nt=[R,z],Rt=0;Rt<2;++Rt){var Nt=nt[Rt];for(X=0;X<Nt.length;++X){var Ut=31&Nt[X];ec(e,m,ft[Ut]),m+=ce[Ut],Ut>15&&(ec(e,m,Nt[X]>>>5&127),m+=Nt[X]>>>12)}}}else xe=Pr,pe=eu,ye=Lr,Re=tu;for(X=0;X<c;++X)if(n[X]>255){Ut=n[X]>>>18&31,cp(e,m,xe[Ut+257]),m+=pe[Ut+257],Ut>7&&(ec(e,m,n[X]>>>23&31),m+=$c[Ut]);var Ht=31&n[X];cp(e,m,ye[Ht]),m+=Re[Ht],Ht>3&&(cp(e,m,n[X]>>>5&8191),m+=Xu[Ht])}else cp(e,m,xe[n[X]]),m+=pe[n[X]];return cp(e,m,xe[256]),m+pe[256]},ay=new eo([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),nu=new bi(0),ly=function(s,e,t,n,r,o){var a=s.length,c=new bi(n+a+5*(1+Math.ceil(a/7e3))+r),d=c.subarray(n,c.length-r),p=0;if(!e||a<8)for(var m=0;m<=a;m+=65535){var A=m+65535;A<a?p=Vf(d,p,s.subarray(m,A)):(d[m]=o,p=Vf(d,p,s.subarray(m,a)))}else{for(var x=ay[e-1],E=x>>>13,M=8191&x,T=(1<<t)-1,O=new Cs(32768),P=new Cs(T+1),R=Math.ceil(t/3),I=2*R,j=function(zi){return(s[zi]^s[zi+1]<<R^s[zi+2]<<I)&T},z=new eo(25e3),V=new Cs(288),G=new Cs(32),X=0,ne=0,ce=(m=0,0),ge=0,de=0;m<a;++m){var xe=j(m),pe=32767&m,ye=P[xe];if(O[pe]=ye,P[xe]=pe,ge<=m){var Re=a-m;if((X>7e3||ce>24576)&&Re>423){p=Y0(s,d,0,z,V,G,ne,ce,de,m-de,p),ce=X=ne=0,de=m;for(var we=0;we<286;++we)V[we]=0;for(we=0;we<30;++we)G[we]=0}var We=2,ot=0,ft=M,nt=pe-ye&32767;if(Re>2&&xe==j(m-nt))for(var Rt=Math.min(E,Re)-1,Nt=Math.min(32767,m),Ut=Math.min(258,Re);nt<=Nt&&--ft&&pe!=ye;){if(s[m+We]==s[m+We-nt]){for(var Ht=0;Ht<Ut&&s[m+Ht]==s[m+Ht-nt];++Ht);if(Ht>We){if(We=Ht,ot=nt,Ht>Rt)break;var yn=Math.min(nt,Ht-2),yt=0;for(we=0;we<yn;++we){var Yn=m-nt+we+32768&32767,ai=Yn-O[Yn]+32768&32767;ai>yt&&(yt=ai,ye=Yn)}}}nt+=(pe=ye)-(ye=O[pe])+32768&32767}if(ot){z[ce++]=268435456|jf[We]<<18|W0[ot];var Xn=31&jf[We],Ci=31&W0[ot];ne+=$c[Xn]+Xu[Ci],++V[257+Xn],++G[Ci],ge=m+We,++X}else z[ce++]=s[m],++V[s[m]]}}p=Y0(s,d,o,z,V,G,ne,ce,de,m-de,p),!o&&7&p&&(p=Vf(d,p+1,nu))}return ho(c,0,n+lp(p)+r)},cy=function(){for(var s=new eo(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&3988292384)^t>>>1;s[e]=t}return s}(),hp=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=cy[255&t^e[n]]^t>>>8;s=t},d:function(){return~s}}},X0=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,o=t.length,a=0;a!=o;){for(var c=Math.min(a+2655,o);a<c;++a)r+=n+=t[a];n=(65535&n)+15*(n>>16),r=(65535&r)+15*(r>>16)}s=n,e=r},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Kh=function(s,e,t,n,r){return ly(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!r)},Gf=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},uy=function(s,e,t){for(var n=s(),r=s.toString(),o=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var c=n[a],d=o[a];if(typeof c=="function"){e+=";"+d+"=";var p=c.toString();if(c.prototype)if(p.indexOf("[native code]")!=-1){var m=p.indexOf(" ",8)+1;e+=p.slice(m,p.indexOf("(",m))}else for(var A in e+=p,c.prototype)e+=";"+d+".prototype."+A+"="+c.prototype[A].toString();else e+=p}else t[d]=c}return[e,t]},Hg=[],hy=function(s,e,t,n){var r;if(!Hg[t]){for(var o="",a={},c=s.length-1,d=0;d<c;++d)o=(r=uy(s[d],o,a))[0],a=r[1];Hg[t]=uy(s[c],o,a)}var p=Gf({},Hg[t][1]);return function(m,A,x,E,M){var T=iy(Q0[A]||(Q0[A]=ap(m)));return T.onerror=function(O){return M(O.error,null)},T.onmessage=function(O){return M(null,O.data)},T.postMessage(x,E),T}(Hg[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,p,function(m){var A=[];for(var x in m)(m[x]instanceof bi||m[x]instanceof Cs||m[x]instanceof eo)&&A.push((m[x]=new m[x].constructor(m[x])).buffer);return A}(p),n)},dp=function(){return[bi,Cs,eo,$c,Xu,Ff,G0,sy,oy,Qf,zf,la,Qg,Ba,Vg,lp,ho,Xh,$,Ku,K0]},pp=function(){return[bi,Cs,eo,$c,Xu,Ff,jf,W0,Pr,eu,Lr,tu,zf,ay,nu,la,ec,cp,Gg,ka,q0,up,Vf,Y0,lp,ho,ly,Kh,F,Ku]},dy=function(){return[g,C,h,hp,cy]},py=function(){return[_,y]},fy=function(){return[S,h,X0]},my=function(){return[B]},Ku=function(s){return postMessage(s,[s.buffer])},K0=function(s){return s&&s.size&&new bi(s.size)},fp=function(s,e,t,n,r,o){var a=hy(t,n,r,function(c,d){a.terminate(),o(c,d)});return a.postMessage([s,e],e.consume?[s.buffer]:[]),function(){a.terminate()}},Oa=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},b=function(s,e,t,n,r){var o,a=hy(s,n,r,function(c,d){c?(a.terminate(),e.ondata.call(e,c)):(d[1]&&a.terminate(),e.ondata.call(e,c,d[0],d[1]))});a.postMessage(t),e.push=function(c,d){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([c,o=d],[c.buffer])},e.terminate=function(){a.terminate()}},i=function(s,e){return s[e]|s[e+1]<<8},l=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},u=function(s,e){return l(s,e)+4294967296*l(s,e+4)},h=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},g=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&h(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},_=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;4&e&&(t+=s[10]|2+(s[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(2&e)},y=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},C=function(s){return 10+(s.filename&&s.filename.length+1||0)},S=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},B=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function L(s,e){return e||typeof s!="function"||(e=s,s={}),this.ondata=e,s}var k=function(){function s(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(Kh(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),U=function(){return function(s,e){b([pp,function(){return[Oa,k]}],this,L.call(this,s,e),function(t){var n=new k(t.data);onmessage=Oa(n)},6)}}();function Q(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[pp],function(n){return Ku(F(n.data[0],n.data[1]))},0,t)}function F(s,e){return Kh(s,e||{},0,0)}var H=function(){function s(e){this.s={},this.p=new bi(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new bi(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Xh(this.p,this.o,this.s);this.ondata(ho(n,t,this.s.b),this.d),this.o=ho(n,this.s.b-32768),this.s.b=this.o.length,this.p=ho(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),W=function(){return function(s){this.ondata=s,b([dp,function(){return[Oa,H]}],this,0,function(){var e=new H;onmessage=Oa(e)},7)}}();function q(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[dp],function(n){return Ku($(n.data[0],K0(n.data[1])))},1,t)}function $(s,e){return Xh(s,e)}var ie=function(){function s(e,t){this.c=hp(),this.l=0,this.v=1,k.call(this,e,t)}return s.prototype.push=function(e,t){k.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Kh(e,this.o,this.v&&C(this.o),t&&8,!t);this.v&&(g(n,this.o),this.v=0),t&&(h(n,n.length-8,this.c.d()),h(n,n.length-4,this.l)),this.ondata(n,t)},s}(),se=function(){return function(s,e){b([pp,dy,function(){return[Oa,k,ie]}],this,L.call(this,s,e),function(t){var n=new ie(t.data);onmessage=Oa(n)},8)}}();function le(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[pp,dy,function(){return[Ie]}],function(n){return Ku(Ie(n.data[0],n.data[1]))},2,t)}function Ie(s,e){e||(e={});var t=hp(),n=s.length;t.p(s);var r=Kh(s,e,C(e),8),o=r.length;return g(r,e),h(r,o-8,t.d()),h(r,o-4,n),r}var De=function(){function s(e){this.v=1,H.call(this,e)}return s.prototype.push=function(e,t){if(H.prototype.e.call(this,e),this.v){var n=this.p.length>3?_(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}H.prototype.c.call(this,t)},s}(),Xe=function(){return function(s){this.ondata=s,b([dp,py,function(){return[Oa,H,De]}],this,0,function(){var e=new De;onmessage=Oa(e)},9)}}();function Ke(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[dp,py,function(){return[Be]}],function(n){return Ku(Be(n.data[0]))},3,t)}function Be(s,e){return Xh(s.subarray(_(s),-8),e||new bi(y(s)))}var St=function(){function s(e,t){this.c=X0(),this.v=1,k.call(this,e,t)}return s.prototype.push=function(e,t){k.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=Kh(e,this.o,this.v&&2,t&&4,!t);this.v&&(S(n,this.o),this.v=0),t&&h(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),Ft=function(){return function(s,e){b([pp,fy,function(){return[Oa,k,St]}],this,L.call(this,s,e),function(t){var n=new St(t.data);onmessage=Oa(n)},10)}}();function Et(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[pp,fy,function(){return[nn]}],function(n){return Ku(nn(n.data[0],n.data[1]))},4,t)}function nn(s,e){e||(e={});var t=X0();t.p(s);var n=Kh(s,e,2,4);return S(n,e),h(n,n.length-4,t.d()),n}var rn=function(){function s(e){this.v=1,H.call(this,e)}return s.prototype.push=function(e,t){if(H.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}H.prototype.c.call(this,t)},s}(),dt=function(){return function(s){this.ondata=s,b([dp,my,function(){return[Oa,H,rn]}],this,0,function(){var e=new rn;onmessage=Oa(e)},11)}}();function At(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return fp(s,e,[dp,my,function(){return[Wt]}],function(n){return Ku(Wt(n.data[0],K0(n.data[1])))},5,t)}function Wt(s,e){return Xh((B(s),s.subarray(2,-4)),e)}var Mt=function(){function s(e){this.G=De,this.I=H,this.Z=rn,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new bi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},s}(),en=function(){function s(e){this.G=Xe,this.I=W,this.Z=dt,this.ondata=e}return s.prototype.push=function(e,t){Mt.prototype.push.call(this,e,t)},s}();function In(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?Ke(s,e,t):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?q(s,e,t):At(s,e,t)}function hi(s,e){return s[0]==31&&s[1]==139&&s[2]==8?Be(s,e):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?$(s,e):Wt(s,e)}var Pn=function(s,e,t,n){for(var r in s){var o=s[r],a=e+r;o instanceof bi?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],Gf(n,o[1])]:Pn(o,a+"/",t,n)}},ri=typeof TextEncoder<"u"&&new TextEncoder,Ce=typeof TextDecoder<"u"&&new TextDecoder,_e=0;try{Ce.decode(nu,{stream:!0}),_e=1}catch{}var it=function(s){for(var e="",t=0;;){var n=s[t++],r=(n>127)+(n>223)+(n>239);if(t+r>s.length)return[e,ho(s,t-1)];r?r==3?(n=((15&n)<<18|(63&s[t++])<<12|(63&s[t++])<<6|63&s[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&r?String.fromCharCode((31&n)<<6|63&s[t++]):String.fromCharCode((15&n)<<12|(63&s[t++])<<6|63&s[t++]):e+=String.fromCharCode(n)}},qe=function(){function s(e){this.ondata=e,_e?this.t=new TextDecoder:this.p=nu}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new bi(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=it(n),o=r[0],a=r[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,t)}},s}(),Se=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(He(e),this.d=t||!1)},s}();function He(s,e){if(e){for(var t=new bi(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(ri)return ri.encode(s);var r=s.length,o=new bi(s.length+(s.length>>1)),a=0,c=function(m){o[a++]=m};for(n=0;n<r;++n){if(a+5>o.length){var d=new bi(a+8+(r-n<<1));d.set(o),o=d}var p=s.charCodeAt(n);p<128||e?c(p):p<2048?(c(192|p>>6),c(128|63&p)):p>55295&&p<57344?(c(240|(p=65536+(1047552&p)|1023&s.charCodeAt(++n))>>18),c(128|p>>12&63),c(128|p>>6&63),c(128|63&p)):(c(224|p>>12),c(128|p>>6&63),c(128|63&p))}return ho(o,0,a)}function gt(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}if(Ce)return Ce.decode(s);var r=it(s),o=r[0];if(r[1].length)throw"invalid utf-8 data";return o}var ee=function(s){return s==1?3:s<6?2:s==9?1:0},_t=function(s,e){return e+30+i(s,e+26)+i(s,e+28)},tt=function(s,e,t){var n=i(s,e+28),r=gt(s.subarray(e+46,e+46+n),!(2048&i(s,e+8))),o=e+46+n,a=l(s,e+20),c=t&&a==4294967295?Ct(s,o):[a,l(s,e+24),l(s,e+42)],d=c[0],p=c[1],m=c[2];return[i(s,e+10),d,p,r,o+i(s,e+30)+i(s,e+32),m]},Ct=function(s,e){for(;i(s,e)!=1;e+=4+i(s,e+2));return[u(s,e+12),u(s,e+4),u(s,e+20)]},Pt=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},cn=function(s,e,t,n,r,o,a,c){var d=n.length,p=t.extra,m=c&&c.length,A=Pt(p);h(s,e,a!=null?33639248:67324752),e+=4,a!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(o==null&&8),s[e++]=r&&8,s[e++]=255&t.compression,s[e++]=t.compression>>8;var x=new Date(t.mtime==null?Date.now():t.mtime),E=x.getFullYear()-1980;if(E<0||E>119)throw"date not in range 1980-2099";if(h(s,e,E<<25|x.getMonth()+1<<21|x.getDate()<<16|x.getHours()<<11|x.getMinutes()<<5|x.getSeconds()>>>1),e+=4,o!=null&&(h(s,e,t.crc),h(s,e+4,o),h(s,e+8,t.size)),h(s,e+12,d),h(s,e+14,A),e+=16,a!=null&&(h(s,e,m),h(s,e+6,t.attrs),h(s,e+10,a),e+=14),s.set(n,e),e+=d,A)for(var M in p){var T=p[M],O=T.length;h(s,e,+M),h(s,e+2,O),s.set(T,e+4),e+=4+O}return m&&(s.set(c,e),e+=m),e},Rn=function(s,e,t,n,r){h(s,e,101010256),h(s,e+8,t),h(s,e+10,t),h(s,e+12,n),h(s,e+16,r)},zn=function(){function s(e){this.filename=e,this.c=hp(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),ti=function(){function s(e,t){var n=this;t||(t={}),zn.call(this,e),this.d=new k(t,function(r,o){n.ondata(null,r,o)}),this.compression=8,this.flag=ee(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){zn.prototype.push.call(this,e,t)},s}(),Un=function(){function s(e,t){var n=this;t||(t={}),zn.call(this,e),this.d=new U(t,function(r,o,a){n.ondata(r,o,a)}),this.compression=8,this.flag=ee(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){zn.prototype.push.call(this,e,t)},s}(),Qn=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=He(e.filename),r=n.length,o=e.comment,a=o&&He(o),c=r!=e.filename.length||a&&o.length!=a.length,d=r+Pt(e.extra)+30;if(r>65535)throw"filename too long";var p=new bi(d);cn(p,0,e,n,c);var m=[p],A=function(){for(var O=0,P=m;O<P.length;O++){var R=P[O];t.ondata(null,R,!1)}m=[]},x=this.d;this.d=0;var E=this.u.length,M=Gf(e,{f:n,u:c,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(A(),x){var O=t.u[E+1];O?O.r():t.d=1}x=1}}),T=0;e.ondata=function(O,P,R){if(O)t.ondata(O,P,R),t.terminate();else if(T+=P.length,m.push(P),R){var I=new bi(16);h(I,0,134695760),h(I,4,e.crc),h(I,8,T),h(I,12,e.size),m.push(I),M.c=T,M.b=d+T+16,M.crc=e.crc,M.size=e.size,x&&M.r(),x=1}else x&&A()},this.u.push(M)},s.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,r=0,o=this.u;r<o.length;r++)n+=46+(p=o[r]).f.length+Pt(p.extra)+(p.o?p.o.length:0);for(var a=new bi(n+22),c=0,d=this.u;c<d.length;c++){var p=d[c];cn(a,e,p,p.f,p.u,p.c,t,p.o),e+=46+p.f.length+Pt(p.extra)+(p.o?p.o.length:0),t+=p.b}Rn(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},s}();function Ui(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Pn(s,"",n,e);var r=Object.keys(n),o=r.length,a=0,c=0,d=o,p=new Array(o),m=[],A=function(){for(var T=0;T<m.length;++T)m[T]()},x=function(){var T=new bi(c+22),O=a,P=c-a;c=0;for(var R=0;R<d;++R){var I=p[R];try{var j=I.c.length;cn(T,c,I,I.f,I.u,j);var z=30+I.f.length+Pt(I.extra),V=c+z;T.set(I.c,V),cn(T,a,I,I.f,I.u,j,c,I.m),a+=16+z+(I.m?I.m.length:0),c=V+j}catch(G){return t(G,null)}}Rn(T,a,p.length,P,O),t(null,T)};o||x();for(var E=function(T){var O=r[T],P=n[O],R=P[0],I=P[1],j=hp(),z=R.length;j.p(R);var V=He(O),G=V.length,X=I.comment,ne=X&&He(X),ce=ne&&ne.length,ge=Pt(I.extra),de=I.level==0?0:8,xe=function(pe,ye){if(pe)A(),t(pe,null);else{var Re=ye.length;p[T]=Gf(I,{size:z,crc:j.d(),c:ye,f:V,m:ne,u:G!=O.length||ne&&X.length!=ce,compression:de}),a+=30+G+ge+Re,c+=76+2*(G+ge)+(ce||0)+Re,--o||x()}};if(G>65535&&xe("filename too long",null),de)if(z<16e4)try{xe(null,F(R,I))}catch(pe){xe(pe,null)}else m.push(Q(R,I,xe));else xe(null,R)},M=0;M<d;++M)E(M);return A}function ca(s,e){e||(e={});var t={},n=[];Pn(s,"",t,e);var r=0,o=0;for(var a in t){var c=t[a],d=c[0],p=c[1],m=p.level==0?0:8,A=(G=He(a)).length,x=p.comment,E=x&&He(x),M=E&&E.length,T=Pt(p.extra);if(A>65535)throw"filename too long";var O=m?F(d,p):d,P=O.length,R=hp();R.p(d),n.push(Gf(p,{size:d.length,crc:R.d(),c:O,f:G,m:E,u:A!=a.length||E&&x.length!=M,o:r,compression:m})),r+=30+A+T+P,o+=76+2*(A+T)+(M||0)+P}for(var I=new bi(o+22),j=r,z=o-r,V=0;V<n.length;++V){var G=n[V];cn(I,G.o,G,G.f,G.u,G.c.length);var X=30+G.f.length+Pt(G.extra);I.set(G.c,G.o+X),cn(I,r,G,G.f,G.u,G.c.length,G.o,G.m),r+=16+X+(G.m?G.m.length:0)}return Rn(I,r,n.length,z,j),I}var $n=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),Gi=function(){function s(){var e=this;this.i=new H(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),Hi=function(){function s(e,t){var n=this;t<32e4?this.i=new H(function(r,o){n.ondata(null,r,o)}):(this.i=new W(function(r,o,a){n.ondata(r,o,a)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=ho(e,0)),this.i.push(e,t)},s.compression=8,s}(),Wg=function(){function s(e){this.onfile=e,this.k=[],this.o={0:$n},this.p=nu}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),o=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(r)).length)return this.push(e,t)}else{var a=0,c=0,d=void 0,p=void 0;this.p.length?e.length?((p=new bi(this.p.length+e.length)).set(this.p),p.set(e,this.p.length)):p=this.p:p=e;for(var m=p.length,A=this.c,x=A&&this.d,E=function(){var O,P=l(p,c);if(P==67324752){a=1,d=c,M.d=null,M.c=0;var R=i(p,c+6),I=i(p,c+8),j=2048&R,z=8&R,V=i(p,c+26),G=i(p,c+28);if(m>c+30+V+G){var X=[];M.k.unshift(X),a=2;var ne,ce=l(p,c+18),ge=l(p,c+22),de=gt(p.subarray(c+30,c+=30+V),!j);ce==4294967295?(O=z?[-2]:Ct(p,c),ce=O[0],ge=O[1]):z&&(ce=-1),c+=G,M.c=ce;var xe={name:de,compression:I,start:function(){if(!xe.ondata)throw"no callback";if(ce){var pe=n.o[I];if(!pe)throw"unknown compression type "+I;(ne=ce<0?new pe(de):new pe(de,ce,ge)).ondata=function(We,ot,ft){xe.ondata(We,ot,ft)};for(var ye=0,Re=X;ye<Re.length;ye++){var we=Re[ye];ne.push(we,!1)}n.k[0]==X&&n.c?n.d=ne:ne.push(nu,!0)}else xe.ondata(null,nu,!0)},terminate:function(){ne&&ne.terminate&&ne.terminate()}};ce>=0&&(xe.size=ce,xe.originalSize=ge),M.onfile(xe)}return"break"}if(A){if(P==134695760)return d=c+=12+(A==-2&&8),a=3,M.c=0,"break";if(P==33639248)return d=c-=4,a=3,M.c=0,"break"}},M=this;c<m-4&&E()!=="break";++c);if(this.p=nu,A<0){var T=a?p.subarray(0,d-12-(A==-2&&8)-(l(p,d-16)==134695760&&4)):p.subarray(0,c);x?x.push(T,!!a):this.k[+(a==2)].push(T)}if(2&a)return this.push(p.subarray(c),t);this.p=p.subarray(c)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function pn(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var x=0;x<t.length;++x)t[x]()},r={},o=s.length-22;l(s,o)!=101010256;--o)if(!o||s.length-o>65558)return void e("invalid zip file",null);var a=i(s,o+8);a||e(null,{});var c=a,d=l(s,o+16),p=d==4294967295;if(p){if(o=l(s,o-12),l(s,o)!=101075792)return void e("invalid zip file",null);c=a=l(s,o+32),d=l(s,o+48)}for(var m=function(x){var E=tt(s,d,p),M=E[0],T=E[1],O=E[2],P=E[3],R=E[4],I=E[5],j=_t(s,I);d=R;var z=function(G,X){G?(n(),e(G,null)):(r[P]=X,--a||e(null,r))};if(M)if(M==8){var V=s.subarray(j,j+T);if(T<32e4)try{z(null,$(V,new bi(O)))}catch(G){z(G,null)}else t.push(q(V,{size:O},z))}else z("unknown compression type "+M,null);else z(null,ho(s,j,j+T))},A=0;A<c;++A)m();return n}function gy(s){for(var e={},t=s.length-22;l(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=i(s,t+8);if(!n)return{};var r=l(s,t+16),o=r==4294967295;if(o){if(t=l(s,t-12),l(s,t)!=101075792)throw"invalid zip file";n=l(s,t+32),r=l(s,t+48)}for(var a=0;a<n;++a){var c=tt(s,r,o),d=c[0],p=c[1],m=c[2],A=c[3],x=c[4],E=c[5],M=_t(s,E);if(r=x,d){if(d!=8)throw"unknown compression type "+d;e[A]=$(s.subarray(M,M+p),new bi(m))}else e[A]=ho(s,M,M+p)}return e}class vy extends f.yxD{constructor(e){super(e),this.type=f.cLu}parse(e){const o=Math.pow(2.7182818,2.2),a={l:0,c:0,lc:0};function c(re,Pe,oe,ze,$e){for(;oe<re;)Pe=Pe<<8|Rt(ze,$e),oe+=8;oe-=re,a.l=Pe>>oe&(1<<re)-1,a.c=Pe,a.lc=oe}const d=new Array(59);function p(re){return 63&re}function m(re){return re>>6}const A={c:0,lc:0};function x(re,Pe,oe,ze){re=re<<8|Rt(oe,ze),Pe+=8,A.c=re,A.lc=Pe}const E={c:0,lc:0};function M(re,Pe,oe,ze,$e,Fe,at,Zt,hn){if(re==Pe){ze<8&&(x(oe,ze,$e,Fe),oe=A.c,ze=A.lc);let _n=oe>>(ze-=8);if(_n=new Uint8Array([_n])[0],Zt.value+_n>hn)return!1;const vn=at[Zt.value-1];for(;_n-- >0;)at[Zt.value++]=vn}else{if(!(Zt.value<hn))return!1;at[Zt.value++]=re}E.c=oe,E.lc=ze}function T(re){return 65535&re}function O(re){const Pe=T(re);return Pe>32767?Pe-65536:Pe}const P={a:0,b:0};function R(re,Pe){const oe=O(re),ze=O(Pe),$e=oe+(1&ze)+(ze>>1),Fe=$e,at=$e-ze;P.a=Fe,P.b=at}function I(re,Pe){const oe=T(re),ze=T(Pe),$e=oe-(ze>>1)&65535,Fe=ze+$e-32768&65535;P.a=Fe,P.b=$e}function j(re,Pe,oe,ze,$e,Fe,at){const Zt=at<16384,hn=oe>$e?$e:oe;let _n,vn,bn=1;for(;bn<=hn;)bn<<=1;for(bn>>=1,_n=bn,bn>>=1;bn>=1;){vn=0;const fn=vn+Fe*($e-_n),dn=Fe*bn,Dn=Fe*_n,sn=ze*bn,Bn=ze*_n;let Nn,Wn,yr,nr;for(;vn<=fn;vn+=Dn){let kn=vn;const Jn=vn+ze*(oe-_n);for(;kn<=Jn;kn+=Bn){const Ai=kn+sn,zs=kn+dn,Ha=zs+sn;Zt?(R(re[kn+Pe],re[zs+Pe]),Nn=P.a,yr=P.b,R(re[Ai+Pe],re[Ha+Pe]),Wn=P.a,nr=P.b,R(Nn,Wn),re[kn+Pe]=P.a,re[Ai+Pe]=P.b,R(yr,nr),re[zs+Pe]=P.a,re[Ha+Pe]=P.b):(I(re[kn+Pe],re[zs+Pe]),Nn=P.a,yr=P.b,I(re[Ai+Pe],re[Ha+Pe]),Wn=P.a,nr=P.b,I(Nn,Wn),re[kn+Pe]=P.a,re[Ai+Pe]=P.b,I(yr,nr),re[zs+Pe]=P.a,re[Ha+Pe]=P.b)}if(oe&bn){const Ai=kn+dn;Zt?R(re[kn+Pe],re[Ai+Pe]):I(re[kn+Pe],re[Ai+Pe]),Nn=P.a,re[Ai+Pe]=P.b,re[kn+Pe]=Nn}}if($e&bn){let kn=vn;const Jn=vn+ze*(oe-_n);for(;kn<=Jn;kn+=Bn){const Ai=kn+sn;Zt?R(re[kn+Pe],re[Ai+Pe]):I(re[kn+Pe],re[Ai+Pe]),Nn=P.a,re[Ai+Pe]=P.b,re[kn+Pe]=Nn}}_n=bn,bn>>=1}return vn}function z(re,Pe,oe,ze,$e,Fe){const at=oe.value,Zt=nt(Pe,oe),hn=nt(Pe,oe);oe.value+=4;const _n=nt(Pe,oe);if(oe.value+=4,Zt<0||Zt>=65537||hn<0||hn>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const vn=new Array(65537),bn=new Array(16384);if(function(fn){for(let dn=0;dn<16384;dn++)fn[dn]={},fn[dn].len=0,fn[dn].lit=0,fn[dn].p=null}(bn),function(fn,dn,Dn,sn,Bn,Nn){const Wn=dn;let yr=0,nr=0;for(;sn<=Bn;sn++){if(Wn.value-dn.value>Dn)return!1;c(6,yr,nr,fn,Wn);const kn=a.l;if(yr=a.c,nr=a.lc,Nn[sn]=kn,kn==63){if(Wn.value-dn.value>Dn)throw new Error("Something wrong with hufUnpackEncTable");c(8,yr,nr,fn,Wn);let Jn=a.l+6;if(yr=a.c,nr=a.lc,sn+Jn>Bn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Jn--;)Nn[sn++]=0;sn--}else if(kn>=59){let Jn=kn-59+2;if(sn+Jn>Bn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Jn--;)Nn[sn++]=0;sn--}}(function(kn){for(let Ai=0;Ai<=58;++Ai)d[Ai]=0;for(let Ai=0;Ai<65537;++Ai)d[kn[Ai]]+=1;let Jn=0;for(let Ai=58;Ai>0;--Ai){const zs=Jn+d[Ai]>>1;d[Ai]=Jn,Jn=zs}for(let Ai=0;Ai<65537;++Ai){const zs=kn[Ai];zs>0&&(kn[Ai]=zs|d[zs]++<<6)}})(Nn)}(re,oe,ze-(oe.value-at),Zt,hn,vn),_n>8*(ze-(oe.value-at)))throw new Error("Something wrong with hufUncompress");(function(fn,dn,Dn,sn){for(;dn<=Dn;dn++){const Bn=m(fn[dn]),Nn=p(fn[dn]);if(Bn>>Nn)throw new Error("Invalid table entry");if(Nn>14){const Wn=sn[Bn>>Nn-14];if(Wn.len)throw new Error("Invalid table entry");if(Wn.lit++,Wn.p){const yr=Wn.p;Wn.p=new Array(Wn.lit);for(let nr=0;nr<Wn.lit-1;++nr)Wn.p[nr]=yr[nr]}else Wn.p=new Array(1);Wn.p[Wn.lit-1]=dn}else if(Nn){let Wn=0;for(let yr=1<<14-Nn;yr>0;yr--){const nr=sn[(Bn<<14-Nn)+Wn];if(nr.len||nr.p)throw new Error("Invalid table entry");nr.len=Nn,nr.lit=dn,Wn++}}}})(vn,Zt,hn,bn),function(fn,dn,Dn,sn,Bn,Nn,Wn,yr,nr){let kn=0,Jn=0;const Ai=Wn,zs=Math.trunc(sn.value+(Bn+7)/8);for(;sn.value<zs;)for(x(kn,Jn,Dn,sn),kn=A.c,Jn=A.lc;Jn>=14;){const to=dn[kn>>Jn-14&16383];if(to.len)Jn-=to.len,M(to.lit,Nn,kn,Jn,Dn,sn,yr,nr,Ai),kn=E.c,Jn=E.lc;else{if(!to.p)throw new Error("hufDecode issues");let cd;for(cd=0;cd<to.lit;cd++){const ym=p(fn[to.p[cd]]);for(;Jn<ym&&sn.value<zs;)x(kn,Jn,Dn,sn),kn=A.c,Jn=A.lc;if(Jn>=ym&&m(fn[to.p[cd]])==(kn>>Jn-ym&(1<<ym)-1)){Jn-=ym,M(to.p[cd],Nn,kn,Jn,Dn,sn,yr,nr,Ai),kn=E.c,Jn=E.lc;break}}if(cd==to.lit)throw new Error("hufDecode issues")}}const Ha=8-Bn&7;for(kn>>=Ha,Jn-=Ha;Jn>0;){const to=dn[kn<<14-Jn&16383];if(!to.len)throw new Error("hufDecode issues");Jn-=to.len,M(to.lit,Nn,kn,Jn,Dn,sn,yr,nr,Ai),kn=E.c,Jn=E.lc}}(vn,bn,re,oe,_n,hn,Fe,$e,{value:0})}function V(re){for(let Pe=1;Pe<re.length;Pe++){const oe=re[Pe-1]+re[Pe]-128;re[Pe]=oe}}function G(re,Pe){let oe=0,ze=Math.floor((re.length+1)/2),$e=0;const Fe=re.length-1;for(;!($e>Fe||(Pe[$e++]=re[oe++],$e>Fe));)Pe[$e++]=re[ze++]}function X(re){let Pe=re.byteLength;const oe=new Array;let ze=0;const $e=new DataView(re);for(;Pe>0;){const Fe=$e.getInt8(ze++);if(Fe<0){const at=-Fe;Pe-=at+1;for(let Zt=0;Zt<at;Zt++)oe.push($e.getUint8(ze++))}else{const at=Fe;Pe-=2;const Zt=$e.getUint8(ze++);for(let hn=0;hn<at+1;hn++)oe.push(Zt)}}return oe}function ne(re,Pe,oe){let ze,$e=1;for(;$e<64;)ze=Pe[re.value],ze==65280?$e=64:ze>>8==255?$e+=255&ze:(oe[$e]=ze,$e++),re.value++}function ce(re){const Pe=.5*Math.cos(.7853975),oe=.5*Math.cos(3.14159/16),ze=.5*Math.cos(3.14159/8),$e=.5*Math.cos(3*3.14159/16),Fe=.5*Math.cos(.981746875),at=.5*Math.cos(3*3.14159/8),Zt=.5*Math.cos(1.374445625),hn=new Array(4),_n=new Array(4),vn=new Array(4),bn=new Array(4);for(let fn=0;fn<8;++fn){const dn=8*fn;hn[0]=ze*re[dn+2],hn[1]=at*re[dn+2],hn[2]=ze*re[dn+6],hn[3]=at*re[dn+6],_n[0]=oe*re[dn+1]+$e*re[dn+3]+Fe*re[dn+5]+Zt*re[dn+7],_n[1]=$e*re[dn+1]-Zt*re[dn+3]-oe*re[dn+5]-Fe*re[dn+7],_n[2]=Fe*re[dn+1]-oe*re[dn+3]+Zt*re[dn+5]+$e*re[dn+7],_n[3]=Zt*re[dn+1]-Fe*re[dn+3]+$e*re[dn+5]-oe*re[dn+7],vn[0]=Pe*(re[dn+0]+re[dn+4]),vn[3]=Pe*(re[dn+0]-re[dn+4]),vn[1]=hn[0]+hn[3],vn[2]=hn[1]-hn[2],bn[0]=vn[0]+vn[1],bn[1]=vn[3]+vn[2],bn[2]=vn[3]-vn[2],bn[3]=vn[0]-vn[1],re[dn+0]=bn[0]+_n[0],re[dn+1]=bn[1]+_n[1],re[dn+2]=bn[2]+_n[2],re[dn+3]=bn[3]+_n[3],re[dn+4]=bn[3]-_n[3],re[dn+5]=bn[2]-_n[2],re[dn+6]=bn[1]-_n[1],re[dn+7]=bn[0]-_n[0]}for(let fn=0;fn<8;++fn)hn[0]=ze*re[16+fn],hn[1]=at*re[16+fn],hn[2]=ze*re[48+fn],hn[3]=at*re[48+fn],_n[0]=oe*re[8+fn]+$e*re[24+fn]+Fe*re[40+fn]+Zt*re[56+fn],_n[1]=$e*re[8+fn]-Zt*re[24+fn]-oe*re[40+fn]-Fe*re[56+fn],_n[2]=Fe*re[8+fn]-oe*re[24+fn]+Zt*re[40+fn]+$e*re[56+fn],_n[3]=Zt*re[8+fn]-Fe*re[24+fn]+$e*re[40+fn]-oe*re[56+fn],vn[0]=Pe*(re[fn]+re[32+fn]),vn[3]=Pe*(re[fn]-re[32+fn]),vn[1]=hn[0]+hn[3],vn[2]=hn[1]-hn[2],bn[0]=vn[0]+vn[1],bn[1]=vn[3]+vn[2],bn[2]=vn[3]-vn[2],bn[3]=vn[0]-vn[1],re[0+fn]=bn[0]+_n[0],re[8+fn]=bn[1]+_n[1],re[16+fn]=bn[2]+_n[2],re[24+fn]=bn[3]+_n[3],re[32+fn]=bn[3]-_n[3],re[40+fn]=bn[2]-_n[2],re[48+fn]=bn[1]-_n[1],re[56+fn]=bn[0]-_n[0]}function ge(re){for(let Pe=0;Pe<64;++Pe){const oe=re[0][Pe],ze=re[1][Pe],$e=re[2][Pe];re[0][Pe]=oe+1.5747*$e,re[1][Pe]=oe-.1873*ze-.4682*$e,re[2][Pe]=oe+1.8556*ze}}function de(re,Pe,oe){for(let $e=0;$e<64;++$e)Pe[oe+$e]=f.A5E.toHalfFloat((ze=re[$e])<=1?Math.sign(ze)*Math.pow(Math.abs(ze),2.2):Math.sign(ze)*Math.pow(o,Math.abs(ze)-1));var ze}function xe(re){return new DataView(re.array.buffer,re.offset.value,re.size)}function pe(re){const Pe=re.viewer.buffer.slice(re.offset.value,re.offset.value+re.size),oe=new Uint8Array(X(Pe)),ze=new Uint8Array(oe.length);return V(oe),G(oe,ze),new DataView(ze.buffer)}function ye(re){const Pe=re.array.slice(re.offset.value,re.offset.value+re.size);Tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const oe=Wt(Pe),ze=new Uint8Array(oe.length);return V(oe),G(oe,ze),new DataView(ze.buffer)}function Re(re){const Pe=re.viewer,oe={value:re.offset.value},ze=new Uint16Array(re.width*re.scanlineBlockSize*(re.channels*re.type)),$e=new Uint8Array(8192);let Fe=0;const at=new Array(re.channels);for(let Dn=0;Dn<re.channels;Dn++)at[Dn]={},at[Dn].start=Fe,at[Dn].end=at[Dn].start,at[Dn].nx=re.width,at[Dn].ny=re.lines,at[Dn].size=re.type,Fe+=at[Dn].nx*at[Dn].ny*at[Dn].size;const Zt=Yn(Pe,oe),hn=Yn(Pe,oe);if(hn>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Zt<=hn)for(let Dn=0;Dn<hn-Zt+1;Dn++)$e[Dn+Zt]=Nt(Pe,oe);const _n=new Uint16Array(65536),vn=function(Dn,sn){let Bn=0;for(let Wn=0;Wn<65536;++Wn)(Wn==0||Dn[Wn>>3]&1<<(7&Wn))&&(sn[Bn++]=Wn);const Nn=Bn-1;for(;Bn<65536;)sn[Bn++]=0;return Nn}($e,_n),bn=nt(Pe,oe);z(re.array,Pe,oe,bn,ze,Fe);for(let Dn=0;Dn<re.channels;++Dn){const sn=at[Dn];for(let Bn=0;Bn<at[Dn].size;++Bn)j(ze,sn.start+Bn,sn.nx,sn.size,sn.ny,sn.nx*sn.size,vn)}(function(Dn,sn,Bn){for(let Nn=0;Nn<Bn;++Nn)sn[Nn]=Dn[sn[Nn]]})(_n,ze,Fe);let fn=0;const dn=new Uint8Array(ze.buffer.byteLength);for(let Dn=0;Dn<re.lines;Dn++)for(let sn=0;sn<re.channels;sn++){const Bn=at[sn],Nn=Bn.nx*Bn.size,Wn=new Uint8Array(ze.buffer,2*Bn.end,2*Nn);dn.set(Wn,fn),fn+=2*Nn,Bn.end+=Nn}return new DataView(dn.buffer)}function we(re){const Pe=re.array.slice(re.offset.value,re.offset.value+re.size);Tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const oe=Wt(Pe),ze=re.lines*re.channels*re.width,$e=re.type==1?new Uint16Array(ze):new Uint32Array(ze);let Fe=0,at=0;const Zt=new Array(4);for(let hn=0;hn<re.lines;hn++)for(let _n=0;_n<re.channels;_n++){let vn=0;switch(re.type){case 1:Zt[0]=Fe,Zt[1]=Zt[0]+re.width,Fe=Zt[1]+re.width;for(let bn=0;bn<re.width;++bn)vn+=oe[Zt[0]++]<<8|oe[Zt[1]++],$e[at]=vn,at++;break;case 2:Zt[0]=Fe,Zt[1]=Zt[0]+re.width,Zt[2]=Zt[1]+re.width,Fe=Zt[2]+re.width;for(let bn=0;bn<re.width;++bn)vn+=oe[Zt[0]++]<<24|oe[Zt[1]++]<<16|oe[Zt[2]++]<<8,$e[at]=vn,at++}}return new DataView($e.buffer)}function We(re){const Pe=re.viewer,oe={value:re.offset.value},ze=new Uint8Array(re.width*re.lines*(re.channels*re.type*2)),$e={version:Ut(Pe,oe),unknownUncompressedSize:Ut(Pe,oe),unknownCompressedSize:Ut(Pe,oe),acCompressedSize:Ut(Pe,oe),dcCompressedSize:Ut(Pe,oe),rleCompressedSize:Ut(Pe,oe),rleUncompressedSize:Ut(Pe,oe),rleRawSize:Ut(Pe,oe),totalAcUncompressedCount:Ut(Pe,oe),totalDcUncompressedCount:Ut(Pe,oe),acCompression:Ut(Pe,oe)};if($e.version<2)throw new Error("EXRLoader.parse: "+jt.compression+" version "+$e.version+" is unsupported");const Fe=new Array;let at=Yn(Pe,oe)-2;for(;at>0;){const sn=ot(Pe.buffer,oe),Bn=Nt(Pe,oe),Nn=Bn>>2&3,Wn=new Int8Array([(Bn>>4)-1])[0],yr=Nt(Pe,oe);Fe.push({name:sn,index:Wn,type:yr,compression:Nn}),at-=sn.length+3}const Zt=jt.channels,hn=new Array(re.channels);for(let sn=0;sn<re.channels;++sn){const Bn=hn[sn]={},Nn=Zt[sn];Bn.name=Nn.name,Bn.compression=0,Bn.decoded=!1,Bn.type=Nn.pixelType,Bn.pLinear=Nn.pLinear,Bn.width=re.width,Bn.height=re.lines}const _n={idx:new Array(3)};for(let sn=0;sn<re.channels;++sn){const Bn=hn[sn];for(let Nn=0;Nn<Fe.length;++Nn){const Wn=Fe[Nn];Bn.name==Wn.name&&(Bn.compression=Wn.compression,Wn.index>=0&&(_n.idx[Wn.index]=sn),Bn.offset=sn)}}let vn,bn,fn;if($e.acCompressedSize>0)switch($e.acCompression){case 0:vn=new Uint16Array($e.totalAcUncompressedCount),z(re.array,Pe,oe,$e.acCompressedSize,vn,$e.totalAcUncompressedCount);break;case 1:const sn=Wt(re.array.slice(oe.value,oe.value+$e.totalAcUncompressedCount));vn=new Uint16Array(sn.buffer),oe.value+=$e.totalAcUncompressedCount}if($e.dcCompressedSize>0){const sn={array:re.array,offset:oe,size:$e.dcCompressedSize};bn=new Uint16Array(ye(sn).buffer),oe.value+=$e.dcCompressedSize}$e.rleRawSize>0&&(fn=X(Wt(re.array.slice(oe.value,oe.value+$e.rleCompressedSize)).buffer),oe.value+=$e.rleCompressedSize);let dn=0;const Dn=new Array(hn.length);for(let sn=0;sn<Dn.length;++sn)Dn[sn]=new Array;for(let sn=0;sn<re.lines;++sn)for(let Bn=0;Bn<hn.length;++Bn)Dn[Bn].push(dn),dn+=hn[Bn].width*re.type*2;(function(sn,Bn,Nn,Wn,yr,nr){let kn=new DataView(nr.buffer);const Jn=Nn[sn.idx[0]].width,Ai=Nn[sn.idx[0]].height,zs=Math.floor(Jn/8),Ha=Math.ceil(Jn/8),to=Math.ceil(Ai/8),cd=Jn-8*(Ha-1),ym=Ai-8*(to-1),YI={value:0},E1=new Array(3),L_=new Array(3),N_=new Array(3),hu=new Array(3),cw=new Array(3);for(let kr=0;kr<3;++kr)cw[kr]=Bn[sn.idx[kr]],E1[kr]=kr<1?0:E1[kr-1]+Ha*to,L_[kr]=new Float32Array(64),N_[kr]=new Uint16Array(64),hu[kr]=new Uint16Array(64*Ha);for(let kr=0;kr<to;++kr){let Bv=8;kr==to-1&&(Bv=ym);let kv=8;for(let or=0;or<Ha;++or){or==Ha-1&&(kv=cd);for(let Er=0;Er<3;++Er)N_[Er].fill(0),N_[Er][0]=yr[E1[Er]++],ne(YI,Wn,N_[Er]),Cn=N_[Er],(Sn=L_[Er])[0]=yt(Cn[0]),Sn[1]=yt(Cn[1]),Sn[2]=yt(Cn[5]),Sn[3]=yt(Cn[6]),Sn[4]=yt(Cn[14]),Sn[5]=yt(Cn[15]),Sn[6]=yt(Cn[27]),Sn[7]=yt(Cn[28]),Sn[8]=yt(Cn[2]),Sn[9]=yt(Cn[4]),Sn[10]=yt(Cn[7]),Sn[11]=yt(Cn[13]),Sn[12]=yt(Cn[16]),Sn[13]=yt(Cn[26]),Sn[14]=yt(Cn[29]),Sn[15]=yt(Cn[42]),Sn[16]=yt(Cn[3]),Sn[17]=yt(Cn[8]),Sn[18]=yt(Cn[12]),Sn[19]=yt(Cn[17]),Sn[20]=yt(Cn[25]),Sn[21]=yt(Cn[30]),Sn[22]=yt(Cn[41]),Sn[23]=yt(Cn[43]),Sn[24]=yt(Cn[9]),Sn[25]=yt(Cn[11]),Sn[26]=yt(Cn[18]),Sn[27]=yt(Cn[24]),Sn[28]=yt(Cn[31]),Sn[29]=yt(Cn[40]),Sn[30]=yt(Cn[44]),Sn[31]=yt(Cn[53]),Sn[32]=yt(Cn[10]),Sn[33]=yt(Cn[19]),Sn[34]=yt(Cn[23]),Sn[35]=yt(Cn[32]),Sn[36]=yt(Cn[39]),Sn[37]=yt(Cn[45]),Sn[38]=yt(Cn[52]),Sn[39]=yt(Cn[54]),Sn[40]=yt(Cn[20]),Sn[41]=yt(Cn[22]),Sn[42]=yt(Cn[33]),Sn[43]=yt(Cn[38]),Sn[44]=yt(Cn[46]),Sn[45]=yt(Cn[51]),Sn[46]=yt(Cn[55]),Sn[47]=yt(Cn[60]),Sn[48]=yt(Cn[21]),Sn[49]=yt(Cn[34]),Sn[50]=yt(Cn[37]),Sn[51]=yt(Cn[47]),Sn[52]=yt(Cn[50]),Sn[53]=yt(Cn[56]),Sn[54]=yt(Cn[59]),Sn[55]=yt(Cn[61]),Sn[56]=yt(Cn[35]),Sn[57]=yt(Cn[36]),Sn[58]=yt(Cn[48]),Sn[59]=yt(Cn[49]),Sn[60]=yt(Cn[57]),Sn[61]=yt(Cn[58]),Sn[62]=yt(Cn[62]),Sn[63]=yt(Cn[63]),ce(L_[Er]);ge(L_);for(let Er=0;Er<3;++Er)de(L_[Er],hu[Er],64*or)}let Cl=0;for(let or=0;or<3;++or){const Er=Nn[sn.idx[or]].type;for(let ud=8*kr;ud<8*kr+Bv;++ud){Cl=cw[or][ud];for(let U_=0;U_<zs;++U_){const gh=64*U_+8*(7&ud);kn.setUint16(Cl+0*Er,hu[or][gh+0],!0),kn.setUint16(Cl+2*Er,hu[or][gh+1],!0),kn.setUint16(Cl+4*Er,hu[or][gh+2],!0),kn.setUint16(Cl+6*Er,hu[or][gh+3],!0),kn.setUint16(Cl+8*Er,hu[or][gh+4],!0),kn.setUint16(Cl+10*Er,hu[or][gh+5],!0),kn.setUint16(Cl+12*Er,hu[or][gh+6],!0),kn.setUint16(Cl+14*Er,hu[or][gh+7],!0),Cl+=16*Er}}if(zs!=Ha)for(let ud=8*kr;ud<8*kr+Bv;++ud){const U_=cw[or][ud]+8*zs*2*Er,gh=64*zs+8*(7&ud);for(let uw=0;uw<kv;++uw)kn.setUint16(U_+2*uw*Er,hu[or][gh+uw],!0)}}}var Cn,Sn;const tM=new Uint16Array(Jn);kn=new DataView(nr.buffer);for(let kr=0;kr<3;++kr){Nn[sn.idx[kr]].decoded=!0;const Bv=Nn[sn.idx[kr]].type;if(Nn[kr].type==2)for(let kv=0;kv<Ai;++kv){const Cl=cw[kr][kv];for(let or=0;or<Jn;++or)tM[or]=kn.getUint16(Cl+2*or*Bv,!0);for(let or=0;or<Jn;++or)kn.setFloat32(Cl+2*or*Bv,yt(tM[or]),!0)}}})(_n,Dn,hn,vn,bn,ze);for(let sn=0;sn<hn.length;++sn){const Bn=hn[sn];if(!Bn.decoded){if(Bn.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Nn=0,Wn=0;for(let yr=0;yr<re.lines;++yr){let nr=Dn[sn][Nn];for(let kn=0;kn<Bn.width;++kn){for(let Jn=0;Jn<2*Bn.type;++Jn)ze[nr++]=fn[Wn+Jn*Bn.width*Bn.height];Wn++}Nn++}}}}return new DataView(ze.buffer)}function ot(re,Pe){const oe=new Uint8Array(re);let ze=0;for(;oe[Pe.value+ze]!=0;)ze+=1;const $e=new TextDecoder().decode(oe.slice(Pe.value,Pe.value+ze));return Pe.value=Pe.value+ze+1,$e}function ft(re,Pe){const oe=re.getInt32(Pe.value,!0);return Pe.value=Pe.value+4,oe}function nt(re,Pe){const oe=re.getUint32(Pe.value,!0);return Pe.value=Pe.value+4,oe}function Rt(re,Pe){const oe=re[Pe.value];return Pe.value=Pe.value+1,oe}function Nt(re,Pe){const oe=re.getUint8(Pe.value);return Pe.value=Pe.value+1,oe}const Ut=function(re,Pe){const oe=Number(re.getBigInt64(Pe.value,!0));return Pe.value+=8,oe};function Ht(re,Pe){const oe=re.getFloat32(Pe.value,!0);return Pe.value+=4,oe}function yn(re,Pe){return f.A5E.toHalfFloat(Ht(re,Pe))}function yt(re){const Pe=(31744&re)>>10,oe=1023&re;return(re>>15?-1:1)*(Pe?Pe===31?oe?NaN:1/0:Math.pow(2,Pe-15)*(1+oe/1024):oe/1024*6103515625e-14)}function Yn(re,Pe){const oe=re.getUint16(Pe.value,!0);return Pe.value+=2,oe}function ai(re,Pe){return yt(Yn(re,Pe))}function Xn(re,Pe,oe,ze,$e){return ze==="string"||ze==="stringvector"||ze==="iccProfile"?function(Fe,at,Zt){const hn=new TextDecoder().decode(new Uint8Array(Fe).slice(at.value,at.value+Zt));return at.value=at.value+Zt,hn}(Pe,oe,$e):ze==="chlist"?function(Fe,at,Zt,hn){const _n=Zt.value,vn=[];for(;Zt.value<_n+hn-1;){const bn=ot(at,Zt),fn=ft(Fe,Zt),dn=Nt(Fe,Zt);Zt.value+=3;const Dn=ft(Fe,Zt),sn=ft(Fe,Zt);vn.push({name:bn,pixelType:fn,pLinear:dn,xSampling:Dn,ySampling:sn})}return Zt.value+=1,vn}(re,Pe,oe,$e):ze==="chromaticities"?function(Fe,at){return{redX:Ht(Fe,at),redY:Ht(Fe,at),greenX:Ht(Fe,at),greenY:Ht(Fe,at),blueX:Ht(Fe,at),blueY:Ht(Fe,at),whiteX:Ht(Fe,at),whiteY:Ht(Fe,at)}}(re,oe):ze==="compression"?function(Fe,at){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Nt(Fe,at)]}(re,oe):ze==="box2i"?function(Fe,at){return{xMin:nt(Fe,at),yMin:nt(Fe,at),xMax:nt(Fe,at),yMax:nt(Fe,at)}}(re,oe):ze==="lineOrder"?function(Fe,at){return["INCREASING_Y"][Nt(Fe,at)]}(re,oe):ze==="float"?Ht(re,oe):ze==="v2f"?function(Fe,at){return[Ht(Fe,at),Ht(Fe,at)]}(re,oe):ze==="v3f"?function(Fe,at){return[Ht(Fe,at),Ht(Fe,at),Ht(Fe,at)]}(re,oe):ze==="int"?ft(re,oe):ze==="rational"?function(Fe,at){return[ft(Fe,at),nt(Fe,at)]}(re,oe):ze==="timecode"?function(Fe,at){return[nt(Fe,at),nt(Fe,at)]}(re,oe):ze==="preview"?(oe.value+=$e,"skipped"):void(oe.value+=$e)}const Ci=new DataView(e),zi=new Uint8Array(e),lt={value:0},jt=function(re,Pe,oe){const ze={};if(re.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");ze.version=re.getUint8(4);const $e=re.getUint8(5);ze.spec={singleTile:!!(2&$e),longName:!!(4&$e),deepFormat:!!(8&$e),multiPart:!!(16&$e)},oe.value=8;let Fe=!0;for(;Fe;){const at=ot(Pe,oe);if(at==0)Fe=!1;else{const Zt=ot(Pe,oe),hn=Xn(re,Pe,oe,Zt,nt(re,oe));hn===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Zt}'.`):ze[at]=hn}}if(-5&$e)throw console.error("EXRHeader:",ze),new Error("THREE.EXRLoader: provided file is currently unsupported.");return ze}(Ci,e,lt),zt=function(re,Pe,oe,ze,$e){const Fe={size:0,viewer:Pe,array:oe,offset:ze,width:re.dataWindow.xMax-re.dataWindow.xMin+1,height:re.dataWindow.yMax-re.dataWindow.yMin+1,channels:re.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:re.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(re.compression){case"NO_COMPRESSION":Fe.lines=1,Fe.uncompress=xe;break;case"RLE_COMPRESSION":Fe.lines=1,Fe.uncompress=pe;break;case"ZIPS_COMPRESSION":Fe.lines=1,Fe.uncompress=ye;break;case"ZIP_COMPRESSION":Fe.lines=16,Fe.uncompress=ye;break;case"PIZ_COMPRESSION":Fe.lines=32,Fe.uncompress=Re;break;case"PXR24_COMPRESSION":Fe.lines=16,Fe.uncompress=we;break;case"DWAA_COMPRESSION":Fe.lines=32,Fe.uncompress=We;break;case"DWAB_COMPRESSION":Fe.lines=256,Fe.uncompress=We;break;default:throw new Error("EXRLoader.parse: "+re.compression+" is unsupported")}if(Fe.scanlineBlockSize=Fe.lines,Fe.type==1)switch($e){case f.VzW:Fe.getter=ai,Fe.inputSize=2;break;case f.cLu:Fe.getter=Yn,Fe.inputSize=2}else{if(Fe.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Fe.type+" for "+re.compression+".");switch($e){case f.VzW:Fe.getter=Ht,Fe.inputSize=4;break;case f.cLu:Fe.getter=yn,Fe.inputSize=4}}Fe.blockCount=(re.dataWindow.yMax+1)/Fe.scanlineBlockSize;for(let Zt=0;Zt<Fe.blockCount;Zt++)Ut(Pe,ze);Fe.outputChannels=Fe.channels==3?4:Fe.channels;const at=Fe.width*Fe.height*Fe.outputChannels;switch($e){case f.VzW:Fe.byteArray=new Float32Array(at),Fe.channels<Fe.outputChannels&&Fe.byteArray.fill(1,0,at);break;case f.cLu:Fe.byteArray=new Uint16Array(at),Fe.channels<Fe.outputChannels&&Fe.byteArray.fill(15360,0,at);break;default:console.error("THREE.EXRLoader: unsupported type: ",$e)}return Fe.bytesPerLine=Fe.width*Fe.inputSize*Fe.channels,Fe.outputChannels==4?(Fe.format=f.wk1,Fe.encoding=f.rnI):(Fe.format=f.hEm,Fe.encoding=f.rnI),Fe}(jt,Ci,zi,lt,this.type),Kn={value:0},Fi={R:0,G:1,B:2,A:3,Y:0};for(let re=0;re<zt.height/zt.scanlineBlockSize;re++){const Pe=nt(Ci,lt);zt.size=nt(Ci,lt),zt.lines=Pe+zt.scanlineBlockSize>zt.height?zt.height-Pe:zt.scanlineBlockSize;const oe=zt.size<zt.lines*zt.bytesPerLine?zt.uncompress(zt):xe(zt);lt.value+=zt.size;for(let ze=0;ze<zt.scanlineBlockSize;ze++){const $e=ze+re*zt.scanlineBlockSize;if($e>=zt.height)break;for(let Fe=0;Fe<zt.channels;Fe++){const at=Fi[jt.channels[Fe].name];for(let Zt=0;Zt<zt.width;Zt++){Kn.value=(ze*(zt.channels*zt.width)+Fe*zt.width+Zt)*zt.inputSize;const hn=(zt.height-1-$e)*(zt.width*zt.outputChannels)+Zt*zt.outputChannels+at;zt.byteArray[hn]=zt.getter(oe,Kn)}}}}return{header:jt,width:zt.width,height:zt.height,data:zt.byteArray,format:zt.format,encoding:zt.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(o,a){o.encoding=a.encoding,o.minFilter=f.wem,o.magFilter=f.wem,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)},n,r)}}class po extends ct{constructor(){super(...arguments),this.dependencies=[ln]}async onAdded(e){this._importer||(this._importer=new dr(class extends vy{constructor(t){super(t),this.setDataType(Lm(e.renderer.rendererObject))}},["exr"],!1)),si.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&si.Importers.splice(si.Importers.indexOf(this._importer),1),this._importer=void 0}}function J0(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let r=s,o=n,a=Math.floor((r+o)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function _y(s,e){let t=1;for(let r=2;r<=s;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=s-e;++r)n*=r;return t/n}po.PluginType="EXRLoadPlugin";class Z0 extends f.Hyl{constructor(e,t,n,r,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<n.length;++a){const c=n[a];this.controlPoints[a]=new f.Ltg(c.x,c.y,c.z,c.w)}}getPoint(e,t=new f.Pa4){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=function(a,c,d,p){const m=J0(a,p,c),A=function(E,M,T,O){const P=[],R=[],I=[];P[0]=1;for(let j=1;j<=T;++j){R[j]=M-O[E+1-j],I[j]=O[E+j]-M;let z=0;for(let V=0;V<j;++V){const G=I[V+1],X=R[j-V],ne=P[V]/(G+X);P[V]=z+G*ne,z=X*ne}P[j]=z}return P}(m,p,a,c),x=new f.Ltg(0,0,0,0);for(let E=0;E<=a;++E){const M=d[m-a+E],T=A[E],O=M.w*T;x.x+=M.x*O,x.y+=M.y*O,x.z+=M.z*O,x.w+=M.w*T}return x}(this.degree,this.knots,this.controlPoints,r);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,t=new f.Pa4){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=function(a,c,d,p,m){const A=function(x,E,M,T,O){const P=O<x?O:x,R=[],I=J0(x,T,E),j=function(V,G,X,ne,ce){const ge=[];for(let we=0;we<=X;++we)ge[we]=0;const de=[];for(let we=0;we<=ne;++we)de[we]=ge.slice(0);const xe=[];for(let we=0;we<=X;++we)xe[we]=ge.slice(0);xe[0][0]=1;const pe=ge.slice(0),ye=ge.slice(0);for(let we=1;we<=X;++we){pe[we]=G-ce[V+1-we],ye[we]=ce[V+we]-G;let We=0;for(let ot=0;ot<we;++ot){const ft=ye[ot+1],nt=pe[we-ot];xe[we][ot]=ft+nt;const Rt=xe[ot][we-1]/xe[we][ot];xe[ot][we]=We+ft*Rt,We=nt*Rt}xe[we][we]=We}for(let we=0;we<=X;++we)de[0][we]=xe[we][X];for(let we=0;we<=X;++we){let We=0,ot=1;const ft=[];for(let nt=0;nt<=X;++nt)ft[nt]=ge.slice(0);ft[0][0]=1;for(let nt=1;nt<=ne;++nt){let Rt=0;const Nt=we-nt,Ut=X-nt;we>=nt&&(ft[ot][0]=ft[We][0]/xe[Ut+1][Nt],Rt=ft[ot][0]*xe[Nt][Ut]);const Ht=we-1<=Ut?nt-1:X-we;for(let yt=Nt>=-1?1:-Nt;yt<=Ht;++yt)ft[ot][yt]=(ft[We][yt]-ft[We][yt-1])/xe[Ut+1][Nt+yt],Rt+=ft[ot][yt]*xe[Nt+yt][Ut];we<=Ut&&(ft[ot][nt]=-ft[We][nt-1]/xe[Ut+1][we],Rt+=ft[ot][nt]*xe[we][Ut]),de[nt][we]=Rt;const yn=We;We=ot,ot=yn}}let Re=X;for(let we=1;we<=ne;++we){for(let We=0;We<=X;++We)de[we][We]*=Re;Re*=X-we}return de}(I,T,x,P,E),z=[];for(let V=0;V<M.length;++V){const G=M[V].clone(),X=G.w;G.x*=X,G.y*=X,G.z*=X,z[V]=G}for(let V=0;V<=P;++V){const G=z[I-x].clone().multiplyScalar(j[V][0]);for(let X=1;X<=x;++X)G.add(z[I-x+X].clone().multiplyScalar(j[V][X]));R[V]=G}for(let V=P+1;V<=O+1;++V)R[V]=new f.Ltg(0,0,0);return R}(a,c,d,p,m);return function(x){const E=x.length,M=[],T=[];for(let P=0;P<E;++P){const R=x[P];M[P]=new f.Pa4(R.x,R.y,R.z),T[P]=R.w}const O=[];for(let P=0;P<E;++P){const R=M[P].clone();for(let I=1;I<=P;++I)R.sub(O[P-I].clone().multiplyScalar(_y(P,I)*T[I]));O[P]=R.divideScalar(T[0])}return O}(A)}(this.degree,this.knots,this.controlPoints,r,1);return n.copy(o[1]).normalize(),n}}let _i,Rr,fo;class Ay extends f.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=o.path===""?f.Zp0.extractUrlBase(e):o.path,c=new f.hH6(this.manager);c.setPath(o.path),c.setResponseType("arraybuffer"),c.setRequestHeader(o.requestHeader),c.setWithCredentials(o.withCredentials),c.load(e,function(d){try{t(o.parse(d,a))}catch(p){r?r(p):console.error(p),o.manager.itemError(e)}},n,r)}parse(e,t){if(function(r){const o="Kaydara FBX Binary  \0";return r.byteLength>=o.length&&o===Ar(r,0,o.length)}(e))_i=new Mw().parse(e);else{const r=Ar(e);if(!function(o){const a=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let c=0;function d(p){const m=o[p-1];return o=o.slice(c+p),c++,m}for(let p=0;p<a.length;++p)if(d(1)===a[p])return!1;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(be(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+be(r));_i=new qg().parse(r)}const n=new f.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Jh(n,this.manager).parse(_i)}}class Jh{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Rr=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),o=new yy().parse(r);return this.parseScene(r,o,n),fo}parseConnections(){const e=new Map;return"Connections"in _i&&_i.Connections.connections.forEach(function(t){const n=t[0],r=t[1],o=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const c={ID:n,relationship:o};e.get(r).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in _i.Objects){const n=_i.Objects.Video;for(const r in n){const o=n[r];if(e[parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){const a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(a||c){const d=this.parseImage(n[r]);t[o.RelativeFilename||o.Filename]=d}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if(typeof t=="string")return"data:"+o+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in _i.Objects){const n=_i.Objects.Texture;for(const r in n){const o=this.parseTexture(n[r],e);t.set(parseInt(r),o)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,o=e.WrapModeV,a=r!==void 0?r.value:0,c=o!==void 0?o.value:0;if(n.wrapS=a===0?f.rpg:f.uWy,n.wrapT=c===0?f.rpg:f.uWy,"Scaling"in e){const d=e.Scaling.value;n.repeat.x=d[0],n.repeat.y=d[1]}if("Translation"in e){const d=e.Translation.value;n.offset.x=d[0],n.offset.y=d[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,o=Rr.get(e.id).children;let a;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const c=e.FileName.slice(-3).toLowerCase();if(c==="tga"){const d=this.manager.getHandler(".tga");d===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new f.xEZ):(d.setPath(this.textureLoader.path),a=d.load(n))}else c==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new f.xEZ):a=this.textureLoader.load(n);return this.textureLoader.setPath(r),a}parseMaterials(e){const t=new Map;if("Material"in _i.Objects){const n=_i.Objects.Material;for(const r in n){const o=this.parseMaterial(n[r],e);o!==null&&t.set(parseInt(r),o)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!Rr.has(n))return null;const a=this.parseParameters(e,t,n);let c;switch(o.toLowerCase()){case"phong":c=new f.xoR;break;case"lambert":c=new f.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),c=new f.xoR}return c.setValues(a),c.name=r,c}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new f.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(r.color=new f.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new f.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(r.emissive=new f.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new f.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new f.Ilk().fromArray(e.SpecularColor.value));const o=this;return Rr.get(n).children.forEach(function(a){const c=a.relationship;switch(c){case"Bump":r.bumpMap=o.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(t,a.ID),r.map!==void 0&&(r.map.encoding=f.knz);break;case"DisplacementColor":r.displacementMap=o.getTexture(t,a.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(t,a.ID),r.emissiveMap!==void 0&&(r.emissiveMap.encoding=f.knz);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(t,a.ID);break;case"ReflectionColor":r.envMap=o.getTexture(t,a.ID),r.envMap!==void 0&&(r.envMap.mapping=f.dSO,r.envMap.encoding=f.knz);break;case"SpecularColor":r.specularMap=o.getTexture(t,a.ID),r.specularMap!==void 0&&(r.specularMap.encoding=f.knz);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(t,a.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",c)}}),r}getTexture(e,t){return"LayeredTexture"in _i.Objects&&t in _i.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Rr.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in _i.Objects){const n=_i.Objects.Deformer;for(const r in n){const o=n[r],a=Rr.get(parseInt(r));if(o.attrType==="Skin"){const c=this.parseSkeleton(a,n);c.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=a.parents[0].ID,e[r]=c}else if(o.attrType==="BlendShape"){const c={id:r};c.rawTargets=this.parseMorphTargets(a,n),c.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=c}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const o=t[r.ID];if(o.attrType!=="Cluster")return;const a={ID:r.ID,indices:[],weights:[],transformLink:new f.yGw().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const o=e.children[r],a=t[o.ID],c={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;c.geoID=Rr.get(parseInt(o.ID)).children.filter(function(d){return d.relationship===void 0})[0].ID,n.push(c)}return n}parseScene(e,t,n){fo=new f.ZAu;const r=this.parseModels(e.skeletons,t,n),o=_i.Objects.Model,a=this;r.forEach(function(d){const p=o[d.ID];a.setLookAtProperties(d,p),Rr.get(d.ID).parents.forEach(function(m){const A=r.get(m.ID);A!==void 0&&A.add(d)}),d.parent===null&&fo.add(d)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),fo.traverse(function(d){if(d.userData.transformData){d.parent&&(d.userData.transformData.parentMatrix=d.parent.matrix,d.userData.transformData.parentMatrixWorld=d.parent.matrixWorld);const p=xi(d.userData.transformData);d.applyMatrix4(p),d.updateWorldMatrix()}});const c=new by().parse();fo.children.length===1&&fo.children[0].isGroup&&(fo.children[0].animations=c,fo=fo.children[0]),fo.animations=c}parseModels(e,t,n){const r=new Map,o=_i.Objects.Model;for(const a in o){const c=parseInt(a),d=o[a],p=Rr.get(c);let m=this.buildSkeleton(p,e,c,d.attrName);if(!m){switch(d.attrType){case"Camera":m=this.createCamera(p);break;case"Light":m=this.createLight(p);break;case"Mesh":m=this.createMesh(p,t,n);break;case"NurbsCurve":m=this.createCurve(p,t);break;case"LimbNode":case"Root":m=new f.N$j;break;default:m=new f.ZAu}m.name=d.attrName?f.iUV.sanitizeNodeName(d.attrName):"",m.ID=c}this.getTransformData(m,d),r.set(c,m)}return r}buildSkeleton(e,t,n,r){let o=null;return e.parents.forEach(function(a){for(const c in t){const d=t[c];d.rawBones.forEach(function(p,m){if(p.ID===a.ID){const A=o;o=new f.N$j,o.matrixWorld.copy(p.transformLink),o.name=r?f.iUV.sanitizeNodeName(r):"",o.ID=n,d.bones[m]=o,A!==null&&o.add(A)}})}}),o}createCamera(e){let t,n;if(e.children.forEach(function(r){const o=_i.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new f.Tme;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let c=window.innerWidth,d=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(c=n.AspectWidth.value,d=n.AspectHeight.value);const p=c/d;let m=45;n.FieldOfView!==void 0&&(m=n.FieldOfView.value);const A=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new f.cPb(m,p,o,a),A!==null&&t.setFocalLength(A);break;case 1:t=new f.iKG(-c/2,c/2,d/2,-d/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new f.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const o=_i.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new f.Tme;else{n.LightType===void 0||n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new f.Ilk().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(a=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const c=1;switch(e){case 0:t=new f.cek(r,o,a,c);break;case 1:t=new f.Ox3(r,o);break;case 2:let d=Math.PI/3;n.InnerAngle!==void 0&&(d=f.M8C.degToRad(n.InnerAngle.value));let p=0;n.OuterAngle!==void 0&&(p=f.M8C.degToRad(n.OuterAngle.value),p=Math.max(p,1)),t=new f.PMe(r,o,a,d,p,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new f.cek(r,o)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,o=null,a=null;const c=[];return e.children.forEach(function(d){t.has(d.ID)&&(o=t.get(d.ID)),n.has(d.ID)&&c.push(n.get(d.ID))}),c.length>1?a=c:c.length>0?a=c[0]:(a=new f.xoR({color:13421772}),c.push(a)),"color"in o.attributes&&c.forEach(function(d){d.vertexColors=!0}),o.FBX_Deformer?(r=new f.TUv(o,a),r.normalizeSkinWeights()):r=new f.Kj0(o,a),r}createCurve(e,t){const n=e.children.reduce(function(o,a){return t.has(a.ID)&&(o=t.get(a.ID)),o},null),r=new f.nls({color:3342591,linewidth:1});return new f.x12(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Fn(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Rr.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const r=_i.Objects.Model[n.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),fo.add(e.target)):e.lookAt(new f.Pa4().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const o in e){const a=e[o];Rr.get(parseInt(a.ID)).parents.forEach(function(c){if(t.has(c.ID)){const d=c.ID;Rr.get(d).parents.forEach(function(p){n.has(p.ID)&&n.get(p.ID).bind(new f.OdW(a.bones),r[p.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in _i.Objects){const t=_i.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(o){e[o.Node]=new f.yGw().fromArray(o.Matrix.a)}):e[r.Node]=new f.yGw().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in _i&&"AmbientColor"in _i.GlobalSettings){const e=_i.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const o=new f.Ilk(t,n,r);fo.add(new f.Mig(o,1))}}}}class yy{parse(e){const t=new Map;if("Geometry"in _i.Objects){const n=_i.Objects.Geometry;for(const r in n){const o=Rr.get(parseInt(r)),a=this.parseGeometry(o,n[r],e);t.set(parseInt(r),a)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,o=[],a=e.parents.map(function(A){return _i.Objects.Model[A.ID]});if(a.length===0)return;const c=e.children.reduce(function(A,x){return r[x.ID]!==void 0&&(A=r[x.ID]),A},null);e.children.forEach(function(A){n.morphTargets[A.ID]!==void 0&&o.push(n.morphTargets[A.ID])});const d=a[0],p={};"RotationOrder"in d&&(p.eulerOrder=Fn(d.RotationOrder.value)),"InheritType"in d&&(p.inheritType=parseInt(d.InheritType.value)),"GeometricTranslation"in d&&(p.translation=d.GeometricTranslation.value),"GeometricRotation"in d&&(p.rotation=d.GeometricRotation.value),"GeometricScaling"in d&&(p.scale=d.GeometricScaling.value);const m=xi(p);return this.genGeometry(t,c,o,m)}genGeometry(e,t,n,r){const o=new f.u9r;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,t),c=this.genBuffers(a),d=new f.a$l(c.vertex,3);if(d.applyMatrix4(r),o.setAttribute("position",d),c.colors.length>0&&o.setAttribute("color",new f.a$l(c.colors,3)),t&&(o.setAttribute("skinIndex",new f.qlB(c.weightsIndices,4)),o.setAttribute("skinWeight",new f.a$l(c.vertexWeights,4)),o.FBX_Deformer=t),c.normal.length>0){const p=new f.Vkp().getNormalMatrix(r),m=new f.a$l(c.normal,3);m.applyNormalMatrix(p),o.setAttribute("normal",m)}if(c.uvs.forEach(function(p,m){let A="uv"+(m+1).toString();m===0&&(A="uv"),o.setAttribute(A,new f.a$l(c.uvs[m],2))}),a.material&&a.material.mappingType!=="AllSame"){let p=c.materialIndex[0],m=0;if(c.materialIndex.forEach(function(A,x){A!==p&&(o.addGroup(m,x-m,p),p=A,m=x)}),o.groups.length>0){const A=o.groups[o.groups.length-1],x=A.start+A.count;x!==c.materialIndex.length&&o.addGroup(x,c.materialIndex.length-x,p)}o.groups.length===0&&o.addGroup(0,c.materialIndex.length,c.materialIndex[0])}return this.addMorphTargets(o,e,n,r),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,o){r.indices.forEach(function(a,c){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:o,weight:r.weights[c]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,o=!1,a=[],c=[],d=[],p=[],m=[],A=[];const x=this;return e.vertexIndices.forEach(function(E,M){let T,O=!1;E<0&&(E^=-1,O=!0);let P=[],R=[];if(a.push(3*E,3*E+1,3*E+2),e.color){const I=Dt(M,n,E,e.color);d.push(I[0],I[1],I[2])}if(e.skeleton){if(e.weightTable[E]!==void 0&&e.weightTable[E].forEach(function(I){R.push(I.weight),P.push(I.id)}),R.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const I=[0,0,0,0],j=[0,0,0,0];R.forEach(function(z,V){let G=z,X=P[V];j.forEach(function(ne,ce,ge){if(G>ne){ge[ce]=G,G=ne;const de=I[ce];I[ce]=X,X=de}})}),P=I,R=j}for(;R.length<4;)R.push(0),P.push(0);for(let I=0;I<4;++I)m.push(R[I]),A.push(P[I])}if(e.normal){const I=Dt(M,n,E,e.normal);c.push(I[0],I[1],I[2])}e.material&&e.material.mappingType!=="AllSame"&&(T=Dt(M,n,E,e.material)[0],T<0&&(console.warn("THREE.FBXLoader: Invalid material index:",T),T=0)),e.uv&&e.uv.forEach(function(I,j){const z=Dt(M,n,E,I);p[j]===void 0&&(p[j]=[]),p[j].push(z[0]),p[j].push(z[1])}),r++,O&&(x.genFace(t,e,a,T,c,d,p,m,A,r),n++,r=0,a=[],c=[],d=[],p=[],m=[],A=[])}),t}genFace(e,t,n,r,o,a,c,d,p,m){for(let A=2;A<m;A++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(A-1)]]),e.vertex.push(t.vertexPositions[n[3*(A-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(A-1)+2]]),e.vertex.push(t.vertexPositions[n[3*A]]),e.vertex.push(t.vertexPositions[n[3*A+1]]),e.vertex.push(t.vertexPositions[n[3*A+2]]),t.skeleton&&(e.vertexWeights.push(d[0]),e.vertexWeights.push(d[1]),e.vertexWeights.push(d[2]),e.vertexWeights.push(d[3]),e.vertexWeights.push(d[4*(A-1)]),e.vertexWeights.push(d[4*(A-1)+1]),e.vertexWeights.push(d[4*(A-1)+2]),e.vertexWeights.push(d[4*(A-1)+3]),e.vertexWeights.push(d[4*A]),e.vertexWeights.push(d[4*A+1]),e.vertexWeights.push(d[4*A+2]),e.vertexWeights.push(d[4*A+3]),e.weightsIndices.push(p[0]),e.weightsIndices.push(p[1]),e.weightsIndices.push(p[2]),e.weightsIndices.push(p[3]),e.weightsIndices.push(p[4*(A-1)]),e.weightsIndices.push(p[4*(A-1)+1]),e.weightsIndices.push(p[4*(A-1)+2]),e.weightsIndices.push(p[4*(A-1)+3]),e.weightsIndices.push(p[4*A]),e.weightsIndices.push(p[4*A+1]),e.weightsIndices.push(p[4*A+2]),e.weightsIndices.push(p[4*A+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(A-1)]),e.colors.push(a[3*(A-1)+1]),e.colors.push(a[3*(A-1)+2]),e.colors.push(a[3*A]),e.colors.push(a[3*A+1]),e.colors.push(a[3*A+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(A-1)]),e.normal.push(o[3*(A-1)+1]),e.normal.push(o[3*(A-1)+2]),e.normal.push(o[3*A]),e.normal.push(o[3*A+1]),e.normal.push(o[3*A+2])),t.uv&&t.uv.forEach(function(x,E){e.uvs[E]===void 0&&(e.uvs[E]=[]),e.uvs[E].push(c[E][0]),e.uvs[E].push(c[E][1]),e.uvs[E].push(c[E][2*(A-1)]),e.uvs[E].push(c[E][2*(A-1)+1]),e.uvs[E].push(c[E][2*A]),e.uvs[E].push(c[E][2*A+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(a){a.rawTargets.forEach(function(c){const d=_i.Objects.Geometry[c.geoID];d!==void 0&&o.genMorphGeometry(e,t,d,r,c.name)})})}genMorphGeometry(e,t,n,r,o){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],c=n.Vertices!==void 0?n.Vertices.a:[],d=n.Indexes!==void 0?n.Indexes.a:[],p=3*e.attributes.position.count,m=new Float32Array(p);for(let M=0;M<d.length;M++){const T=3*d[M];m[T]=c[3*M],m[T+1]=c[3*M+1],m[T+2]=c[3*M+2]}const A={vertexIndices:a,vertexPositions:m},x=this.genBuffers(A),E=new f.a$l(x.vertex,3);E.name=o||n.attrName,E.applyMatrix4(r),e.morphAttributes.position.push(E)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let o=[];return n==="IndexToDirect"&&(o=e.ColorIndex.a),{dataSize:4,buffer:r,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,o=[];for(let a=0;a<r.length;++a)o.push(a);return{dataSize:1,buffer:r,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Z0===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new f.u9r;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new f.u9r;const n=t-1,r=e.KnotVector.a,o=[],a=e.Points.a;for(let m=0,A=a.length;m<A;m+=4)o.push(new f.Ltg().fromArray(a,m));let c,d;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){c=n,d=r.length-1-c;for(let m=0;m<n;++m)o.push(o[m])}const p=new Z0(n,r,o,c,d).getPoints(12*o.length);return new f.u9r().setFromPoints(p)}}class by{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],o=this.addClip(r);e.push(o)}return e}parseClips(){if(_i.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=_i.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:r.id,attr:r.attrName,curves:{}};t.set(o.id,o)}}return t}parseAnimationCurves(e){const t=_i.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(bt),values:t[n].KeyValueFloat.a},o=Rr.get(r.id);if(o!==void 0){const a=o.parents[0].ID,c=o.parents[0].relationship;c.match(/X/)?e.get(a).curves.x=r:c.match(/Y/)?e.get(a).curves.y=r:c.match(/Z/)?e.get(a).curves.z=r:c.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}}parseAnimationLayers(e){const t=_i.Objects.AnimationLayer,n=new Map;for(const r in t){const o=[],a=Rr.get(parseInt(r));a!==void 0&&(a.children.forEach(function(c,d){if(e.has(c.ID)){const p=e.get(c.ID);if(p.curves.x!==void 0||p.curves.y!==void 0||p.curves.z!==void 0){if(o[d]===void 0){const m=Rr.get(c.ID).parents.filter(function(A){return A.relationship!==void 0})[0].ID;if(m!==void 0){const A=_i.Objects.Model[m.toString()];if(A===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",c);const x={modelName:A.attrName?f.iUV.sanitizeNodeName(A.attrName):"",ID:A.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};fo.traverse(function(E){E.ID===A.id&&(x.transform=E.matrix,E.userData.transformData&&(x.eulerOrder=E.userData.transformData.eulerOrder))}),x.transform||(x.transform=new f.yGw),"PreRotation"in A&&(x.preRotation=A.PreRotation.value),"PostRotation"in A&&(x.postRotation=A.PostRotation.value),o[d]=x}}o[d]&&(o[d][p.attr]=p)}else if(p.curves.morph!==void 0){if(o[d]===void 0){const m=Rr.get(c.ID).parents.filter(function(O){return O.relationship!==void 0})[0].ID,A=Rr.get(m).parents[0].ID,x=Rr.get(A).parents[0].ID,E=Rr.get(x).parents[0].ID,M=_i.Objects.Model[E],T={modelName:M.attrName?f.iUV.sanitizeNodeName(M.attrName):"",morphName:_i.Objects.Deformer[m].attrName};o[d]=T}o[d][p.attr]=p}}}),n.set(parseInt(r),o))}return n}parseAnimStacks(e){const t=_i.Objects.AnimationStack,n={};for(const r in t){const o=Rr.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);n[r]={name:t[r].attrName,layer:a}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new f.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new f.Pa4,r=new f._fP,o=new f.Pa4;if(e.transform&&e.transform.decompose(n,r,o),n=n.toArray(),r=new f.USm().setFromQuaternion(r,e.eulerOrder).toArray(),o=o.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,n,r){const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,n);return new f.yC1(e+"."+r,o,a)}generateRotationTrack(e,t,n,r,o,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(f.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(f.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(f.M8C.degToRad));const c=this.getTimesForAllAxes(t),d=this.getKeyframeTrackValues(c,t,n);r!==void 0&&((r=r.map(f.M8C.degToRad)).push(a),r=new f.USm().fromArray(r),r=new f._fP().setFromEuler(r)),o!==void 0&&((o=o.map(f.M8C.degToRad)).push(a),o=new f.USm().fromArray(o),o=new f._fP().setFromEuler(o).invert());const p=new f._fP,m=new f.USm,A=[];for(let x=0;x<d.length;x+=3)m.set(d[x],d[x+1],d[x+2],a),p.setFromEuler(m),r!==void 0&&p.premultiply(r),o!==void 0&&p.multiply(o),p.toArray(A,x/3*4);return new f.iLg(e+".quaternion",c,A)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(o){return o/100}),r=fo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new f.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let o=1;o<t.length;o++){const a=t[o];a!==r&&(t[n]=a,r=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,o=[];let a=-1,c=-1,d=-1;return e.forEach(function(p){if(t.x&&(a=t.x.times.indexOf(p)),t.y&&(c=t.y.times.indexOf(p)),t.z&&(d=t.z.times.indexOf(p)),a!==-1){const m=t.x.values[a];o.push(m),r[0]=m}else o.push(r[0]);if(c!==-1){const m=t.y.values[c];o.push(m),r[1]=m}else o.push(r[1]);if(d!==-1){const m=t.z.values[d];o.push(m),r[2]=m}else o.push(r[2])}),o}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,o=Math.abs(r);if(o>=180){const a=o/180,c=r/a;let d=n+c;const p=e.times[t-1],m=(e.times[t]-p)/a;let A=p+m;const x=[],E=[];for(;A<e.times[t];)x.push(A),A+=m,E.push(d),d+=c;e.times=Ei(e.times,t,x),e.values=Ei(e.values,t,E)}}}}class qg{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new $0,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,o){const a=r.match(/^[\s\t]*;/),c=r.match(/^[\s\t]*$/);if(a||c)return;const d=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),p=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),m=r.match("^\\t{"+(t.currentIndent-1)+"}}");d?t.parseNodeBegin(r,d):p?t.parseNodeProperty(r,p,n[++o]):m?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(d){return d.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},a=this.parseNodeAttr(r),c=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in c?(n==="PoseNode"?c.PoseNode.push(o):c[n].id!==void 0&&(c[n]={},c[n][c[n].id]=c[n]),a.id!==""&&(c[n][a.id]=o)):typeof a.id=="number"?(c[n]={},c[n][a.id]=o):n!=="Properties70"&&(c[n]=n==="PoseNode"?[o]:o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name!=="Properties70"){if(r==="C"){const c=o.split(",").slice(1),d=parseInt(c[0]),p=parseInt(c[1]);let m=o.split(",").slice(3);m=m.map(function(A){return A.trim().replace(/^"/,"")}),r="connections",o=[d,p],function(A,x){for(let E=0,M=A.length,T=x.length;E<T;E++,M++)A[M]=x[E]}(o,m),a[r]===void 0&&(a[r]=[])}r==="Node"&&(a.id=o),r in a&&Array.isArray(a[r])?a[r].push(o):r!=="a"?a[r]=o:a.a=o,this.setCurrentProp(a,r),r==="a"&&o.slice(-1)!==","&&(a.a=di(o))}else this.parseNodeSpecialProperty(e,r,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=di(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(m){return m.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=r[0],a=r[1],c=r[2],d=r[3];let p=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":p=parseFloat(p);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":p=di(p)}this.getPrevNode()[o]={type:a,type2:c,flag:d,value:p},this.setCurrentProp(this.getPrevNode(),o)}}class Mw{parse(e){const t=new Hf(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new $0;for(;!this.endOfContent(t);){const o=this.parseNode(t,n);o!==null&&r.add(o.name,o)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),c=e.getString(a);if(r===0)return null;const d=[];for(let x=0;x<o;x++)d.push(this.parseProperty(e));const p=d.length>0?d[0]:"",m=d.length>1?d[1]:"",A=d.length>2?d[2]:"";for(n.singleProperty=o===1&&e.getOffset()===r;r>e.getOffset();){const x=this.parseNode(e,t);x!==null&&this.parseSubNode(c,n,x)}return n.propertyList=d,typeof p=="number"&&(n.id=p),m!==""&&(n.attrName=m),A!==""&&(n.attrType=A),c!==""&&(n.name=c),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(o,a){a!==0&&r.push(o)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],o=n.propertyList[1];const a=n.propertyList[2],c=n.propertyList[3];let d;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),d=o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[r]={type:o,type2:a,flag:c,value:d}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}Tt===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const c=Wt(new Uint8Array(e.getArrayBuffer(a))),d=new Hf(c.buffer);switch(t){case"b":case"c":return d.getBooleanArray(r);case"d":return d.getFloat64Array(r);case"f":return d.getFloat32Array(r);case"i":return d.getInt32Array(r);case"l":return d.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Hf{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),f.Zp0.decodeText(new Uint8Array(t))}}class $0{add(e,t){this[e]=t}}function be(s){const e=s.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function bt(s){return s/46186158e3}const kt=[];function Dt(s,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=s;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const o=r*n.dataSize,a=o+n.dataSize;return function(c,d,p,m){for(let A=p,x=0;A<m;A++,x++)c[x]=d[A];return c}(kt,n.buffer,o,a)}const Jt=new f.USm,xn=new f.Pa4;function xi(s){const e=new f.yGw,t=new f.yGw,n=new f.yGw,r=new f.yGw,o=new f.yGw,a=new f.yGw,c=new f.yGw,d=new f.yGw,p=new f.yGw,m=new f.yGw,A=new f.yGw,x=new f.yGw,E=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(xn.fromArray(s.translation)),s.preRotation){const ce=s.preRotation.map(f.M8C.degToRad);ce.push(s.eulerOrder||f.USm.DefaultOrder),t.makeRotationFromEuler(Jt.fromArray(ce))}if(s.rotation){const ce=s.rotation.map(f.M8C.degToRad);ce.push(s.eulerOrder||f.USm.DefaultOrder),n.makeRotationFromEuler(Jt.fromArray(ce))}if(s.postRotation){const ce=s.postRotation.map(f.M8C.degToRad);ce.push(s.eulerOrder||f.USm.DefaultOrder),r.makeRotationFromEuler(Jt.fromArray(ce)),r.invert()}s.scale&&o.scale(xn.fromArray(s.scale)),s.scalingOffset&&c.setPosition(xn.fromArray(s.scalingOffset)),s.scalingPivot&&a.setPosition(xn.fromArray(s.scalingPivot)),s.rotationOffset&&d.setPosition(xn.fromArray(s.rotationOffset)),s.rotationPivot&&p.setPosition(xn.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(A.copy(s.parentMatrix),m.copy(s.parentMatrixWorld));const M=t.clone().multiply(n).multiply(r),T=new f.yGw;T.extractRotation(m);const O=new f.yGw;O.copyPosition(m);const P=O.clone().invert().multiply(m),R=T.clone().invert().multiply(P),I=o,j=new f.yGw;if(E===0)j.copy(T).multiply(M).multiply(R).multiply(I);else if(E===1)j.copy(T).multiply(R).multiply(M).multiply(I);else{const ce=new f.yGw().scale(new f.Pa4().setFromMatrixScale(A)).clone().invert(),ge=R.clone().multiply(ce);j.copy(T).multiply(M).multiply(ge).multiply(I)}const z=p.clone().invert(),V=a.clone().invert();let G=e.clone().multiply(d).multiply(p).multiply(t).multiply(n).multiply(r).multiply(z).multiply(c).multiply(a).multiply(o).multiply(V);const X=new f.yGw().copyPosition(G),ne=m.clone().multiply(X);return x.copyPosition(ne),G=x.clone().multiply(j),G.premultiply(m.invert()),G}function Fn(s){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(s=s||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function di(s){return s.split(",").map(function(e){return parseFloat(e)})}function Ar(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),f.Zp0.decodeText(new Uint8Array(s,e,t))}function Ei(s,e,t){return s.slice(0,e).concat(t).concat(s.slice(e))}class oi extends ct{constructor(){super(...arguments),this.dependencies=[ln],this._importer=new dr(Ay,["fbx"],!0)}async onAdded(e){si.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){si.Importers.splice(si.Importers.indexOf(this._importer),1)}}oi.PluginType="FBXLoadPlugin";const qr=new WeakMap;class Wf extends f.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const o=new f.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),this.url=e,o.load(e,a=>{if(qr.has(a))return qr.get(a).promise.then(t).catch(r);this.decodeObjects(a,e).then(c=>{c.userData.warnings=this.warnings,t(c)}).catch(c=>r(c))},n,r)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,r;const o=e.byteLength,a=this._getWorker(o).then(c=>(n=c,r=this.workerNextTaskID++,new Promise((d,p)=>{n._callbacks[r]={resolve:d,reject:p},n.postMessage({type:"decode",id:r,buffer:e},[e])}))).then(c=>this._createGeometry(c.data)).catch(c=>{throw c});return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),qr.set(e,{url:t,promise:a}),a}parse(e,t,n){this.decodeObjects(e,"").then(r=>{r.userData.warnings=this.warnings,t(r)}).catch(r=>n(r))}_compareMaterials(e){const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(let n=0;n<this.materials.length;n++){const r=this.materials[n],o={};if(o.name=r.name,o.color={},o.color.r=r.color.r,o.color.g=r.color.g,o.color.b=r.color.b,o.type=r.type,JSON.stringify(t)===JSON.stringify(o))return r}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new f.Wid({color:new f.Ilk(1,1,1),metalness:.8,name:"default",side:2});const t=e.diffuseColor,n=new f.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const r=new f.Wid({color:n,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),o=new f.dpR;for(let a=0;a<e.textures.length;a++){const c=e.textures[a];if(c.image!==null){const d=o.load(c.image);switch(c.type){case"Diffuse":r.map=d;break;case"Bump":r.bumpMap=d;break;case"Transparency":r.alphaMap=d,r.transparent=!0;break;case"Emap":r.envMap=d}d.wrapS=c.wrapU===0?f.rpg:f.uWy,d.wrapT=c.wrapV===0?f.rpg:f.uWy,d.repeat.set(c.repeat[0],c.repeat[1])}}return r}_createGeometry(e){const t=new f.Tme,n=[],r=[],o=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let a=e.objects;const c=e.materials;for(let d=0;d<a.length;d++){const p=a[d],m=p.attributes;switch(p.objectType){case"InstanceDefinition":r.push(p);break;case"InstanceReference":o.push(p);break;default:let A;if(m.materialIndex>=0){const E=c[m.materialIndex];let M=this._createMaterial(E);M=this._compareMaterials(M),A=this._createObject(p,M)}else{const E=this._createMaterial();A=this._createObject(p,E)}if(A===void 0)continue;const x=e.layers[m.layerIndex];A.visible=!x||e.layers[m.layerIndex].visible,m.isInstanceDefinitionObject?n.push(A):t.add(A)}}for(let d=0;d<r.length;d++){const p=r[d];a=[];for(let m=0;m<p.attributes.objectIds.length;m++){const A=p.attributes.objectIds[m];for(let x=0;x<n.length;x++)A===n[x].userData.attributes.id&&a.push(n[x])}for(let m=0;m<o.length;m++){const A=o[m];if(A.geometry.parentIdefId===p.attributes.id){const x=new f.Tme,E=A.geometry.xform.array,M=new f.yGw;M.set(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15]),x.applyMatrix4(M);for(let T=0;T<a.length;T++)x.add(a[T].clone(!0));t.add(x)}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new f.s4_,r=e.attributes;let o,a,c,d;switch(e.objectType){case"Point":case"PointSet":o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")?a=new f.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(c=r.drawColor,d=new f.Ilk(c.r/255,c.g/255,c.b/255),a=new f.UY4({color:d,sizeAttenuation:!1,size:2})),a=this._compareMaterials(a);const p=new f.woe(o,a);return p.userData.attributes=r,p.userData.objectType=e.objectType,r.name&&(p.name=r.name),p;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const m=new f.Kj0(o,t);return m.castShadow=r.castsShadows,m.receiveShadow=r.receivesShadows,m.userData.attributes=r,m.userData.objectType=e.objectType,r.name&&(m.name=r.name),m;case"Curve":o=n.parse(e.geometry),c=r.drawColor,d=new f.Ilk(c.r/255,c.g/255,c.b/255),a=new f.nls({color:d}),a=this._compareMaterials(a);const A=new f.x12(o,a);return A.userData.attributes=r,A.userData.objectType=e.objectType,r.name&&(A.name=r.name),A;case"TextDot":o=e.geometry;const x=document.createElement("canvas").getContext("2d"),E=`${o.fontHeight}px ${o.fontFace}`;x.font=E;const M=x.measureText(o.text).width+10,T=o.fontHeight+10,O=window.devicePixelRatio;x.canvas.width=M*O,x.canvas.height=T*O,x.canvas.style.width=M+"px",x.canvas.style.height=T+"px",x.setTransform(O,0,0,O,0,0),x.font=E,x.textBaseline="middle",x.textAlign="center",d=r.drawColor,x.fillStyle=`rgba(${d.r},${d.g},${d.b},${d.a})`,x.fillRect(0,0,M,T),x.fillStyle="white",x.fillText(o.text,M/2,T/2);const P=new f.ROQ(x.canvas);P.minFilter=f.wem,P.wrapS=f.uWy,P.wrapT=f.uWy,a=new f.xeV({map:P,depthTest:!1});const R=new f.jyi(a);return R.position.set(o.point[0],o.point[1],o.point[2]),R.scale.set(M/10,T/10,1),R.userData.attributes=r,R.userData.objectType=e.objectType,r.name&&(R.name=r.name),R;case"Light":let I;switch(o=e.geometry,o.lightStyle.name){case"LightStyle_WorldPoint":I=new f.cek,I.castShadow=r.castsShadows,I.position.set(o.location[0],o.location[1],o.location[2]),I.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":I=new f.PMe,I.castShadow=r.castsShadows,I.position.set(o.location[0],o.location[1],o.location[2]),I.target.position.set(o.direction[0],o.direction[1],o.direction[2]),I.angle=o.spotAngleRadians,I.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":I=new f.T_f;const j=Math.abs(o.width[2]),z=Math.abs(o.length[0]);I.position.set(o.location[0]-z/2,o.location[1],o.location[2]-j/2),I.height=z,I.width=j,I.lookAt(new f.Pa4(o.direction[0],o.direction[1],o.direction[2]));break;case"LightStyle_WorldDirectional":I=new f.Ox3,I.castShadow=r.castsShadows,I.position.set(o.location[0],o.location[1],o.location[2]),I.target.position.set(o.direction[0],o.direction[1],o.direction[2]),I.shadow.normalBias=.1}return I&&(I.intensity=o.intensity,c=o.diffuse,d=new f.Ilk(c.r/255,c.g/255,c.b/255),I.color=d,I.userData.attributes=r,I.userData.objectType=e.objectType),I}}_initLibrary(){if(!this.libraryPending){const e=new f.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((o,a)=>{e.load("rhino3dm.js",o,void 0,a)}),n=new f.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const r=new Promise((o,a)=>{n.load("rhino3dm.wasm",o,void 0,a)});this.libraryPending=Promise.all([t,r]).then(([o,a])=>{this.libraryConfig.wasmBinary=a;const c=La.toString(),d=["/* rhino3dm.js */",o,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([d]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=r=>{const o=r.data;switch(o.type){case"warning":this.warnings.push(o.data),console.warn(o.data);break;case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function La(){let s,e,t,n;function r(c,d){const p=c.geometry(),m=c.attributes();let A,x,E,M,T,O=p.objectType;switch(O){case t.ObjectType.Curve:const P=a(p,100);E={},x={},M={},E.itemSize=3,E.type="Float32Array",E.array=[];for(let V=0;V<P.length;V++)E.array.push(P[V][0]),E.array.push(P[V][1]),E.array.push(P[V][2]);x.position=E,M.attributes=x,A={data:M};break;case t.ObjectType.Point:const R=p.location;E={};const I={};x={},M={},E.itemSize=3,E.type="Float32Array",E.array=[R[0],R[1],R[2]];const j=m.drawColor(d);I.itemSize=3,I.type="Float32Array",I.array=[j.r/255,j.g/255,j.b/255],x.position=E,x.color=I,M.attributes=x,A={data:M};break;case t.ObjectType.PointSet:case t.ObjectType.Mesh:A=p.toThreejsJSON();break;case t.ObjectType.Brep:const z=p.faces();T=new t.Mesh;for(let V=0;V<z.count;V++){const G=z.get(V),X=G.getMesh(t.MeshType.Any);X&&(T.append(X),X.delete()),G.delete()}T.faces().count>0&&(T.compact(),A=T.toThreejsJSON(),z.delete()),T.delete();break;case t.ObjectType.Extrusion:T=p.getMesh(t.MeshType.Any),T&&(A=T.toThreejsJSON(),T.delete());break;case t.ObjectType.TextDot:A=o(p);break;case t.ObjectType.Light:A=o(p),A.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: No conversion exists for ${O.constructor.name} ${A.lightStyle.name}`,type:"no conversion",guid:m.id}});break;case t.ObjectType.InstanceReference:A=o(p),A.xform=o(p.xform),A.xform.array=p.xform.toFloatArray(!0);break;case t.ObjectType.SubD:p.subdivide(3),T=t.Mesh.createFromSubDControlNet(p),T&&(A=T.toThreejsJSON(),T.delete());break;default:self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: Conversion not implemented for ${O.constructor.name}`,type:"not implemented",guid:m.id}})}if(A)return x=o(m),x.geometry=o(p),m.groupCount>0&&(x.groupIds=m.getGroupList()),m.userStringCount>0&&(x.userStrings=m.getUserStrings()),p.userStringCount>0&&(x.geometry.userStrings=p.getUserStrings()),x.drawColor=m.drawColor(d),O=O.constructor.name,O=O.substring(11,O.length),{geometry:A,attributes:x,objectType:O};self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: ${O.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:m.id}})}function o(c){const d={};for(const p in c){const m=c[p];typeof m!="function"&&(typeof m=="object"&&m!==null&&m.hasOwnProperty("constructor")?d[p]={name:m.constructor.name,value:m.value}:d[p]=m)}return d}function a(c,d){let p=d,m=[];const A=[];if(c instanceof t.LineCurve)return[c.pointAtStart,c.pointAtEnd];if(c instanceof t.PolylineCurve){p=c.pointCount;for(let M=0;M<p;M++)m.push(c.point(M));return m}if(c instanceof t.PolyCurve){const M=c.segmentCount;for(let T=0;T<M;T++){const O=c.segmentCurve(T),P=a(O,p);m=m.concat(P),O.delete()}return m}if(c instanceof t.ArcCurve&&(p=Math.floor(c.angleDegrees/5),p=p<2?2:p),c instanceof t.NurbsCurve&&c.degree===1){const M=c.tryGetPolyline();for(let T=0;T<M.count;T++)m.push(M.get(T));return M.delete(),m}const x=c.domain,E=p-1;for(let M=0;M<p;M++){const T=x[0]+M/E*(x[1]-x[0]);if(T===x[0]||T===x[1]){A.push(T);continue}const O=c.tangentAt(T),P=c.tangentAt(A.slice(-1)[0]),R=O[0]*O[0]+O[1]*O[1]+O[2]*O[2],I=P[0]*P[0]+P[1]*P[1]+P[2]*P[2],j=Math.sqrt(R*I);let z;if(j===0)z=Math.PI/2;else{const V=(O.x*P.x+O.y*P.y+O.z*P.z)/j;z=Math.acos(Math.max(-1,Math.min(1,V)))}z<.1||A.push(T)}return m=A.map(M=>c.pointAt(M)),m}onmessage=function(c){const d=c.data;switch(d.type){case"init":e=d.libraryConfig;const p=e.wasmBinary;let m;s=new Promise(function(x){m={wasmBinary:p,onRuntimeInitialized:x},rhino3dm(m)}).then(()=>{t=m});break;case"decode":n=d.id;const A=d.buffer;s.then(()=>{try{const x=function(E,M){const T=new Uint8Array(M),O=E.File3dm.fromByteArray(T),P=[],R=[],I=[],j=[],z=[],V=[],G=[],X=O.objects(),ne=X.count;for(let pe=0;pe<ne;pe++){const ye=X.get(pe),Re=r(ye,O);ye.delete(),Re&&P.push(Re)}for(let pe=0;pe<O.instanceDefinitions().count();pe++){const ye=O.instanceDefinitions().get(pe),Re=o(ye);Re.objectIds=ye.getObjectIds(),P.push({geometry:null,attributes:Re,objectType:"InstanceDefinition"})}const ce=[E.TextureType.Diffuse,E.TextureType.Bump,E.TextureType.Transparency,E.TextureType.Opacity,E.TextureType.Emap],ge=[E.TextureType.PBR_BaseColor,E.TextureType.PBR_Subsurface,E.TextureType.PBR_SubsurfaceScattering,E.TextureType.PBR_SubsurfaceScatteringRadius,E.TextureType.PBR_Metallic,E.TextureType.PBR_Specular,E.TextureType.PBR_SpecularTint,E.TextureType.PBR_Roughness,E.TextureType.PBR_Anisotropic,E.TextureType.PBR_Anisotropic_Rotation,E.TextureType.PBR_Sheen,E.TextureType.PBR_SheenTint,E.TextureType.PBR_Clearcoat,E.TextureType.PBR_ClearcoatBump,E.TextureType.PBR_ClearcoatRoughness,E.TextureType.PBR_OpacityIor,E.TextureType.PBR_OpacityRoughness,E.TextureType.PBR_Emission,E.TextureType.PBR_AmbientOcclusion,E.TextureType.PBR_Displacement];for(let pe=0;pe<O.materials().count();pe++){const ye=O.materials().get(pe),Re=ye.physicallyBased();let we=o(ye);const We=[];for(let ot=0;ot<ce.length;ot++){const ft=ye.getTexture(ce[ot]);if(ft){let nt=ce[ot].constructor.name;nt=nt.substring(12,nt.length);const Rt={type:nt},Nt=O.getEmbeddedFileAsBase64(ft.fileName);Rt.wrapU=ft.wrapU,Rt.wrapV=ft.wrapV,Rt.wrapW=ft.wrapW;const Ut=ft.uvwTransform.toFloatArray(!0);Rt.repeat=[Ut[0],Ut[5]],Nt?Rt.image="data:image/png;base64,"+Nt:(self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: Image for ${nt} texture not embedded in file.`,type:"missing resource"}}),Rt.image=null),We.push(Rt),ft.delete()}}if(we.textures=We,Re.supported){for(let ft=0;ft<ge.length;ft++){const nt=ye.getTexture(ge[ft]);if(nt){const Rt=O.getEmbeddedFileAsBase64(nt.fileName);let Nt=ge[ft].constructor.name;Nt=Nt.substring(12,Nt.length);const Ut={type:Nt,image:"data:image/png;base64,"+Rt};We.push(Ut),nt.delete()}}const ot=o(ye.physicallyBased());we=Object.assign(ot,we)}R.push(we),ye.delete(),Re.delete()}for(let pe=0;pe<O.layers().count();pe++){const ye=O.layers().get(pe),Re=o(ye);I.push(Re),ye.delete()}for(let pe=0;pe<O.views().count();pe++){const ye=O.views().get(pe),Re=o(ye);j.push(Re),ye.delete()}for(let pe=0;pe<O.namedViews().count();pe++){const ye=O.namedViews().get(pe),Re=o(ye);z.push(Re),ye.delete()}for(let pe=0;pe<O.groups().count();pe++){const ye=O.groups().get(pe),Re=o(ye);V.push(Re),ye.delete()}const de=o(O.settings()),xe=O.strings().count();for(let pe=0;pe<xe;pe++)G.push(O.strings().get(pe));return O.delete(),{objects:P,materials:R,layers:I,views:j,namedViews:z,groups:V,strings:G,settings:de}}(t,A);self.postMessage({type:"decode",id:d.id,data:x})}catch(x){self.postMessage({type:"error",id:d.id,error:x})}})}}}class Yg extends Wf{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.11.1/")}async loadAsync(e,t){return await super.loadAsync(e,t)}}class tc extends ct{constructor(){super(...arguments),this.dependencies=[ln],this._importer=new dr(Yg,["3dm"],!0)}async onAdded(e){si.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){si.Importers.splice(si.Importers.indexOf(this._importer),1)}}tc.PluginType="Rhino3dmLoadPlugin";class e_ extends ct{constructor(){super(...arguments),this.dependencies=[ln]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}e_.PluginType="GLTFMeshOptPlugin";class Xg extends f.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=new f.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(o.parse(c))}catch(d){r?r(d):console.error(d),o.manager.itemError(e)}},n,r)}parse(e){function t(o,a,c){for(let d=0,p=o.length;d<p;d++)if(o[d]!==a.getUint8(c+d))return!1;return!0}const n=function(o){if(typeof o=="string"){const a=new Uint8Array(o.length);for(let c=0;c<o.length;c++)a[c]=255&o.charCodeAt(c);return a.buffer||a}return o}(e);return function(o){const a=new DataView(o);if(84+50*a.getUint32(80,!0)===a.byteLength)return!0;const c=[115,111,108,105,100];for(let d=0;d<5;d++)if(t(c,a,d))return!1;return!0}(n)?function(o){const a=new DataView(o),c=a.getUint32(80,!0);let d,p,m,A,x,E,M,T,O=!1;for(let j=0;j<70;j++)a.getUint32(j,!1)==1129270351&&a.getUint8(j+4)==82&&a.getUint8(j+5)==61&&(O=!0,A=new Float32Array(3*c*3),x=a.getUint8(j+6)/255,E=a.getUint8(j+7)/255,M=a.getUint8(j+8)/255,T=a.getUint8(j+9)/255);const P=new f.u9r,R=new Float32Array(3*c*3),I=new Float32Array(3*c*3);for(let j=0;j<c;j++){const z=84+50*j,V=a.getFloat32(z,!0),G=a.getFloat32(z+4,!0),X=a.getFloat32(z+8,!0);if(O){const ne=a.getUint16(z+48,!0);32768&ne?(d=x,p=E,m=M):(d=(31&ne)/31,p=(ne>>5&31)/31,m=(ne>>10&31)/31)}for(let ne=1;ne<=3;ne++){const ce=z+12*ne,ge=3*j*3+3*(ne-1);R[ge]=a.getFloat32(ce,!0),R[ge+1]=a.getFloat32(ce+4,!0),R[ge+2]=a.getFloat32(ce+8,!0),I[ge]=V,I[ge+1]=G,I[ge+2]=X,O&&(A[ge]=d,A[ge+1]=p,A[ge+2]=m)}}return P.setAttribute("position",new f.TlE(R,3)),P.setAttribute("normal",new f.TlE(I,3)),O&&(P.setAttribute("color",new f.TlE(A,3)),P.hasColors=!0,P.alpha=T),P}(n):function(o){const a=new f.u9r,c=/solid([\s\S]*?)endsolid/g,d=/facet([\s\S]*?)endfacet/g;let p=0;const m=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,A=new RegExp("vertex"+m+m+m,"g"),x=new RegExp("normal"+m+m+m,"g"),E=[],M=[],T=new f.Pa4;let O,P=0,R=0,I=0;for(;(O=c.exec(o))!==null;){R=I;const j=O[0];for(;(O=d.exec(j))!==null;){let G=0,X=0;const ne=O[0];for(;(O=x.exec(ne))!==null;)T.x=parseFloat(O[1]),T.y=parseFloat(O[2]),T.z=parseFloat(O[3]),X++;for(;(O=A.exec(ne))!==null;)E.push(parseFloat(O[1]),parseFloat(O[2]),parseFloat(O[3])),M.push(T.x,T.y,T.z),G++,I++;X!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+p),G!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+p),p++}const z=R,V=I-R;a.addGroup(z,V,P),P++}return a.setAttribute("position",new f.a$l(E,3)),a.setAttribute("normal",new f.a$l(M,3)),a}(typeof(r=e)!="string"?f.Zp0.decodeText(new Uint8Array(r)):r);var r}}class t_ extends ct{constructor(){super(...arguments),this.dependencies=[ln]}async onAdded(e){this._importer||(this._importer=new dr(Xg,["stl"],!0)),si.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&si.Importers.splice(si.Importers.indexOf(this._importer),1),this._importer=void 0}}t_.PluginType="STLLoadPlugin";class qf extends f.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=this.path===""?f.Zp0.extractUrlBase(e):this.path,c=new f.hH6(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(d){try{t(o.parse(d,a))}catch(p){r?r(p):console.error(p),o.manager.itemError(e)}},n,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let r={};const o=/\s+/,a={};for(let d=0;d<n.length;d++){let p=n[d];if(p=p.trim(),p.length===0||p.charAt(0)==="#")continue;const m=p.indexOf(" ");let A=m>=0?p.substring(0,m):p;A=A.toLowerCase();let x=m>=0?p.substring(m+1):"";if(x=x.trim(),A==="newmtl")r={name:x},a[x]=r;else if(A==="ka"||A==="kd"||A==="ks"||A==="ke"){const E=x.split(o,3);r[A]=[parseFloat(E[0]),parseFloat(E[1]),parseFloat(E[2])]}else r[A]=x}const c=new Ls(this.resourcePath||t,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(a),c}}class Ls{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:f.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:f.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],o={};t[n]=o;for(const a in r){let c=!0,d=r[a];const p=a.toLowerCase();switch(p){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(d=[d[0]/255,d[1]/255,d[2]/255]),this.options&&this.options.ignoreZeroRGBs&&d[0]===0&&d[1]===0&&d[2]===0&&(c=!1)}c&&(o[p]=d)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],r={name:e,side:this.side};async function o(d,p){if(r[d])return;const m=t.getTextureParams(p,r);return new Promise((A,x)=>{let E=!1,M=()=>!E&&(E=!0)&&A();const T=t.loadTexture((O=t.baseUrl,typeof(P=m.url)!="string"||P===""?"":/^https?:\/\//i.test(P)?P:O+P),void 0,R=>{r[d]=R,M()},void 0,M);var O,P;setTimeout(M,50),T.repeat.copy(m.scale),T.offset.copy(m.offset),T.wrapS=t.wrap,T.wrapT=t.wrap})}const a=Array.from(Object.keys(n||{}));let c=a.includes("d")||a.includes("D");for(const d of a){const p=n[d];let m;if(p!=="")switch(d.toLowerCase()){case"kd":r.color=new f.Ilk().fromArray(p);break;case"ks":r.specular=new f.Ilk().fromArray(p);break;case"ke":r.emissive=new f.Ilk().fromArray(p);break;case"map_kd":await o("map",p);break;case"map_ks":await o("specularMap",p);break;case"map_ke":await o("emissiveMap",p);break;case"norm":await o("normalMap",p);break;case"map_bump":case"bump":await o("bumpMap",p);break;case"map_d":await o("alphaMap",p),r.transparent=!0;break;case"ns":r.shininess=parseFloat(p);break;case"d":m=parseFloat(p),m<1&&(r.opacity=m,r.transparent=!0);break;case"tr":if(c)break;m=parseFloat(p),this.options&&this.options.invertTrProperty&&(m=1-m),m>0&&(r.opacity=1-m,r.transparent=!0)}}return this.materials[e]=new f.xoR(r),this.materials[e]}getTextureParams(e,t){const n={scale:new f.FM8(1,1),offset:new f.FM8(0,0)},r=e.split(/\s+/);let o;return o=r.indexOf("-bm"),o>=0&&(t.bumpScale=parseFloat(r[o+1]),r.splice(o,2)),o=r.indexOf("-s"),o>=0&&(n.scale.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),o=r.indexOf("-o"),o>=0&&(n.offset.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),n.url=r.join(" ").trim(),n}loadTexture(e,t,n,r,o){const a=this.manager!==void 0?this.manager:f.tEQ;let c=a.getHandler(e);c===null&&(c=new f.dpR(a)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin);const d=c.load(e,n,r,o);return t!==void 0&&(d.mapping=t),d}}const Yf=/^[og]\s*(.+)?/,vl=/^mtllib /,qn=/^usemtl /,Ss=/^usemap /,Kg=new f.Pa4,n_=new f.Pa4,wy=new f.Pa4,Xf=new f.Pa4,Na=new f.Pa4;function Tw(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const c={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(d){const p={index:typeof d=="number"?d:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return p.clone=this.clone.bind(p),p}};return this.materials.push(c),c},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},n&&n.name&&typeof n.clone=="function"){const r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,o=this.object.geometry.normals;Kg.fromArray(r,e),n_.fromArray(r,t),wy.fromArray(r,n),Na.subVectors(wy,n_),Xf.subVectors(Kg,n_),Na.cross(Xf),Na.normalize(),o.push(Na.x,Na.y,Na.z),o.push(Na.x,Na.y,Na.z),o.push(Na.x,Na.y,Na.z)},addColor:function(e,t,n){const r=this.colors,o=this.object.geometry.colors;r[e]!==void 0&&o.push(r[e+0],r[e+1],r[e+2]),r[t]!==void 0&&o.push(r[t+0],r[t+1],r[t+2]),r[n]!==void 0&&o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,a,c,d,p){const m=this.vertices.length;let A=this.parseVertexIndex(e,m),x=this.parseVertexIndex(t,m),E=this.parseVertexIndex(n,m);if(this.addVertex(A,x,E),this.addColor(A,x,E),c!==void 0&&c!==""){const M=this.normals.length;A=this.parseNormalIndex(c,M),x=this.parseNormalIndex(d,M),E=this.parseNormalIndex(p,M),this.addNormal(A,x,E)}else this.addFaceNormal(A,x,E);if(r!==void 0&&r!==""){const M=this.uvs.length;A=this.parseUVIndex(r,M),x=this.parseUVIndex(o,M),E=this.parseUVIndex(a,M),this.addUV(A,x,E),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const o=this.parseVertexIndex(e[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));for(let o=0,a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return s.startObject("",!1),s}class xy extends f.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,r){const o=this,a=new f.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,async function(c){try{t(await o.parse(c))}catch(d){r?r(d):console.error(d),o.manager.itemError(e)}},n,r)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new Tw;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let r="",o="",a=0,c=[];const d=typeof"".trimLeft=="function";for(let m=0,A=n.length;m<A;m++)if(r=n[m],r=d?r.trimLeft():r.trim(),a=r.length,a!==0&&(o=r.charAt(0),o!=="#"))if(o==="v"){const x=r.split(/\s+/);switch(x[0]){case"v":t.vertices.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])),x.length>=7?t.colors.push(parseFloat(x[4]),parseFloat(x[5]),parseFloat(x[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));break;case"vt":t.uvs.push(parseFloat(x[1]),parseFloat(x[2]))}}else if(o==="f"){const x=r.substr(1).trim().split(/\s+/),E=[];for(let T=0,O=x.length;T<O;T++){const P=x[T];if(P.length>0){const R=P.split("/");E.push(R)}}const M=E[0];for(let T=1,O=E.length-1;T<O;T++){const P=E[T],R=E[T+1];t.addFace(M[0],P[0],R[0],M[1],P[1],R[1],M[2],P[2],R[2])}}else if(o==="l"){const x=r.substring(1).trim().split(" ");let E=[];const M=[];if(r.indexOf("/")===-1)E=x;else for(let T=0,O=x.length;T<O;T++){const P=x[T].split("/");P[0]!==""&&E.push(P[0]),P[1]!==""&&M.push(P[1])}t.addLineGeometry(E,M)}else if(o==="p"){const x=r.substr(1).trim().split(" ");t.addPointGeometry(x)}else if((c=Yf.exec(r))!==null){const x=(" "+c[0].substr(1).trim()).substr(1);t.startObject(x)}else if(qn.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(vl.test(r)){t.materialLibraries.push(r.substring(7).trim());const x=r.substring(7).trim(),E=this.manager.getHandler(x);if(E){const M=await E.loadAsync(x).catch(T=>{console.warn(T)});M&&this.setMaterials(M)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(Ss.test(r))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(o==="s"){if(c=r.split(" "),c.length>1){const E=c[1].trim().toLowerCase();t.object.smooth=E!=="0"&&E!=="off"}else t.object.smooth=!0;const x=t.object.currentMaterial();x&&(x.smooth=t.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}t.finalize();const p=new f.ZAu;if(p.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let m=0,A=t.objects.length;m<A;m++){const x=t.objects[m],E=x.geometry,M=x.materials,T=E.type==="Line",O=E.type==="Points";let P=!1;if(E.vertices.length===0)continue;const R=new f.u9r;R.setAttribute("position",new f.a$l(E.vertices,3)),E.normals.length>0&&R.setAttribute("normal",new f.a$l(E.normals,3)),E.colors.length>0&&(P=!0,R.setAttribute("color",new f.a$l(E.colors,3))),E.hasUVIndices===!0&&R.setAttribute("uv",new f.a$l(E.uvs,2));const I=[];for(let z=0,V=M.length;z<V;z++){const G=M[z],X=G.name+"_"+G.smooth+"_"+P;let ne=t.materials[X];if(this.materials!==null)if(ne=await this.materials.create(G.name),!T||!ne||ne instanceof f.nls){if(O&&ne&&!(ne instanceof f.UY4)){const ce=new f.UY4({size:10,sizeAttenuation:!1});f.F5T.prototype.copy.call(ce,ne),ce.color.copy(ne.color),ce.map=ne.map,ne=ce}}else{const ce=new f.nls;f.F5T.prototype.copy.call(ce,ne),ce.color.copy(ne.color),ne=ce}ne===void 0&&(ne=T?new f.nls:O?new f.UY4({size:1,sizeAttenuation:!1}):new f.xoR,ne.name=G.name,ne.flatShading=!G.smooth,ne.vertexColors=P,t.materials[X]=ne),I.push(ne)}let j;if(I.length>1){for(let z=0,V=M.length;z<V;z++){const G=M[z];R.addGroup(G.groupStart,G.groupCount,z)}j=T?new f.ejS(R,I):O?new f.woe(R,I):new f.Kj0(R,I)}else j=T?new f.ejS(R,I[0]):O?new f.woe(R,I[0]):new f.Kj0(R,I[0]);j.name=x.name,p.add(j)}else if(t.vertices.length>0){const m=new f.UY4({size:1,sizeAttenuation:!1}),A=new f.u9r;A.setAttribute("position",new f.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(A.setAttribute("color",new f.a$l(t.colors,3)),m.vertexColors=!0);const x=new f.woe(A,m);p.add(x)}return p}}class i_ extends ct{constructor(){super(...arguments),this.dependencies=[ln],this._importer1=new dr(xy,["obj"],!0),this._importer2=new dr(qf,["mtl"],!1)}async onAdded(e){si.Importers.push(this._importer1),si.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){si.Importers.splice(si.Importers.indexOf(this._importer1),1),si.Importers.splice(si.Importers.indexOf(this._importer2),1)}}i_.PluginType="ObjMtlLoadPlugin";class Iw extends f.DqL{constructor(e){super(e)}parse(e,t){const n=new Dw(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class Dw{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const r=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,12,13*r),a=o.getUint32(0,!0)===67305985;this.glType=o.getUint32(1*r,a),this.glTypeSize=o.getUint32(2*r,a),this.glFormat=o.getUint32(3*r,a),this.glInternalFormat=o.getUint32(4*r,a),this.glBaseInternalFormat=o.getUint32(5*r,a),this.pixelWidth=o.getUint32(6*r,a),this.pixelHeight=o.getUint32(7*r,a),this.pixelDepth=o.getUint32(8*r,a),this.numberOfArrayElements=o.getUint32(9*r,a),this.numberOfFaces=o.getUint32(10*r,a),this.numberOfMipmapLevels=o.getUint32(11*r,a),this.bytesOfKeyValueData=o.getUint32(12*r,a),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight;const a=e?this.numberOfMipmapLevels:1;for(let c=0;c<a;c++){const d=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let p=0;p<this.numberOfFaces;p++){const m=new Uint8Array(this.arrayBuffer,n,d);t.push({data:m,width:r,height:o}),n+=d,n+=3-(d+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}return t}}class Jg extends ct{constructor(){super(...arguments),this.dependencies=[ln]}async onAdded(e){this._importer||(this._importer=new dr(Iw,["ktx"],!1)),si.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&si.Importers.splice(si.Importers.indexOf(this._importer),1),this._importer=void 0}}Jg.PluginType="KTXLoadPlugin";class Pw extends f.hH6{constructor(e){super(e),this.responseType="blob"}}class Yi extends f.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,r){return super.load(e,o=>{try{t==null||t(Nr(o))}catch(a){r==null||r(a)}},n,r)}}class Ey{async parseAsync(e,t){var n;return new Blob([JSON.stringify(e,null,(n=t.jsonSpaces)!==null&&n!==void 0?n:2)],{type:"application/json"})}}class nc{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}class ic{constructor(){this.pluginCallbacks=[],this.register(function(e){return new go(e)}),this.register(function(e){return new Kf(e)}),this.register(function(e){return new Rw(e)}),this.register(function(e){return new iM(e)}),this.register(function(e){return new rM(e)}),this.register(function(e){return new Cy(e)}),this.register(function(e){return new sM(e)}),this.register(function(e){return new nM(e)}),this.register(function(e){return new oM(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,o){const a=o||new r_,c=[];for(let d=0,p=this.pluginCallbacks.length;d<p;d++)c.push(this.pluginCallbacks[d](a));a.setPlugins(c),a.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,r,o,t)})}}const Zg=5121,Zh=5123,mo={};mo[f.TyD]=9728,mo[f.YLQ]=9984,mo[f.aH4]=9986,mo[f.wem]=9729,mo[f.qyh]=9985,mo[f.D1R]=9987,mo[f.uWy]=33071,mo[f.rpg]=10497,mo[f.OoA]=33648;const Ns={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function _l(s,e){return s.length===e.length&&s.every(function(t,n){return t===e[n]})}function $g(s){return 4*Math.ceil(s/4)}function Ua(s,e=0){const t=$g(s.byteLength);if(t!==s.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(s)),e!==0)for(let r=s.byteLength;r<t;r++)n[r]=e;return n.buffer}return s}function Fa(s,e){if(s.toBlob!==void 0)return new Promise(n=>s.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class r_{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,o=r.buffers,a=r.json;n=r.options;const c=r.extensionsUsed,d=new Blob(o,{type:"application/octet-stream"}),p=Object.keys(c);if(p.length>0&&(a.extensionsUsed=p),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=d.size),n.binary===!0){const m=new FileReader;m.readAsArrayBuffer(d),m.onloadend=function(){const A=Ua(m.result),x=new DataView(new ArrayBuffer(8));x.setUint32(0,A.byteLength,!0),x.setUint32(4,5130562,!0);const E=Ua((M=JSON.stringify(a),new TextEncoder().encode(M).buffer),32);var M;const T=new DataView(new ArrayBuffer(8));T.setUint32(0,E.byteLength,!0),T.setUint32(4,1313821514,!0);const O=new ArrayBuffer(12),P=new DataView(O);P.setUint32(0,1179937895,!0),P.setUint32(4,2,!0);const R=12+T.byteLength+E.byteLength+x.byteLength+A.byteLength;P.setUint32(8,R,!0);const I=new Blob([O,T,E,x,A],{type:"application/octet-stream"}),j=new FileReader;j.readAsArrayBuffer(I),j.onloadend=function(){t(j.result)}}}else if(a.buffers&&a.buffers.length>0){const m=new FileReader;m.readAsDataURL(d),m.onloadend=function(){const A=m.result;a.buffers[0].uri=A,t(a)}}else t(a)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in o.gltfExtensions)t.extensions[a]=o.gltfExtensions[a],r[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new f.Pa4;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new f.Pa4;for(let o=0,a=n.count;o<a;o++)r.fromBufferAttribute(n,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(o,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};t.offset.x===0&&t.offset.y===0||(r.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(r.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(x){return x.encoding===f.knz?function(E){return E<.04045?.0773993808*E:Math.pow(.9478672986*E+.0521327014,2.4)}:function(E){return E}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const r=e?e.image:void 0,o=t?t.image:void 0,a=Math.max(r?r.width:0,o?o.width:0),c=Math.max(r?r.height:0,o?o.height:0),d=document.createElement("canvas");d.width=a,d.height=c;const p=d.getContext("2d");p.fillStyle="#00ffff",p.fillRect(0,0,a,c);const m=p.getImageData(0,0,a,c);if(r){p.drawImage(r,0,0,a,c);const x=n(e),E=p.getImageData(0,0,a,c).data;for(let M=2;M<E.length;M+=4)m.data[M]=256*x(E[M]/256)}if(o){p.drawImage(o,0,0,a,c);const x=n(t),E=p.getImageData(0,0,a,c).data;for(let M=1;M<E.length;M+=4)m.data[M]=256*x(E[M]/256)}p.putImageData(m,0,0);const A=(e||t).clone();return A.source=new f.Hw6(d),A.encoding=f.rnI,A}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,o){const a=this.json;let c;a.bufferViews||(a.bufferViews=[]),c=t===Zg?1:t===Zh?2:4;const d=$g(r*e.itemSize*c),p=new DataView(new ArrayBuffer(d));let m=0;for(let x=n;x<n+r;x++)for(let E=0;E<e.itemSize;E++){let M;e.itemSize>4?M=e.array[x*e.itemSize+E]:E===0?M=e.getX(x):E===1?M=e.getY(x):E===2?M=e.getZ(x):E===3&&(M=e.getW(x)),t===5126?p.setFloat32(m,M,!0):t===5125?p.setUint32(m,M,!0):t===Zh?p.setUint16(m,M,!0):t===Zg&&p.setUint8(m,M),m+=c}const A={buffer:this.processBuffer(p.buffer),byteOffset:this.byteOffset,byteLength:d};return o!==void 0&&(A.target=o),o===34962&&(A.byteStride=e.itemSize*c),this.byteOffset+=d,a.bufferViews.push(A),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(r){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=Ua(o.result),c={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,r(n.bufferViews.push(c)-1)}})}processAccessor(e,t,n,r){const o=this.options,a=this.json;let c;if(e.array.constructor===Float32Array)c=5126;else if(e.array.constructor===Uint32Array)c=5125;else if(e.array.constructor===Uint16Array)c=Zh;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");c=Zg}if(n===void 0&&(n=0),r===void 0&&(r=e.count),o.truncateDrawRange&&t!==void 0&&t.index===null){const x=n+r,E=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),r=Math.min(x,E)-n,r<0&&(r=0)}if(r===0)return null;const d=function(x,E,M){const T={min:new Array(x.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(x.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let O=E;O<E+M;O++)for(let P=0;P<x.itemSize;P++){let R;x.itemSize>4?R=x.array[O*x.itemSize+P]:P===0?R=x.getX(O):P===1?R=x.getY(O):P===2?R=x.getZ(O):P===3&&(R=x.getW(O)),T.min[P]=Math.min(T.min[P],R),T.max[P]=Math.max(T.max[P],R)}return T}(e,n,r);let p;t!==void 0&&(p=e===t.index?34963:34962);const m=this.processBufferView(e,c,n,r,p),A={bufferView:m.id,byteOffset:m.byteOffset,componentType:c,count:r,max:d.max,min:d.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return a.accessors||(a.accessors=[]),a.accessors.push(A)-1}processImage(e,t,n,r="image/png"){const o=this,a=o.cache,c=o.json,d=o.options,p=o.pending;a.images.has(e)||a.images.set(e,{});const m=a.images.get(e),A=r+":flipY/"+n.toString();if(m[A]!==void 0)return m[A];c.images||(c.images=[]);const x={mimeType:r},E=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");E.width=Math.min(e.width,d.maxTextureSize),E.height=Math.min(e.height,d.maxTextureSize);const M=E.getContext("2d");if(n===!0&&(M.translate(0,E.height),M.scale(1,-1)),e.data!==void 0){t!==f.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>d.maxTextureSize||e.height>d.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const O=new Uint8ClampedArray(e.height*e.width*4);for(let P=0;P<O.length;P+=4)O[P+0]=e.data[P+0],O[P+1]=e.data[P+1],O[P+2]=e.data[P+2],O[P+3]=e.data[P+3];M.putImageData(new ImageData(O,e.width,e.height),0,0)}else M.drawImage(e,0,0,E.width,E.height);d.binary===!0?p.push(Fa(E,r).then(O=>o.processBufferViewImage(O)).then(O=>{x.bufferView=O})):E.toDataURL!==void 0?x.uri=E.toDataURL(r):p.push(Fa(E,r).then(O=>new FileReader().readAsDataURL(O)).then(O=>{x.uri=O}));const T=c.images.push(x)-1;return m[A]=T,T}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:mo[e.magFilter],minFilter:mo[e.minFilter],wrapS:mo[e.wrapS],wrapT:mo[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let r=e.userData.mimeType;r==="image/webp"&&(r="image/png"),r==="image/jpg"&&(r="image/jpeg");const o=["image/jpeg","image/png"];r&&!o.includes(r)&&console.error("GLTFExporter: Unsupported mime type: "+r+". Cannot export texture.",e);const a={sampler:this.processSampler(e),source:!r||o.includes(r)?this.processImage(e.image,e.format,e.flipY,r):null};e.name&&(a.name=e.name),this._invokeAll(function(d){d.writeTexture&&d.writeTexture(e,a)});const c=n.textures.push(a)-1;return t.textures.set(e,c),c}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=e.color.toArray().concat([e.opacity]);if(_l(o,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const c=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),d={index:this.processTexture(c)};this.applyTextureTransform(d,c),r.pbrMetallicRoughness.metallicRoughnessTexture=d}if(e.map){const c={index:this.processTexture(e.map)};this.applyTextureTransform(c,e.map),r.pbrMetallicRoughness.baseColorTexture=c}if(e.emissive){const c=e.emissive.clone().multiplyScalar(e.emissiveIntensity),d=Math.max(c.r,c.g,c.b);if(d>1&&(c.multiplyScalar(1/d),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),d>0&&(r.emissiveFactor=c.toArray()),e.emissiveMap){const p={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(p,e.emissiveMap),r.emissiveTexture=p}}if(e.normalMap){const c={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(c.scale=e.normalScale.x),this.applyTextureTransform(c,e.normalMap),r.normalTexture=c}if(e.aoMap){const c={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(c.strength=e.aoMapIntensity),this.applyTextureTransform(c,e.aoMap),r.occlusionTexture=c}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===f.ehD&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(c){c.writeMaterial&&c.writeMaterial(e,r)});const a=n.materials.push(r)-1;return t.materials.set(e,a),a}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let I=0,j=e.material.length;I<j;I++)r.push(e.material[I].uuid);else r.push(e.material.uuid);const o=r.join(":");if(t.meshes.has(o))return t.meshes.get(o);const a=e.geometry;let c;c=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const d={},p={},m=[],A=[],x={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},E=a.getAttribute("normal");E===void 0||this.isNormalizedNormalAttribute(E)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(E)));let M=null;for(let I in a.attributes){if(I.slice(0,5)==="morph")continue;const j=a.attributes[I];if(I=x[I]||I.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(I)||(I="_"+I),t.attributes.has(this.getUID(j))){p[I]=t.attributes.get(this.getUID(j));continue}M=null;const z=j.array;I!=="JOINTS_0"||z instanceof Uint16Array||z instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),M=new f.TlE(new Uint16Array(z),j.itemSize,j.normalized));const V=this.processAccessor(M||j,a);V!==null&&(p[I]=V,t.attributes.set(this.getUID(j),V))}if(E!==void 0&&a.setAttribute("normal",E),Object.keys(p).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const I=[],j=[],z={};if(e.morphTargetDictionary!==void 0)for(const V in e.morphTargetDictionary)z[e.morphTargetDictionary[V]]=V;for(let V=0;V<e.morphTargetInfluences.length;++V){const G={};let X=!1;for(const ne in a.morphAttributes){if(ne!=="position"&&ne!=="normal"){X||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),X=!0);continue}const ce=a.morphAttributes[ne][V],ge=ne.toUpperCase(),de=a.attributes[ne];if(t.attributes.has(this.getUID(ce,!0))){G[ge]=t.attributes.get(this.getUID(ce,!0));continue}const xe=ce.clone();if(!a.morphTargetsRelative)for(let pe=0,ye=ce.count;pe<ye;pe++)xe.setXYZ(pe,ce.getX(pe)-de.getX(pe),ce.getY(pe)-de.getY(pe),ce.getZ(pe)-de.getZ(pe));G[ge]=this.processAccessor(xe,a),t.attributes.set(this.getUID(de,!0),G[ge])}A.push(G),I.push(e.morphTargetInfluences[V]),e.morphTargetDictionary!==void 0&&j.push(z[V])}d.weights=I,j.length>0&&(d.extras={},d.extras.targetNames=j)}const T=Array.isArray(e.material);if(T&&a.groups.length===0)return null;const O=T?e.material:[e.material],P=T?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let I=0,j=P.length;I<j;I++){const z={mode:c,attributes:p};if(this.serializeUserData(a,z),A.length>0&&(z.targets=A),a.index!==null){let G=this.getUID(a.index);P[I].start===void 0&&P[I].count===void 0||(G+=":"+P[I].start+":"+P[I].count),t.attributes.has(G)?z.indices=t.attributes.get(G):(z.indices=this.processAccessor(a.index,a,P[I].start,P[I].count),t.attributes.set(G,z.indices)),z.indices===null&&delete z.indices}const V=this.processMaterial(O[P[I].materialIndex]);V!==null&&(z.material=V),m.push(z)}d.primitives=m,n.meshes||(n.meshes=[]),this._invokeAll(function(I){I.writeMesh&&I.writeMesh(e,d)});const R=n.meshes.push(d)-1;return t.meshes.set(o,R),R}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:f.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);const o=(e=ic.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],c=[];for(let d=0;d<o.length;++d){const p=o[d],m=f.iUV.parseTrackName(p.name);let A=f.iUV.findNode(t,m.nodeName);const x=Ns[m.propertyName];if(m.objectName==="bones"&&(A=A.isSkinnedMesh===!0?A.skeleton.getBoneByName(m.objectIndex):void 0),!A||!x)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',p.name),null;const E=1;let M,T=p.values.length/p.times.length;x===Ns.morphTargetInfluences&&(T/=A.morphTargetInfluences.length),p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(M="CUBICSPLINE",T/=3):M=p.getInterpolation()===f.Syv?"STEP":"LINEAR",c.push({input:this.processAccessor(new f.TlE(p.times,E)),output:this.processAccessor(new f.TlE(p.values,T)),interpolation:M}),a.push({sampler:c.length-1,target:{node:r.get(A),path:x}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:c,channels:a}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const c=[],d=new Float32Array(16*o.bones.length),p=new f.yGw;for(let m=0;m<o.bones.length;++m)c.push(n.get(o.bones[m])),p.copy(o.boneInverses[m]),p.multiply(e.bindMatrix).toArray(d,16*m);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new f.TlE(d,16)),joints:c,skeleton:n.get(a)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const o={};if(n.trs){const c=e.quaternion.toArray(),d=e.position.toArray(),p=e.scale.toArray();_l(c,[0,0,0,1])||(o.rotation=c),_l(d,[0,0,0])||(o.translation=d),_l(p,[1,1,1])||(o.scale=p)}else e.matrixAutoUpdate&&e.updateMatrix(),_l(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(o.mesh=c)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let d=0,p=e.children.length;d<p;d++){const m=e.children[d];if(m.visible||n.onlyVisible===!1){const A=this.processNode(m);A!==null&&c.push(A)}}c.length>0&&(o.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,o)});const a=t.nodes.push(o)-1;return r.set(e,a),a}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const o=[];for(let a=0,c=e.children.length;a<c;a++){const d=e.children[a];if(d.visible||n.onlyVisible===!1){const p=this.processNode(d);p!==null&&o.push(p)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){const t=new f.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const n=[];for(let r=0;r<e.length;r++)e[r]instanceof f.xsS?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class go{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,r=n.json,o=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);const c=r.extensions[this.name].lights;c.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:c.length-1}}}class Kf{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Rw{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};t.pbrMetallicRoughness.baseColorFactor&&(o.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const a=[1,1,1];if(e.specular.toArray(a,0),o.specularFactor=a,o.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(o.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const c={index:n.processTexture(e.specularMap)};n.applyTextureTransform(c,e.specularMap),o.specularGlossinessTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class Cy{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class nM{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class iM{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class rM{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class sM{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const a={index:n.processTexture(e.sheenColorMap)};n.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}if(o.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const a={index:n.processTexture(e.sheenRoughnessMap)};n.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,r[this.name]=!0}}class oM{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}ic.Utils={GLTFWriter:r_,insertKeyframe:function(s,e){const n=s.getValueSize(),r=new s.TimeBufferType(s.times.length+1),o=new s.ValueBufferType(s.values.length+n),a=s.createInterpolant(new s.ValueBufferType(n));let c;if(s.times.length===0){r[0]=e;for(let d=0;d<n;d++)o[d]=0;c=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;r[0]=e,r.set(s.times,1),o.set(a.evaluate(e),0),o.set(s.values,n),c=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;r[r.length-1]=e,r.set(s.times,0),o.set(s.values,0),o.set(a.evaluate(e),s.values.length),c=r.length-1}else for(let d=0;d<s.times.length;d++){if(Math.abs(s.times[d]-e)<.001)return d;if(s.times[d]<e&&s.times[d+1]>e){r.set(s.times.slice(0,d+1),0),r[d+1]=e,r.set(s.times.slice(d+1),d+2),o.set(s.values.slice(0,(d+1)*n),0),o.set(a.evaluate(e),(d+1)*n),o.set(s.values.slice((d+1)*n),(d+2)*n),c=d+1;break}}return s.times=r,s.values=o,c},mergeMorphTargetTracks:function(s,e){const t=[],n={},r=s.tracks;for(let o=0;o<r.length;++o){let a=r[o];const c=f.iUV.parseTrackName(a.name),d=f.iUV.findNode(e,c.nodeName);if(c.propertyName!=="morphTargetInfluences"||c.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(f.NMF)}const p=d.morphTargetInfluences.length,m=d.morphTargetDictionary[c.propertyIndex];if(m===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);let A;if(n[d.uuid]===void 0){A=a.clone();const E=new A.ValueBufferType(p*A.times.length);for(let M=0;M<A.times.length;M++)E[M*p+m]=A.values[M];A.name=(c.nodeName||"")+".morphTargetInfluences",A.values=E,n[d.uuid]=A,t.push(A);continue}const x=a.createInterpolant(new a.ValueBufferType(1));A=n[d.uuid];for(let E=0;E<A.times.length;E++)A.values[E*p+m]=x.evaluate(A.times[E]);for(let E=0;E<a.times.length;E++){const M=this.insertKeyframe(A,a.times[E]);A.values[M*p+m]=a.values[E]}}return s.tracks=t,s}};class C1 extends ic.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new f.Wid}serializeUserData(e,t){const n=e.userData,r={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([o,a])=>{(!a||typeof a=="function"||a.isObject3D||a.isTexture||a.isMaterial||a.assetType!=null||o.startsWith("_")||o!=="uuid"&&(Sl.includes(o)||Ah.includes(o)||Aa.includes(o)))&&(r[o]=a,delete n[o])}),super.serializeUserData(e,t),Object.entries(r).forEach(([o,a])=>{n[o]=a,delete r[o]})}processObjects(e){var t;e.length===1&&(!((t=e[0])===null||t===void 0)&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(!e||t===e)return n;const r=JSON.stringify(this.json.materials[n]),o=JSON.parse(r);this.serializeUserData(e,o),this._invokeAll(c=>{c.writeMaterial&&c.writeMaterial(e,o)});const a=this.json.materials.push(o)-1;return this.cache.materials.set(e,a),a}processImageBlob(e,t){if(!e)return-1;const n=this.cache,r=this.options,o=this.pending,a=this.json,c=t.image;n.images.has(c)||n.images.set(c,{});const d=n.images.get(c),p=e.type+":flipY/"+t.flipY.toString();if(d[p]!==void 0)return d[p];a.images||(a.images=[]);const m={mimeType:e.type};r.binary===!0?o.push(new Promise(x=>{this.processBufferViewImage(e).then(E=>{m.bufferView=E,x()})})):o.push(Nr(e).then(x=>{m.uri=x}));const A=a.images.push(m)-1;return d[p]=A,A}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const r=e.source.data,o=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const a=super.processTexture(e),c=n.textures[a];if(!c)return console.error("No texture def",a,e),a;const d=n.images?n.images[c.source]:null;if(d&&(d.extras||(d.extras={}),e.source&&(d.extras.uuid=e.source.uuid),d.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=r,e.userData.mimeType=o,!c)return console.error("textureDef is null",a,e),a;c.source>=0?console.warn("textureDef.source is already set",a,e):c.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,o)}return c.source<0&&console.error("textureDef.source cannot be saved",c,e),a}processImage(e,t,n,r="image/png"){return e?super.processImage(e,t,n,r):-1}processImageUri(e,t,n,r="image/png"){const o=this.cache,a=this.json;o.images.has(e)||o.images.set(e,{});const c=o.images.get(e),d=r+":flipY/"+n.toString();if(c[d]!==void 0)return c[d];a.images||(a.images=[]);const p={mimeType:r,uri:t,extras:{flipY:n}},m=a.images.push(p)-1;return c[d]=m,m}}class Bw extends ic{register(e){return super.register(e)}async parseAsync(e,t){var n;if(!e)throw new Error("No object to export");const r=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((o,a)=>this.parse(e,o,a,t));if(r&&typeof r=="object"&&!r.byteLength)return new Blob([JSON.stringify(r,(o,a)=>o.startsWith("__")?void 0:a,(n=t.jsonSpaces)!==null&&n!==void 0?n:2)],{type:"model/gltf+json"});if(r)return new Blob([r],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,r={}){var o;const a={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!r.embedUrlImages&&r.externalImagesInExtras||!1,embedUrlImages:(o=r.embedUrlImages)!==null&&o!==void 0&&o,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return r.exportExt==="glb"&&(a.binary=!0),r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(d=>{d.uuid&&(d.userData.gltfUUID=d.uuid)})),(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(d=>{if(d.animations)for(const p of d.animations)p.__gltfExport===!1||a.animations.includes(p)||a.animations.push(...d.animations)})),super.parse(e,c=>{r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(d=>d.traverse(p=>{delete p.userData.gltfUUID})),t(Object.assign(c,{__isGLTFOutput:!0}))},n,a,new C1)}}function S1(s,e){const t=s.getPlugin(ln).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&Object.entries(t.resources.textures).forEach(([r,o])=>{e.json.textures.find(c=>{var d,p,m,A,x;return((d=c.extras)===null||d===void 0?void 0:d.uuid)===r||((m=(p=e.json.samplers[c.sampler])===null||p===void 0?void 0:p.extras)===null||m===void 0?void 0:m.uuid)===r||((x=(A=e.json.images[c.source])===null||A===void 0?void 0:A.extras)===null||x===void 0?void 0:x.t_uuid)===r})&&(o.image&&t.resources.images&&t.resources.images[o.image]&&delete t.resources.images[o.image],t.resources.textures[r]={})}),e.json.materials&&t.resources.materials&&Object.entries(t.resources.materials).forEach(([r,o])=>{e.json.materials.find(c=>{var d;return((d=c.extras)===null||d===void 0?void 0:d.uuid)===r})&&(t.resources.materials[r]={})});const n=[];Object.values(t.resources).forEach(r=>{Object.values(r).forEach(o=>{o.url&&(o.url.type==="Uint16Array"&&o.url.data&&(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),n.push(o.url)),o.url.type==="Uint8Array"&&o.url.data&&(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),n.push(o.url)))})});for(const r of n){let o="application/octet-stream";if(r.type==="Uint16Array"){const p=aM(r.data,4),m=new ImageData(p,r.width,r.height),A=f.PpQ.getDataURL(m,!0).split(",")[1];o="image/png",r.data=atob(A),r.encoding="rgbe"}const a=new Blob([r.data],{type:o});e.json.images||(e.json.images=[]);const c={mimeType:o},d=e.json.images.push(c)-1;r.data={image:d},e.pending.push(e.processBufferViewImage(a).then(p=>{c.bufferView=p}))}return t}function aM(s,e=3,t){let n,r,o,a,c;const d=s.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*d);for(let p=0;p<d;p++){n=s[p*e],r=s[p*e+1],o=s[p*e+2],a=Math.max(Math.max(n,r),o);const m=Math.ceil(Math.log2(a));c=Math.pow(2,m-8),t[4*p]=n/c|0,t[4*p+1]=r/c|0,t[4*p+2]=o/c|0,t[4*p+3]=m+128}return t}function kw(s,e=Bw,t){var n;if(!s)return;const r=Ju.Exporters.findIndex(a=>a.ext.includes("gltf")||a.ext.includes("glb")),o=[];r>=0?(o.push(...(n=Ju.Exporters[r].extensions)!==null&&n!==void 0?n:[]),Ju.Exporters.splice(r,1)):(o.push(uM),o.push(cM),o.push(lM),o.push(a=>new hM(a)),o.push(a=>new dM(a)),o.push(a=>new pM(a)),o.push(a=>new fM(a))),Ju.Exporters.push({ctor:()=>{const a=new e;return o.forEach(c=>a.register(c)),a.register(c=>({afterParse:d=>{var p,m;if(!(!((p=(d=Array.isArray(d)?d[0]:d)==null?void 0:d.userData)===null||p===void 0)&&p.rootSceneModelRoot)||((m=d==null?void 0:d.userData)===null||m===void 0?void 0:m.__exportViewerConfig)===!1)return;const A=c.json.scenes[c.json.scene||0];A.extensions||(A.extensions={}),A.extensions[Mo]=S1(s,c),c.extensionsUsed[Mo]=!0}})),t==null||t(a),a},ext:["gltf","glb"],extensions:o})}const lM=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[he]=n,s.extensionsUsed[he]=!0)}}),cM=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[$a]=n,s.extensionsUsed[$a]=!0)}}),uM=s=>({writeMaterial(e,t){var n;if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const r={};if(e.emissiveIntensity!==void 0&&(!((n=e.emissive)===null||n===void 0)&&n.isColor)){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),c=Math.max(a.r,a.g,a.b);c>1&&(r.emissiveIntensity=c)}e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.side!==void 0&&e.side!==f.ehD&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped);const o=this.materialExternalResources[e.uuid];o&&Object.entries(o).forEach(([a,c])=>{a.startsWith("_")||(r[a]=yi(c,!1,this.serializedMeta))}),Object.keys(r).length>0&&(t.extensions[To]=r,s.extensionsUsed[To]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!s.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(r=>{var o;r&&(!((o=r.material)===null||o===void 0)&&o.isMaterial)&&t.push(r.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([r,o])=>{r.startsWith("_")||o&&o.isTexture&&o.userData.rootPath&&(n[r]=null,this.materialExternalResources[n.uuid][r]=o)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(r=>{const o=r.__materialRef;o&&(Object.entries(r).forEach(([a,c])=>{a.startsWith("_")||c&&(o[a]=c)}),delete this.materialExternalResources[o.uuid])});const n=s.json.scenes[s.json.scene||0];n.extensions||(n.extensions={}),n.extensions[To]={resources:this.serializedMeta},s.extensionsUsed[To]=!0}});class hM{constructor(e){this.writer=e,this.name=$o}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.bumpScale=e.bumpScale,e.bumpMap){const a={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class dM{constructor(e){this.writer=e,this.name=Nl}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.displacementScale=e.displacementScale,o.displacementBias=e.displacementBias,e.displacementMap){const a={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(a,e.displacementMap),o.displacementTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class pM{constructor(e){this.writer=e,this.name=ea}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.lightMapIntensity=e.lightMapIntensity,e.lightMap){const a={index:n.processTexture(e.lightMap)};n.applyTextureTransform(a,e.lightMap),o.lightMapTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class fM{constructor(e){this.writer=e,this.name=tl}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,r=n.extensionsUsed,o={};if(e.alphaMap){const a={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(a,e.alphaMap),o.alphaTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class Ju extends ct{constructor(e,t={}){super(),this._processors=new vu,this._cachedParsers=[],kw(e)}get processors(){return this._processors}getExporter(...e){return Ju.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}async exportObject(e,t={}){var n,r,o,a;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((r=(n=e)===null||n===void 0?void 0:n.userData)===null||r===void 0)&&r.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const c=await this._exportFile(e,t);return!((a=(o=e)===null||o===void 0?void 0:o.userData)===null||a===void 0)&&a.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,c}async _exportFile(e,t={}){var n,r,o;let a;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const c=await this.processBeforeExport(e,t),d=(r=(n=t.exportExt)!==null&&n!==void 0?n:c==null?void 0:c.typeExt)!==null&&r!==void 0?r:c==null?void 0:c.ext;if(!c||!d)throw new Error(`Unable to preprocess before export ${d}`);const p=this._getParser(d);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const m=await p.parseAsync(c.obj,{exportExt:(o=c.ext)!==null&&o!==void 0?o:d,...t});m.ext=c.ext,a=m}catch(c){return console.error("AssetExporter: Unable to Export file",e),console.error(c),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:c})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),a}_createParser(e){const t=Ju.Exporters.find(r=>r.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t,n;return(n=(t=this._cachedParsers.find(r=>r.ext.includes(e)))===null||t===void 0?void 0:t.parser)!==null&&n!==void 0?n:this._createParser(e)}async processBeforeExport(e,t={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,t)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}Ju.Exporters=[{ctor:()=>new Ey,ext:["json"]},{ctor:()=>new nc,ext:["txt","text"]}];class s_ extends Zn{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new Ju(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var r;return n.convertMeshToIndexed&&((r=t.modelObject)===null||r===void 0||r.traverse(o=>{var a;o.geometry&&(o.geometry.attributes.index||(a=o.setGeometry)===null||a===void 0||a.call(o,Bi(o.geometry)))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(t=this.exporter)===null||t===void 0?void 0:t.exportObject((n=this._viewer)===null||n===void 0?void 0:n.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var r;typeof((r=n.plugin)===null||r===void 0?void 0:r.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,r])=>typeof(r==null?void 0:r.toJSON)=="function").map(([n,r])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const n=await this.exportScene(this.exportOptions);n&&Jr(n,this.exportOptions.name+"."+n.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var r;n.value=!1,(r=n.uiRefresh)===null||r===void 0||r.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var r;n.value=!0,(r=n.uiRefresh)===null||r===void 0||r.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(ln).exportPluginPresets(t.filter(r=>!!r.value).map(r=>ke(r.label)||"")),null,2)],{type:"application/json"});n&&Jr(n,this.exportOptions.name+"."+ln.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(ln).exportViewerConfig(),null,2)],{type:"application/json"});n&&Jr(n,this.exportOptions.name+"."+ln.ViewerTypeSlug)}}]}]}}}s_.PluginType="AssetExporterPlugin";class Ow{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Zu extends Ow{constructor(e,t,n,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=r,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class mM extends Ow{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(r=>t(r.getParent()))),n.forEach(r=>r.dispose()),this}createEdge(e,t,n,r){return this._registerEdge(new Zu(e,t,n,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function o_(){return o_=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},o_.apply(this,arguments)}function Lw(s){return s instanceof Zu}function Nw(s){return Array.isArray(s)&&s[0]instanceof Zu}function Uw(s){return!!(s&&typeof s=="object"&&Object.values(s)[0]instanceof Zu)}const sr=Symbol("attributes"),ev=Symbol("immutableKeys");class Fw extends Ow{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[sr]=void 0,this[ev]=void 0,this.graph=e,this[ev]=new Set,this[sr]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const r=e[n];if(r instanceof Fw){const o=this.graph.createEdge(n,this,r);o.addEventListener("dispose",()=>r.dispose()),this[ev].add(n),t[n]=o}else t[n]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[sr]){const r=this[sr][n];if(Lw(r)){const o=r;o.getChild()===e&&this.setRef(n,t,o.getAttributes())}else if(Nw(r)){const o=r.find(a=>a.getChild()===e);if(o){const a=o.getAttributes();this.removeRef(n,e).addRef(n,t,a)}}else if(Uw(r)){const o=r;for(const a in o){const c=o[a];c.getChild()===e&&this.setRefMap(n,a,t,c.getAttributes())}}}return this}get(e){return this[sr][e]}set(e,t){return this[sr][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[sr][e];return t?t.getChild():null}setRef(e,t,n){if(this[ev].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[sr][e];if(r&&r.dispose(),!t)return this;const o=this.graph.createEdge(e,this,t,n);return o.addEventListener("dispose",()=>{delete this[sr][e],this.dispatchEvent({type:"change",attribute:e})}),this[sr][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[sr][e].map(t=>t.getChild())}addRef(e,t,n){const r=this.graph.createEdge(e,this,t,n),o=this[sr][e];return o.push(r),r.addEventListener("dispose",()=>{const a=o.filter(c=>c!==r);o.length=0;for(const c of a)o.push(c);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[sr][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[sr][e])}listRefMapValues(e){return Object.values(this[sr][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[sr][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,r){const o=this[sr][e],a=o[t];if(a&&a.dispose(),!n)return this;r=Object.assign(r||{},{key:t});const c=this.graph.createEdge(e,this,n,o_({},r,{key:t}));return c.addEventListener("dispose",()=>{delete o[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),o[t]=c,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(o_({},e,{target:this})),this.graph.dispatchEvent(o_({},e,{target:this,type:`node:${e.type}`})),this}}var Sy,an,My,iu,cs,rc,jw=typeof Float32Array<"u"?Float32Array:Array;function zw(s){var e=s[0],t=s[1],n=s[2];return Math.hypot(e,t,n)}function gM(s,e,t){var n=e[0],r=e[1],o=e[2],a=t[3]*n+t[7]*r+t[11]*o+t[15];return a=a||1,s[0]=(t[0]*n+t[4]*r+t[8]*o+t[12])/a,s[1]=(t[1]*n+t[5]*r+t[9]*o+t[13])/a,s[2]=(t[2]*n+t[6]*r+t[10]*o+t[14])/a,s}function vM(s,e,t){var n=e[0],r=e[1],o=e[2],a=e[3],c=e[4],d=e[5],p=e[6],m=e[7],A=e[8],x=e[9],E=e[10],M=e[11],T=e[12],O=e[13],P=e[14],R=e[15],I=t[0],j=t[1],z=t[2],V=t[3];return s[0]=I*n+j*c+z*A+V*T,s[1]=I*r+j*d+z*x+V*O,s[2]=I*o+j*p+z*E+V*P,s[3]=I*a+j*m+z*M+V*R,I=t[4],j=t[5],z=t[6],V=t[7],s[4]=I*n+j*c+z*A+V*T,s[5]=I*r+j*d+z*x+V*O,s[6]=I*o+j*p+z*E+V*P,s[7]=I*a+j*m+z*M+V*R,I=t[8],j=t[9],z=t[10],V=t[11],s[8]=I*n+j*c+z*A+V*T,s[9]=I*r+j*d+z*x+V*O,s[10]=I*o+j*p+z*E+V*P,s[11]=I*a+j*m+z*M+V*R,I=t[12],j=t[13],z=t[14],V=t[15],s[12]=I*n+j*c+z*A+V*T,s[13]=I*r+j*d+z*x+V*O,s[14]=I*o+j*p+z*E+V*P,s[15]=I*a+j*m+z*M+V*R,s}function _M(s,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of s.listPrimitives()){const r=n.getAttribute("POSITION");if(!r)continue;let o=[0,0,0],a=[0,0,0];for(let c=0;c<r.getCount();c++)o=r.getElement(c,o),a=gM(a,o,e),Qw(a,t)}return t}function Qw(s,e){for(let t=0;t<3;t++)e.min[t]=Math.min(s[t],e.min[t]),e.max[t]=Math.max(s[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)}),Sy=new jw(3),jw!=Float32Array&&(Sy[0]=0,Sy[1]=0,Sy[2]=0),function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"}(an||(an={})),function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"}(My||(My={})),function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER"}(iu||(iu={})),function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"}(cs||(cs={})),function(s){s.GLTF="GLTF",s.GLB="GLB"}(rc||(rc={}));class Di{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const r=new Uint8Array(n);if(r.set(e),t!==0)for(let o=e.byteLength;o<n;o++)r[o]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class ja{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,r,o]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*r<<8^255*o<<0}static convertSRGBToLinear(e,t){const n=e,r=t;for(let o=0;o<3;o++)r[o]=n[o]<.04045?.0773993808*n[o]:Math.pow(.9478672986*n[o]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,r=t;for(let o=0;o<3;o++)r[o]=n[o]<.0031308?12.92*n[o]:1.055*Math.pow(n[o],.41666)-.055;return t}}class Ty{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return Di.decodeText(e.slice(12,16))===Ty.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Ty.PNG_FRIED_CHUNK_NAME="CgBI";class $h{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let n=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)n+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function AM(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}$h.impls={"image/jpeg":new class{match(s){return s.length>=3&&s[0]===255&&s[1]===216&&s[2]===255}getSize(s){let e,t,n=new DataView(s.buffer,s.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),AM(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(s.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(s){return 3}},"image/png":new Ty};class Jf{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return $h.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function M1(s){return Object.prototype.toString.call(s)==="[object Object]"}function ed(s){if(M1(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const t=e.prototype;return M1(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}class Al{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Al.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Al.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Al.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Al.Verbosity.ERROR&&console.error(e)}}Al.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},Al.DEFAULT_INSTANCE=new Al(Al.Verbosity.INFO);class Yr{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,n,r){let o=zw([e[0],e[1],e[2]]);const a=zw([e[4],e[5],e[6]]),c=zw([e[8],e[9],e[10]]);(function(x){var E=x[0],M=x[1],T=x[2],O=x[3],P=x[4],R=x[5],I=x[6],j=x[7],z=x[8],V=x[9],G=x[10],X=x[11],ne=x[12],ce=x[13],ge=x[14],de=x[15];return(E*R-M*P)*(G*de-X*ge)-(E*I-T*P)*(V*de-X*ce)+(E*j-O*P)*(V*ge-G*ce)+(M*I-T*R)*(z*de-X*ne)-(M*j-O*R)*(z*ge-G*ne)+(T*j-O*I)*(z*ce-V*ne)})(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const d=e.slice(),p=1/o,m=1/a,A=1/c;d[0]*=p,d[1]*=p,d[2]*=p,d[4]*=m,d[5]*=m,d[6]*=m,d[8]*=A,d[9]*=A,d[10]*=A,function(x,E){var M=new jw(3);(function(xe,pe){var ye=pe[0],Re=pe[1],we=pe[2],We=pe[4],ot=pe[5],ft=pe[6],nt=pe[8],Rt=pe[9],Nt=pe[10];xe[0]=Math.hypot(ye,Re,we),xe[1]=Math.hypot(We,ot,ft),xe[2]=Math.hypot(nt,Rt,Nt)})(M,E);var T=1/M[0],O=1/M[1],P=1/M[2],R=E[0]*T,I=E[1]*O,j=E[2]*P,z=E[4]*T,V=E[5]*O,G=E[6]*P,X=E[8]*T,ne=E[9]*O,ce=E[10]*P,ge=R+V+ce,de=0;ge>0?(de=2*Math.sqrt(ge+1),x[3]=.25*de,x[0]=(G-ne)/de,x[1]=(X-j)/de,x[2]=(I-z)/de):R>V&&R>ce?(de=2*Math.sqrt(1+R-V-ce),x[3]=(G-ne)/de,x[0]=.25*de,x[1]=(I+z)/de,x[2]=(X+j)/de):V>ce?(de=2*Math.sqrt(1+V-R-ce),x[3]=(X-j)/de,x[0]=(I+z)/de,x[1]=.25*de,x[2]=(G+ne)/de):(de=2*Math.sqrt(1+ce-R-V),x[3]=(I-z)/de,x[0]=(X+j)/de,x[1]=(G+ne)/de,x[2]=.25*de)}(n,d),r[0]=o,r[1]=a,r[2]=c}static compose(e,t,n,r){const o=r,a=t[0],c=t[1],d=t[2],p=t[3],m=a+a,A=c+c,x=d+d,E=a*m,M=a*A,T=a*x,O=c*A,P=c*x,R=d*x,I=p*m,j=p*A,z=p*x,V=n[0],G=n[1],X=n[2];return o[0]=(1-(O+R))*V,o[1]=(M+z)*V,o[2]=(T-j)*V,o[3]=0,o[4]=(M-z)*G,o[5]=(1-(E+R))*G,o[6]=(P+I)*G,o[7]=0,o[8]=(T+j)*X,o[9]=(P-I)*X,o[10]=(1-(E+O))*X,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function yM(s,e){if(!!s!=!!e)return!1;const t=s.getChild(),n=e.getChild();return t===n||t.equals(n)}function bM(s,e){if(!!s!=!!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++){const n=s[t],r=e[t];if(n.getChild()!==r.getChild()&&!n.getChild().equals(r.getChild()))return!1}return!0}function wM(s,e){if(!!s!=!!e)return!1;const t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r in s){const o=s[r],a=e[r];if(!!o!=!!a)return!1;const c=o.getChild(),d=a.getChild();if(c!==d&&!c.equals(d))return!1}return!0}function T1(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function I1(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!ed(s)||!ed(e))return s===e;const t=s,n=e;let r,o=0,a=0;for(r in t)o++;for(r in n)a++;if(o!==a)return!1;for(r in t){const c=t[r],d=n[r];if(Iy(c)&&Iy(d)){if(!T1(c,d))return!1}else if(ed(c)&&ed(d)){if(!I1(c,d))return!1}else if(c!==d)return!1}return!0}function Iy(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const D1="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",P1=new Set,xM=function(){let s="";for(let e=0;e<6;e++)s+=D1.charAt(Math.floor(Math.random()*D1.length));return s};class mp{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return Jf.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Jf.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),r=t.split("/");n.pop();for(let o=0;o<r.length;o++)r[o]!=="."&&(r[o]===".."?n.pop():n.push(r[o]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}mp.DEFAULT_INIT={},mp.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const $u=s=>s,EM=new Set;class Vw extends Fw{constructor(e,t=""){super(e),this[sr].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,$u)}copy(e,t=$u){for(const n in this[sr]){const r=this[sr][n];if(r instanceof Zu)this[ev].has(n)||r.dispose();else if(Array.isArray(r)&&r[0]instanceof Zu)for(const o of r)o.dispose();else if(ed(r)&&Object.values(r)[0]instanceof Zu)for(const o in r)r[o].dispose()}for(const n in e[sr]){const r=this[sr][n],o=e[sr][n];if(o instanceof Zu)this[ev].has(n)?r.getChild().copy(t(o.getChild()),t):this.setRef(n,t(o.getChild()),o.getAttributes());else if(Array.isArray(o)&&o[0]instanceof Zu)for(const a of o)this.addRef(n,t(a.getChild()),a.getAttributes());else if(ed(o)&&Object.values(o)[0]instanceof Zu)for(const a in o){const c=o[a];this.setRefMap(n,a,t(c.getChild()),c.getAttributes())}else this[sr][n]=ed(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=EM){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[sr]){if(t.has(n))continue;const r=this[sr][n],o=e[sr][n];if(Lw(r)||Lw(o)){if(!yM(r,o))return!1}else if(Nw(r)||Nw(o)){if(!bM(r,o))return!1}else if(Uw(r)||Uw(o)){if(!wM(r,o))return!1}else if(ed(r)||ed(o)){if(!I1(r,o))return!1}else if(Iy(r)||Iy(o)){if(!T1(r,o))return!1}else if(r!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ua extends Vw{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class En extends ua{constructor(...e){super(...e),this.i=Yr.identity,this.o=Yr.identity}init(){this.propertyType=an.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:En.Type.SCALAR,componentType:En.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=$u){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case En.Type.SCALAR:return 1;case En.Type.VEC2:return 2;case En.Type.VEC3:return 3;case En.Type.VEC4:case En.Type.MAT2:return 4;case En.Type.MAT3:return 9;case En.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case En.ComponentType.BYTE:case En.ComponentType.UNSIGNED_BYTE:return 1;case En.ComponentType.SHORT:case En.ComponentType.UNSIGNED_SHORT:return 2;case En.ComponentType.UNSIGNED_INT:case En.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=1/0;for(let o=0;o<n*r;o+=r)for(let a=0;a<r;a++){const c=t[o+a];Number.isFinite(c)&&(e[a]=Math.min(e[a],c))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=-1/0;for(let o=0;o<n*r;o+=r)for(let a=0;a<r;a++){const c=t[o+a];Number.isFinite(c)&&(e[a]=Math.max(e[a],c))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return En.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Yr.denormalize(t,this.get("componentType")),this.i=t=>Yr.normalize(t,this.get("componentType"))):(this.o=Yr.identity,this.i=Yr.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let o=0;o<n;o++)t[o]=this.o(r[e*n+o]);return t}setElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let o=0;o<n;o++)r[e*n+o]=this.i(t[o]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return En.ComponentType.FLOAT;case Uint32Array:return En.ComponentType.UNSIGNED_INT;case Uint16Array:return En.ComponentType.UNSIGNED_SHORT;case Uint8Array:return En.ComponentType.UNSIGNED_BYTE;case Int16Array:return En.ComponentType.SHORT;case Int8Array:return En.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):En.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}En.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},En.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class R1 extends ua{init(){this.propertyType=an.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Gw extends ua{init(){this.propertyType=an.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Gw.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class tv extends ua{init(){this.propertyType=an.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:tv.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:iu.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:iu.OTHER})}}tv.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class B1 extends ua{init(){this.propertyType=an.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Zf extends ua{init(){this.propertyType=an.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Zf.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Zf.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class us extends Vw{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}us.EXTENSION_NAME=void 0;class Br extends ua{init(){this.propertyType=an.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Br.WrapMode.REPEAT,wrapT:Br.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Br.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Br.MagFilter={NEAREST:9728,LINEAR:9729},Br.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Dy,G:Py,B:Ry,A:CM}=cs;class $f extends ua{init(){this.propertyType=an.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:$f.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Br(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Br(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Br(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Br(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Br(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return ja.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",ja.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Dy|Py|Ry|CM})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return ja.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",ja.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Dy|Py|Ry})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Dy|Py|Ry})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Dy})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Py|Ry})}}$f.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class k1 extends ua{init(){this.propertyType=an.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class By extends ua{constructor(...e){super(...e),this.u=null}init(){this.propertyType=an.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=$u){if(t===$u)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Yr.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),r=this.get("scale").slice();return Yr.decompose(e,t,n,r),this.set("translation",t).set("rotation",n).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return Yr.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Yr.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Yr.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r instanceof By;r=r.u)e.push(r);let t;const n=e.pop().getMatrix();for(;t=e.pop();)vM(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[sr].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class em extends ua{init(){this.propertyType=an.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:em.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:iu.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:iu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}em.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class SM extends Vw{init(){this.propertyType=an.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:iu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function za(){return(za=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}class O1 extends ua{init(){this.propertyType=an.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=$u){if(t===$u)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[sr].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class L1 extends ua{init(){this.propertyType=an.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:iu.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class N1 extends ua{init(){this.propertyType=an.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||$h.extensionToMimeType(Jf.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",$h.extensionToMimeType(Jf.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",Di.assertView(e))}getSize(){const e=this.get("image");return e?$h.getSize(e,this.getMimeType()):null}}class U1 extends ua{init(){this.propertyType=an.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=$u){if(t===$u)throw new Error("Root cannot be copied.");this.set("asset",za({},e.get("asset"))),this.setName(e.getName()),this.setExtras(za({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const r=e.getExtension(n);this.setExtension(n,t(r))}return this}l(e){return e instanceof O1?this.addRef("scenes",e):e instanceof By?this.addRef("nodes",e):e instanceof Zf?this.addRef("cameras",e):e instanceof L1?this.addRef("skins",e):e instanceof k1?this.addRef("meshes",e):e instanceof $f?this.addRef("materials",e):e instanceof N1?this.addRef("textures",e):e instanceof R1?this.addRef("animations",e):e instanceof En?this.addRef("accessors",e):e instanceof B1&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Hw{constructor(){this.m=new mM,this.T=new U1(this.m),this.v=Al.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new Hw().setLogger(this.v).merge(this)}merge(e){for(const o of e.getRoot().listExtensionsUsed()){const a=this.createExtension(o.constructor);o.isRequired()&&a.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const o of e.m.listEdges())for(const a of[o.getParent(),o.getChild()]){if(t.has(a))continue;let c;c=a.propertyType===an.TEXTURE_INFO?a:new a.constructor(this.m),n.set(a,c),t.add(a)}const r=o=>{const a=n.get(o);if(!a)throw new Error("Could resolve property.");return a};for(const o of t){const a=n.get(o);if(!a)throw new Error("Could resolve property.");a.propertyType!==an.TEXTURE_INFO&&a.copy(o,r)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new O1(this.m,e)}createNode(e=""){return new By(this.m,e)}createCamera(e=""){return new Zf(this.m,e)}createSkin(e=""){return new L1(this.m,e)}createMesh(e=""){return new k1(this.m,e)}createPrimitive(){return new em(this.m)}createPrimitiveTarget(e=""){return new SM(this.m,e)}createMaterial(e=""){return new $f(this.m,e)}createTexture(e=""){return new N1(this.m,e)}createAnimation(e=""){return new R1(this.m,e)}createAnimationChannel(e=""){return new Gw(this.m,e)}createAnimationSampler(e=""){return new tv(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new En(this.m,e).setBuffer(t)}createBuffer(e=""){return new B1(this.m,e)}}class Fr{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const r=n,o=r.target;o instanceof us&&o.extensionName===this.extensionName&&(r.type==="node:create"&&this.M(o),r.type==="node:dispose"&&this.I(o))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Fr.EXTENSION_NAME=void 0;class MM{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const r=this.jsonDoc.json.samplers[n.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const Ww={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F1={logger:Al.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function ky(s,e){const t=e.bufferViews[s.bufferView],n=e.jsonDoc.json.bufferViews[s.bufferView],r=Ww[s.componentType],o=En.getElementSize(s.type),a=r.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==o*a)return function(d,p){const m=p.bufferViews[d.bufferView],A=p.jsonDoc.json.bufferViews[d.bufferView],x=Ww[d.componentType],E=En.getElementSize(d.type),M=x.BYTES_PER_ELEMENT,T=d.byteOffset||0,O=new x(d.count*E),P=new DataView(m.buffer,m.byteOffset,m.byteLength),R=A.byteStride;for(let I=0;I<d.count;I++)for(let j=0;j<E;j++){const z=T+I*R+j*M;let V;switch(d.componentType){case En.ComponentType.FLOAT:V=P.getFloat32(z,!0);break;case En.ComponentType.UNSIGNED_INT:V=P.getUint32(z,!0);break;case En.ComponentType.UNSIGNED_SHORT:V=P.getUint16(z,!0);break;case En.ComponentType.UNSIGNED_BYTE:V=P.getUint8(z);break;case En.ComponentType.SHORT:V=P.getInt16(z,!0);break;case En.ComponentType.BYTE:V=P.getInt8(z);break;default:throw new Error(`Unexpected componentType "${d.componentType}".`)}O[I*E+j]=V}return O}(s,e);const c=t.byteOffset+(s.byteOffset||0);return new r(t.buffer.slice(c,c+s.count*o*a))}var a_;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a_||(a_={}));class sc{constructor(e,t,n){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=n;const r=e.getRoot(),o=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new j1(o>1,n.basename),this.imageURIGenerator=new j1(a>1,n.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(n);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(o);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const c={index:this.textureDefIndexMap.get(a)};return t.getTexCoord()!==0&&(c.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,c),c}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===rc.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=$h.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const n of this.N.getGraph().listParentEdges(e)){const{usage:r}=n.getAttributes();if(r)return r;n.getParent().propertyType!==an.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return sc.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const n=this.O.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.O.entries()))e[n]=e[n]||[],e[n].push(t);return e}}sc.BufferViewTarget=a_,sc.BufferViewUsage=iu,sc.USAGE_TO_TARGET={[iu.ARRAY_BUFFER]:a_.ARRAY_BUFFER,[iu.ELEMENT_ARRAY_BUFFER]:a_.ELEMENT_ARRAY_BUFFER};class j1{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:qw}=sc;var Oy;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(Oy||(Oy={}));class TM extends class{constructor(){this.v=Al.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=My.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===rc.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(t,n=F1){const r=za({},F1,n),{json:o}=t,a=new Hw;this.validate(t,r);const c=new MM(t),d=o.asset,p=a.getRoot().getAsset();d.copyright&&(p.copyright=d.copyright),d.extras&&(p.extras=d.extras),o.extras!==void 0&&a.getRoot().setExtras(za({},o.extras));const m=o.extensionsUsed||[],A=o.extensionsRequired||[];for(const R of r.extensions)if(m.includes(R.EXTENSION_NAME)){const I=a.createExtension(R).setRequired(A.includes(R.EXTENSION_NAME));for(const j of I.readDependencies)I.install(j,r.dependencies[j])}const x=o.buffers||[];a.getRoot().listExtensionsUsed().filter(R=>R.prereadTypes.includes(an.BUFFER)).forEach(R=>R.preread(c,an.BUFFER)),c.buffers=x.map(R=>{const I=a.createBuffer(R.name);return R.extras&&I.setExtras(R.extras),R.uri&&R.uri.indexOf("__")!==0&&I.setURI(R.uri),I}),c.bufferViewBuffers=(o.bufferViews||[]).map((R,I)=>{if(!c.bufferViews[I]){const j=t.json.buffers[R.buffer];c.bufferViews[I]=Di.toView(j.uri?t.resources[j.uri]:t.resources["@glb.bin"],R.byteOffset||0,R.byteLength)}return c.buffers[R.buffer]}),c.accessors=(o.accessors||[]).map(R=>{const I=a.createAccessor(R.name,c.bufferViewBuffers[R.bufferView]).setType(R.type);if(R.extras&&I.setExtras(R.extras),R.normalized!==void 0&&I.setNormalized(R.normalized),R.bufferView===void 0&&!R.sparse)return I;let j;return j=R.sparse!==void 0?function(z,V){const G=Ww[z.componentType],X=En.getElementSize(z.type);let ne;ne=z.bufferView!==void 0?ky(z,V):new G(z.count*X);const ce=z.sparse,ge=ce.count,de=za({},z,ce.indices,{count:ge,type:"SCALAR"}),xe=za({},z,ce.values,{count:ge}),pe=ky(de,V),ye=ky(xe,V);for(let Re=0;Re<de.count;Re++)for(let we=0;we<X;we++)ne[pe[Re]*X+we]=ye[Re*X+we];return ne}(R,c):ky(R,c),I.setArray(j),I});const E=o.images||[],M=o.textures||[];a.getRoot().listExtensionsUsed().filter(R=>R.prereadTypes.includes(an.TEXTURE)).forEach(R=>R.preread(c,an.TEXTURE)),c.textures=E.map(R=>{const I=a.createTexture(R.name);if(R.extras&&I.setExtras(R.extras),R.bufferView!==void 0){const j=o.bufferViews[R.bufferView],z=t.json.buffers[j.buffer],V=j.byteOffset||0,G=(z.uri?t.resources[z.uri]:t.resources["@glb.bin"]).slice(V,V+j.byteLength);I.setImage(G)}else R.uri!==void 0&&(I.setImage(t.resources[R.uri]),R.uri.indexOf("__")!==0&&I.setURI(R.uri));if(R.mimeType!==void 0)I.setMimeType(R.mimeType);else if(R.uri){const j=Jf.extension(R.uri);I.setMimeType($h.extensionToMimeType(j))}return I}),c.materials=(o.materials||[]).map(R=>{const I=a.createMaterial(R.name);R.extras&&I.setExtras(R.extras),R.alphaMode!==void 0&&I.setAlphaMode(R.alphaMode),R.alphaCutoff!==void 0&&I.setAlphaCutoff(R.alphaCutoff),R.doubleSided!==void 0&&I.setDoubleSided(R.doubleSided);const j=R.pbrMetallicRoughness||{};if(j.baseColorFactor!==void 0&&I.setBaseColorFactor(j.baseColorFactor),R.emissiveFactor!==void 0&&I.setEmissiveFactor(R.emissiveFactor),j.metallicFactor!==void 0&&I.setMetallicFactor(j.metallicFactor),j.roughnessFactor!==void 0&&I.setRoughnessFactor(j.roughnessFactor),j.baseColorTexture!==void 0){const z=j.baseColorTexture;I.setBaseColorTexture(c.textures[M[z.index].source]),c.setTextureInfo(I.getBaseColorTextureInfo(),z)}if(R.emissiveTexture!==void 0){const z=R.emissiveTexture;I.setEmissiveTexture(c.textures[M[z.index].source]),c.setTextureInfo(I.getEmissiveTextureInfo(),z)}if(R.normalTexture!==void 0){const z=R.normalTexture;I.setNormalTexture(c.textures[M[z.index].source]),c.setTextureInfo(I.getNormalTextureInfo(),z),R.normalTexture.scale!==void 0&&I.setNormalScale(R.normalTexture.scale)}if(R.occlusionTexture!==void 0){const z=R.occlusionTexture;I.setOcclusionTexture(c.textures[M[z.index].source]),c.setTextureInfo(I.getOcclusionTextureInfo(),z),R.occlusionTexture.strength!==void 0&&I.setOcclusionStrength(R.occlusionTexture.strength)}if(j.metallicRoughnessTexture!==void 0){const z=j.metallicRoughnessTexture;I.setMetallicRoughnessTexture(c.textures[M[z.index].source]),c.setTextureInfo(I.getMetallicRoughnessTextureInfo(),z)}return I});const T=o.meshes||[];a.getRoot().listExtensionsUsed().filter(R=>R.prereadTypes.includes(an.PRIMITIVE)).forEach(R=>R.preread(c,an.PRIMITIVE)),c.meshes=T.map(R=>{const I=a.createMesh(R.name);return R.extras&&I.setExtras(R.extras),R.weights!==void 0&&I.setWeights(R.weights),(R.primitives||[]).forEach(j=>{const z=a.createPrimitive();j.extras&&z.setExtras(j.extras),j.material!==void 0&&z.setMaterial(c.materials[j.material]),j.mode!==void 0&&z.setMode(j.mode);for(const[G,X]of Object.entries(j.attributes||{}))z.setAttribute(G,c.accessors[X]);j.indices!==void 0&&z.setIndices(c.accessors[j.indices]);const V=R.extras&&R.extras.targetNames||[];(j.targets||[]).forEach((G,X)=>{const ne=V[X]||X.toString(),ce=a.createPrimitiveTarget(ne);for(const[ge,de]of Object.entries(G))ce.setAttribute(ge,c.accessors[de]);z.addTarget(ce)}),I.addPrimitive(z)}),I}),c.cameras=(o.cameras||[]).map(R=>{const I=a.createCamera(R.name).setType(R.type);if(R.extras&&I.setExtras(R.extras),R.type===Zf.Type.PERSPECTIVE){const j=R.perspective;I.setYFov(j.yfov),I.setZNear(j.znear),j.zfar!==void 0&&I.setZFar(j.zfar),j.aspectRatio!==void 0&&I.setAspectRatio(j.aspectRatio)}else{const j=R.orthographic;I.setZNear(j.znear).setZFar(j.zfar).setXMag(j.xmag).setYMag(j.ymag)}return I});const O=o.nodes||[];a.getRoot().listExtensionsUsed().filter(R=>R.prereadTypes.includes(an.NODE)).forEach(R=>R.preread(c,an.NODE)),c.nodes=O.map(R=>{const I=a.createNode(R.name);if(R.extras&&I.setExtras(R.extras),R.translation!==void 0&&I.setTranslation(R.translation),R.rotation!==void 0&&I.setRotation(R.rotation),R.scale!==void 0&&I.setScale(R.scale),R.matrix!==void 0){const j=[0,0,0],z=[0,0,0,1],V=[1,1,1];Yr.decompose(R.matrix,j,z,V),I.setTranslation(j),I.setRotation(z),I.setScale(V)}return R.weights!==void 0&&I.setWeights(R.weights),I}),c.skins=(o.skins||[]).map(R=>{const I=a.createSkin(R.name);R.extras&&I.setExtras(R.extras),R.inverseBindMatrices!==void 0&&I.setInverseBindMatrices(c.accessors[R.inverseBindMatrices]),R.skeleton!==void 0&&I.setSkeleton(c.nodes[R.skeleton]);for(const j of R.joints)I.addJoint(c.nodes[j]);return I}),O.map((R,I)=>{const j=c.nodes[I];(R.children||[]).forEach(z=>j.addChild(c.nodes[z])),R.mesh!==void 0&&j.setMesh(c.meshes[R.mesh]),R.camera!==void 0&&j.setCamera(c.cameras[R.camera]),R.skin!==void 0&&j.setSkin(c.skins[R.skin])}),c.animations=(o.animations||[]).map(R=>{const I=a.createAnimation(R.name);R.extras&&I.setExtras(R.extras);const j=(R.samplers||[]).map(z=>{const V=a.createAnimationSampler().setInput(c.accessors[z.input]).setOutput(c.accessors[z.output]).setInterpolation(z.interpolation||tv.Interpolation.LINEAR);return z.extras&&V.setExtras(z.extras),I.addSampler(V),V});return(R.channels||[]).forEach(z=>{const V=a.createAnimationChannel().setSampler(j[z.sampler]).setTargetPath(z.target.path);z.target.node!==void 0&&V.setTargetNode(c.nodes[z.target.node]),z.extras&&V.setExtras(z.extras),I.addChannel(V)}),I});const P=o.scenes||[];return a.getRoot().listExtensionsUsed().filter(R=>R.prereadTypes.includes(an.SCENE)).forEach(R=>R.preread(c,an.SCENE)),c.scenes=P.map(R=>{const I=a.createScene(R.name);return R.extras&&I.setExtras(R.extras),(R.nodes||[]).map(j=>c.nodes[j]).forEach(j=>I.addChild(j)),I}),o.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[o.scene]),a.getRoot().listExtensionsUsed().forEach(R=>R.read(c)),a}static validate(t,n){const r=t.json;if(r.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired){for(const o of r.extensionsRequired)if(!n.extensions.find(a=>a.EXTENSION_NAME===o))throw new Error(`Missing required extension, "${o}".`)}if(r.extensionsUsed)for(const o of r.extensionsUsed)n.extensions.find(a=>a.EXTENSION_NAME===o)||n.logger.warn(`Missing optional extension, "${o}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(Di.assertView(e));this.L(t);const n=t.json;if(n.buffers&&n.buffers.some(r=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)}(t,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(r=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)&&a.bufferView===void 0}(t,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(Di.assertView(e)))}async writeJSON(e,t={}){if(t.format===rc.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(n,r){const o=n.getRoot(),a={asset:za({generator:"glTF-Transform v2.2.3"},o.getAsset()),extras:za({},o.getExtras())},c={json:a,resources:{}},d=new sc(n,c,r),p=r.logger||Al.DEFAULT_INSTANCE,m=new Set(r.extensions.map(P=>P.EXTENSION_NAME)),A=n.getRoot().listExtensionsUsed().filter(P=>m.has(P.extensionName)),x=n.getRoot().listExtensionsRequired().filter(P=>m.has(P.extensionName));A.length<n.getRoot().listExtensionsUsed().length&&p.debug("Some extensions were not registered for I/O, and will not be written.");for(const P of A)for(const R of P.writeDependencies)P.install(R,r.dependencies[R]);function E(P,R,I,j){const z=[];let V=0;for(const X of P){const ne=d.createAccessorDef(X);ne.bufferView=a.bufferViews.length;const ce=X.getArray(),ge=Di.pad(Di.toView(ce));ne.byteOffset=V,V+=ge.byteLength,z.push(ge),d.accessorIndexMap.set(X,a.accessors.length),a.accessors.push(ne)}const G={buffer:R,byteOffset:I,byteLength:Di.concat(z).byteLength};return j&&(G.target=j),a.bufferViews.push(G),{buffers:z,byteLength:V}}function M(P,R,I){const j=P[0].getCount();let z=0;for(const ne of P){const ce=d.createAccessorDef(ne);ce.bufferView=a.bufferViews.length,ce.byteOffset=z;const ge=ne.getElementSize(),de=ne.getComponentSize();z+=Di.padNumber(ge*de),d.accessorIndexMap.set(ne,a.accessors.length),a.accessors.push(ce)}const V=j*z,G=new ArrayBuffer(V),X=new DataView(G);for(let ne=0;ne<j;ne++){let ce=0;for(const ge of P){const de=ge.getElementSize(),xe=ge.getComponentSize(),pe=ge.getComponentType(),ye=ge.getArray();for(let Re=0;Re<de;Re++){const we=ne*z+ce+Re*xe,We=ye[ne*de+Re];switch(pe){case En.ComponentType.FLOAT:X.setFloat32(we,We,!0);break;case En.ComponentType.BYTE:X.setInt8(we,We);break;case En.ComponentType.SHORT:X.setInt16(we,We,!0);break;case En.ComponentType.UNSIGNED_BYTE:X.setUint8(we,We);break;case En.ComponentType.UNSIGNED_SHORT:X.setUint16(we,We,!0);break;case En.ComponentType.UNSIGNED_INT:X.setUint32(we,We,!0);break;default:throw new Error("Unexpected component type: "+pe)}}ce+=Di.padNumber(de*xe)}}return a.bufferViews.push({buffer:R,byteOffset:I,byteLength:V,byteStride:z,target:sc.BufferViewTarget.ARRAY_BUFFER}),{byteLength:V,buffers:[new Uint8Array(G)]}}const T=new Map;for(const P of n.getGraph().listEdges()){if(P.getParent()===o)continue;const R=P.getChild();if(R instanceof En){const I=T.get(R)||[];I.push(P),T.set(R,I)}}if(a.accessors=[],a.bufferViews=[],a.samplers=[],a.textures=[],a.images=o.listTextures().map((P,R)=>{const I=d.createPropertyDef(P);P.getMimeType()&&(I.mimeType=P.getMimeType());const j=P.getImage();return j&&d.createImageData(I,j,P),d.imageIndexMap.set(P,R),I}),A.filter(P=>P.prewriteTypes.includes(an.ACCESSOR)).forEach(P=>P.prewrite(d,an.ACCESSOR)),o.listAccessors().forEach(P=>{const R=d.accessorUsageGroupedByParent,I=d.accessorParents;if(d.accessorIndexMap.has(P))return;const j=T.get(P)||[],z=d.getAccessorUsage(P);if(d.addAccessorToUsageGroup(P,z),R.has(z)){const V=j[0].getParent(),G=I.get(V)||new Set;G.add(P),I.set(V,G)}}),A.filter(P=>P.prewriteTypes.includes(an.BUFFER)).forEach(P=>P.prewrite(d,an.BUFFER)),(o.listAccessors().length>0||o.listTextures().length>0||d.otherBufferViews.size>0)&&o.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");a.buffers=[],o.listBuffers().forEach((P,R)=>{const I=d.createPropertyDef(P),j=d.accessorUsageGroupedByParent,z=d.accessorParents,V=P.listParents().filter(de=>de instanceof En),G=new Set(V),X=[],ne=a.buffers.length;let ce=0;const ge=d.listAccessorUsageGroups();for(const de in ge)if(j.has(de))for(const xe of Array.from(z.values())){const pe=Array.from(xe).filter(ye=>G.has(ye)).filter(ye=>d.getAccessorUsage(ye)===de);if(pe.length)if(de!==qw.ARRAY_BUFFER||r.vertexLayout===My.INTERLEAVED){const ye=de===qw.ARRAY_BUFFER?M(pe,ne,ce):E(pe,ne,ce);ce+=ye.byteLength,X.push(...ye.buffers)}else for(const ye of pe){const Re=M([ye],ne,ce);ce+=Re.byteLength,X.push(...Re.buffers)}}else{const xe=ge[de].filter(ye=>G.has(ye));if(!xe.length)continue;const pe=E(xe,ne,ce,de===qw.ELEMENT_ARRAY_BUFFER?sc.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);ce+=pe.byteLength,X.push(...pe.buffers)}if(d.imageBufferViews.length&&R===0){for(let de=0;de<d.imageBufferViews.length;de++)if(a.bufferViews[a.images[de].bufferView].byteOffset=ce,ce+=d.imageBufferViews[de].byteLength,X.push(d.imageBufferViews[de]),ce%8){const xe=8-ce%8;ce+=xe,X.push(new Uint8Array(xe))}}if(d.otherBufferViews.has(P))for(const de of d.otherBufferViews.get(P))a.bufferViews.push({buffer:ne,byteOffset:ce,byteLength:de.byteLength}),d.otherBufferViewsIndexMap.set(de,a.bufferViews.length-1),ce+=de.byteLength,X.push(de);if(ce){let de;r.format===rc.GLB?de="@glb.bin":(de=d.bufferURIGenerator.createURI(P,"bin"),I.uri=de),I.byteLength=ce,c.resources[de]=Di.concat(X)}a.buffers.push(I),d.bufferIndexMap.set(P,R)}),o.listAccessors().find(P=>!P.getBuffer())&&p.warn("Skipped writing one or more Accessors: no Buffer assigned."),a.materials=o.listMaterials().map((P,R)=>{const I=d.createPropertyDef(P);if(P.getAlphaMode()!==$f.AlphaMode.OPAQUE&&(I.alphaMode=P.getAlphaMode()),P.getAlphaMode()===$f.AlphaMode.MASK&&(I.alphaCutoff=P.getAlphaCutoff()),P.getDoubleSided()&&(I.doubleSided=!0),I.pbrMetallicRoughness={},Yr.eq(P.getBaseColorFactor(),[1,1,1,1])||(I.pbrMetallicRoughness.baseColorFactor=P.getBaseColorFactor()),Yr.eq(P.getEmissiveFactor(),[0,0,0])||(I.emissiveFactor=P.getEmissiveFactor()),P.getRoughnessFactor()!==1&&(I.pbrMetallicRoughness.roughnessFactor=P.getRoughnessFactor()),P.getMetallicFactor()!==1&&(I.pbrMetallicRoughness.metallicFactor=P.getMetallicFactor()),P.getBaseColorTexture()){const j=P.getBaseColorTexture(),z=P.getBaseColorTextureInfo();I.pbrMetallicRoughness.baseColorTexture=d.createTextureInfoDef(j,z)}if(P.getEmissiveTexture()){const j=P.getEmissiveTexture(),z=P.getEmissiveTextureInfo();I.emissiveTexture=d.createTextureInfoDef(j,z)}if(P.getNormalTexture()){const j=P.getNormalTexture(),z=P.getNormalTextureInfo(),V=d.createTextureInfoDef(j,z);P.getNormalScale()!==1&&(V.scale=P.getNormalScale()),I.normalTexture=V}if(P.getOcclusionTexture()){const j=P.getOcclusionTexture(),z=P.getOcclusionTextureInfo(),V=d.createTextureInfoDef(j,z);P.getOcclusionStrength()!==1&&(V.strength=P.getOcclusionStrength()),I.occlusionTexture=V}if(P.getMetallicRoughnessTexture()){const j=P.getMetallicRoughnessTexture(),z=P.getMetallicRoughnessTextureInfo();I.pbrMetallicRoughness.metallicRoughnessTexture=d.createTextureInfoDef(j,z)}return d.materialIndexMap.set(P,R),I}),a.meshes=o.listMeshes().map((P,R)=>{const I=d.createPropertyDef(P);let j=null;return I.primitives=P.listPrimitives().map(z=>{const V={attributes:{}};V.mode=z.getMode();const G=z.getMaterial();G&&(V.material=d.materialIndexMap.get(G)),Object.keys(z.getExtras()).length&&(V.extras=z.getExtras());const X=z.getIndices();X&&(V.indices=d.accessorIndexMap.get(X));for(const ne of z.listSemantics())V.attributes[ne]=d.accessorIndexMap.get(z.getAttribute(ne));for(const ne of z.listTargets()){const ce={};for(const ge of ne.listSemantics())ce[ge]=d.accessorIndexMap.get(ne.getAttribute(ge));V.targets=V.targets||[],V.targets.push(ce)}return z.listTargets().length&&!j&&(j=z.listTargets().map(ne=>ne.getName())),V}),P.getWeights().length&&(I.weights=P.getWeights()),j&&(I.extras=I.extras||{},I.extras.targetNames=j),d.meshIndexMap.set(P,R),I}),a.cameras=o.listCameras().map((P,R)=>{const I=d.createPropertyDef(P);if(I.type=P.getType(),I.type===Zf.Type.PERSPECTIVE){I.perspective={znear:P.getZNear(),zfar:P.getZFar(),yfov:P.getYFov()};const j=P.getAspectRatio();j!==null&&(I.perspective.aspectRatio=j)}else I.orthographic={znear:P.getZNear(),zfar:P.getZFar(),xmag:P.getXMag(),ymag:P.getYMag()};return d.cameraIndexMap.set(P,R),I}),a.nodes=o.listNodes().map((P,R)=>{const I=d.createPropertyDef(P);return Yr.eq(P.getTranslation(),[0,0,0])||(I.translation=P.getTranslation()),Yr.eq(P.getRotation(),[0,0,0,1])||(I.rotation=P.getRotation()),Yr.eq(P.getScale(),[1,1,1])||(I.scale=P.getScale()),P.getWeights().length&&(I.weights=P.getWeights()),d.nodeIndexMap.set(P,R),I}),a.skins=o.listSkins().map((P,R)=>{const I=d.createPropertyDef(P),j=P.getInverseBindMatrices();j&&(I.inverseBindMatrices=d.accessorIndexMap.get(j));const z=P.getSkeleton();return z&&(I.skeleton=d.nodeIndexMap.get(z)),I.joints=P.listJoints().map(V=>d.nodeIndexMap.get(V)),d.skinIndexMap.set(P,R),I}),o.listNodes().forEach((P,R)=>{const I=a.nodes[R],j=P.getMesh();j&&(I.mesh=d.meshIndexMap.get(j));const z=P.getCamera();z&&(I.camera=d.cameraIndexMap.get(z));const V=P.getSkin();V&&(I.skin=d.skinIndexMap.get(V)),P.listChildren().length>0&&(I.children=P.listChildren().map(G=>d.nodeIndexMap.get(G)))}),a.animations=o.listAnimations().map((P,R)=>{const I=d.createPropertyDef(P),j=new Map;return I.samplers=P.listSamplers().map((z,V)=>{const G=d.createPropertyDef(z);return G.input=d.accessorIndexMap.get(z.getInput()),G.output=d.accessorIndexMap.get(z.getOutput()),G.interpolation=z.getInterpolation(),j.set(z,V),G}),I.channels=P.listChannels().map(z=>{const V=d.createPropertyDef(z);return V.sampler=j.get(z.getSampler()),V.target={node:d.nodeIndexMap.get(z.getTargetNode()),path:z.getTargetPath()},V}),d.animationIndexMap.set(P,R),I}),a.scenes=o.listScenes().map((P,R)=>{const I=d.createPropertyDef(P);return I.nodes=P.listChildren().map(j=>d.nodeIndexMap.get(j)),d.sceneIndexMap.set(P,R),I});const O=o.getDefaultScene();return O&&(a.scene=o.listScenes().indexOf(O)),a.extensionsUsed=A.map(P=>P.extensionName),a.extensionsRequired=x.map(P=>P.extensionName),A.forEach(P=>P.write(d)),function(P){const R=[];for(const I in P){const j=P[I];(Array.isArray(j)&&j.length===0||j===null||j===""||j&&typeof j=="object"&&Object.keys(j).length===0)&&R.push(I)}for(const I of R)delete P[I]}(a),c}}.write(e,{format:t.format||rc.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:za({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:rc.GLB}),r=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),a=Di.pad(Di.encodeText(o),32),c=Di.toView(new Uint32Array([a.byteLength,1313821514])),d=Di.concat([c,a]);r[r.length-1]+=d.byteLength;const p=Object.values(n)[0];if(!p||!p.byteLength)return Di.concat([Di.toView(r),d]);const m=Di.pad(p,0),A=Di.toView(new Uint32Array([m.byteLength,5130562])),x=Di.concat([A,m]);return r[r.length-1]+=x.byteLength,Di.concat([Di.toView(r),d,x])}detectFormat(e){return(mp.isAbsoluteURL(e)?mp.extension(e):Jf.extension(e))==="glb"?rc.GLB:rc.GLTF}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const n={json:JSON.parse(t),resources:{}};return await this.D(n,this.dirname(e)),this.L(n),n}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=this._(t);return await this.D(n,this.dirname(e)),this.L(n),n}async D(e,t){var n=this;const r=[...e.json.images||[],...e.json.buffers||[]].map(async function(o){const a=o.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(t,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(r)}L(e){function t(n){if(n.uri){if(n.uri in e.resources)Di.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const r=`__${function(){for(let o=0;o<999;o++){const a=xM();if(!P1.has(a))return P1.add(a),a}return""}()}.${Jf.extension(n.uri)}`;e.resources[r]=Di.createBufferFromDataURI(n.uri),n.uri=r}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:n}=e.json;return e={json:za({},e.json),resources:za({},e.resources)},t&&(e.json.images=t.map(r=>za({},r))),n&&(e.json.buffers=n.map(r=>za({},r))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(t[0]!==1179937895)throw new Error("Invalid glTF asset.");if(t[1]!==2)throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Oy.JSON)throw new Error("Missing required GLB JSON chunk.");const r=n[0],o=Di.decodeText(Di.toView(e,20,r)),a=JSON.parse(o),c=20+r;if(e.byteLength<=c)return{json:a,resources:{}};const d=new Uint32Array(e.buffer,e.byteOffset+c,2);if(d[1]!==Oy.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:a,resources:{"@glb.bin":Di.toView(e,c+8,d[0])}}}}{constructor(e=mp.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const n=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return mp.resolve(e,t)}dirname(e){return mp.dirname(e)}detectFormat(e){return mp.extension(e)==="glb"?rc.GLB:rc.GLTF}}class IM{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class l_{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const ha=[171,75,84,88,32,50,48,187,13,10,26,10];function z1(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Yw(s){const e=new Uint8Array(s.buffer,s.byteOffset,ha.length);if(e[0]!==ha[0]||e[1]!==ha[1]||e[2]!==ha[2]||e[3]!==ha[3]||e[4]!==ha[4]||e[5]!==ha[5]||e[6]!==ha[6]||e[7]!==ha[7]||e[8]!==ha[8]||e[9]!==ha[9]||e[10]!==ha[10]||e[11]!==ha[11])throw new Error("Missing KTX 2.0 identifier.");const t=new IM,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new l_(s,ha.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const o=r._nextUint32();t.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),c=r._nextUint32(),d=r._nextUint32(),p=r._nextUint32(),m=r._nextUint64(),A=r._nextUint64(),x=new l_(s,ha.length+n,3*o*8,!0);for(let we=0;we<o;we++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+x._nextUint64(),x._nextUint64()),uncompressedByteLength:x._nextUint64()});const E=new l_(s,a,c,!0),M={vendorId:E._skip(4)._nextUint16(),descriptorType:E._nextUint16(),versionNumber:E._nextUint16(),descriptorBlockSize:E._nextUint16(),colorModel:E._nextUint8(),colorPrimaries:E._nextUint8(),transferFunction:E._nextUint8(),flags:E._nextUint8(),texelBlockDimension:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],bytesPlane:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],samples:[]},T=(M.descriptorBlockSize/4-6)/4;for(let we=0;we<T;we++){const We={bitOffset:E._nextUint16(),bitLength:E._nextUint8(),channelType:E._nextUint8(),samplePosition:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&We.channelType?(We.sampleLower=E._nextInt32(),We.sampleUpper=E._nextInt32()):(We.sampleLower=E._nextUint32(),We.sampleUpper=E._nextUint32()),M.samples[we]=We}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(M);const O=new l_(s,d,p,!0);for(;O._offset<p;){const we=O._nextUint32(),We=O._scan(we),ot=z1(We),ft=O._scan(we-We.byteLength);t.keyValue[ot]=ot.match(/^ktx/i)?z1(ft):ft,O._offset%4&&O._skip(4-O._offset%4)}if(A<=0)return t;const P=new l_(s,m,A,!0),R=P._nextUint16(),I=P._nextUint16(),j=P._nextUint32(),z=P._nextUint32(),V=P._nextUint32(),G=P._nextUint32(),X=[];for(let we=0;we<o;we++)X.push({imageFlags:P._nextUint32(),rgbSliceByteOffset:P._nextUint32(),rgbSliceByteLength:P._nextUint32(),alphaSliceByteOffset:P._nextUint32(),alphaSliceByteLength:P._nextUint32()});const ne=m+P._offset,ce=ne+j,ge=ce+z,de=ge+V,xe=new Uint8Array(s.buffer,s.byteOffset+ne,j),pe=new Uint8Array(s.buffer,s.byteOffset+ce,z),ye=new Uint8Array(s.buffer,s.byteOffset+ge,V),Re=new Uint8Array(s.buffer,s.byteOffset+de,G);return t.globalData={endpointCount:R,selectorCount:I,imageDescs:X,endpointsData:xe,selectorsData:pe,tablesData:ye,extendedData:Re},t}class Q1 extends us{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[an.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Q1.EXTENSION_NAME="EXT_mesh_gpu_instancing";const tm="EXT_mesh_gpu_instancing";function gp(){return(gp=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}var c_,nv,hs;(class extends Fr{constructor(...s){super(...s),this.extensionName=tm,this.provideTypes=[an.NODE],this.prewriteTypes=[an.ACCESSOR]}createInstancedMesh(){return new Q1(this.document.getGraph())}read(s){return(s.jsonDoc.json.nodes||[]).forEach((e,t)=>{if(!e.extensions||!e.extensions[tm])return;const n=e.extensions[tm],r=this.createInstancedMesh();for(const o in n.attributes)r.setAttribute(o,s.accessors[n.attributes[o]]);s.nodes[t].setExtension(tm,r)}),this}prewrite(s){s.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const t of e.listAttributes())s.addAccessorToUsageGroup(t,"INSTANCE_ATTRIBUTE");return this}write(s){const e=s.jsonDoc;return this.document.getRoot().listNodes().forEach(t=>{const n=t.getExtension(tm);if(n){const r=s.nodeIndexMap.get(t),o=e.json.nodes[r],a={attributes:{}};n.listSemantics().forEach(c=>{const d=n.getAttribute(c);a.attributes[c]=s.accessorIndexMap.get(d)}),o.extensions=o.extensions||{},o.extensions[tm]=a}}),this}}).EXTENSION_NAME=tm,function(s){s.QUANTIZE="quantize",s.FILTER="filter"}(c_||(c_={})),function(s){s.ATTRIBUTES="ATTRIBUTES",s.TRIANGLES="TRIANGLES",s.INDICES="INDICES"}(nv||(nv={})),function(s){s.NONE="NONE",s.OCTAHEDRAL="OCTAHEDRAL",s.QUATERNION="QUATERNION",s.EXPONENTIAL="EXPONENTIAL"}(hs||(hs={}));const{BYTE:DM,SHORT:V1,FLOAT:PM}=En.ComponentType,{normalize:G1,denormalize:Xw}=Yr;function RM(s,e,t,n){const{filter:r,bits:o}=n,a={array:s.getArray(),byteStride:s.getElementSize()*s.getComponentSize(),componentType:s.getComponentType(),normalized:s.getNormalized()};if(t!==nv.ATTRIBUTES)return a;if(r!==hs.NONE){let c=s.getNormalized()?function(d){const p=d.getComponentType(),m=d.getArray(),A=new Float32Array(m.length);for(let x=0;x<m.length;x++)A[x]=Xw(m[x],p);return A}(s):new Float32Array(a.array);switch(r){case hs.EXPONENTIAL:a.byteStride=4*s.getElementSize(),a.componentType=PM,a.normalized=!1,a.array=e.encodeFilterExp(c,s.getCount(),a.byteStride,o);break;case hs.OCTAHEDRAL:a.byteStride=o>8?8:4,a.componentType=o>8?V1:DM,a.normalized=!0,c=s.getElementSize()===3?function(d){const p=new Float32Array(4*d.length/3);for(let m=0,A=d.length/3;m<A;m++)p[4*m]=d[3*m],p[4*m+1]=d[3*m+1],p[4*m+2]=d[3*m+2];return p}(c):c,a.array=e.encodeFilterOct(c,s.getCount(),a.byteStride,o);break;case hs.QUATERNION:a.byteStride=8,a.componentType=V1,a.normalized=!0,a.array=e.encodeFilterQuat(c,s.getCount(),a.byteStride,o);break;default:throw new Error("Invalid filter.")}a.min=s.getMin([]),a.max=s.getMax([]),s.getNormalized()&&(a.min=a.min.map(d=>Xw(d,s.getComponentType())),a.max=a.max.map(d=>Xw(d,s.getComponentType()))),a.normalized&&(a.min=a.min.map(d=>G1(d,a.componentType)),a.max=a.max.map(d=>G1(d,a.componentType)))}else a.byteStride%4&&(a.array=function(c,d){const p=Di.padNumber(c.BYTES_PER_ELEMENT*d)/c.BYTES_PER_ELEMENT,m=new c.constructor(c.length/d*p);for(let A=0;A*d<c.length;A++)for(let x=0;x<d;x++)m[A*p+x]=c[A*d+x];return m}(a.array,s.getElementSize()),a.byteStride=a.array.byteLength/s.getCount());return a}function BM(s,e){return e===sc.BufferViewUsage.ELEMENT_ARRAY_BUFFER?s.listParents().some(t=>t instanceof em&&t.getMode()===em.Mode.TRIANGLES)?nv.TRIANGLES:nv.INDICES:nv.ATTRIBUTES}function kM(s,e){const t=e.getGraph().listParentEdges(s).filter(n=>!(n.getParent()instanceof U1));for(const n of t){const r=n.getName(),o=n.getAttributes().key||"";if(r==="indices")return{filter:hs.NONE};if(r==="attributes"){if(o==="POSITION")return{filter:hs.NONE};if(o==="TEXCOORD_0")return{filter:hs.NONE};if(o==="NORMAL")return{filter:hs.OCTAHEDRAL,bits:8};if(o==="TANGENT")return{filter:hs.OCTAHEDRAL,bits:8};if(o.startsWith("JOINTS_"))return{filter:hs.NONE};if(o.startsWith("WEIGHTS_"))return{filter:hs.NONE}}if(r==="output"){const a=H1(s);return a==="rotation"?{filter:hs.QUATERNION,bits:16}:a==="translation"||a==="scale"?{filter:hs.EXPONENTIAL,bits:12}:{filter:hs.NONE}}if(r==="input")return{filter:hs.NONE};if(r==="inverseBindMatrices")return{filter:hs.NONE}}return{filter:hs.NONE}}function H1(s){for(const e of s.listParents())if(e instanceof tv){for(const t of e.listParents())if(t instanceof Gw)return t.getTargetPath()}return null}const da="EXT_meshopt_compression",W1={method:c_.QUANTIZE};class q1 extends Fr{constructor(...e){super(...e),this.extensionName=da,this.prereadTypes=[an.BUFFER,an.PRIMITIVE],this.prewriteTypes=[an.BUFFER,an.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=W1,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=gp({},W1,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${da}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${da}]: Missing WASM support.`)}return t===an.BUFFER?this._prereadBuffers(e):t===an.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,r)=>{if(!n.extensions||!n.extensions[da])return;const o=n.extensions[da],a=o.byteOffset||0,c=o.byteLength||0,d=o.count,p=o.byteStride,m=new Uint8Array(d*p),A=t.json.buffers[n.buffer],x=Di.toView(A.uri?t.resources[A.uri]:t.resources["@glb.bin"],a,c);this._decoder.decodeGltfBuffer(m,d,p,x,o.mode,o.filter),e.bufferViews[r]=m})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var r;n.extensions&&n.extensions[da]&&(r=t.json.buffers[n.buffer]).extensions&&r.extensions.EXT_meshopt_compression&&r.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[da].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const r of t.listParents())r instanceof En&&r.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===an.ACCESSOR?this._prewriteAccessors(e):t===an.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,r=this._encoderOptions,o=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const c of this.document.getRoot().listAccessors()){if(H1(c)==="weights")continue;const d=e.getAccessorUsage(c),p=BM(c,d),m=r.method===c_.FILTER?kM(c,this.document):{filter:hs.NONE},A=RM(c,n,p,m),{array:x,byteStride:E}=A,M=c.getBuffer();if(!M)throw new Error(`${da}: Missing buffer for accessor.`);const T=this.document.getRoot().listBuffers().indexOf(M),O=[d,p,m.filter,E,T].join(":");let P=this._encoderBufferViews[O],R=this._encoderBufferViewData[O],I=this._encoderBufferViewAccessors[O];P&&R||(I=this._encoderBufferViewAccessors[O]=[],R=this._encoderBufferViewData[O]=[],P=this._encoderBufferViews[O]={buffer:a,target:sc.USAGE_TO_TARGET[d],byteOffset:0,byteLength:0,byteStride:d===sc.BufferViewUsage.ARRAY_BUFFER?E:void 0,extensions:{[da]:{buffer:T,byteOffset:0,byteLength:0,mode:p,filter:m.filter!==hs.NONE?m.filter:void 0,byteStride:E,count:0}}});const j=e.createAccessorDef(c);j.componentType=A.componentType,j.normalized=A.normalized,j.byteOffset=P.byteLength,j.min&&A.min&&(j.min=A.min),j.max&&A.max&&(j.max=A.max),e.accessorIndexMap.set(c,t.accessors.length),t.accessors.push(j),I.push(j),R.push(new Uint8Array(x.buffer,x.byteOffset,x.byteLength)),P.byteLength+=x.byteLength,P.extensions.EXT_meshopt_compression.count+=c.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const r=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[r.extensions[da].buffer],c=e.otherBufferViews.get(a)||[],{count:d,byteStride:p,mode:m}=r.extensions[da],A=Di.concat(o),x=t.encodeGltfBuffer(A,d,p,m),E=Di.pad(x);r.extensions[da].byteLength=x.byteLength,o.length=0,o.push(E),c.push(E),e.otherBufferViews.set(a,c)}}write(e){let t=0;for(const a in this._encoderBufferViews){const c=this._encoderBufferViews[a],d=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),p=this._encoderBufferViewAccessors[a];for(const x of p)x.bufferView=d;const m=e.jsonDoc.json.bufferViews[d],A=m.byteOffset||0;Object.assign(m,c),m.byteOffset=t,m.extensions[da].byteOffset=A,t+=Di.padNumber(c.byteLength)}const n=this._encoderFallbackBuffer,r=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[r];return o.byteLength=t,o.extensions={[da]:{fallback:!0}},n.dispose(),this}}q1.EXTENSION_NAME=da,q1.EncoderMethod=c_;const Y1="EXT_texture_webp";class OM{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Di.decodeText(e.slice(0,4)),n=Di.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const r=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<r.byteLength;){const a=Di.decodeText(new Uint8Array([r.getUint8(o),r.getUint8(o+1),r.getUint8(o+2),r.getUint8(o+3)])),c=r.getUint32(o+4,!0);if(a==="VP8 ")return[16383&r.getInt16(o+14,!0),16383&r.getInt16(o+16,!0)];if(a==="VP8L"){const d=r.getUint8(o+9),p=r.getUint8(o+10),m=r.getUint8(o+11);return[1+((63&p)<<8|d),1+((15&r.getUint8(o+12))<<10|m<<2|(192&p)>>6)]}o+=8+c+c%2}return null}getChannels(e){return 4}}(class extends Fr{constructor(...s){super(...s),this.extensionName=Y1,this.prereadTypes=[an.TEXTURE]}static register(){$h.registerFormat("image/webp",new OM)}preread(s){return(s.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(s){return this}write(s){const e=s.jsonDoc;return this.document.getRoot().listTextures().forEach(t=>{if(t.getMimeType()==="image/webp"){const n=s.imageIndexMap.get(t);(e.json.textures||[]).forEach(r=>{r.source===n&&(r.extensions=r.extensions||{},r.extensions.EXT_texture_webp={source:r.source},delete r.source)})}}),this}}).EXTENSION_NAME=Y1;const X1="KHR_draco_mesh_compression";let Us,K1,J1,Qa;function LM(s,e){const t=new Us.DecoderBuffer;try{if(t.Init(e,e.length),s.GetEncodedGeometryType(t)!==Us.TRIANGULAR_MESH)throw new Error(`[${X1}] Unknown geometry type.`);const n=new Us.Mesh;if(!s.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${X1}] Decoding failure.`);return n}finally{Us.destroy(t)}}function NM(s,e){const t=3*e.num_faces();let n,r;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=Us._malloc(o),s.GetTrianglesUInt16Array(e,o,n),r=new Uint16Array(Us.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=Us._malloc(o),s.GetTrianglesUInt32Array(e,o,n),r=new Uint32Array(Us.HEAPU32.buffer,n,t).slice()}return Us._free(n),r}function UM(s,e,t,n){const r=J1[n.componentType],o=K1[n.componentType],a=t.num_components(),c=e.num_points()*a,d=c*o.BYTES_PER_ELEMENT,p=Us._malloc(d);s.GetAttributeDataArrayForAllPoints(e,t,r,d,p);const m=new o(Us.HEAPF32.buffer,p,c).slice();return Us._free(p),m}var u_,oc;(function(s){s[s.EDGEBREAKER=1]="EDGEBREAKER",s[s.SEQUENTIAL=0]="SEQUENTIAL"})(u_||(u_={})),function(s){s.POSITION="POSITION",s.NORMAL="NORMAL",s.COLOR="COLOR",s.TEX_COORD="TEX_COORD",s.GENERIC="GENERIC"}(oc||(oc={}));const Z1={[oc.POSITION]:14,[oc.NORMAL]:10,[oc.COLOR]:8,[oc.TEX_COORD]:12,[oc.GENERIC]:12},$1={decodeSpeed:5,encodeSpeed:5,method:u_.EDGEBREAKER,quantizationBits:Z1,quantizationVolume:"mesh"};function FM(s,e=$1){const t=gp({},$1,e);t.quantizationBits=gp({},Z1,e.quantizationBits);const n=new Qa.Encoder,r=new Qa.MeshBuilder,o=new Qa.Mesh,a={},c=new Qa.DracoInt8Array;for(const M of s.listSemantics()){const T=s.getAttribute(M),O=jM(M),P=zM(r,T.getComponentType(),o,Qa[O],T.getCount(),T.getElementSize(),T.getArray());if(P===-1)throw new Error(`Error compressing "${M}" attribute.`);if(a[M]=P,t.quantizationVolume==="mesh"||M!=="POSITION")n.SetAttributeQuantization(Qa[O],t.quantizationBits[O]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:R}=t,I=Math.max(R.max[0]-R.min[0],R.max[1]-R.min[1],R.max[2]-R.min[2]);n.SetAttributeExplicitQuantization(Qa[O],t.quantizationBits[O],T.getElementSize(),R.min,I)}}}const d=s.getIndices();if(!d)throw new Error("Primitive must have indices.");r.AddFacesToMesh(o,d.getCount()/3,d.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),t.method===u_.SEQUENTIAL||s.listTargets().length>0?n.SetEncodingMethod(Qa.MESH_SEQUENTIAL_ENCODING):n.SetEncodingMethod(Qa.MESH_EDGEBREAKER_ENCODING);const p=n.EncodeMeshToDracoBuffer(o,c);if(p<=0)throw new Error("Error applying Draco compression.");const m=new Uint8Array(p);for(let M=0;M<p;++M)m[M]=c.GetValue(M);const A=s.getAttribute("POSITION").getCount(),x=n.GetNumberOfEncodedPoints(),E=3*n.GetNumberOfEncodedFaces();if(s.listTargets().length>0&&x!==A)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return Qa.destroy(c),Qa.destroy(o),Qa.destroy(r),Qa.destroy(n),{numVertices:x,numIndices:E,data:m,attributeIDs:a}}function jM(s){return s==="POSITION"?oc.POSITION:s==="NORMAL"?oc.NORMAL:s.startsWith("COLOR_")?oc.COLOR:s.startsWith("TEXCOORD_")?oc.TEX_COORD:oc.GENERIC}function zM(s,e,t,n,r,o,a){switch(e){case En.ComponentType.UNSIGNED_BYTE:return s.AddUInt8Attribute(t,n,r,o,a);case En.ComponentType.BYTE:return s.AddInt8Attribute(t,n,r,o,a);case En.ComponentType.UNSIGNED_SHORT:return s.AddUInt16Attribute(t,n,r,o,a);case En.ComponentType.SHORT:return s.AddInt16Attribute(t,n,r,o,a);case En.ComponentType.UNSIGNED_INT:return s.AddUInt32Attribute(t,n,r,o,a);case En.ComponentType.FLOAT:return s.AddFloatAttribute(t,n,r,o,a);default:throw new Error(`Unexpected component type, "${e}".`)}}const Ms="KHR_draco_mesh_compression";class h_ extends Fr{constructor(...e){super(...e),this.extensionName=Ms,this.prereadTypes=[an.PRIMITIVE],this.prewriteTypes=[an.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,Us=this._decoderModule,K1={[En.ComponentType.FLOAT]:Float32Array,[En.ComponentType.UNSIGNED_INT]:Uint32Array,[En.ComponentType.UNSIGNED_SHORT]:Uint16Array,[En.ComponentType.UNSIGNED_BYTE]:Uint8Array,[En.ComponentType.SHORT]:Int16Array,[En.ComponentType.BYTE]:Int8Array},J1={[En.ComponentType.FLOAT]:Us.DT_FLOAT32,[En.ComponentType.UNSIGNED_INT]:Us.DT_UINT32,[En.ComponentType.UNSIGNED_SHORT]:Us.DT_UINT16,[En.ComponentType.UNSIGNED_BYTE]:Us.DT_UINT8,[En.ComponentType.SHORT]:Us.DT_INT16,[En.ComponentType.BYTE]:Us.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,Qa=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Ms}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,r=new Map;try{const o=n.json.meshes||[];for(const a of o)for(const c of a.primitives){if(!c.extensions||!c.extensions[Ms])continue;const d=c.extensions[Ms];let[p,m]=r.get(d.bufferView)||[];if(!m||!p){const A=n.json.bufferViews[d.bufferView],x=n.json.buffers[A.buffer],E=Di.toView(x.uri?n.resources[x.uri]:n.resources["@glb.bin"],A.byteOffset||0,A.byteLength);p=new this._decoderModule.Decoder,m=LM(p,E),r.set(d.bufferView,[p,m]),t.debug(`[${Ms}] Decompressed ${E.byteLength} bytes.`)}for(const A in c.attributes){const x=e.jsonDoc.json.accessors[c.attributes[A]],E=p.GetAttributeByUniqueId(m,d.attributes[A]),M=UM(p,m,E,x);e.accessors[c.attributes[A]].setArray(M)}c.indices!==void 0&&e.accessors[c.indices].setArray(NM(p,m))}}finally{for(const[o,a]of Array.from(r.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Ms}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Ms}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const r=function(c){const d=c.getLogger(),p=new Set,m=new Set;for(const O of c.getRoot().listMeshes())for(const P of O.listPrimitives())P.getIndices()?P.getMode()!==em.Mode.TRIANGLES?(m.add(P),d.warn(`[${Ms}] Skipping Draco compression on non-TRIANGLES primitive.`)):p.add(P):(m.add(P),d.warn(`[${Ms}] Skipping Draco compression on non-indexed primitive.`));const A=c.getRoot().listAccessors(),x=new Map;for(let O=0;O<A.length;O++)x.set(A[O],O);const E=new Map,M=new Set,T=new Map;for(const O of Array.from(p)){let P=eE(O,x);if(M.has(P))T.set(O,P);else{if(E.has(O.getIndices())){const R=O.getIndices(),I=R.clone();x.set(I,c.getRoot().listAccessors().length-1),O.swap(R,I)}for(const R of O.listAttributes())if(E.has(R)){const I=R.clone();x.set(I,c.getRoot().listAccessors().length-1),O.swap(R,I)}P=eE(O,x),M.add(P),T.set(O,P),E.set(O.getIndices(),P);for(const R of O.listAttributes())E.set(R,P)}}for(const O of Array.from(E.keys())){const P=new Set(O.listParents().map(R=>R.propertyType));if(P.size!==2||!P.has(an.PRIMITIVE)||!P.has(an.ROOT))throw new Error(`[${Ms}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const O of Array.from(p)){const P=T.get(O),R=O.getIndices();if(E.get(R)!==P||O.listAttributes().some(I=>E.get(I)!==P))throw new Error(`[${Ms}] Draco primitives must share all, or no, accessors.`)}for(const O of Array.from(m)){const P=O.getIndices();if(E.has(P)||O.listAttributes().some(R=>E.has(R)))throw new Error(`[${Ms}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return T}(this.document),o=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Ms}]: quantizationVolume=scene requires exactly 1 scene.`):a=function(c){const d={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},p=c.propertyType===an.NODE?[c]:c.listChildren();for(const m of p)m.traverse(A=>{const x=A.getMesh();if(!x)return;const E=_M(x,A.getWorldMatrix());Qw(E.min,d),Qw(E.max,d)});return d}(this.document.getRoot().listScenes().pop()));for(const c of Array.from(r.keys())){const d=r.get(c);if(!d)throw new Error("Unexpected primitive.");if(o.has(d)){o.set(d,o.get(d));continue}const p=c.getIndices(),m=e.jsonDoc.json.accessors,A=FM(c,gp({},this._encoderOptions,{quantizationVolume:a}));o.set(d,A);const x=e.createAccessorDef(p);x.count=A.numIndices,e.accessorIndexMap.set(p,m.length),m.push(x);for(const M of c.listSemantics()){const T=c.getAttribute(M),O=e.createAccessorDef(T);O.count=A.numVertices,e.accessorIndexMap.set(T,m.length),m.push(O)}const E=c.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(E)||e.otherBufferViews.set(E,[]),e.otherBufferViews.get(E).push(A.data)}return n.debug(`[${Ms}] Compressed ${r.size} primitives.`),e.extensionData[Ms]={primitiveHashMap:r,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Ms];for(const n of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const a=n.listPrimitives()[o],c=r.primitives[o],d=t.primitiveHashMap.get(a);if(!d)continue;const p=t.primitiveEncodingMap.get(d);c.extensions=c.extensions||{},c.extensions[Ms]={bufferView:e.otherBufferViewsIndexMap.get(p.data),attributes:p.attributeIDs}}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(r=>r!==Ms),n.extensionsRequired=(n.extensionsRequired||[]).filter(r=>r!==Ms)}return this}}function eE(s,e){const t=[],n=s.getIndices();t.push(e.get(n));for(const r of s.listAttributes())t.push(e.get(r));return t.sort().join("|")}h_.EXTENSION_NAME=Ms,h_.EncoderMethod=u_;class iv extends us{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[an.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:iv.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return ja.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return ja.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}iv.EXTENSION_NAME="KHR_lights_punctual",iv.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Ly="KHR_lights_punctual";class tE extends Fr{constructor(...e){super(...e),this.extensionName=Ly}createLight(e=""){return new iv(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions.KHR_lights_punctual)return this;const n=(t.json.extensions.KHR_lights_punctual.lights||[]).map(r=>{var o,a;const c=this.createLight().setName(r.name||"").setType(r.type);return r.color!==void 0&&c.setColor(r.color),r.intensity!==void 0&&c.setIntensity(r.intensity),r.range!==void 0&&c.setRange(r.range),((o=r.spot)==null?void 0:o.innerConeAngle)!==void 0&&c.setInnerConeAngle(r.spot.innerConeAngle),((a=r.spot)==null?void 0:a.outerConeAngle)!==void 0&&c.setOuterConeAngle(r.spot.outerConeAngle),c});return t.json.nodes.forEach((r,o)=>{r.extensions&&r.extensions.KHR_lights_punctual&&e.nodes[o].setExtension(Ly,n[r.extensions.KHR_lights_punctual.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],r=new Map;for(const o of this.properties){const a=o,c={type:a.getType()};Yr.eq(a.getColor(),[1,1,1])||(c.color=a.getColor()),a.getIntensity()!==1&&(c.intensity=a.getIntensity()),a.getRange()!=null&&(c.range=a.getRange()),a.getName()&&(c.name=a.getName()),a.getType()===iv.Type.SPOT&&(c.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(c),r.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const a=o.getExtension(Ly);if(a){const c=e.nodeIndexMap.get(o),d=t.json.nodes[c];d.extensions=d.extensions||{},d.extensions.KHR_lights_punctual={light:r.get(a)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions.KHR_lights_punctual={lights:n},this}}tE.EXTENSION_NAME=Ly;const{R:nE,G:iE,B:QM}=cs;class rE extends us{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Br(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Br(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Br(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:nE})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:iE})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:nE|iE|QM})}}rE.EXTENSION_NAME="KHR_materials_clearcoat";const nm="KHR_materials_clearcoat";class sE extends Fr{constructor(...e){super(...e),this.extensionName=nm}createClearcoat(){return new rE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[nm]){const a=this.createClearcoat();e.materials[o].setExtension(nm,a);const c=r.extensions[nm];if(c.clearcoatFactor!==void 0&&a.setClearcoatFactor(c.clearcoatFactor),c.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(c.clearcoatRoughnessFactor),c.clearcoatTexture!==void 0){const d=c.clearcoatTexture;a.setClearcoatTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),d)}if(c.clearcoatRoughnessTexture!==void 0){const d=c.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),d)}if(c.clearcoatNormalTexture!==void 0){const d=c.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),d),d.scale!==void 0&&a.setClearcoatNormalScale(d.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(nm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[nm]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const d=r.getClearcoatTexture(),p=r.getClearcoatTextureInfo();c.clearcoatTexture=e.createTextureInfoDef(d,p)}if(r.getClearcoatRoughnessTexture()){const d=r.getClearcoatRoughnessTexture(),p=r.getClearcoatRoughnessTextureInfo();c.clearcoatRoughnessTexture=e.createTextureInfoDef(d,p)}if(r.getClearcoatNormalTexture()){const d=r.getClearcoatNormalTexture(),p=r.getClearcoatNormalTextureInfo();c.clearcoatNormalTexture=e.createTextureInfoDef(d,p),r.getClearcoatNormalScale()!==1&&(c.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}}),this}}sE.EXTENSION_NAME=nm;class oE extends us{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}oE.EXTENSION_NAME="KHR_materials_emissive_strength";const im="KHR_materials_emissive_strength";class aE extends Fr{constructor(...e){super(...e),this.extensionName=im}createEmissiveStrength(){return new oE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[im]){const r=this.createEmissiveStrength();e.materials[n].setExtension(im,r);const o=t.extensions[im];o.emissiveStrength!==void 0&&r.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(im);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions[im]={emissiveStrength:r.getEmissiveStrength()}}}),this}}aE.EXTENSION_NAME=im;class lE extends us{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}lE.EXTENSION_NAME="KHR_materials_ior";const Ny="KHR_materials_ior";class cE extends Fr{constructor(...e){super(...e),this.extensionName=Ny}createIOR(){return new lE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_ior){const r=this.createIOR();e.materials[n].setExtension(Ny,r);const o=t.extensions.KHR_materials_ior;o.ior!==void 0&&r.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Ny);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions.KHR_materials_ior={ior:r.getIOR()}}}),this}}cE.EXTENSION_NAME=Ny;const{R:VM,G:GM}=cs;class uE extends us{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Br(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Br(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:VM})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:GM})}}uE.EXTENSION_NAME="KHR_materials_iridescence";const rm="KHR_materials_iridescence";class hE extends Fr{constructor(...e){super(...e),this.extensionName=rm}createIridescence(){return new uE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[rm]){const a=this.createIridescence();e.materials[o].setExtension(rm,a);const c=r.extensions[rm];if(c.iridescenceFactor!==void 0&&a.setIridescenceFactor(c.iridescenceFactor),c.iridescenceIor!==void 0&&a.setIridescenceIOR(c.iridescenceIor),c.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(c.iridescenceThicknessMaximum),c.iridescenceTexture!==void 0){const d=c.iridescenceTexture;a.setIridescenceTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),d)}if(c.iridescenceThicknessTexture!==void 0){const d=c.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(rm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[rm]={};if(r.getIridescenceFactor()>0&&(c.iridescenceFactor=r.getIridescenceFactor()),r.getIridescenceIOR()!==1.3&&(c.iridescenceIor=r.getIridescenceIOR()),r.getIridescenceThicknessMinimum()!==100&&(c.iridescenceThicknessMinimum=r.getIridescenceThicknessMinimum()),r.getIridescenceThicknessMaximum()!==400&&(c.iridescenceThicknessMaximum=r.getIridescenceThicknessMaximum()),r.getIridescenceTexture()){const d=r.getIridescenceTexture(),p=r.getIridescenceTextureInfo();c.iridescenceTexture=e.createTextureInfoDef(d,p)}if(r.getIridescenceThicknessTexture()){const d=r.getIridescenceThicknessTexture(),p=r.getIridescenceThicknessTextureInfo();c.iridescenceThicknessTexture=e.createTextureInfoDef(d,p)}}}),this}}hE.EXTENSION_NAME=rm;const{R:dE,G:pE,B:fE,A:mE}=cs;class gE extends us{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Br(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Br(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return ja.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(ja.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:dE|pE|fE|mE})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:dE|pE|fE|mE})}}gE.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const sm="KHR_materials_pbrSpecularGlossiness";class vE extends Fr{constructor(...e){super(...e),this.extensionName=sm}createPBRSpecularGlossiness(){return new gE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[sm]){const a=this.createPBRSpecularGlossiness();e.materials[o].setExtension(sm,a);const c=r.extensions[sm];if(c.diffuseFactor!==void 0&&a.setDiffuseFactor(c.diffuseFactor),c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.glossinessFactor!==void 0&&a.setGlossinessFactor(c.glossinessFactor),c.diffuseTexture!==void 0){const d=c.diffuseTexture;a.setDiffuseTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),d)}if(c.specularGlossinessTexture!==void 0){const d=c.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(sm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[sm]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const d=r.getDiffuseTexture(),p=r.getDiffuseTextureInfo();c.diffuseTexture=e.createTextureInfoDef(d,p)}if(r.getSpecularGlossinessTexture()){const d=r.getSpecularGlossinessTexture(),p=r.getSpecularGlossinessTextureInfo();c.specularGlossinessTexture=e.createTextureInfoDef(d,p)}}}),this}}vE.EXTENSION_NAME=sm;const{R:HM,G:WM,B:qM,A:YM}=cs;class _E extends us{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Br(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Br(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return ja.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",ja.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:HM|WM|qM})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:YM})}}_E.EXTENSION_NAME="KHR_materials_sheen";const Uy="KHR_materials_sheen";class AE extends Fr{constructor(...e){super(...e),this.extensionName=Uy}createSheen(){return new _E(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions.KHR_materials_sheen){const a=this.createSheen();e.materials[o].setExtension(Uy,a);const c=r.extensions.KHR_materials_sheen;if(c.sheenColorFactor!==void 0&&a.setSheenColorFactor(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(c.sheenRoughnessFactor),c.sheenColorTexture!==void 0){const d=c.sheenColorTexture;a.setSheenColorTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),d)}if(c.sheenRoughnessTexture!==void 0){const d=c.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Uy);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions.KHR_materials_sheen={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const d=r.getSheenColorTexture(),p=r.getSheenColorTextureInfo();c.sheenColorTexture=e.createTextureInfoDef(d,p)}if(r.getSheenRoughnessTexture()){const d=r.getSheenRoughnessTexture(),p=r.getSheenRoughnessTextureInfo();c.sheenRoughnessTexture=e.createTextureInfoDef(d,p)}}}),this}}AE.EXTENSION_NAME=Uy;const{R:XM,G:KM,B:JM,A:ZM}=cs;class yE extends us{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Br(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Br(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return ja.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",ja.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:ZM})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:XM|KM|JM})}}yE.EXTENSION_NAME="KHR_materials_specular";const om="KHR_materials_specular";class bE extends Fr{constructor(...e){super(...e),this.extensionName=om}createSpecular(){return new yE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[om]){const a=this.createSpecular();e.materials[o].setExtension(om,a);const c=r.extensions[om];if(c.specularFactor!==void 0&&a.setSpecularFactor(c.specularFactor),c.specularColorFactor!==void 0&&a.setSpecularColorFactor(c.specularColorFactor),c.specularTexture!==void 0){const d=c.specularTexture;a.setSpecularTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),d)}if(c.specularColorTexture!==void 0){const d=c.specularColorTexture;a.setSpecularColorTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(om);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[om]={};if(r.getSpecularFactor()!==1&&(c.specularFactor=r.getSpecularFactor()),Yr.eq(r.getSpecularColorFactor(),[1,1,1])||(c.specularColorFactor=r.getSpecularColorFactor()),r.getSpecularTexture()){const d=r.getSpecularTexture(),p=r.getSpecularTextureInfo();c.specularTexture=e.createTextureInfoDef(d,p)}if(r.getSpecularColorTexture()){const d=r.getSpecularColorTexture(),p=r.getSpecularColorTextureInfo();c.specularColorTexture=e.createTextureInfoDef(d,p)}}}),this}}bE.EXTENSION_NAME=om;const{R:$M}=cs;class wE extends us{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Br(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:$M})}}wE.EXTENSION_NAME="KHR_materials_transmission";const am="KHR_materials_transmission";class xE extends Fr{constructor(...e){super(...e),this.extensionName=am}createTransmission(){return new wE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[am]){const a=this.createTransmission();e.materials[o].setExtension(am,a);const c=r.extensions[am];if(c.transmissionFactor!==void 0&&a.setTransmissionFactor(c.transmissionFactor),c.transmissionTexture!==void 0){const d=c.transmissionTexture;a.setTransmissionTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(am);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions[am]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const d=r.getTransmissionTexture(),p=r.getTransmissionTextureInfo();c.transmissionTexture=e.createTextureInfoDef(d,p)}}}),this}}xE.EXTENSION_NAME=am;class EE extends us{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[an.MATERIAL]}}EE.EXTENSION_NAME="KHR_materials_unlit";const Fy="KHR_materials_unlit";class CE extends Fr{constructor(...e){super(...e),this.extensionName=Fy}createUnlit(){return new EE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions.KHR_materials_unlit&&e.materials[n].setExtension(Fy,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Fy)){const r=e.materialIndexMap.get(n),o=t.json.materials[r];o.extensions=o.extensions||{},o.extensions.KHR_materials_unlit={}}}),this}}CE.EXTENSION_NAME=Fy;class SE extends us{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}SE.EXTENSION_NAME="KHR_materials_variants";class ME extends us{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[an.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}ME.EXTENSION_NAME="KHR_materials_variants";class Kw extends us{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Kw.EXTENSION_NAME="KHR_materials_variants";const eh="KHR_materials_variants";class TE extends Fr{constructor(...e){super(...e),this.extensionName=eh}createMappingList(){return new ME(this.document.getGraph())}createVariant(e=""){return new Kw(this.document.getGraph(),e)}createMapping(){return new SE(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Kw)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[eh])return this;const n=(t.json.extensions[eh].variants||[]).map(r=>this.createVariant().setName(r.name||""));return(t.json.meshes||[]).forEach((r,o)=>{const a=e.meshes[o];(r.primitives||[]).forEach((c,d)=>{if(!c.extensions||!c.extensions[eh])return;const p=this.createMappingList(),m=c.extensions[eh];for(const A of m.mappings){const x=this.createMapping();A.material!==void 0&&x.setMaterial(e.materials[A.material]);for(const E of A.variants||[])x.addVariant(n[E]);p.addMapping(x)}a.listPrimitives()[d].setExtension(eh,p)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const r=[],o=new Map;for(const a of n)o.set(a,r.length),r.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const c=e.meshIndexMap.get(a);a.listPrimitives().forEach((d,p)=>{const m=d.getExtension(eh);if(!m)return;const A=e.jsonDoc.json.meshes[c].primitives[p],x=m.listMappings().map(E=>{const M=e.createPropertyDef(E),T=E.getMaterial();return T&&(M.material=e.materialIndexMap.get(T)),M.variants=E.listVariants().map(O=>o.get(O)),M});A.extensions=A.extensions||{},A.extensions[eh]={mappings:x}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[eh]={variants:r},this}}TE.EXTENSION_NAME=eh;const{G:eT}=cs;class IE extends us{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[an.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Br(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:eT})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return ja.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",ja.hexToFactor(e,t))}}IE.EXTENSION_NAME="KHR_materials_volume";const jy="KHR_materials_volume";class DE extends Fr{constructor(...e){super(...e),this.extensionName=jy}createVolume(){return new IE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions.KHR_materials_volume){const a=this.createVolume();e.materials[o].setExtension(jy,a);const c=r.extensions.KHR_materials_volume;if(c.thicknessFactor!==void 0&&a.setThicknessFactor(c.thicknessFactor),c.attenuationDistance!==void 0&&a.setAttenuationDistance(c.attenuationDistance),c.attenuationColor!==void 0&&a.setAttenuationColor(c.attenuationColor),c.thicknessTexture!==void 0){const d=c.thicknessTexture;a.setThicknessTexture(e.textures[n[d.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),d)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(jy);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c=a.extensions.KHR_materials_volume={};if(r.getThicknessFactor()>0&&(c.thicknessFactor=r.getThicknessFactor()),Number.isFinite(r.getAttenuationDistance())&&(c.attenuationDistance=r.getAttenuationDistance()),Yr.eq(r.getAttenuationColor(),[1,1,1])||(c.attenuationColor=r.getAttenuationColor()),r.getThicknessTexture()){const d=r.getThicknessTexture(),p=r.getThicknessTextureInfo();c.thicknessTexture=e.createTextureInfoDef(d,p)}}}),this}}DE.EXTENSION_NAME=jy;const PE="KHR_mesh_quantization";class RE extends Fr{constructor(...e){super(...e),this.extensionName=PE}read(e){return this}write(e){return this}}RE.EXTENSION_NAME=PE;const BE="KHR_texture_basisu";class tT{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Yw(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Yw(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=Yw(e),n=this.getChannels(e)>3;let r=0;for(let o=0;o<t.levels.length;o++){const a=t.levels[o];r+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return r}}class kE extends Fr{constructor(...e){super(...e),this.extensionName=BE,this.prereadTypes=[an.TEXTURE]}static register(){$h.registerFormat("image/ktx2",new tT)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions.KHR_texture_basisu&&(t.source=t.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const r=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===r&&(o.extensions=o.extensions||{},o.extensions.KHR_texture_basisu={source:o.source},delete o.source)})}}),this}}kE.EXTENSION_NAME=BE;class OE extends us{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[an.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}OE.EXTENSION_NAME="KHR_texture_transform";const zy="KHR_texture_transform";class LE extends Fr{constructor(...e){super(...e),this.extensionName=zy}createTransform(){return new OE(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions.KHR_texture_transform)continue;const r=this.createTransform(),o=n.extensions.KHR_texture_transform;o.offset!==void 0&&r.setOffset(o.offset),o.rotation!==void 0&&r.setRotation(o.rotation),o.scale!==void 0&&r.setScale(o.scale),o.texCoord!==void 0&&r.setTexCoord(o.texCoord),t.setExtension(zy,r)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,r]of t){const o=n.getExtension(zy);if(!o)continue;r.extensions=r.extensions||{};const a={},c=Yr.eq;c(o.getOffset(),[0,0])||(a.offset=o.getOffset()),o.getRotation()!==0&&(a.rotation=o.getRotation()),c(o.getScale(),[1,1])||(a.scale=o.getScale()),o.getTexCoord()!=null&&(a.texCoord=o.getTexCoord()),r.extensions.KHR_texture_transform=a}return this}}LE.EXTENSION_NAME=zy;const nT=[an.ROOT,an.SCENE,an.NODE,an.MESH,an.MATERIAL,an.TEXTURE,an.ANIMATION];class NE extends us{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=nT}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",gp({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=gp({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return gp({"@context":Jw(this.get("context"))},Jw(this.get("properties")))}fromJSONLD(e){const t=(e=Jw(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function Jw(s){return JSON.parse(JSON.stringify(s))}NE.EXTENSION_NAME="KHR_xmp_json_ld";const Zw="KHR_xmp_json_ld";class UE extends Fr{constructor(...e){super(...e),this.extensionName=Zw}createPacket(){return new NE(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t.KHR_xmp_json_ld;if(!n||!n.packets)return this;const r=e.jsonDoc.json,o=this.document.getRoot(),a=n.packets.map(p=>this.createPacket().fromJSONLD(p)),c=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],d=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let p=0;p<c.length;p++){const m=c[p]||[];for(let A=0;A<m.length;A++){const x=m[A];x.extensions&&x.extensions.KHR_xmp_json_ld&&d[p][A].setExtension(Zw,a[x.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const r of this.properties){n.push(r.toJSONLD());for(const o of r.listParents()){let a;switch(o.propertyType){case an.ROOT:a=t.asset;break;case an.SCENE:a=t.scenes[e.sceneIndexMap.get(o)];break;case an.NODE:a=t.nodes[e.nodeIndexMap.get(o)];break;case an.MESH:a=t.meshes[e.meshIndexMap.get(o)];break;case an.MATERIAL:a=t.materials[e.materialIndexMap.get(o)];break;case an.TEXTURE:a=t.images[e.imageIndexMap.get(o)];break;case an.ANIMATION:a=t.animations[e.animationIndexMap.get(o)];break;default:a=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${o.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions.KHR_xmp_json_ld={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions.KHR_xmp_json_ld={packets:n}),this}}UE.EXTENSION_NAME=Zw;const iT=[h_,tE,sE,aE,cE,hE,vE,bE,AE,xE,CE,TE,DE,RE,kE,LE,UE];let $w=class extends Ri{constructor(s,e,t){super(s,e,t??new rT,new Pi(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,r){this.enabled&&super.render(s,e,t,n,r)}};$w=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([ci("High precision Normal Buffer")],$w);class rT extends f.RSm{constructor(){super()}onBeforeRender(e,t,n,r,o){var a,c;let d=o.material;Array.isArray(d)&&(d=d[0]),this.normalMap=(a=d==null?void 0:d.normalMap)!==null&&a!==void 0?a:null,this.needsUpdate=!0,this.side=(c=d.side)!==null&&c!==void 0?c:f.ehD}}class rv extends sl{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:f.cLu,minFilter:f.TyD,magFilter:f.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,r=new Set;return new class extends $w{render(o,a,c,d,p){const m=o.getRenderTarget(),A=o.getActiveCubeFace(),x=o.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:E})=>{E&&((E.transparent&&E.userData.renderToDepth||!E.transparent&&E.transmission===0&&E.userData.renderToDepth===!1)&&(n.add(E),E.transparent=!E.transparent),Math.abs(E.transmission||0)>0&&E.userData.renderToDepth&&(r.add([E,E.transmission]),E.transmission=0))}),$t(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,d,p)),n.forEach(E=>E.transparent=!E.transparent),n.clear(),r.forEach(([E,M])=>E.transmission=M),r.clear(),o.setRenderTarget(m,A,x))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)===null||t===void 0?void 0:t.dispose)===null||n===void 0?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(n=(t=this.getNormalBuffer())===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}rv.PluginType="NormalBufferPlugin";function FE(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),s.isMaterial&&(s.needsUpdate=!0),!0}let ex=class extends Vr{constructor(s,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new f.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new f.Pa4(1,1,1)}},vertexShader:al,fragmentShader:`

            ${t}

            ${ll}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=mask.g*255.*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,o,a)=>{var c,d;this.enabled&&(!((d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._ssBevel)===null||d===void 0)&&d.hasSSBevel)&&(r.fragmentShader=hr(r.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(r,o,a)=>{var c,d;if(!this.enabled||!(!((d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._ssBevel)===null||d===void 0)&&d.hasSSBevel))return;const p=o.materialObject,m=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==m&&(this.materialExtension.extraUniforms.tSSBevelMap.value=m,p.needsUpdate=!0)},getUiConfig:r=>{const o={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var a;return((a=r.materialObject.userData._ssBevel)===null||a===void 0?void 0:a.hasSSBevel)||!1},set value(a){var c,d;a!==((c=r.materialObject.userData._ssBevel)===null||c===void 0?void 0:c.hasSSBevel)&&(a?FE(r.materialObject)||alert("Cannot add screen space bevel."):(r.materialObject.userData._ssBevel.hasSSBevel=!1,r.materialObject.needsUpdate=!0),(d=o.uiRefresh)===null||d===void 0||d.call(o,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var a;return!(!((a=r.materialObject.userData._ssBevel)===null||a===void 0)&&a.hasSSBevel)},property:[r.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return o},parsFragmentSnippet:(r,o)=>{var a,c;return this.enabled&&(!((c=(a=o==null?void 0:o.materialObject.userData)===null||a===void 0?void 0:a._ssBevel)===null||c===void 0)&&c.hasSSBevel)?K`
            uniform sampler2D tSSBevelMap;
            ${jm}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:r=>{var o,a;return(this.enabled?"1":"0")+(!((a=(o=r.materialObject.userData)===null||o===void 0?void 0:o._ssBevel)===null||a===void 0)&&a.hasSSBevel?"1":"0")},isCompatible:r=>r.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new _c({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new f.FM8(1,1)},cameraPositionWorld:{value:new f.Pa4(1,1,1)}},vertexShader:al,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new _c({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new f.FM8(.5,.5)},direction:{value:new f.FM8(.5,.5)}},vertexShader:al,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(s,e,t,n,r){var o,a;if(!this.enabled)return;const c=s.baseRenderer,d={minFilter:f.wem,magFilter:f.wem,isAntialiased:!1,format:f.wk1,depthBuffer:!1,generateMipmaps:!1},p=c.getTempTarget(d);this._renderEdges(c,p),this._blurEdges(c,p),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(o=this._viewerApp.getPlugin(qi))===null||o===void 0||o.updateShaderProperties(this.material),(a=this._viewerApp.getPlugin(rv))===null||a===void 0||a.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=p.texture,super.render(s,this._target,p,n,r),c.releaseTempTarget(p)}_initsamples(){const s=[];return s.push(new f.FM8(-8,0).multiplyScalar(.125)),s.push(new f.FM8(-6,-4).multiplyScalar(.125)),s.push(new f.FM8(-3,-2).multiplyScalar(.125)),s.push(new f.FM8(-2,-6).multiplyScalar(.125)),s.push(new f.FM8(1,-1).multiplyScalar(.125)),s.push(new f.FM8(2,-5).multiplyScalar(.125)),s.push(new f.FM8(6,-7).multiplyScalar(.125)),s.push(new f.FM8(5,-3).multiplyScalar(.125)),s.push(new f.FM8(4,1).multiplyScalar(.125)),s.push(new f.FM8(7,4).multiplyScalar(.125)),s.push(new f.FM8(3,5).multiplyScalar(.125)),s.push(new f.FM8(0,7).multiplyScalar(.125)),s.push(new f.FM8(-1,3).multiplyScalar(.125)),s.push(new f.FM8(-4,6).multiplyScalar(.125)),s.push(new f.FM8(-7,8).multiplyScalar(.125)),s.push(new f.FM8(-5,2).multiplyScalar(.125)),s}_blurEdges(s,e){var t,n;const r={minFilter:f.wem,magFilter:f.wem,isAntialiased:!1,format:f.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},o=s.getTempTarget(r),a=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,c=((n=e.texture.image)===null||n===void 0?void 0:n.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new f.FM8(a,c),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new f.FM8(1,0),s.blit(void 0,o,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new f.FM8(a/2,c/2),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new f.FM8(0,1),s.blit(void 0,e,{material:this._separableBlurMaterial}),s.releaseTempTarget(o)}_renderEdges(s,e){var t,n,r,o;const a=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,c=((n=e.texture.image)===null||n===void 0?void 0:n.height)||1;this._edgeMaterial.uniforms.screenSize.value=new f.FM8(a,c),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(r=this._viewerApp.getPlugin(qi))===null||r===void 0||r.updateShaderProperties(this._edgeMaterial),(o=this._viewerApp.getPlugin(rv))===null||o===void 0||o.updateShaderProperties(this._edgeMaterial),s.blit(void 0,e,{material:this._edgeMaterial})}};ex=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([ci("SSBevel")],ex);class vp extends sl{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[ln,qi,rv],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new sT(t))}passCtor(e){var t,n;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:f.cLu,minFilter:f.TyD,magFilter:f.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const r=e.getPluginByType("debug");return r&&r.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new ex(e.renderer,this._bevelTarget,(n=(t=e.getPlugin(qi))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:"",e)}async onAdded(e){var t,n,r,o,a,c,d;await super.onAdded(e);const p=e.getPlugin(ln);return!((t=this.pass)===null||t===void 0)&&t.passObject.materialExtension&&((n=p==null?void 0:p.materials)===null||n===void 0||n.registerMaterialExtension((r=this.pass)===null||r===void 0?void 0:r.passObject.materialExtension)),(o=p==null?void 0:p.importer)===null||o===void 0||o.addEventListener("loaderCreate",this._loaderCreate),(d=(c=(a=p==null?void 0:p.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||c===void 0?void 0:c.extensions)===null||d===void 0||d.push(oT),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,r;(e=this._viewer)===null||e===void 0||e.setDirty(),(r=(t=this.pass)===null||t===void 0?void 0:(n=t.passObject.materialExtension).setDirty)===null||r===void 0||r.call(n)}_update(e){var t;let n=this.enabled;if(n&&!this._lastEnabled){const r=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?r.enabled=!0:(this.enabled=!1,r.enabled=!1,n=!1)}return this._lastEnabled=n,n}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(c=>ke(c)))===null||o===void 0||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),a}}vp.PluginType="SSBevelPlugin",vp.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class sT{constructor(e){this.parser=e,this.name=vp.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),FE(t),t.userData._ssBevel=mi(r,t.userData._ssBevel,!1,{}),Promise.resolve()}}const oT=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=yi(e.userData._ssBevel,!1);t.extensions[vp.SSBEVEL_GLTF_EXTENSION]=n,s.extensionsUsed[vp.SSBEVEL_GLTF_EXTENSION]=!0}});class jE extends Bw{constructor(e){super(),this._loadedLibs=!1,e=e||{method:h_.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new TM().registerExtensions(iT).registerExtensions([zE,Wy,Vy,Gy,Hy,qy,Yy,Xy,Ky,Jy,Zy,$y,eb,tb,nb]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,...n}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,n);await this._loadLibs();const r={...n};t&&(r.externalImagesInExtras=!0);const o=await new Promise((A,x)=>this.parse(e,A,x,r)),a=await super.parseAsync(o,r);if(!t)return a;if(!o)throw new Error("GLTFDracoExporter: gltf is null");let c=o;const d=c.byteLength||1/0,p=await(typeof c!="object"||c.byteLength?this._io.readBinary(new Uint8Array(c)):this._io.readJSON({json:c,resources:{}}));if(p.createExtension(h_).setRequired(!0).setEncoderOptions(this._encoderOptions),r.exportExt==="glb")c=await this._io.writeBinary(p),isFinite(d)&&console.log("DRACO Compression ratio: "+(c.byteLength/d).toFixed(5));else{const A=await this._io.writeJSON(p);c=A.json,Object.values(A.resources).filter(x=>x).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),c.resources=A.resources)}c.__isGLTFOutput=!0;const m=await super.parseAsync(c,r);return m.__uncompressed=a,m}}class tx extends Zn{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[ln,s_]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(n,r){kw(n,jE,o=>{const a=gs()+".drc",c=o;c.loader=r.registerFile(a),c.loader.setDecoderConfig({type:"js"}),c.loader.preload(!0,!0)})})(e,t)}}tx.PluginType="GLTFDracoExportPlugin";class aT extends us{constructor(){super(...arguments),this.extensionName=Mo,this.parentTypes=[an.SCENE],this.propertyType="ViewerJSON"}init(){}}class zE extends Fr{constructor(){super(...arguments),this.extensionName=Mo,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)===null||t===void 0||t.forEach((n,r)=>{if(n.extensions&&n.extensions[Mo]){const o=new aT(this.document.getGraph());e.scenes[r].setExtension(Mo,o);const a=n.extensions[Mo];this._viewerConfig=a}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(Mo)){const r=(n=e.jsonDoc.json.scenes)===null||n===void 0?void 0:n[e.jsonDoc.json.scene||0];r&&this._viewerConfig!=={}&&(r.extensions=r.extensions||{},r.extensions[Mo]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}zE.EXTENSION_NAME=Mo;class Qy extends us{constructor(e,t,n){super(e,t),this.parentTypes=[an.MATERIAL,an.MESH,an.NODE,an.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}addTexture(e,t,n,r=4369){this.setRef(e,n,{channels:r}),this.textures[e]=[t,n]}copy(e,t=$u){return super.copy(e,t),this}dispose(){Object.values(this.textures).forEach(([e,t])=>{e==null||e.dispose()}),super.dispose()}init(){}}class Va extends Fr{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],r=t.json.textures||[];return n.forEach((o,a)=>{var c,d;if(o.extensions&&o.extensions[this.extensionName]){const p=new Qy(this.document.getGraph(),"",this.extensionName);e.materials[a].setExtension(this.extensionName,p);const m={...o.extensions[this.extensionName]};for(const[A,x]of Object.entries(m))if(typeof(x==null?void 0:x.index)=="number"){const E=x,M=(c=r[E.index])===null||c===void 0?void 0:c.source;if(typeof M!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",E);continue}const T=e.textures[M],O=new Br(this.document.getGraph()),P=(d=this.textureChannels[A])!==null&&d!==void 0?d:4369;p.addTexture(A,O,T,P),e.setTextureInfo(O,E),delete m[A]}p.setExtras(m)}}),(t.json.meshes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new Qy(this.document.getGraph(),"",this.extensionName);e.meshes[a].setExtension(this.extensionName,c);const d=o.extensions[this.extensionName];c.setExtras(d)}}),(t.json.nodes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new Qy(this.document.getGraph(),"",this.extensionName);e.nodes[a].setExtension(this.extensionName,c);const d=o.extensions[this.extensionName];c.setExtras(d)}}),(t.json.scenes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const c=new Qy(this.document.getGraph(),"",this.extensionName);e.scenes[a].setExtension(this.extensionName,c);const d=o.extensions[this.extensionName];c.setExtras(d)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const c={...r.getExtras()};for(const[d,p]of Object.entries(r.textures)){const m=p[0],A=p[1];A&&(c[d]=e.createTextureInfoDef(A,m))}a.extensions[this.extensionName]=c}}),this.document.getRoot().listMeshes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.meshIndexMap.get(n),a=t.json.meshes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.nodeIndexMap.get(n),a=t.json.nodes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.jsonDoc.json.scene||0,a=t.json.scenes[o];if(!a)return;a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this}}class Vy extends Va{constructor(){super(...arguments),this.extensionName=Vy.EXTENSION_NAME,this.textureChannels={bumpTexture:cs.R}}}Vy.EXTENSION_NAME=$o;class Gy extends Va{constructor(){super(...arguments),this.extensionName=Gy.EXTENSION_NAME,this.textureChannels={lightMapTexture:cs.R|cs.G|cs.B}}}Gy.EXTENSION_NAME=ea;class Hy extends Va{constructor(){super(...arguments),this.extensionName=Hy.EXTENSION_NAME,this.textureChannels={alphaTexture:cs.G}}}Hy.EXTENSION_NAME=tl;class Wy extends Va{constructor(){super(...arguments),this.extensionName=Wy.EXTENSION_NAME}}Wy.EXTENSION_NAME=_r.DIAMOND_GLTF_EXTENSION;class qy extends Va{constructor(){super(...arguments),this.extensionName=qy.EXTENSION_NAME}}qy.EXTENSION_NAME=rr.AnimationMarkersExtension;class Yy extends Va{constructor(){super(...arguments),this.extensionName=Yy.EXTENSION_NAME,this.textureChannels={anisotropyDirection:cs.R|cs.G|cs.B}}}Yy.EXTENSION_NAME=Vo.ANISOTROPY_GLTF_EXTENSION;class Xy extends Va{constructor(){super(...arguments),this.extensionName=Xy.EXTENSION_NAME,this.textureChannels={anisotropyDirection:cs.R|cs.G|cs.B}}}Xy.EXTENSION_NAME=Es.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class Ky extends Va{constructor(){super(...arguments),this.extensionName=Ky.EXTENSION_NAME}}Ky.EXTENSION_NAME=he;class Jy extends Va{constructor(){super(...arguments),this.extensionName=Jy.EXTENSION_NAME}}Jy.EXTENSION_NAME=$a;class Zy extends Va{constructor(){super(...arguments),this.extensionName=Zy.EXTENSION_NAME}}Zy.EXTENSION_NAME=To;class $y extends Va{constructor(){super(...arguments),this.extensionName=$y.EXTENSION_NAME}}$y.EXTENSION_NAME=Pa.CLEARCOAT_TINT_GLTF_EXTENSION;class eb extends Va{constructor(){super(...arguments),this.extensionName=eb.EXTENSION_NAME}}eb.EXTENSION_NAME=oa.THIN_FILM_LAYER_GLTF_EXTENSION;class tb extends Va{constructor(){super(...arguments),this.extensionName=tb.EXTENSION_NAME}}tb.EXTENSION_NAME=vp.SSBEVEL_GLTF_EXTENSION;class nb extends Va{constructor(){super(...arguments),this.extensionName=nb.EXTENSION_NAME}}nb.EXTENSION_NAME=Os.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class QE extends ct{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}QE.PluginType="PMREMGenerator";const VE=new f.Pa4,lT=new f._fP,GE=new f.Pa4;class cT extends f.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const th=new f.yGw,uT=new f.yGw;class hT{constructor(e={}){const t=this;let n,r,o,a;const c={camera:{fov:0,style:""},objects:new WeakMap},d=e.element!==void 0?e.element:document.createElement("div");d.style.overflow="hidden",this.domElement=d;const p=document.createElement("div");function m(M){return Math.abs(M)<1e-10?0:M}function A(M){const T=M.elements;return"matrix3d("+m(T[0])+","+m(-T[1])+","+m(T[2])+","+m(T[3])+","+m(T[4])+","+m(-T[5])+","+m(T[6])+","+m(T[7])+","+m(T[8])+","+m(-T[9])+","+m(T[10])+","+m(T[11])+","+m(T[12])+","+m(-T[13])+","+m(T[14])+","+m(T[15])+")"}function x(M){const T=M.elements;return"translate(-50%,-50%)matrix3d("+m(T[0])+","+m(T[1])+","+m(T[2])+","+m(T[3])+","+m(-T[4])+","+m(-T[5])+","+m(-T[6])+","+m(-T[7])+","+m(T[8])+","+m(T[9])+","+m(T[10])+","+m(T[11])+","+m(T[12])+","+m(T[13])+","+m(T[14])+","+m(T[15])+")"}function E(M,T,O,P){if(M.isCSS3DObject){const R=M.visible===!0&&M.layers.test(O.layers)===!0;if(M.element.style.display=R===!0?"":"none",R===!0){let I;M.onBeforeRender(t,T,O),M.isCSS3DSprite?(th.copy(O.matrixWorldInverse),th.transpose(),M.rotation2D!==0&&th.multiply(uT.makeRotationZ(M.rotation2D)),M.matrixWorld.decompose(VE,lT,GE),th.setPosition(VE),th.scale(GE),th.elements[3]=0,th.elements[7]=0,th.elements[11]=0,th.elements[15]=1,I=x(th)):I=x(M.matrixWorld);const j=M.element,z=c.objects.get(M);if(z===void 0||z.style!==I){j.style.transform=I;const V={style:I};c.objects.set(M,V)}j.parentNode!==p&&p.appendChild(j),M.onAfterRender(t,T,O)}}for(let R=0,I=M.children.length;R<I;R++)E(M.children[R],T,O)}p.style.transformStyle="preserve-3d",p.style.pointerEvents="none",d.appendChild(p),this.getSize=function(){return{width:n,height:r}},this.render=function(M,T){const O=T.projectionMatrix.elements[5]*a;let P,R;c.camera.fov!==O&&(d.style.perspective=T.isPerspectiveCamera?O+"px":"",c.camera.fov=O),M.matrixWorldAutoUpdate===!0&&M.updateMatrixWorld(),T.parent===null&&T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),T.isOrthographicCamera&&(P=-(T.right+T.left)/2,R=(T.top+T.bottom)/2);const I=T.isOrthographicCamera?"scale("+O+")translate("+m(P)+"px,"+m(R)+"px)"+A(T.matrixWorldInverse):"translateZ("+O+"px)"+A(T.matrixWorldInverse),j=I+"translate("+o+"px,"+a+"px)";c.camera.style!==j&&(p.style.transform=j,c.camera.style=j),E(M,M,T)},this.setSize=function(M,T){n=M,r=T,o=n/2,a=r/2,d.style.width=M+"px",d.style.height=T+"px",p.style.width=M+"px",p.style.height=T+"px"}}}var ib,rb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let td=ib=class extends Zn{constructor(s=!0){super(),this._scene=new f.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,t,n,r,o;const a=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();if(!(a!=null&&a.geometry))return void await((n=this._viewer)===null||n===void 0?void 0:n.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const c=await((r=this._viewer)===null||r===void 0?void 0:r.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!c)return;const d=await((o=this._viewer)===null||o===void 0?void 0:o.prompt("Width: Enter the width for the object.","512",!1))||"512";d&&this.attachIFrame(a,c,parseInt(d))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=s,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const s=this._viewer;s&&this._renderer&&(s.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",s.canvas):this._renderer.domElement.appendChild(s.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new hT;const s=this._viewer.renderer.rendererObject.getSize(new f.FM8);this._renderer.setSize(s.width,s.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new f.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(s){await super.onAdded(s);let e=!0,t=!0;s.addEventListener("postFrame",o=>{var a,c;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(d=>{var p,m;let A=!0;const x=d.modelObj.material.side;if(x!==f.ehD){const E=new f.Pa4(0,0,1).applyQuaternion(d.cssObj.quaternion),M=(m=(p=this._viewer)===null||p===void 0?void 0:p.scene.activeCamera)===null||m===void 0?void 0:m.cameraObject,T=E.dot(M.getWorldDirection(new f.Pa4));A=x===f._Li?T>0:T<0}d.cssObj.element.style.visibility=A?"visible":"hidden"}),this._trackers.filter(d=>d.dirty).forEach(d=>this._syncProperties(d)),(a=this._renderer)===null||a===void 0||a.render(this._scene,(c=s.scene.activeCamera)===null||c===void 0?void 0:c.cameraObject),e=!1))}),s.addEventListener("update",o=>{this.enabled&&(e=this._trackers.length>0)}),s.scene.addEventListener("sceneUpdate",o=>{this.enabled&&(this._trackers.forEach(a=>a.dirty=!0),e=this._trackers.length>0)}),s.scene.addEventListener("activeCameraUpdate",o=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const r=new f.iMs;s.container.addEventListener("mousemove",o=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const a=this._viewer.canvas.getBoundingClientRect(),c=(o.clientX-a.x)/a.width*2-1,d=-(o.clientY-a.y)/a.height*2+1;r.setFromCamera({x:c,y:d},this._viewer.scene.activeCamera.cameraObject);const p=this._trackers.map(A=>A.modelObj),m=r.intersectObjects(p,!1);if(console.log(m),m.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(s,e,t){const n=ob(s.modelObject),r=HE(e,t,t*n.y/n.x,()=>{var o;return(o=s.setDirty)===null||o===void 0?void 0:o.call(s)});return this.attachCSS3DObject(r,s),r}attachCSS3DObject(s,e){var t,n,r,o,a;if(this._trackers.push({cssObj:s,modelObj:e.modelObject,dirty:!0}),s.element&&(this._resizeObserver.observe(s.element),s.element.__isCSS3DObjectElement=!0,console.log(s.element,s.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const c=(t=this._viewer)===null||t===void 0?void 0:t.createMaterial("basic",{opacity:0,color:new f.Ilk("black"),blending:f.jFi,side:f.Wl3});if(!c)throw"cannot create mat";c.userData.forcedLinearDepth=0,(n=e.setMaterial)===null||n===void 0||n.call(e,c),sb(e.modelObject),nx(e.modelObject),ob(e.modelObject),this._scene.add(s),(o=(r=this.uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||o===void 0||o.call(r),(a=e.setDirty)===null||a===void 0||a.call(e)}_syncProperties(s){const e=s.modelObj,t=s.cssObj;e.updateMatrixWorld();const n=s.cssObj.element.clientWidth<1.5?0:(s.cssObj.element.clientWidth-1.5)/ob(e).x,r=sb(e);t.quaternion.setFromUnitVectors(new f.Pa4(0,0,1),r),t.position.copy(nx(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),s.dirty=!1}async onDispose(s){return this._resizeObserver.disconnect(),super.onDispose(s)}};function HE(s,e,t,n){const r=document.createElement("div");r.style.width=e.toString()+"px",r.style.height=t.toString()+"px",r.style.backgroundColor="transparent";const o=document.createElement("iframe",{is:"x-frame-bypass"});o.style.width="100%",o.style.height="100%",o.style.border="0px";const a=()=>{var c,d;try{o.contentWindow.name}catch(p){(typeof p=="string"?p:(d=(c=p==null?void 0:p.toString)===null||c===void 0?void 0:c.call(p))!==null&&d!==void 0?d:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(p)}n(),o.removeEventListener("load",a)};return o.addEventListener("load",a),o.src=s,r.appendChild(o),new cT(r)}function sb(s){if(s.geometry.userData.geometryNormal)return s.geometry.userData.geometryNormal;const e=s.geometry.attributes.normal,t=new f.Pa4,n=new f.Pa4;for(let r=0,o=e.count;r<o;r++)t.fromBufferAttribute(e,r),n.add(t);return n.normalize(),s.geometry.userData.geometryNormal=n,n}function nx(s){if(s.geometry.userData.geometryCenter)return s.geometry.userData.geometryCenter;const e=s.geometry;if(!e)return new f.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new f.Pa4);return s.geometry.userData.geometryCenter=t,t}function ob(s,e=new f.Pa4(0,0,1)){if(s.geometry.userData.geometrySize)return s.geometry.userData.geometrySize;const t=s.geometry;if(!t)return new f.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new f.yGw().makeRotationFromQuaternion(new f._fP().setFromUnitVectors(e,sb(s)).invert())),n.computeBoundingBox();const r=n.boundingBox.getSize(new f.Pa4);return s.geometry.userData.geometrySize=r,n.dispose(),r}td.PluginType="CSS3DRenderer",rb([gn("Enabled"),ve(ib.prototype._refreshEnabled),Ne()],td.prototype,"enabled",void 0),rb([gn("Over canvas"),ve(ib.prototype._refreshCanvasInDOM),Ne()],td.prototype,"overCanvas",void 0),rb([Si("Attach iframe")],td.prototype,"attachIFrameToSelected",void 0),td=ib=rb([ci("CSS3D Renderer")],td);const dT=1e4,WE=50;class sv{constructor(e=WE){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,n,r){const o=2e-4*this.naturalFrequency;if(e==null||r===0||e===t&&this.velocity===0)return t;if(n<0)return e;const a=e-t,c=this.velocity+this.naturalFrequency*a,d=a+n*c,p=Math.exp(-this.naturalFrequency*n),m=(c-this.naturalFrequency*d)*p,A=-this.naturalFrequency*(m+c*p);return Math.abs(m)<o*Math.abs(r)&&A*a>=0?(this.velocity=0,t):(this.velocity=m,t+d*p)}}const ix=new f.Pa4;class qE{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new f.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new f.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new f.Pa4,this._hitMatrix=new f.yGw,this.xDamper=new sv,this.yDamper=new sv,this.zDamper=new sv,this.yawDamper=new sv,this.scaleDamper=new sv,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),r=this.presentedScene,o=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:a}=this.inputSource.gamepad||{axes:[0,0]},c=o.getHit(r,a[0],a[1]);o.show=!0,c!=null?(this.isTranslating=!0,this.lastDragPosition.copy(c)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*a[0])}else if(n.length===2){o.show=!0,this.isTwoFingering=!0;const{separation:a}=this.fingerPolar(n);this.firstRatio=a/r.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n,r){var o;this.transientHitTestSource=await((o=e.requestHitTestSourceForTransientInput)===null||o===void 0?void 0:o.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=r,this.xr=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const n=(t=this.xr)===null||t===void 0?void 0:t.getReferenceSpace(),r=n?e.getPose(n):null;return r?(this._hitMatrix.fromArray(r.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,r=t.rotation.y,o=this.placementBox,a=Math.max(o.boundingSize.x,o.boundingSize.y,o.boundingSize.z)/2,c=this.goalPosition,d=t.scale.x;if(!c.equals(n)||this.goalScale!==d){let{x:p,y:m,z:A}=n;p=this.xDamper.update(p,c.x,e,a),m=this.yDamper.update(m,c.y,e,a),A=this.zDamper.update(A,c.z,e,a),n.set(p,m,A);const x=this.scaleDamper.update(d,this.goalScale,e,1);if(t.scale.set(x,x,x),!this.isTranslating){const E=c.y-m;this.placementComplete&&!this.placeOnWall?o.offsetHeight=E/x:E===0&&(this.placementComplete=!0,o.show=!1)}}o.updateOpacity(e),t.rotation.y=this.yawDamper.update(r,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const n=this.transientHitTestSource;if(!n||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const r=e.getHitTestResultsForTransientInput(n),o=this.presentedScene,a=o.scale.x;if(this.isTwoFingering)if(r.length<2)this.isTwoFingering=!1;else{const{separation:c,deltaYaw:d}=this.fingerPolar(r);if(this.placeOnWall||(this.goalYaw+=d),!o.userData.__scaleDisabled){const p=c/this.firstRatio;this.goalScale=p<1.3&&p>.7692307692307692?1:p}}else if(r.length!==2)if(this.isRotating&&(!((t=this.inputSource)===null||t===void 0)&&t.gamepad)){const c=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=c-this.lastAngle,this.lastAngle=c}else this.isTranslating&&(console.log("translating"),r.forEach(c=>{if(c.inputSource!==this.inputSource)return;let d=null;if(c.results.length>0&&(d=this.getHitPoint(c.results[0])),d==null&&(d=this.getTouchLocation()),d!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const p=d.y-this.lastDragPosition.y;if(p<0){this.placementBox.offsetHeight=p/a;const m=ix.copy(this.xr.getCamera().position),A=-p/(m.y-d.y);m.multiplyScalar(A),d.multiplyScalar(1-A).add(m)}}this.goalPosition.add(d),this.lastDragPosition.copy(d)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:c}=this.fingerPolar(r);this.firstRatio=c/a}}getTouchLocation(){var e,t;const{axes:n}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},r=this.placementBox.getExpandedHit(this.presentedScene,n[0],n[1]);return r!=null&&(ix.copy(r).sub((t=this.xr)===null||t===void 0?void 0:t.getCamera().position),ix.length()>10)?null:r}fingerPolar(e){var t,n,r,o,a,c;const d=(r=(n=(t=e[0].inputSource)===null||t===void 0?void 0:t.gamepad)===null||n===void 0?void 0:n.axes)!==null&&r!==void 0?r:[0,0],p=(c=(a=(o=e[1].inputSource)===null||o===void 0?void 0:o.gamepad)===null||a===void 0?void 0:a.axes)!==null&&c!==void 0?c:[0,0],m=p[0]-d[0],A=p[1]-d[1],x=Math.atan2(A,m);let E=this.lastAngle-x;return E>Math.PI?E-=2*Math.PI:E<-Math.PI&&(E+=2*Math.PI),this.lastAngle=x,{separation:Math.sqrt(m*m+A*A),deltaYaw:E}}}const ab=.2,pT=Math.PI/24,YE=new f.FM8,lb=(s,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let r=0;r<=12;++r)s.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+ab*Math.cos(n),t+ab*Math.sin(n),0),n+=pT};class XE extends f.Kj0{constructor(e,t,n=!1){super(((d,p)=>{const m=new f.u9r,A=[],x=[],E=d.getSize(new f.Pa4),M=E.x/2,T=(p?E.y:E.z)/2;lb(x,M,T),lb(x,-M,T),lb(x,-M,-T),lb(x,M,-T);const O=x.length/3;for(let R=0;R<O-2;R+=2)A.push(R,R+1,R+3,R,R+3,R+2);const P=O-2;return A.push(P,P+1,1,P,1,0),m.setAttribute("position",new f.a$l(x,3)),m.setIndex(A),m})(e,n)),this.boundingSize=new f.Pa4,this._raycaster=new f.iMs,this._camera=t,this._placeOnWall=n;const r=this.material;r.side=f.Wl3,r.color=new Pi(16711935),r.opacity=0,this.userData.bboxVisible=!1;const o=e.getSize(this.boundingSize);console.log(e,n,o,this);const a=o.x/2,c=(n?o.y:o.z)/2;this.hitPlane=new f.Kj0(new f._12(2*(a+ab),2*(c+ab))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){YE.set(t,-n),this.hitPlane.visible=!0;const r=this._positionAndNormalFromPoint(YE,this.hitPlane);return this.hitPlane.visible=!1,r==null?null:r.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const r=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),r}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:n}=this.hitPlane;t.dispose(),n.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const r=n[0];return r.face==null?null:r.uv==null?{position:r.point,normal:r.face.normal,uv:null}:(r.face.normal.applyNormalMatrix(new f.Vkp().getNormalMatrix(r.object.matrixWorld)),{position:r.point,normal:r.face.normal,uv:r.uv})}}class KE extends Zn{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new qE,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=e.cameras[0]||e,n=this._viewer.scene.activeCamera;n.cameraObject.projectionMatrix.copy(t.projectionMatrix),n.cameraObject.projectionMatrixInverse.copy(n.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,t;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const n=this._viewer.renderer,r=(t=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||t===void 0?void 0:t.cameras[0].viewport;r?n.rendererObject.setViewport(r):console.warn("no viewport for ar camera"),$t(n.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{cb.render(n.rendererObject,null,n.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:t})=>{var n,r;if(this.dirty=!!e&&((n=this._xrManager)===null||n===void 0?void 0:n.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const o=this._xrManager.getReferenceSpace(),a=e.getViewerPose(o);if(a==null&&this._frameCount,a==null||((r=this._viewer)===null||r===void 0?void 0:r.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const c=this._viewer.scene.activeCamera;this._xrManager.updateCamera(c.cameraObject),c.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(t),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new f.Pa4(1,1,1),modelPosition:new f.Pa4,modelRotation:new f._fP,cameraPosition:new f.Pa4(0,0,5),cameraTarget:new f.Pa4,cameraUp:new f.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new f.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far;const n=this._viewer.getPluginByType("Ground");n!=null&&n.mesh&&(this._preXRState.groundOffset.subVectors(e.position,n.mesh.modelObject.position),this._preXRState.groundScale=n.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),n.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,t=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var n,r;if(this._xrSession){const o=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((r=(n=this._xrSession).requestHitTestSource)===null||r===void 0?void 0:r.call(n,{space:o,offsetRay:t}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;t.enabled=!0,t.cameraAutoUpdate=!1,this._xrManager=t;const n=document.getElementById("tweakpaneUiContainer"),r=n?{root:n}:void 0;document.body.appendChild(class{static createButton(o,a={}){const c=document.createElement("button");function d(){c.style.display="",c.style.cursor="auto",c.style.left="calc(50% - 75px)",c.style.width="150px",c.onmouseenter=null,c.onmouseleave=null,c.onclick=null}function p(m){m.style.position="absolute",m.style.bottom="20px",m.style.padding="12px 6px",m.style.border="1px solid #fff",m.style.borderRadius="4px",m.style.background="rgba(0,0,0,0.1)",m.style.color="#fff",m.style.font="normal 13px sans-serif",m.style.textAlign="center",m.style.opacity="0.5",m.style.outline="none",m.style.zIndex="999"}if("xr"in navigator)return c.id="ARButton",c.style.display="none",p(c),navigator.xr.isSessionSupported("immersive-ar").then(function(m){m?function(){if(a.domOverlay===void 0){const M=document.createElement("div");M.style.display="none",document.body.appendChild(M);const T=document.createElementNS("http://www.w3.org/2000/svg","svg");T.setAttribute("width",38),T.setAttribute("height",38),T.style.position="absolute",T.style.right="20px",T.style.top="20px",T.addEventListener("click",function(){A.end()}),M.appendChild(T);const O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),O.setAttribute("stroke","#fff"),O.setAttribute("stroke-width",2),T.appendChild(O),a.optionalFeatures===void 0&&(a.optionalFeatures=[]),a.optionalFeatures.push("dom-overlay"),a.domOverlay={root:M}}let A=null;async function x(M){M.addEventListener("end",E),o.xr.setReferenceSpaceType("local"),await o.xr.setSession(M),c.textContent="STOP AR",a.domOverlay.root.style.display="",A=M}function E(){A.removeEventListener("end",E),c.textContent="START AR",a.domOverlay.root.style.display="none",A=null}c.style.display="",c.style.cursor="pointer",c.style.left="calc(50% - 50px)",c.style.width="100px",c.textContent="START AR",c.onmouseenter=function(){c.style.opacity="1.0"},c.onmouseleave=function(){c.style.opacity="0.5"},c.onclick=function(){A===null?navigator.xr.requestSession("immersive-ar",a).then(x):A.end()}}():(d(),c.textContent="AR NOT SUPPORTED")}).catch(function(m){d(),console.warn("Exception when trying to call xr.isSessionSupported",m),c.textContent="AR NOT ALLOWED"}),c;{const m=document.createElement("a");return window.isSecureContext===!1?(m.href=document.location.href.replace(/^http:/,"https:"),m.innerHTML="WEBXR NEEDS HTTPS"):(m.href="https://immersiveweb.dev/",m.innerHTML="WEBXR NOT AVAILABLE"),m.style.left="calc(50% - 90px)",m.style.width="180px",m.style.textDecoration="none",p(m),m}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:r})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,t=this._viewer.getPluginByType("Ground");t&&(t.groundReflection=!1,t.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),t.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const t=e.getHitTestResults(this._hitTestSource);if(!t.length)return;const n=t[0],r=this._touchInputHelper.getHitPoint(n);r&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(r):this._touchInputHelper.goalPosition.y=r.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",r))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const t=this._viewer.scene.modelRoot,n=this._viewer.scene.activeCamera,r=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),o=r.cameras[0]||r;this._removePlacementBox();const a=this._viewer.scene.getBounds(!0,!0);a.getSize(new f.Pa4).length()>.01&&(this._placementBox=new XE(a,r,this.placeOnWall),t.add(this._placementBox),this._placementBox.show=!1);const c=r.getWorldDirection(new f.Pa4);t.rotation.y=Math.atan2(-c.x,-c.z)-0,n.cameraObject.zoom=o.zoom,n.cameraObject.near=o.near,n.cameraObject.far=o.far,n.cameraObject.isPerspectiveCamera?(n.cameraObject.fov=o.fov,n.cameraObject.aspect=o.viewport.width/o.viewport.height):console.warn("Perspective camera required."),n.cameraObject.updateProjectionMatrix(),t.position.set(0,0,0);const d=t.userData.arScale||1;t.scale.set(d,d,d),t.position.copy(r.position).add(c.multiplyScalar(5)),t.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(t.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}KE.PluginType="WEBXR_ARPlugin";const cb=new vt({vertexShader:It.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:It.uniforms});async function JE(s,e){if(s.createWriter){const n=await s.createWriter();return await n.write(0,e),void await n.close()}const t=await s.createWritable();await t.write(e),await t.close()}async function fT(s,e){const t={};return e&&(t.writable=!0,t.mode="readwrite"),await s.queryPermission(t)==="granted"||await s.requestPermission(t)==="granted"}cb.renderToScreen=!1,cb.useExistingRenderTarget=!0,cb.clear=!1;class d_ extends ct{constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=r=>{var o;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const a=new Blob(this._currentRecording,{type:this._options.mimeType});(o=this._recordingCallback)===null||o===void 0||o.call(this,a)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=r=>{var o;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((o=this._recorder)===null||o===void 0||o.pause())},this._onresume=r=>{if(!this.stepMode)return;const o=()=>{var c;this._state==="recording"&&((c=this._recorder)===null||c===void 0||c.pause())},a=Math.min(this._resumeSyncTime-ui(),0)+1e3/this._options.frameRate;a>0?Ir(a).then(o):o()},this._onpause=r=>{},this._ondataavailable=r=>{r.data&&r.data.size>0&&this._currentRecording.push(r.data)},this._onerror=r=>{this._state="error",this._console.error(r),this.dispatchEvent({type:"error",error:r}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30},this._setOptions(t||this._options)}_setOptions(e){var t,n;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(t=d_.GetSupportedMimeTypes([],["h264"],!0))!==null&&t!==void 0?t:d_.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((n=this._options.mimeType)===null||n===void 0)&&n.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,t,n;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const r={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=r.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const o=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),a=(t=o.getVideoTracks())===null||t===void 0?void 0:t[0];this._track=a,this._recorder=new window.MediaRecorder(o,r),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(n=this._recorder)===null||n===void 0||n.start()):window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const a=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=a,this._state="recording",this._onstart({})}).catch(o=>{this._onerror({detail:o})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=ui(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([r,o])=>await(await fetch(o)).blob())),n=[];for(let r=0;r<e.length;r++){const o=await this._imgDirectory.getFileHandle(e[r][0],{create:!0});n.push(JE(o,t[r]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter(c=>!e||e.length<1||e.includes(c)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(c=>!t||t.length<1||t.includes(c)),a=[];return r.forEach(c=>{const d=`video/${c}`;o.forEach(p=>{[`${d};codecs=${p}`,`${d};codecs:${p}`,`${d};codecs=${p.toUpperCase()}`,`${d};codecs:${p.toUpperCase()}`,`${d}`].forEach(m=>{MediaRecorder.isTypeSupported(m)&&a.push(m)})})}),n?a.length>0?a[0]:void 0:a}}var rx=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class nh extends Zn{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const r=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||n===void 0?void 0:n.isConverged())||!1,r&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||n===void 0)&&n.isConverged(!0))){const r=()=>{var o;return(o=this._recorder)===null||o===void 0?void 0:o.requestFrame()};this.convergeMode?Ir(1).then(r):r()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}}get recorder(){return this._recorder}isRecording(){var e,t;return(t=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&t!==void 0&&t}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new d_(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var t,n,r;this.dirty=e,(t=this._viewer)===null||t===void 0||t.setDirty(),(r=(n=this._uiConfig)===null||n===void 0?void 0:n.children)===null||r===void 0||r.map(o=>ke(o)).flat(2).forEach(o=>{var a;return(a=o==null?void 0:o.uiRefresh)===null||a===void 0?void 0:a.call(o)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),(t=this._recorder)===null||t===void 0||t.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((t,n)=>{var r;return(r=this.recorder)===null||r===void 0?void 0:r.stop(t)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(t=>({label:t[0],value:t[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var t,n;return(n=(t=e.recorder)===null||t===void 0?void 0:t.state)!==null&&n!==void 0?n:"not initialized"},set value(t){}},{type:"button",get label(){var t;return!((t=e.recorder)===null||t===void 0)&&t.isRecording()?"Stop":"Start"},value:()=>{var t;!((t=e.recorder)===null||t===void 0)&&t.isRecording()?this.stopRecording().then(n=>{if(n){console.log(n);const r=n.type.split(";")[0].split("/").pop()||"mp4";Jr(n,"test."+r)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var t,n;return!!(!((t=e.recorder)===null||t===void 0)&&t.isRecording())||!(!((n=this._viewer)===null||n===void 0)&&n.getPluginByType("CameraViews"))},value:()=>{var t,n;(n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CameraViews"))===null||n===void 0||n.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var t,n,r,o;return!!(!((t=e.recorder)===null||t===void 0)&&t.isRecording())||!(!((n=this._viewer)===null||n===void 0)&&n.getPluginByType("CameraViews"))||!(!((o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("GLTFAnimation"))===null||o===void 0)&&o.animations.length)},value:()=>{var t,n,r,o;const a=((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("GLTFAnimation"))===null||n===void 0?void 0:n.animationState)==="playing";(o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("CameraViews"))===null||o===void 0||o.recordAllViews(()=>{var c,d;(d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("GLTFAnimation"))===null||d===void 0||d.playAnimation()}).then(()=>{var c,d;a||(d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("GLTFAnimation"))===null||d===void 0||d.stopAnimation()})}}]}}}nh.PluginType="CanvasRecorder",rx([ve(nh.prototype.refreshRecorderOptions),Ne()],nh.prototype,"convergeMode",void 0),rx([ve(nh.prototype.refreshRecorderOptions),Ne()],nh.prototype,"mimeType",void 0),rx([ve(nh.prototype.refreshRecorderOptions),Ne()],nh.prototype,"videoFrameRate",void 0);var ub=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const sx=new f.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});sx.depthTest=!1;const ox=new f.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});ox.depthTest=!1;class ih extends Zs{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new f.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(dl)}async onAdded(e){const t=e.renderer.createTarget({type:f.ywz,format:f.wk1,encoding:f.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:f.wem,magFilter:f.wem});t.texture.name="groundContactDepthTexture";const n=new f.lRF({depthPacking:f.z81});n.onBeforeCompile=function(o){o.uniforms.opacity.value=1,o.fragmentShader=`
						${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const r=new W_(t,n);this._depthPass=r,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:f.ywz,format:f.wk1,encoding:f.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:f.wem,magFilter:f.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(sx.uniforms.h.value=t*this.blurAmount/256,ox.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:sx,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:ox,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new f.Pa4)),this.shadowCamera.setRotationFromEuler(new f.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}ih.PluginType="ContactShadowGroundPlugin",ub([ve(ih.prototype.refreshOptions),Ne()],ih.prototype,"contactShadows",void 0),ub([Ne(),ve(ih.prototype._setDirty)],ih.prototype,"blurAmount",void 0),ub([Ne(),ve(ih.prototype._refreshShadowCameraFrustum)],ih.prototype,"shadowScale",void 0),ub([Ne(),ve(ih.prototype._refreshShadowCameraFrustum)],ih.prototype,"shadowHeight",void 0);const ov=new f.cPb(45,1,.1,1e3);function ax(s,e,t,n=7,r=new f.Pa4(0,0,1.5)){t=t??s.scene.modelObject;const o=new Vt().expandByObject(t??e,!0,!0),a=o.getCenter(new f.Pa4),c=o.getSize(new f.Pa4);ov.position.copy(a).add(r.clone().multiplyScalar(Math.max(c.x,c.y,c.z))),ov.lookAt(a),e&&e.traverseVisible(m=>{m.layers.enable(n)}),n>0?ov.layers.set(n):ov.layers.enableAll();const d=e==null?void 0:e.visible;e&&(e.visible=!0),s.renderer.rendererObject.setRenderTarget(null),s.renderer.rendererObject.render(t,ov);const p=s.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=d,e.traverseVisible(m=>{m.layers.disable(n)}),ov.layers.enableAll()),s.setDirty(),p}class lx{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new f.Kj0(new f.xo$(1)),cube:new f.Kj0(new f.DvJ(1,1,1)),cylinder:new f.Kj0(new f.fHI(.5,.5,1))};const t=new f.xsS;this._channel=7;const n=new f.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new f.Kj0(new f.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const r=n.material.envMapIntensity;typeof r=="number"&&(n.material.envMapIntensity=Math.max(r,2));const o=ax(this.viewer,n,this._scene,this._channel,new f.Pa4(0,0,1.5));return typeof r=="number"&&(n.material.envMapIntensity=r),this._scene.remove(n),n.material=void 0,o}}class hb extends Zn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e))},this.dependencies=[ln],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Pp).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new lx(this._viewer),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(n=this._picking)===null||n===void 0||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())===null||t===void 0?void 0:t.name)}applyVariation(e,t){var n,r;const o=e.materials.find(a=>a.uuid===t);if(o){const a=(r=(n=this._viewer)===null||n===void 0?void 0:n.getManager())===null||r===void 0?void 0:r.materials;let c=a==null?void 0:a.findMaterialsByName(e.uuid);(!c||c.length<1)&&(c=[a==null?void 0:a.findMaterial(e.uuid)]),c.forEach(d=>{if(!d)return;const p=d.name;d.copyProps(o),d.name=p})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const n=(t=e==null?void 0:e.clone)===null||t===void 0?void 0:t.call(e);if(e&&n){let r=this.findVariation(e.uuid);!r&&e.name.length>0&&(r=this.findVariation(e.name)),r||this.variations.push(r={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),r.materials.push(n),this.refreshUi()}}}hb.PluginType="MaterialConfiguratorBasePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Ne()],hb.prototype,"variations",void 0);const ZE=(s,e=!0)=>{const t=new Pi().set(s);return e&&t.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${t.getHexString()}'/%3E%3C/svg%3E%0A`},$E=(s,e=!0)=>{const t=new Pi().set(s);return e&&t.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${t.getHexString()}'/%3E%3C/svg%3E%0A`},p_=s=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${s}%3C/text%3E%3C/svg%3E%0A`,cx=async(s,e)=>Zr(await gd(s),e),eC=async(s,e)=>await cx(s,e).then(t=>t.toDataURL("image/png"));class ru{static _initialize(){this._inited=!0,Bl(Z`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,t,n,r,o,a,c){var d;this._inited||this._initialize();const p=Dp(),m=p?.15:.25,A=p?1.5:2.5,x=Ji({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});x.style.top=o+"px",x.style.left=r+"px",x.style.gap=m+"rem",x.style.width=(A+m)*n-m+"rem",x.dataset.tag=e;for(const E of a){const M=Ji({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${E.image}" class="customContextGridItemImage">
            `});M.style.width=A+"rem",M.style.height=A+"rem",x.appendChild(M),M.onclick=()=>{var T;return(T=E.onClick)===null||T===void 0?void 0:T.call(E,E.id)},c(M,E)}return(d=this.Elements)===null||d===void 0||d.push(x),x}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const n of this.Elements)n.remove();let t=20;for(const n of this.Elements)n.style.top=t+"px",e.appendChild(n),t+=n.clientHeight+20}}function su(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function av(s){return s instanceof su(s).Element||s instanceof Element}function ac(s){return s instanceof su(s).HTMLElement||s instanceof HTMLElement}function ux(s){return typeof ShadowRoot<"u"&&(s instanceof su(s).ShadowRoot||s instanceof ShadowRoot)}ru.Elements=[],ru._inited=!1;var lm=Math.max,db=Math.min,lv=Math.round;function cv(s,e){e===void 0&&(e=!1);var t=s.getBoundingClientRect(),n=1,r=1;if(ac(s)&&e){var o=s.offsetHeight,a=s.offsetWidth;a>0&&(n=lv(t.width)/a||1),o>0&&(r=lv(t.height)/o||1)}return{width:t.width/n,height:t.height/r,top:t.top/r,right:t.right/n,bottom:t.bottom/r,left:t.left/n,x:t.left/n,y:t.top/r}}function hx(s){var e=su(s);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function rh(s){return s?(s.nodeName||"").toLowerCase():null}function _p(s){return((av(s)?s.ownerDocument:s.document)||window.document).documentElement}function dx(s){return cv(_p(s)).left+hx(s).scrollLeft}function nd(s){return su(s).getComputedStyle(s)}function px(s){var e=nd(s),t=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+n)}function mT(s,e,t){t===void 0&&(t=!1);var n,r,o=ac(e),a=ac(e)&&function(A){var x=A.getBoundingClientRect(),E=lv(x.width)/A.offsetWidth||1,M=lv(x.height)/A.offsetHeight||1;return E!==1||M!==1}(e),c=_p(e),d=cv(s,a),p={scrollLeft:0,scrollTop:0},m={x:0,y:0};return(o||!o&&!t)&&((rh(e)!=="body"||px(c))&&(p=(n=e)!==su(n)&&ac(n)?{scrollLeft:(r=n).scrollLeft,scrollTop:r.scrollTop}:hx(n)),ac(e)?((m=cv(e,!0)).x+=e.clientLeft,m.y+=e.clientTop):c&&(m.x=dx(c))),{x:d.left+p.scrollLeft-m.x,y:d.top+p.scrollTop-m.y,width:d.width,height:d.height}}function fx(s){var e=cv(s),t=s.offsetWidth,n=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:n}}function pb(s){return rh(s)==="html"?s:s.assignedSlot||s.parentNode||(ux(s)?s.host:null)||_p(s)}function tC(s){return["html","body","#document"].indexOf(rh(s))>=0?s.ownerDocument.body:ac(s)&&px(s)?s:tC(pb(s))}function f_(s,e){var t;e===void 0&&(e=[]);var n=tC(s),r=n===((t=s.ownerDocument)==null?void 0:t.body),o=su(n),a=r?[o].concat(o.visualViewport||[],px(n)?n:[]):n,c=e.concat(a);return r?c:c.concat(f_(pb(a)))}function gT(s){return["table","td","th"].indexOf(rh(s))>=0}function nC(s){return ac(s)&&nd(s).position!=="fixed"?s.offsetParent:null}function m_(s){for(var e=su(s),t=nC(s);t&&gT(t)&&nd(t).position==="static";)t=nC(t);return t&&(rh(t)==="html"||rh(t)==="body"&&nd(t).position==="static")?e:t||function(n){var r=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&ac(n)&&nd(n).position==="fixed")return null;var o=pb(n);for(ux(o)&&(o=o.host);ac(o)&&["html","body"].indexOf(rh(o))<0;){var a=nd(o);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||r&&a.willChange==="filter"||r&&a.filter&&a.filter!=="none")return o;o=o.parentNode}return null}(s)||e}var pa="top",yl="bottom",bl="right",fa="left",fb="auto",uv=[pa,yl,bl,fa],cm="start",hv="end",iC="clippingParents",mx="viewport",dv="popper",rC="reference",gx=uv.reduce(function(s,e){return s.concat([e+"-"+cm,e+"-"+hv])},[]),vx=[].concat(uv,[fb]).reduce(function(s,e){return s.concat([e,e+"-"+cm,e+"-"+hv])},[]),sC="beforeRead",oC="read",aC="afterRead",lC="beforeMain",cC="main",uC="afterMain",hC="beforeWrite",dC="write",pC="afterWrite",fC=[sC,oC,aC,lC,cC,uC,hC,dC,pC];function vT(s){var e=new Map,t=new Set,n=[];function r(o){t.add(o.name),[].concat(o.requires||[],o.requiresIfExists||[]).forEach(function(a){if(!t.has(a)){var c=e.get(a);c&&r(c)}}),n.push(o)}return s.forEach(function(o){e.set(o.name,o)}),s.forEach(function(o){t.has(o.name)||r(o)}),n}var mC={placement:"bottom",modifiers:[],strategy:"absolute"};function gC(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function mb(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,n=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?mC:r;return function(a,c,d){d===void 0&&(d=o);var p,m,A={placement:"bottom",orderedModifiers:[],options:Object.assign({},mC,o),modifiersData:{},elements:{reference:a,popper:c},attributes:{},styles:{}},x=[],E=!1,M={state:A,setOptions:function(O){var P=typeof O=="function"?O(A.options):O;T(),A.options=Object.assign({},o,A.options,P),A.scrollParents={reference:av(a)?f_(a):a.contextElement?f_(a.contextElement):[],popper:f_(c)};var R,I,j=function(z){var V=vT(z);return fC.reduce(function(G,X){return G.concat(V.filter(function(ne){return ne.phase===X}))},[])}((R=[].concat(n,A.options.modifiers),I=R.reduce(function(z,V){var G=z[V.name];return z[V.name]=G?Object.assign({},G,V,{options:Object.assign({},G.options,V.options),data:Object.assign({},G.data,V.data)}):V,z},{}),Object.keys(I).map(function(z){return I[z]})));return A.orderedModifiers=j.filter(function(z){return z.enabled}),A.orderedModifiers.forEach(function(z){var V=z.name,G=z.options,X=G===void 0?{}:G,ne=z.effect;if(typeof ne=="function"){var ce=ne({state:A,name:V,instance:M,options:X});x.push(ce||function(){})}}),M.update()},forceUpdate:function(){if(!E){var O=A.elements,P=O.reference,R=O.popper;if(gC(P,R)){A.rects={reference:mT(P,m_(R),A.options.strategy==="fixed"),popper:fx(R)},A.reset=!1,A.placement=A.options.placement,A.orderedModifiers.forEach(function(ne){return A.modifiersData[ne.name]=Object.assign({},ne.data)});for(var I=0;I<A.orderedModifiers.length;I++)if(A.reset!==!0){var j=A.orderedModifiers[I],z=j.fn,V=j.options,G=V===void 0?{}:V,X=j.name;typeof z=="function"&&(A=z({state:A,options:G,name:X,instance:M})||A)}else A.reset=!1,I=-1}}},update:(p=function(){return new Promise(function(O){M.forceUpdate(),O(A)})},function(){return m||(m=new Promise(function(O){Promise.resolve().then(function(){m=void 0,O(p())})})),m}),destroy:function(){T(),E=!0}};if(!gC(a,c))return M;function T(){x.forEach(function(O){return O()}),x=[]}return M.setOptions(d).then(function(O){!E&&d.onFirstUpdate&&d.onFirstUpdate(O)}),M}}var _T=mb(),gb={passive:!0},_x={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(s){var e=s.state,t=s.instance,n=s.options,r=n.scroll,o=r===void 0||r,a=n.resize,c=a===void 0||a,d=su(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(m){m.addEventListener("scroll",t.update,gb)}),c&&d.addEventListener("resize",t.update,gb),function(){o&&p.forEach(function(m){m.removeEventListener("scroll",t.update,gb)}),c&&d.removeEventListener("resize",t.update,gb)}},data:{}};function sh(s){return s.split("-")[0]}function pv(s){return s.split("-")[1]}function Ax(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function vC(s){var e,t=s.reference,n=s.element,r=s.placement,o=r?sh(r):null,a=r?pv(r):null,c=t.x+t.width/2-n.width/2,d=t.y+t.height/2-n.height/2;switch(o){case pa:e={x:c,y:t.y-n.height};break;case yl:e={x:c,y:t.y+t.height};break;case bl:e={x:t.x+t.width,y:d};break;case fa:e={x:t.x-n.width,y:d};break;default:e={x:t.x,y:t.y}}var p=o?Ax(o):null;if(p!=null){var m=p==="y"?"height":"width";switch(a){case cm:e[p]=e[p]-(t[m]/2-n[m]/2);break;case hv:e[p]=e[p]+(t[m]/2-n[m]/2)}}return e}var yx={name:"popperOffsets",enabled:!0,phase:"read",fn:function(s){var e=s.state,t=s.name;e.modifiersData[t]=vC({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},AT={top:"auto",right:"auto",bottom:"auto",left:"auto"};function _C(s){var e,t=s.popper,n=s.popperRect,r=s.placement,o=s.variation,a=s.offsets,c=s.position,d=s.gpuAcceleration,p=s.adaptive,m=s.roundOffsets,A=s.isFixed,x=a.x,E=x===void 0?0:x,M=a.y,T=M===void 0?0:M,O=typeof m=="function"?m({x:E,y:T}):{x:E,y:T};E=O.x,T=O.y;var P=a.hasOwnProperty("x"),R=a.hasOwnProperty("y"),I=fa,j=pa,z=window;if(p){var V=m_(t),G="clientHeight",X="clientWidth";V===su(t)&&nd(V=_p(t)).position!=="static"&&c==="absolute"&&(G="scrollHeight",X="scrollWidth"),(r===pa||(r===fa||r===bl)&&o===hv)&&(j=yl,T-=(A&&V===z&&z.visualViewport?z.visualViewport.height:V[G])-n.height,T*=d?1:-1),r!==fa&&(r!==pa&&r!==yl||o!==hv)||(I=bl,E-=(A&&V===z&&z.visualViewport?z.visualViewport.width:V[X])-n.width,E*=d?1:-1)}var ne,ce=Object.assign({position:c},p&&AT),ge=m===!0?function(de){var xe=de.x,pe=de.y,ye=window.devicePixelRatio||1;return{x:lv(xe*ye)/ye||0,y:lv(pe*ye)/ye||0}}({x:E,y:T}):{x:E,y:T};return E=ge.x,T=ge.y,d?Object.assign({},ce,((ne={})[j]=R?"0":"",ne[I]=P?"0":"",ne.transform=(z.devicePixelRatio||1)<=1?"translate("+E+"px, "+T+"px)":"translate3d("+E+"px, "+T+"px, 0)",ne)):Object.assign({},ce,((e={})[j]=R?T+"px":"",e[I]=P?E+"px":"",e.transform="",e))}var bx={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(s){var e=s.state,t=s.options,n=t.gpuAcceleration,r=n===void 0||n,o=t.adaptive,a=o===void 0||o,c=t.roundOffsets,d=c===void 0||c,p={placement:sh(e.placement),variation:pv(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,_C(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,_C(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},vb={name:"applyStyles",enabled:!0,phase:"write",fn:function(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];ac(o)&&rh(o)&&(Object.assign(o.style,n),Object.keys(r).forEach(function(a){var c=r[a];c===!1?o.removeAttribute(a):o.setAttribute(a,c===!0?"":c)}))})},effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],o=e.attributes[n]||{},a=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(c,d){return c[d]="",c},{});ac(r)&&rh(r)&&(Object.assign(r.style,a),Object.keys(o).forEach(function(c){r.removeAttribute(c)}))})}},requires:["computeStyles"]},AC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(s){var e=s.state,t=s.options,n=s.name,r=t.offset,o=r===void 0?[0,0]:r,a=vx.reduce(function(m,A){return m[A]=function(x,E,M){var T=sh(x),O=[fa,pa].indexOf(T)>=0?-1:1,P=typeof M=="function"?M(Object.assign({},E,{placement:x})):M,R=P[0],I=P[1];return R=R||0,I=(I||0)*O,[fa,bl].indexOf(T)>=0?{x:I,y:R}:{x:R,y:I}}(A,e.rects,o),m},{}),c=a[e.placement],d=c.x,p=c.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=a}},yT={left:"right",right:"left",bottom:"top",top:"bottom"};function _b(s){return s.replace(/left|right|bottom|top/g,function(e){return yT[e]})}var bT={start:"end",end:"start"};function yC(s){return s.replace(/start|end/g,function(e){return bT[e]})}function bC(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&ux(t)){var n=e;do{if(n&&s.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function wx(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function wC(s,e){return e===mx?wx(function(t){var n=su(t),r=_p(t),o=n.visualViewport,a=r.clientWidth,c=r.clientHeight,d=0,p=0;return o&&(a=o.width,c=o.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(d=o.offsetLeft,p=o.offsetTop)),{width:a,height:c,x:d+dx(t),y:p}}(s)):av(e)?function(t){var n=cv(t);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}(e):wx(function(t){var n,r=_p(t),o=hx(t),a=(n=t.ownerDocument)==null?void 0:n.body,c=lm(r.scrollWidth,r.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),d=lm(r.scrollHeight,r.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),p=-o.scrollLeft+dx(t),m=-o.scrollTop;return nd(a||r).direction==="rtl"&&(p+=lm(r.clientWidth,a?a.clientWidth:0)-c),{width:c,height:d,x:p,y:m}}(_p(s)))}function xC(s){return Object.assign({},{top:0,right:0,bottom:0,left:0},s)}function EC(s,e){return e.reduce(function(t,n){return t[n]=s,t},{})}function fv(s,e){e===void 0&&(e={});var t=e,n=t.placement,r=n===void 0?s.placement:n,o=t.boundary,a=o===void 0?iC:o,c=t.rootBoundary,d=c===void 0?mx:c,p=t.elementContext,m=p===void 0?dv:p,A=t.altBoundary,x=A!==void 0&&A,E=t.padding,M=E===void 0?0:E,T=xC(typeof M!="number"?M:EC(M,uv)),O=m===dv?rC:dv,P=s.rects.popper,R=s.elements[x?O:m],I=function(ge,de,xe){var pe=de==="clippingParents"?function(We){var ot=f_(pb(We)),ft=["absolute","fixed"].indexOf(nd(We).position)>=0&&ac(We)?m_(We):We;return av(ft)?ot.filter(function(nt){return av(nt)&&bC(nt,ft)&&rh(nt)!=="body"}):[]}(ge):[].concat(de),ye=[].concat(pe,[xe]),Re=ye[0],we=ye.reduce(function(We,ot){var ft=wC(ge,ot);return We.top=lm(ft.top,We.top),We.right=db(ft.right,We.right),We.bottom=db(ft.bottom,We.bottom),We.left=lm(ft.left,We.left),We},wC(ge,Re));return we.width=we.right-we.left,we.height=we.bottom-we.top,we.x=we.left,we.y=we.top,we}(av(R)?R:R.contextElement||_p(s.elements.popper),a,d),j=cv(s.elements.reference),z=vC({reference:j,element:P,strategy:"absolute",placement:r}),V=wx(Object.assign({},P,z)),G=m===dv?V:j,X={top:I.top-G.top+T.top,bottom:G.bottom-I.bottom+T.bottom,left:I.left-G.left+T.left,right:G.right-I.right+T.right},ne=s.modifiersData.offset;if(m===dv&&ne){var ce=ne[r];Object.keys(X).forEach(function(ge){var de=[bl,yl].indexOf(ge)>=0?1:-1,xe=[pa,yl].indexOf(ge)>=0?"y":"x";X[ge]+=ce[xe]*de})}return X}var CC={name:"flip",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name;if(!e.modifiersData[n]._skip){for(var r=t.mainAxis,o=r===void 0||r,a=t.altAxis,c=a===void 0||a,d=t.fallbackPlacements,p=t.padding,m=t.boundary,A=t.rootBoundary,x=t.altBoundary,E=t.flipVariations,M=E===void 0||E,T=t.allowedAutoPlacements,O=e.options.placement,P=sh(O),R=d||(P!==O&&M?function(nt){if(sh(nt)===fb)return[];var Rt=_b(nt);return[yC(nt),Rt,yC(Rt)]}(O):[_b(O)]),I=[O].concat(R).reduce(function(nt,Rt){return nt.concat(sh(Rt)===fb?function(Nt,Ut){Ut===void 0&&(Ut={});var Ht=Ut,yn=Ht.placement,yt=Ht.boundary,Yn=Ht.rootBoundary,ai=Ht.padding,Xn=Ht.flipVariations,Ci=Ht.allowedAutoPlacements,zi=Ci===void 0?vx:Ci,lt=pv(yn),jt=lt?Xn?gx:gx.filter(function(Fi){return pv(Fi)===lt}):uv,zt=jt.filter(function(Fi){return zi.indexOf(Fi)>=0});zt.length===0&&(zt=jt);var Kn=zt.reduce(function(Fi,re){return Fi[re]=fv(Nt,{placement:re,boundary:yt,rootBoundary:Yn,padding:ai})[sh(re)],Fi},{});return Object.keys(Kn).sort(function(Fi,re){return Kn[Fi]-Kn[re]})}(e,{placement:Rt,boundary:m,rootBoundary:A,padding:p,flipVariations:M,allowedAutoPlacements:T}):Rt)},[]),j=e.rects.reference,z=e.rects.popper,V=new Map,G=!0,X=I[0],ne=0;ne<I.length;ne++){var ce=I[ne],ge=sh(ce),de=pv(ce)===cm,xe=[pa,yl].indexOf(ge)>=0,pe=xe?"width":"height",ye=fv(e,{placement:ce,boundary:m,rootBoundary:A,altBoundary:x,padding:p}),Re=xe?de?bl:fa:de?yl:pa;j[pe]>z[pe]&&(Re=_b(Re));var we=_b(Re),We=[];if(o&&We.push(ye[ge]<=0),c&&We.push(ye[Re]<=0,ye[we]<=0),We.every(function(nt){return nt})){X=ce,G=!1;break}V.set(ce,We)}if(G)for(var ot=function(nt){var Rt=I.find(function(Nt){var Ut=V.get(Nt);if(Ut)return Ut.slice(0,nt).every(function(Ht){return Ht})});if(Rt)return X=Rt,"break"},ft=M?3:1;ft>0&&ot(ft)!=="break";ft--);e.placement!==X&&(e.modifiersData[n]._skip=!0,e.placement=X,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function g_(s,e,t){return lm(s,db(e,t))}var SC={name:"preventOverflow",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name,r=t.mainAxis,o=r===void 0||r,a=t.altAxis,c=a!==void 0&&a,d=t.boundary,p=t.rootBoundary,m=t.altBoundary,A=t.padding,x=t.tether,E=x===void 0||x,M=t.tetherOffset,T=M===void 0?0:M,O=fv(e,{boundary:d,rootBoundary:p,padding:A,altBoundary:m}),P=sh(e.placement),R=pv(e.placement),I=!R,j=Ax(P),z=j==="x"?"y":"x",V=e.modifiersData.popperOffsets,G=e.rects.reference,X=e.rects.popper,ne=typeof T=="function"?T(Object.assign({},e.rects,{placement:e.placement})):T,ce=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),ge=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,de={x:0,y:0};if(V){if(o){var xe,pe=j==="y"?pa:fa,ye=j==="y"?yl:bl,Re=j==="y"?"height":"width",we=V[j],We=we+O[pe],ot=we-O[ye],ft=E?-X[Re]/2:0,nt=R===cm?G[Re]:X[Re],Rt=R===cm?-X[Re]:-G[Re],Nt=e.elements.arrow,Ut=E&&Nt?fx(Nt):{width:0,height:0},Ht=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},yn=Ht[pe],yt=Ht[ye],Yn=g_(0,G[Re],Ut[Re]),ai=I?G[Re]/2-ft-Yn-yn-ce.mainAxis:nt-Yn-yn-ce.mainAxis,Xn=I?-G[Re]/2+ft+Yn+yt+ce.mainAxis:Rt+Yn+yt+ce.mainAxis,Ci=e.elements.arrow&&m_(e.elements.arrow),zi=Ci?j==="y"?Ci.clientTop||0:Ci.clientLeft||0:0,lt=(xe=ge==null?void 0:ge[j])!=null?xe:0,jt=we+Xn-lt,zt=g_(E?db(We,we+ai-lt-zi):We,we,E?lm(ot,jt):ot);V[j]=zt,de[j]=zt-we}if(c){var Kn,Fi=j==="x"?pa:fa,re=j==="x"?yl:bl,Pe=V[z],oe=z==="y"?"height":"width",ze=Pe+O[Fi],$e=Pe-O[re],Fe=[pa,fa].indexOf(P)!==-1,at=(Kn=ge==null?void 0:ge[z])!=null?Kn:0,Zt=Fe?ze:Pe-G[oe]-X[oe]-at+ce.altAxis,hn=Fe?Pe+G[oe]+X[oe]-at-ce.altAxis:$e,_n=E&&Fe?function(vn,bn,fn){var dn=g_(vn,bn,fn);return dn>fn?fn:dn}(Zt,Pe,hn):g_(E?Zt:ze,Pe,E?hn:$e);V[z]=_n,de[z]=_n-Pe}e.modifiersData[n]=de}},requiresIfExists:["offset"]},MC={name:"arrow",enabled:!0,phase:"main",fn:function(s){var e,t=s.state,n=s.name,r=s.options,o=t.elements.arrow,a=t.modifiersData.popperOffsets,c=sh(t.placement),d=Ax(c),p=[fa,bl].indexOf(c)>=0?"height":"width";if(o&&a){var m=function(X,ne){return xC(typeof(X=typeof X=="function"?X(Object.assign({},ne.rects,{placement:ne.placement})):X)!="number"?X:EC(X,uv))}(r.padding,t),A=fx(o),x=d==="y"?pa:fa,E=d==="y"?yl:bl,M=t.rects.reference[p]+t.rects.reference[d]-a[d]-t.rects.popper[p],T=a[d]-t.rects.reference[d],O=m_(o),P=O?d==="y"?O.clientHeight||0:O.clientWidth||0:0,R=M/2-T/2,I=m[x],j=P-A[p]-m[E],z=P/2-A[p]/2+R,V=g_(I,z,j),G=d;t.modifiersData[n]=((e={})[G]=V,e.centerOffset=V-z,e)}},effect:function(s){var e=s.state,t=s.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&bC(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function TC(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function IC(s){return[pa,bl,yl,fa].some(function(e){return s[e]>=0})}var DC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(s){var e=s.state,t=s.name,n=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,a=fv(e,{elementContext:"reference"}),c=fv(e,{altBoundary:!0}),d=TC(a,n),p=TC(c,r,o),m=IC(d),A=IC(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:m,hasPopperEscaped:A},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":m,"data-popper-escaped":A})}},PC=mb({defaultModifiers:[_x,yx,bx,vb,AC,CC,SC,MC,DC]}),RC="tippy-content",BC="tippy-arrow",kC="tippy-svg-arrow",um={passive:!0,capture:!0},OC=function(){return document.body};function xx(s,e,t){if(Array.isArray(s)){var n=s[e];return n??(Array.isArray(t)?t[e]:t)}return s}function Ex(s,e){var t={}.toString.call(s);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function LC(s,e){return typeof s=="function"?s.apply(void 0,e):s}function NC(s,e){return e===0?s:function(n){clearTimeout(t),t=setTimeout(function(){s(n)},e)};var t}function mv(s){return[].concat(s)}function UC(s,e){s.indexOf(e)===-1&&s.push(e)}function Ab(s){return[].slice.call(s)}function FC(s){return Object.keys(s).reduce(function(e,t){return s[t]!==void 0&&(e[t]=s[t]),e},{})}function v_(){return document.createElement("div")}function yb(s){return["Element","Fragment"].some(function(e){return Ex(s,e)})}function Cx(s,e){s.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function jC(s,e){s.forEach(function(t){t&&t.setAttribute("data-state",e)})}function Sx(s,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){s[n](r,t)})}function zC(s,e){for(var t=e;t;){var n;if(s.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var oh={isTouch:!1},QC=0;function wT(){oh.isTouch||(oh.isTouch=!0,window.performance&&document.addEventListener("mousemove",VC))}function VC(){var s=performance.now();s-QC<20&&(oh.isTouch=!1,document.removeEventListener("mousemove",VC)),QC=s}function xT(){var s,e=document.activeElement;if((s=e)&&s._tippy&&s._tippy.reference===s){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var ET=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),ou=Object.assign({appendTo:OC,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),CT=Object.keys(ou);function GC(s){var e=(s.plugins||[]).reduce(function(t,n){var r,o=n.name,a=n.defaultValue;return o&&(t[o]=s[o]!==void 0?s[o]:(r=ou[o])!=null?r:a),t},{});return Object.assign({},s,e)}function HC(s,e){var t=Object.assign({},e,{content:LC(e.content,[s])},e.ignoreAttributes?{}:function(n,r){return(r?Object.keys(GC(Object.assign({},ou,{plugins:r}))):CT).reduce(function(o,a){var c=(n.getAttribute("data-tippy-"+a)||"").trim();if(!c)return o;if(a==="content")o[a]=c;else try{o[a]=JSON.parse(c)}catch{o[a]=c}return o},{})}(s,e.plugins));return t.aria=Object.assign({},ou.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}function Mx(s,e){s.innerHTML=e}function WC(s){var e=v_();return s===!0?e.className=BC:(e.className=kC,yb(s)?e.appendChild(s):Mx(e,s)),e}function qC(s,e){yb(e.content)?(Mx(s,""),s.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Mx(s,e.content):s.textContent=e.content)}function Tx(s){var e=s.firstElementChild,t=Ab(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(RC)}),arrow:t.find(function(n){return n.classList.contains(BC)||n.classList.contains(kC)}),backdrop:t.find(function(n){return n.classList.contains("tippy-backdrop")})}}function YC(s){var e=v_(),t=v_();t.className="tippy-box",t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=v_();function r(o,a){var c=Tx(e),d=c.box,p=c.content,m=c.arrow;a.theme?d.setAttribute("data-theme",a.theme):d.removeAttribute("data-theme"),typeof a.animation=="string"?d.setAttribute("data-animation",a.animation):d.removeAttribute("data-animation"),a.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?d.setAttribute("role",a.role):d.removeAttribute("role"),o.content===a.content&&o.allowHTML===a.allowHTML||qC(p,s.props),a.arrow?m?o.arrow!==a.arrow&&(d.removeChild(m),d.appendChild(WC(a.arrow))):d.appendChild(WC(a.arrow)):m&&d.removeChild(m)}return n.className=RC,n.setAttribute("data-state","hidden"),qC(n,s.props),e.appendChild(t),t.appendChild(n),r(s.props,s.props),{popper:e,onUpdate:r}}YC.$$tippy=!0;var ST=1,bb=[],Ix=[];function MT(s,e){var t,n,r,o,a,c,d,p,m=HC(s,Object.assign({},ou,GC(FC(e)))),A=!1,x=!1,E=!1,M=!1,T=[],O=NC(Ci,m.interactiveDebounce),P=ST++,R=(p=m.plugins).filter(function(oe,ze){return p.indexOf(oe)===ze}),I={id:P,reference:s,popper:v_(),popperInstance:null,props:m,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:R,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(r)},setProps:function(oe){if(!I.state.isDestroyed){we("onBeforeUpdate",[I,oe]),ai();var ze=I.props,$e=HC(s,Object.assign({},ze,FC(oe),{ignoreAttributes:!0}));I.props=$e,Yn(),ze.interactiveDebounce!==$e.interactiveDebounce&&(ft(),O=NC(Ci,$e.interactiveDebounce)),ze.triggerTarget&&!$e.triggerTarget?mv(ze.triggerTarget).forEach(function(Fe){Fe.removeAttribute("aria-expanded")}):$e.triggerTarget&&s.removeAttribute("aria-expanded"),ot(),Re(),V&&V(ze,$e),I.popperInstance&&(zt(),Fi().forEach(function(Fe){requestAnimationFrame(Fe._tippy.popperInstance.forceUpdate)})),we("onAfterUpdate",[I,oe])}},setContent:function(oe){I.setProps({content:oe})},show:function(){var oe=I.state.isVisible,ze=I.state.isDestroyed,$e=!I.state.isEnabled,Fe=oh.isTouch&&!I.props.touch,at=xx(I.props.duration,0,ou.duration);if(!(oe||ze||$e||Fe||de().hasAttribute("disabled")||(we("onShow",[I],!1),I.props.onShow(I)===!1))){if(I.state.isVisible=!0,ge()&&(z.style.visibility="visible"),Re(),Ut(),I.state.isMounted||(z.style.transition="none"),ge()){var Zt=pe();Cx([Zt.box,Zt.content],0)}var hn,_n,vn;c=function(){var bn;if(I.state.isVisible&&!M){if(M=!0,z.offsetHeight,z.style.transition=I.props.moveTransition,ge()&&I.props.animation){var fn=pe(),dn=fn.box,Dn=fn.content;Cx([dn,Dn],at),jC([dn,Dn],"visible")}We(),ot(),UC(Ix,I),(bn=I.popperInstance)==null||bn.forceUpdate(),we("onMount",[I]),I.props.animation&&ge()&&function(sn,Bn){yn(sn,function(){I.state.isShown=!0,we("onShown",[I])})}(at)}},_n=I.props.appendTo,vn=de(),(hn=I.props.interactive&&_n===OC||_n==="parent"?vn.parentNode:LC(_n,[vn])).contains(z)||hn.appendChild(z),I.state.isMounted=!0,zt()}},hide:function(){var oe=!I.state.isVisible,ze=I.state.isDestroyed,$e=!I.state.isEnabled,Fe=xx(I.props.duration,1,ou.duration);if(!(oe||ze||$e)&&(we("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,M=!1,A=!1,ge()&&(z.style.visibility="hidden"),ft(),Ht(),Re(!0),ge()){var at=pe(),Zt=at.box,hn=at.content;I.props.animation&&(Cx([Zt,hn],Fe),jC([Zt,hn],"hidden"))}We(),ot(),I.props.animation?ge()&&function(_n,vn){yn(_n,function(){!I.state.isVisible&&z.parentNode&&z.parentNode.contains(z)&&vn()})}(Fe,I.unmount):I.unmount()}},hideWithInteractivity:function(oe){xe().addEventListener("mousemove",O),UC(bb,O),O(oe)},enable:function(){I.state.isEnabled=!0},disable:function(){I.hide(),I.state.isEnabled=!1},unmount:function(){I.state.isVisible&&I.hide(),I.state.isMounted&&(Kn(),Fi().forEach(function(oe){oe._tippy.unmount()}),z.parentNode&&z.parentNode.removeChild(z),Ix=Ix.filter(function(oe){return oe!==I}),I.state.isMounted=!1,we("onHidden",[I]))},destroy:function(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),ai(),delete s._tippy,I.state.isDestroyed=!0,we("onDestroy",[I]))}};if(!m.render)return I;var j=m.render(I),z=j.popper,V=j.onUpdate;z.setAttribute("data-tippy-root",""),z.id="tippy-"+I.id,I.popper=z,s._tippy=I,z._tippy=I;var G=R.map(function(oe){return oe.fn(I)}),X=s.hasAttribute("aria-expanded");return Yn(),ot(),Re(),we("onCreate",[I]),m.showOnCreate&&re(),z.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),z.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&xe().addEventListener("mousemove",O)}),I;function ne(){var oe=I.props.touch;return Array.isArray(oe)?oe:[oe,0]}function ce(){return ne()[0]==="hold"}function ge(){var oe;return!((oe=I.props.render)==null||!oe.$$tippy)}function de(){return d||s}function xe(){var oe,ze,$e=de().parentNode;return $e&&(ze=mv($e)[0])!=null&&(oe=ze.ownerDocument)!=null&&oe.body?ze.ownerDocument:document}function pe(){return Tx(z)}function ye(oe){return I.state.isMounted&&!I.state.isVisible||oh.isTouch||o&&o.type==="focus"?0:xx(I.props.delay,oe?0:1,ou.delay)}function Re(oe){oe===void 0&&(oe=!1),z.style.pointerEvents=I.props.interactive&&!oe?"":"none",z.style.zIndex=""+I.props.zIndex}function we(oe,ze,$e){var Fe;$e===void 0&&($e=!0),G.forEach(function(at){at[oe]&&at[oe].apply(at,ze)}),$e&&(Fe=I.props)[oe].apply(Fe,ze)}function We(){var oe=I.props.aria;if(oe.content){var ze="aria-"+oe.content,$e=z.id;mv(I.props.triggerTarget||s).forEach(function(Fe){var at=Fe.getAttribute(ze);if(I.state.isVisible)Fe.setAttribute(ze,at?at+" "+$e:$e);else{var Zt=at&&at.replace($e,"").trim();Zt?Fe.setAttribute(ze,Zt):Fe.removeAttribute(ze)}})}}function ot(){!X&&I.props.aria.expanded&&mv(I.props.triggerTarget||s).forEach(function(oe){I.props.interactive?oe.setAttribute("aria-expanded",I.state.isVisible&&oe===de()?"true":"false"):oe.removeAttribute("aria-expanded")})}function ft(){xe().removeEventListener("mousemove",O),bb=bb.filter(function(oe){return oe!==O})}function nt(oe){if(!oh.isTouch||!E&&oe.type!=="mousedown"){var ze=oe.composedPath&&oe.composedPath()[0]||oe.target;if(!I.props.interactive||!zC(z,ze)){if(mv(I.props.triggerTarget||s).some(function($e){return zC($e,ze)})){if(oh.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else we("onClickOutside",[I,oe]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),x=!0,setTimeout(function(){x=!1}),I.state.isMounted||Ht())}}}function Rt(){E=!0}function Nt(){E=!1}function Ut(){var oe=xe();oe.addEventListener("mousedown",nt,!0),oe.addEventListener("touchend",nt,um),oe.addEventListener("touchstart",Nt,um),oe.addEventListener("touchmove",Rt,um)}function Ht(){var oe=xe();oe.removeEventListener("mousedown",nt,!0),oe.removeEventListener("touchend",nt,um),oe.removeEventListener("touchstart",Nt,um),oe.removeEventListener("touchmove",Rt,um)}function yn(oe,ze){var $e=pe().box;function Fe(at){at.target===$e&&(Sx($e,"remove",Fe),ze())}if(oe===0)return ze();Sx($e,"remove",a),Sx($e,"add",Fe),a=Fe}function yt(oe,ze,$e){$e===void 0&&($e=!1),mv(I.props.triggerTarget||s).forEach(function(Fe){Fe.addEventListener(oe,ze,$e),T.push({node:Fe,eventType:oe,handler:ze,options:$e})})}function Yn(){var oe;ce()&&(yt("touchstart",Xn,{passive:!0}),yt("touchend",zi,{passive:!0})),(oe=I.props.trigger,oe.split(/\s+/).filter(Boolean)).forEach(function(ze){if(ze!=="manual")switch(yt(ze,Xn),ze){case"mouseenter":yt("mouseleave",zi);break;case"focus":yt(ET?"focusout":"blur",lt);break;case"focusin":yt("focusout",lt)}})}function ai(){T.forEach(function(oe){var ze=oe.node,$e=oe.eventType,Fe=oe.handler,at=oe.options;ze.removeEventListener($e,Fe,at)}),T=[]}function Xn(oe){var ze,$e=!1;if(I.state.isEnabled&&!jt(oe)&&!x){var Fe=((ze=o)==null?void 0:ze.type)==="focus";o=oe,d=oe.currentTarget,ot(),!I.state.isVisible&&Ex(oe,"MouseEvent")&&bb.forEach(function(at){return at(oe)}),oe.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||A)&&I.props.hideOnClick!==!1&&I.state.isVisible?$e=!0:re(oe),oe.type==="click"&&(A=!$e),$e&&!Fe&&Pe(oe)}}function Ci(oe){var ze=oe.target,$e=de().contains(ze)||z.contains(ze);if(oe.type!=="mousemove"||!$e){var Fe=Fi().concat(z).map(function(at){var Zt,hn=(Zt=at._tippy.popperInstance)==null?void 0:Zt.state;return hn?{popperRect:at.getBoundingClientRect(),popperState:hn,props:m}:null}).filter(Boolean);(function(at,Zt){var hn=Zt.clientX,_n=Zt.clientY;return at.every(function(vn){var bn=vn.popperRect,fn=vn.popperState,dn=vn.props.interactiveBorder,Dn=fn.placement.split("-")[0],sn=fn.modifiersData.offset;if(!sn)return!0;var Bn=Dn==="bottom"?sn.top.y:0,Nn=Dn==="top"?sn.bottom.y:0,Wn=Dn==="right"?sn.left.x:0,yr=Dn==="left"?sn.right.x:0,nr=bn.top-_n+Bn>dn,kn=_n-bn.bottom-Nn>dn,Jn=bn.left-hn+Wn>dn,Ai=hn-bn.right-yr>dn;return nr||kn||Jn||Ai})})(Fe,oe)&&(ft(),Pe(oe))}}function zi(oe){jt(oe)||I.props.trigger.indexOf("click")>=0&&A||(I.props.interactive?I.hideWithInteractivity(oe):Pe(oe))}function lt(oe){I.props.trigger.indexOf("focusin")<0&&oe.target!==de()||I.props.interactive&&oe.relatedTarget&&z.contains(oe.relatedTarget)||Pe(oe)}function jt(oe){return!!oh.isTouch&&ce()!==oe.type.indexOf("touch")>=0}function zt(){Kn();var oe=I.props,ze=oe.popperOptions,$e=oe.placement,Fe=oe.offset,at=oe.getReferenceClientRect,Zt=oe.moveTransition,hn=ge()?Tx(z).arrow:null,_n=at?{getBoundingClientRect:at,contextElement:at.contextElement||de()}:s,vn=[{name:"offset",options:{offset:Fe}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Zt}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(bn){var fn=bn.state;if(ge()){var dn=pe().box;["placement","reference-hidden","escaped"].forEach(function(Dn){Dn==="placement"?dn.setAttribute("data-placement",fn.placement):fn.attributes.popper["data-popper-"+Dn]?dn.setAttribute("data-"+Dn,""):dn.removeAttribute("data-"+Dn)}),fn.attributes.popper={}}}}];ge()&&hn&&vn.push({name:"arrow",options:{element:hn,padding:3}}),vn.push.apply(vn,(ze==null?void 0:ze.modifiers)||[]),I.popperInstance=PC(_n,z,Object.assign({},ze,{placement:$e,onFirstUpdate:c,modifiers:vn}))}function Kn(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function Fi(){return Ab(z.querySelectorAll("[data-tippy-root]"))}function re(oe){I.clearDelayTimeouts(),oe&&we("onTrigger",[I,oe]),Ut();var ze=ye(!0),$e=ne(),Fe=$e[0],at=$e[1];oh.isTouch&&Fe==="hold"&&at&&(ze=at),ze?t=setTimeout(function(){I.show()},ze):I.show()}function Pe(oe){if(I.clearDelayTimeouts(),we("onUntrigger",[I,oe]),I.state.isVisible){if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(oe.type)>=0&&A)){var ze=ye(!1);ze?n=setTimeout(function(){I.state.isVisible&&I.hide()},ze):r=requestAnimationFrame(function(){I.hide()})}}else Ht()}}function __(s,e){e===void 0&&(e={});var t=ou.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",wT,um),window.addEventListener("blur",xT);var n,r=Object.assign({},e,{plugins:t}),o=(n=s,yb(n)?[n]:function(a){return Ex(a,"NodeList")}(n)?Ab(n):Array.isArray(n)?n:Ab(document.querySelectorAll(n))).reduce(function(a,c){var d=c&&MT(c,r);return d&&a.push(d),a},[]);return yb(s)?o[0]:o}__.defaultProps=ou,__.setDefaultProps=function(s){Object.keys(s).forEach(function(e){ou[e]=s[e]})},__.currentInput=oh,Object.assign({},vb,{effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),__.setDefaultProps({render:YC});var Dx=__;class hm extends hb{async _refreshUi(){var e;if(!await super._refreshUi())return!1;ru.RemoveAll(hm.PluginType);for(const t of this.variations)ru.Create(hm.PluginType,t.title,5,20,0,t.materials.map(n=>{let r;if(t.preview.startsWith("generate:"))r=this._previewGenerator.generate(n,t.preview.split(":")[1]);else{const o=n[t.preview]||"#ff00ff";r=o.image?gc(o.image,100):void 0,r||(r=$E(o,!0))}return{id:n.uuid,image:r,onClick:o=>this.applyVariation(t,o),tooltip:n.name||n.uuid}}),(n,r)=>Dx(n,{placement:"bottom",content:r.tooltip}));return ru.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}hm.PluginType="MaterialConfiguratorPlugin";class wb extends Zn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))},this.dependencies=[ln],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new lx(this._viewer),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(n=this._picking)===null||n===void 0||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}wb.PluginType="MaterialLibraryBasePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([gn("Enabled")],wb.prototype,"enabled",void 0);class Ap extends wb{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:gs(),children:[...Dl(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(ln).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(t=>({label:t.name||t.uuid,value:t.uuid}))||[]]],getValue:()=>{var t;return(t=this._selectedMaterial())===null||t===void 0?void 0:t.uuid},setValue:t=>{var n,r,o,a,c;const d=(o=(r=(n=this._viewer)===null||n===void 0?void 0:n.getPlugin(ln))===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(t);if(d)if(this.replaceMaterial)(c=(a=this._selectedObject())===null||a===void 0?void 0:a.setMaterial)===null||c===void 0||c.call(a,d);else{const p=this._selectedMaterial();if(p){const m=p.name,A=p.uuid;p.copyProps(d),p.name=m,p.uuid=A,p.userData.uuid&&(p.userData.uuid=A)}}this._refreshUi()}}}]}}async _refreshUi(){var e,t,n,r;if(!await super._refreshUi())return!1;const o=[vs.TypeSlug,er.TypeSlug],a=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ln))===null||t===void 0?void 0:t.materials,c=o.map(d=>[d,a==null?void 0:a.getMaterialsOfType(d)]);ru.RemoveAll(Ap.PluginType);for(const[d,p]of c)ru.Create(Ap.PluginType,d,5,20,0,(n=p)===null||n===void 0?void 0:n.filter(m=>!m.userData.__runtimeMaterial).map(m=>{let A;const x="generate:sphere";if(x.startsWith("generate:"))A=this._previewGenerator.generate(m,x.split(":")[1]);else{const E=m[x]||"#ff00ff";A=E.image?gc(E.image,100):void 0,A||(A=ZE(E,!0))}return{id:m.uuid,image:A,onClick:E=>{const M=a==null?void 0:a.findMaterial(E);if(console.log(M==null?void 0:M.name),M){const T=M.userData.__appliedMeshes;if(T!=null&&T.size){const O=T.keys().next().value;O.dispatchEvent({type:"select",value:O})}}},tooltip:m.name||m.uuid}}),(m,A)=>Dx(m,{placement:"bottom",content:A.tooltip}));return ru.RebuildUi((r=this._viewer)===null||r===void 0?void 0:r.container),!0}}function XC(s,e,t,n){s.traverse(r=>{r&&(r.userData.cloneRotI=e,r.userData.rotationCount=t,r.userData.rotationAxis=n,r.addEventListener("beforeRender",o=>function(a,c){var d;c&&(!((d=c.map)===null||d===void 0)&&d.isTexture)&&(c.extraUniformsToUpload||(c.extraUniformsToUpload={}),c.extraUniformsToUpload.uvTransform||(c.extraUniformsToUpload.uvTransform={value:new f.Vkp}),c.extraUniformsToUpload.uvTransform.value.setUvTransform(c.map.offset.x*c.map.repeat.x*a.userData.cloneRotI/(a.userData.rotationCount||1),c.map.offset.y*c.map.repeat.y*a.userData.cloneRotI/(a.userData.rotationCount||1),c.map.repeat.x,c.map.repeat.y,c.map.rotation,c.map.center.x,c.map.center.y))}(r,o.material)))})}function KC(s,e,t,n="x"){var r;if(s.userData.rotationCount>1&&!s.userData.rotationRoot)return s;const o=s.parent;if(!o)throw new Error("No parent");if(s.userData.cloneParent){const c=s.userData.cloneParent;if(!(s=o.children.find(d=>c===d.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",c,o),s}let a=o.children.filter(c=>{var d;return((d=c.userData)===null||d===void 0?void 0:d.cloneParent)===s.uuid}).sort((c,d)=>c.userData.cloneRotI-d.userData.cloneRotI);if(s.userData.rotationCount===e&&e===a.length&&t===void 0&&s.userData.rotationAxis===n)return s;if(t==null&&(t=(r=s.userData.rotationSkips)!==null&&r!==void 0?r:[]),t!==s.userData.rotationSkips&&(s.userData.rotationSkips=[...t]),XC(s,0,e,n),s.userData.rotationRoot=!0,s.visible=!0,e<=a.length){for(let c=e-1;c<a.length;c++)o.remove(a[c]),a[c].traverse(d=>d.userData={__disposed:!0});a=a.slice(0,e)}for(let c=1;c<e;c++){const d=c<=a.length?a[c-1]:s.clone();d.rotation.copy(s.rotation),d.rotation[n]+=c/e*Math.PI*2,XC(d,c,e,n),c>a.length&&o.add(d),d.visible=!t.includes(c)}return s.visible=!t.includes(0),s}Ap.PluginType="MaterialLibraryPlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([gn("Replace Material")],Ap.prototype,"replaceMaterial",void 0);var gv,A_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ah=gv=class extends Zn{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var s,e,t,n,r,o,a,c,d;if(!this.enabled)return;const p=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!p)return void((n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0));const m=p.userData.rotationRoot&&(r=p.userData.rotationCount)!==null&&r!==void 0?r:1;this.rotations=m,this.skips=(a=(o=p.userData.rotationSkips)===null||o===void 0?void 0:o.join(","))!==null&&a!==void 0?a:"",this.axis=p.userData.rotationAxis||"x",(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}_paramsChanged(){var s,e,t,n,r,o;if(!this.enabled)return;const a=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(a){if(this.rotations>1||a.userData.rotationCount){const c=a.userData.rotationCount,d=KC(a,this.rotations,this.skips.split(",").map(m=>parseInt(m)).filter(m=>isFinite(m)),this.axis),p=d==null?void 0:d.userData.rotationCount;if(p&&p!==c){const m=[];d==null||d.traverseAncestors(A=>{m.push(A)});for(const A of m)if(A.userData.autoScaled){ni(A),(t=this._viewer)===null||t===void 0||t.resetCamera({rootObject:A,centerOffset:new f.Pa4(4,4,4)});break}}a.parent&&!a.userData.__disposed||(r=(n=this._viewer)===null||n===void 0?void 0:n.getPluginByType("Picking"))===null||r===void 0||r.setSelectedObject(d,!0)}(o=this._viewer)===null||o===void 0||o.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ah.PluginType="ObjectRotationPlugin",A_([Ne(),gn("Enabled"),ve(gv.prototype._paramsChanged)],ah.prototype,"enabled",void 0),A_([An("Rotation Count",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),ve(gv.prototype._paramsChanged)],ah.prototype,"rotations",void 0),A_([Il("Axis",["x","y","z"].map(s=>({label:s})),s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),ve(gv.prototype._paramsChanged)],ah.prototype,"axis",void 0),A_([li("Rotation Skips",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),ve(gv.prototype._paramsChanged)],ah.prototype,"skips",void 0),ah=gv=A_([ci("Object Rotations")],ah);var dm,vv=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let au=dm=class extends Zn{constructor(s=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const r of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${r}>`,f.WdD[r].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",f.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)===null||t===void 0?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{for(const[r,o]of Object.entries(this._defines)){const a=typeof o=="number"?o:o?1:0;t.defines[r]!==a&&(t.defines[r]=a,t.needsUpdate=!0)}}},this.dependencies=[ln],this.enabled=s,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var s,e,t;(e=(s=this._bumpMapExtension)===null||s===void 0?void 0:s.setDirty)===null||e===void 0||e.call(s),(t=this._viewer)===null||t===void 0||t.setDirty()}async onAdded(s){var e,t;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(s)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(ln))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(s)}};au.PluginType="ReliefParallaxMapping",vv([ve(dm.prototype._updateExtension),gn("Enabled")],au.prototype,"enabled",void 0),vv([ve(dm.prototype._updateExtension),gn("Debug Normals")],au.prototype,"debugNormals",void 0),vv([ve(dm.prototype._updateExtension),gn("Debug Hit Height")],au.prototype,"debugHitHeight",void 0),vv([Le("PARALLAX_MAP_STEPS",void 0,!0,dm.prototype._updateExtension),An("Step count",[1,32],1),Ne()],au.prototype,"stepCount",void 0),vv([Le("PARALLAX_MAP_B_STEPS",void 0,!0,dm.prototype._updateExtension),An("Binary search steps",[1,8],1),Ne()],au.prototype,"binaryStepCount",void 0),au=dm=vv([ci("Parallax Mapping")],au);var lc=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class wl extends Vr{constructor(e,t,n,r=!1){super({vertexShader:al,fragmentShader:`

${Um}
${qp}
${ll}
${Xv}
${n}

${Fm}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!r},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new f.yGw},screenSize:{value:new f.FM8},cameraPositionWorld:{value:new f.Pa4},cameraNearFar:{value:new f.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:r?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(o,a,c)=>{if(!o.defines.SSRTAO_ENABLED)return;const d="vec3 totalDiffuse =";o.fragmentShader=o.fragmentShader.replace(d,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${d}`),o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",""),o.vertexUvs=!0},onObjectRender:(o,a,c)=>{var d,p,m;this.materialExtension.extraUniforms.tSSGIMap.value=(d=this._target)===null||d===void 0?void 0:d.texture;const A=a.materialObject,x=!A.transparent&&A.transmission<.001;let E=this.enabled&&x&&(this.renderWithCamera||this._renderer.frameCount>1)&&c.userData.screenSpaceRendering!==!1&&!(!((p=A.userData)===null||p===void 0)&&p.ssrtaoDisabled)&&!(!((m=A.userData)===null||m===void 0)&&m.ssaoDisabled)?1:0;A.defines.SSRTAO_ENABLED!==E&&(A.defines.SSRTAO_ENABLED=E,A.needsUpdate=!0),E=this.material.defines.SSGI_ENABLED,A.defines.SSGI_ENABLED!==E&&(A.defines.SSGI_ENABLED=E,A.needsUpdate=!0),E=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==E&&(this.materialExtension.extraUniforms.tSSGIMap.value=E,A.needsUpdate=!0)},parsFragmentSnippet:o=>{var a;return K`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${pt("tSSGIMap",(a=this._target)===null||a===void 0?void 0:a.texture,o.capabilities.isWebGL2)}

            ${jm}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:o=>{var a,c;return this.enabled?"1":"0"+((c=(a=this._target)===null||a===void 0?void 0:a.texture)===null||c===void 0?void 0:c.encoding)},isCompatible:o=>{var a;return!(!((a=o.materialObject.userData)===null||a===void 0)&&a.ssaoDisabled)&&o.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Dl(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=r,this.ssgiEnabled=r,this.bilateralPass=new Qm(this._target,n,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,t,n,r,o){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,o),this.smoothEnabled&&this.bilateralPass.render(e,t,n,r,o))}}lc([Ne()],wl.prototype,"bilateralPass",void 0),lc([An("Intensity",[0,4]),Ne(),ae()],wl.prototype,"intensity",void 0),lc([An("Power",[0,3]),Ne(),ae()],wl.prototype,"power",void 0),lc([gn("Auto radius"),Ne(),ae()],wl.prototype,"autoRadius",void 0),lc([An("Object Radius",[.01,10]),Ne(),ae()],wl.prototype,"objectRadius",void 0),lc([An("Tolerance",[.1,5]),Ne(),ae()],wl.prototype,"tolerance",void 0),lc([An("Bias",[-.3,.3]),Ne(),ae()],wl.prototype,"bias",void 0),lc([An("Falloff",[1e-4,4]),Ne(),ae()],wl.prototype,"falloff",void 0),lc([An("Ray Count",[1,5],1),Ne(),ae()],wl.prototype,"rayCount",void 0),lc([An("Step count",[1,16],1),Ne(),Le("RTAO_STEP_COUNT")],wl.prototype,"stepCount",void 0),lc([gn("Smooth Enabled"),Ne()],wl.prototype,"smoothEnabled",void 0),lc([gn("Render with Camera")],wl.prototype,"renderWithCamera",void 0);class xb extends Wp{constructor(e=!0){super(),this.dependencies=[ln,qi,ks],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssrtgi)===null||t===void 0)&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n,r;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let o=!1;return(t=this._viewer)===null||t===void 0||t.getPluginByType("debug"),[Fd(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new wl(e.renderer,this._rtgiTarget,(r=(n=e.getPlugin(qi))===null||n===void 0?void 0:n.getUnpackSnippet())!==null&&r!==void 0?r:"",!0),update:()=>{var a;let c=this.enabled;if(c&&!o){const d=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSAO");d!=null&&d.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?d.enabled=!1:(this.enabled=!1,c=!1))}o=c,c&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(qi)])}},()=>[e.getPlugin(qi),e.getPlugin(ks),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(c=>ke(c)))===null||o===void 0||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),a}}xb.PluginType="SSGI";class yp extends Zn{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[ln],this.variations=[],this._selectedSwitchNode=()=>{var e;const t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;const n=this.variations.map(o=>o.name);let r;return t.traverseAncestors(o=>{r||n.includes(o.name)&&(r=o)}),r},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",()=>{var r,o;(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);if(!o||o.children.length<1)return;r.selected||(r.selected=o.children[0].name||o.children[0].uuid);for(const a of o.children)a.visible=(a.name||a.uuid)===r.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);if(!o||o.children.length<1)return;for(const a of o.children)a.visible=!0}}),this.addEventListener("deserialize",async()=>{await Ir(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t,n;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,ru.RemoveAll(yp.PluginType);for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);o?(o.children.length<1&&console.warn("SwitchNode does not have enough children",r),ru.Create(yp.PluginType,r.title,Math.min(5,o.children.length),20,0,o.children.map(a=>{const c=r.camView,d=new f.Pa4((c.includes("right")?1:0)-(c.includes("left")?1:0),(c.includes("top")?1:0)-(c.includes("bottom")?1:0),(c.includes("front")?1:0)-(c.includes("back")?1:0));r.camDistance||(r.camDistance=1);const p=ax(this._viewer,a,void 0,7,d.multiplyScalar(.5*r.camDistance));return{id:a.uuid,image:p,onClick:()=>{var m;r.selected=a.name||a.uuid,(m=this._viewer)===null||m===void 0||m.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:a.name||a.uuid}}),(a,c)=>Dx(a,{placement:"bottom",content:c.tooltip}))):console.warn("no object found for variation, skipping",r)}ru.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t)}}}yp.PluginType="SwitchNodePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([Ne()],yp.prototype,"variations",void 0);class Px extends f.u9r{constructor(e,t,n=32,r=64,o=!1,a=new f.FM8(1,1),c="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:r,closed:o,primary:c,shapeScale:a.clone()};const d=t.computeFrenetFrames(r,o);this.frames=d;const p=new f.Pa4,m=new f.Pa4,A=new f.Pa4,x=new f.FM8;let E=new f.Pa4;const M=[],T=[],O=[],P=e.getSpacedPoints(n);for(const j of P)j.multiply(a);(function(){for(let j=0;j<r;j++)I(j);I(o===!1?r:0),function(){for(let j=0;j<=r;j++)for(let z=0;z<=n;z++)x.x=j/r,x.y=z/n,T.push(x.x,x.y)}(),function(){const j=c==="shape",z=j?n:r,V=j?r:n;for(let G=1;G<=z;G++)for(let X=1;X<=V;X++){const[ne,ce]=j?[X,G]:[G,X],ge=(n+1)*(ne-1)+(ce-1),de=(n+1)*ne+(ce-1),xe=(n+1)*ne+ce,pe=(n+1)*(ne-1)+ce;O.push(ge,de,pe),O.push(de,xe,pe)}}()})(),this.setIndex(O),this.setAttribute("position",new f.a$l(M,3)),this.setAttribute("uv",new f.a$l(T,2)),this.computeVertexNormals();const R=this.attributes.normal;function I(j){E=t.getPointAt(j/r,E);const z=d.normals[j],V=d.binormals[j];for(let G=0;G<=n;G++){const X=P[G%n];m.set(0,0,0).addScaledVector(z,X.x).addScaledVector(V,X.y),p.copy(E).add(m),M.push(p.x,p.y,p.z)}}(function(){for(let z=1;z<n;z++){const V=z+r*(n+1);m.fromBufferAttribute(R,z),A.fromBufferAttribute(R,V),m.add(A).normalize(),R.setXYZ(z,m.x,m.y,m.z),R.setXYZ(V,m.x,m.y,m.z)}for(let z=1;z<r;z++){const V=z*(n+1),G=V+n;m.fromBufferAttribute(R,V),A.fromBufferAttribute(R,G),m.add(A).normalize(),R.setXYZ(V,m.x,m.y,m.z),R.setXYZ(G,m.x,m.y,m.z)}m.fromBufferAttribute(R,0),A.fromBufferAttribute(R,n),m.add(A);const j=r*(n+1);A.fromBufferAttribute(R,j),m.add(A),A.fromBufferAttribute(R,j+n),m.add(A),m.normalize(),R.setXYZ(0,m.x,m.y,m.z),R.setXYZ(n,m.x,m.y,m.z),R.setXYZ(j,m.x,m.y,m.z),R.setXYZ(j+n,m.x,m.y,m.z),R.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,r=[...e,1].sort();let o=0,a=0;for(const c of r){const d=Math.round(t*c)*n/t;this.addGroup(o,d-o,a++),o=d}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var Rx,bp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let xl=Rx=class extends Zn{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new f.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var s,e;const t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Ii))===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;let n=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!n)return;n=parseFloat(n);const r=new Bx(0,0,n,n,0,2*Math.PI,!0,0);await this.extrudeObject(t,r)}}async onAdded(s){await super.onAdded(s)}static CreateCurve(s,e){var t,n;if(s==="circle")return new Bx(0,0,(t=e.radius)!==null&&t!==void 0?t:1,(n=e.radius)!==null&&n!==void 0?n:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(s,e,t=this.shapeSegments,n=this.tubularSegments,r=this.shapeScale,o=this.materialSplits.split(",").map(c=>parseFloat(c.trim())),a=this.horizontalSplits){var c,d,p,m,A,x,E,M;if(s.userData.isExtrudedTube,s.userData._extrudeSource){const j=s.userData._extrudeSource;if(s=(c=s.parent)===null||c===void 0?void 0:c.children.find(z=>j===z.uuid),!s)return void console.warn("Could not find extrude source with uuid",j)}if(s.userData.extrudedObject){const j=s.userData.extrudedObject,z=(d=s.parent)===null||d===void 0?void 0:d.children.find(V=>j===V.uuid);z&&(z.removeFromParent(),z.geometry.dispose(),z.geometry=null,z.material=null),delete s.userData.extrudedObject}const T=s.geometry;if(!T)return void((p=this._viewer)===null||p===void 0||p.alert("Extrude: No geometry to extrude"));const O=[s.material];let P;try{const j=Rx.ConvertGeometryToFlatShape(T);P=new Px(j,e,t,n,!0,r,a?"shape":"path"),P.computeBoundingBox(),P.createSplits(o)}catch(j){return void((m=this._viewer)===null||m===void 0||m.alert(typeof j=="string"?j:j==null?void 0:j.message))}O[0].color.set(16777215);for(let j=O.length;j<P.groups.length;j++){const z=O[0].clone();O.push(z),z.color.set(16777215*Math.random())}const R=new f.Kj0(P,O);R.userData._extrudeSource=s.uuid,R.userData.isExtrudedTube=!0,s.visible=!1,s.userData.bboxVisible=!1,R.name=s.name+"_extruded";const I=await((E=(x=(A=this._viewer)===null||A===void 0?void 0:A.getManager())===null||x===void 0?void 0:x.importer)===null||E===void 0?void 0:E.processImportedSingle(R,{autoCenter:!1,autoScale:!1}));I&&((M=s.parent)===null||M===void 0||M.add(I.modelObject),s.userData.extrudedObject=I.modelObject.uuid,I.dispatchEvent({type:"select",ui:!0,value:I}))}static ExtrudeShape(s,e,t,n,r,o,a,c){const d=new Px(s,n,e,t,!0,new f.FM8(r,o),c?"shape":"path");d.computeBoundingBox(),d.createSplits(a);const p=new f.Kj0(d,[]);return p.userData.isExtrudedTube=!0,p}static ConvertGeometryToFlatShape(s,e=!0){if(s.userData.__planarShape)return s.userData.__planarShape;let t=s.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=s;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const r=n.boundingBox.getSize(new f.Pa4),o=r.x<.001?"x":r.y<.001?"y":r.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let d=0;d<t.count;d++){const p=new f.FM8;o==="x"?p.set(t.getY(d),t.getZ(d)):o==="y"?p.set(t.getX(d),t.getZ(d)):p.set(t.getX(d),t.getY(d)),a.push(p)}if(e){let d=0;for(let p=0;p<a.length;p++)(a[p].x<a[d].x||a[p].x===a[d].x&&a[p].y<a[d].y)&&(d=p);d!==0&&(a=a.slice(d).concat(a.slice(0,d)))}const c=new f.bnF(a);return s.userData.__planarShape=c,c}};xl.PluginType="ShapeTubeExtrudePlugin",bp([gn("Enabled")],xl.prototype,"enabled",void 0),bp([An("Shape Segments (X)",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"shapeSegments",void 0),bp([An("Tube Segments (Y)",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"tubularSegments",void 0),bp([Ko("Shape scale",[.01,10],.01,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"shapeScale",void 0),bp([li("Material Splits",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"materialSplits",void 0),bp([gn("Horizontal Splits",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"horizontalSplits",void 0),bp([Si("Extrude Circle Tube",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0)&&t.getSelectedObject())}}))],xl.prototype,"extrudeCirceTube",void 0),xl=Rx=bp([ci("Extrude Tube Shapes")],xl);class Bx extends f.Ny0{getPoint(e,t){return super.getPoint(e,t||new f.Pa4)}}class y_ extends Zn{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var t,n;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))===null||t===void 0||t.enable(y_.PluginType),this._fadeDisabled=!1));const r=ui()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/60);let o=r-this._lastFrameTime;this._lastFrameTime=r;const a=(n=this._viewer.getPluginByType("Progressive"))===null||n===void 0?void 0:n.postFrameConvergedRecordingDelta();if(a&&a>0&&(o=a),a!==0&&(o*=1e3,!(o<=.001)&&(this._updaters.forEach(c=>{let d=o;c.time+d<0&&(d=-c.time),c.time+=d,Math.abs(d)>.001&&c.u(d)}),!this._fadeDisabled&&this.disableFrameFade))){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(y_.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=gs(),n={id:t,options:e,stop:()=>{var r,o,a;!((r=this.animations[t])===null||r===void 0)&&r._stop?(a=(o=this.animations[t])===null||o===void 0?void 0:o._stop)===null||a===void 0||a.call(o):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((r,o)=>{const a={driver:this.defaultDriver,onComplete:()=>{var d;(d=e.onComplete)===null||d===void 0||d.call(e),r()},onStop:()=>{var d;(d=e.onStop)===null||d===void 0||d.call(e),r()},...e},c=Xd(a);this.animations[t]._stop=c.stop,this.animations[t].options=a}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}y_.PluginType="PopmotionPlugin";const TT=async s=>Nr(await(await fetch(s)).blob());async function JC(s,e=TT){const t=s.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(t)for(const n of t){const r=await e(n);s=s.replace(n,r)}return s}function kx(s,e,{width:t,height:n},r=!0){const o=`
<svg viewBox="0 0 ${t} ${n}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${s}
        </div>
    </foreignObject>
</svg>
    `;return r?Oe(o):o}async function IT(s,e,t){const n=kx(s,e,t);return await cx(n,t)}async function DT(s,e,t){const n=kx(s,e,t);return await eC(n,t)}var Ox,lu,jr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ma=s=>({onChange:e=>{e.last&&s.onChange()}});let Fs=Ox=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(s){Object.assign(this,s)}reset(){const s=this.onChange;Object.assign(this,new Ox),this.onChange=s}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};jr([li("Text",ma)],Fs.prototype,"text",void 0),jr([An("Font Size",[2,400],1,ma)],Fs.prototype,"fontSize",void 0),jr([An("Width",[2,4096],1,ma)],Fs.prototype,"width",void 0),jr([An("Height",[2,4096],1,ma)],Fs.prototype,"height",void 0),jr([An("X Offset",[-1024,1024],1,ma)],Fs.prototype,"xOffset",void 0),jr([An("Y Offset",[-1024,1024],1,ma)],Fs.prototype,"yOffset",void 0),jr([An("V-Width",[2,4096],1,ma)],Fs.prototype,"boxWidth",void 0),jr([An("V-Height",[2,4096],1,ma)],Fs.prototype,"boxHeight",void 0),jr([li("Font",ma)],Fs.prototype,"fontFamily",void 0),jr([li("Font Url",ma)],Fs.prototype,"fontPath",void 0),jr([gn("Mask Text",ma)],Fs.prototype,"maskText",void 0),jr([gn("Inner Shadow",ma)],Fs.prototype,"innerShadow",void 0),jr([Ya("Text Color",ma)],Fs.prototype,"textColor",void 0),jr([Ya("BG Fill",ma)],Fs.prototype,"bgFillColor",void 0),jr([Ya("SVG BG",ma)],Fs.prototype,"svgBackground",void 0),Fs=Ox=jr([ci("Text SVG Options")],Fs);const ZC={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},b_=s=>({hidden:()=>{const e=s.getSelected();return!e||!e.userData[El.PluginType]}});let El=lu=class extends Zn{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var s,e;return(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new Fs,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var s,e,t,n,r,o;if(!this.enabled)return;const a=this.getSelected();if(!a)return void((e=(s=this.uiConfig).uiRefresh)===null||e===void 0||e.call(s,"postFrame",!0));const c=a.userData[lu.PluginType];if(!c)return this.options.reset(),this._lastMeta=void 0,void((n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0));this._lastMeta!==c&&(this.options.set(c),this._lastMeta=c),(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const s=this.getSelected();s&&s.isMesh&&s.userData[lu.PluginType]&&this.updateText(s,this.options.toJSON())}async addTextToSelected(){var s;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[lu.PluginType]||!e.material.map||await((s=this._viewer)===null||s===void 0?void 0:s.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(s,e){return this.updateText(s,Object.assign(this.options.toJSON(),e))}async updateText(s,e){var t,n;if(!s.isMesh)return;if(!s.material)return void console.error("updateText: no material on mesh");let r=s.userData[lu.PluginType];r||(s.userData[lu.PluginType]=r={}),Object.assign(r,e);const o=s.material;o.map&&(o.map._isSimpleTextTexture&&o.map.dispose(),o.map=void 0),o.alphaMap&&(o.alphaMap._isSimpleTextTexture&&o.alphaMap.dispose(),o.alphaMap=void 0),o.bumpMap&&(o.bumpMap._isSimpleTextTexture&&o.bumpMap.dispose(),o.bumpMap=void 0);const a=await this.makeTextSvg(r);this.applyToMap&&(o.map=a),this.applyToAlphaMap&&(o.alphaMap=a,o.transparent=!0),this.applyToBumpMap&&(o.bumpMap=a),o.userData.inverseAlphaMap=this.inverseAlphaMap,o.setDirty(),o.needsUpdate=!0,(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}async makeTextSvg(s){const e=s.fontFamily||"Arial",t=s.fontPath||this.fonts[e]||"";let n=s.style;if(t.length>0){const a=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${ZC[a]||a});
            }`:"")}let r=function({text:a="Custom Text",svgBackground:c="#ffffff",xOffset:d=0,yOffset:p=0,width:m=1024,height:A=1024,boxWidth:x=1024,boxHeight:E=1024,fontFamily:M="",fontSize:T=32,maskText:O=!0,innerShadow:P=!0,bgFillColor:R="#000000",textColor:I="#ffffff",style:j=""}){return`
<svg style="background-color:${c}" width="${m}" height="${A}" viewBox="0 0 ${x} ${E}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${j}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${T}px; font-family: ${M||"Arial"}">
        <defs>

`+(O?`
<mask id="textMask">
<text style="fill:white; font-size: ${T}px;" x="${d+x/2}" y="${E/2+p+T/4}" > ${a} </text>
</mask>
`:"")+`

`+(P?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(O?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${x}" height="${E}" style="fill:${R}"/>
        <text style="${P?"filter: url(#innerShadow);":""} fill:${I};" x="${d+x/2}" y="${E/2+p+T/4}"> ${a} </text>

`+(O?`
        </g>
`:"")+`

    </g>
</svg>
`}({...s,fontFamily:e,style:n});r=await JC(r,async a=>this._getAssetData(a)),r=Oe(r);const o=await this._viewer.getManager().importer.importSinglePath(r,{generateMipmaps:!1,minFilter:f.wem});return o._isSimpleTextTexture=!0,o.flipY=!1,o.needsUpdate=!0,o}async _getAssetData(s){var e,t;if(s.startsWith("http://www.w3.org"))return s;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||t===void 0?void 0:t.importer;if(!n)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new Yi(n.loadingManager),processImported:!1};try{return await n.importPath(s,this._assetLoadOptions)}catch(r){return console.error(r),""}}};El.PluginType="SimpleTextPlugin",jr([Kr(void 0,{params:b_})],El.prototype,"options",void 0),jr([gn("Apply Map",b_),ve(lu.prototype._paramsChanged)],El.prototype,"applyToMap",void 0),jr([gn("Apply Bump Map",b_),ve(lu.prototype._paramsChanged)],El.prototype,"applyToBumpMap",void 0),jr([gn("Apply Alpha Map",b_),ve(lu.prototype._paramsChanged)],El.prototype,"applyToAlphaMap",void 0),jr([gn("Invert Alpha Map",b_),ve(lu.prototype._paramsChanged)],El.prototype,"inverseAlphaMap",void 0),jr([Si("Add Text",s=>({hidden:()=>!s.getSelected()}))],El.prototype,"addTextToSelected",null),El=lu=jr([ci("Simple Text")],El);class Lx{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class PT{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class lh{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new lh;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new lh),this.front.build(t)),n.length&&(this.back||(this.back=new lh),this.back.build(n))}}class Ga{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Ga(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new Ga().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,r=t.y,o=t.z,a=e.x,c=e.y,d=e.z;return this.x=r*d-o*c,this.y=o*a-n*d,this.z=n*c-r*a,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new f.Pa4(this.x,this.y,this.z)}}class pm{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new pm(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,r,o){let a=0;const c=[];for(let d=0;d<e.vertices.length;d++){const p=this.normal.dot(e.vertices[d].pos)-this.w,m=p<-pm.EPSILON?2:p>pm.EPSILON?1:0;a|=m,c.push(m)}switch(a){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:r.push(e);break;case 2:o.push(e);break;case 3:{const d=[],p=[];for(let m=0;m<e.vertices.length;m++){const A=(m+1)%e.vertices.length,x=c[m],E=c[A],M=e.vertices[m],T=e.vertices[A];if(x!=2&&d.push(M),x!=1&&p.push(x!=2?M.clone():M),(x|E)==3){const O=(this.w-this.normal.dot(M.pos))/this.normal.dot(new Ga().copy(T.pos).sub(M.pos)),P=M.interpolate(T,O);d.push(P),p.push(P.clone())}}d.length>=3&&r.push(new _v(d,e.shared)),p.length>=3&&o.push(new _v(p,e.shared));break}}}static fromPoints(e,t,n){const r=new Ga().copy(t).sub(e).cross(new Ga().copy(n).sub(e)).normalize();return new pm(r.clone(),r.dot(e))}}pm.EPSILON=1e-5;class _v{constructor(e,t){this.vertices=e,this.shared=t,this.plane=pm.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new _v(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Eb{constructor(e,t,n,r){this.pos=new Ga().copy(e),this.normal=new Ga().copy(t),this.uv=new Ga().copy(n),this.uv.z=0,r&&(this.color=new Ga().copy(r))}clone(){return new Eb(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Eb(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class Xr{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new Xr;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const r=e.attributes.position,o=e.attributes.normal,a=e.attributes.uv,c=e.attributes.color,d=e.groups;let p;if(e.index)p=e.index.array;else{p=new Array(r.array.length/r.itemSize|0);for(let A=0;A<p.length;A++)p[A]=A}const m=p.length/3|0;n=new Array(m);for(let A=0,x=0,E=p.length;A<E;A+=3,x++){const M=new Array(3);for(let T=0;T<3;T++){const O=p[A+T],P=3*O,R=2*O,I=r.array[P],j=r.array[P+1],z=r.array[P+2],V=o.array[P],G=o.array[P+1],X=o.array[P+2],ne=a==null?void 0:a.array[R],ce=a==null?void 0:a.array[R+1];M[T]=new Eb(new Ga(I,j,z),new Ga(V,G,X),new Ga(ne,ce,0),c&&new Ga(c.array[R],c.array[R+1],c.array[R+2]))}if(t===void 0&&d&&d.length>0)for(const T of d)A>=T.start&&A<T.start+T.count&&(n[x]=new _v(M,T.materialIndex));else n[x]=new _v(M,t)}return Xr.fromPolygons(n.filter(A=>!isNaN(A.plane.normal.x)))}static toGeometry(e,t){let n=0;const r=e.polygons;for(const E of r)n+=E.vertices.length-2;const o=new f.u9r,a=new Lx(3*n*3),c=new Lx(3*n*3),d=new PT(2*n*3);let p;const m=[],A=[];for(const E of r){const M=E.vertices,T=M.length;E.shared!==void 0&&(m[E.shared]||(m[E.shared]=[])),T&&M[0].color!==void 0&&(p||(p=new Lx(3*n*3)));for(let O=3;O<=T;O++)(E.shared===void 0?A:m[E.shared]).push(a.top/3,a.top/3+1,a.top/3+2),a.write(M[0].pos),a.write(M[O-2].pos),a.write(M[O-1].pos),c.write(M[0].normal),c.write(M[O-2].normal),c.write(M[O-1].normal),d&&(d.write(M[0].uv),d.write(M[O-2].uv),d.write(M[O-1].uv)),p&&(p.write(M[0].color),p.write(M[O-2].color),p.write(M[O-1].color))}o.setAttribute("position",new f.TlE(a.array,3)),o.setAttribute("normal",new f.TlE(c.array,3)),d&&o.setAttribute("uv",new f.TlE(d.array,2)),p&&o.setAttribute("color",new f.TlE(p.array,3));for(let E=0;E<m.length;E++)m[E]===void 0&&(m[E]=[]);if(m.length){let E=[],M=0;for(let T=0;T<m.length;T++)o.addGroup(M,m[T].length,T),M+=m[T].length,E=E.concat(m[T]);o.addGroup(M,A.length,m.length),E=E.concat(A),o.setIndex(E)}const x=new f.yGw().copy(t).invert();return o.applyMatrix4(x),o.computeBoundingSphere(),o.computeBoundingBox(),o}static fromMesh(e,t){const n=Xr.fromGeometry(e.geometry,t),r=new f.Pa4,o=new f.Vkp;o.getNormalMatrix(e.matrix);for(let a=0;a<n.polygons.length;a++){const c=n.polygons[a];for(let d=0;d<c.vertices.length;d++){const p=c.vertices[d];p.pos.copy(r.copy(p.pos.toVector3()).applyMatrix4(e.matrix)),p.normal.copy(r.copy(p.normal.toVector3()).applyMatrix3(o))}}return n}static toMesh(e,t,n){const r=Xr.toGeometry(e,t),o=new f.Kj0(r,n);return o.matrix.copy(t),o.matrix.decompose(o.position,o.quaternion,o.scale),o.rotation.setFromQuaternion(o.quaternion),o.updateMatrixWorld(),o.castShadow=o.receiveShadow=!0,o}static union(e,t){const n=Xr.fromMesh(e),r=Xr.fromMesh(t);return Xr.toMesh(n.union(r),e.matrix,e.material)}static subtract(e,t){const n=Xr.fromMesh(e),r=Xr.fromMesh(t);return Xr.toMesh(n.subtract(r),e.matrix,e.material)}static intersect(e,t){const n=Xr.fromMesh(e),r=Xr.fromMesh(t);return Xr.toMesh(n.intersect(r),e.matrix,e.material)}clone(){const e=new Xr;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new lh(this.clone().polygons),n=new lh(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),Xr.fromPolygons(t.allPolygons())}subtract(e){const t=new lh(this.clone().polygons),n=new lh(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),Xr.fromPolygons(t.allPolygons())}intersect(e){const t=new lh(this.clone().polygons),n=new lh(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),Xr.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return Xr.toMesh(this,e,t)}toGeometry(e){return Xr.toGeometry(this,e)}}var Av=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Nx=["union","subtract","intersect"];class id extends Zn{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[Ii],this.rootMesh=new f.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(Ii))===null||t===void 0||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();n&&n.geometry&&(n.userData._isCSGMesh||(n.userData.csgBrush||(n.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&Jr(e,"csg."+e.ext)}async exportObject(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter;if(!n||!this.rootObject)return;const r=this.rootMesh.visible;this.rootMesh.visible=!0;const o=await n.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=r,o}_updateSelectedProperties(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();n&&n.userData.csgBrush&&(n.userData.csgBrush.enabled=this.csgSelectedEnabled,n.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,n,r,o,a,c,d;const p=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();p&&(this.csgSelectedEnabled=(r=(n=p.userData.csgBrush)===null||n===void 0?void 0:n.enabled)!==null&&r!==void 0&&r,this.csgSelectedOperation=(a=(o=p.userData.csgBrush)===null||o===void 0?void 0:o.operation)!==null&&a!==void 0?a:"union"),(d=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}_preFrame(){var e,t,n;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const r=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((t=this.rootMesh.userData.dispose)!==null&&t!==void 0?t:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(r)),this.rootMesh&&!this.rootMesh.parent&&((n=this.rootObject)===null||n===void 0||n.modelObject.add(this.rootMesh)),this.showResult?(r.forEach(o=>{o[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(r.forEach(o=>{o[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(n=>{var r;n.isMesh&&n.geometry&&(!((r=n.userData.csgBrush)===null||r===void 0)&&r.enabled)&&t.push([n,n.userData.csgBrush.operation])}),t}_sceneUpdate(e){var t,n;!((n=(t=e==null?void 0:e.object)===null||t===void 0?void 0:t.userData)===null||n===void 0)&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}Av([gn("Show Result",s=>({onChange:()=>{var e;return(e=s._viewer)===null||e===void 0?void 0:e.setDirty()}}))],id.prototype,"showResult",void 0),Av([Si("Make CSG Brush",s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();return!(n!=null&&n.userData)||!!n.userData.csgBrush||n.userData._isCSGMesh}}))],id.prototype,"makeSelectedCSGBrush",null),Av([gn("Enabled",s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:s._updateSelectedProperties}))],id.prototype,"csgSelectedEnabled",void 0),Av([Il("Operation",Nx.map(s=>({label:s})),s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(Ii))===null||t===void 0?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:s._updateSelectedProperties}))],id.prototype,"csgSelectedOperation",void 0),Av([Si("Refresh CSG")],id.prototype,"refreshCSG",null),Av([Si("Export Result",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],id.prototype,"downloadObject",null);function $C(s,e){let t=new Xr;const n=s.map(o=>o[0].material).flatMap(o=>o);s.forEach(([o,a])=>{if(!Nx.includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const c=o.matrix;o.matrix=o.matrixWorld;let d=0;d=Array.isArray(o.material)?void 0:n.indexOf(o.material),t=t[a](Xr.fromMesh(o,d)),o.matrix=c});const r=t.toMesh(e??new f.yGw().identity(),n);return r.userData._isCSGMesh=!0,r.geometry.groups=r.geometry.groups.filter(o=>o.count>0),r}let Cb=class extends id{_buildCSGMesh(s){return $C(s)}};Cb.PluginType="CSGPluginBSP",Cb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([ci("CSG Plugin (BSP)")],Cb);class rd{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let o=0,a=e.length;o<a;o++){const c=e[o][t];n=c<n?c:n,r=c>r?c:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let o=0,a=t.length;o<a;o++){const c=t[o],d=e.dot(c);n=d<n?d:n,r=d>r?d:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}rd.prototype.setFromBox=function(){const s=new f.Pa4;return function(e,t){const n=t.min,r=t.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let d=0;d<=1;d++)for(let p=0;p<=1;p++){s.x=n.x*c+r.x*(1-c),s.y=n.y*d+r.y*(1-d),s.z=n.z*p+r.z*(1-p);const m=e.dot(s);o=Math.min(m,o),a=Math.max(m,a)}this.min=o,this.max=a}}();const RT=function(){const s=new f.Pa4,e=new f.Pa4,t=new f.Pa4;return function(n,r,o){const a=n.start,c=s,d=r.start,p=e;t.subVectors(a,d),s.subVectors(n.end,r.start),e.subVectors(r.end,r.start);const m=t.dot(p),A=p.dot(c),x=p.dot(p),E=t.dot(c),M=c.dot(c)*x-A*A;let T,O;T=M!==0?(m*A-E*x)/M:0,O=(m+T*A)/x,o.x=T,o.y=O}}(),Ux=function(){const s=new f.FM8,e=new f.Pa4,t=new f.Pa4;return function(n,r,o,a){RT(n,r,s);let c=s.x,d=s.y;if(c>=0&&c<=1&&d>=0&&d<=1)return n.at(c,o),void r.at(d,a);if(c>=0&&c<=1)return d<0?r.at(0,a):r.at(1,a),void n.closestPointToPoint(a,!0,o);if(d>=0&&d<=1)return c<0?n.at(0,o):n.at(1,o),void r.closestPointToPoint(o,!0,a);{let p,m;p=c<0?n.start:n.end,m=d<0?r.start:r.end;const A=e,x=t;return n.closestPointToPoint(m,!0,e),r.closestPointToPoint(p,!0,t),A.distanceToSquared(m)<=x.distanceToSquared(p)?(o.copy(A),void a.copy(m)):(o.copy(p),void a.copy(x))}}}(),BT=function(){const s=new f.Pa4,e=new f.Pa4,t=new f.JOQ,n=new f.Zzh;return function(r,o){const{radius:a,center:c}=r,{a:d,b:p,c:m}=o;if(n.start=d,n.end=p,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a||(n.start=d,n.end=m,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a)||(n.start=p,n.end=m,n.closestPointToPoint(c,!0,s).distanceTo(c)<=a))return!0;const A=o.getPlane(t);if(Math.abs(A.distanceToPoint(c))<=a){const x=A.projectPoint(c,e);if(o.containsPoint(x))return!0}return!1}}();function yv(s){return Math.abs(s)<1e-15}class ch extends f.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new f.Pa4),this.satBounds=new Array(4).fill().map(()=>new rd),this.points=[this.a,this.b,this.c],this.sphere=new f.aLr,this.plane=new f.JOQ,this.needsUpdate=!0}intersectsSphere(e){return BT(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,o=this.satAxes,a=this.satBounds,c=o[0],d=a[0];this.getNormal(c),d.setFromPoints(c,r);const p=o[1],m=a[1];p.subVectors(e,t),m.setFromPoints(p,r);const A=o[2],x=a[2];A.subVectors(t,n),x.setFromPoints(A,r);const E=o[3],M=a[3];E.subVectors(n,e),M.setFromPoints(E,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,e),this.needsUpdate=!1}}ch.prototype.closestPointToSegment=function(){const s=new f.Pa4,e=new f.Pa4,t=new f.Zzh;return function(n,r=null,o=null){const{start:a,end:c}=n,d=this.points;let p,m=1/0;for(let A=0;A<3;A++){const x=(A+1)%3;t.start.copy(d[A]),t.end.copy(d[x]),Ux(t,n,s,e),p=s.distanceToSquared(e),p<m&&(m=p,r&&r.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),p=a.distanceToSquared(s),p<m&&(m=p,r&&r.copy(s),o&&o.copy(a)),this.closestPointToPoint(c,s),p=c.distanceToSquared(s),p<m&&(m=p,r&&r.copy(s),o&&o.copy(c)),Math.sqrt(m)}}(),ch.prototype.intersectsTriangle=function(){const s=new ch,e=new Array(3),t=new Array(3),n=new rd,r=new rd,o=new f.Pa4,a=new f.Pa4,c=new f.Pa4,d=new f.Pa4,p=new f.Zzh,m=new f.Zzh,A=new f.Zzh;return function(x,E=null){this.needsUpdate&&this.update(),x.isExtendedTriangle?x.needsUpdate&&x.update():(s.copy(x),s.update(),x=s);const M=this.plane,T=x.plane;if(Math.abs(M.normal.dot(T.normal))>1-1e-10){const O=this.satBounds,P=this.satAxes;t[0]=x.a,t[1]=x.b,t[2]=x.c;for(let j=0;j<4;j++){const z=O[j],V=P[j];if(n.setFromPoints(V,t),z.isSeparated(n))return!1}const R=x.satBounds,I=x.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let j=0;j<4;j++){const z=R[j],V=I[j];if(n.setFromPoints(V,e),z.isSeparated(n))return!1}for(let j=0;j<4;j++){const z=P[j];for(let V=0;V<4;V++){const G=I[V];if(o.crossVectors(z,G),n.setFromPoints(o,e),r.setFromPoints(o,t),n.isSeparated(r))return!1}}return E&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),E.start.set(0,0,0),E.end.set(0,0,0)),!0}{const O=this.points;let P=!1,R=0;for(let de=0;de<3;de++){const xe=O[de],pe=O[(de+1)%3];p.start.copy(xe),p.end.copy(pe),p.delta(a);const ye=P?m.start:m.end,Re=yv(T.distanceToPoint(xe));if(yv(T.normal.dot(a))&&Re){m.copy(p),R=2;break}if((T.intersectLine(p,ye)||Re)&&!yv(ye.distanceTo(pe))){if(R++,P)break;P=!0}}if(R===1&&this.containsPoint(m.start))return E&&(E.start.copy(m.start),E.end.copy(m.start)),!0;if(R!==2)return!1;const I=x.points;let j=!1,z=0;for(let de=0;de<3;de++){const xe=I[de],pe=I[(de+1)%3];p.start.copy(xe),p.end.copy(pe),p.delta(c);const ye=j?A.start:A.end,Re=yv(M.distanceToPoint(xe));if(yv(M.normal.dot(c))&&Re){A.copy(p),z=2;break}if((M.intersectLine(p,ye)||Re)&&!yv(ye.distanceTo(pe))){if(z++,j)break;j=!0}}if(z===1&&this.containsPoint(A.start))return E&&(E.start.copy(A.start),E.end.copy(A.start)),!0;if(z!==2)return!1;if(m.delta(a),A.delta(c),a.dot(c)<0){let de=A.start;A.start=A.end,A.end=de}const V=m.start.dot(a),G=m.end.dot(a),X=A.start.dot(a),ne=A.end.dot(a),ce=G<X,ge=V<ne;return(V===ne||X===G||ce!==ge)&&(E&&(d.subVectors(m.start,A.start),d.dot(a)>0?E.start.copy(m.start):E.start.copy(A.start),d.subVectors(m.end,A.end),d.dot(a)<0?E.end.copy(m.end):E.end.copy(A.end)),!0)}}}(),ch.prototype.distanceToPoint=function(){const s=new f.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),ch.prototype.distanceToTriangle=function(){const s=new f.Pa4,e=new f.Pa4,t=["a","b","c"],n=new f.Zzh,r=new f.Zzh;return function(o,a=null,c=null){const d=a||c?n:null;if(this.intersectsTriangle(o,d))return(a||c)&&(a&&d.getCenter(a),c&&d.getCenter(c)),0;let p=1/0;for(let m=0;m<3;m++){let A;const x=t[m],E=o[x];this.closestPointToPoint(E,s),A=E.distanceToSquared(s),A<p&&(p=A,a&&a.copy(s),c&&c.copy(E));const M=this[x];o.closestPointToPoint(M,s),A=M.distanceToSquared(s),A<p&&(p=A,a&&a.copy(M),c&&c.copy(s))}for(let m=0;m<3;m++){const A=t[m],x=t[(m+1)%3];n.set(this[A],this[x]);for(let E=0;E<3;E++){const M=t[E],T=t[(E+1)%3];r.set(o[M],o[T]),Ux(n,r,s,e);const O=s.distanceToSquared(e);O<p&&(p=O,a&&a.copy(s),c&&c.copy(e))}}return Math.sqrt(p)}}();class eS{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:r}=this;n[e]||(n[e]=[],r.push(e)),n[e].push(t)}}const fm=new f.zHn,tS=new f.yGw,ga=new f.CJI,sd=new f.Pa4,nS=new f.Ltg,iS=new f.Ltg,rS=new f.Ltg,Fx=new f.Ltg,Sb=new f.Ltg,Mb=new f.Ltg,jx=new f.Zzh,zx=1e-8;let Tb=null;function sS(s){Tb=s}function oS(s,e){function t(){return Math.random()-.5}fm.origin.copy(s.a).add(s.b).add(s.c).multiplyScalar(1/3),s.getNormal(fm.direction);let n=0,r=1/0;for(let o=0;o<3;o++){fm.direction.x+=t()*zx,fm.direction.y+=t()*zx,fm.direction.z+=t()*zx;const a=e.raycastFirst(fm,f.ehD);if(Boolean(a&&fm.direction.dot(a.face.normal)>0)&&n++,a!==null&&(r=Math.min(r,a.distance)),r===0||n/3>.5||(o-n+1)/3>.5)break}return r===0?0:n/3>.5?-1:1}function aS(s,e,t,n,r,o,a=!1){const c=t.attributes,d=t.index,p=3*s,m=d.getX(p+0),A=d.getX(p+1),x=d.getX(p+2);for(const E in o){const M=c[E],T=o[E];if(!(E in c))throw new Error(`CSG Operations: Attribute ${E} not available on geometry.`);const O=M.itemSize;E==="position"?(ga.a.fromBufferAttribute(M,m).applyMatrix4(n),ga.b.fromBufferAttribute(M,A).applyMatrix4(n),ga.c.fromBufferAttribute(M,x).applyMatrix4(n),Qx(ga.a,ga.b,ga.c,e,3,T,a)):E==="normal"?(ga.a.fromBufferAttribute(M,m).applyNormalMatrix(r),ga.b.fromBufferAttribute(M,A).applyNormalMatrix(r),ga.c.fromBufferAttribute(M,x).applyNormalMatrix(r),a&&(ga.a.multiplyScalar(-1),ga.b.multiplyScalar(-1),ga.c.multiplyScalar(-1)),Qx(ga.a,ga.b,ga.c,e,3,T,a,!0)):(nS.fromBufferAttribute(M,m),iS.fromBufferAttribute(M,A),rS.fromBufferAttribute(M,x),Qx(nS,iS,rS,e,O,T,a))}}function lS(s,e,t,n,r,o,a,c=!1){Vx(s,n,r,o,a,c),Vx(e,n,r,o,a,c),Vx(t,n,r,o,a,c)}function cS(s,e,t=!1){switch(s){case 0:if(e===1||e===0&&t)return 1;break;case 1:if(t){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&t)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${s}".`)}return 2}function Qx(s,e,t,n,r,o,a=!1,c=!1){const d=p=>{o.push(p.x),r>1&&o.push(p.y),r>2&&o.push(p.z),r>3&&o.push(p.w)};Fx.set(0,0,0,0).addScaledVector(s,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),Sb.set(0,0,0,0).addScaledVector(s,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Mb.set(0,0,0,0).addScaledVector(s,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),c&&(Fx.normalize(),Sb.normalize(),Mb.normalize()),d(Fx),a?(d(Mb),d(Sb)):(d(Sb),d(Mb))}function Vx(s,e,t,n,r,o=!1){for(const a in r){const c=e[a],d=r[a];if(!(a in e))throw new Error(`CSG Operations: Attribute ${a} no available on geometry.`);const p=c.itemSize;a==="position"?(sd.fromBufferAttribute(c,s).applyMatrix4(t),d.push(sd.x,sd.y,sd.z)):a==="normal"?(sd.fromBufferAttribute(c,s).applyNormalMatrix(n),o&&sd.multiplyScalar(-1),d.push(sd.x,sd.y,sd.z)):(d.push(c.getX(s)),p>1&&d.push(c.getY(s)),p>2&&d.push(c.getZ(s)),p>3&&d.push(c.getW(s)))}}const wp=1e-14,Ib=1e-7,uh=new f.Zzh,ds=new f.Zzh,cu=new f.Pa4,uS=new f.Pa4,w_=new f.JOQ,kT=new ch;function x_(s){return s.a.distanceToSquared(s.b)<wp||s.a.distanceToSquared(s.c)<wp||s.b.distanceToSquared(s.c)<wp}class OT extends f.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,t=null,n=-1){if(this.originalSide!==null&&this.side===null)return;cu.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const r=e.distanceToPoint(cu)<0?-1:1;t&&n!==-1?r===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=r,this.side=r),r!==this.side&&(this.side=null))}}class LT{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new OT);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class NT{constructor(){this.trianglePool=new LT,this.triangles=[],this.normal=new f.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:r}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let o=0,a=e.length;o<a;o++){const c=e[o];if(o===0)c.getNormal(r);else if(Math.abs(1-c.getNormal(cu).dot(r))>wp)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const d=n.getTriangle();d.copy(c),t.push(d)}else{e.getNormal(r);const o=n.getTriangle();o.copy(e),t.push(o)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(w_),Math.abs(1-Math.abs(w_.normal.dot(t)))<Ib){const r=[e.a,e.b,e.c];for(let o=0;o<3;o++){const a=(o+1)%3,c=r[o],d=r[a];cu.subVectors(d,c).normalize(),uS.crossVectors(t,cu),w_.setFromNormalAndCoplanarPoint(uS,c),this.splitByPlane(w_,e,o)}for(let o=0,a=n.length;o<a;o++)n[o].coplanarCount=0}else this.splitByPlane(w_,e)}splitByPlane(e,t=null,n=-1){const{triangles:r,trianglePool:o}=this;let a=null;t!==null&&(a=kT,a.copy(t),a.needsUpdate=!0);for(let c=0,d=r.length;c<d;c++){const p=r[c],{a:m,b:A,c:x}=p;if(a&&(!a.intersectsTriangle(p,uh)||uh.distance()<1e-5)){p.updateSide(e,a,n),p.side=null;continue}let E=0,M=-1,T=0,O=0,P=!1;const R=[m,A,x];for(let I=0;I<3;I++){const j=(I+1)%3;uh.start.copy(R[I]),uh.end.copy(R[j]);const z=e.distanceToPoint(uh.start),V=e.distanceToPoint(uh.end);Math.abs(z)<wp?O++:z>0&&T++,Math.abs(z)<Ib&&Math.abs(V)<Ib&&(P=!0);let G=!!e.intersectLine(uh,cu);!G&&Math.abs(V)<wp&&(cu.copy(uh.end),G=!0),!G||cu.distanceTo(uh.start)<wp||(cu.distanceTo(uh.end)<wp&&(M=I),E===0?ds.start.copy(cu):ds.end.copy(cu),E++)}if(!P&&O<2&&E===2&&ds.distance()>Ib)if(M!==-1){M=(M+1)%3;let I=0;I===M&&(I=(I+1)%3);let j=I+1;j===M&&(j=(j+1)%3);const z=o.getTriangle();z.a.copy(R[j]),z.b.copy(ds.end),z.c.copy(ds.start),x_(z)||(r.push(z),z.initFrom(p),z.updateSide(e,a,n)),p.a.copy(R[I]),p.b.copy(ds.start),p.c.copy(ds.end),x_(p)?(r.splice(c,1),c--,d--):p.updateSide(e,a,n)}else{const I=R.findIndex(X=>T>=2?e.distanceToPoint(X)<0:e.distanceToPoint(X)>0);if(I===0){let X=ds.start;ds.start=ds.end,ds.end=X}else if(I===-1)continue;const j=(I+1)%3,z=(I+2)%3,V=o.getTriangle(),G=o.getTriangle();R[j].distanceToSquared(ds.start)<R[z].distanceToSquared(ds.end)?(V.a.copy(R[j]),V.b.copy(ds.start),V.c.copy(ds.end),G.a.copy(R[j]),G.b.copy(R[z]),G.c.copy(ds.start)):(V.a.copy(R[z]),V.b.copy(ds.start),V.c.copy(ds.end),G.a.copy(R[j]),G.b.copy(R[z]),G.c.copy(ds.end)),p.a.copy(R[I]),p.b.copy(ds.end),p.c.copy(ds.start),x_(V)||(r.push(V),V.initFrom(p),V.updateSide(e,a,n)),x_(G)||(r.push(G),G.initFrom(p),G.updateSide(e,a,n)),x_(p)?(r.splice(c,1),c--,d--):p.updateSide(e,a,n)}else E===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function hS(){return typeof SharedArrayBuffer<"u"}function UT(s){if(s.buffer instanceof SharedArrayBuffer)return s;const e=s.constructor,t=s.buffer,n=new SharedArrayBuffer(t.byteLength),r=new Uint8Array(t);return new Uint8Array(n).set(r,0),new e(n)}class dS{constructor(e,t=500){const n=hS()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:r}=this;e===null&&(e=~~(n.length*r));const o=new t(e);o.set(n,0),this.array=o}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,o=e.length;r<o;r++)t[n+r]=e[r];this.length+=e.length}clear(){this.length=0}}class FT{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let r=0;for(let o=0;o<t;o++)r+=n[o][e].length;return r}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const r={};t.push(r);for(const o in n)r[o]=new dS(n[o].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,r=n[0][e];if(r){if(r.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let o=0,a=n.length;o<a;o++)n[o][e]=new dS(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class jT{constructor(e){this.triangle=new f.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new f.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class pS{constructor(){this.data={}}addTriangleIntersection(e,t,n,r){const{data:o}=this;o[e]||(o[e]=new jT(t)),o[e].addTriangle(n,r)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const r in t)n.push(t[r].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,r=new Set,o=[],a=c=>{if(n[c])if(t!==null)n[c].intersects[t]&&o.push(n[c].intersects[t]);else{const d=n[c].intersects;for(const p in d)r.has(p)||(r.add(p),o.push(d[p]))}};if(e!==null)a(e);else for(const c in n)a(c);return o}reset(){this.data={}}}class zT{constructor(){this.enabled=!1,this.triangleIntersectsA=new pS,this.triangleIntersectsB=new pS,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,r){const{triangleIntersectsA:o,triangleIntersectsB:a}=this;o.addTriangleIntersection(e,t,n,r),a.addTriangleIntersection(n,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const xp=new f.yGw,bv=new f.Vkp,mm=new f.CJI,Db=new f.CJI,Pb=new f.CJI,E_=new f.CJI;function QT(s){for(const e of s)return e}function fS(s,e,t,n,r,o,a,c=0){xp.copy(e.matrixWorld).invert().multiply(s.matrixWorld),bv.getNormalMatrix(s.matrixWorld);const d=s.geometry.groupIndices,p=s.geometry.index,m=s.geometry.attributes.position,A=e.geometry.boundsTree,x=e.geometry.index,E=e.geometry.attributes.position,M=t.ids,T=t.intersectionSet;for(let O=0,P=M.length;O<P;O++){const R=M[O],I=c===-1?0:d[R]+c,j=a.getGroupSet(I),z=3*R,V=p.getX(z+0),G=p.getX(z+1),X=p.getX(z+2);mm.a.fromBufferAttribute(m,V).applyMatrix4(xp),mm.b.fromBufferAttribute(m,G).applyMatrix4(xp),mm.c.fromBufferAttribute(m,X).applyMatrix4(xp),o.initialize(mm);const ne=T[R];for(let ge=0,de=ne.length;ge<de;ge++){const xe=3*ne[ge],pe=x.getX(xe+0),ye=x.getX(xe+1),Re=x.getX(xe+2);Db.a.fromBufferAttribute(E,pe),Db.b.fromBufferAttribute(E,ye),Db.c.fromBufferAttribute(E,Re),o.splitByTriangle(Db)}const ce=o.triangles;for(let ge=0,de=ce.length;ge<de;ge++){const xe=ce[ge],pe=cS(n,oS(xe,A),r);if(pe!==2)switch(mm.getBarycoord(xe.a,E_.a),mm.getBarycoord(xe.b,E_.b),mm.getBarycoord(xe.c,E_.c),pe){case 1:aS(R,E_,s.geometry,s.matrixWorld,bv,j);break;case 0:aS(R,E_,s.geometry,s.matrixWorld,bv,j,!0)}}}return M.length}function mS(s,e,t,n,r,o,a=0){xp.copy(e.matrixWorld).invert().multiply(s.matrixWorld),bv.getNormalMatrix(s.matrixWorld);const c=e.geometry.boundsTree,d=s.geometry.groupIndices,p=s.geometry.index,m=s.geometry.attributes,A=m.position,x=[],E=s.geometry.halfEdges,M=new Set;for(let T=0,O=p.count/3;T<O;T++)T in t.intersectionSet||M.add(T);for(;M.size>0;){const T=QT(M);M.delete(T),x.push(T);const O=3*T,P=p.getX(O+0),R=p.getX(O+1),I=p.getX(O+2);Pb.a.fromBufferAttribute(A,P).applyMatrix4(xp),Pb.b.fromBufferAttribute(A,R).applyMatrix4(xp),Pb.c.fromBufferAttribute(A,I).applyMatrix4(xp);const j=cS(n,oS(Pb,c),r);for(;x.length>0;){const z=x.pop(),V=a===-1?0:d[z]+a,G=o.getGroupSet(V);for(let de=0;de<3;de++){const xe=E.getSiblingTriangleIndex(z,de);xe!==-1&&M.has(xe)&&(x.push(xe),M.delete(xe))}const X=3*z,ne=p.getX(X+0),ce=p.getX(X+1),ge=p.getX(X+2);switch(j){case 1:lS(ne,ce,ge,m,s.matrixWorld,bv,G);break;case 0:lS(ge,ce,ne,m,s.matrixWorld,bv,G,r)}}}}const Gx=1.25,Hx=65535,VT=Math.pow(2,-24);class Rb{constructor(){}}function hh(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function gS(s){let e=-1,t=-1/0;for(let n=0;n<3;n++){const r=s[n+3]-s[n];r>t&&(t=r,e=n)}return e}function vS(s,e){e.set(s)}function _S(s,e,t){let n,r;for(let o=0;o<3;o++){const a=o+3;n=s[o],r=e[o],t[o]=n<r?n:r,n=s[a],r=e[a],t[a]=n>r?n:r}}function Bb(s,e,t){for(let n=0;n<3;n++){const r=e[s+2*n],o=e[s+2*n+1],a=r-o,c=r+o;a<t[n]&&(t[n]=a),c>t[n+3]&&(t[n+3]=c)}}function C_(s){const e=s[3]-s[0],t=s[4]-s[1],n=s[5]-s[2];return 2*(e*t+t*n+n*e)}function Wx(s,e,t,n,r=null){let o=1/0,a=1/0,c=1/0,d=-1/0,p=-1/0,m=-1/0,A=1/0,x=1/0,E=1/0,M=-1/0,T=-1/0,O=-1/0;const P=r!==null;for(let R=6*e,I=6*(e+t);R<I;R+=6){const j=s[R+0],z=s[R+1],V=j-z,G=j+z;V<o&&(o=V),G>d&&(d=G),P&&j<A&&(A=j),P&&j>M&&(M=j);const X=s[R+2],ne=s[R+3],ce=X-ne,ge=X+ne;ce<a&&(a=ce),ge>p&&(p=ge),P&&X<x&&(x=X),P&&X>T&&(T=X);const de=s[R+4],xe=s[R+5],pe=de-xe,ye=de+xe;pe<c&&(c=pe),ye>m&&(m=ye),P&&de<E&&(E=de),P&&de>O&&(O=de)}n[0]=o,n[1]=a,n[2]=c,n[3]=d,n[4]=p,n[5]=m,P&&(r[0]=A,r[1]=x,r[2]=E,r[3]=M,r[4]=T,r[5]=O)}const GT=(s,e)=>s.candidate-e.candidate,Ep=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),kb=new Float32Array(6);class dh extends f.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new f.yGw,this.invMatrix=new f.yGw,this.points=new Array(8).fill().map(()=>new f.Pa4),this.satAxes=new Array(3).fill().map(()=>new f.Pa4),this.satBounds=new Array(3).fill().map(()=>new rd),this.alignedSatBounds=new Array(3).fill().map(()=>new rd),this.needsUpdate=!1}set(e,t,n){super.set(e,t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}dh.prototype.update=function(){const s=this.matrix,e=this.min,t=this.max,n=this.points;for(let d=0;d<=1;d++)for(let p=0;p<=1;p++)for(let m=0;m<=1;m++){const A=n[1*d|2*p|4*m];A.x=d?t.x:e.x,A.y=p?t.y:e.y,A.z=m?t.z:e.z,A.applyMatrix4(s)}const r=this.satBounds,o=this.satAxes,a=n[0];for(let d=0;d<3;d++){const p=o[d],m=r[d],A=n[1<<d];p.subVectors(a,A),m.setFromPoints(p,n)}const c=this.alignedSatBounds;c[0].setFromPointsField(n,"x"),c[1].setFromPointsField(n,"y"),c[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dh.prototype.intersectsBox=function(){const s=new rd;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=t.x,s.max=n.x,a[0].isSeparated(s)||(s.min=t.y,s.max=n.y,a[1].isSeparated(s))||(s.min=t.z,s.max=n.z,a[2].isSeparated(s)))return!1;for(let c=0;c<3;c++){const d=o[c],p=r[c];if(s.setFromBox(d,e),p.isSeparated(s))return!1}return!0}}(),dh.prototype.intersectsTriangle=function(){const s=new ch,e=new Array(3),t=new rd,n=new rd,r=new f.Pa4;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,c=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let A=0;A<3;A++){const x=a[A],E=c[A];if(t.setFromPoints(E,e),x.isSeparated(t))return!1}const d=o.satBounds,p=o.satAxes,m=this.points;for(let A=0;A<3;A++){const x=d[A],E=p[A];if(t.setFromPoints(E,m),x.isSeparated(t))return!1}for(let A=0;A<3;A++){const x=c[A];for(let E=0;E<4;E++){const M=p[E];if(r.crossVectors(x,M),t.setFromPoints(r,e),n.setFromPoints(r,m),t.isSeparated(n))return!1}}return!0}}(),dh.prototype.closestPointToPoint=function(s,e){return this.needsUpdate&&this.update(),e.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},dh.prototype.distanceToPoint=function(){const s=new f.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),dh.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new f.Zzh),t=new Array(12).fill().map(()=>new f.Zzh),n=new f.Pa4,r=new f.Pa4;return function(o,a=0,c=null,d=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||d)&&(o.getCenter(r),this.closestPointToPoint(r,n),o.closestPointToPoint(n,r),c&&c.copy(n),d&&d.copy(r)),0;const p=a*a,m=o.min,A=o.max,x=this.points;let E=1/0;for(let T=0;T<8;T++){const O=x[T];r.copy(O).clamp(m,A);const P=O.distanceToSquared(r);if(P<E&&(E=P,c&&c.copy(O),d&&d.copy(r),P<p))return Math.sqrt(P)}let M=0;for(let T=0;T<3;T++)for(let O=0;O<=1;O++)for(let P=0;P<=1;P++){const R=(T+1)%3,I=(T+2)%3,j=1<<T|O<<R|P<<I,z=x[O<<R|P<<I],V=x[j];e[M].set(z,V);const G=s[T],X=s[R],ne=s[I],ce=t[M],ge=ce.start,de=ce.end;ge[G]=m[G],ge[X]=O?m[X]:A[X],ge[ne]=P?m[ne]:A[X],de[G]=A[G],de[X]=O?m[X]:A[X],de[ne]=P?m[ne]:A[X],M++}for(let T=0;T<=1;T++)for(let O=0;O<=1;O++)for(let P=0;P<=1;P++){r.x=T?A.x:m.x,r.y=O?A.y:m.y,r.z=P?A.z:m.z,this.closestPointToPoint(r,n);const R=r.distanceToSquared(n);if(R<E&&(E=R,c&&c.copy(n),d&&d.copy(r),R<p))return Math.sqrt(R)}for(let T=0;T<12;T++){const O=e[T];for(let P=0;P<12;P++){const R=t[P];Ux(O,R,n,r);const I=n.distanceToSquared(r);if(I<E&&(E=I,c&&c.copy(n),d&&d.copy(r),I<p))return Math.sqrt(I)}}return Math.sqrt(E)}}();const Ob=new f.Pa4,Lb=new f.Pa4,Nb=new f.Pa4,AS=new f.FM8,yS=new f.FM8,bS=new f.FM8,wS=new f.Pa4;function xS(s,e,t,n,r){const o=3*n,a=s.index.getX(o),c=s.index.getX(o+1),d=s.index.getX(o+2),p=function(m,A,x,E,M,T,O){Ob.fromBufferAttribute(A,E),Lb.fromBufferAttribute(A,M),Nb.fromBufferAttribute(A,T);const P=function(R,I,j,z,V,G){let X;return X=G===f._Li?R.intersectTriangle(z,j,I,!0,V):R.intersectTriangle(I,j,z,G!==f.ehD,V),X===null?null:{distance:R.origin.distanceTo(V),point:V.clone()}}(m,Ob,Lb,Nb,wS,O);if(P){x&&(AS.fromBufferAttribute(x,E),yS.fromBufferAttribute(x,M),bS.fromBufferAttribute(x,T),P.uv=f.CJI.getUV(wS,Ob,Lb,Nb,AS,yS,bS,new f.FM8));const R={a:E,b:M,c:T,normal:new f.Pa4,materialIndex:0};f.CJI.getNormal(Ob,Lb,Nb,R.normal),P.face=R,P.faceIndex=E}return P}(t,s.attributes.position,s.attributes.uv,a,c,d,e);return p?(p.faceIndex=n,r&&r.push(p),p):null}function ES(s,e,t){return s===null?null:(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s.distance<t.near||s.distance>t.far?null:s)}function ph(s,e,t,n){const r=s.a,o=s.b,a=s.c;let c=e,d=e+1,p=e+2;t&&(c=t.getX(e),d=t.getX(e+1),p=t.getX(e+2)),r.x=n.getX(c),r.y=n.getY(c),r.z=n.getZ(c),o.x=n.getX(d),o.y=n.getY(d),o.z=n.getZ(d),a.x=n.getX(p),a.y=n.getY(p),a.z=n.getZ(p)}function CS(s,e,t,n,r,o,a){const c=t.index,d=t.attributes.position;for(let p=s,m=e+s;p<m;p++)if(ph(a,3*p,c,d),a.needsUpdate=!0,n(a,p,r,o))return!0;return!1}class SS{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Cp(s,e){return e[s+15]===65535}function wv(s,e){return e[s+6]}function S_(s,e){return e[s+14]}function M_(s){return s+8}function T_(s,e){return e[s+6]}const xv=new f.ZzF,Ub=new f.Pa4,HT=["x","y","z"];function qx(s,e,t,n,r){let o=2*s,a=Ev,c=Sp,d=Mp;if(Cp(o,c))(function(p,m,A,x,E,M){for(let T=x,O=x+E;T<O;T++)xS(p,m,A,T,M)})(e,t,n,wv(s,d),S_(o,c),r);else{const p=M_(s);Fb(p,a,n,Ub)&&qx(p,e,t,n,r);const m=T_(s,d);Fb(m,a,n,Ub)&&qx(m,e,t,n,r)}}function Yx(s,e,t,n){let r=2*s,o=Ev,a=Sp,c=Mp;if(Cp(r,a))return function(d,p,m,A,x){let E=1/0,M=null;for(let T=A,O=A+x;T<O;T++){const P=xS(d,p,m,T);P&&P.distance<E&&(M=P,E=P.distance)}return M}(e,t,n,wv(s,c),S_(r,a));{const d=function(T,O){return O[T+7]}(s,c),p=HT[d],m=n.direction[p]>=0;let A,x;m?(A=M_(s),x=T_(s,c)):(A=T_(s,c),x=M_(s));const E=Fb(A,o,n,Ub)?Yx(A,e,t,n):null;if(E){const T=E.point[p];if(m?T<=o[x+d]:T>=o[x+d+3])return E}const M=Fb(x,o,n,Ub)?Yx(x,e,t,n):null;return E&&M?E.distance<=M.distance?E:M:E||M||null}}const WT=function(){let s,e;const t=[],n=new SS(()=>new f.ZzF);return function(...o){s=n.getPrimitive(),e=n.getPrimitive(),t.push(s,e);const a=r(...o);n.releasePrimitive(s),n.releasePrimitive(e),t.pop(),t.pop();const c=t.length;return c>0&&(e=t[c-1],s=t[c-2]),a};function r(o,a,c,d,p=null,m=0,A=0){function x(R){let I=2*R,j=Sp,z=Mp;for(;!Cp(I,j);)I=2*(R=M_(R));return wv(R,z)}function E(R){let I=2*R,j=Sp,z=Mp;for(;!Cp(I,j);)I=2*(R=T_(R,z));return wv(R,z)+S_(I,j)}let M=2*o,T=Ev,O=Sp,P=Mp;if(Cp(M,O)){const R=wv(o,P),I=S_(M,O);return hh(o,T,s),d(R,I,!1,A,m+o,s)}{const R=M_(o),I=T_(o,P);let j,z,V,G,X=R,ne=I;if(p&&(V=s,G=e,hh(X,T,V),hh(ne,T,G),j=p(V),z=p(G),z<j)){X=I,ne=R;const pe=j;j=z,z=pe,V=G}V||(V=s,hh(X,T,V));const ce=c(V,Cp(2*X,O),j,A+1,m+X);let ge;if(ce===2){const pe=x(X);ge=d(pe,E(X)-pe,!0,A+1,m+X,V)}else ge=ce&&r(X,a,c,d,p,m,A+1);if(ge)return!0;G=e,hh(ne,T,G);const de=c(G,Cp(2*ne,O),z,A+1,m+ne);let xe;if(de===2){const pe=x(ne);xe=d(pe,E(ne)-pe,!0,A+1,m+ne,G)}else xe=de&&r(ne,a,c,d,p,m,A+1);return!!xe}}}(),qT=function(){const s=new ch,e=new ch,t=new f.yGw,n=new dh,r=new dh;return function o(a,c,d,p,m=null){let A=2*a,x=Ev,E=Sp,M=Mp;if(m===null&&(d.boundingBox||d.computeBoundingBox(),n.set(d.boundingBox.min,d.boundingBox.max,p),m=n),!Cp(A,E)){const T=a+8,O=M[a+6];return hh(T,x,xv),m.intersectsBox(xv)&&o(T,c,d,p,m)?!0:(hh(O,x,xv),!(!m.intersectsBox(xv)||!o(O,c,d,p,m)))}{const T=c,O=T.index,P=T.attributes.position,R=d.index,I=d.attributes.position,j=wv(a,M),z=S_(A,E);if(t.copy(p).invert(),d.boundsTree)return hh(a,x,r),r.matrix.copy(t),r.needsUpdate=!0,d.boundsTree.shapecast({intersectsBounds:G=>r.intersectsBox(G),intersectsTriangle:G=>{G.a.applyMatrix4(p),G.b.applyMatrix4(p),G.c.applyMatrix4(p),G.needsUpdate=!0;for(let X=3*j,ne=3*(z+j);X<ne;X+=3)if(ph(e,X,O,P),e.needsUpdate=!0,G.intersectsTriangle(e))return!0;return!1}});for(let V=3*j,G=z+3*j;V<G;V+=3){ph(s,V,O,P),s.a.applyMatrix4(t),s.b.applyMatrix4(t),s.c.applyMatrix4(t),s.needsUpdate=!0;for(let X=0,ne=R.count;X<ne;X+=3)if(ph(e,X,R,I),e.needsUpdate=!0,s.intersectsTriangle(e))return!0}}}}();function Fb(s,e,t,n){return hh(s,e,xv),t.intersectBox(xv,n)}const Xx=[];let jb,Ev,Sp,Mp;function I_(s){jb&&Xx.push(jb),jb=s,Ev=new Float32Array(s),Sp=new Uint16Array(s),Mp=new Uint32Array(s)}function zb(){jb=null,Ev=null,Sp=null,Mp=null,Xx.length&&I_(Xx.pop())}const Kx=Symbol("skip tree generation"),Jx=new f.ZzF,Zx=new f.ZzF,Cv=new f.yGw,gm=new dh,D_=new dh,P_=new f.Pa4,Qb=new f.Pa4,YT=new f.Pa4,XT=new f.Pa4,KT=new f.Pa4,MS=new f.ZzF,fh=new SS(()=>new ch);class vo{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),vo.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,o=n.getIndex();let a;return a=t.cloneBuffers?{roots:r.map(c=>c.slice()),index:o.array.slice()}:{roots:r,index:o.array},a}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),vo.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:r,roots:o}=e,a=new vo(t,{...n,[Kx]:!0});if(a._roots=o,n.setIndex){const c=t.getIndex();if(c===null){const d=new f.TlE(e.index,1,!1);t.setIndex(d)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Kx]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Kx]||(this._roots=function(n,r){const o=function(E,M){function T(pe){ne&&ne(pe/ce)}function O(pe,ye,Re,we=null,We=0){if(!ge&&We>=z&&(ge=!0,V&&(console.warn(`MeshBVH: Max depth of ${z} reached when generating BVH. Consider increasing maxDepth.`),console.warn(E))),Re<=G||We>=z)return T(ye+Re),pe.offset=ye,pe.count=Re,pe;const ot=function(nt,Rt,Nt,Ut,Ht,yn){let yt=-1,Yn=0;if(yn===0)yt=gS(Rt),yt!==-1&&(Yn=(Rt[yt]+Rt[yt+3])/2);else if(yn===1)yt=gS(nt),yt!==-1&&(Yn=function(ai,Xn,Ci,zi){let lt=0;for(let jt=Xn,zt=Xn+Ci;jt<zt;jt++)lt+=ai[6*jt+2*zi];return lt/Ci}(Nt,Ut,Ht,yt));else if(yn===2){const ai=C_(nt);let Xn=Gx*Ht;const Ci=6*Ut,zi=6*(Ut+Ht);for(let lt=0;lt<3;lt++){const jt=Rt[lt],zt=(Rt[lt+3]-jt)/32;if(Ht<8){const Kn=[...Ep];Kn.length=Ht;let Fi=0;for(let Pe=Ci;Pe<zi;Pe+=6,Fi++){const oe=Kn[Fi];oe.candidate=Nt[Pe+2*lt],oe.count=0;const{bounds:ze,leftCacheBounds:$e,rightCacheBounds:Fe}=oe;for(let at=0;at<3;at++)Fe[at]=1/0,Fe[at+3]=-1/0,$e[at]=1/0,$e[at+3]=-1/0,ze[at]=1/0,ze[at+3]=-1/0;Bb(Pe,Nt,ze)}Kn.sort(GT);let re=Ht;for(let Pe=0;Pe<re;Pe++){const oe=Kn[Pe];for(;Pe+1<re&&Kn[Pe+1].candidate===oe.candidate;)Kn.splice(Pe+1,1),re--}for(let Pe=Ci;Pe<zi;Pe+=6){const oe=Nt[Pe+2*lt];for(let ze=0;ze<re;ze++){const $e=Kn[ze];oe>=$e.candidate?Bb(Pe,Nt,$e.rightCacheBounds):(Bb(Pe,Nt,$e.leftCacheBounds),$e.count++)}}for(let Pe=0;Pe<re;Pe++){const oe=Kn[Pe],ze=oe.count,$e=Ht-oe.count,Fe=oe.leftCacheBounds,at=oe.rightCacheBounds;let Zt=0;ze!==0&&(Zt=C_(Fe)/ai);let hn=0;$e!==0&&(hn=C_(at)/ai);const _n=1+Gx*(Zt*ze+hn*$e);_n<Xn&&(yt=lt,Xn=_n,Yn=oe.candidate)}}else{for(let re=0;re<32;re++){const Pe=Ep[re];Pe.count=0,Pe.candidate=jt+zt+re*zt;const oe=Pe.bounds;for(let ze=0;ze<3;ze++)oe[ze]=1/0,oe[ze+3]=-1/0}for(let re=Ci;re<zi;re+=6){let Pe=~~((Nt[re+2*lt]-jt)/zt);Pe>=32&&(Pe=31);const oe=Ep[Pe];oe.count++,Bb(re,Nt,oe.bounds)}const Kn=Ep[31];vS(Kn.bounds,Kn.rightCacheBounds);for(let re=30;re>=0;re--){const Pe=Ep[re],oe=Ep[re+1];_S(Pe.bounds,oe.rightCacheBounds,Pe.rightCacheBounds)}let Fi=0;for(let re=0;re<31;re++){const Pe=Ep[re],oe=Pe.count,ze=Pe.bounds,$e=Ep[re+1].rightCacheBounds;oe!==0&&(Fi===0?vS(ze,kb):_S(ze,kb,kb)),Fi+=oe;let Fe=0,at=0;Fi!==0&&(Fe=C_(kb)/ai);const Zt=Ht-Fi;Zt!==0&&(at=C_($e)/ai);const hn=1+Gx*(Fe*Fi+at*Zt);hn<Xn&&(yt=lt,Xn=hn,Yn=Pe.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${yn} used.`);return{axis:yt,pos:Yn}}(pe.boundingData,we,I,ye,Re,X);if(ot.axis===-1)return T(ye+Re),pe.offset=ye,pe.count=Re,pe;const ft=function(nt,Rt,Nt,Ut,Ht){let yn=Nt,yt=Nt+Ut-1;const Yn=Ht.pos,ai=2*Ht.axis;for(;;){for(;yn<=yt&&Rt[6*yn+ai]<Yn;)yn++;for(;yn<=yt&&Rt[6*yt+ai]>=Yn;)yt--;if(!(yn<yt))return yn;for(let Xn=0;Xn<3;Xn++){let Ci=nt[3*yn+Xn];nt[3*yn+Xn]=nt[3*yt+Xn],nt[3*yt+Xn]=Ci;let zi=Rt[6*yn+2*Xn+0];Rt[6*yn+2*Xn+0]=Rt[6*yt+2*Xn+0],Rt[6*yt+2*Xn+0]=zi;let lt=Rt[6*yn+2*Xn+1];Rt[6*yn+2*Xn+1]=Rt[6*yt+2*Xn+1],Rt[6*yt+2*Xn+1]=lt}yn++,yt--}}(j,I,ye,Re,ot);if(ft===ye||ft===ye+Re)T(ye+Re),pe.offset=ye,pe.count=Re;else{pe.splitAxis=ot.axis;const nt=new Rb,Rt=ye,Nt=ft-ye;pe.left=nt,nt.boundingData=new Float32Array(6),Wx(I,Rt,Nt,nt.boundingData,R),O(nt,Rt,Nt,R,We+1);const Ut=new Rb,Ht=ft,yn=Re-Nt;pe.right=Ut,Ut.boundingData=new Float32Array(6),Wx(I,Ht,yn,Ut.boundingData,R),O(Ut,Ht,yn,R,We+1)}return pe}(function(pe,ye){if(!pe.index){const Re=pe.attributes.position.count,we=ye.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let We;We=Re>65535?new Uint32Array(new we(4*Re)):new Uint16Array(new we(2*Re)),pe.setIndex(new f.TlE(We,1));for(let ot=0;ot<Re;ot++)We[ot]=ot}})(E,M);const P=new Float32Array(6),R=new Float32Array(6),I=function(pe,ye){const Re=pe.attributes.position,we=Re.array,We=pe.index.array,ot=We.length/3,ft=new Float32Array(6*ot),nt=Re.offset||0;let Rt=3;Re.isInterleavedBufferAttribute&&(Rt=Re.data.stride);for(let Nt=0;Nt<ot;Nt++){const Ut=3*Nt,Ht=6*Nt,yn=We[Ut+0]*Rt+nt,yt=We[Ut+1]*Rt+nt,Yn=We[Ut+2]*Rt+nt;for(let ai=0;ai<3;ai++){const Xn=we[yn+ai],Ci=we[yt+ai],zi=we[Yn+ai];let lt=Xn;Ci<lt&&(lt=Ci),zi<lt&&(lt=zi);let jt=Xn;Ci>jt&&(jt=Ci),zi>jt&&(jt=zi);const zt=(jt-lt)/2,Kn=2*ai;ft[Ht+Kn+0]=lt+zt,ft[Ht+Kn+1]=zt+(Math.abs(lt)+zt)*VT,lt<ye[ai]&&(ye[ai]=lt),jt>ye[ai+3]&&(ye[ai+3]=jt)}}return ft}(E,P),j=E.index.array,z=M.maxDepth,V=M.verbose,G=M.maxLeafTris,X=M.strategy,ne=M.onProgress,ce=E.index.count/3;let ge=!1;const de=[],xe=function(pe){if(!pe.groups||!pe.groups.length)return[{offset:0,count:pe.index.count/3}];const ye=[],Re=new Set;for(const We of pe.groups)Re.add(We.start),Re.add(We.start+We.count);const we=Array.from(Re.values()).sort((We,ot)=>We-ot);for(let We=0;We<we.length-1;We++){const ot=we[We],ft=we[We+1];ye.push({offset:ot/3,count:(ft-ot)/3})}return ye}(E);if(xe.length===1){const pe=xe[0],ye=new Rb;ye.boundingData=P,function(Re,we,We,ot){let ft=1/0,nt=1/0,Rt=1/0,Nt=-1/0,Ut=-1/0,Ht=-1/0;for(let yn=6*we,yt=6*(we+We);yn<yt;yn+=6){const Yn=Re[yn+0];Yn<ft&&(ft=Yn),Yn>Nt&&(Nt=Yn);const ai=Re[yn+2];ai<nt&&(nt=ai),ai>Ut&&(Ut=ai);const Xn=Re[yn+4];Xn<Rt&&(Rt=Xn),Xn>Ht&&(Ht=Xn)}ot[0]=ft,ot[1]=nt,ot[2]=Rt,ot[3]=Nt,ot[4]=Ut,ot[5]=Ht}(I,pe.offset,pe.count,R),O(ye,pe.offset,pe.count,R),de.push(ye)}else for(let pe of xe){const ye=new Rb;ye.boundingData=new Float32Array(6),Wx(I,pe.offset,pe.count,ye.boundingData,R),O(ye,pe.offset,pe.count,R),de.push(ye)}return de}(n,r);let a,c,d;const p=[],m=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let E=0;E<o.length;E++){const M=o[E],T=new m(32*A(M));a=new Float32Array(T),c=new Uint32Array(T),d=new Uint16Array(T),x(0,M),p.push(T)}return p;function A(E){return E.count?1:1+A(E.left)+A(E.right)}function x(E,M){const T=E/4,O=E/2,P=!!M.count,R=M.boundingData;for(let I=0;I<6;I++)a[T+I]=R[I];if(P){const I=M.offset,j=M.count;return c[T+6]=I,d[O+14]=j,d[O+15]=Hx,E+32}{const I=M.left,j=M.right,z=M.splitAxis;let V;if(V=x(E+32,I),V/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return c[T+6]=V/4,V=x(V,j),c[T+7]=z,V}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new f.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,r=t.attributes.position,o=r.array,a=r.offset||0;let c,d,p,m,A=3;r.isInterleavedBufferAttribute&&(A=r.data.stride);let x=0;const E=this._roots;for(let T=0,O=E.length;T<O;T++)c=E[T],d=new Uint32Array(c),p=new Uint16Array(c),m=new Float32Array(c),M(0,x),x+=c.byteLength;function M(T,O,P=!1){const R=2*T;if(p[R+15]===Hx){const I=d[T+6];let j=1/0,z=1/0,V=1/0,G=-1/0,X=-1/0,ne=-1/0;for(let ce=3*I,ge=3*(I+p[R+14]);ce<ge;ce++){const de=n[ce]*A+a,xe=o[de+0],pe=o[de+1],ye=o[de+2];xe<j&&(j=xe),xe>G&&(G=xe),pe<z&&(z=pe),pe>X&&(X=pe),ye<V&&(V=ye),ye>ne&&(ne=ye)}return(m[T+0]!==j||m[T+1]!==z||m[T+2]!==V||m[T+3]!==G||m[T+4]!==X||m[T+5]!==ne)&&(m[T+0]=j,m[T+1]=z,m[T+2]=V,m[T+3]=G,m[T+4]=X,m[T+5]=ne,!0)}{const I=T+8,j=d[T+6],z=I+O,V=j+O;let G=P,X=!1,ne=!1;e?G||(X=e.has(z),ne=e.has(V),G=!X&&!ne):(X=!0,ne=!0);const ce=G||ne;let ge=!1;(G||X)&&(ge=M(I,O,G));let de=!1;ce&&(de=M(j,O,G));const xe=ge||de;if(xe)for(let pe=0;pe<3;pe++){const ye=I+pe,Re=j+pe,we=m[ye],We=m[ye+3],ot=m[Re],ft=m[Re+3];m[T+pe]=we<ot?we:ot,m[T+pe+3]=We>ft?We:ft}return xe}}}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),o=new Uint16Array(n);(function a(c,d=0){const p=2*c,m=o[p+15]===Hx;if(m){const A=r[c+6],x=o[p+14];e(d,m,new Float32Array(n,4*c,6),A,x)}else{const A=c+8,x=r[c+6],E=r[c+7];e(d,m,new Float32Array(n,4*c,6),E)||(a(A,d+1),a(x,d+1))}})(0)}raycast(e,t=f.Wl3){const n=this._roots,r=this.geometry,o=[],a=t.isMaterial,c=Array.isArray(t),d=r.groups,p=a?t.side:t;for(let m=0,A=n.length;m<A;m++){const x=c?t[d[m].materialIndex].side:p,E=o.length;if(I_(n[m]),qx(0,r,x,e,o),zb(),c){const M=d[m].materialIndex;for(let T=E,O=o.length;T<O;T++)o[T].face.materialIndex=M}}return o}raycastFirst(e,t=f.Wl3){const n=this._roots,r=this.geometry,o=t.isMaterial,a=Array.isArray(t);let c=null;const d=r.groups,p=o?t.side:t;for(let m=0,A=n.length;m<A;m++){const x=a?t[d[m].materialIndex].side:p;I_(n[m]);const E=Yx(0,r,x,e);zb(),E!=null&&(c==null||E.distance<c.distance)&&(c=E,a&&(E.face.materialIndex=d[m].materialIndex))}return c}intersectsGeometry(e,t){const n=this.geometry;let r=!1;for(const o of this._roots)if(I_(o),r=qT(0,n,e,t),zb(),r)break;return r}shapecast(e,t,n){const r=this.geometry;if(e instanceof Function){if(t){const x=t;t=(E,M,T,O)=>{const P=3*M;return x(E,P,P+1,P+2,T,O)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const o=fh.getPrimitive();let{boundsTraverseOrder:a,intersectsBounds:c,intersectsRange:d,intersectsTriangle:p}=e;if(d&&p){const x=d;d=(E,M,T,O,P)=>!!x(E,M,T,O,P)||CS(E,M,r,p,T,O,o)}else d||(d=p?(x,E,M,T)=>CS(x,E,r,p,M,T,o):(x,E,M)=>M);let m=!1,A=0;for(const x of this._roots){if(I_(x),m=WT(0,r,c,d,a,A),zb(),m)break;A+=x.byteLength}return fh.releasePrimitive(o),m}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:o}=n;const a=this.geometry.index,c=this.geometry.attributes.position,d=e.geometry.index,p=e.geometry.attributes.position;Cv.copy(t).invert();const m=fh.getPrimitive(),A=fh.getPrimitive();if(o){let E=function(M,T,O,P,R,I,j,z){for(let V=O,G=O+P;V<G;V++){ph(A,3*V,d,p),A.a.applyMatrix4(t),A.b.applyMatrix4(t),A.c.applyMatrix4(t),A.needsUpdate=!0;for(let X=M,ne=M+T;X<ne;X++)if(ph(m,3*X,a,c),m.needsUpdate=!0,o(m,A,X,V,R,I,j,z))return!0}return!1};if(r){const M=r;r=function(T,O,P,R,I,j,z,V){return!!M(T,O,P,R,I,j,z,V)||E(T,O,P,R,I,j,z,V)}}else r=E}e.getBoundingBox(Zx),Zx.applyMatrix4(t);const x=this.shapecast({intersectsBounds:E=>Zx.intersectsBox(E),intersectsRange:(E,M,T,O,P,R)=>(Jx.copy(R),Jx.applyMatrix4(Cv),e.shapecast({intersectsBounds:I=>Jx.intersectsBox(I),intersectsRange:(I,j,z,V,G)=>r(E,M,I,j,O,P,V,G)}))});return fh.releasePrimitive(m),fh.releasePrimitive(A),x}intersectsBox(e,t){return gm.set(e.min,e.max,t),gm.needsUpdate=!0,this.shapecast({intersectsBounds:n=>gm.intersectsBox(n),intersectsTriangle:n=>gm.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),gm.set(e.boundingBox.min,e.boundingBox.max,t),gm.needsUpdate=!0;const c=this.geometry,d=c.attributes.position,p=c.index,m=e.attributes.position,A=e.index,x=fh.getPrimitive(),E=fh.getPrimitive();let M=Qb,T=YT,O=null,P=null;r&&(O=XT,P=KT);let R=1/0,I=null,j=null;return Cv.copy(t).invert(),D_.matrix.copy(Cv),this.shapecast({boundsTraverseOrder:z=>gm.distanceToBox(z),intersectsBounds:(z,V,G)=>G<R&&G<a&&(V&&(D_.min.copy(z.min),D_.max.copy(z.max),D_.needsUpdate=!0),!0),intersectsRange:(z,V)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:G=>D_.distanceToBox(G),intersectsBounds:(G,X,ne)=>ne<R&&ne<a,intersectsRange:(G,X)=>{for(let ne=3*G,ce=3*(G+X);ne<ce;ne+=3){ph(E,ne,A,m),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let ge=3*z,de=3*(z+V);ge<de;ge+=3){ph(x,ge,p,d),x.needsUpdate=!0;const xe=x.distanceToTriangle(E,M,O);if(xe<R&&(T.copy(M),P&&P.copy(O),R=xe,I=ge/3,j=ne/3),xe<o)return!0}}}});for(let G=0,X=A?A.count:m.count;G<X;G+=3){ph(E,G,A,m),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let ne=3*z,ce=3*(z+V);ne<ce;ne+=3){ph(x,ne,p,d),x.needsUpdate=!0;const ge=x.distanceToTriangle(E,M,O);if(ge<R&&(T.copy(M),P&&P.copy(O),R=ge,I=ne/3,j=G/3),ge<o)return!0}}}}),fh.releasePrimitive(x),fh.releasePrimitive(E),R===1/0?null:(n.point?n.point.copy(T):n.point=T.clone(),n.distance=R,n.faceIndex=I,r&&(r.point?r.point.copy(P):r.point=P.clone(),r.point.applyMatrix4(Cv),T.applyMatrix4(Cv),r.distance=T.sub(r.point).length(),r.faceIndex=j),n)}closestPointToPoint(e,t={},n=0,r=1/0){const o=n*n,a=r*r;let c=1/0,d=null;if(this.shapecast({boundsTraverseOrder:m=>(P_.copy(e).clamp(m.min,m.max),P_.distanceToSquared(e)),intersectsBounds:(m,A,x)=>x<c&&x<a,intersectsTriangle:(m,A)=>{m.closestPointToPoint(e,P_);const x=e.distanceToSquared(P_);return x<c&&(Qb.copy(P_),c=x,d=A),x<o}}),c===1/0)return null;const p=Math.sqrt(c);return t.point?t.point.copy(Qb):t.point=Qb.clone(),t.distance=p,t.faceIndex=d,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{hh(0,new Float32Array(t),MS),e.union(MS)}),e}}const TS=vo.prototype.raycast;vo.prototype.raycast=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,t,n,r]=s;return TS.call(this,n,e.material).forEach(o=>{(o=ES(o,e,t))&&r.push(o)}),r}return TS.apply(this,s)};const IS=vo.prototype.raycastFirst;vo.prototype.raycastFirst=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,t,n]=s;return ES(IS.call(this,n,e.material),e,t)}return IS.apply(this,s)};const DS=vo.prototype.closestPointToPoint;vo.prototype.closestPointToPoint=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),s.unshift();const e=s[1],t={};return s[1]=t,DS.apply(this,s),e&&e.copy(t.point),t.distance}return DS.apply(this,s)};const PS=vo.prototype.closestPointToGeometry;vo.prototype.closestPointToGeometry=function(...s){const e=s[2],t=s[3];if(e&&e.isVector3||t&&t.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const n={},r={},o=s[1];return s[2]=n,s[3]=r,PS.apply(this,s),e&&e.copy(n.point),t&&t.copy(r.point).applyMatrix4(o),n.distance}return PS.apply(this,s)};const RS=vo.prototype.refit;vo.prototype.refit=function(...s){const e=s[0],t=s[1];if(t&&(t instanceof Set||Array.isArray(t))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const n=new Set;t.forEach(r=>n.add(r)),e&&e.forEach(r=>n.add(r)),RS.call(this,n)}else RS.apply(this,s)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(s=>{const e=vo.prototype[s];vo.prototype[s]=function(...t){return(t[0]===null||t[0].isMesh)&&(t.shift(),console.warn(`MeshBVH: The function signature for "${s}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,t)}});const $x=[new f.Pa4,new f.Pa4,new f.Pa4];function e1(s){return~~(1e4*s)}function BS(s){return`${e1(s.x)},${e1(s.y)},${e1(s.z)}`}class JT{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,r=e.index,o=n.position;let a=r?r.count/3:o.count/3;const c=a;let d=0;this.useDrawRange&&(d=e.drawRange.start,e.drawRange.count!==1/0&&(a=~~(e.drawRange.count/3)));let p=this.data;(!p||p.length<3*c)&&(p=new Int32Array(3*c)),p.fill(-1);let m=0,A=0;for(let x=0;x<a;x++){const E=3*x+d;for(let M=0;M<3;M++){let T=E+M;r&&(T=r.getX(T)),$x[M].fromBufferAttribute(o,T)}for(let M=0;M<3;M++){const T=(M+1)%3,O=$x[M],P=$x[T],R=BS(O),I=BS(P),j=`${I}_${R}`;if(t.has(j)){const z=t.get(j);p[E+M]=z,p[z]=E+M,t.delete(j),m--,A++}else{const z=`${R}_${I}`;t.set(z,E+M),m++}}}this.matchedEdges=A,this.unmatchedEdges=m,this.data=p}}class Vb extends f.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new f.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,r=t.elements;for(let o=0;o<16;o++)if(n[o]!==r[o])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(hS())for(const n in t){const r=t[n];if(r.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");r.array=UT(r.array)}if(e.boundsTree||(e.boundsTree=new vo(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new JT(e)),!e.groupIndices){const n=e.index.count/3,r=new Uint16Array(n),o=e.groups;for(let a=0,c=o.length;a<c;a++){const{start:d,count:p}=o[a];for(let m=d/3,A=(d+p)/3;m<A;m++)r[m]=a}e.groupIndices=r}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function kS(s,e){let t=e;return Array.isArray(e)||(t=[],s.forEach(n=>{t[n.materialIndex]=e})),t}class ZT{constructor(){this.triangleSplitter=new NT,this.attributeData=new FT,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new zT}evaluate(e,t,n,r=new Vb){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:o,attributeData:a,attributes:c,useGroups:d,debug:p}=this,m=r.geometry,A=e.geometry.attributes;for(let P=0,R=c.length;P<R;P++){const I=c[P],j=A[I];a.initializeArray(I,j.array.constructor)}for(const P in a.attributes)c.includes(P)||a.delete(P);for(const P in m.attributes)c.includes(P)||(m.deleteAttribute(P),m.dispose());a.clear(),p.enabled&&(p.reset(),sS(p)),function(P,R,I,j,z,V){const{useGroups:G=!0}=V,{aIntersections:X,bIntersections:ne}=function(ge,de){const xe=new eS,pe=new eS;return tS.copy(ge.matrixWorld).invert().multiply(de.matrixWorld),ge.geometry.boundsTree.bvhcast(de.geometry.boundsTree,tS,{intersectsTriangles:(ye,Re,we,We)=>(ye.intersectsTriangle(Re,jx)&&jx.distance()>1e-5&&(xe.add(we,We),pe.add(We,we),Tb&&(Tb.addEdge(jx),Tb.addIntersectingTriangles(we,ye,We,Re))),!1)}),{aIntersections:xe,bIntersections:pe}}(P,R);let ce;ce=G?0:-1,mS(P,R,X,I,!1,z,ce),fS(P,R,X,I,!1,j,z,ce),ce=G?P.geometry.groups.length||1:-1,mS(R,P,ne,I,!0,z,ce),fS(R,P,ne,I,!0,j,z,ce)}(e,t,n,o,a,{useGroups:d}),p.enabled&&sS(null);const x=d&&e.geometry.groups.length!==0?e.geometry.groups.map(P=>({...P})):[{start:0,count:1/0,materialIndex:0}],E=d&&t.geometry.groups.length!==0?t.geometry.groups.map(P=>({...P})):[{start:0,count:1/0,materialIndex:0}],M=kS(x,e.material),T=kS(E,t.material);E.forEach(P=>{P.materialIndex+=M.length}),function(P,R,I,j){let z=!1,V=-1;const G=j.groupCount,X=P.attributes,ne=j.groupAttributes[0];for(const ge in ne){const de=j.getTotalLength(ge,G),xe=ne[ge].type;let pe=X[ge];if(!pe||pe.array.length<de){const Re=R.attributes[ge];pe=new f.TlE(new xe(de),Re.itemSize,Re.normalized),P.setAttribute(ge,pe),z=!0}let ye=0;for(let Re=0;Re<G;Re++){const{array:we,type:We,length:ot}=j.groupAttributes[Re][ge],ft=new We(we.buffer,0,ot);pe.array.set(ft,ye),ye+=ft.length}pe.needsUpdate=!0,V=de/pe.itemSize}P.setDrawRange(0,V),P.clearGroups();let ce=0;for(let ge=0;ge<G;ge++){const de=j.getGroupArray("position",ge).length/3;if(de!==0){const xe=I[ge];P.addGroup(ce,de,xe.materialIndex),ce+=de}}if(P.index){const ge=P.index.array;if(ge.length<V)P.index=null,z=!0;else for(let de=0,xe=ge.length;de<xe;de++)ge[de]=de}P.boundsTree=null,z&&P.dispose()}(m,e.geometry,[...x,...E],a);const O=m.groups;if(d){const P=new Map,R=[...M,...T];let I=0;for(let j=0,z=R.length;j<z;j++)Boolean(O.find(V=>V.materialIndex===j))?(P.set(j,I),I++):R[j]=null;for(let j=0,z=O.length;j<z;j++){const V=O[j];V.materialIndex=P.get(V.materialIndex)}r.material=R.filter(j=>j)}return r}evaluateHierarchy(e,t=new Vb){e.updateMatrixWorld(!0);const n=(o,a)=>{const c=o.children;for(let d=0,p=c.length;d<p;d++){const m=c[d];m.isOperationGroup?n(m,a):a(m)}},r=o=>{const a=o.children;let c=!1;for(let p=0,m=a.length;p<m;p++){const A=a[p];c=r(A)||c}const d=o.isDirty();if(d&&o.markUpdated(),c&&!o.isOperationGroup){let p;return n(o,m=>{p=p?this.evaluate(p,m,m.operation):this.evaluate(o,m,m.operation)}),o._cachedGeometry=p.geometry,o._cachedMaterials=p.material,!0}return c||d};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const OS={union:0,subtract:1,intersect:4,difference:3};function LS(s,e){const t=new ZT;t.useGroups=!0,t.attributes=["position","normal","uv"],s.forEach(o=>{for(const a of[...t.attributes])o[0].geometry.getAttribute(a)||t.attributes.splice(t.attributes.indexOf(a),1)});let n=new Vb(new f._12(.01,.01,2,2));s.forEach(([o,a])=>{if(!Object.keys(OS).includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const c=new Vb;c.geometry=o.geometry,c.material=o.material,o.matrixWorld.decompose(c.position,c.quaternion,c.scale),c.updateMatrix(),c.updateMatrixWorld(),n=t.evaluate(n,c,OS[a])});const r=n;return r.userData._isCSGMesh=!0,r}let Gb=class extends id{_buildCSGMesh(s){return LS(s)}};Gb.PluginType="CSGPluginBVH",Gb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([ci("CSG Plugin (BVH)")],Gb);var NS=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const $T=new f.Pa4(0,0,1),US=new f.USm,eI=new f._fP,tI=new f._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Sv=new f._fP,nI={type:"change"};let R_=class extends ct{constructor(s){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new f._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new f._fP,this._initQuaternionInvert=new f._fP,this._initQuaternionDest=new f._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=s,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(s=>{s=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(s=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",s)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new f._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const s=this.deviceOrientation;if(s){const e=s.alpha!==null?f.M8C.degToRad(s.alpha):0,t=s.beta!==null?f.M8C.degToRad(s.beta):0,n=s.gamma!==null?f.M8C.degToRad(s.gamma):0,r=this.screenOrientation?f.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(nI))}}dispose(){this.disconnect()}setObjectQuaternion(s,e,t,n){const r=ui()/1e3;US.set(e,s,-t,"YXZ"),Sv.setFromEuler(US),Sv.multiply(tI),Sv.multiply(eI.setFromAxisAngle($T,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(Sv).invert(),this._initQuaternionDest.__init=!0),Sv.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(Sv,this.dampingFactor/(Math.min(1,r-this._lastTime)/(1/60))),this._lastTime=r}};NS([Ne(),An("Damping",[0,1],.01)],R_.prototype,"dampingFactor",void 0),R_=NS([ci("Device Orientation Controls")],R_);class t1 extends Zn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,r,o;(n=(t=e.lastCamera)===null||t===void 0?void 0:t.removeControlsCtor)===null||n===void 0||n.call(t,this.controlsKey),(o=(r=e.camera)===null||r===void 0?void 0:r.setControlsCtor)===null||o===void 0||o.call(r,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class n1 extends t1{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new R_(e)}}n1.PluginType="DeviceOrientationControlsPlugin";var qo=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const FS=new f.Pa4,i1=new f.$V,r1=new f.Pa4,iI={type:"change"};let js=class extends ct{constructor(s,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new f.Pa4,this._lastTime=-1,this.object=s,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const s=this.object.quaternion;FS.set(0,0,-1).applyQuaternion(s),i1.setFromVector3(FS),this.lat=90-f.M8C.radToDeg(i1.phi),this.lon=f.M8C.radToDeg(i1.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(s){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(s.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(s){if(this.activeLook)switch(s.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(s){this.domElement===document?(this.mouseX=s.pageX-this.viewHalfX,this.mouseY=s.pageY-this.viewHalfY):(this.mouseX=s.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=s.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(s,e,t){return s.isVector3?r1.copy(s):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):r1.set(s,e,t),this.object.lookAt(r1),this.setOrientation(),this}update(){const s=ui(),e=(this._lastTime<0?16:Math.min(s-this._lastTime,1e3))/1e3;if(this._lastTime=s,!this.enabled)return;if(this.heightSpeed){const d=f.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(d*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*r),this.lat=Math.max(-85,Math.min(85,this.lat));let o=f.M8C.degToRad(90-this.lat);const a=f.M8C.degToRad(this.lon);this.constrainVertical&&(o=f.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const c=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,a).add(c),this.object.lookAt(this.targetPosition),this.dispatchEvent(iI)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(s){this.enableKeys&&s.preventDefault()}};qo([Ne(),gn()],js.prototype,"enabled",void 0),qo([Ne(),gn()],js.prototype,"enableKeys",void 0),qo([Ne(),li()],js.prototype,"movementSpeed",void 0),qo([Ne(),li()],js.prototype,"lookSpeed",void 0),qo([Ne(),gn()],js.prototype,"lookVertical",void 0),qo([Ne(),gn()],js.prototype,"autoForward",void 0),qo([Ne(),gn()],js.prototype,"activeLook",void 0),qo([Ne(),gn()],js.prototype,"heightSpeed",void 0),qo([Ne(),li()],js.prototype,"heightCoef",void 0),qo([Ne(),li()],js.prototype,"heightMin",void 0),qo([Ne(),li()],js.prototype,"heightMax",void 0),qo([Ne(),gn()],js.prototype,"constrainVertical",void 0),qo([Ne(),li()],js.prototype,"verticalMin",void 0),qo([Ne(),li()],js.prototype,"verticalMax",void 0),qo([Ne(),gn()],js.prototype,"mouseDragOn",void 0),js=qo([ci("First Person Controls")],js);class s1 extends t1{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new js(e,t)}}s1.PluginType="FirstPersonControlsPlugin";var Mv=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Tv=new f.USm(0,0,0,"YXZ"),Iv=new f.Pa4,rI={type:"change"},sI={type:"lock"},oI={type:"unlock"},jS=Math.PI/2;let od=class extends ct{constructor(s,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new f.Pa4(0,0,-1),this.domElement=e,this.object=s,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(s){this.isLocked||this.autoLockOnClick&&(s.preventDefault(),this.lock())}onMouseMove(s){this.isLocked&&(this._movementX+=s.movementX||s.mozMovementX||s.webkitMovementX||0,this._movementY+=s.movementY||s.mozMovementY||s.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(sI),this.isLocked=!0):(this.dispatchEvent(oI),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(s){return s.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(s){Iv.setFromMatrixColumn(this.object.matrix,0),Iv.crossVectors(this.object.up,Iv),this.object.position.addScaledVector(Iv,s)}moveRight(s){Iv.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(Iv,s)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Tv.setFromQuaternion(this.object.quaternion),Tv.y-=.002*this._movementX*this.pointerSpeed,Tv.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,Tv.x=Math.max(jS-this.maxPolarAngle,Math.min(jS-this.minPolarAngle,Tv.x)),this.object.quaternion.setFromEuler(Tv),this.dispatchEvent(rI)}};Mv([gn(),Ne()],od.prototype,"enabled",void 0),Mv([li(),Ne()],od.prototype,"minPolarAngle",void 0),Mv([li(),Ne()],od.prototype,"maxPolarAngle",void 0),Mv([li(),Ne()],od.prototype,"pointerSpeed",void 0),Mv([gn(),Ne()],od.prototype,"autoLockOnClick",void 0),od=Mv([ci("Pointer Lock Controls")],od);class o1 extends t1{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new od(e,t.ownerDocument?t:t.documentElement)}}o1.PluginType="PointerLockControlsPlugin";var aI=__webpackgi_require__(819);class cc{static _initialize(){this._inited=!0,Bl(Z`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const r=Ji({id:"customContextMenu",addToBody:!1});r.style.top=n+"px",r.style.left=t+"px";for(const[o,a]of Object.entries(e)){const c=Ji({classList:["customContextMenuItems"],addToBody:!1,innerHTML:o});r.appendChild(c),c.onclick=a}return this.Element=r,r}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}cc.Element=void 0,cc._inited=!1;var lI=__webpackgi_require__(665);const cI=(s,e,t)=>{var n,r,o;const a=s.controller_,c=(r=(n=a.parent)===null||n===void 0?void 0:n.children)===null||r===void 0?void 0:r.indexOf(a);return!(((p,m)=>m.controller_.rackController.rack===p.controller_.parent)(s,e)&&c===t||(c!==void 0&&c>=0&&((o=a.parent)===null||o===void 0||o.remove(s)),e.add(s,t),0))},uI=(s,e,t,n)=>{var r,o,a,c,d;let p=e.uiRef;const m=p==null?void 0:p.expanded;if(p||(p=s.addFolder({title:""}),p.on("fold",O=>{var P,R,I;let j=p.expanded;Te(e,"expanded",j,!0),j=(P=ke(e.expanded))!==null&&P!==void 0?P:j,j!==p.expanded&&(p.expanded=j),(R=e.uiRefresh)===null||R===void 0||R.call(e,"postFrame",!0),j&&((I=e.onExpand)===null||I===void 0||I.call(e,e))})),!p)return p;p.expanded=(o=(r=ke(e.expanded))!==null&&r!==void 0?r:m)!==null&&o!==void 0&&o;const A=((a=e.children)!==null&&a!==void 0?a:[]).map(O=>O&&ke(O)).flat(2).filter(O=>O);let x=0;for(const O of A){let P=O.uiRef;P&&P.controller_.viewProps.get("disposed")&&(O.uiRef=void 0),P=O.uiRef,P||(t.appendUiObject({uiConfig:O},p),P=O.uiRef),P&&cI(P,p,x++)&&t.appendUiObject({uiConfig:O},p)}let E=p.children;for(;E.length>x;){const O=E[E.length-1];p.remove(O),E=p.children}p.controller_.props.set("title",(c=ke(e.label))!==null&&c!==void 0?c:"");const M=p.controller_.view.containerElement,T=ke(e.domChildren,[]);if((T==null?void 0:T.length)!==void 0){const O=[];for(let P=0;P<M.children.length;P++){const R=M.children[P];!((d=R.dataset)===null||d===void 0)&&d.tpCustomDOM&&O.push(R)}for(const P of O)M.removeChild(P);for(const P of T)P.parentElement!==M&&(M.appendChild(P),P.dataset.tpCustomDOM="true");p.controller_.foldable.cleanUpTransition()}return p},hI=(s,e,t,n)=>{var r,o;const[a,c]=(r=e.property)!==null&&r!==void 0?r:[void 0,void 0],d=(o=ke(e.label))!==null&&o!==void 0?o:c;let p=e.uiRef;return p||(p=s.addButton({title:""}),p.on("click",async()=>{var m;const A=[];e.prompt&&A.push(await t.prompt(...e.prompt));const x=(m=a&&c?a[c]:void 0)!==null&&m!==void 0?m:e.value;if(typeof x=="function"){const E=()=>{t.removeEventListener("postFrame",E),x(...A)};t.addEventListener("postFrame",E)}else console.warn("Invalid action type for button")})),p&&(p.title=d??"click me"),p},dI=(s,e,t,n)=>{var r;const o=Object.fromEntries(((r=ke(e.children))!==null&&r!==void 0?r:[]).map(a=>ke(a)).flat(2).filter(a=>a).map(a=>{var c;const d=ke(a.label);return[d,(c=a.value)!==null&&c!==void 0?c:d]}));return mh(s,e,t,{options:o,...n??{}})},pI=(s,e,t,n)=>{var r,o;const a=ke(e.bounds),c=((r=a==null?void 0:a.length)!==null&&r!==void 0?r:0)>=2?a[1]:1,d=((o=a==null?void 0:a.length)!==null&&o!==void 0?o:0)>=1?a[0]:0,p=e.stepSize||void 0;return mh(s,e,t,{min:d,max:c,step:p,...n??{}})},Hb=(s,e,t,n)=>{var r,o,a;const c=ke(e.bounds);if(!c||c.length<1)return mh(s,e,t,{...n??{}});const d=((r=c.length)!==null&&r!==void 0?r:0)>=2?c[1]:1,p=((o=c.length)!==null&&o!==void 0?o:0)>=1?c[0]:0,m={min:p,max:d,step:(a=e.stepSize)!==null&&a!==void 0?a:(d-p)/100},A={x:m,y:m};e.type!=="vec3"&&e.type!=="vec4"||(A.z=m),e.type==="vec4"&&(A.w=m);const x=e.property;if(e.value===void 0&&x&&x[0]&&typeof x[0]=="object"&&x[0][x[1]]&&Array.isArray(x[0][x[1]])){const[E,M]=x,T=E[M],O=T.length,P=new(O===2?f.FM8:O===3?f.Pa4:f.Ltg)().fromArray(T);e.value=P,e.property=void 0,e.onChange=[()=>{E[M]=P.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(R=>R),e.label===void 0&&(e.label=M)}return mh(s,e,t,{...A,...n??{}})},fI=(s,e,t,n)=>{var r;const o=e.property;if(e.value===void 0&&o&&typeof o[0]=="object"&&(!((r=o[0][o[1]])===null||r===void 0)&&r.isColor)){const[a,c]=o,d=new Pi().set(a[c]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const p=a[c];return p?d.set(p).convertLinearToSRGB().getHex():0},set:p=>{const m=a[c];d.setHex(p).convertSRGBToLinear(),m.isColor?m.copy(d):typeof m=="number"?a[c]=d.getHex():typeof m=="string"&&(a[c]="#"+d.getHexString()),typeof(a==null?void 0:a.setDirty)=="function"&&a.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(p=>p),e.label===void 0&&(e.label=c)}return(n=n??{}).view="color",ke(e.inlinePicker)&&(n.picker="inline"),mh(s,e,t,n)},mh=(s,e,t,n)=>{var r;let o=ke(e.property);if((e.getValue||e.setValue)&&o&&console.error("specify either property or value, or getValue and setValue",e),o)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var d;return(d=e.getValue)===null||d===void 0?void 0:d.call(e)},set:d=>{var p;return(p=e.setValue)===null||p===void 0?void 0:p.call(e,d)}}),o=[e,"value"]),o||e.value===void 0||(o=[e,"value"]),!o)return void console.error("cannot determine property",e);n=n??{};const a={label:(r=ke(e.label))!==null&&r!==void 0?r:o[1],...n};let c=e.uiRef;if(!c&&typeof o[0]=="object"&&o[0]){const[d,p]=o;try{c=e.isMonitor?s.addMonitor(d,p,a):s.addInput(d,p,a).on("change",m=>{[e.onChange].flat().forEach(A=>typeof A=="function"&&(A==null?void 0:A(m))),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty(m)})}catch(m){if(!m.message.startsWith("No matching controller for"))throw m;c=void 0}}if(c){for(const[d,p]of Object.entries(a)){const m=c.controller_.props.value(d);m!==void 0&&m.rawValue!==p&&c.controller_.props.set(d,p)}e.type==="slider"&&(a.min!==void 0&&c.controller_.valueController.sliderController.props.set("minValue",a.min),a.max!==void 0&&c.controller_.valueController.sliderController.props.set("maxValue",a.max)),c.refresh()}return c};class zS extends ct{constructor(e=!1,t=!1,n=!1,r=!0,o=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={folder:uI,input:mh,slider:pI,dropdown:dI,checkbox:mh,color:fI,vec:Hb,vec2:Hb,vec3:Hb,vec4:Hb,button:hI,monitor:(c,d,p,m)=>(d.isMonitor=!0,mh(c,d,p,m)),dummy:(c,d,p,m)=>mh(c,d,p,m)},this.alert=async c=>alert(c),this.confirm=async c=>confirm(c),this.prompt=async(c,d,p=!0)=>prompt(c,d),this._expand=e,this._limitedOptions=n;const a=this._createUiContainer();o.appendChild(a),this._pane=new lI.Pane({title:"Configuration",container:a}),this._pane.expanded=this._expand,r&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],r=ui(),o=r-this._lastModeTime[e];t.forEach(a=>{a[2]>.001?(a[2]-=o,n.push(a)):this._refreshUiObject(a[0],a[1],a[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=r}addToRefreshQueue(e,t){var n;const r=(n=t[0])===null||n===void 0?void 0:n.uiConfig,o=r==null?void 0:r.uuid,a=this._refreshQueue[e],c=a.find(d=>d[3]===o);c?c[2]=Math.max(c[2],t[2]):a.push([...t,o]),this._refreshQueue[e]=a}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var n,r,o,a;const{uiConfig:c}=e??{};if(c&&(!this._limitedOptions||c.limitedUi)&&(t=t??this._pane,c.type)){c.uuid||(c.uuid=gs()),c.uiRef&&c.uiRefType!==c.type&&(console.log("Removing UI object because of type mismatch",c.uiRef),this.removeUiConfig(c));const d=(r=(n=this._typeGenerators)[c.type])===null||r===void 0?void 0:r.call(n,t,c,this);d&&(d.hidden=(o=ke(c.hidden))!==null&&o!==void 0&&o,d.disabled=(a=ke(c.disabled))!==null&&a!==void 0&&a),c.uiRef=d,c.uiRefType=d?c.type:void 0,c.uiRefresh=(p="postFrame",m=!1,A=0)=>{var x;return this._uiObjectRefresh(p,(x=e==null?void 0:e.uiConfig)!==null&&x!==void 0?x:c,t,m,A)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)===null||n===void 0||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,r,o){(r?a1(t,n):[{uiConfig:t,parentFolder:n}]).forEach(a=>{const c=[{uiConfig:a.uiConfig},a.parentFolder,o];e==="immediate"?this._refreshUiObject(...c):this.addToRefreshQueue(e,c)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=Ji({id:"tweakpaneUiContainer",addToBody:!1});return Bl(Z`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function a1(s,e,t){var n;return t=t??[],s&&(t.push({uiConfig:s,parentFolder:e}),(n=s.children)===null||n===void 0||n.forEach(r=>t=a1(r,s.uiRef,t))),t}class l1{constructor(){l1.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,o,a,c,d,p){const m=this.elements;return m[0]=e,m[1]=r,m[2]=c,m[3]=t,m[4]=o,m[5]=d,m[6]=n,m[7]=a,m[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,o=this.elements,a=n[0],c=n[3],d=n[6],p=n[1],m=n[4],A=n[7],x=n[2],E=n[5],M=n[8],T=r[0],O=r[3],P=r[6],R=r[1],I=r[4],j=r[7],z=r[2],V=r[5],G=r[8];return o[0]=a*T+c*R+d*z,o[3]=a*O+c*I+d*V,o[6]=a*P+c*j+d*G,o[1]=p*T+m*R+A*z,o[4]=p*O+m*I+A*V,o[7]=p*P+m*j+A*G,o[2]=x*T+E*R+M*z,o[5]=x*O+E*I+M*V,o[8]=x*P+E*j+M*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],c=e[5],d=e[6],p=e[7],m=e[8];return t*a*m-t*c*p-n*o*m+n*c*d+r*o*p-r*a*d}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],c=e[5],d=e[6],p=e[7],m=e[8],A=m*a-c*p,x=c*d-m*o,E=p*o-a*d,M=t*A+n*x+r*E;if(M===0)return this.set(0,0,0,0,0,0,0,0,0);const T=1/M;return e[0]=A*T,e[1]=(r*p-m*n)*T,e[2]=(c*n-r*a)*T,e[3]=x*T,e[4]=(m*t-r*d)*T,e[5]=(r*o-c*t)*T,e[6]=E*T,e[7]=(n*d-p*t)*T,e[8]=(a*t-n*o)*T,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,o,a,c){const d=Math.cos(o),p=Math.sin(o);return this.set(n*d,n*p,-n*(d*a+p*c)+a+e,-r*p,r*d,-r*(-p*a+d*c)+c+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,o=r[0],a=r[3],c=r[6],d=r[1],p=r[4],m=r[7];return r[0]=t*o+n*d,r[3]=t*a+n*p,r[6]=t*c+n*m,r[1]=-n*o+t*d,r[4]=-n*a+t*p,r[7]=-n*c+t*m,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function QS(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}let Dv;class mI{constructor(e=null){this.isSource=!0,this.uuid=ar(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let a=0,c=r.length;a<c;a++)r[a].isDataTexture?o.push(c1(r[a].image)):o.push(c1(r[a]))}else o=c1(r);n.url=o}return t||(e.images[this.uuid]=n),n}}function c1(s){if(typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap)return class{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Dv===void 0&&(Dv=QS("canvas")),Dv.width=e.width,Dv.height=e.height;const r=Dv.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=Dv}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=QS("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0;a<o.length;a++)o[a]=255*Ki(o[a]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*Ki(t[n]/255)):t[n]=Ki(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(s);if(s.data){let e=[];try{e=Array.from(s.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=s.data}return{data:e,width:s.width,height:s.height,type:s.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let gI=0;class Pv extends class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}}{constructor(e=Pv.DEFAULT_IMAGE,t=Pv.DEFAULT_MAPPING,n=1001,r=1001,o=Qi,a=1008,c=1023,d=1009,p=1,m=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gI++}),this.uuid=ar(),this.name="",this.source=new mI(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=p,this.format=c,this.internalFormat=null,this.type=d,this.offset=new qt(0,0),this.repeat=new qt(1,1),this.center=new qt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new l1,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=m,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Pv.DEFAULT_IMAGE=null,Pv.DEFAULT_MAPPING=300;var Wb=__webpackgi_require__(898),B_={};Wb.Z&&Wb.Z.locals&&(B_.locals=Wb.Z.locals);var u1,h1=0,vm={};vm.styleTagTransform=j0(),vm.setAttributes=F0(),vm.insert=function(s,e){(e.target||document.head).appendChild(s)},vm.domAPI=Tg(),vm.insertStyleElement=Bf(),B_.use=function(s){return vm.options=s||{},h1++||(u1=U0()(Wb.Z,vm)),B_},B_.unuse=function(){h1>0&&!--h1&&(u1(),u1=null)};var vI=B_;class d1 extends zS{constructor(e=!1,t=!1,n=!1,r=document.body){super(e,t,n,!1),this.dependencies=[ln],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=o=>{this.dispatchEvent(o),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async o=>this._viewer?this._viewer.alert(o):super.alert(o),this.confirm=async o=>this._viewer?this._viewer.confirm(o):super.confirm(o),this.prompt=async(o,a,c=!0)=>this._viewer?this._viewer.prompt(o,a,c):super.prompt(o,a,c),this._pane.registerPlugin(aI),vI.use({target:r})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,r,o,a)=>{const c=r.property,d="placeholder";if(r.value===void 0&&c&&typeof c[0]=="object"){const[p,m]=c,A=p_("Render Target"),x=p_("Data Texture"),E=p_("CUBE Texture"),M=p_("Compressed Texture"),T={},O={};Object.defineProperty(r,"value",{get:()=>{var P;let R,I=p[m];if(I!=null&&I.get&&(I=I.get()),!I)return d;if(I.isRenderTargetTexture&&!I.image.tp_src&&(I.image.tp_src=A),I.isDataTexture&&!I.image.tp_src&&(I.image.tp_src=x),I.isCompressedTexture&&!I.image.tp_src&&(I.image.tp_src=M),I.isTexture?(I.image&&(I.image instanceof ImageBitmap||I.image instanceof HTMLImageElement||I.image instanceof HTMLVideoElement)&&!I.image.tp_src&&(I.image.tp_src=gc(I.image,160)),I.image&&(R=I.image.tp_src_uuid,R=R?T[R]:void 0,R||(R=I.image.tp_src||I.image.src))):typeof I=="string"?R=I:I.domainMin?(R=I.texture,I.texture.image&&!I.texture.image.tp_src&&(I.texture.image.tp_src=E),I.texture.image&&(R=I.texture.image.tp_src_uuid,R=R?T[R]:void 0,R||(R=I.texture.image.tp_src||I.texture.image.src))):I&&console.error("unknown value",I),R||(R=d),I.image&&!I.image.tp_src_uuid){const j=gs();I.image.tp_src_uuid=j,O[R]=j}return typeof R=="string"&&(R=(P=T[R])!==null&&P!==void 0?P:R),R},set:P=>{var R,I,j,z,V,G,X,ne,ce,ge,de;const xe=p[m],pe=Re=>{var we;p[m]=Re,Re!=null&&Re.isTexture&&(Re.flipY=Re.isDataTexture?Re.flipY:(we=xe==null?void 0:xe.flipY)===null||we===void 0||we)};if(typeof P=="string")return void(typeof xe=="string"&&pe(P));if(!P)return void(r.value=d);if(P.isPlaceholder)return void(xe&&(pe(typeof xe=="string"?"":null),typeof(p==null?void 0:p.setDirty)=="function"&&p.setDirty()));let ye=P.tp_src_uuid;if(ye||(ye=(R=P.src)!==null&&R!==void 0?R:P.tp_src,ye=(I=O[ye])!==null&&I!==void 0?I:ye,delete O[ye],P.tp_src_uuid=ye),ye&&(T[ye]=P),typeof xe!="string"){if(!((xe==null?void 0:xe.image)===P||((j=xe==null?void 0:xe.image)===null||j===void 0?void 0:j.src)===P.src||((z=xe==null?void 0:xe.image)===null||z===void 0?void 0:z.tp_src)===P.tp_src&&P.tp_src!=null||((V=xe==null?void 0:xe.image)===null||V===void 0?void 0:V.tp_src)===P.src&&P.src!=null||((G=xe==null?void 0:xe.image)===null||G===void 0?void 0:G.src)===P.tp_src&&P.tp_src!=null))if(P instanceof File){const Re=t==null?void 0:t.getPlugin(ln);if(!Re)throw"Viewer or AssetManagerPlugin not found";(X=Re.importer)===null||X===void 0||X.importSingle({file:P,path:P.src}).then(we=>{var We,ot,ft,nt;if(we){we.isDataTexture&&(we.needsUpdate=!0);const Rt=(ft=(ot=(We=P.src)===null||We===void 0?void 0:We.split("?"))===null||ot===void 0?void 0:ot[0])===null||ft===void 0?void 0:ft.split(".").pop();we.userData&&(we.userData.mimeType||(we.userData.mimeType="image/"+(["jpg","jpeg"].includes(Rt)?"jpeg":"png"))),pe(we),[r.onChange].flat().forEach(Nt=>typeof Nt=="function"&&(Nt==null?void 0:Nt())),typeof(p==null?void 0:p.setDirty)=="function"&&p.setDirty(),(nt=r.uiRefresh)===null||nt===void 0||nt.call(r,"postFrame",!1)}})}else{const Re=new Pv(P);Re.assetType="texture",Re.needsUpdate=!0;const we=(ge=(ce=(ne=P.src)===null||ne===void 0?void 0:ne.split("?"))===null||ce===void 0?void 0:ce[0])===null||ge===void 0?void 0:ge.split(".").pop();Re.userData.mimeType||(Re.userData.mimeType="image/"+(["jpg","jpeg"].includes(we)?"jpeg":"png")),pe(Re);const We=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(m);Re.encoding=We?f.rnI:f.knz,Re.wrapS=f.rpg,Re.wrapT=f.rpg,[r.onChange].flat().forEach(ot=>typeof ot=="function"&&(ot==null?void 0:ot())),typeof(p==null?void 0:p.setDirty)=="function"&&p.setDirty(),(de=r.uiRefresh)===null||de===void 0||de.call(r,"postFrame",!1)}}else pe(ye)}}),r.property=void 0,r.label===void 0&&(r.label=m)}return(a=a??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],a.imageFit===void 0&&(a.imageFit="contain"),a.clickCallback===void 0&&(a.clickCallback=(p,m)=>{var A;const x=p==null?void 0:p.target,E=x==null?void 0:x.getBoundingClientRect();if(!E)return void m.click();const M=r.uiRef.controller_.valueController.value.rawValue,T=M===d||M!=null&&M.isPlaceholder?{}:{"remove image":()=>{var P;r.uiRef.controller_.valueController.value.setRawValue("");const[R,I]=c||[r,"value"],j=typeof R[I]=="string";R[I]=j?"":null,[r.onChange].flat().forEach(z=>typeof z=="function"&&(z==null?void 0:z())),typeof(R==null?void 0:R.setDirty)=="function"&&R.setDirty(),(P=r.uiRefresh)===null||P===void 0||P.call(r,"postFrame",!1),cc.Remove()},"download image":()=>{var P,R,I;const[j,z]=c||[r,"value"];let V=(R=(P=j[z])===null||P===void 0?void 0:P.image)!==null&&R!==void 0?R:r.uiRef.controller_.valueController.value.rawValue;V&&(V instanceof ImageBitmap||V instanceof HTMLImageElement||V instanceof HTMLVideoElement)&&!V.src&&(V=gc(V));const G=document.createElement("a");document.body.appendChild(G),G.style.display="none",G.href=(I=V==null?void 0:V.src)!==null&&I!==void 0?I:V,G.download="image.png",G.click(),document.body.removeChild(G),cc.Remove()}},O=cc.Create({...T,"set/replace image":()=>{m.click(),cc.Remove()},"from url":async()=>{var P,R;let I="";if(I&&(I.startsWith("http")||I.startsWith("data:image"))||(I=""),I=await o.prompt("Load texture: Enter Image/Texture URL",I,!0),!I||!I.startsWith("http")&&!I.startsWith("data:image"))return I!==null&&await o.alert("Loading Image: Invalid URL"),void cc.Remove();const[j,z]=c||[r,"value"],V=j[z];if(typeof V=="string")j[z]=I,[r.onChange].flat().forEach(G=>typeof G=="function"&&(G==null?void 0:G())),typeof(j==null?void 0:j.setDirty)=="function"&&j.setDirty(),(P=r.uiRefresh)===null||P===void 0||P.call(r,"postFrame",!1);else{const G=t==null?void 0:t.getPlugin(ln);if(!G)throw"Viewer or AssetManagerPlugin not found";(R=G.importer)===null||R===void 0||R.importSinglePath(I).then(X=>{var ne;if(X){X.isDataTexture?X.needsUpdate=!0:X&&(V==null?void 0:V.flipY)!==void 0&&(X.flipY=V.flipY),j[z]=X;const ce=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(z);X.encoding=ce?f.rnI:f.knz,[r.onChange].flat().forEach(ge=>typeof ge=="function"&&(ge==null?void 0:ge())),typeof(j==null?void 0:j.setDirty)=="function"&&j.setDirty(),(ne=r.uiRefresh)===null||ne===void 0||ne.call(r,"postFrame",!1)}})}cc.Remove()},cancel:()=>{cc.Remove()}},2,E.height+8);(A=x.parentElement)===null||A===void 0||A.appendChild(O),E.y>.7*document.body.clientHeight&&(O.style.top="auto",O.style.bottom=E.height+8+"px")}),a.view="input-image",mh(n,r,o,a)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var t;const n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(e);if(!n)return void console.warn("plugin not found:",e);this._plugins.push(n),n.uiConfig&&(n.uiConfig.limitedUi=!0),n.uiConfig&&n.uiConfig.hidden===void 0&&(n.uiConfig.hidden=!1),this._appendUiObject(n);const r=n.uiConfig;if(r!=null&&r.uiRef&&n.toJSON){const o=r.uiRef.controller_.view.element,a=Ji({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});a.onclick=c=>{const d={};typeof n.toJSON=="function"&&(d["download preset"]=async()=>{var m,A;const x=(A=(m=this._viewer)===null||m===void 0?void 0:m.getPlugin(ln))===null||A===void 0?void 0:A.exportPluginPreset(n);await Jr(new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),"preset."+n.constructor.PluginType+".json"),cc.Remove()}),typeof n.fromJSON=="function"&&(d["upload preset"]=async()=>{var m,A;cc.Remove();const x=await mc(!1,!1);if(x.length===0)return;const E=x[0],M=await E.text(),T=JSON.parse(M);await((A=(m=this._viewer)===null||m===void 0?void 0:m.getPlugin(ln))===null||A===void 0?void 0:A.importPluginPreset(T,n))});const p=cc.Create(d,o.clientWidth-120,12);o.append(p),c.preventDefault()},o.appendChild(a)}return r}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var t;const n=e.uiConfig;n&&(ke(n.hidden)!==!0?(t=n.uiRefresh)===null||t===void 0||t.call(n,"postFrame",!0):n.uiRef&&(n.uiRef.hidden=!0))})}}d1.PluginType="TweakpaneUi";class qb extends Zn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,onChange:()=>{if(!this._viewer)return;const e=new Pi(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return t&&(t.isTexture||t.assetType==="texture")?t:null}set sceneBackground(e){var t,n;e?(t=this._viewer)===null||t===void 0||t.setBackground(e):(n=this._viewer)===null||n===void 0||n.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var t;(t=this._viewer)===null||t===void 0||t.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,t,n;return(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||t===void 0?void 0:t.rotation)!==null&&n!==void 0?n:0}set sceneEnvironmentRotation(e){var t,n;const r=(t=this._viewer)===null||t===void 0?void 0:t.scene.getEnvironment();r&&(r.rotation=e,(n=this._viewer)===null||n===void 0||n.scene.setDirty())}get sceneEnvironmentIntensity(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&t!==void 0?t:1}set sceneEnvironmentIntensity(e){var t;!((t=this._viewer)===null||t===void 0)&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===ol}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.getBackground(!0);t&&t!==ol&&(this.lastBgVal=t),this._viewer.setBackground(ol)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var t;await super.onAdded(e);const n=e.getBackground();this.bgUIConfig.value=typeof n=="string"&&n!==ol||typeof n=="number"||!((t=n)===null||t===void 0)&&t.isColor?"#"+new Pi(n).getHexString():"#000000",this.lastBgVal=n}}qb.PluginType="SimpleBackgroundEnvUiPlugin1";class Yb extends Zn{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||t===void 0?void 0:t.map(r=>r.assetType==="light"?null:r.uiConfig).filter(r=>r!=null))!==null&&n!==void 0?n:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;(t=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}}Yb.PluginType="SimpleUi";var _I=__webpackgi_require__(1),AI=__webpackgi_require__.n(_I)();class Xb extends Zn{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=Ji({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n,r,o;const a=(n=this._viewer)===null||n===void 0?void 0:n.scene.modelRoot;if(!a||t==null)return;const c=new Set;a.traverse(d=>{d!==a&&(d.visible=t.includes(d.uuid),d.visible&&d.traverseAncestors(p=>c.add(p)))}),c.forEach(d=>d.visible=!0),(o=(r=this._viewer)===null||r===void 0?void 0:r.scene)===null||o===void 0||o.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),Bl(Z`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var t;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const n=(t=this._viewer)===null||t===void 0?void 0:t.scene.modelRoot;if(!n)return;const r=n.children.reduce(this._buildData,[]),o=n.children.reduce(this._findVisible,[]);let a=!1;return new Promise((c,d)=>{this.treeView=new AI(this.hierarchyDiv,{closeDepth:1,data:r,loaded:function(){this.values=o,c()},onChange:()=>{a?Ir(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):a=!0},onItemLabelClick:p=>{var m;const A=(m=this._viewer)===null||m===void 0?void 0:m.scene.modelRoot.modelObject.getObjectByProperty("uuid",p);A&&n.visible&&A.dispatchEvent({type:"select",value:A,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Xb.PluginType="HierarchyUiPlugin";class Kb extends Zn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Hl;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[ln],this._sceneUpdate=e=>{var t,n,r;if(!e.hierarchyChanged)return;const o=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(a=>{if(!a.lightObject)return;const c=a.uiConfig;c&&!o.includes(c)&&o.push(c)}),[...this.uiConfig.children].forEach(a=>{var c;((c=a)===null||c===void 0?void 0:c.type)==="button"||o.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),o.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Kb.PluginType="SimpleLightsUi";class Jb extends Zn{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[ln],this._sceneUpdate=e=>{var t,n,r;if(!e.hierarchyChanged)return;const o=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(a=>{if(!a.cameraObject)return;const c=a.uiConfig;c&&!o.includes(c)&&o.push(c)}),[...this.uiConfig.children].forEach(a=>{var c;((c=a)===null||c===void 0?void 0:c.type)==="button"||o.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),o.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Jb.PluginType="SimpleSceneCamerasUi";var k_,Zb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var c=s.length-1;c>=0;c--)(r=s[c])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ad=k_=class extends Zn{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var s;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},t=this._viewer.container.getBoundingClientRect();e.width>=t.width&&delete e.width,e.height>=t.height&&delete e.height,(s=this._viewer)===null||s===void 0||s.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(s){await super.onAdded(s);const e=s.canvas.clientWidth,t=s.canvas.clientHeight,n=s.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,s.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(s){return this.removeEventListener("deserialize",this._sizeChanged),s.renderer.removeEventListener("resize",this._refresh),super.onRemove(s)}_refresh(){var s,e;(e=(s=this.uiConfig)===null||s===void 0?void 0:s.uiRefresh)===null||e===void 0||e.call(s,"postFrame",!0)}};ad.PluginType="RendererParamsUiPlugin",Zb([Ne(),ve(k_.prototype._sizeChanged),An("Width",void 0,1,s=>({bounds:()=>{var e;return[10,((e=s._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],ad.prototype,"width",void 0),Zb([Ne(),ve(k_.prototype._sizeChanged),An("Height",void 0,1,s=>({bounds:()=>{var e;return[10,((e=s._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],ad.prototype,"height",void 0),Zb([Ne(),ve(k_.prototype._sizeChanged),An("Scale",[.25,4],.25,{limitedUi:!0})],ad.prototype,"scale",void 0),ad=k_=Zb([ci("Renderer")],ad);class $b extends Zn{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var t;const n=super.toJSON(e);return n.activeCamera=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera.toJSON(),n}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)===null||n===void 0||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}$b.PluginType="CameraUiPlugin";var yI={create:s=>{let e="button"+(s.type?" "+s.type:""),t=Hn.createDiv(e,s.text);return t.addEventListener("click",s.onClick),t}};let va={createElement:(s,e,t,n)=>{let r=document.createElement(s);if(e&&(r.className=e),t&&(r.innerHTML=t),n)for(let o in n)r.setAttribute(o,n[o]);return r},createDiv:(s,e,t)=>va.createElement("div",s,e,t),createDomTree:s=>{if(!s||!s.hasOwnProperty("dom"))return s;let e=s.dom;if(s.children)for(let t in s.children)s.children[t]&&e.appendChild(va.createDomTree(s.children[t]));return e},removeElement:s=>{s!=null&&s.parentNode.removeChild(s)},appendToBody:s=>{document.body.appendChild(s)},makeIconHTML:s=>{let e="";return s=="ok"&&(e="#tick"),s=="error"&&(e="#cancel"),s=="info"&&(e="#info-button"),s=="caution"&&(e="#danger"),s=="min"&&(e="#line"),s=="close"&&(e="#close"),`<svg class="icon ${s}"><use xlink:href="${e}" /></svg>`},makeNftContent:s=>{let e=null;if(s.type){let t=null;t=typeof s.content=="string"?va.createDiv("inner-content",s.content):va.createDomTree({dom:va.createDiv("inner-content"),children:[s.content]}),e=s.type=="text"?va.createDomTree({dom:va.createDiv("content text"),children:[t]}):va.createDomTree({dom:va.createDiv("content"),children:[va.createDiv("state",va.makeIconHTML(s.type)),t]})}else typeof s.content=="string"&&(e=va.createDiv("content",s.content));return e},standardizeButtons:(s,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:s.close.bind(s,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:s.close.bind(s,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=s.close.bind(s,t[n].id));return t},makeButtons:s=>{let e=[];if(s)for(let t in s)e.push(yI.create({text:s[t].text?s[t].text:"OK",type:s[t].normal?null:"main",onClick:s[t].onClick}));return va.createDomTree({dom:va.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:s=>{let e=t=>{for(let n in s)if(s[n].key===t.keyCode)return void s[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:s=>{window.removeEventListener("keydown",s)}};var Hn=va,ps=__webpackgi_require__(476),_o={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let uu={};uu.overlay_in=[new ps.Frame(_o["wwise-overlay-in-1"],0),new ps.Frame(_o["wwise-overlay-in-2"],400)],uu.overlay_out=[new ps.Frame(_o["wwise-overlay-out-1"],300)],uu.pop_in=[new ps.Frame(_o["wwise-pop-in-1"],0),new ps.Frame(_o["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new ps.Frame(_o["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new ps.Frame(_o["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],uu.pop_out=[new ps.Frame(_o["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],uu.flip_in=[new ps.Frame(_o["wwise-flip-in-1"],0),new ps.Frame(_o["wwise-flip-in-2"],500)],uu.flip_out=[new ps.Frame(_o["wwise-flip-out-1"],400)],uu.min_in=[new ps.Frame(_o["wwise-min-in-1"],0),new ps.Frame(_o["wwise-min-in-2"],350)],uu.min_out=[new ps.Frame(_o["wwise-min-out-1"],400)];let VS=["top","bottom","left","right"];for(let s in VS){let e=VS[s];uu[e+"_in"]=[new ps.Frame(_o["wwise-"+e+"-in-1"],0),new ps.Frame(_o["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],uu[e+"_out"]=[new ps.Frame(_o["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var ew=uu;let bI={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class p1{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let r=e.getElementsByClassName("content")[0];return r&&(r=r.innerHTML),Hn.removeElement(e),t.title=n,t.content=r,new p1(t)}constructor(e){this.options=JSON.parse(JSON.stringify(bI));for(let d in e)e[d]!=null&&(this.options[d]=e[d]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let d=document.getElementsByClassName("wwise-overlay");d.length?(this.overlay=d[0],this.hasOverlay=!0):(this.overlay=Hn.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let d=[];this.options.topbar.showMin&&(d.push(Hn.createDiv(null,Hn.makeIconHTML("min"))),d[d.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(d.push(Hn.createDiv(null,Hn.makeIconHTML("close"))),d[d.length-1].addEventListener("click",this.close.bind(this,void 0)));let p=null;p=typeof this.options.title=="string"?Hn.createDiv("title",this.options.title):Hn.createDomTree({dom:Hn.createDiv("title"),children:[this.options.title]}),this.topbar=Hn.createDomTree({dom:Hn.createDiv("topbar"),children:[{dom:Hn.createDiv("control"),children:d.map(m=>({dom:m}))},{dom:p},{dom:Hn.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=Hn.createDomTree({dom:Hn.createDiv(n,this.options.content)}):this.content=Hn.createDomTree({dom:Hn.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Hn.createDomTree({dom:Hn.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let r=Hn.createDiv("wwise-wrapper");this.options.zIndex&&(r.style.zIndex=this.options.zIndex),this.wrapper=Hn.createDomTree({dom:r,children:[this.window]}),this.dom=Hn.createDomTree({dom:Hn.createDiv(),children:[this.wrapper]});let o=this.options.position.split(" "),a=-50,c=-50;if(o[0]=="left"?(a=0,this.wrapper.classList.add("left")):o[0]=="right"?(a=-100,this.wrapper.classList.add("right")):o[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=o[0],o[1]=="top"?(c=0,this.wrapper.classList.add("top")):o[1]=="bottom"?(c=-100,this.wrapper.classList.add("bottom")):o[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${a}%, ${c}%)`,this.options.style)for(let d in this.options.style)this.window.style[d]=this.options.style[d];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new ps.Queue(this.wrapper,ew[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new ps.Queue(this.overlay,ew.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new ps.Queue(this.wrapper,ew[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new ps.Queue(this.overlay,ew.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Hn.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Hn.appendToBody(this.dom)}removeDoms(){Hn.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Hn.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),r=this.options.draggable,o=parseFloat(n.left),a=parseFloat(n.top);if(n.left.indexOf("%")!=-1){o=n.left,o=o.substr(0,o.length-1),o=parseInt(o);let c=window,d=document,p=d.documentElement,m=d.getElementsByTagName("body")[0];o=o*(c.innerWidth||p.clientWidth||m.clientWidth)/100}if(n.top.indexOf("%")!=-1){a=n.top,a=a.substr(0,a.length-1),a=parseInt(a);let c=window,d=document,p=d.documentElement,m=d.getElementsByTagName("body")[0];a=a*(c.innerHeight||p.clientHeight||m.clientHeight)/100}r!=1&&r!="horizontal"||(this.wrapper.style.left=o+t.x+"px"),r!=1&&r!="vertical"||(this.wrapper.style.top=a+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var wI=p1,f1=class{constructor(s){let e=this.options=s;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new wI(t)}constructContent(s){let e=Hn.createDiv("modal"),t=Hn.createDomTree({dom:Hn.createDiv("main "+s.type),children:[Hn.createDiv(null,Hn.makeIconHTML(s.type)),Hn.createDiv("title",s.title),Hn.createDiv("text",s.text)]});this.buttonArr=Hn.standardizeButtons(this,s);let n=Hn.makeButtons(this.buttonArr),r=null;s.content&&(r=typeof s.content=="string"?Hn.createDiv(null,s.content):s.content);let o=null;return n.innerHTML&&(o=Hn.createDomTree({dom:Hn.createDiv("operation "+s.type),children:[n]})),r||o||t.classList.add("no-op"),Hn.createDomTree({dom:e,children:[t,r,o]})}open(){if(this.wwise.opened)return;let s=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Hn.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),s}close(s){if(this.wwise.opened)return this.value=s,Hn.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let xI={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},EI={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var tw=__webpackgi_require__(513),O_={};tw.Z&&tw.Z.locals&&(O_.locals=tw.Z.locals);var m1,g1=0,_m={};_m.styleTagTransform=j0(),_m.setAttributes=F0(),_m.insert=function(s,e){(e.target||document.head).appendChild(s)},_m.domAPI=Tg(),_m.insertStyleElement=Bf(),O_.use=function(s){return _m.options=s||{},g1++||(m1=U0()(tw.Z,_m)),O_},O_.unuse=function(){g1>0&&!--g1&&(m1(),m1=null)};var CI=O_;class v1 extends Zn{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Hn.appendToBody=t=>{e.container.appendChild(t)},Hn.makeIconHTML=t=>"",CI.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],r=new f1({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return r.open(),r.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],r=new f1({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return r.open(),await r.getPromise()==="yes"},e.prompt=async(t,n,r=!0)=>{const o=t==null?void 0:t.split(":")[0],a=new class{constructor(c){this.options=JSON.parse(JSON.stringify(xI));for(let A in c)c[A]!=null&&(this.options[A]=c[A]);let d=this.options,p=JSON.parse(JSON.stringify(EI));for(let A in p)d.hasOwnProperty(A)&&(p[A]=d[A]);let m=[];d.showCancel&&m.push({key:27,text:d.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),m.push({key:13,text:d.okText,onClick:this.handleOk.bind(this)}),p.buttons=m,this.input=Hn.createElement("input","input",null,{placeholder:d.placeholder}),this.error=Hn.createDiv("error"),p.content=Hn.createDomTree({dom:Hn.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new f1(p)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},c=>{this.error.innerText=c}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let c=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((d,p)=>{this.promiseResolve=d,this.promiseReject=p}),c}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:o??"&ndsp;",placeholder:n??"",showCancel:r,animation:"overlay",text:(t==null?void 0:t.replace(o||"","").replace(":",""))||""});return a.open(),await a.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}v1.PluginType="WindowiseDialogPlugin";var SI=mb({defaultModifiers:[_x,yx,bx,vb]}),MI=__webpackgi_require__(388),TI=__webpackgi_require__.n(MI);function II(s){const e=[];s.traverse(r=>{r.geometry&&e.push(r)});const t={},n={};e.forEach(r=>{var o;if(!t[r.geometry.uuid]){const d=r.geometry.toJSON().data,p=d?TI()({a:d.attributes||{},b:d.index||[]}):"";t[r.geometry.uuid]=p}const a=t[r.geometry.uuid],c=(o=n[a])!==null&&o!==void 0?o:n[a]=[];c.includes(r)||c.push(r)}),Object.values(n).forEach(r=>{if(r.length<2)return;const o=r[0].geometry;r.forEach((a,c)=>{c<1||(a.geometry.dispose(),a.geometry=o)})})}const ld=new f.Pa4,Am=new f.Pa4,nw=new f.Pa4,_1=new f.Pa4,iw=new f.Pa4,Rv=new f.Pa4;let A1=1;const DI=new f.Pa4(0,1,0);class PI extends Rl{constructor(e,t){super(e,t),this.targetOffset=new f.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),ld.copy(this.object.position).sub(this.target),A1=ld.length(),Rv.copy(this.target);const t=e();return Rv.sub(this.target),ld.copy(this.object.position).sub(this.target),A1/=ld.length(),this.target.add(Rv),this.object.position.copy(this.target).add(ld),ld.normalize(),Am.crossVectors(DI,ld).normalize(),nw.crossVectors(ld,Am).normalize(),_1.crossVectors(Am,nw).normalize().negate(),Am.length()>.1&&this.object.up.crossVectors(ld.clone().normalize(),Am),this.enablePan&&(iw.set(0,0,0).addScaledVector(Am,Rv.x).addScaledVector(nw,Rv.y).addScaledVector(_1,Rv.z),this.targetOffset.add(iw),this.targetOffset.multiplyScalar(1/A1)),iw.set(0,0,0).addScaledVector(Am,-this.targetOffset.x).addScaledVector(nw,-this.targetOffset.y).addScaledVector(_1,-this.targetOffset.z),this.object.lookAt(iw.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class RI extends n0{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new f.cJO(1,0))}}function y1(s,e){var t,n;const r=Array.from(((t=s.access)!==null&&t!==void 0?t:"").split(".")),o=r.pop();let a=(n=s.targetObject)!==null&&n!==void 0?n:e;if(!o||o.length===0)return{key:void 0,tar:a};if(a=ue(r,a),a&&!(o in a))throw console.error("invalid key",o,a,e,s),"";return{key:o,tar:a}}function b1(s,e,t,n){const{key:r,tar:o}=y1(s,e);return r&&o?uf(o,r,()=>{var a;t&&(!((a=s.updater)===null||a===void 0)&&a.length)&&s.updater.forEach(c=>t[c]()),n==null||n()}):a=>console.warn("Unable to set ",a,r,o,s,e)}async function rw(s,e,t){var n,r,o,a;const{key:c,tar:d}=y1(e,s),p=e.animSet?[GS(d,e.animSet,t,(n=e.animSetParallel)!==null&&n!==void 0&&n)]:[];if(c&&d){const m=(a=e.updater)!==null&&a!==void 0?a:[],A=async()=>hf(d,c,{...e,onUpdate:x=>{var E;(E=e.onUpdate)===null||E===void 0||E.call(e,x),m.forEach(M=>{var T;return(T=t[M])===null||T===void 0?void 0:T.call(t)})}});e.delay?p.push(Ir(e.delay).then(A)):p.push(A())}else(e.duration||e.delay)&&p.push(Ir(((r=e.delay)!==null&&r!==void 0?r:0)+((o=e.duration)!==null&&o!==void 0?o:0)));return p.length===1?p[0]:Promise.all(p)}async function GS(s,e,t,n=!1){if(n)return Promise.all(e.map(async r=>rw(s,r,t)));for(const r of e)await rw(s,r,t)}function HS(s,e,t,n){var r,o,a,c,d,p,m;if(!s)return;e||(e=[]);const A=n??{},x=s;for(let E=0,M=e.length;E<M;E++){const T=e[E];if(T.uiRef){const P=(d=x==null?void 0:x.indexOf(T.uiRef))!==null&&d!==void 0?d:-1;P!==E&&(P>=0&&(x==null||x.splice(P,1)),x==null||x.splice(E,0,T.uiRef))}else{T.uiRef={type:"folder",label:(r=T.name)!==null&&r!==void 0?r:"Animation "+E,children:[]};const P=[{type:"button",label:"animate",value:()=>{rw(t,T,A).then(()=>{var R;return console.log(((R=T.uiRef)===null||R===void 0?void 0:R.label)+" finished")})}}];T.access!==void 0&&P.push({type:"input",property:[T,"access"]}),T.from!==void 0&&P.push({type:(o=T.uiObjectType)!==null&&o!==void 0?o:"input",property:[T,"from"],onChange:()=>{var R;b1(T,t)(T.from),(R=T.updater)===null||R===void 0||R.forEach(I=>I in A&&A[I]())}}),T.to!==void 0&&P.push({type:(a=T.uiObjectType)!==null&&a!==void 0?a:"input",property:[T,"to"],onChange:()=>{var R;b1(T,t)(T.to),(R=T.updater)===null||R===void 0||R.forEach(I=>I in A&&A[I]())}}),T.duration!==void 0&&P.push({type:"input",property:[T,"duration"]}),T.animSet&&(T.animSetParallel||(T.animSetParallel=!1),P.push({type:"input",label:"run parallel",property:[T,"animSetParallel"]})),T.animSet&&P.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(c=T.uiRef.children)===null||c===void 0||c.push(...P),x==null||x.splice(E,0,T.uiRef)}const O=(p=T.uiRef.children)===null||p===void 0?void 0:p.map(P=>ke(P)).flat(2).find(P=>P==null?void 0:P.animSetContainer);T.animSet&&O&&HS(O.children,T.animSet,(m=T.targetObject)!==null&&m!==void 0?m:t,n)}}function WS(s,e){return e?s*(1e3/e):0}function BI(s){var e,t=s.from,n=t===void 0?0:t,r=s.velocity,o=r===void 0?0:r,a=s.min,c=s.max,d=s.power,p=d===void 0?.8:d,m=s.timeConstant,A=m===void 0?750:m,x=s.bounceStiffness,E=x===void 0?500:x,M=s.bounceDamping,T=M===void 0?10:M,O=s.restDelta,P=O===void 0?1:O,R=s.modifyTarget,I=s.driver,j=s.onUpdate,z=s.onComplete;function V(ye){return a!==void 0&&ye<a||c!==void 0&&ye>c}function G(ye){return a===void 0?c:c===void 0||Math.abs(a-ye)<Math.abs(c-ye)?a:c}function X(ye){e==null||e.stop(),e=Xd(Tr(Tr({},ye),{driver:I,onUpdate:function(Re){var we;j==null||j(Re),(we=ye.onUpdate)===null||we===void 0||we.call(ye,Re)},onComplete:z}))}function ne(ye){X(Tr({type:"spring",stiffness:E,damping:T,restDelta:P},ye))}if(V(n))ne({from:n,velocity:o,to:G(n)});else{var ce=p*o+n;R!==void 0&&(ce=R(ce));var ge,de,xe=G(ce),pe=xe===a?-1:1;X({type:"decay",from:n,velocity:o,timeConstant:A,power:p,restDelta:P,modifyTarget:R,onUpdate:V(ce)?function(ye){ge=de,de=ye,o=WS(ye-ge,fg().delta),(pe===1&&ye>xe||pe===-1&&ye<xe)&&ne({from:ye,to:xe,velocity:o})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var qS=function(s){return 180*s/Math.PI},kI=function(s,e){return e===void 0&&(e=sf),qS(Math.atan2(e.y-s.y,e.x-s.x))},OI=function(s,e){var t=!0;return e===void 0&&(e=s,t=!1),function(n){return t?n-s+e:(s=n,t=!0,e)}},LI=function(s){return s},w1=function(s){return s===void 0&&(s=LI),function(e,t,n){var r=t-n,o=-(0-e+1)*(0-s(Math.abs(r)));return r<=0?t+o:t-o}},NI=w1(),UI=w1(Math.sqrt),YS=function(s){return s*Math.PI/180},sw=function(s){return s.hasOwnProperty("x")&&s.hasOwnProperty("y")},x1=function(s){return sw(s)&&s.hasOwnProperty("z")},ow=function(s,e){return Math.abs(s-e)};function FI(s,e){if(rg(s)&&rg(e))return ow(s,e);if(sw(s)&&sw(e)){var t=ow(s.x,e.x),n=ow(s.y,e.y),r=x1(s)&&x1(e)?ow(s.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(r,2))}}var jI=function(s,e,t){return e=YS(e),{x:t*Math.cos(e)+s.x,y:t*Math.sin(e)+s.y}},XS=function(s,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(s*e)/e},KS=function(s,e,t,n){return n===void 0&&(n=0),XS(s+t*(e-s)/Math.max(n,t))},zI=function(s){s===void 0&&(s=50);var e=0,t=0;return function(n){var r=fg().timestamp,o=r!==t?r-t:0,a=o?KS(e,n,o,s):e;return t=r,e=a,a}},QI=function(s){if(typeof s=="number")return function(n){return Math.round(n/s)*s};var e=0,t=s.length;return function(n){var r=Math.abs(s[0]-n);for(e=1;e<t;e++){var o=s[e],a=Math.abs(o-n);if(a===0)return o;if(a>r)return s[e-1];if(e===t-1)return o;r=a}}};function VI(s,e){return s/(1e3/e)}var GI=function(s,e,t){var n=e-s;return((t-s)%n+n)%n+s},JS=function(s,e){return 1-3*e+3*s},ZS=function(s,e){return 3*e-6*s},$S=function(s){return 3*s},aw=function(s,e,t){return((JS(e,t)*s+ZS(e,t))*s+$S(e))*s},eM=function(s,e,t){return 3*JS(e,t)*s*s+2*ZS(e,t)*s+$S(e)},lw=.1;function HI(s,e,t,n){if(s===e&&t===n)return $p;for(var r=new Float32Array(11),o=0;o<11;++o)r[o]=aw(o*lw,s,t);return function(a){return a===0||a===1?a:aw(function(c){for(var d=0,p=1;p!==10&&r[p]<=c;++p)d+=lw;--p;var m=d+(c-r[p])/(r[p+1]-r[p])*lw,A=eM(m,s,t);return A>=.001?function(x,E,M,T){for(var O=0;O<8;++O){var P=eM(E,M,T);if(P===0)return E;E-=(aw(E,M,T)-x)/P}return E}(c,m,s,t):A===0?m:function(x,E,M,T,O){var P,R,I=0;do(P=aw(R=E+(M-E)/2,T,O)-x)>0?M=R:E=R;while(Math.abs(P)>1e-7&&++I<10);return R}(c,d,d+lw,s,t)}(a),e,n)}}var WI=function(s,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*s,r=e==="end"?Math.floor(n):Math.ceil(n);return Lu(0,1,r/s)}};async function qI(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:r=!1,importPopup:o=!0,caching:a=!0}){const c=new Ta(s);c.enabled=!1,e&&await c.addPlugin(dl),await c.addPlugin(ln,void 0,void 0,{storage:a&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await c.addPlugin(s_),await c.addPlugin(tx),o&&await c.addPlugin(Jc),await c.addPlugin(v1),await c.addPlugin(i_),await c.addPlugin(oi),await c.addPlugin(tc),await c.addPlugin(t_),await c.addPlugin(po),await c.addPlugin(Jg),await c.addPlugin(e_),await c.addPlugin(Hp),await c.addPlugin(Ii,i0,!1,!0),await jg(c,{ground:t,bloom:n,depthTonemap:r}),await c.addPlugin(xb,!1),await c.addPlugin(au,!1),await c.addPlugin(rv,!1),await c.addPlugin(vp,!1),await c.addPlugin(n1),await c.addPlugin(s1),await c.addPlugin(o1),await c.addPlugin(td,!1),await c.addPlugin(ah),await c.addPlugin(xl),await c.addPlugin(El),await c.addPlugin(hm),await c.addPlugin(yp),await c.addPlugin(Ap),await c.addPlugin(nh),await c.addPlugin(Go),await c.addPlugin(Xb),await c.addPlugin(Yb),await c.addPlugin(Kb),await c.addPlugin(Jb),await c.addPlugin(ad),await c.addPlugin($b),await c.addPlugin(qb);const d=await c.addPlugin(new d1(!Dp()));return c.renderer.refreshPipeline(),c.scene.addEventListener("textureAdded",p=>{p.texture&&c.scene.setEnvironment(p.texture)}),d.setupPluginUi(Mr),d.setupPluginUi(ad),d.setupPluginUi($b),d.setupPluginUi(Hp),d.setupPluginUi(qb),d.setupPluginUi(s_),d.setupPluginUi(rr),d.setupPluginUi(Vc),d.setupPluginUi(yp),d.setupPluginUi(hm),d.setupPluginUi(Xb),d.setupPluginUi(Ap),d.setupPluginUi(_r),d.setupPluginUi(Ii),t&&d.setupPluginUi(zo),d.setupPluginUi(zm),d.setupPluginUi(Dr),d.setupPluginUi(nh),d.setupPluginUi(Of),d.setupPluginUi(Ng),d.setupPluginUi(Fg),d.setupPluginUi(kg),d.setupPluginUi(Og),d.setupPluginUi(Wc),d.setupPluginUi(Vm),d.setupPluginUi(rv),d.setupPluginUi(vp),d.setupPluginUi(Yb),d.setupPluginUi(ah),d.setupPluginUi(xl),d.setupPluginUi(ks),d.setupPluginUi(Kb),d.setupPluginUi(Jb),d.setupPluginUi(oa),d.setupPluginUi(Os),n&&d.setupPluginUi(Qu),d.setupPluginUi(Go),d.setupPluginUi(Vo),d.setupPluginUi(Ef),d.setupPluginUi(Ho),d.setupPluginUi(xb),d.setupPluginUi(El),d.setupPluginUi(jc),d.setupPluginUi(xf),d.setupPluginUi(Xc),d.setupPluginUi(Es),d.setupPluginUi(au),d.setupPluginUi(Jc),d.setupPluginUi(Wo),d.setupPluginUi(td),c.enabled=!0,c}})();__webpackgi_exports__.LY2;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;var __webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;export{__webpackgi_exports__ViewerApp as _,__webpackgi_exports__AssetManagerPlugin as a,__webpackgi_exports__GBufferPlugin as b,__webpackgi_exports__ProgressivePlugin as c,__webpackgi_exports__TonemapPlugin as d,__webpackgi_exports__GammaCorrectionPlugin as e,__webpackgi_exports__SSRPlugin as f,__webpackgi_exports__SSAOPlugin as g,__webpackgi_exports__BloomPlugin as h,__webpackgi_exports__mobileAndTabletCheck as i};
