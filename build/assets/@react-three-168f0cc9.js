import{_ as G}from"./@babel-98964cd2.js";import{r as C}from"./react-e09a1a9a.js";import{R as Ve,O as Xe,P as Ye,a as fe,T as le,L as de,b as Ke,s as Te,B as Je,M as Qe,W as Ze,C as et,c as tt,d as nt,V as rt,e as ot,N as it,A as at,f as st,g as X,h as lt,S as ct,i as ut,j as ft,D as K,k as dt,l as pt,m as vt}from"./three-df50fedb.js";import{u as mt}from"./react-use-measure-8ab3492c.js";import{F as ht,u as gt}from"./its-fine-6744956a.js";import{R as bt,c as Y}from"./react-reconciler-c23ad77c.js";import"./react-dom-506482cc.js";import"./maath-def0ac39.js";import"./@react-spring-d13bb851.js";import"./lodash.pick-4ed993c7.js";import"./lodash.omit-4ed993c7.js";import"./stats.js-4ed993c7.js";import{m as Ae}from"./react-merge-refs-239dbb3c.js";import"./react-composer-d13bb851.js";import{c as _t}from"./zustand-6305a005.js";var ce={},yt={get exports(){return ce},set exports(e){ce=e}},De={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(h,w){var E=h.length;h.push(w);e:for(;0<E;){var M=E-1>>>1,A=h[M];if(0<c(A,w))h[M]=w,h[E]=A,E=M;else break e}}function o(h){return h.length===0?null:h[0]}function a(h){if(h.length===0)return null;var w=h[0],E=h.pop();if(E!==w){h[0]=E;e:for(var M=0,A=h.length,I=A>>>1;M<I;){var B=2*(M+1)-1,Q=h[B],W=B+1,oe=h[W];if(0>c(Q,E))W<A&&0>c(oe,Q)?(h[M]=oe,h[W]=E,M=W):(h[M]=Q,h[B]=E,M=B);else if(W<A&&0>c(oe,E))h[M]=oe,h[W]=E,M=W;else break e}}return w}function c(h,w){var E=h.sortIndex-w.sortIndex;return E!==0?E:h.id-w.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var _=Date,b=_.now();e.unstable_now=function(){return _.now()-b}}var i=[],v=[],n=1,r=null,l=3,p=!1,d=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(h){for(var w=o(v);w!==null;){if(w.callback===null)a(v);else if(w.startTime<=h)a(v),w.sortIndex=w.expirationTime,t(i,w);else break;w=o(v)}}function P(h){if(g=!1,m(h),!d)if(o(i)!==null)d=!0,U(R);else{var w=o(v);w!==null&&F(P,w.startTime-h)}}function R(h,w){d=!1,g&&(g=!1,s(T),T=-1),p=!0;var E=l;try{for(m(w),r=o(i);r!==null&&(!(r.expirationTime>w)||h&&!j());){var M=r.callback;if(typeof M=="function"){r.callback=null,l=r.priorityLevel;var A=M(r.expirationTime<=w);w=e.unstable_now(),typeof A=="function"?r.callback=A:r===o(i)&&a(i),m(w)}else a(i);r=o(i)}if(r!==null)var I=!0;else{var B=o(v);B!==null&&F(P,B.startTime-w),I=!1}return I}finally{r=null,l=E,p=!1}}var x=!1,O=null,T=-1,k=5,S=-1;function j(){return!(e.unstable_now()-S<k)}function z(){if(O!==null){var h=e.unstable_now();S=h;var w=!0;try{w=O(!0,h)}finally{w?L():(x=!1,O=null)}}else x=!1}var L;if(typeof f=="function")L=function(){f(z)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,H=N.port2;N.port1.onmessage=z,L=function(){H.postMessage(null)}}else L=function(){y(z,0)};function U(h){O=h,x||(x=!0,L())}function F(h,w){T=y(function(){h(e.unstable_now())},w)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(h){h.callback=null},e.unstable_continueExecution=function(){d||p||(d=!0,U(R))},e.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<h?Math.floor(1e3/h):5},e.unstable_getCurrentPriorityLevel=function(){return l},e.unstable_getFirstCallbackNode=function(){return o(i)},e.unstable_next=function(h){switch(l){case 1:case 2:case 3:var w=3;break;default:w=l}var E=l;l=w;try{return h()}finally{l=E}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(h,w){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var E=l;l=h;try{return w()}finally{l=E}},e.unstable_scheduleCallback=function(h,w,E){var M=e.unstable_now();switch(typeof E=="object"&&E!==null?(E=E.delay,E=typeof E=="number"&&0<E?M+E:M):E=M,h){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=E+A,h={id:n++,callback:w,priorityLevel:h,startTime:E,expirationTime:A,sortIndex:-1},E>M?(h.sortIndex=E,t(v,h),o(i)===null&&h===o(v)&&(g?(s(T),T=-1):g=!0,F(P,E-M))):(h.sortIndex=A,t(i,h),d||p||(d=!0,U(R))),h},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(h){var w=l;return function(){var E=l;l=w;try{return h.apply(this,arguments)}finally{l=E}}}})(De);(function(e){e.exports=De})(yt);var Ee,Se;const ze=e=>e&&e.isOrthographicCamera,wt=e=>e&&e.hasOwnProperty("current"),re=typeof window<"u"&&((Ee=window.document)!=null&&Ee.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?C.useLayoutEffect:C.useEffect;function Ie(e){const t=C.useRef(e);return re(()=>void(t.current=e),[e]),t}function Ct({set:e}){return re(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Fe extends C.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Fe.getDerivedStateFromError=()=>({error:!0});const Le="__default",Pt=e=>e&&!!e.memoized&&!!e.changes;function Be(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const Z=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:a="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e))return e===t;const u=D.obj(e);if(u&&a==="reference")return e===t;const _=D.arr(e);if(_&&o==="reference")return e===t;if((_||u)&&e===t)return!0;let b;for(b in e)if(!(b in t))return!1;for(b in c?t:e)if(e[b]!==t[b])return!1;if(D.und(b)){if(_&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Et(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function $(e,t){const o=e;return(t!=null&&t.primitive||!o.__r3f)&&(o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function we(e,t){let o=e;if(t.includes("-")){const a=t.split("-"),c=a.pop();return o=a.reduce((u,_)=>u[_],e),{target:o,key:c}}else return{target:o,key:t}}const Me=/-\d+$/;function pe(e,t,o){if(D.str(o)){if(Me.test(o)){const u=o.replace(Me,""),{target:_,key:b}=we(e,u);Array.isArray(_[b])||(_[b]=[])}const{target:a,key:c}=we(e,o);t.__r3f.previousAttach=a[c],a[c]=t}else t.__r3f.previousAttach=o(e,t)}function ke(e,t,o){var a,c;if(D.str(o)){const{target:u,key:_}=we(e,o),b=t.__r3f.previousAttach;b===void 0?delete u[_]:u[_]=b}else(a=t.__r3f)==null||a.previousAttach==null||a.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function Ne(e,{children:t,key:o,ref:a,...c},{children:u,key:_,ref:b,...i}={},v=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},l=Object.entries(c),p=[];if(v){const g=Object.keys(i);for(let y=0;y<g.length;y++)c.hasOwnProperty(g[y])||l.unshift([g[y],Le+"remove"])}l.forEach(([g,y])=>{var s;if((s=e.__r3f)!=null&&s.primitive&&g==="object"||D.equ(y,i[g]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(g))return p.push([g,y,!0,[]]);let f=[];g.includes("-")&&(f=g.split("-")),p.push([g,y,!1,f]);for(const m in c){const P=c[m];m.startsWith(`${g}-`)&&p.push([m,P,!1,m.split("-")])}});const d={...c};return r.memoizedProps&&r.memoizedProps.args&&(d.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(d.attach=r.memoizedProps.attach),{memoized:d,changes:p}}function ve(e,t){var o,a,c;const u=(o=e.__r3f)!=null?o:{},_=u.root,b=(a=_==null||_.getState==null?void 0:_.getState())!=null?a:{},{memoized:i,changes:v}=Pt(t)?t:Ne(e,t),n=u.eventCount;e.__r3f&&(e.__r3f.memoizedProps=i);for(let p=0;p<v.length;p++){let[d,g,y,s]=v[p],f=e,m=f[d];if(s.length&&(m=s.reduce((P,R)=>P[R],e),!(m&&m.set))){const[P,...R]=s.reverse();f=R.reverse().reduce((x,O)=>x[O],e),d=P}if(g===Le+"remove")if(f.constructor){var r;const P=new f.constructor(...(r=f.__r3f.memoizedProps.args)!=null?r:[]);g=P[d],P.dispose&&P.dispose()}else g=0;if(y)g?u.handlers[d]=g:delete u.handlers[d],u.eventCount=Object.keys(u.handlers).length;else if(m&&m.set&&(m.copy||m instanceof de)){if(Array.isArray(g))m.fromArray?m.fromArray(g):m.set(...g);else if(m.copy&&g&&g.constructor&&m.constructor.name===g.constructor.name)m.copy(g);else if(g!==void 0){const P=m instanceof st;!P&&m.setScalar?m.setScalar(g):m instanceof de&&g instanceof de?m.mask=g.mask:m.set(g),!("ColorManagement"in le)&&!b.linear&&P&&m.convertSRGBToLinear()}}else f[d]=g,!b.linear&&f[d]instanceof Ke&&(f[d].encoding=Te);V(e)}if(u.parent&&b.internal&&e.raycast&&n!==u.eventCount){const p=b.internal.interaction.indexOf(e);p>-1&&b.internal.interaction.splice(p,1),u.eventCount&&b.internal.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(c=e.__r3f)!=null&&c.parent&&Ce(e),e}function V(e){var t,o;const a=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();a&&a.internal.frames===0&&a.invalidate()}function Ce(e){e.onUpdate==null||e.onUpdate(e)}function St(e,t){e.manual||(ze(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Mt(e,t,o){const a=o.pop(),c=o.reduce((u,_)=>u[_],e);return c[a]=t}function ie(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function kt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return Y.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Y.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Y.ContinuousEventPriority;default:return Y.DefaultEventPriority}}function Ue(e,t,o,a){const c=o.get(t);c&&(o.delete(t),o.size===0&&(e.delete(a),c.target.releasePointerCapture(a)))}function Rt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(a=>a!==t),o.initialHits=o.initialHits.filter(a=>a!==t),o.hovered.forEach((a,c)=>{(a.eventObject===t||a.object===t)&&o.hovered.delete(c)}),o.capturedMap.forEach((a,c)=>{Ue(o.capturedMap,t,a,c)})}function xt(e){function t(i){const{internal:v}=e.getState(),n=i.offsetX-v.initialClick[0],r=i.offsetY-v.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(i){return i.filter(v=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function a(i,v){const n=e.getState(),r=new Set,l=[],p=v?v(n.internal.interaction):n.internal.interaction;for(let s=0;s<p.length;s++){const f=Z(p[s]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(i,n);function d(s){const f=Z(s);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var m;f.events.compute==null||f.events.compute(i,f,(m=f.previousRoot)==null?void 0:m.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(s,!0):[]}let g=p.flatMap(d).sort((s,f)=>{const m=Z(s.object),P=Z(f.object);return!m||!P?s.distance-f.distance:P.events.priority-m.events.priority||s.distance-f.distance}).filter(s=>{const f=ie(s);return r.has(f)?!1:(r.add(f),!0)});n.events.filter&&(g=n.events.filter(g,n));for(const s of g){let f=s.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&l.push({...s,eventObject:f}),f=f.parent}}if("pointerId"in i&&n.internal.capturedMap.has(i.pointerId))for(let s of n.internal.capturedMap.get(i.pointerId).values())r.has(ie(s.intersection))||l.push(s.intersection);return l}function c(i,v,n,r){const l=e.getState();if(i.length){const p={stopped:!1};for(const d of i){const g=Z(d.object)||l,{raycaster:y,pointer:s,camera:f,internal:m}=g,P=new X(s.x,s.y,0).unproject(f),R=S=>{var j,z;return(j=(z=m.capturedMap.get(S))==null?void 0:z.has(d.eventObject))!=null?j:!1},x=S=>{const j={intersection:d,target:v.target};m.capturedMap.has(S)?m.capturedMap.get(S).set(d.eventObject,j):m.capturedMap.set(S,new Map([[d.eventObject,j]])),v.target.setPointerCapture(S)},O=S=>{const j=m.capturedMap.get(S);j&&Ue(m.capturedMap,d.eventObject,j,S)};let T={};for(let S in v){let j=v[S];typeof j!="function"&&(T[S]=j)}let k={...d,...T,pointer:s,intersections:i,stopped:p.stopped,delta:n,unprojectedPoint:P,ray:y.ray,camera:f,stopPropagation(){const S="pointerId"in v&&m.capturedMap.get(v.pointerId);if((!S||S.has(d.eventObject))&&(k.stopped=p.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(j=>j.eventObject===d.eventObject))){const j=i.slice(0,i.indexOf(d));u([...j,d])}},target:{hasPointerCapture:R,setPointerCapture:x,releasePointerCapture:O},currentTarget:{hasPointerCapture:R,setPointerCapture:x,releasePointerCapture:O},nativeEvent:v};if(r(k),p.stopped===!0)break}}return i}function u(i){const{internal:v}=e.getState();for(const n of v.hovered.values())if(!i.length||!i.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const l=n.eventObject.__r3f,p=l==null?void 0:l.handlers;if(v.hovered.delete(ie(n)),l!=null&&l.eventCount){const d={...n,intersections:i};p.onPointerOut==null||p.onPointerOut(d),p.onPointerLeave==null||p.onPointerLeave(d)}}}function _(i,v){for(let n=0;n<v.length;n++){const r=v[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(i)}}function b(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return v=>{const{internal:n}=e.getState();"pointerId"in v&&n.capturedMap.has(v.pointerId)&&(n.capturedMap.delete(v.pointerId),u([]))}}return function(n){const{onPointerMissed:r,internal:l}=e.getState();l.lastEvent.current=n;const p=i==="onPointerMove",d=i==="onClick"||i==="onContextMenu"||i==="onDoubleClick",y=a(n,p?o:void 0),s=d?t(n):0;i==="onPointerDown"&&(l.initialClick=[n.offsetX,n.offsetY],l.initialHits=y.map(m=>m.eventObject)),d&&!y.length&&s<=2&&(_(n,l.interaction),r&&r(n)),p&&u(y);function f(m){const P=m.eventObject,R=P.__r3f,x=R==null?void 0:R.handlers;if(R!=null&&R.eventCount)if(p){if(x.onPointerOver||x.onPointerEnter||x.onPointerOut||x.onPointerLeave){const O=ie(m),T=l.hovered.get(O);T?T.stopped&&m.stopPropagation():(l.hovered.set(O,m),x.onPointerOver==null||x.onPointerOver(m),x.onPointerEnter==null||x.onPointerEnter(m))}x.onPointerMove==null||x.onPointerMove(m)}else{const O=x[i];O?(!d||l.initialHits.includes(P))&&(_(n,l.interaction.filter(T=>!l.initialHits.includes(T))),O(m)):d&&l.initialHits.includes(P)&&_(n,l.interaction.filter(T=>!l.initialHits.includes(T)))}}c(y,n,s,f)}}return{handlePointer:b}}let Pe={},jt=e=>void(Pe={...Pe,...e});function Ot(e,t){function o(n,{args:r=[],attach:l,...p},d){let g=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=p.object;y=$(s,{type:n,root:d,attach:l,primitive:!0})}else{const s=Pe[g];if(!s)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=$(new s(...r),{type:n,root:d,attach:l,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y instanceof Je?y.__r3f.attach="geometry":y instanceof Qe&&(y.__r3f.attach="material")),g!=="inject"&&ve(y,p),y}function a(n,r){let l=!1;if(r){var p,d;(p=r.__r3f)!=null&&p.attach?pe(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),l=!0),l||(d=n.__r3f)==null||d.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,Ce(r),V(r)}}function c(n,r,l){let p=!1;if(r){var d,g;if((d=r.__r3f)!=null&&d.attach)pe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const y=n.children.filter(f=>f!==r),s=y.indexOf(l);n.children=[...y.slice(0,s),r,...y.slice(s)],p=!0}p||(g=n.__r3f)==null||g.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,Ce(r),V(r)}}function u(n,r,l=!1){n&&[...n].forEach(p=>_(r,p,l))}function _(n,r,l){if(r){var p,d,g;if(r.__r3f&&(r.__r3f.parent=null),(p=n.__r3f)!=null&&p.objects&&(n.__r3f.objects=n.__r3f.objects.filter(P=>P!==r)),(d=r.__r3f)!=null&&d.attach)ke(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var y;n.remove(r),(y=r.__r3f)!=null&&y.root&&Rt(r.__r3f.root,r)}const f=(g=r.__r3f)==null?void 0:g.primitive,m=l===void 0?r.dispose!==null&&!f:l;if(!f){var s;u((s=r.__r3f)==null?void 0:s.objects,r,m),u(r.children,r,m)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,f||delete r.__r3f),m&&r.dispose&&r.type!=="Scene"&&ce.unstable_scheduleCallback(ce.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),V(n)}}function b(n,r,l,p){var d;const g=(d=n.__r3f)==null?void 0:d.parent;if(!g)return;const y=o(r,l,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&a(y,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>a(y,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||_(g,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),a(g,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[p,p.alternate].forEach(s=>{s!==null&&(s.stateNode=y,s.ref&&(typeof s.ref=="function"?s.ref(y):s.ref.current=y))})}const i=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:bt({createInstance:o,removeChild:_,appendChild:a,appendInitialChild:a,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const l=n.getState().scene;l.__r3f&&(l.__r3f.root=n,a(l,r))},removeChildFromContainer:(n,r)=>{r&&_(n.getState().scene,r)},insertInContainerBefore:(n,r,l)=>{if(!r||!l)return;const p=n.getState().scene;p.__r3f&&c(p,r,l)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;const l=(r=n==null?void 0:n.__r3f)!=null?r:{};return Boolean(l.handlers)},prepareUpdate(n,r,l,p){if(n.__r3f.primitive&&p.object&&p.object!==n)return[!0];{const{args:d=[],children:g,...y}=p,{args:s=[],children:f,...m}=l;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((R,x)=>R!==s[x]))return[!0];const P=Ne(n,y,m,!0);return P.changes.length?[!1,P]:null}},commitUpdate(n,[r,l],p,d,g,y){r?b(n,p,g,y):ve(n,l)},commitMount(n,r,l,p){var d;const g=(d=n.__r3f)!=null?d:{};n.raycast&&g.handlers&&g.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>$(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:l,parent:p}=(r=n.__r3f)!=null?r:{};l&&p&&ke(p,n,l),n.isObject3D&&(n.visible=!1),V(n)},unhideInstance(n,r){var l;const{attach:p,parent:d}=(l=n.__r3f)!=null?l:{};p&&d&&pe(d,n,p),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),V(n)},createTextInstance:i,hideTextInstance:i,unhideTextInstance:i,getCurrentEventPriority:()=>t?t():Y.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ve}}const He=e=>!!(e!=null&&e.render),We=C.createContext(null),Tt=(e,t)=>{const o=_t((b,i)=>{const v=new X,n=new X,r=new X;function l(s=i().camera,f=n,m=i().size){const{width:P,height:R,top:x,left:O}=m,T=P/R;f instanceof X?r.copy(f):r.set(...f);const k=s.getWorldPosition(v).distanceTo(r);if(ze(s))return{width:P/s.zoom,height:R/s.zoom,top:x,left:O,factor:1,distance:k,aspect:T};{const S=s.fov*Math.PI/180,j=2*Math.tan(S/2)*k,z=j*(P/R);return{width:z,height:j,top:x,left:O,factor:P/z,distance:k,aspect:T}}}let p;const d=s=>b(f=>({performance:{...f.performance,current:s}})),g=new lt;return{set:b,get:i,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:(s=1)=>e(i(),s),advance:(s,f)=>t(s,f,i()),legacy:!1,linear:!1,flat:!1,scene:$(new ct),controls:null,clock:new ut,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=i();p&&clearTimeout(p),s.performance.current!==s.performance.min&&d(s.performance.min),p=setTimeout(()=>d(i().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:s=>b(f=>({...f,events:{...f.events,...s}})),setSize:(s,f,m,P,R)=>{const x=i().camera,O={width:s,height:f,top:P||0,left:R||0,updateStyle:m};b(T=>({size:O,viewport:{...T.viewport,...l(x,n,O)}}))},setDpr:s=>b(f=>{const m=Be(s);return{viewport:{...f.viewport,dpr:m,initialDpr:f.viewport.initialDpr||m}}}),setFrameloop:(s="always")=>{const f=i().clock;f.stop(),f.elapsedTime=0,s!=="never"&&(f.start(),f.elapsedTime=0),b(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:C.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,f,m)=>{const P=i().internal;return P.priority=P.priority+(f>0?1:0),P.subscribers.push({ref:s,priority:f,store:m}),P.subscribers=P.subscribers.sort((R,x)=>R.priority-x.priority),()=>{const R=i().internal;R!=null&&R.subscribers&&(R.priority=R.priority-(f>0?1:0),R.subscribers=R.subscribers.filter(x=>x.ref!==s))}}}}}),a=o.getState();let c=a.size,u=a.viewport.dpr,_=a.camera;return o.subscribe(()=>{const{camera:b,size:i,viewport:v,gl:n,set:r}=o.getState();(i!==c||v.dpr!==u)&&(c=i,u=v.dpr,St(b,i),n.setPixelRatio(v.dpr),n.setSize(i.width,i.height,i.updateStyle)),b!==_&&(_=b,r(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(b)}})))}),o.subscribe(b=>e(b)),o};let ae,At=new Set,Dt=new Set,zt=new Set;function me(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function ee(e,t){switch(e){case"before":return me(At,t);case"after":return me(Dt,t);case"tail":return me(zt,t)}}let he,ge;function be(e,t,o){let a=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(a=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),he=t.internal.subscribers,ae=0;ae<he.length;ae++)ge=he[ae],ge.ref.current(ge.store.getState(),a,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function It(e){let t=!1,o,a,c;function u(i){a=requestAnimationFrame(u),t=!0,o=0,ee("before",i);for(const n of e.values()){var v;c=n.store.getState(),c.internal.active&&(c.frameloop==="always"||c.internal.frames>0)&&!((v=c.gl.xr)!=null&&v.isPresenting)&&(o+=be(i,c))}if(ee("after",i),o===0)return ee("tail",i),t=!1,cancelAnimationFrame(a)}function _(i,v=1){var n;if(!i)return e.forEach(r=>_(r.store.getState()),v);(n=i.gl.xr)!=null&&n.isPresenting||!i.internal.active||i.frameloop==="never"||(i.internal.frames=Math.min(60,i.internal.frames+v),t||(t=!0,requestAnimationFrame(u)))}function b(i,v=!0,n,r){if(v&&ee("before",i),n)be(i,n,r);else for(const l of e.values())be(i,l.store.getState());v&&ee("after",i)}return{loop:u,invalidate:_,advance:b}}function qe(){const e=C.useContext(We);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function _e(e=o=>o,t){return qe()(e,t)}function Ge(e,t=0){const o=qe(),a=o.getState().internal.subscribe,c=Ie(e);return re(()=>a(c,t,o),[t,a,o]),null}const J=new Map,{invalidate:Re,advance:xe}=It(J),{reconciler:ue,applyProps:se}=Ot(J,kt),te={objects:"shallow",strict:!1},Ft=(e,t)=>{const o=typeof e=="function"?e(t):e;return He(o)?o:new Ze({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Lt(e){return e instanceof HTMLCanvasElement}function Bt(e,t){if(t)return t;if(Lt(e)&&e.parentElement){const{width:o,height:a,top:c,left:u}=e.parentElement.getBoundingClientRect();return{width:o,height:a,top:c,left:u}}return{width:0,height:0,top:0,left:0}}function Nt(e){const t=J.get(e),o=t==null?void 0:t.fiber,a=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,u=a||Tt(Re,xe),_=o||ue.createContainer(u,Y.ConcurrentRoot,null,!1,null,"",c,null);t||J.set(e,{fiber:_,store:u});let b,i=!1;return{configure(v={}){let{gl:n,size:r,events:l,onCreated:p,shadows:d=!1,linear:g=!1,flat:y=!1,legacy:s=!1,orthographic:f=!1,frameloop:m="always",dpr:P=[1,2],performance:R,raycaster:x,camera:O,onPointerMissed:T}=v,k=u.getState(),S=k.gl;k.gl||k.set({gl:S=Ft(n,e)});let j=k.raycaster;j||k.set({raycaster:j=new Ve});const{params:z,...L}=x||{};if(D.equ(L,j,te)||se(j,{...L}),D.equ(z,j.params,te)||se(j,{params:{...j.params,...z}}),!k.camera){const h=O instanceof et,w=h?O:f?new Xe(0,0,0,0,.1,1e3):new Ye(75,0,.1,1e3);h||(w.position.z=5,O&&se(w,O),O!=null&&O.rotation||w.lookAt(0,0,0)),k.set({camera:w})}if(!k.xr){const h=(M,A)=>{const I=u.getState();I.frameloop!=="never"&&xe(M,!0,I,A)},w=()=>{const M=u.getState();M.gl.xr.enabled=M.gl.xr.isPresenting,M.gl.xr.setAnimationLoop(M.gl.xr.isPresenting?h:null),M.gl.xr.isPresenting||Re(M)},E={connect(){const M=u.getState().gl;M.xr.addEventListener("sessionstart",w),M.xr.addEventListener("sessionend",w)},disconnect(){const M=u.getState().gl;M.xr.removeEventListener("sessionstart",w),M.xr.removeEventListener("sessionend",w)}};S.xr&&E.connect(),k.set({xr:E})}if(S.shadowMap){const h=S.shadowMap.enabled,w=S.shadowMap.type;if(S.shadowMap.enabled=!!d,D.boo(d))S.shadowMap.type=fe;else if(D.str(d)){var N;const E={basic:tt,percentage:nt,soft:fe,variance:rt};S.shadowMap.type=(N=E[d])!=null?N:fe}else D.obj(d)&&Object.assign(S.shadowMap,d);(h!==S.shadowMap.enabled||w!==S.shadowMap.type)&&(S.shadowMap.needsUpdate=!0)}"ColorManagement"in le&&Mt(le,s,["ColorManagement","legacyMode"]);const H=g?ot:Te,U=y?it:at;S.outputEncoding!==H&&(S.outputEncoding=H),S.toneMapping!==U&&(S.toneMapping=U),k.legacy!==s&&k.set(()=>({legacy:s})),k.linear!==g&&k.set(()=>({linear:g})),k.flat!==y&&k.set(()=>({flat:y})),n&&!D.fun(n)&&!He(n)&&!D.equ(n,S,te)&&se(S,n),l&&!k.events.handlers&&k.set({events:l(u)}),P&&k.viewport.dpr!==Be(P)&&k.setDpr(P);const F=Bt(e,r);return D.equ(F,k.size,te)||k.setSize(F.width,F.height,F.updateStyle,F.top,F.left),k.frameloop!==m&&k.setFrameloop(m),k.onPointerMissed||k.set({onPointerMissed:T}),R&&!D.equ(R,k.performance,te)&&k.set(h=>({performance:{...h.performance,...R}})),b=p,i=!0,this},render(v){return i||this.configure(),ue.updateContainer(C.createElement(Ut,{store:u,children:v,onCreated:b,rootElement:e}),_,null,()=>{}),u},unmount(){$e(e)}}}function Ut({store:e,children:t,onCreated:o,rootElement:a}){return re(()=>{const c=e.getState();c.set(u=>({internal:{...u.internal,active:!0}})),o&&o(c),e.getState().events.connected||c.events.connect==null||c.events.connect(a)},[]),C.createElement(We.Provider,{value:e},t)}function $e(e,t){const o=J.get(e),a=o==null?void 0:o.fiber;if(a){const c=o==null?void 0:o.store.getState();c&&(c.internal.active=!1),ue.updateContainer(null,a,null,()=>{c&&setTimeout(()=>{try{var u,_,b,i;c.events.disconnect==null||c.events.disconnect(),(u=c.gl)==null||(_=u.renderLists)==null||_.dispose==null||_.dispose(),(b=c.gl)==null||b.forceContextLoss==null||b.forceContextLoss(),(i=c.gl)!=null&&i.xr&&c.xr.disconnect(),Et(c),J.delete(e),t&&t(e)}catch{}},500)})}}ue.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:C.version});const ye={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ht(e){const{handlePointer:t}=xt(e);return{priority:1,enabled:!0,compute(o,a,c){a.pointer.set(o.offsetX/a.size.width*2-1,-(o.offsetY/a.size.height)*2+1),a.raycaster.setFromCamera(a.pointer,a.camera)},connected:void 0,handlers:Object.keys(ye).reduce((o,a)=>({...o,[a]:t(a)}),{}),update:()=>{var o;const{events:a,internal:c}=e.getState();(o=c.lastEvent)!=null&&o.current&&a.handlers&&a.handlers.onPointerMove(c.lastEvent.current)},connect:o=>{var a;const{set:c,events:u}=e.getState();u.disconnect==null||u.disconnect(),c(_=>({events:{..._.events,connected:o}})),Object.entries((a=u.handlers)!=null?a:[]).forEach(([_,b])=>{const[i,v]=ye[_];o.addEventListener(i,b,{passive:v})})},disconnect:()=>{const{set:o,events:a}=e.getState();if(a.connected){var c;Object.entries((c=a.handlers)!=null?c:[]).forEach(([u,_])=>{if(a&&a.connected instanceof HTMLElement){const[b]=ye[u];a.connected.removeEventListener(b,_)}}),o(u=>({events:{...u.events,connected:void 0}}))}}}}const Wt=C.forwardRef(function({children:t,fallback:o,resize:a,style:c,gl:u,events:_=Ht,eventSource:b,eventPrefix:i,shadows:v,linear:n,flat:r,legacy:l,orthographic:p,frameloop:d,dpr:g,performance:y,raycaster:s,camera:f,onPointerMissed:m,onCreated:P,...R},x){C.useMemo(()=>jt(le),[]);const O=gt(),[T,k]=mt({scroll:!0,debounce:{scroll:50,resize:0},...a}),S=C.useRef(null),j=C.useRef(null),[z,L]=C.useState(null);C.useImperativeHandle(x,()=>S.current);const N=Ie(m),[H,U]=C.useState(!1),[F,h]=C.useState(!1);if(H)throw H;if(F)throw F;const w=C.useRef(null);k.width>0&&k.height>0&&z&&(w.current||(w.current=Nt(z)),w.current.configure({gl:u,events:_,shadows:v,linear:n,flat:r,legacy:l,orthographic:p,frameloop:d,dpr:g,performance:y,raycaster:s,camera:f,size:k,onPointerMissed:(...M)=>N.current==null?void 0:N.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(b?wt(b)?b.current:b:j.current),i&&M.setEvents({compute:(A,I)=>{const B=A[i+"X"],Q=A[i+"Y"];I.pointer.set(B/I.size.width*2-1,-(Q/I.size.height)*2+1),I.raycaster.setFromCamera(I.pointer,I.camera)}}),P==null||P(M)}}),w.current.render(C.createElement(O,null,C.createElement(Fe,{set:h},C.createElement(C.Suspense,{fallback:C.createElement(Ct,{set:U})},t))))),re(()=>{L(S.current)},[]),C.useEffect(()=>{if(z)return()=>$e(z)},[z]);const E=b?"none":"auto";return C.createElement("div",G({ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:E,...c}},R),C.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},C.createElement("canvas",{ref:S,style:{display:"block"}},o)))}),un=C.forwardRef(function(t,o){return C.createElement(ht,null,C.createElement(Wt,G({},t,{ref:o})))});class qt extends ft{constructor(t){super(t),this.onBeforeCompile=(o,a)=>{const{isWebGL2:c}=a.capabilities;o.fragmentShader=o.fragmentShader.replace("#include <output_fragment>",`
        ${c?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const fn=C.forwardRef((e,t)=>{const[o]=C.useState(()=>new qt(null));return C.createElement("primitive",G({},e,{object:o,ref:t,attach:"material"}))});let q,ne;const Gt=C.createContext(null),je=new dt,Oe=new X,$t=C.forwardRef(({children:e,range:t,limit:o=1e3,...a},c)=>{const u=C.useRef(null),[_,b]=C.useState([]),[[i,v,n]]=C.useState(()=>[new Float32Array(o*3),Float32Array.from({length:o*3},()=>1),Float32Array.from({length:o},()=>1)]);C.useEffect(()=>{u.current.geometry.attributes.position.needsUpdate=!0}),Ge(()=>{for(u.current.updateMatrix(),u.current.updateMatrixWorld(),je.copy(u.current.matrixWorld).invert(),u.current.geometry.drawRange.count=Math.min(o,t!==void 0?t:o,_.length),q=0;q<_.length;q++)ne=_[q].current,ne.getWorldPosition(Oe).applyMatrix4(je),Oe.toArray(i,q*3),u.current.geometry.attributes.position.needsUpdate=!0,ne.matrixWorldNeedsUpdate=!0,ne.color.toArray(v,q*3),u.current.geometry.attributes.color.needsUpdate=!0,n.set([ne.size],q),u.current.geometry.attributes.size.needsUpdate=!0});const r=C.useMemo(()=>({getParent:()=>u,subscribe:l=>(b(p=>[...p,l]),()=>b(p=>p.filter(d=>d.current!==l.current)))}),[]);return C.createElement("points",G({userData:{instances:_},matrixAutoUpdate:!1,ref:Ae([c,u]),raycast:()=>null},a),C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",count:i.length/3,array:i,itemSize:3,usage:K}),C.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:K}),C.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:K})),C.createElement(Gt.Provider,{value:r},e))}),Vt=C.forwardRef(({children:e,positions:t,colors:o,sizes:a,stride:c=3,...u},_)=>{const b=C.useRef(null);return Ge(()=>{const i=b.current.geometry.attributes;i.position.needsUpdate=!0,o&&(i.color.needsUpdate=!0),a&&(i.size.needsUpdate=!0)}),C.createElement("points",G({ref:Ae([_,b])},u),C.createElement("bufferGeometry",null,C.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/c,array:t,itemSize:c,usage:K}),o&&C.createElement("bufferAttribute",{attach:"attributes-color",count:o.length/c,array:o,itemSize:3,usage:K}),a&&C.createElement("bufferAttribute",{attach:"attributes-size",count:a.length/c,array:a,itemSize:1,usage:K})),e)}),dn=C.forwardRef((e,t)=>e.positions instanceof Float32Array?C.createElement(Vt,G({},e,{ref:t})):C.createElement($t,G({},e,{ref:t})));function pn({all:e,scene:t,camera:o}){const a=_e(({gl:_})=>_),c=_e(({camera:_})=>_),u=_e(({scene:_})=>_);return C.useLayoutEffect(()=>{const _=[];e&&(t||u).traverse(v=>{v.visible===!1&&(_.push(v),v.visible=!0)}),a.compile(t||u,o||c);const b=new pt(128);new vt(.01,1e5,b).update(a,t||u),b.dispose(),_.forEach(v=>v.visible=!1)},[]),null}export{un as C,dn as P,fn as a,pn as b,Ge as u};
